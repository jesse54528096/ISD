import{r as m,a as Ys,o as je,c as s,b as e,w as es,d as G,e as P,v as te,t as l,u as We,f as t,g as Os,h as Ge,i as Is,j as me,F as X,k as le,l as rt,m as Se,n as Ee,p as ee,q as ws,s as Pe,x as Ue,y as bt,z as Ce,A as ps,B as St,C as Gs,D as Zs,E as Qs,G as Ns,H as ta,I as sa,J as aa,K as oa,L as la,M as na}from"./vendor-I8ioMcur.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))u(C);new MutationObserver(C=>{for(const o of C)if(o.type==="childList")for(const N of o.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&u(N)}).observe(document,{childList:!0,subtree:!0});function d(C){const o={};return C.integrity&&(o.integrity=C.integrity),C.referrerPolicy&&(o.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?o.credentials="include":C.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(C){if(C.ep)return;C.ep=!0;const o=d(C);fetch(C.href,o)}})();const ra="/ISD/assets/logo-5ffiGhVj.png",v={errorModal:{visible:m(!1),title:m("操作失敗"),message:m("")},successModal:{visible:m(!1),title:m("操作成功"),message:m("")},confirmModal:{visible:m(!1),title:m("確認"),message:m("")},infoModal:{visible:m(!1),title:m("信息"),message:m("")},promptModal:{visible:m(!1),title:m("請輸入"),message:m(""),value:m(""),type:m("text"),callback:null},showError(M,h){this.errorModal.title.value=M||"操作失敗",this.errorModal.message.value=h||"發生錯誤，請稍後再試",this.errorModal.visible.value=!0},closeError(){this.errorModal.visible.value=!1},showSuccess(M,h){this.successModal.title.value=M||"操作成功",this.successModal.message.value=h||"操作已成功完成",this.successModal.visible.value=!0},closeSuccess(){this.successModal.visible.value=!1},showConfirm(M,h){this.confirmModal.title.value=M||"確認",this.confirmModal.message.value=h||"請確認您的選擇",this.confirmModal.visible.value=!0},closeConfirm(){this.confirmModal.visible.value=!1},showInfo(M,h){this.infoModal.title.value=M||"信息",this.infoModal.message.value=h||"",this.infoModal.visible.value=!0},closeInfo(){this.infoModal.visible.value=!1,document.dispatchEvent(new CustomEvent("info_close"))},confirmAsync(M,h){return this.showConfirm(M,h),new Promise(d=>{const u=()=>{d(!0),document.removeEventListener("confirm_ok",u),document.removeEventListener("confirm_cancel",C)},C=()=>{d(!1),document.removeEventListener("confirm_ok",u),document.removeEventListener("confirm_cancel",C)};document.addEventListener("confirm_ok",u,{once:!0}),document.addEventListener("confirm_cancel",C,{once:!0})})},showPrompt(M,h,d="text"){this.promptModal.title.value=M||"請輸入",this.promptModal.message.value=h||"",this.promptModal.value.value="",this.promptModal.type.value=d,this.promptModal.visible.value=!0},confirmPrompt(M){this.promptModal.callback&&this.promptModal.callback(M),this.closePrompt()},cancelPrompt(){this.promptModal.callback&&this.promptModal.callback(null),this.closePrompt()},closePrompt(){this.promptModal.visible.value=!1,this.promptModal.value.value="",this.promptModal.callback=null},promptAsync(M,h,d="text"){return this.showPrompt(M,h,d),new Promise(u=>{this.promptModal.callback=u;const C=N=>{N.detail&&typeof N.detail=="string"?u(N.detail):u(""),document.removeEventListener("prompt_confirm",C),document.removeEventListener("prompt_cancel",o)},o=()=>{u(null),document.removeEventListener("prompt_confirm",C),document.removeEventListener("prompt_cancel",o)};document.addEventListener("prompt_confirm",C),document.addEventListener("prompt_cancel",o)})}},ia="https://dev-moda.mosji.co",be=Ys.create({baseURL:ia,timeout:2e4,headers:{"Content-Type":"application/json"}});let vs=!1;const Xs=new AbortController;be.interceptors.request.use(M=>{if(vs)return Promise.reject({isLoginExpired:!0});const h=localStorage.getItem("token");if(h&&(M.headers.Authorization=`Bearer ${h}`),M.method==="get"&&M.params){const d={};Object.keys(M.params).forEach(u=>{M.params[u]!==null&&M.params[u]!==void 0&&M.params[u]!==""&&(d[u]=M.params[u])}),M.params=d}return M.signal=Xs.signal,M},M=>Promise.reject(M));be.interceptors.response.use(M=>M.data&&M.data.message==="請重新登入"?(Ls(),Promise.reject({isLoginExpired:!0})):M,M=>{if(M.isLoginExpired)return Promise.reject(M);if(M.response&&M.response.status===401&&!vs)return Ls(),Promise.reject({isLoginExpired:!0});if(Ys.isCancel(M))return Promise.reject({isLoginExpired:!0});if(M.response){if(M.response.data&&M.response.data.message==="請重新登入"&&!vs)return Ls(),Promise.reject({isLoginExpired:!0});vs||v.showError("請求失敗",M.response.data.message||"發生錯誤，請稍後再試")}else M.request&&!vs?v.showError("連接失敗","無法連接到伺服器，請檢查網路連線"):!vs&&!M.isLoginExpired&&v.showError("請求錯誤","請求發生錯誤，請稍後再試");return Promise.reject(M)});const Ls=()=>{vs||(vs=!0,Xs.abort(),localStorage.removeItem("token"),v.showError("登入已過期","請重新登入"),setTimeout(()=>{window.location.href="/login"},1500))},js={login:(M,h)=>be.post("/v1/login",{account:M,password:h}),logout:()=>be.post("/v1/logout")},ot={getSidebarPermissions:()=>be.get("/v1/sidebar")},da="/ISD/assets/5hpvkmlj-DCdXzIFe.svg",ua={class:"min-h-screen flex items-center justify-center bg-gray-100"},ca={class:"flex flex-col items-center"},pa={class:"w-[600px] bg-white shadow-lg"},va={class:"flex justify-center"},ma={class:"flex justify-center"},ba={class:"flex justify-center"},fa={class:"w-[400px] flex space-x-2"},ya={key:0,class:"flex justify-center"},ga={class:"text-red-500"},xa={class:"flex justify-center"},ha=["disabled"],wa={__name:"Login",setup(M){We();const h=m(""),d=m(""),u=m(!1),C=m(""),o=m(null),N=m(""),K=m(""),E=()=>{const y="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let r="";const b=f=>{const V=new Uint32Array(1);return window.crypto.getRandomValues(V),V[0]%f},p=b(10),_=b(26)+10;r+=y[p],r+=y[_];for(let f=0;f<2;f++){const V=b(y.length);r+=y[V]}return r.split("").sort(()=>{const f=new Uint32Array(1);return window.crypto.getRandomValues(f),.5-f[0]/4294967295}).join("")},U=()=>{if(!o.value)return;const y=o.value.getContext("2d"),r=o.value.width,b=o.value.height;o.value.width=r,o.value.height=b,K.value=E();const p=()=>{const _=new Uint32Array(1);return window.crypto.getRandomValues(_),_[0]/4294967295};y.fillStyle="#f0f0f0",y.fillRect(0,0,r,b);for(let _=0;_<2;_++)y.strokeStyle=`rgb(${p()*200}, ${p()*200}, ${p()*200})`,y.lineWidth=.5,y.beginPath(),y.moveTo(p()*r,p()*b),y.lineTo(p()*r,p()*b),y.stroke();for(let _=0;_<15;_++)y.fillStyle=`rgb(${p()*200}, ${p()*200}, ${p()*200})`,y.beginPath(),y.arc(p()*r,p()*b,.8,0,2*Math.PI),y.fill();y.font="bold 50px Arial",y.textAlign="center",y.textBaseline="middle";for(let _=0;_<K.value.length;_++){const f=K.value[_],V=r*(_+1)/(K.value.length+1),W=b/2+p()*4-2;y.fillStyle=`rgb(${Math.floor(p()*80)}, ${Math.floor(p()*80)}, ${Math.floor(p()*80)})`,y.save(),y.translate(V,W),y.rotate((p()-.5)*.2),y.fillText(f,0,0),y.restore()}},T=()=>{U()},z=()=>N.value?N.value.toUpperCase()!==K.value?(C.value="驗證碼錯誤",T(),N.value="",!1):!0:(C.value="請輸入驗證碼",!1),g=()=>(C.value="",!h.value||!d.value?(C.value="請輸入帳號和密碼",!1):z()),a=y=>{C.value=y||"登入失敗，請檢查帳號密碼",T(),N.value=""},R=y=>{window.location.href=y},Z=y=>{if(y.isNeedChangePwd===!0){R("/password");return}if(!Object.values(y).some(p=>p===!0)){R("/unauthorized");return}const b=Ps.options.getFirstAvailablePath?Ps.options.getFirstAvailablePath(y):null;R(b||"/unauthorized")},$=async()=>{try{const y=await ot.getSidebarPermissions();y.data.code===0&&y.data.message==="success"?Z(y.data.data):R("/unauthorized")}catch(y){console.error("獲取權限失敗:",y),R("/unauthorized")}},c=async()=>{var y,r;if(g())try{u.value=!0;const b=await js.login(h.value,d.value);b.data.code===0&&b.data.message==="success"?(localStorage.setItem("token",b.data.data.token),await $()):a(b.data.message)}catch(b){console.error("登入錯誤:",b);const p=((r=(y=b.response)==null?void 0:y.data)==null?void 0:r.message)||"登入失敗，請稍後再試";a(p)}finally{u.value=!1}};return je(()=>{setTimeout(()=>{U()},0)}),(y,r)=>(t(),s("div",ua,[e("div",ca,[r[5]||(r[5]=e("div",{class:"mb-4 flex items-center"},[e("img",{src:da,alt:"數位發展部資通安全署",class:"h-20"})],-1)),e("div",pa,[r[4]||(r[4]=e("div",{class:"w-full bg-gray-700 text-white p-4"},[e("h1",{class:"text-center text-xl"}," 113-116年推動政府資安人力職能轉換訓練服務委外案 "),e("h2",{class:"text-center text-lg mt-2"}," 學習歷程資料管理系統 ")],-1)),e("form",{onSubmit:es(c,["prevent"]),class:"space-y-4 p-6"},[e("div",va,[P(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=b=>h.value=b),placeholder:"帳號",class:"w-[400px] px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[te,h.value]])]),e("div",ma,[P(e("input",{type:"password","onUpdate:modelValue":r[1]||(r[1]=b=>d.value=b),placeholder:"密碼",class:"w-[400px] px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[te,d.value]])]),e("div",ba,[e("div",fa,[P(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=b=>N.value=b),placeholder:"請輸入驗證碼",class:"flex-1 px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[te,N.value]]),e("div",{class:"w-32 h-10 flex items-center justify-center relative cursor-pointer",onClick:T},[e("canvas",{ref_key:"captchaCanvas",ref:o,class:"w-full h-full border-2 border-gray-300"},null,512),r[3]||(r[3]=e("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300"},[e("div",{class:"bg-black bg-opacity-20 w-full h-full flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1))])])]),C.value?(t(),s("div",ya,[e("p",ga,l(C.value),1)])):G("",!0),e("div",xa,[e("button",{type:"submit",class:"w-[200px] py-2 px-4 bg-[#4e9875] hover:bg-[#438264] text-white",disabled:u.value},l(u.value?"登入中...":"登入"),9,ha)])],32)])])]))}},_a={class:"flex items-center text-sm space-x-2 mb-6"},ka={key:1,class:"text-[#4e9875] font-medium"},ft={__name:"Breadcrumb",props:{breadcrumbs:{type:Array,required:!0,default:()=>[]}},setup(M){return(h,d)=>{const u=Os("router-link");return t(),s("div",_a,[Ge(u,{to:"/",class:"text-gray-600 hover:text-gray-800"},{default:Is(()=>d[0]||(d[0]=[me("首頁")])),_:1}),d[2]||(d[2]=e("span",{class:"text-gray-500"},"/",-1)),(t(!0),s(X,null,le(M.breadcrumbs,(C,o)=>(t(),s(X,{key:o},[o<M.breadcrumbs.length-1?(t(),s(X,{key:0},[Ge(u,{to:C.path,class:"text-gray-600 hover:text-gray-800"},{default:Is(()=>[me(l(C.name),1)]),_:2},1032,["to"]),d[1]||(d[1]=e("span",{class:"text-gray-500"},"/",-1))],64)):(t(),s("span",ka,l(C.name),1))],64))),128))])}}},cs={getReviews:M=>be.get("/v1/review",{params:M}),getReviewById:M=>be.get(`/v1/review/${M}`),updateReview:(M,h)=>be.put(`/v1/review/${M}`,h),updateReviewStatus:(M,h)=>be.put(`/v1/review/status/${M}`,h),importReviews:M=>be.post("/v1/review/import",M,{headers:{"Content-Type":"multipart/form-data"}}),deleteReview:M=>be.delete("/v1/review",{data:M}),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),exportReviewToExcel:M=>be.get(`/v1/review/export/${M}`,{responseType:"blob"})},Fe=(M,h)=>{const d=M.__vccOpts||M;for(const[u,C]of h)d[u]=C;return d},$a={class:"flex flex-col items-center p-6"},Ca={class:"w-full max-w-[1500px]"},Ea={class:"w-full max-w-[1500px]"},Sa={class:"bg-gray-100 p-4"},Da={class:"flex justify-between items-center"},Ma={class:"space-x-4"},Aa=["aria-label"],Ia={class:"w-full max-w-[1500px]"},Ra={class:"space-y-6 mt-6"},Pa={class:"grid grid-cols-2 gap-6"},Ua={class:"flex items-center"},Na=["readonly"],Ta={class:"flex items-center"},Va=["readonly"],ja={class:"flex items-center"},La=["readonly"],Fa={class:"flex items-center"},Oa=["readonly"],qa={class:"flex items-center"},Ba=["readonly"],Ha={class:"w-full border"},Wa={class:"border p-2"},za={class:"relative"},Ka=["onUpdate:modelValue","readonly"],Ja={class:"border p-2"},Ya={class:"relative"},Ga=["onUpdate:modelValue","readonly"],Za={class:"border p-2"},Qa={class:"relative"},Xa=["onUpdate:modelValue","readonly"],eo={class:"border p-2"},to={class:"relative"},so=["onUpdate:modelValue","readonly"],ao={class:"relative"},oo=["onUpdate:modelValue","readonly"],lo={class:"relative"},no=["onUpdate:modelValue","readonly"],ro={class:"border p-2"},io={class:"relative"},uo=["onUpdate:modelValue","readonly"],co={class:"flex justify-end items-center mb-4 mt-4"},po={class:"w-full border"},vo={class:"bg-[#EEEFE7]"},mo={key:0,class:"border p-2 w-[5%]",scope:"col"},bo={class:"border p-2"},fo=["onUpdate:modelValue","readonly"],yo={class:"border p-2"},go={class:"relative"},xo=["onUpdate:modelValue","readonly"],ho={class:"border p-2 text-center"},wo={class:"flex flex-col"},_o=["onUpdate:modelValue","readonly","onInput"],ko=["onUpdate:modelValue","readonly","onInput"],$o={class:"border p-2"},Co=["onUpdate:modelValue","readonly"],Eo={class:"border p-2"},So=["onUpdate:modelValue","readonly"],Do={key:0,class:"border p-2"},Mo=["onClick"],Ao={class:"flex justify-between items-center mb-4"},Io={class:"w-full border mt-4"},Ro={class:"bg-[#EEEFE7]"},Po={key:0,class:"border p-2 w-[5%]",scope:"col"},Uo={class:"border p-2"},No=["onUpdate:modelValue","readonly"],To={class:"border p-2"},Vo=["onUpdate:modelValue","readonly"],jo={class:"border p-2"},Lo={class:"relative"},Fo=["onUpdate:modelValue","readonly"],Oo={key:0,class:"border p-2"},qo=["onClick"],Bo={class:"flex justify-between items-center mb-4"},Ho={class:"w-full border"},Wo={class:"bg-[#EEEFE7]"},zo={key:0,class:"border p-2 w-[5%]",scope:"col"},Ko={class:"border p-2"},Jo=["onUpdate:modelValue","readonly"],Yo={class:"border p-2"},Go={class:"relative"},Zo=["onUpdate:modelValue","readonly"],Qo={key:0,class:"border p-2"},Xo=["onClick"],el={class:"w-full"},tl={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"學校資安領域課程及專業師資投入數"},sl={class:"w-full"},al={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"轉任職系開班經驗"},ol={class:"w-full"},ll={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"其他備註事項"},nl={class:"mb-4 space-x-2 flex items-center"},rl=["disabled"],il=["disabled"],dl={key:2,class:"ml-4"},ul={__name:"InitialReview",setup(M){const h=We(),d=rt(),u=m(d.params.id),C=m(!0),o=m({reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementExport:!1}),N=async()=>{try{if(!await v.confirmAsync("確認刪除","確定要刪除此審核表單嗎？刪除後資料將無法恢復。"))return;const O=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(O===null||O==="")return;if((await cs.confirmPassword(O)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const J=await v.promptAsync("刪除原因","請輸入刪除此審核表單的原因：","text");if(J===null||J==="")return;const Q=await cs.deleteReview({id:u.value,reason:J});Q.data.code===0?(v.showSuccess("刪除成功","審核表單已成功刪除"),h.push("/search")):v.showError("刪除失敗",Q.data.message||"刪除審核表單失敗")}catch(ae){console.error("刪除審核表單錯誤:",ae),v.showError("刪除失敗","刪除審核表單時發生錯誤，請稍後再試")}},K=async()=>{try{const ae=await ot.getSidebarPermissions();ae.data.code===0&&ae.data.message==="success"?(o.value=ae.data.data,console.log("審核表單頁面權限:",o.value)):console.error("獲取權限失敗:",ae.data.message)}catch(ae){console.error("獲取權限錯誤:",ae)}},E=m({name:"",taxId:"",contact:"",phone:"",email:""}),U=m(""),T=m(""),z=m(""),g=m([{id:1,courseName:"",categoryText:"",outline:"",timeLocation:{period:"",weekly:"",location:""},lecturer:""}]),a=m([]),R=m([]),Z=m([]),$=m(""),c=m(0),y=Se(()=>c.value===1||c.value===2),r=async()=>{try{const ae=await cs.exportReviewToExcel(u.value);if(ae.data){const O=ae.headers["content-disposition"];let A=`審核表單_${u.value}.xlsx`;if(O){const Y=O.match(/filename\*?=['"]?(?:UTF-8''|)([a-zA-Z0-9_.%-]+)['"]?/);Y&&Y[1]&&(A=decodeURIComponent(Y[1]))}const J=window.URL.createObjectURL(new Blob([ae.data])),Q=document.createElement("a");Q.href=J,Q.setAttribute("download",A),document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),window.URL.revokeObjectURL(J),v.showSuccess("匯出成功","審核表單已成功匯出為 Excel 檔案")}else v.showError("匯出失敗","匯出 Excel 檔案失敗")}catch(ae){console.error("匯出 Excel 錯誤:",ae),v.showError("匯出錯誤","匯出 Excel 檔案時發生錯誤，請稍後再試")}},b=ae=>{E.value={name:ae.schoolName||"",taxId:ae.taxId||"",contact:ae.contactName||"",phone:ae.contactPhone||"",email:ae.contactEmail||""}},p=ae=>{if(g.value=[{id:1,courseName:ae.courseName||"",categoryText:ae.courseCategory||"",outline:ae.outline||"",timeLocation:{period:"",weekly:"",location:""},lecturer:ae.teacher||""}],ae.timePlace){const O=ae.timePlace.split(" "),A=O.slice(0,3).join(" "),J=O.slice(3,5).join(" "),Q=O.slice(5).join(" ");g.value[0].timeLocation={period:A,weekly:J,location:Q}}},_=ae=>{ae&&ae.length>0?a.value=ae.map((O,A)=>{let J="";if(O.startDate){const Q=O.startDate.split(" "),Y=Q[0]||"",ue=O.timeRange||Q[1]||"";J=`${Y}
${ue}`}return{id:A+1,sequence:String(A+1).padStart(2,"0"),outline:O.outline||"",datetime:J,hours:O.hours||"",lecturer:O.teacher||""}}):a.value=[]},f=ae=>{ae&&ae.length>0?R.value=ae.map((O,A)=>({id:A+1,sequence:String(A+1),name:O.name||"",education:O.educationCert||""})):R.value=[]},V=ae=>{ae&&ae.length>0?Z.value=ae.map((O,A)=>({id:A+1,item:O.item||"",description:O.description||""})):Z.value=[]},W=async()=>{var ae;if(!u.value){v.showError("參數錯誤","無法獲取審核資料，缺少必要參數"),C.value=!1;return}try{C.value=!0;const O=await cs.getReviewById(u.value);if(O.data&&O.data.code===0){const A=O.data.data;b(A),p(A),_(A.schedules),f(A.teachers),V(A.fees),U.value=A.securityInvestment||"",T.value=A.transferExperience||"",z.value=A.otherRemarks||"",c.value=A.status||0,$.value=A.rejectReason||"",ws(()=>{document.querySelectorAll("textarea").forEach(xe)})}else v.showError("獲取失敗",((ae=O.data)==null?void 0:ae.message)||"獲取審核資料失敗")}catch(O){console.error("獲取審核詳情錯誤:",O),v.showError("獲取錯誤","獲取審核資料時發生錯誤，請稍後再試")}finally{C.value=!1}},H=(ae,O,A)=>{const J=ae.datetime.split(`
`);J[A]=O,ae.datetime=J.join(`
`)},k=()=>{const ae=a.value.length+1;a.value.push({id:ae,sequence:String(ae).padStart(2,"0"),outline:"",datetime:`
`,hours:"",lecturer:""})},D=ae=>{const O=a.value.findIndex(A=>A.id===ae);O!==-1&&a.value.splice(O,1)},j=()=>{const ae=R.value.length+1;R.value.push({id:ae,sequence:String(ae),name:"",education:""})},S=ae=>{const O=R.value.findIndex(A=>A.id===ae);O!==-1&&R.value.splice(O,1)},x=()=>{Z.value.push({id:Z.value.length+1,item:"",description:""})},L=ae=>{const O=Z.value.findIndex(A=>A.id===ae);O!==-1&&Z.value.splice(O,1)},de=ae=>{ae.style.height="auto",ae.style.height=Math.min(ae.scrollHeight,400)+"px"},xe=ae=>{ae.style.height="auto",ae.style.height=Math.max(60,ae.scrollHeight)+"px"},fe=m(!1),ke=async()=>{var ae;if(fe.value)try{const O={id:u.value,schoolName:E.value.name,taxId:E.value.taxId,contactName:E.value.contact,contactPhone:E.value.phone,contactEmail:E.value.email,timePlace:`${g.value[0].timeLocation.period} ${g.value[0].timeLocation.weekly} ${g.value[0].timeLocation.location}`,courseName:g.value[0].courseName,courseCategory:g.value[0].categoryText,outline:g.value[0].outline,teacher:g.value[0].lecturer,securityInvestment:U.value,transferExperience:T.value,otherRemarks:z.value,schedules:a.value.map(J=>{const Q=J.datetime.split(`
`);let Y=Q[0]||"",ue=Q[1]||"";return{outline:J.outline,startDate:Y,timeRange:ue,hours:parseInt(J.hours)||0,teacher:J.lecturer}}),teachers:R.value.map(J=>({name:J.name,educationCert:J.education})),fees:Z.value.map(J=>({item:J.item,description:J.description}))},A=await cs.updateReview(u.value,O);A.data&&A.data.code===0?(fe.value=!1,v.showSuccess("儲存成功","表單資料已成功儲存"),W()):v.showError("儲存失敗",((ae=A.data)==null?void 0:ae.message)||"儲存表單資料失敗")}catch(O){console.error("儲存表單資料錯誤:",O),v.showError("儲存錯誤","儲存表單資料時發生錯誤，請稍後再試")}else fe.value=!0},De=async()=>{try{await v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會遺失。")&&(fe.value=!1,W())}catch(ae){console.error("取消編輯發生錯誤:",ae)}},we=async()=>{var ae;try{if(await v.confirmAsync("確認審核","確定要將此課程審核為不通過嗎？")){const A=await v.promptAsync("請輸入不通過原因","請輸入課程審核不通過的原因：","text");if(A){const J=await cs.updateReviewStatus(u.value,{id:u.value,status:2,rejectReason:A});J.data&&J.data.code===0?(c.value=2,$.value=A,v.showSuccess("審核完成","課程已審核為不通過"),h.push("/search")):v.showError("審核失敗",((ae=J.data)==null?void 0:ae.message)||"審核操作失敗")}else v.showError("審核未完成","請提供不通過原因")}}catch(O){console.error("審核過程發生錯誤:",O),v.showError("審核失敗","審核過程發生錯誤，請稍後再試")}},$e=async()=>{var ae;try{if(await v.confirmAsync("確認審核","確定要將此課程審核為通過嗎？")){const A=await v.promptAsync("請輸入審核通過日期","請輸入課程審核通過的日期 (例如: 2023-01-01)","date");if(!A){v.showError("審核未完成","請提供審核通過日期");return}await ws();const J=await v.promptAsync("請輸入課程編號","請輸入要分配給此課程的編號：","text");if(J){const Q=await cs.updateReviewStatus(u.value,{id:u.value,status:1,courseCode:J,approvedDate:A});Q.data&&Q.data.code===0?(c.value=1,v.showSuccess("審核成功",`課程已成功審核通過，編號: ${J}`),h.push("/search")):v.showError("審核失敗",((ae=Q.data)==null?void 0:ae.message)||"審核操作失敗")}}}catch(O){console.error("審核過程發生錯誤:",O),v.showError("審核失敗","審核過程發生錯誤，請稍後再試")}};return Ee(()=>d.params.id,ae=>{ae&&ae!==u.value&&(u.value=ae,W())}),je(()=>{K(),W()}),(ae,O)=>(t(),s("div",$a,[e("div",Ca,[Ge(ft,{breadcrumbs:[{name:"審核名單",path:"/search"},{name:"審核表單",path:`/initial/${u.value}`}]},null,8,["breadcrumbs"])]),e("div",Ea,[e("div",Sa,[e("div",Da,[O[21]||(O[21]=e("h2",{class:"text-xl"},"學校辦理轉任資訊處理職系專長訓練審查意見表",-1)),e("div",Ma,[o.value.reviewManagementExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:r}," 匯出 Excel ")):G("",!0),fe.value&&o.value.reviewManagementEdit?(t(),s("button",{key:1,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:N,"aria-label":"刪除審核表單"}," 刪除表單 ")):G("",!0),fe.value?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:De,"aria-label":"取消編輯"}," 取消 ")):G("",!0),o.value.reviewManagementEdit?(t(),s("button",{key:3,class:ee(["px-4 py-2",fe.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:ke,"aria-label":fe.value?"儲存編輯":"開始編輯"},l(fe.value?"儲存":"內容編輯"),11,Aa)):G("",!0)])])]),O[22]||(O[22]=e("div",{class:"w-full h-[1px] bg-gray-300"},null,-1))]),e("div",Ia,[e("div",Ra,[e("section",null,[O[28]||(O[28]=e("h3",{class:"text-lg font-bold mb-4"},"一、學校基本資料：",-1)),e("div",Pa,[e("div",Ua,[O[23]||(O[23]=e("label",{class:"w-24",for:"school-name"},"學校名稱:",-1)),P(e("input",{id:"school-name","onUpdate:modelValue":O[0]||(O[0]=A=>E.value.name=A),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!fe.value},null,8,Na),[[te,E.value.name]])]),e("div",Ta,[O[24]||(O[24]=e("label",{class:"w-24",for:"tax-id"},"統一編號:",-1)),P(e("input",{id:"tax-id","onUpdate:modelValue":O[1]||(O[1]=A=>E.value.taxId=A),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!fe.value},null,8,Va),[[te,E.value.taxId]])]),e("div",ja,[O[25]||(O[25]=e("label",{class:"w-24",for:"contact-person"},"聯絡窗口:",-1)),P(e("input",{id:"contact-person","onUpdate:modelValue":O[2]||(O[2]=A=>E.value.contact=A),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!fe.value},null,8,La),[[te,E.value.contact]])]),e("div",Fa,[O[26]||(O[26]=e("label",{class:"w-24",for:"contact-phone"},"聯絡電話:",-1)),P(e("input",{id:"contact-phone","onUpdate:modelValue":O[3]||(O[3]=A=>E.value.phone=A),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!fe.value},null,8,Oa),[[te,E.value.phone]])]),e("div",qa,[O[27]||(O[27]=e("label",{class:"w-24",for:"contact-email"},"電子信箱:",-1)),P(e("input",{id:"contact-email","onUpdate:modelValue":O[4]||(O[4]=A=>E.value.email=A),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!fe.value},null,8,Ba),[[te,E.value.email]])])])]),e("section",null,[O[36]||(O[36]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},"二、本案規劃課程表：")],-1)),e("table",Ha,[O[29]||(O[29]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2 w-[12.5%]",scope:"col"},"課程名稱"),e("th",{class:"border p-2 w-[12.5%]",scope:"col"},"類別"),e("th",{class:"border p-2 w-[40%]",scope:"col"},"課程大綱"),e("th",{class:"border p-2 w-[20%]",scope:"col"},"時間及地點"),e("th",{class:"border p-2 w-[15%]",scope:"col"},"講師")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(g.value,(A,J)=>(t(),s("tr",{key:A.id},[e("td",Wa,[e("div",za,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.courseName),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.courseName=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[5]||(O[5]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,Ka),[[te,A.courseName]])])]),e("td",Ja,[e("div",Ya,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.categoryText),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.categoryText=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none whitespace-pre-wrap",onInput:O[6]||(O[6]=Q=>xe(Q.target)),rows:"3",readonly:!fe.value},null,40,Ga),[[te,A.categoryText]])])]),e("td",Za,[e("div",Qa,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.outline),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.outline=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none whitespace-pre-wrap",onInput:O[7]||(O[7]=Q=>xe(Q.target)),rows:"3",readonly:!fe.value},null,40,Xa),[[te,A.outline]])])]),e("td",eo,[e("div",to,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.timeLocation.period),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.timeLocation.period=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none mb-1",onInput:O[8]||(O[8]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,so),[[te,A.timeLocation.period]])]),e("div",ao,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.timeLocation.weekly),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.timeLocation.weekly=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none mb-1",onInput:O[9]||(O[9]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,oo),[[te,A.timeLocation.weekly]])]),e("div",lo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.timeLocation.location),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.timeLocation.location=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[10]||(O[10]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,no),[[te,A.timeLocation.location]])])]),e("td",ro,[e("div",io,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.lecturer),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.lecturer=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[11]||(O[11]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,uo),[[te,A.lecturer]])])])]))),128))])]),e("div",co,[fe.value?(t(),s("button",{key:0,onClick:k,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增課程規劃欄位"}," 新增欄位 ")):G("",!0)]),e("table",po,[e("thead",null,[O[35]||(O[35]=e("tr",null,[e("th",{colspan:"6",class:"border p-2 bg-[#EEEFE7] text-left",scope:"colgroup"},"課程規劃")],-1)),e("tr",vo,[O[30]||(O[30]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"項次",-1)),O[31]||(O[31]=e("th",{class:"border p-2 w-[55%]",scope:"col"},"課程大綱",-1)),O[32]||(O[32]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"日期及時間",-1)),O[33]||(O[33]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"時數",-1)),O[34]||(O[34]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"講師",-1)),fe.value?(t(),s("th",mo,"操作")):G("",!0)])]),e("tbody",null,[(t(!0),s(X,null,le(a.value,(A,J)=>(t(),s("tr",{key:A.id},[e("td",bo,[P(e("input",{"onUpdate:modelValue":Q=>A.sequence=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,fo),[[te,A.sequence]])]),e("td",yo,[e("div",go,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.outline),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.outline=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[12]||(O[12]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,xo),[[te,A.outline]])])]),e("td",ho,[e("div",wo,[P(e("input",{"onUpdate:modelValue":Q=>A.datetime.split(`
`)[0]=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none mb-1",readonly:!fe.value,onInput:Q=>H(A,Q.target.value,0),placeholder:""},null,40,_o),[[te,A.datetime.split(`
`)[0]]]),P(e("input",{"onUpdate:modelValue":Q=>A.datetime.split(`
`)[1]=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value,onInput:Q=>H(A,Q.target.value,1),placeholder:""},null,40,ko),[[te,A.datetime.split(`
`)[1]]])])]),e("td",$o,[P(e("input",{"onUpdate:modelValue":Q=>A.hours=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,Co),[[te,A.hours]])]),e("td",Eo,[P(e("input",{"onUpdate:modelValue":Q=>A.lecturer=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,So),[[te,A.lecturer]])]),fe.value?(t(),s("td",Do,[fe.value?(t(),s("button",{key:0,onClick:Q=>D(A.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此課程大綱"}," 刪除 ",8,Mo)):G("",!0)])):G("",!0)]))),128))])])]),e("section",null,[e("div",Ao,[O[37]||(O[37]=e("h3",{class:"text-lg font-bold"},"三、師資及課程安排：",-1)),fe.value?(t(),s("button",{key:0,onClick:j,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增師資欄位"}," 新增欄位 ")):G("",!0)]),e("table",Io,[e("thead",null,[e("tr",Ro,[O[38]||(O[38]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"項次",-1)),O[39]||(O[39]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"姓名",-1)),O[40]||(O[40]=e("th",{class:"border p-2 w-[75%]",scope:"col"},"講師學/經歷資料",-1)),fe.value?(t(),s("th",Po,"操作")):G("",!0)])]),e("tbody",null,[(t(!0),s(X,null,le(R.value,(A,J)=>(t(),s("tr",{key:A.id},[e("td",Uo,[P(e("input",{"onUpdate:modelValue":Q=>A.sequence=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,No),[[te,A.sequence]])]),e("td",To,[P(e("input",{"onUpdate:modelValue":Q=>A.name=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,Vo),[[te,A.name]])]),e("td",jo,[e("div",Lo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.education),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.education=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[13]||(O[13]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,Fo),[[te,A.education]])])]),fe.value?(t(),s("td",Oo,[fe.value?(t(),s("button",{key:0,onClick:Q=>S(A.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此師資項目"}," 刪除 ",8,qo)):G("",!0)])):G("",!0)]))),128))])])]),e("section",null,[e("div",Bo,[O[41]||(O[41]=e("h3",{class:"text-lg font-bold"},"四、開課費用：",-1)),fe.value?(t(),s("button",{key:0,onClick:x,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增開課費用欄位"}," 新增欄位 ")):G("",!0)]),e("table",Ho,[e("thead",null,[e("tr",Wo,[O[42]||(O[42]=e("th",{class:"border p-2 w-[47.5%]",scope:"col"},"項目",-1)),O[43]||(O[43]=e("th",{class:"border p-2 w-[47.5%]",scope:"col"},"說明",-1)),fe.value?(t(),s("th",zo,"操作")):G("",!0)])]),e("tbody",null,[(t(!0),s(X,null,le(Z.value,(A,J)=>(t(),s("tr",{key:A.id},[e("td",Ko,[P(e("input",{"onUpdate:modelValue":Q=>A.item=Q,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!fe.value},null,8,Jo),[[te,A.item]])]),e("td",Yo,[e("div",Go,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(A.description),513),P(e("textarea",{"onUpdate:modelValue":Q=>A.description=Q,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:O[14]||(O[14]=Q=>xe(Q.target)),rows:"1",readonly:!fe.value},null,40,Zo),[[te,A.description]])])]),fe.value?(t(),s("td",Qo,[fe.value?(t(),s("button",{key:0,onClick:Q=>L(A.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此開課費用項目"}," 刪除 ",8,Xo)):G("",!0)])):G("",!0)]))),128))])])]),e("section",null,[O[44]||(O[44]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[me("五、學校資安領域課程及專業師資投入數（近三年）："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",el,[fe.value?P((t(),s("textarea",{key:0,"onUpdate:modelValue":O[15]||(O[15]=A=>U.value=A),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入學校資安領域課程及專業師資投入數資料",rows:"4",onInput:O[16]||(O[16]=A=>de(A.target)),"aria-label":"學校資安領域課程及專業師資投入數"},null,544)),[[te,U.value]]):(t(),s("div",tl,l(U.value||"無資料"),1))])]),e("section",null,[O[45]||(O[45]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[me("六、轉任職系開班經驗（近五年）："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",sl,[fe.value?P((t(),s("textarea",{key:0,"onUpdate:modelValue":O[17]||(O[17]=A=>T.value=A),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入轉任職系開班經驗資料",rows:"4",onInput:O[18]||(O[18]=A=>de(A.target)),"aria-label":"轉任職系開班經驗"},null,544)),[[te,T.value]]):(t(),s("div",al,l(T.value||"無資料"),1))])]),e("section",null,[O[46]||(O[46]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[me("七、其他備註事項："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",ol,[fe.value?P((t(),s("textarea",{key:0,"onUpdate:modelValue":O[19]||(O[19]=A=>z.value=A),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入其他備註事項",rows:"4",onInput:O[20]||(O[20]=A=>de(A.target)),"aria-label":"其他備註事項"},null,544)),[[te,z.value]]):(t(),s("div",ll,l(z.value||"無資料"),1))])]),e("section",null,[e("div",nl,[o.value.reviewManagementApprove?(t(),s("button",{key:0,onClick:$e,class:ee(["px-4 py-2 bg-[#4e9875] text-white",y.value?"cursor-not-allowed":"hover:bg-[#3e7a5c]"]),disabled:y.value,"aria-label":"審核通過"}," 審核通過 ",10,rl)):G("",!0),o.value.reviewManagementApprove?(t(),s("button",{key:1,onClick:we,class:ee(["px-4 py-2 bg-red-500 text-white",y.value?"cursor-not-allowed":"hover:bg-red-600"]),disabled:y.value,"aria-label":"審核不通過"}," 審核不通過 ",10,il)):G("",!0),$.value?(t(),s("div",dl," 不通過原因："+l($.value),1)):G("",!0)])])])])]))}},cl=Fe(ul,[["__scopeId","data-v-3abb1b43"]]),nt={getAgencyOptions:()=>be.get("/v1/options/agency"),getSchoolOptions:()=>be.get("/v1/options/school"),getCourseOptions:()=>be.get("/v1/options/course"),getCourseData:M=>be.get("/v1/options/courseData",{params:M}),getAreaOptions:()=>be.get("/v1/options/area"),getCourseMonths:M=>be.get("/v1/options/courseMonth",{params:{year:M}}),getLogFunctionOptions:()=>be.get("/v1/options/logs"),getStudentStatusOptions:()=>be.get("/v1/options/studentStatus"),getConsultationCategoryOptions:()=>be.get("/v1/options/consultationCategories"),getTables:()=>be.get("/v1/options/tables"),getAgencies:M=>be.get("/v1/agency",{params:M}),createAgency:M=>be.post("/v1/agency",M),updateAgency:M=>be.put(`/v1/agency/${M.id}`,M),deleteAgency:M=>be.delete(`/v1/agency/${M}`),getCourseSubjects:()=>be.get("/v1/options/courseSubject")},pl={class:"flex flex-col items-center p-6"},vl={class:"w-full max-w-[1500px]"},ml={class:"w-full max-w-[1500px]"},bl={class:"flex items-center space-x-4"},fl=["value"],yl=["value"],gl=["value"],xl=["value"],hl={class:"relative w-50"},wl={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},_l={key:1,class:"w-full max-w-[1500px]"},kl={class:"w-full border"},$l={class:"bg-[#EEEFE7]"},Cl={class:"border p-2"},El={class:"flex items-center justify-center"},Sl={key:0},Dl={key:1},Ml={key:2},Al={class:"border p-2"},Il={class:"flex items-center justify-center"},Rl={key:0},Pl={key:1},Ul={key:2},Nl={class:"border p-2"},Tl={class:"flex items-center justify-center"},Vl={key:0},jl={key:1},Ll={key:2},Fl={class:"border p-2"},Ol={class:"flex items-center justify-center"},ql={key:0},Bl={key:1},Hl={key:2},Wl={class:"border p-2"},zl={class:"flex items-center justify-center"},Kl={key:0},Jl={key:1},Yl={key:2},Gl={class:"border p-2"},Zl={class:"flex items-center justify-center"},Ql={key:0},Xl={key:1},en={key:2},tn={class:"border p-2"},sn={class:"flex items-center justify-center"},an={key:0},on={key:1},ln={key:2},nn={class:"border p-2 text-center"},rn={class:"border p-2 text-center"},dn={class:"border p-2 text-center"},un={class:"border p-2 text-center"},cn={class:"border p-2 text-center"},pn={class:"border p-2 text-center"},vn={class:"border p-2 text-center"},mn={class:"border p-2 text-center"},bn={class:"border p-2"},fn=["onClick"],yn={key:0},gn={key:0,class:"flex justify-center items-center space-x-2 mt-6"},xn=["disabled"],hn=["onClick"],wn={key:1,class:"px-2"},_n=["disabled"],kn={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},$n={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Cn={class:"mb-4"},En={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Sn={class:"mb-2"},Dn={key:0,class:"text-red-500 text-sm mt-2"},Mn={class:"flex justify-end space-x-2"},An=["disabled"],In=["disabled"],Rn={__name:"SearchList",setup(M){const h=We(),d=m({reviewManagementImport:!1}),u=async()=>{try{const pe=await ot.getSidebarPermissions();pe.data.code===0&&pe.data.message==="success"?(d.value=pe.data.data,console.log("審核名單頁面權限:",d.value)):console.error("獲取權限失敗:",pe.data.message)}catch(pe){console.error("獲取權限錯誤:",pe)}},C=async()=>{try{const pe=await nt.getSchoolOptions();pe.data.code===0&&pe.data.message==="success"?Z.value=pe.data.data:console.error("獲取學校選項失敗:",pe.data.message)}catch(pe){console.error("獲取學校選項錯誤:",pe)}},o=async()=>{try{const pe=await nt.getCourseOptions();if(pe.data.code===0&&pe.data.message==="success")if(pe.data.data&&Array.isArray(pe.data.data)){const ye=[];pe.data.data.forEach(ne=>{ne.items&&Array.isArray(ne.items)?ne.items.forEach(se=>{ye.push({id:se.id,name:se.name,categoryId:ne.id,categoryName:ne.name})}):ye.push({id:ne.id,name:ne.name})}),$.value=ye}else $.value=pe.data.data||[];else console.error("獲取科目選項失敗:",pe.data.message)}catch(pe){console.error("獲取科目選項錯誤:",pe)}},N=async()=>{try{if(!U.value){R.value=Array.from({length:12},(ye,ne)=>({value:String(ne+1),label:`${ne+1}月`}));return}const pe=await nt.getCourseMonths(U.value);pe.data.code===0&&pe.data.message==="success"?(R.value=pe.data.data.map(ye=>({value:String(ye),label:`${ye}月`})),T.value&&!R.value.find(ye=>ye.value===T.value)&&(T.value="")):(console.error("獲取月份選項失敗:",pe.data.message),R.value=Array.from({length:12},(ye,ne)=>({value:String(ne+1),label:`${ne+1}月`})))}catch(pe){console.error("獲取月份選項錯誤:",pe),R.value=Array.from({length:12},(ye,ne)=>({value:String(ne+1),label:`${ne+1}月`}))}},K=m(""),E=m(""),U=m(""),T=m(""),z=m(""),g=m(""),a=Se(()=>{const pe=new Date().getFullYear()-1911,ye=[];for(let ne=pe;ne>=113;ne--)ye.push(ne);return ye}),R=m([]),Z=m([]),$=m([]),c=m(""),y=m("asc"),r=m(1),b=m(20),p=m(0),_=m(!1),f=m([]),V=Se(()=>Math.ceil(p.value/b.value)),W=Se(()=>{const pe=[];if(V.value<=5)for(let ne=1;ne<=V.value;ne++)pe.push(ne);else{pe.push(1);let ne=Math.max(2,r.value-1),se=Math.min(V.value-1,r.value+1);r.value<=3&&(se=Math.min(V.value-1,4)),r.value>=V.value-2&&(ne=Math.max(2,V.value-5+2)),ne>2&&pe.push("...");for(let re=ne;re<=se;re++)pe.push(re);se<V.value-1&&pe.push("..."),pe.push(V.value)}return pe}),H=pe=>({1:"北區",2:"中區",3:"南區",4:"東區",5:"離島"})[pe]||"未知區域",k=pe=>pe||"--",D=pe=>({1:"通過",2:"未通過",3:"審核中"})[pe]||"未知狀態",j=async()=>{var pe,ye;_.value=!0;try{const ne={page:r.value,limit:b.value,keyword:E.value||void 0,status:K.value||void 0,year:U.value||void 0,month:T.value||void 0,school:z.value||void 0,subjectId:g.value||void 0,sortBy:c.value||void 0,sortOrder:y.value||void 0},se=await cs.getReviews(ne);se.data&&se.data.code===0?(f.value=se.data.data.list||[],p.value=se.data.data.totalCount||0,console.log("獲取審核列表成功:",f.value)):(console.error("獲取審核列表失敗:",((pe=se.data)==null?void 0:pe.message)||"未知錯誤"),f.value=[],p.value=0,v.showError("獲取資料失敗",((ye=se.data)==null?void 0:ye.message)||"無法獲取審核列表，請稍後再試"))}catch(ne){console.error("獲取審核列表失敗:",ne),f.value=[],p.value=0,v.showError("獲取資料失敗",ne.message||"無法獲取審核列表，請稍後再試")}finally{_.value=!1}},S=pe=>{c.value===pe?y.value=y.value==="asc"?"desc":"asc":(c.value=pe,y.value="asc"),r.value=1,j()},x=pe=>{pe!=="..."&&(r.value=pe,j())},L=()=>{r.value>1&&(r.value--,j())},de=()=>{r.value<V.value&&(r.value++,j())},xe=()=>{r.value=1,j()};Ee(U,()=>{N()});const fe=()=>{E.value=""},ke=pe=>{h.push({name:"InitialReview",params:{id:pe}})},De=m(!1),we=m(null),$e=m(null),ae=m(!1),O=m(""),A=()=>{De.value=!0,$e.value=null,O.value=""},J=()=>{De.value=!1,$e.value=null,O.value=""},Q=()=>{we.value.click()},Y=pe=>{const ye=pe.target.files[0];if(ye){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(ye.type)&&!ye.name.endsWith(".xlsx")&&!ye.name.endsWith(".xls")&&!ye.name.endsWith(".csv")){O.value="請選擇 .xlsx 檔案",$e.value=null,pe.target.value=null;return}$e.value=ye,O.value=""}},ue=async()=>{var pe,ye,ne;if(!$e.value){O.value="請選擇要上傳的檔案";return}try{ae.value=!0,O.value="";const se=new FormData;se.append("file",$e.value);const re=await cs.importReviews(se);if(re.data&&re.data.code===0){const Te=re.data.message?re.data.message.replace(/\r\n|\n|\r/g,`
`):"課程計畫已成功匯入";J(),v.showSuccess("上傳成功",Te),j()}else O.value=((pe=re.data)==null?void 0:pe.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",O.value)}catch(se){console.error("匯入課程計畫錯誤:",se),O.value=((ne=(ye=se.response)==null?void 0:ye.data)==null?void 0:ne.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",O.value)}finally{ae.value=!1}};return je(()=>{u(),C(),o(),N(),j()}),(pe,ye)=>(t(),s(X,null,[e("div",pl,[e("div",vl,[Ge(ft,{breadcrumbs:[{name:"審核名單",path:"/search"}]})]),e("div",ml,[e("div",bl,[ye[19]||(ye[19]=e("span",null,"查詢:",-1)),P(e("select",{"onUpdate:modelValue":ye[0]||(ye[0]=ne=>K.value=ne),class:"p-2 border border-gray-300 outline-none",onKeyup:Ue(xe,["enter"])},ye[13]||(ye[13]=[e("option",{value:""},"全部",-1),e("option",{value:"1"},"通過",-1),e("option",{value:"2"},"未通過",-1),e("option",{value:"3"},"審核中",-1)]),544),[[Pe,K.value]]),P(e("select",{"onUpdate:modelValue":ye[1]||(ye[1]=ne=>U.value=ne),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[ye[14]||(ye[14]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le(a.value,ne=>(t(),s("option",{key:ne,value:ne},l(ne)+"年 ",9,fl))),128))],544),[[Pe,U.value]]),P(e("select",{"onUpdate:modelValue":ye[2]||(ye[2]=ne=>T.value=ne),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[ye[15]||(ye[15]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(X,null,le(R.value,ne=>(t(),s("option",{key:ne.value,value:ne.value},l(ne.label),9,yl))),128))],544),[[Pe,T.value]]),P(e("select",{"onUpdate:modelValue":ye[3]||(ye[3]=ne=>z.value=ne),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[ye[16]||(ye[16]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(X,null,le(Z.value,ne=>(t(),s("option",{key:ne.id,value:ne.id},l(ne.name),9,gl))),128))],544),[[Pe,z.value]]),P(e("select",{"onUpdate:modelValue":ye[4]||(ye[4]=ne=>g.value=ne),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[ye[17]||(ye[17]=e("option",{value:""},"請選擇科目名稱",-1)),(t(!0),s(X,null,le($.value,ne=>(t(),s("option",{key:ne.id,value:ne.id},l(ne.name),9,xl))),128))],544),[[Pe,g.value]]),e("div",hl,[P(e("input",{"onUpdate:modelValue":ye[5]||(ye[5]=ne=>E.value=ne),type:"text",placeholder:"請輸入訓練單位/課程編碼/課程名稱",class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",onKeyup:Ue(xe,["enter"]),"aria-label":"搜尋關鍵字輸入欄位",readonly:"",onfocus:"this.removeAttribute('readonly');"},null,544),[[te,E.value]]),E.value?(t(),s("button",{key:0,onClick:fe,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},ye[18]||(ye[18]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{onClick:xe,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 搜尋 "),ye[20]||(ye[20]=e("div",{class:"flex-1"},null,-1)),d.value.reviewManagementImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-30",onClick:A}," 匯入課程計畫 ")):G("",!0)])]),ye[32]||(ye[32]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),_.value?(t(),s("div",wl,ye[21]||(ye[21]=[e("div",{class:"text-xl"},"資料載入中...",-1)]))):(t(),s("div",_l,[e("table",kl,[e("thead",null,[e("tr",$l,[ye[29]||(ye[29]=e("th",{class:"border p-2 w-16"},"序",-1)),e("th",Cl,[e("div",El,[ye[22]||(ye[22]=me(" 區域 ")),e("button",{onClick:ye[6]||(ye[6]=ne=>S("area")),class:"ml-1 focus:outline-none"},[c.value==="area"&&y.value==="asc"?(t(),s("span",Sl,"▲")):c.value==="area"&&y.value==="desc"?(t(),s("span",Dl,"▼")):(t(),s("span",Ml,"⇅"))])])]),e("th",Al,[e("div",Il,[ye[23]||(ye[23]=me(" 訓練單位 ")),e("button",{onClick:ye[7]||(ye[7]=ne=>S("schoolName")),class:"ml-1 focus:outline-none"},[c.value==="schoolName"&&y.value==="asc"?(t(),s("span",Rl,"▲")):c.value==="schoolName"&&y.value==="desc"?(t(),s("span",Pl,"▼")):(t(),s("span",Ul,"⇅"))])])]),e("th",Nl,[e("div",Tl,[ye[24]||(ye[24]=me(" 課程編碼 ")),e("button",{onClick:ye[8]||(ye[8]=ne=>S("courseCode")),class:"ml-1 focus:outline-none"},[c.value==="courseCode"&&y.value==="asc"?(t(),s("span",Vl,"▲")):c.value==="courseCode"&&y.value==="desc"?(t(),s("span",jl,"▼")):(t(),s("span",Ll,"⇅"))])])]),e("th",Fl,[e("div",Ol,[ye[25]||(ye[25]=me(" 課程名稱 ")),e("button",{onClick:ye[9]||(ye[9]=ne=>S("courseName")),class:"ml-1 focus:outline-none"},[c.value==="courseName"&&y.value==="asc"?(t(),s("span",ql,"▲")):c.value==="courseName"&&y.value==="desc"?(t(),s("span",Bl,"▼")):(t(),s("span",Hl,"⇅"))])])]),e("th",Wl,[e("div",zl,[ye[26]||(ye[26]=me(" 開課日期 ")),e("button",{onClick:ye[10]||(ye[10]=ne=>S("startDate")),class:"ml-1 focus:outline-none"},[c.value==="startDate"&&y.value==="asc"?(t(),s("span",Kl,"▲")):c.value==="startDate"&&y.value==="desc"?(t(),s("span",Jl,"▼")):(t(),s("span",Yl,"⇅"))])])]),e("th",Gl,[e("div",Zl,[ye[27]||(ye[27]=me(" 結業日期 ")),e("button",{onClick:ye[11]||(ye[11]=ne=>S("endDate")),class:"ml-1 focus:outline-none"},[c.value==="endDate"&&y.value==="asc"?(t(),s("span",Ql,"▲")):c.value==="endDate"&&y.value==="desc"?(t(),s("span",Xl,"▼")):(t(),s("span",en,"⇅"))])])]),e("th",tn,[e("div",sn,[ye[28]||(ye[28]=me(" 審核狀態 ")),e("button",{onClick:ye[12]||(ye[12]=ne=>S("status")),class:"ml-1 focus:outline-none"},[c.value==="status"&&y.value==="asc"?(t(),s("span",an,"▲")):c.value==="status"&&y.value==="desc"?(t(),s("span",on,"▼")):(t(),s("span",ln,"⇅"))])])]),ye[30]||(ye[30]=e("th",{class:"border p-2"},"審核內容",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(f.value,(ne,se)=>(t(),s("tr",{key:ne.id},[e("td",nn,l((r.value-1)*b.value+se+1),1),e("td",rn,l(H(ne.area)),1),e("td",dn,l(ne.schoolName),1),e("td",un,l(ne.courseCode),1),e("td",cn,l(ne.courseName),1),e("td",pn,l(k(ne.startDate)),1),e("td",vn,l(k(ne.endDate)),1),e("td",mn,l(D(ne.status)),1),e("td",bn,[e("button",{onClick:re=>ke(ne.id),class:"px-4 py-1 bg-[#3e4346] text-white hover:bg-[#4e5356] mr-2"}," 審核表單 ",8,fn)])]))),128)),f.value.length===0?(t(),s("tr",yn,ye[31]||(ye[31]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])]),V.value>0?(t(),s("div",gn,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:r.value===1,onClick:L}," 上一頁 ",8,xn),(t(!0),s(X,null,le(W.value,ne=>(t(),s(X,{key:ne},[ne!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":ne===r.value}]),onClick:se=>x(ne)},l(ne),11,hn)):(t(),s("span",wn,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:r.value===V.value,onClick:de}," 下一頁 ",8,_n)])):G("",!0)]))]),De.value?(t(),s("div",kn,[e("div",$n,[ye[33]||(ye[33]=e("h3",{class:"text-lg font-medium mb-4"},"匯入課程計畫",-1)),e("div",Cn,[e("div",En,[e("input",{type:"file",ref_key:"fileInput",ref:we,class:"hidden",onChange:Y,accept:".xlsx,.xls,.csv"},null,544),e("p",Sn,l($e.value?$e.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:Q,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),O.value?(t(),s("p",Dn,l(O.value),1)):G("",!0)]),e("div",Mn,[e("button",{onClick:J,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:ae.value}," 取消 ",8,An),e("button",{onClick:ue,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!$e.value||ae.value},l(ae.value?"上傳中...":"上傳"),9,In)])])])):G("",!0)],64))}},Pn=Fe(Rn,[["__scopeId","data-v-a56f880f"]]),Zt={getCourses:M=>be.get("/v1/course",{params:M}),getCourseById:M=>be.get(`/v1/course/${M}`),updateCourse:(M,h)=>be.put(`/v1/course/${M}`,h),getAbsenceHistory:M=>be.get("/v1/absence",{params:M}),exportCourses:M=>be.post("/v1/course/export",M,{responseType:"blob"}),updateCourseStatus:(M,h)=>be.put(`/v1/course/status/${M}`,h),checkCourseImport:M=>be.post("/v1/course/importCheck",M,{headers:{"Content-Type":"multipart/form-data"}}),importCourses:M=>be.post("/v1/course/import",M,{headers:{"Content-Type":"multipart/form-data"}}),deleteCourse:M=>be.delete(`/v1/course/${M}`),addCourseStudent:M=>be.post("/v1/course",M),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),importSurvey:M=>be.post("/v1/survey",M,{headers:{"Content-Type":"multipart/form-data"}})},Un={class:"flex flex-col items-center p-6"},Nn={class:"w-full max-w-[1500px]"},Tn={class:"w-full max-w-[1500px]"},Vn={class:"flex items-center space-x-4 mb-4"},jn={class:"relative w-72"},Ln={class:"w-full max-w-[1500px]"},Fn={class:"flex items-center space-x-4"},On=["value"],qn=["value"],Bn=["value"],Hn=["value"],Wn=["value"],zn={class:"w-full max-w-[1500px]"},Kn={key:0,class:"flex justify-center items-center py-10"},Jn={key:1,class:"w-full border-collapse"},Yn={class:"bg-[#EEEFE7]"},Gn={class:"border p-2"},Zn={class:"flex flex-col items-center"},Qn={key:0},Xn={key:1},er={key:2},tr={class:"border p-2"},sr={class:"flex flex-col items-center"},ar={key:0},or={key:1},lr={key:2},nr={class:"border p-2"},rr={class:"flex flex-col items-center"},ir={key:0},dr={key:1},ur={key:2},cr={class:"border p-2"},pr={class:"flex flex-col items-center"},vr={key:0},mr={key:1},br={key:2},fr={class:"border p-2"},yr={class:"flex flex-col items-center"},gr={key:0},xr={key:1},hr={key:2},wr={class:"border p-2"},_r={class:"flex flex-col items-center"},kr={key:0},$r={key:1},Cr={key:2},Er={class:"border p-2"},Sr={class:"flex flex-col items-center"},Dr={key:0},Mr={key:1},Ar={key:2},Ir={class:"border p-2"},Rr={class:"flex flex-col items-center"},Pr={key:0},Ur={key:1},Nr={key:2},Tr={class:"border p-2"},Vr={class:"flex flex-col items-center"},jr={key:0},Lr={key:1},Fr={key:2},Or={class:"border p-2"},qr={class:"flex flex-col items-center"},Br={key:0},Hr={key:1},Wr={key:2},zr={class:"border p-2"},Kr={class:"flex flex-col items-center"},Jr={key:0},Yr={key:1},Gr={key:2},Zr={class:"border p-2"},Qr={class:"flex flex-col items-center"},Xr={key:0},ei={key:1},ti={key:2},si=["onClick"],ai={class:"border p-2 text-center"},oi={class:"border p-2 text-center"},li={class:"border p-2 text-center"},ni={class:"border p-2 text-center"},ri={class:"border p-2 text-center"},ii=["onUpdate:modelValue","onChange"],di={class:"border p-2 text-center"},ui={class:"border p-2 text-center"},ci={class:"border p-2 text-center"},pi={class:"border p-2 text-center"},vi={class:"border p-2 text-center"},mi={class:"border p-2 text-center"},bi={key:0},fi={key:2,class:"flex justify-center items-center space-x-2 mt-6"},yi=["disabled"],gi=["onClick"],xi={key:1,class:"px-2"},hi=["disabled"],wi={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_i={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},ki={class:"mb-4"},$i={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Ci={class:"mb-2"},Ei={key:0,class:"text-red-500 text-sm mt-2"},Si={class:"flex justify-end space-x-2"},Di=["disabled"],Mi={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ai={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Ii={class:"mb-4"},Ri={class:"space-y-3"},Pi=20,Ui={__name:"Course",setup(M){const h=We(),d=rt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),E=m(""),U=m([]),T=m([]),z=m([]),g=m([{value:"",label:"請選擇課程類型"},{value:"1",label:"資安職能課程"},{value:"2",label:"學分課程"}]),a=m(""),R=m("asc"),Z=Se(()=>{const i=new Date().getFullYear()-1911,n=[];for(let w=i;w>=113;w--)n.push(w);return n}),$=m(1),c=m(1),y=m(0),r=m(!1),b=m([]),p=Se(()=>c.value<=5?_(c.value):f($.value,c.value,5)),_=i=>{const n=[];for(let w=1;w<=i;w++)n.push(w);return n},f=(i,n,w)=>{const ce=[],he=Math.floor(w/2);let Ve=i-he,Qe=i+he;Ve<1?(Ve=1,Qe=w):Qe>n&&(Qe=n,Ve=n-w+1),V(ce,Ve);for(let et=Ve;et<=Qe;et++)ce.push(et);return W(ce,Qe,n),ce},V=(i,n)=>{n<=1||(i.push(1),n>2&&i.push("..."))},W=(i,n,w)=>{n>=w||(n<w-1&&i.push("..."),i.push(w))},H=m({courseDataCreate:!1,courseDataImport:!1,courseDataExport:!1}),k=async()=>{try{const i=await ot.getSidebarPermissions();i.data.code===0&&i.data.message==="success"?(H.value=i.data.data,console.log("課程頁面權限:",H.value)):console.error("獲取權限失敗:",i.data.message)}catch(i){console.error("獲取權限錯誤:",i)}},D=async()=>{try{const i=await nt.getSchoolOptions();i.data.code===0&&i.data.message==="success"?U.value=i.data.data:console.error("獲取學校選項失敗:",i.data.message)}catch(i){console.error("獲取學校選項錯誤:",i)}},j=async()=>{try{const i=await nt.getCourseOptions();if(i.data.code===0&&i.data.message==="success")if(i.data.data&&Array.isArray(i.data.data)){const n=[];i.data.data.forEach(w=>{w.items&&Array.isArray(w.items)?w.items.forEach(ce=>{n.push({id:ce.id,name:ce.name,categoryId:w.id,categoryName:w.name})}):n.push({id:w.id,name:w.name})}),T.value=n}else T.value=i.data.data||[];else console.error("獲取科目選項失敗:",i.data.message)}catch(i){console.error("獲取科目選項錯誤:",i)}},S=async()=>{try{if(!C.value){z.value=Array.from({length:12},(n,w)=>({value:String(w+1),label:`${w+1}月`}));return}const i=await nt.getCourseMonths(C.value);i.data.code===0&&i.data.message==="success"?(z.value=i.data.data.map(n=>({value:String(n),label:`${n}月`})),K.value&&!z.value.find(n=>n.value===K.value)&&(K.value="")):(console.error("獲取月份選項失敗:",i.data.message),z.value=Array.from({length:12},(n,w)=>({value:String(w+1),label:`${w+1}月`})))}catch(i){console.error("獲取月份選項錯誤:",i),z.value=Array.from({length:12},(n,w)=>({value:String(w+1),label:`${w+1}月`}))}},x=async()=>{var i;try{r.value=!0,console.log("開始獲取課程列表...");const n={page:$.value,limit:Pi,year:C.value||null,school:o.value||null,subjectId:N.value||null,courseType:E.value||null,month:K.value||null,keyword:u.value||null,sortBy:a.value,sortOrder:R.value};console.log("API請求參數:",n);const w=await Zt.getCourses(n);console.log("API回應:",w.data),w.data.code===0?w.data.data&&w.data.data.result?(b.value=w.data.data.result||[],y.value=w.data.data.totalCount||0,c.value=w.data.data.totalPage||1,console.log("獲取成功，總數:",y.value)):(console.error("API回應缺少 result 欄位"),b.value=[],y.value=0,c.value=0):(console.error("獲取課程列表失敗:",w.data.message),b.value=[],y.value=0,c.value=0,v.showError("載入失敗",((i=w.data)==null?void 0:i.message)||"無法獲取課程列表，請稍後再試"))}catch(n){console.error("獲取課程列表錯誤:",n),b.value=[],y.value=0,c.value=0,v.showError("載入失敗",n.message||"無法獲取課程列表，請稍後再試")}finally{console.log("加載狀態設為false"),r.value=!1}},L=()=>{u.value=""},de=()=>{$.value=1,x()},xe=()=>{$.value=1,x()},fe=i=>{i!==$.value&&($.value=i)},ke=()=>{$.value>1&&$.value--},De=()=>{$.value<c.value&&$.value++},we=(i,n="default")=>{if(i===-1||i==="-1")return"缺";if(n==="school"&&U.value.length>0){const w=U.value.find(ce=>ce.id===i);return w?w.name:i}return n==="status"&&{1:"授課中",2:"已結業",3:"已取消",4:"未開課"}[i]||i},$e=i=>{a.value===i?R.value=R.value==="asc"?"desc":"asc":(a.value=i,R.value="asc"),$.value=1,x()},ae=i=>{if(i){const n={page:$.value,year:C.value,school:o.value,subjectId:N.value,courseType:E.value,month:K.value,searchKeyword:u.value,sortBy:a.value,sortOrder:R.value};h.replace({path:h.currentRoute.value.path,query:n});const w=Object.entries(n).reduce((ce,[he,Ve])=>(Ve!==void 0&&Ve!==""&&(ce[he]=Ve),ce),{});console.log("從課程頁面跳轉到課程編輯頁面，保留原始頁碼:",$.value),h.push({path:`/course-edit/${i}`,query:{...w,from:"course"}})}},O=()=>{h.push("/add-course-student")},A=()=>{const{page:i,year:n,school:w,searchKeyword:ce,subjectId:he,month:Ve,courseType:Qe,sortBy:et,sortOrder:Ct}=d.query;i&&($.value=parseInt(i)),n&&(C.value=n),w&&(o.value=w),he&&(N.value=he),Qe&&(E.value=Qe),Ve&&(K.value=Ve),ce&&(ce.value=ce),et&&(a.value=et),Ct&&(R.value=Ct)};Ee(()=>d.query,(i,n)=>{if(JSON.stringify(i)!==JSON.stringify(n)&&(console.log("URL參數變更，恢復狀態:",i),Object.keys(i).length>0)){A();const w=n.page!==i.page&&i.page,ce=n.year!==i.year||n.school!==i.school||n.subjectId!==i.subjectId||n.month!==i.month||n.courseType!==i.courseType||n.searchKeyword!==i.searchKeyword||n.sortBy!==i.sortBy||n.sortOrder!==i.sortOrder;(w||ce)&&x()}},{deep:!0}),Ee(C,()=>{S()}),Ee($,i=>{h.replace({path:h.currentRoute.value.path,query:{...d.query,page:i.toString()}}),x()}),je(()=>{D(),j(),S(),k(),A(),x()});const J=m(!1),Q=()=>{J.value=!0},Y=()=>{J.value=!1},ue=async i=>{if(i)await pe(i);else try{const n=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(n===null||n==="")return;const w=await Zt.confirmPassword(n);if(w.data.code!==0){v.showError("密碼錯誤",w.data.message||"管理員密碼驗證失敗");return}const ce=await v.promptAsync("請輸入檔案密碼","請為匯出的檔案設置密碼","password");if(ce===null||ce==="")return;await pe(i,ce)}catch(n){console.error("密碼驗證或檔案匯出過程錯誤:",n),v.showError("匯出失敗","驗證過程中發生錯誤，請稍後再試");return}Y()},pe=async(i,n="")=>{try{const w={year:C.value||null,school:o.value||null,subjectId:N.value||null,courseType:E.value||null,month:K.value||null,keyword:u.value||null,isHidden:i,password:n},ce=await Zt.exportCourses(w),he=ce.headers["content-type"];if(!he||!he.includes("spreadsheetml.sheet"))try{const lt=new Blob([ce.data],{type:"application/json"}),dt=await new Response(lt).text(),At=JSON.parse(dt);console.error("匯出課程失敗：伺服器返回錯誤：",At),v.showError("匯出失敗",At.message||"匯出過程中發生錯誤，請稍後再試");return}catch(lt){console.error("匯出課程失敗：無法解析回應內容",lt),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const Ve=new Blob([ce.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Qe=window.URL.createObjectURL(Ve),et=document.createElement("a");et.href=Qe;const Ct=i?"隱蔽加密版":"無隱蔽版",ct=`課程資料_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}_${Ct}.xlsx`;et.setAttribute("download",ct),document.body.appendChild(et),et.click(),document.body.removeChild(et),window.URL.revokeObjectURL(Qe),v.showSuccess("匯出成功","課程資料已成功匯出為 Excel 檔案")}catch(w){if(console.error("匯出課程失敗:",w),w.response&&w.response.data){const ce=w.response.data;v.showError("匯出失敗",ce.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},ye=async(i,n)=>{var w;try{const ce=await Zt.updateCourseStatus(i,{id:i,status:parseInt(n)});ce.data&&ce.data.code===0?v.showSuccess("更新成功","課程狀態已更新"):v.showError("更新失敗",((w=ce.data)==null?void 0:w.message)||"更新課程狀態時發生錯誤")}catch(ce){console.error("更新課程狀態錯誤:",ce),v.showError("更新失敗","更新課程狀態時發生錯誤，請稍後再試")}},ne=m(!1),se=m(null),re=m(null),Te=m(!1),Be=m(""),ve=()=>{ne.value=!0,re.value=null,Be.value=""},ie=()=>{ne.value=!1,re.value=null,Be.value=""},_e=()=>{se.value.click()},Le=i=>{const n=i.target.files[0];if(n){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(n.type)&&!n.name.endsWith(".xlsx")&&!n.name.endsWith(".xls")&&!n.name.endsWith(".csv")){Be.value="請選擇 .xlsx 檔案",re.value=null,i.target.value=null;return}re.value=n,Be.value=""}},ge=async()=>{var i,n,w;if(!re.value){Be.value="請選擇要上傳的檔案";return}try{Te.value=!0,Be.value="";const ce=new FormData;ce.append("file",re.value);const he=await Zt.checkCourseImport(ce);if(he.data&&he.data.code===0)await q(ce);else{const Ve=((i=he.data)==null?void 0:i.message)||"部分課程已存在，是否確定要繼續匯入？";await v.confirmAsync("確認匯入",Ve)?await q(ce):Te.value=!1}}catch(ce){console.error("上傳課程檔案錯誤:",ce),Be.value=((w=(n=ce.response)==null?void 0:n.data)==null?void 0:w.message)||"上傳過程中發生錯誤，請稍後再試",v.showError("上傳失敗",Be.value),Te.value=!1}},q=async i=>{var n,w,ce;try{const he=await Zt.importCourses(i);if(he.data&&he.data.code===0){const Ve=he.data.message?he.data.message.replace(/\r\n|\n|\r/g,"<br>"):"課程資料已成功匯入";v.showInfo("上傳成功",Ve);const Qe=()=>{ie(),x(),document.removeEventListener("info_close",Qe)};document.addEventListener("info_close",Qe)}else Be.value=((n=he.data)==null?void 0:n.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",Be.value)}catch(he){console.error("匯入課程檔案錯誤:",he),Be.value=((ce=(w=he.response)==null?void 0:w.data)==null?void 0:ce.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",Be.value)}finally{Te.value=!1}};return(i,n)=>(t(),s(X,null,[e("div",Un,[e("div",Nn,[Ge(ft,{breadcrumbs:[{name:"課程內容",path:"/course"}]})]),e("div",Tn,[e("div",Vn,[n[22]||(n[22]=e("span",null,"關鍵字查詢:",-1)),e("div",jn,[P(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=w=>u.value=w),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"訓練單位/課程名稱",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ue(de,["enter"]),"aria-label":"關鍵字搜尋輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:L,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},n[21]||(n[21]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:de}," 搜尋 "),n[23]||(n[23]=e("div",{class:"flex-grow"},null,-1)),H.value.courseDataImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:ve}," 匯入課程名單 ")):G("",!0),H.value.courseDataCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:O}," 新增課程名單 ")):G("",!0)])]),e("div",Ln,[e("div",Fn,[n[28]||(n[28]=e("span",null,"查詢班級:",-1)),P(e("select",{"onUpdate:modelValue":n[1]||(n[1]=w=>C.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[n[24]||(n[24]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le(Z.value,w=>(t(),s("option",{key:w,value:w},l(w)+"年 ",9,On))),128))],544),[[Pe,C.value]]),P(e("select",{"onUpdate:modelValue":n[2]||(n[2]=w=>K.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[n[25]||(n[25]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(X,null,le(z.value,w=>(t(),s("option",{key:w.value,value:w.value},l(w.label),9,qn))),128))],544),[[Pe,K.value]]),P(e("select",{"onUpdate:modelValue":n[3]||(n[3]=w=>o.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[n[26]||(n[26]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(X,null,le(U.value,w=>(t(),s("option",{key:w.id,value:w.id},l(w.name),9,Bn))),128))],544),[[Pe,o.value]]),P(e("select",{"onUpdate:modelValue":n[4]||(n[4]=w=>N.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[n[27]||(n[27]=e("option",{value:""},"請選擇科目名稱",-1)),(t(!0),s(X,null,le(T.value,w=>(t(),s("option",{key:w.id,value:w.id},l(w.name),9,Hn))),128))],544),[[Pe,N.value]]),P(e("select",{"onUpdate:modelValue":n[5]||(n[5]=w=>E.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(xe,["enter"])},[(t(!0),s(X,null,le(g.value,w=>(t(),s("option",{key:w.value,value:w.value},l(w.label),9,Wn))),128))],544),[[Pe,E.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:xe}," 搜尋 "),n[29]||(n[29]=e("div",{class:"flex-grow"},null,-1)),H.value.courseDataExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:Q}," 匯出 Excel ")):G("",!0)])]),n[45]||(n[45]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",zn,[r.value?(t(),s("div",Kn,n[30]||(n[30]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Jn,[e("thead",null,[e("tr",Yn,[e("th",Gn,[e("div",Zn,[n[31]||(n[31]=e("span",null,"課程編號",-1)),e("button",{onClick:n[6]||(n[6]=w=>$e("courseCode")),class:"mt-1 focus:outline-none"},[a.value==="courseCode"&&R.value==="asc"?(t(),s("span",Qn,"▲")):a.value==="courseCode"&&R.value==="desc"?(t(),s("span",Xn,"▼")):(t(),s("span",er,"⇅"))])])]),e("th",tr,[e("div",sr,[n[32]||(n[32]=e("span",null,"訓練單位",-1)),e("button",{onClick:n[7]||(n[7]=w=>$e("school")),class:"mt-1 focus:outline-none"},[a.value==="school"&&R.value==="asc"?(t(),s("span",ar,"▲")):a.value==="school"&&R.value==="desc"?(t(),s("span",or,"▼")):(t(),s("span",lr,"⇅"))])])]),e("th",nr,[e("div",rr,[n[33]||(n[33]=e("span",null,"課程名稱",-1)),e("button",{onClick:n[8]||(n[8]=w=>$e("courseName")),class:"mt-1 focus:outline-none"},[a.value==="courseName"&&R.value==="asc"?(t(),s("span",ir,"▲")):a.value==="courseName"&&R.value==="desc"?(t(),s("span",dr,"▼")):(t(),s("span",ur,"⇅"))])])]),e("th",cr,[e("div",pr,[n[34]||(n[34]=e("span",null,"開課日期",-1)),e("button",{onClick:n[9]||(n[9]=w=>$e("startDate")),class:"mt-1 focus:outline-none"},[a.value==="startDate"&&R.value==="asc"?(t(),s("span",vr,"▲")):a.value==="startDate"&&R.value==="desc"?(t(),s("span",mr,"▼")):(t(),s("span",br,"⇅"))])])]),e("th",fr,[e("div",yr,[n[35]||(n[35]=e("span",null,"結業日期",-1)),e("button",{onClick:n[10]||(n[10]=w=>$e("endDate")),class:"mt-1 focus:outline-none"},[a.value==="endDate"&&R.value==="asc"?(t(),s("span",gr,"▲")):a.value==="endDate"&&R.value==="desc"?(t(),s("span",xr,"▼")):(t(),s("span",hr,"⇅"))])])]),e("th",wr,[e("div",_r,[n[36]||(n[36]=e("span",null,"課程狀態",-1)),e("button",{onClick:n[11]||(n[11]=w=>$e("status")),class:"mt-1 focus:outline-none"},[a.value==="status"&&R.value==="asc"?(t(),s("span",kr,"▲")):a.value==="status"&&R.value==="desc"?(t(),s("span",$r,"▼")):(t(),s("span",Cr,"⇅"))])])]),e("th",Er,[e("div",Sr,[n[37]||(n[37]=e("span",null,"報名人數",-1)),e("button",{onClick:n[12]||(n[12]=w=>$e("registered")),class:"mt-1 focus:outline-none"},[a.value==="registered"&&R.value==="asc"?(t(),s("span",Dr,"▲")):a.value==="registered"&&R.value==="desc"?(t(),s("span",Mr,"▼")):(t(),s("span",Ar,"⇅"))])])]),e("th",Ir,[e("div",Rr,[n[38]||(n[38]=e("span",null,"開課人數",-1)),e("button",{onClick:n[13]||(n[13]=w=>$e("classSize")),class:"mt-1 focus:outline-none"},[a.value==="classSize"&&R.value==="asc"?(t(),s("span",Pr,"▲")):a.value==="classSize"&&R.value==="desc"?(t(),s("span",Ur,"▼")):(t(),s("span",Nr,"⇅"))])])]),e("th",Tr,[e("div",Vr,[n[39]||(n[39]=e("span",null,"結訓人數",-1)),e("button",{onClick:n[14]||(n[14]=w=>$e("graduates")),class:"mt-1 focus:outline-none"},[a.value==="graduates"&&R.value==="asc"?(t(),s("span",jr,"▲")):a.value==="graduates"&&R.value==="desc"?(t(),s("span",Lr,"▼")):(t(),s("span",Fr,"⇅"))])])]),e("th",Or,[e("div",qr,[n[40]||(n[40]=e("span",null,"結訓比率",-1)),e("button",{onClick:n[15]||(n[15]=w=>$e("graduationRate")),class:"mt-1 focus:outline-none"},[a.value==="graduationRate"&&R.value==="asc"?(t(),s("span",Br,"▲")):a.value==="graduationRate"&&R.value==="desc"?(t(),s("span",Hr,"▼")):(t(),s("span",Wr,"⇅"))])])]),e("th",zr,[e("div",Kr,[n[41]||(n[41]=e("span",null,"問卷人數",-1)),e("button",{onClick:n[16]||(n[16]=w=>$e("respondents")),class:"mt-1 focus:outline-none"},[a.value==="respondents"&&R.value==="asc"?(t(),s("span",Jr,"▲")):a.value==="respondents"&&R.value==="desc"?(t(),s("span",Yr,"▼")):(t(),s("span",Gr,"⇅"))])])]),e("th",Zr,[e("div",Qr,[n[42]||(n[42]=e("span",null,"課程滿意度",-1)),e("button",{onClick:n[17]||(n[17]=w=>$e("satisfactionRate")),class:"mt-1 focus:outline-none"},[a.value==="satisfactionRate"&&R.value==="asc"?(t(),s("span",Xr,"▲")):a.value==="satisfactionRate"&&R.value==="desc"?(t(),s("span",ei,"▼")):(t(),s("span",ti,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(b.value,w=>(t(),s("tr",{key:w.id,class:"hover:bg-gray-100 cursor-pointer",onClick:ce=>ae(w.id)},[e("td",ai,l(we(w.courseCode)),1),e("td",oi,l(we(w.school,"school")),1),e("td",li,l(we(w.courseName)),1),e("td",ni,l(we(w.startDate)),1),e("td",ri,l(we(w.endDate)),1),e("td",{class:"border p-2 text-center",onClick:n[18]||(n[18]=es(()=>{},["stop"]))},[P(e("select",{class:"p-1 border border-gray-300 outline-none w-full bg-white","onUpdate:modelValue":ce=>w.status=ce,onChange:ce=>ye(w.id,w.status)},n[43]||(n[43]=[e("option",{value:"1"},"授課中",-1),e("option",{value:"2"},"已結業",-1),e("option",{value:"3"},"已取消",-1),e("option",{value:"4"},"未開課",-1)]),40,ii),[[Pe,w.status]])]),e("td",di,l(we(w.registered)),1),e("td",ui,l(we(w.classSize)),1),e("td",ci,l(we(w.graduates)),1),e("td",pi,l(we(w.graduationRate))+"%",1),e("td",vi,l(we(w.respondents)),1),e("td",mi,l(we(w.satisfactionRate))+"%",1)],8,si))),128)),b.value.length===0?(t(),s("tr",bi,n[44]||(n[44]=[e("td",{colspan:"12",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])),!r.value&&b.value.length>0?(t(),s("div",fi,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===1,onClick:ke}," 上一頁 ",8,yi),(t(!0),s(X,null,le(p.value,w=>(t(),s(X,{key:w},[w!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":w===$.value}]),onClick:ce=>fe(w)},l(w),11,gi)):(t(),s("span",xi,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===c.value,onClick:De}," 下一頁 ",8,hi)])):G("",!0)])]),ne.value?(t(),s("div",wi,[e("div",_i,[n[46]||(n[46]=e("h3",{class:"text-lg font-medium mb-4"},"匯入課程",-1)),e("div",ki,[e("div",$i,[e("input",{type:"file",ref_key:"fileInput",ref:se,class:"hidden",onChange:Le,accept:".xlsx,.xls,.csv"},null,544),e("p",Ci,l(re.value?re.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:_e,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),Be.value?(t(),s("p",Ei,l(Be.value),1)):G("",!0)]),e("div",Si,[e("button",{onClick:ie,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 "),e("button",{onClick:ge,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!re.value||Te.value},l(Te.value?"上傳中...":"上傳"),9,Di)])])])):G("",!0),J.value?(t(),s("div",Mi,[e("div",Ai,[n[47]||(n[47]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",Ii,[e("div",Ri,[e("button",{onClick:n[19]||(n[19]=w=>ue(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:n[20]||(n[20]=w=>ue(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:Y,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):G("",!0)],64))}},Ni=Fe(Ui,[["__scopeId","data-v-5325d679"]]),Ti={class:"flex flex-col items-center p-6"},Vi={class:"w-full max-w-[1500px] mb-6"},ji={class:"flex items-center space-x-4"},Li=["value"],Fi=["value"],Oi=["disabled"],qi=["value"],Bi={class:"w-full max-w-[1500px] mb-6 text-sm"},Hi={class:"w-full max-w-[1500px]"},Wi={key:0,class:"flex justify-center items-center py-10"},zi={key:1,class:"w-full border"},Ki=["onClick"],Ji={class:"border p-2 text-center"},Yi={class:"border p-2 text-center"},Gi={class:"border p-2 text-center"},Zi={class:"border p-2 text-center"},Qi={class:"border p-2 text-center"},Xi={class:"border p-2 text-center"},ed={class:"border p-2 text-center"},td={class:"border p-2 text-center"},sd={key:2,class:"text-center py-10 text-gray-500"},ad={key:3,class:"flex justify-center items-center space-x-2 mt-6"},od=["disabled"],ld=["onClick"],nd=["disabled"],rd=20,id={__name:"Attendance",setup(M){const h=We(),d=rt(),u=m(1),C=m(""),o=m(""),N=m(""),K=m([]),E=m([]),U=m([]),T=m(!1),z=m({school:"",courseName:"",startDate:"",endDate:"",trainStudent:0,graduates:0}),g=m(0),a=m(0),R=Se(()=>{const W=new Date().getFullYear()-1911,H=[];for(let k=W;k>=113;k--)H.push(k);return H}),Z=Se(()=>C.value&&o.value),$=async()=>{try{const W=await nt.getSchoolOptions();W.data.code===0&&W.data.message==="success"?K.value=W.data.data:console.error("獲取學校選項失敗:",W.data.message)}catch(W){console.error("獲取學校選項錯誤:",W)}},c=async()=>{try{const W={year:C.value,school:o.value},H=await nt.getCourseData(W);H.data.code===0&&H.data.message==="success"?E.value=H.data.data:(console.error("獲取課程選項失敗:",H.data.message),E.value=[])}catch(W){console.error("獲取課程選項錯誤:",W),E.value=[]}},y=()=>{N.value="",E.value=[],C.value&&o.value&&c()};Ee(N,W=>{W&&(u.value=1,r())});const r=async()=>{var W,H;try{T.value=!0;const k={page:u.value,limit:rd,id:N.value},D=await Zt.getAbsenceHistory(k);if(((W=D==null?void 0:D.data)==null?void 0:W.code)===0){const{school:j,courseName:S,startDate:x,endDate:L,trainStudent:de,graduates:xe,list:fe}=D.data.data.result;g.value=D.data.data.totalCount,a.value=D.data.data.totalPage,z.value={school:j,courseName:S,startDate:x,endDate:L,trainStudent:de,graduates:xe},U.value=fe.map(ke=>({id:ke.id,studentId:ke.studentId===-1||ke.studentId==="-1"?"缺":ke.studentId,name:ke.name,absenceHours:ke.absenceHours===-1||ke.absenceHours==="-1"?"缺":ke.absenceHours,attendanceHours:ke.classHours===-1||ke.classHours==="-1"?"缺":ke.classHours,satisfaction:ke.satisfaction===-1||ke.satisfaction==="-1"?"缺":ke.satisfaction,credits:ke.earnedCredits===-1||ke.earnedCredits==="-1"?"缺":ke.earnedCredits,grade:ke.grade===-1||ke.grade==="-1"?"缺":ke.grade,certificateNo:ke.certificateNumber===-1||ke.certificateNumber==="-1"?"缺":ke.certificateNumber}))}else console.error("獲取出席資料失敗:",((H=D==null?void 0:D.data)==null?void 0:H.message)||"未知錯誤"),U.value=[],g.value=0,a.value=0}catch(k){console.error("獲取出席資料錯誤:",k),U.value=[],g.value=0,a.value=0}finally{T.value=!1}};Ee(u,()=>{N.value&&r()});const b=async()=>{d.query.page&&(u.value=parseInt(d.query.page,10)||1),d.query.year&&(C.value=d.query.year),d.query.school&&(o.value=d.query.school,C.value&&o.value&&await c()),d.query.course&&(N.value=d.query.course,N.value&&r())};je(async()=>{await $(),await b()});const p=W=>{u.value=W},_=()=>{u.value>1&&u.value--},f=()=>{u.value<a.value&&u.value++},V=W=>{if(W){const H={from:"attendance",page:u.value,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0};h.push({name:"Single",params:{id:W},query:H})}};return(W,H)=>(t(),s("div",Ti,[H[9]||(H[9]=e("div",{class:"w-full max-w-[1500px]-w-[1500px]-w-[1500px] mb-6"},[e("h2",{class:"text-2xl font-bold"},"出缺勤")],-1)),e("div",Vi,[e("div",ji,[H[6]||(H[6]=e("span",null,"查詢班級:",-1)),P(e("select",{"onUpdate:modelValue":H[0]||(H[0]=k=>C.value=k),class:"p-2 border border-gray-300 outline-none w-40",onChange:y},[H[3]||(H[3]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le(R.value,k=>(t(),s("option",{key:k,value:k},l(k)+"年 ",9,Li))),128))],544),[[Pe,C.value]]),P(e("select",{"onUpdate:modelValue":H[1]||(H[1]=k=>o.value=k),class:"p-2 border border-gray-300 outline-none w-40",onChange:y},[H[4]||(H[4]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(X,null,le(K.value,k=>(t(),s("option",{key:k.id,value:k.id},l(k.name),9,Fi))),128))],544),[[Pe,o.value]]),P(e("select",{"onUpdate:modelValue":H[2]||(H[2]=k=>N.value=k),class:"p-2 border border-gray-300 outline-none w-40",disabled:!Z.value},[H[5]||(H[5]=e("option",{value:""},"請選擇課程名稱",-1)),(t(!0),s(X,null,le(E.value,k=>(t(),s("option",{key:k.id,value:k.id},l(k.name),9,qi))),128))],8,Oi),[[Pe,N.value]])])]),e("div",Bi,[e("div",null,"訓練單位: "+l(z.value.school),1),e("div",null,"訓練課程: "+l(z.value.courseName),1),e("div",null,"訓練日期: "+l(z.value.startDate)+"~"+l(z.value.endDate),1),e("div",null,"訓練人數: "+l(z.value.trainStudent)+" 結訓人數: "+l(z.value.graduates),1)]),e("div",Hi,[T.value?(t(),s("div",Wi,H[7]||(H[7]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):U.value.length>0?(t(),s("table",zi,[H[8]||(H[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"學號"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"缺課時數"),e("th",{class:"border p-2"},"上課時數"),e("th",{class:"border p-2"},"課程滿意度"),e("th",{class:"border p-2"},"取得學分數"),e("th",{class:"border p-2"},"成績"),e("th",{class:"border p-2"},"證書編號")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(U.value,k=>(t(),s("tr",{key:k.id,class:"cursor-pointer hover:bg-gray-100",onClick:D=>V(k.id)},[e("td",Ji,l(k.studentId),1),e("td",Yi,l(k.name),1),e("td",Gi,l(k.absenceHours),1),e("td",Zi,l(k.attendanceHours),1),e("td",Qi,l(k.satisfaction),1),e("td",Xi,l(k.credits),1),e("td",ed,l(k.grade),1),e("td",td,l(k.certificateNo),1)],8,Ki))),128))])])):(t(),s("div",sd," 無符合條件的資料 ")),a.value>0?(t(),s("div",ad,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===1,onClick:_}," 上一頁 ",8,od),(t(!0),s(X,null,le(a.value,k=>(t(),s("button",{key:k,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":k===u.value}]),onClick:D=>p(k)},l(k),11,ld))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===a.value,onClick:f}," 下一頁 ",8,nd)])):G("",!0)])]))}},dd=Fe(id,[["__scopeId","data-v-a2536600"]]),Rs={getVisitHistory:M=>be.get("/v1/visitHistory",{params:M}),getVisitHistoryById:M=>be.get(`/v1/visitHistory/${M}`),createVisitHistory:M=>be.post("/v1/visitHistory",M),updateVisitHistory:(M,h)=>be.put(`/v1/visitHistory/${M}`,h),exportVisitHistory:M=>be.get(`/v1/visitHistory/export/${M}`,{responseType:"blob"}),exportVisitHistoryTemp:M=>be.post("/v1/visitHistory/export",M,{responseType:"blob"})},ud={class:"flex flex-col items-center p-6"},cd={class:"w-full max-w-[1500px]"},pd={class:"w-full max-w-[1500px]"},vd={class:"flex items-center space-x-4"},md=["value"],bd={value:""},fd=["value"],yd={value:""},gd=["value"],xd=["disabled"],hd={class:"w-full max-w-[1500px]"},wd={class:"flex justify-between items-center mb-4"},_d={class:"overflow-auto"},kd={class:"w-full border-collapse"},$d={class:"bg-[#EEEFE7]"},Cd={class:"border p-2"},Ed={class:"flex items-center justify-center"},Sd={key:0},Dd={key:1},Md={key:2},Ad={class:"border p-2"},Id={class:"flex items-center justify-center"},Rd={key:0},Pd={key:1},Ud={key:2},Nd={class:"border p-2"},Td={class:"flex items-center justify-center"},Vd={key:0},jd={key:1},Ld={key:2},Fd={class:"border p-2"},Od={class:"flex items-center justify-center"},qd={key:0},Bd={key:1},Hd={key:2},Wd={class:"border p-2"},zd={class:"flex items-center justify-center"},Kd={key:0},Jd={key:1},Yd={key:2},Gd={class:"border p-2"},Zd={class:"flex items-center justify-center"},Qd={key:0},Xd={key:1},eu={key:2},tu={class:"border p-2"},su={class:"flex items-center justify-center"},au={key:0},ou={key:1},lu={key:2},nu=["onClick"],ru={class:"border p-2 text-center"},iu={class:"border p-2 text-center"},du={class:"border p-2 text-center"},uu={class:"border p-2 text-center"},cu={class:"border p-2 text-center"},pu={class:"border p-2 text-center"},vu={class:"border p-2 text-center"},mu={key:0},bu={colspan:"7",class:"border p-4 text-center"},fu={key:0,class:"flex justify-center items-center space-x-2 mt-6"},yu=["disabled"],gu=["onClick"],xu={key:1,class:"px-2"},hu=["disabled"],wu={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_u={class:"bg-white p-6 rounded-lg w-[500px]"},ku={class:"space-y-4"},$u={class:"flex items-center"},Cu={class:"flex items-center"},Eu={__name:"Supervision",setup(M){const h=We(),d=rt(),u=m([]),C=m([]),o=m(!1),N=m(!1),K=m(!1),E=m(1),U=m(10),T=m(1),z=m(0),g=m(""),a=m("asc");m(!1);const R=m(!1),Z=m({label:"",value:""}),$=Se(()=>{const $e=new Date().getFullYear()-1911,ae=[];for(let O=$e;O>=113;O--)ae.push(O);return ae}),c=m([{id:1,label:"訪視單位:",value:"健行學校財團法人健行科技大學"},{id:2,label:"訪視日期:",value:"114/02/17"},{id:3,label:"訪視課程:",value:"資通安全管理"},{id:4,label:"訪視時間:",value:"20:00 (24小時制)"},{id:5,label:"訪視人員:",value:"王○明"}]),y=m([]);m([{id:1,filename:"",fileUrl:""},{id:2,filename:"",fileUrl:""},{id:3,filename:"",fileUrl:""}]);const r=m(""),b=m(""),p=m(""),_=Se(()=>{const $e=[];if(T.value<=5)for(let O=1;O<=T.value;O++)$e.push(O);else{$e.push(1);let O=Math.max(2,E.value-1),A=Math.min(T.value-1,E.value+1);E.value<=3&&(A=Math.min(4,T.value-1)),E.value>=T.value-2&&(O=Math.max(2,T.value-3)),O>2&&$e.push("...");for(let J=O;J<=A;J++)$e.push(J);A<T.value-1&&$e.push("..."),$e.push(T.value)}return $e}),f=async()=>{var $e;try{K.value=!0;const ae={page:E.value,limit:U.value,sortBy:g.value||void 0,sortOrder:a.value||void 0};r.value&&r.value!=="all"&&(ae.year=r.value),b.value&&(ae.school=b.value),p.value&&(ae.course=p.value);const O=await Rs.getVisitHistory(ae);O.data&&O.data.code===0?(y.value=O.data.data.list||[],z.value=O.data.data.totalCount||0,T.value=Math.ceil(z.value/U.value)||1):(console.error("獲取訪視資料失敗:",O.data),v.showError("載入失敗",(($e=O.data)==null?void 0:$e.message)||"獲取訪視資料失敗"),y.value=[],z.value=0,T.value=1)}catch(ae){console.error("獲取訪視資料失敗:",ae),v.showError("載入失敗",ae.message||"獲取訪視資料失敗"),y.value=[],z.value=0,T.value=1}finally{K.value=!1}},V=$e=>{const ae=u.value.find(O=>O.value===$e);return ae?ae.label:$e},W=$e=>{const ae=C.value.find(O=>O.value===$e);return ae?ae.label:$e},H=async()=>{try{o.value=!0;const $e=await nt.getSchoolOptions();$e.data&&$e.data.code===0&&Array.isArray($e.data.data)?u.value=$e.data.data.map(ae=>({value:ae.id,label:ae.name})):(console.error("學校資料格式不正確:",$e.data),u.value=[])}catch($e){console.error("獲取學校列表失敗:",$e),u.value=[]}finally{o.value=!1}},k=async $e=>{if(!$e){C.value=[],p.value="";return}try{N.value=!0;const ae=await nt.getCourseData({school:$e});ae.data&&ae.data.code===0&&Array.isArray(ae.data.data)?C.value=ae.data.data.map(O=>({value:O.id,label:O.name})):(console.error("課程資料格式不正確:",ae.data),C.value=[])}catch(ae){console.error("獲取課程列表失敗:",ae),p.value="",C.value=[]}finally{N.value=!1}};Ee(()=>b.value,$e=>{$e?k($e):(C.value=[],p.value="")}),Ee(E,()=>{f()});const D=$e=>{$e!==E.value&&(E.value=$e)},j=()=>{E.value>1&&E.value--},S=()=>{E.value<T.value&&E.value++},x=$e=>{g.value===$e?a.value=a.value==="asc"?"desc":"asc":(g.value=$e,a.value="asc"),E.value=1,f()},L=()=>{if(!Z.value.label){v.showError("新增欄位失敗","請輸入欄位名稱");return}c.value.push({id:c.value.length+1,label:Z.value.label+":",value:Z.value.value}),R.value=!1},de=()=>{R.value=!1},xe=$e=>{$e?h.push({path:"/checklist-edit",query:{id:$e}}):h.push({path:"/checklist-edit"})},fe=()=>{h.push({name:"Checklist"})},ke=()=>{d.query.page&&(E.value=parseInt(d.query.page,10)||1),d.query.year&&(r.value=d.query.year),d.query.school&&(b.value=d.query.school),d.query.course&&(p.value=d.query.course),d.query.sortBy&&(g.value=d.query.sortBy),d.query.sortOrder&&(a.value=d.query.sortOrder)},De=m({visitCreate:!1}),we=async()=>{try{const $e=await ot.getSidebarPermissions();$e.data.code===0&&$e.data.message==="success"?(De.value=$e.data.data,console.log("訪視督課頁面權限:",De.value)):console.error("獲取權限失敗:",$e.data.message)}catch($e){console.error("獲取權限錯誤:",$e)}};return je(()=>{ke(),f(),H(),we()}),($e,ae)=>(t(),s("div",ud,[e("div",cd,[Ge(ft,{breadcrumbs:[{name:"訪視督課",path:"/supervision"}]})]),e("div",pd,[e("div",vd,[ae[13]||(ae[13]=e("span",{id:"queryLabelSpan"},"查詢班級:",-1)),P(e("select",{id:"selectedYear","onUpdate:modelValue":ae[0]||(ae[0]=O=>r.value=O),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ue(f,["enter"])},[ae[12]||(ae[12]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le($.value,O=>(t(),s("option",{key:O,value:O},l(O)+"年 ",9,md))),128))],544),[[Pe,r.value]]),P(e("select",{id:"selectedSchool","onUpdate:modelValue":ae[1]||(ae[1]=O=>b.value=O),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ue(f,["enter"])},[e("option",bd,l(o.value?"載入中...":"請選擇訓練單位"),1),(t(!0),s(X,null,le(u.value,O=>(t(),s("option",{key:O.value,value:O.value},l(O.label),9,fd))),128))],544),[[Pe,b.value]]),P(e("select",{id:"selectedCourse","onUpdate:modelValue":ae[2]||(ae[2]=O=>p.value=O),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ue(f,["enter"])},[e("option",yd,l(b.value?N.value?"載入中...":"請選擇課程名稱":"請先選擇訓練單位"),1),(t(!0),s(X,null,le(C.value,O=>(t(),s("option",{key:O.value,value:O.value},l(O.label),9,gd))),128))],544),[[Pe,p.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:f,disabled:K.value}," 搜尋 ",8,xd)])]),ae[25]||(ae[25]=e("div",{class:"w-full max-w-[1500px] h-[1px] bg-gray-300 my-6"},null,-1)),e("div",hd,[e("div",wd,[ae[14]||(ae[14]=e("h2",{class:"text-2xl font-bold"},"訪查紀錄",-1)),De.value.visitCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:fe}," 新增訪視 ")):G("",!0)]),e("div",_d,[e("table",kd,[e("thead",null,[e("tr",$d,[e("th",Cd,[e("div",Ed,[ae[15]||(ae[15]=me(" 訪查單位 ")),e("button",{onClick:ae[3]||(ae[3]=O=>x("school")),class:"ml-1 focus:outline-none"},[g.value==="school"&&a.value==="asc"?(t(),s("span",Sd,"▲")):g.value==="school"&&a.value==="desc"?(t(),s("span",Dd,"▼")):(t(),s("span",Md,"⇅"))])])]),e("th",Ad,[e("div",Id,[ae[16]||(ae[16]=me(" 訪查日期 ")),e("button",{onClick:ae[4]||(ae[4]=O=>x("visitDate")),class:"ml-1 focus:outline-none"},[g.value==="visitDate"&&a.value==="asc"?(t(),s("span",Rd,"▲")):g.value==="visitDate"&&a.value==="desc"?(t(),s("span",Pd,"▼")):(t(),s("span",Ud,"⇅"))])])]),e("th",Nd,[e("div",Td,[ae[17]||(ae[17]=me(" 訪查課程 ")),e("button",{onClick:ae[5]||(ae[5]=O=>x("course")),class:"ml-1 focus:outline-none"},[g.value==="course"&&a.value==="asc"?(t(),s("span",Vd,"▲")):g.value==="course"&&a.value==="desc"?(t(),s("span",jd,"▼")):(t(),s("span",Ld,"⇅"))])])]),e("th",Fd,[e("div",Od,[ae[18]||(ae[18]=me(" 訪查時間 ")),e("button",{onClick:ae[6]||(ae[6]=O=>x("visitStartTime")),class:"ml-1 focus:outline-none"},[g.value==="visitStartTime"&&a.value==="asc"?(t(),s("span",qd,"▲")):g.value==="visitStartTime"&&a.value==="desc"?(t(),s("span",Bd,"▼")):(t(),s("span",Hd,"⇅"))])])]),e("th",Wd,[e("div",zd,[ae[19]||(ae[19]=me(" 訪查人員 ")),e("button",{onClick:ae[7]||(ae[7]=O=>x("visitor")),class:"ml-1 focus:outline-none"},[g.value==="visitor"&&a.value==="asc"?(t(),s("span",Kd,"▲")):g.value==="visitor"&&a.value==="desc"?(t(),s("span",Jd,"▼")):(t(),s("span",Yd,"⇅"))])])]),e("th",Gd,[e("div",Zd,[ae[20]||(ae[20]=me(" 訪查方式 ")),e("button",{onClick:ae[8]||(ae[8]=O=>x("visitMethod")),class:"ml-1 focus:outline-none"},[g.value==="visitMethod"&&a.value==="asc"?(t(),s("span",Qd,"▲")):g.value==="visitMethod"&&a.value==="desc"?(t(),s("span",Xd,"▼")):(t(),s("span",eu,"⇅"))])])]),e("th",tu,[e("div",su,[ae[21]||(ae[21]=me(" 查核得分 ")),e("button",{onClick:ae[9]||(ae[9]=O=>x("grade")),class:"ml-1 focus:outline-none"},[g.value==="grade"&&a.value==="asc"?(t(),s("span",au,"▲")):g.value==="grade"&&a.value==="desc"?(t(),s("span",ou,"▼")):(t(),s("span",lu,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(y.value,O=>(t(),s("tr",{key:O.id,class:"hover:bg-gray-100 cursor-pointer",onClick:A=>xe(O.id)},[e("td",ru,l(V(O.school)),1),e("td",iu,l(O.visitDate),1),e("td",du,l(W(O.course)),1),e("td",uu,l(`${O.visitStartTime}-${O.visitEndTime}`),1),e("td",cu,l(O.visitor),1),e("td",pu,l(O.visitMethod===1?"線上訪查":"實地訪查"),1),e("td",vu,l(O.grade),1)],8,nu))),128)),y.value.length===0?(t(),s("tr",mu,[e("td",bu,l(K.value?"載入中...":"無符合條件的資料"),1)])):G("",!0)])])]),!K.value&&y.value.length>0?(t(),s("div",fu,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===1,onClick:j}," 上一頁 ",8,yu),(t(!0),s(X,null,le(_.value,O=>(t(),s(X,{key:O},[O!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":O===E.value}]),onClick:A=>D(O)},l(O),11,gu)):(t(),s("span",xu,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===T.value,onClick:S}," 下一頁 ",8,hu)])):G("",!0)]),R.value?(t(),s("div",wu,[e("div",_u,[ae[24]||(ae[24]=e("h3",{class:"text-xl font-bold mb-4"},"新增欄位",-1)),e("div",ku,[e("div",$u,[ae[22]||(ae[22]=e("label",{class:"w-24 text-right mr-4",for:"newFieldLabel"},"欄位名稱:",-1)),P(e("input",{id:"newFieldLabel","onUpdate:modelValue":ae[10]||(ae[10]=O=>Z.value.label=O),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none",placeholder:"請輸入欄位名稱"},null,512),[[te,Z.value.label]])]),e("div",Cu,[ae[23]||(ae[23]=e("label",{class:"w-24 text-right mr-4",for:"newFieldValue"},"預設值:",-1)),P(e("input",{id:"newFieldValue","onUpdate:modelValue":ae[11]||(ae[11]=O=>Z.value.value=O),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none",placeholder:"請輸入預設值（選填）"},null,512),[[te,Z.value.value]])])]),e("div",{class:"flex justify-end space-x-4 mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded",onClick:de}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",onClick:L}," 確認 ")])])])):G("",!0)]))}},Su=Fe(Eu,[["__scopeId","data-v-0f4db9dc"]]),Lt={getStudents:(M={})=>(M.page&&(M.page=Number(M.page)),M.limit?M.limit=Number(M.limit):M.limit=20,M.keyword===""&&delete M.keyword,console.log("studentApi.getStudents 參數:",M),console.log("studentApi.getStudents 關鍵字參數:",M.keyword),be.get("/v1/student",{params:M})),getStudentById:M=>be.get(`/v1/student/${M}`),updateStudent:M=>be.put(`/v1/student/${M.id}`,M),getLearnHistory:(M={})=>{const h={};return M.page?h.page=Number(M.page):h.page=1,M.limit?h.limit=Number(M.limit):h.limit=20,M.keyword&&M.keyword.trim()!==""&&(h.keyword=M.keyword.trim()),M.sortBy&&(h.sortBy=M.sortBy),M.sortOrder&&(h.sortOrder=M.sortOrder),console.log("studentApi.getLearnHistory 參數:",h),be.get("/v1/learnHistory",{params:h})},creditCertification:M=>be.post("/v1/creditCertification",M),uploadFiles:(M,h,d)=>{const u=new FormData;return M.forEach(C=>{u.append("files",C)}),h&&u.append("fileName",h),d&&u.append("folderName",d),be.post("/v1/upload/files",u,{headers:{"Content-Type":"multipart/form-data"}})},exportStudents:M=>be.post("/v1/student/export",M,{responseType:"blob"}),addStudent:M=>be.post("/v1/student",M),getLearnHistoryById:M=>be.get(`/v1/learnHistory/${M}`),updateLearnHistory:(M,h)=>be.put(`/v1/learnHistory/${M}`,h),getCreditList:(M={})=>(M.page&&(M.page=Number(M.page)),M.limit&&(M.limit=Number(M.limit)),console.log("studentApi.getCreditList 參數:",M),be.get("/v1/creditCertification",{params:M})),updateCreditStatus:(M,h)=>be.put(`/v1/creditCertification/status/${M}`,{id:Number(M),status:Number(h)}),importCreditCertification:M=>be.post("/v1/creditCertification/import",M,{headers:{"Content-Type":"multipart/form-data"}}),importStudents:M=>be.post("/v1/student/import",M,{headers:{"Content-Type":"multipart/form-data"}}),deleteStudent:M=>be.delete(`/v1/student/${M}`),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),getCreditCertificationById:M=>be.get(`/v1/creditCertification/${M}`),updateCreditCertification:(M,h)=>be.put(`/v1/creditCertification/${M}`,h),exportCertificate:M=>be.get(`/v1/student/export/word/${M}`,{responseType:"blob"})},is={getUserList:(M={})=>(M.page&&(M.page=Number(M.page)),M.limit?M.limit=Number(M.limit):M.limit=20,console.log("userApi.getUserList 參數:",M),be.get("/v1/user",{params:M})),getRoleOptions:()=>be.get("/v1/options/roles"),createUser:M=>be.post("/v1/user",M),updateUser:(M,h)=>(h.unit!==void 0&&(h.unit=String(h.unit)),h.title!==void 0&&(h.title=String(h.title)),console.log("發送更新用戶數據:",h),be.put(`/v1/user/${M}`,h)),deleteUser:M=>be.delete(`/v1/user/${M}`),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),updatePassword:M=>be.put("/v1/user/resetPwd",{password:M.oldPassword,newPassword:M.newPassword}),getProfile:()=>be.get("/v1/user/info"),updateProfile:(M,h)=>be.put(`/v1/user/info/${M}`,h)},Du={class:"flex flex-col items-center p-6"},Mu={class:"w-full max-w-[1500px] flex justify-between items-center"},Au={class:"w-full max-w-[1500px] flex justify-end mb-6"},Iu={class:"flex space-x-4"},Ru={key:2,class:"flex items-center space-x-2"},Pu={key:0,class:"flex items-center space-x-2"},Uu={class:"font-bold text-[#4e9875]"},Nu=["aria-label"],Tu=["aria-label"],Vu={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},ju={key:1,class:"w-full max-w-[1500px] grid grid-cols-3 gap-6"},Lu={class:"space-y-6"},Fu={class:"flex items-center"},Ou=["readonly"],qu=["value"],Bu={class:"flex items-center"},Hu=["readonly"],Wu={class:"flex items-center"},zu=["value"],Ku={class:"flex items-center"},Ju=["readonly"],Yu={class:"flex items-center"},Gu=["disabled"],Zu=["value"],Qu={class:"flex items-center"},Xu=["readonly"],ec=["value"],tc={class:"flex items-center"},sc=["readonly"],ac=["value"],oc={class:"space-y-6"},lc={class:"flex items-center"},nc=["readonly"],rc=["value"],ic={class:"flex items-center"},dc=["readonly"],uc=["value"],cc={class:"flex items-center"},pc=["readonly"],vc=["value"],mc={class:"flex items-center"},bc=["readonly"],fc=["value"],yc={class:"flex items-center"},gc=["readonly"],xc=["value"],hc={key:0,class:"flex items-center"},wc=["readonly"],_c=["value"],kc={class:"space-y-6"},$c={class:"flex items-center"},Cc=["disabled"],Ec={class:"flex items-center"},Sc=["readonly"],Dc=["value"],Mc={class:"flex items-center"},Ac=["readonly"],Ic=["value"],Rc={class:"flex items-center"},Pc=["readonly"],Uc=["value"],Nc={class:"flex items-center"},Tc=["readonly"],Vc=["value"],jc={key:0,class:"flex items-center"},Lc=["readonly"],Fc=["value"],Oc={class:"w-full max-w-[1500px] mb-6"},qc={class:"w-full"},Bc={key:1,id:"remark-display",class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-labelledby":"remark-label"},Hc={key:0,class:"text-right text-xs text-gray-500 mt-1"},Wc={class:"w-full max-w-[1500px]"},zc={class:"w-full border-collapse","aria-labelledby":"course-records-heading"},Kc={key:0},Jc=["onClick","aria-label"],Yc={class:"border p-2 text-center"},Gc={class:"border p-2 text-center"},Zc={class:"border p-2 text-center"},Qc={class:"border p-2 text-center"},Xc={class:"border p-2 text-center"},ep={class:"border p-2 text-center"},tp={class:"border p-2 text-center"},sp={class:"border p-2 text-center"},ap={class:"border p-2 text-center"},op={class:"border p-2 text-center"},lp={class:"w-full border-collapse","aria-labelledby":"credit-recognition-heading"},np={key:0},rp=["onClick","aria-label"],ip={class:"border p-2 text-center"},dp={class:"border p-2 text-center"},up={class:"border p-2 text-center"},cp={class:"border p-2 text-center"},pp={class:"border p-2 text-center"},vp={class:"border p-2 text-center"},mp={class:"border p-2 text-center"},bp={class:"border p-2 text-center"},fp={class:"border p-2 text-center"},yp={class:"border p-2 text-center"},gp={__name:"Single",setup(M){const h=We(),d=rt(),u=m(!1),C=m(!0),o=m(null),N=m({id:0,name:"",gender:0,idNumber:"",subAgencyName:"",unitName:"",phone:"",officePhone:"",officeEmail:"",email:"",subsidyCategory:1,cancelDate:"",cancelReason:"",bankCode:"",branchCode:"",bankAccount:"",remark:"",histories:[],birthday:"",address:"",registrationDate:"",creditCertifications:[],number:""});m("history");const K=m({}),E=Se({get:()=>{var q;return((q=N.value.subsidyCategory)==null?void 0:q.toString())||"1"},set:q=>{N.value.subsidyCategory=parseInt(q)}}),U=m([]),T=m([]),z=Se({get:()=>N.value.parentAgencyId,set:q=>{N.value.parentAgencyId=parseInt(q)}});Se(()=>{if(N.value.parentAgencyId===-1||N.value.parentAgencyId===0||!N.value.parentAgencyId)return"無上級機關";const q=T.value.find(i=>i.id===N.value.parentAgencyId);return q?q.name:"無上級機關"});const g=Se({get:()=>{var q;return((q=N.value.gender)==null?void 0:q.toString())||"1"},set:q=>{N.value.gender=parseInt(q)}}),a=q=>q===-1||q==="-1"?"缺":q,R=q=>{switch(q){case 1:return"男";case 2:return"女";case 3:return"其他";default:return"缺"}};Ee(E,(q,i)=>{if(q==="4"&&i!=="4"&&!N.value.cancelDate){const n=new Date,w=n.getFullYear()-1911,ce=String(n.getMonth()+1).padStart(2,"0"),he=String(n.getDate()).padStart(2,"0");N.value.cancelDate=`${w}/${ce}/${he}`}});const Z=m({studentUpdate:!1,studentDelete:!1,studentExportWord:!1}),$=async()=>{try{const q=await ot.getSidebarPermissions();q.data.code===0&&q.data.message==="success"?(Z.value=q.data.data,console.log("學員詳情頁面權限:",Z.value)):console.error("獲取權限失敗:",q.data.message)}catch(q){console.error("獲取權限錯誤:",q)}},c=async()=>{if(u.value){if(!y())return;await v.confirmAsync("確認儲存","確定要儲存修改嗎？")&&_()}else K.value=JSON.parse(JSON.stringify(N.value)),u.value=!0},y=()=>r()?b()&&p()&&$e()&&Be():!1,r=()=>N.value.phone&&!De(N.value.phone)?(v.showError("貼心提醒","行動電話格式不正確，請輸入09開頭的10位數字"),!1):N.value.email&&!we(N.value.email)?(v.showError("貼心提醒","私人郵件格式不正確，請輸入有效的電子郵件格式"),!1):N.value.officeEmail&&!we(N.value.officeEmail)?(v.showError("貼心提醒","公務郵件格式不正確，請輸入有效的電子郵件格式"),!1):!0,b=()=>{if(E.value==="4"){if(!N.value.cancelDate)return v.showError("貼心提醒","請輸入取消日期"),!1;if(!J(N.value.cancelDate))return v.showError("貼心提醒","取消日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1;if(!N.value.cancelReason)return v.showError("貼心提醒","請輸入取消原因"),!1}return!0},p=()=>N.value.bankCode&&!ae(N.value.bankCode)?(v.showError("貼心提醒","銀行代碼格式不正確，請輸入3-7位數字"),!1):N.value.branchCode&&!O(N.value.branchCode)?(v.showError("貼心提醒","分行代碼格式不正確，請輸入3-4位數字"),!1):N.value.bankAccount&&!A(N.value.bankAccount)?(v.showError("貼心提醒","銀行帳號格式不正確，請輸入8-16位數字，可包含連字符號"),!1):!0,_=()=>{W(N.value)},f=async()=>{await v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會丟失。")&&V()},V=()=>{N.value=JSON.parse(JSON.stringify(K.value)),u.value=!1},W=async q=>{try{C.value=!0;const i=H(q);console.log("準備更新的學生資料:",i),await k(i)}catch(i){j(i)}finally{C.value=!1}},H=q=>({id:q.id,name:q.name,gender:q.gender,idNumber:q.idNumber,subAgencyName:q.subAgencyName===""||q.subAgencyName==="缺"||q.subAgencyName==="-1"?null:q.subAgencyName,parentAgencyId:q.parentAgencyId===-1?null:q.parentAgencyId,unitName:q.unitName===""||q.unitName==="缺"||q.unitName==="-1"?null:q.unitName,phone:q.phone,officePhone:q.officePhone===""||q.officePhone==="缺"||q.officePhone==="-1"?null:q.officePhone,officeEmail:q.officeEmail===""||q.officeEmail==="缺"||q.officeEmail==="-1"?null:q.officeEmail,email:q.email===""||q.email==="缺"||q.email==="-1"?null:q.email,subsidyCategory:q.subsidyCategory,cancelDate:q.subsidyCategory===4&&q.cancelDate||null,cancelReason:q.subsidyCategory===4&&q.cancelReason||null,bankCode:q.bankCode===""||q.bankCode==="缺"||q.bankCode==="-1"?null:q.bankCode,branchCode:q.branchCode===""||q.branchCode==="缺"||q.branchCode==="-1"?null:q.branchCode,bankAccount:q.bankAccount===""||q.bankAccount==="缺"||q.bankAccount==="-1"?null:q.bankAccount,remark:q.remark||"",birthday:q.birthday||null,address:q.address||null,registrationDate:q.registrationDate||null}),k=async q=>{try{const i=await Lt.updateStudent(q);i.data.code===0?(v.showSuccess("儲存成功","學生資料已成功儲存"),S()):(D(i.data),await S())}catch(i){console.error("API 調用出錯:",i),v.showError("儲存失敗","連接伺服器發生錯誤，請稍後再試"),await S()}},D=q=>{let i=q.message;v.showError("儲存失敗","保存學生資料失敗: "+i),console.error("保存學生資料失敗:",q.message)},j=async q=>{v.showError("儲存失敗","保存學生資料錯誤，請稍後再試"),console.error("保存學生資料錯誤:",q),q.response&&(console.error("錯誤響應數據:",q.response.data),q.response.data&&q.response.data.message&&v.showError("儲存失敗",q.response.data.message)),await S()},S=async()=>{try{C.value=!0;const q=d.params.id;if(!q){console.error("未提供學生ID");return}const i=await Lt.getStudentById(q);i.data.code===0?Le(i.data.data.result):ge(new Error("獲取學生詳細資料失敗"),i.data)}catch(q){ge(q,q.response)}finally{C.value=!1}},x=async()=>{try{const q=await nt.getAgencyOptions();q.data.code===0&&q.data.message==="success"?U.value=q.data.data:console.error("獲取機關選項失敗:",q.data.message)}catch(q){console.error("獲取機關選項錯誤:",q)}},L=async()=>{try{const q=await nt.getAgencyOptions();q.data.code===0&&q.data.message==="success"?(T.value=q.data.data,N.value.id&&z.value&&!T.value.some(i=>i.id===z.value)&&T.value.push({id:z.value,name:"無上級機關"})):console.error("獲取上級機關選項失敗:",q.data.message)}catch(q){console.error("獲取上級機關選項錯誤:",q)}};Ee(()=>d.params.id,q=>{q&&S()}),je(()=>{S(),x(),L(),$(),ws(()=>{o.value&&re()})}),Ee(u,q=>{q&&ws(()=>{o.value&&re()})});const de=()=>{if(d.query.from){let q={};switch(d.query.from){case"information":q={path:"/student/information",query:{page:d.query.page,year:d.query.year,school:d.query.school,course:d.query.course,agency:d.query.agency,area:d.query.area,searchKeyword:d.query.searchKeyword}};break;case"history":q={path:"/history",query:{page:d.query.page,searchKeyword:d.query.searchKeyword}};break;case"courseEdit":if(d.query.courseId){const i=d.query.courseId;console.log("返回到課程編輯頁面，courseId:",i);const n={from:"course",page:d.query.originalCoursePage||d.query.page||"1",year:d.query.year,school:d.query.school,course:d.query.course,month:d.query.month,searchKeyword:d.query.searchKeyword,sortBy:d.query.sortBy,sortOrder:d.query.sortOrder};Object.keys(n).forEach(w=>{(n[w]===void 0||n[w]===null||n[w]==="")&&delete n[w]}),q={path:`/course-edit/${i}`,query:n}}else{console.log("無法找到 courseId，使用瀏覽器返回功能"),h.back();return}break;default:h.back();return}Object.keys(q.query||{}).forEach(i=>{q.query[i]===void 0&&delete q.query[i]}),console.log("Single.vue 返回到目標頁面:",q.path,"參數:",q.query),h.push(q)}else h.back()},xe=q=>{const i=d.query.from,n={...d.query,originalFrom:i,studentId:d.params.id,from:void 0};Object.keys(n).forEach(w=>{n[w]===void 0&&delete n[w]}),h.push({name:"SingleEdit",params:{id:q},query:n})},fe=q=>{const i=d.query.from,n={...d.query,originalFrom:i,studentId:d.params.id,from:void 0};Object.keys(n).forEach(w=>{n[w]===void 0&&delete n[w]}),h.push({name:"CreditsEdit",params:{id:q},query:n})},ke=Se(()=>{const q=d.query.from;let i=[];if(console.log("Single.vue breadcrumbs parameters:",{from:q,courseId:d.query.courseId,allParams:d.query}),q==="courseEdit"&&d.query.courseId)return console.log("從課程編輯頁面進入，使用 courseEdit 麵包屑"),i=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${d.params.id}`}],i;switch(q){case"information":i=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:""}];break;case"history":i=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${d.params.id}`}];break;case"courseEdit":i=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${d.params.id}`}];break;default:i=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${d.params.id}`}]}return i}),De=q=>/^09\d{8}$/.test(q),we=q=>{if(!q)return!0;const i=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;return q.length>254?!1:i.test(q)},$e=()=>N.value.birthday&&!J(N.value.birthday)?(v.showError("貼心提醒","生日日期格式不正確，請輸入民國年格式(如：113/01/01)"),!1):!0,ae=q=>q?/^\d{3,7}$/.test(q):!0,O=q=>q?/^\d{3,4}$/.test(q):!0,A=q=>q?/^[\d-]{8,16}$/.test(q):!0,J=q=>{if(!q)return!0;const i=/^(\d{1,3})([/-])(\d{1,2})\2(\d{1,2})$/;if(!i.test(q))return!1;const n=q.match(i),w=parseInt(n[1])+1911,ce=parseInt(n[3])-1,he=parseInt(n[4]);let Ve=new Date(w,ce,he);return console.log(Ve.toDateString("yyyy-MM-dd")),Ve.getFullYear()===w&&Ve.getMonth()===ce&&Ve.getDate()===he},Q=(q,i)=>{if(!u.value)return;const n=q.target.value,ce=n.replace(/[^\d/-]/g,"").slice(0,10);n!==ce&&(N.value[i]=ce)},Y=async()=>{if(!await v.confirmAsync("確認刪除",`確定要刪除學生「${N.value.name}」嗎？刪除後資料將無法恢復。`))return;const i=await ue();if(i)try{if(C.value=!0,!await pe(i))return;await ye()}catch(n){se(n)}finally{C.value=!1}},ue=async()=>{const q=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");return q===null||q===""?null:q},pe=async q=>{try{return(await Lt.confirmPassword(q)).data.code!==0?(v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),!1):!0}catch(i){return v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"),console.error("密碼驗證錯誤:",i),!1}},ye=async()=>{try{const q=await Lt.deleteStudent(N.value.id);q.data.code===0?(v.showSuccess("刪除成功","學生資料已成功刪除"),ne()):v.showError("刪除失敗",q.data.message||"刪除學生資料失敗")}catch(q){v.showError("刪除失敗","刪除學生資料時發生錯誤，請稍後再試"),console.error("刪除學生錯誤:",q)}},ne=()=>{d.query.from==="information"?h.push({path:"/student/information",query:{page:d.query.page,searchKeyword:d.query.searchKeyword,year:d.query.year,school:d.query.school,course:d.query.course,agency:d.query.agency,area:d.query.area}}):h.push("/student/information")},se=q=>{console.error("操作錯誤:",q),q.response&&q.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除學生資料時發生錯誤，請稍後再試")},re=()=>{const q=o.value;q&&(q.style.height="auto",q.style.height=Math.min(q.scrollHeight,400)+"px")},Te=async()=>{const q=d.params.id;if(!q){v.showError("列印失敗","無法獲取學生ID");return}const i=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(!(i===null||i==="")){C.value=!0;try{if((await is.confirmPassword(i)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const w=await Lt.exportCertificate(q);if(w.data){const ce=new Blob([w.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),he=window.URL.createObjectURL(ce),Ve=document.createElement("a");Ve.href=he,Ve.download=`${N.value.name}結訓證書.docx`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),window.URL.revokeObjectURL(he),v.showSuccess("列印成功","結訓證書已成功下載")}else v.showError("列印失敗",w.data.message||"列印結訓證書失敗")}catch(n){console.error("列印結訓證書錯誤:",n),v.showError("列印失敗","列印結訓證書時發生錯誤，請稍後再試")}finally{C.value=!1}}},Be=()=>u.value&&N.value.registrationDate&&!J(N.value.registrationDate)?(v.showError("貼心提醒","參訓報名日格式不正確，請輸入民國年格式(如：113/01/01)"),!1):!0,ve=q=>{q.histories||(q.histories=[]),q.creditCertifications||(q.creditCertifications=[])},ie=q=>{N.value.number=q.number||null,N.value=q,g.value=String(q.gender||1),N.value.subAgencyName=q.subAgencyName||"",z.value=q.parentAgencyId||-1,E.value=String(q.subsidyCategory||1),N.value.registrationDate=q.registrationDate||""},_e=q=>{T.value.length>0&&z.value&&!T.value.some(i=>i.id===z.value)&&T.value.push({id:z.value,name:"無上級機關"})},Le=q=>{ve(q),ie(q),K.value=JSON.parse(JSON.stringify(q)),_e(),console.log("獲取到的學生資料:",q),u.value=!1},ge=(q,i)=>{var n;console.error("獲取學生詳細資料錯誤:",q),i?(console.error("錯誤響應數據:",i.data),v.showError("數據獲取失敗",((n=i.data)==null?void 0:n.message)||"連接服務器時發生錯誤")):v.showError("數據獲取失敗",q.message||"連接服務器時發生錯誤")};return(q,i)=>(t(),s("div",Du,[e("div",Mu,[Ge(ft,{breadcrumbs:ke.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:de,"aria-label":"回上一頁"},i[23]||(i[23]=[e("span",{class:"mr-2"},"←",-1),me(" 回上一頁 ")]))]),i[55]||(i[55]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Au,[e("div",Iu,[u.value&&Z.value.studentDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:Y,"aria-label":"刪除學生資料"}," 刪除學生 ")):G("",!0),u.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:f,"aria-label":"取消編輯"}," 取消 ")):G("",!0),!u.value&&Z.value.studentExportWord?(t(),s("div",Ru,[N.value.number?(t(),s("div",Pu,[i[24]||(i[24]=e("span",{class:"text-gray-700"},"證書編號:",-1)),e("span",Uu,l(N.value.number),1)])):G("",!0),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:Te,"aria-label":N.value.number?"已列印結訓證書":"列印結訓證書"},l(N.value.number?"已列印":"列印結訓證書"),9,Nu)])):G("",!0),Z.value.studentUpdate?(t(),s("button",{key:3,class:ee(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:c,"aria-label":u.value?"儲存學生資料":"編輯學生資料"},l(u.value?"儲存":"內容編輯"),11,Tu)):G("",!0)])]),C.value?(t(),s("div",Vu,i[25]||(i[25]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",ju,[e("div",Lu,[e("div",Fu,[i[26]||(i[26]=e("label",{class:"w-24",for:"student-registration-date"},"參訓報名日:",-1)),u.value?P((t(),s("input",{key:0,id:"student-registration-date",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[0]||(i[0]=n=>N.value.registrationDate=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[1]||(i[1]=n=>Q(n,"registrationDate")),readonly:!u.value},null,40,Ou)),[[te,N.value.registrationDate]]):(t(),s("input",{key:1,id:"student-registration-date-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.registrationDate),readonly:"","aria-labelledby":"student-registration-date"},null,8,qu))]),e("div",Bu,[i[27]||(i[27]=e("label",{class:"w-24",for:"student-name"},"姓名:",-1)),P(e("input",{id:"student-name",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[2]||(i[2]=n=>N.value.name=n),readonly:!u.value},null,10,Hu),[[te,N.value.name]])]),e("div",Wu,[i[29]||(i[29]=e("label",{class:"w-24",for:"student-gender"},"性別:",-1)),u.value?P((t(),s("select",{key:0,id:"student-gender",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[3]||(i[3]=n=>g.value=n)},i[28]||(i[28]=[e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512)),[[Pe,g.value]]):(t(),s("input",{key:1,id:"student-gender-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:R(N.value.gender),readonly:"","aria-labelledby":"student-gender"},null,8,zu))]),e("div",Ku,[i[30]||(i[30]=e("label",{class:"w-24",for:"student-id-number"},"身分證字號:",-1)),P(e("input",{id:"student-id-number",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[4]||(i[4]=n=>N.value.idNumber=n),readonly:!u.value},null,10,Ju),[[te,N.value.idNumber]])]),e("div",Yu,[i[32]||(i[32]=e("label",{class:"w-24",for:"student-parent-agency"},"上級機關:",-1)),P(e("select",{id:"student-parent-agency",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":i[5]||(i[5]=n=>z.value=n)},[i[31]||(i[31]=e("option",{value:""},"無上級機關",-1)),(t(!0),s(X,null,le(T.value,n=>(t(),s("option",{key:n.id,value:n.id},l(n.name),9,Zu))),128))],10,Gu),[[Pe,z.value]])]),e("div",Qu,[i[33]||(i[33]=e("label",{class:"w-24",for:"student-agency"},"機關名稱:",-1)),u.value?P((t(),s("input",{key:0,id:"student-agency",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[6]||(i[6]=n=>N.value.subAgencyName=n),placeholder:"請輸入機關名稱",readonly:!u.value},null,8,Xu)),[[te,N.value.subAgencyName]]):(t(),s("input",{key:1,id:"student-agency-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.subAgencyName),readonly:"","aria-labelledby":"student-agency"},null,8,ec))]),e("div",tc,[i[34]||(i[34]=e("label",{class:"w-24",for:"student-unit"},"單位:",-1)),u.value?P((t(),s("input",{key:0,id:"student-unit",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[7]||(i[7]=n=>N.value.unitName=n),placeholder:"請輸入單位名稱",readonly:!u.value},null,8,sc)),[[te,N.value.unitName]]):(t(),s("input",{key:1,id:"student-unit-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.unitName),readonly:"","aria-labelledby":"student-unit"},null,8,ac))])]),e("div",oc,[e("div",lc,[i[35]||(i[35]=e("label",{class:"w-24",for:"student-office-phone"},"公務電話:",-1)),u.value?P((t(),s("input",{key:0,id:"student-office-phone",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[8]||(i[8]=n=>N.value.officePhone=n),placeholder:"可填寫手機、市話(含區碼)或內線",readonly:!u.value},null,8,nc)),[[te,N.value.officePhone]]):(t(),s("input",{key:1,id:"student-office-phone-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.officePhone),readonly:"","aria-labelledby":"student-office-phone"},null,8,rc))]),e("div",ic,[i[36]||(i[36]=e("label",{class:"w-24",for:"student-phone"},"行動電話:",-1)),u.value?P((t(),s("input",{key:0,id:"student-phone",type:"tel",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[9]||(i[9]=n=>N.value.phone=n),placeholder:"09開頭的10位數字，例：0912345678",maxlength:"10",readonly:!u.value},null,10,dc)),[[te,N.value.phone]]):(t(),s("input",{key:1,id:"student-phone-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.phone),readonly:"","aria-labelledby":"student-phone"},null,8,uc))]),e("div",cc,[i[37]||(i[37]=e("label",{class:"w-24",for:"student-office-email"},"公務郵件:",-1)),u.value?P((t(),s("input",{key:0,id:"student-office-email",type:"email",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[10]||(i[10]=n=>N.value.officeEmail=n),placeholder:"例：example@gov.tw",readonly:!u.value},null,8,pc)),[[te,N.value.officeEmail]]):(t(),s("input",{key:1,id:"student-office-email-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.officeEmail),readonly:"","aria-labelledby":"student-office-email"},null,8,vc))]),e("div",mc,[i[38]||(i[38]=e("label",{class:"w-24",for:"student-email"},"私人郵件:",-1)),u.value?P((t(),s("input",{key:0,id:"student-email",type:"email",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[11]||(i[11]=n=>N.value.email=n),placeholder:"例：example@example.com",readonly:!u.value},null,8,bc)),[[te,N.value.email]]):(t(),s("input",{key:1,id:"student-email-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.email),readonly:"","aria-labelledby":"student-email"},null,8,fc))]),e("div",yc,[i[39]||(i[39]=e("label",{class:"w-24",for:"student-birthday"},"生日:",-1)),u.value?P((t(),s("input",{key:0,id:"student-birthday",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[12]||(i[12]=n=>N.value.birthday=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[13]||(i[13]=n=>Q(n,"birthday")),readonly:!u.value},null,40,gc)),[[te,N.value.birthday]]):(t(),s("input",{key:1,id:"student-birthday-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.birthday),readonly:"","aria-labelledby":"student-birthday"},null,8,xc))]),E.value==="4"?(t(),s("div",hc,[i[40]||(i[40]=e("label",{class:"w-24",for:"student-cancel-date"},"取消日期:",-1)),u.value?P((t(),s("input",{key:0,id:"student-cancel-date",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[14]||(i[14]=n=>N.value.cancelDate=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[15]||(i[15]=n=>Q(n,"cancelDate")),readonly:!u.value},null,40,wc)),[[te,N.value.cancelDate]]):(t(),s("input",{key:1,id:"student-cancel-date-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.cancelDate),readonly:"","aria-labelledby":"student-cancel-date"},null,8,_c))])):G("",!0)]),e("div",kc,[e("div",$c,[i[42]||(i[42]=e("label",{class:"w-24",for:"subsidy-category"},"補助類別:",-1)),P(e("select",{id:"subsidy-category",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":i[16]||(i[16]=n=>E.value=n)},i[41]||(i[41]=[e("option",{value:"1"},"機關薦派",-1),e("option",{value:"2"},"自行報名",-1),e("option",{value:"3"},"非本計畫",-1),e("option",{value:"4"},"已取消",-1)]),10,Cc),[[Pe,E.value]])]),e("div",Ec,[i[43]||(i[43]=e("label",{class:"w-24",for:"bank-code"},"銀行代碼:",-1)),u.value?P((t(),s("input",{key:0,id:"bank-code",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[17]||(i[17]=n=>N.value.bankCode=n),placeholder:"請輸入3-7位數字的銀行代碼",maxlength:"7",readonly:!u.value},null,8,Sc)),[[te,N.value.bankCode]]):(t(),s("input",{key:1,id:"bank-code-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.bankCode),readonly:"","aria-labelledby":"bank-code"},null,8,Dc))]),e("div",Mc,[i[44]||(i[44]=e("label",{class:"w-24",for:"branch-code"},"分行代碼:",-1)),u.value?P((t(),s("input",{key:0,id:"branch-code",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[18]||(i[18]=n=>N.value.branchCode=n),placeholder:"請輸入3-4位數字的分行代碼",maxlength:"4",readonly:!u.value},null,8,Ac)),[[te,N.value.branchCode]]):(t(),s("input",{key:1,id:"branch-code-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.branchCode),readonly:"","aria-labelledby":"branch-code"},null,8,Ic))]),e("div",Rc,[i[45]||(i[45]=e("label",{class:"w-24",for:"bank-account"},"銀行帳號:",-1)),u.value?P((t(),s("input",{key:0,id:"bank-account",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[19]||(i[19]=n=>N.value.bankAccount=n),placeholder:"請輸入8-16位數字的銀行帳號，可包含連字符號",maxlength:"16",readonly:!u.value},null,8,Pc)),[[te,N.value.bankAccount]]):(t(),s("input",{key:1,id:"bank-account-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.bankAccount),readonly:"","aria-labelledby":"bank-account"},null,8,Uc))]),e("div",Nc,[i[46]||(i[46]=e("label",{class:"w-24",for:"student-address"},"收件地址:",-1)),u.value?P((t(),s("input",{key:0,id:"student-address",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[20]||(i[20]=n=>N.value.address=n),placeholder:"請輸入收件地址",readonly:!u.value},null,8,Tc)),[[te,N.value.address]]):(t(),s("input",{key:1,id:"student-address-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.address),readonly:"","aria-labelledby":"student-address"},null,8,Vc))]),E.value==="4"?(t(),s("div",jc,[i[47]||(i[47]=e("label",{class:"w-24",for:"student-cancel-reason"},"取消原因:",-1)),u.value?P((t(),s("input",{key:0,id:"student-cancel-reason",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[21]||(i[21]=n=>N.value.cancelReason=n),placeholder:"請輸入取消原因",readonly:!u.value},null,8,Lc)),[[te,N.value.cancelReason]]):(t(),s("input",{key:1,id:"student-cancel-reason-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.cancelReason),readonly:"","aria-labelledby":"student-cancel-reason"},null,8,Fc))])):G("",!0)])])),i[56]||(i[56]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Oc,[i[48]||(i[48]=e("div",{class:"text-lg mb-3",id:"remark-label"},"備註",-1)),e("div",qc,[u.value?P((t(),s("textarea",{key:0,id:"student-remark","onUpdate:modelValue":i[22]||(i[22]=n=>N.value.remark=n),class:ee(["w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",u.value?"border-[#4e9875]":"border-gray-300"]),placeholder:"請輸入備註，最多1000字",maxlength:"1000",rows:"4",onInput:re,ref_key:"remarkTextarea",ref:o,"aria-labelledby":"remark-label"},null,34)),[[te,N.value.remark]]):(t(),s("div",Bc,l(N.value.remark||"無備註"),1))]),u.value?(t(),s("div",Hc,l(N.value.remark?N.value.remark.length:0)+"/1000 ",1)):G("",!0)]),i[57]||(i[57]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Wc,[i[53]||(i[53]=e("div",{class:"text-xl font-bold mb-4 pb-2"},"上課紀錄",-1)),e("table",zc,[i[50]||(i[50]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",scope:"col"},"課程代號"),e("th",{class:"border p-2",scope:"col"},"科目"),e("th",{class:"border p-2",scope:"col"},"訓練單位"),e("th",{class:"border p-2",scope:"col"},"訓練日期起訖"),e("th",{class:"border p-2",scope:"col"},"狀態"),e("th",{class:"border p-2",scope:"col"},"已認列學分"),e("th",{class:"border p-2",scope:"col"},"應取得學分"),e("th",{class:"border p-2",scope:"col"},"已取得學分"),e("th",{class:"border p-2",scope:"col"},"學分證書編號"),e("th",{class:"border p-2",scope:"col"},"成績")])],-1)),e("tbody",null,[N.value.histories&&N.value.histories.length===0?(t(),s("tr",Kc,i[49]||(i[49]=[e("td",{colspan:"10",class:"border p-4 text-center"},"無上課紀錄",-1)]))):N.value.histories&&N.value.histories.length>0?(t(!0),s(X,{key:1},le(N.value.histories,(n,w)=>(t(),s("tr",{key:w,class:"cursor-pointer hover:bg-gray-100",onClick:ce=>xe(n.id),"aria-label":`查看上課記錄：${a(n.courseCode)} ${a(n.courseCategory)}`},[e("td",Yc,l(a(n.courseCode)),1),e("td",Gc,l(a(n.courseCategory)),1),e("td",Zc,l(a(n.schoolName)),1),e("td",Qc,l(a(n.startDate))+"~"+l(a(n.endDate)),1),e("td",Xc,l(a(n.status)),1),e("td",ep,l(a(n.approvedCredits)),1),e("td",tp,l(a(n.requiredCredits)),1),e("td",sp,l(a(n.earnedCredits)),1),e("td",ap,l(a(n.certificateNumber)),1),e("td",op,l(a(n.grade)),1)],8,Jc))),128)):G("",!0)])]),i[54]||(i[54]=e("div",{class:"text-xl font-bold mt-10 mb-4 pb-2"},"學分認列",-1)),e("table",lp,[i[52]||(i[52]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",scope:"col"},"課程代號"),e("th",{class:"border p-2",scope:"col"},"科目"),e("th",{class:"border p-2",scope:"col"},"訓練單位"),e("th",{class:"border p-2",scope:"col"},"訓練日期起訖"),e("th",{class:"border p-2",scope:"col"},"狀態"),e("th",{class:"border p-2",scope:"col"},"已認列學分"),e("th",{class:"border p-2",scope:"col"},"應取得學分"),e("th",{class:"border p-2",scope:"col"},"已取得學分"),e("th",{class:"border p-2",scope:"col"},"學分證書編號"),e("th",{class:"border p-2",scope:"col"},"成績")])],-1)),e("tbody",null,[N.value.creditCertifications&&N.value.creditCertifications.length===0?(t(),s("tr",np,i[51]||(i[51]=[e("td",{colspan:"10",class:"border p-4 text-center"},"無學分認列紀錄",-1)]))):N.value.creditCertifications&&N.value.creditCertifications.length>0?(t(!0),s(X,{key:1},le(N.value.creditCertifications,(n,w)=>(t(),s("tr",{key:w,class:"cursor-pointer hover:bg-gray-100",onClick:ce=>fe(n.id),"aria-label":`查看學分認列：${a(n.courseCode)} ${a(n.courseCategory)}`},[e("td",ip,l(a(n.courseCode)),1),e("td",dp,l(a(n.courseCategory)),1),e("td",up,l(a(n.schoolName)),1),e("td",cp,l(a(n.startDate))+"~"+l(a(n.endDate)),1),e("td",pp,l(a(n.status)),1),e("td",vp,l(a(n.approvedCredits)),1),e("td",mp,l(a(n.requiredCredits)),1),e("td",bp,l(a(n.earnedCredits)),1),e("td",fp,l(a(n.certificateNumber)),1),e("td",yp,l(a(n.grade)),1)],8,rp))),128)):G("",!0)])])])]))}},xp=Fe(gp,[["__scopeId","data-v-41e37bab"]]),hp={class:"flex flex-col items-center p-6"},wp={class:"w-full max-w-[1500px]"},_p={class:"w-full max-w-[1500px]"},kp={class:"flex items-center space-x-4 mb-4"},$p={class:"relative w-40"},Cp={class:"flex items-center space-x-4"},Ep=["value"],Sp=["value"],Dp=["value"],Mp=["value"],Ap={class:"w-full max-w-[1500px]"},Ip={key:0,class:"flex justify-center items-center py-10"},Rp={key:1,class:"w-full border-collapse"},Pp={class:"bg-[#EEEFE7]"},Up={class:"border p-2"},Np={class:"flex items-center justify-center"},Tp={key:0},Vp={key:1},jp={key:2},Lp={class:"border p-2"},Fp={class:"flex items-center justify-center"},Op={key:0},qp={key:1},Bp={key:2},Hp={class:"border p-2"},Wp={class:"flex items-center justify-center"},zp={key:0},Kp={key:1},Jp={key:2},Yp={class:"border p-2"},Gp={class:"flex items-center justify-center"},Zp={key:0},Qp={key:1},Xp={key:2},ev={class:"border p-2"},tv={class:"flex items-center justify-center"},sv={key:0},av={key:1},ov={key:2},lv={class:"border p-2"},nv={class:"flex items-center justify-center"},rv={key:0},iv={key:1},dv={key:2},uv={class:"border p-2"},cv={class:"flex items-center justify-center"},pv={key:0},vv={key:1},mv={key:2},bv={class:"border p-2"},fv={class:"flex items-center justify-center"},yv={key:0},gv={key:1},xv={key:2},hv=["onClick"],wv={class:"border p-2 text-center"},_v={class:"border p-2 text-center"},kv={class:"border p-2 text-center"},$v={class:"border p-2 text-center"},Cv={class:"border p-2 text-center"},Ev={class:"border p-2 text-center"},Sv={class:"border p-2 text-center"},Dv={class:"border p-2 text-center"},Mv={class:"border p-2 text-center"},Av={key:0},Iv={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Rv=["disabled"],Pv=["onClick"],Uv={key:1,class:"px-2"},Nv=["disabled"],Tv={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Vv={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},jv={class:"mb-4"},Lv={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Fv={class:"mb-2"},Ov={key:0,class:"text-red-500 text-sm mt-2"},qv={class:"flex justify-end space-x-2"},Bv=["disabled"],Hv=["disabled"],Wv={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},zv={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Kv={class:"mb-4"},Jv={class:"space-y-3"},Ms=20,Yv={__name:"Information",setup(M){const h=We(),d=rt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),E=m(""),U=m(1),T=m(1),z=m(0),g=m(!1),a=m([]),R=m([]),Z=m([]),$=m([]),c=m([]),y=m(""),r=m("asc"),b=Se(()=>{const ge=new Date().getFullYear()-1911,q=[];for(let i=ge;i>=113;i--)q.push(i);return q}),p=ge=>ge==="-1"||ge===-1?"缺":ge,_=ge=>{if(ge==="-1"||ge===-1)return"缺";if(!ge||typeof ge!="string"||ge.length<5)return ge;const q=ge.substring(0,2),i=ge.substring(ge.length-3),n="*".repeat(ge.length-5);return q+n+i},f=Se(()=>{const ge=[];if(T.value<=5)for(let i=1;i<=T.value;i++)ge.push(i);else{ge.push(1);let i=Math.max(2,U.value-1),n=Math.min(T.value-1,U.value+1);U.value<=3&&(n=Math.min(4,T.value-1)),U.value>=T.value-2&&(i=Math.max(2,T.value-3)),i>2&&ge.push("...");for(let w=i;w<=n;w++)ge.push(w);n<T.value-1&&ge.push("..."),ge.push(T.value)}return ge}),V=async()=>{let ge=!1;try{g.value=!0;const q={page:U.value,limit:Ms,keyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:E.value||void 0,sortBy:y.value,sortOrder:r.value};console.log("獲取學生列表參數:",q);const i=await Lt.getStudents(q);i.data.code===0?(a.value=i.data.data.list,z.value=i.data.data.totalCount,T.value=Math.ceil(z.value/Ms)):(console.error("獲取學生列表失敗:",i.data.message),a.value=[],z.value=0,T.value=0,v.showError("獲取資料失敗",i.data.message||"無法獲取學生列表，請稍後再試"))}catch(q){q.isLoginExpired?(console.log("登入已過期，跳過更新操作"),ge=!0):(console.error("獲取學生列表錯誤:",q),a.value=[],z.value=0,T.value=0,v.showError("獲取資料失敗","無法獲取學生列表，請稍後再試"))}finally{!ge&&localStorage.getItem("token")&&(g.value=!1)}},W=ge=>{ge!==U.value&&(U.value=ge)},H=()=>{U.value>1&&U.value--},k=()=>{U.value<T.value&&U.value++},D=async()=>{let ge=!1;try{g.value=!0,U.value=1;const q={page:U.value,limit:Ms,keyword:u.value.trim(),sortBy:y.value||void 0,sortOrder:r.value||void 0};console.log("關鍵字搜尋參數:",q),x();const i=await Lt.getStudents(q);i.data.code===0?(a.value=i.data.data.list,z.value=i.data.data.totalCount,T.value=Math.ceil(z.value/Ms)):(console.error("獲取學生列表失敗:",i.data.message),a.value=[],z.value=0,T.value=0,v.showError("搜尋失敗",i.data.message||"關鍵字搜尋失敗，請稍後再試"))}catch(q){q.isLoginExpired?(console.log("登入已過期，跳過更新操作"),ge=!0):(console.error("獲取學生列表錯誤:",q),a.value=[],z.value=0,T.value=0,v.showError("搜尋失敗","搜尋過程中發生錯誤，請稍後再試"))}finally{!ge&&localStorage.getItem("token")&&(g.value=!1)}},j=()=>{console.log("搜尋條件:",{year:C.value,school:o.value,course:N.value,agency:K.value,area:E.value}),console.log("搜尋條件類型:",{year:typeof C.value,school:typeof o.value,course:typeof N.value,agency:typeof K.value,area:typeof E.value}),U.value=1,x(),V()},S=ge=>{if(ge){const q={from:"information",page:U.value,searchKeyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:E.value||void 0,sortBy:y.value||void 0,sortOrder:r.value||void 0};h.push({name:"Single",params:{id:ge},query:q})}};Ee(U,()=>{x(),V()});const x=()=>{const ge={page:U.value,searchKeyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:E.value||void 0,sortBy:y.value||void 0,sortOrder:r.value||void 0};Object.keys(ge).forEach(q=>{ge[q]===void 0&&delete ge[q]}),h.replace({query:ge})},L=async()=>{try{const ge=await nt.getAgencyOptions();ge.data.code===0&&ge.data.message==="success"?R.value=ge.data.data:console.error("獲取機關選項失敗:",ge.data.message)}catch(ge){console.error("獲取機關選項錯誤:",ge)}},de=async()=>{try{const ge=await nt.getSchoolOptions();ge.data.code===0&&ge.data.message==="success"?Z.value=ge.data.data:console.error("獲取學校選項失敗:",ge.data.message)}catch(ge){console.error("獲取學校選項錯誤:",ge)}},xe=()=>{$.value=[]},fe=async()=>{var ge,q;try{const i=await nt.getAreaOptions();((ge=i==null?void 0:i.data)==null?void 0:ge.code)===0?c.value=i.data.data:(console.error("獲取區域選項失敗:",((q=i==null?void 0:i.data)==null?void 0:q.message)||"未知錯誤"),c.value=[])}catch(i){console.error("獲取區域選項錯誤:",i),c.value=[]}},ke=()=>{d.query.page&&(U.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.year&&(C.value=d.query.year),d.query.school&&(o.value=d.query.school),d.query.course&&(N.value=d.query.course),d.query.agency&&(K.value=d.query.agency),d.query.area&&(E.value=d.query.area),d.query.sortBy&&(y.value=d.query.sortBy),d.query.sortOrder&&(r.value=d.query.sortOrder)};je(()=>{ke(),L(),de(),xe(),fe(),V(),Le()});const De=()=>{ie.value=!0},we=()=>{ie.value=!1},$e=async ge=>{if(ge)await ae(ge);else try{const q=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(q===null||q==="")return;if((await Lt.confirmPassword(q)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const n=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(n===null)return;await ae(ge,n)}catch(q){console.error("匯出過程中的密碼驗證發生錯誤:",q),q.response&&q.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}we()},ae=async(ge,q="")=>{try{const i={year:C.value||null,school:o.value||null,course:N.value||null,agency:K.value||null,area:E.value||null,keyword:u.value||null,isHidden:ge,password:q};console.log("匯出 Excel 參數:",i);const n=await Lt.exportStudents(i),w=n.headers["content-type"];if(!w||!w.includes("spreadsheetml.sheet"))try{const ct=new Blob([n.data],{type:"application/json"}),lt=await new Response(ct).text(),dt=JSON.parse(lt);console.error("匯出學生資料失敗：伺服器返回錯誤：",dt),v.showError("匯出失敗",dt.message||"匯出過程中發生錯誤，請稍後再試");return}catch(ct){console.error("匯出學生資料失敗：無法解析回應內容",ct),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const ce=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),he=document.createElement("a");he.href=URL.createObjectURL(ce);const Ve=new Date,Ct=`學生資料_${`${Ve.getFullYear()}-${String(Ve.getMonth()+1).padStart(2,"0")}-${String(Ve.getDate()).padStart(2,"0")}`}_${ge?"隱蔽加密版":"無隱蔽版"}.xlsx`;he.download=Ct,he.click(),URL.revokeObjectURL(he.href),v.showSuccess("匯出成功","學生資料已成功匯出為 Excel 檔案")}catch(i){if(i.isLoginExpired){console.log("登入已過期，跳過匯出操作");return}if(console.error("匯出 Excel 錯誤:",i),i.response&&i.response.data){const n=i.response.data;v.showError("匯出失敗",n.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},O=()=>{u.value="",d.query.searchKeyword&&(U.value=1,x(),V())},A=()=>{h.push("/student/add")},J=()=>{h.push("/agency")},Q=ge=>{y.value===ge?r.value=r.value==="asc"?"desc":"asc":(y.value=ge,r.value="asc"),U.value=1,x(),V()},Y=m(!1),ue=m(null),pe=m(""),ye=m(!1),ne=m(null),se=()=>{Y.value=!0,pe.value="",ue.value=null,ws(()=>{ne.value&&(ne.value.value=null)})},re=()=>{Y.value=!1,ue.value=null,pe.value=""},Te=()=>{ne.value.click()},Be=ge=>{const q=ge.target.files[0];if(q){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/vnd.oasis.opendocument.spreadsheet"].includes(q.type)&&!q.name.endsWith(".xlsx")&&!q.name.endsWith(".xls")&&!q.name.endsWith(".csv")&&!q.name.endsWith(".ods")){pe.value="請選擇 .xlsx 或.ods 檔案",ue.value=null,ge.target.value=null;return}ue.value=q,pe.value=""}},ve=async()=>{var ge,q,i;if(!ue.value){pe.value="請選擇要匯入的檔案";return}try{ye.value=!0,pe.value="";const n=new FormData;n.append("file",ue.value);const w=await Lt.importStudents(n);if(w.data&&w.data.code===0){const ce=w.data.message?w.data.message.replace(/\r\n|\n|\r/g,"<br>"):"學生資料已成功匯入";v.showInfo("匯入成功",ce);const he=()=>{re(),V(),document.removeEventListener("info_close",he)};document.addEventListener("info_close",he)}else pe.value=((ge=w.data)==null?void 0:ge.message)||"匯入失敗，請確認檔案格式是否正確",v.showError("匯入失敗",pe.value)}catch(n){console.error("匯入學生檔案錯誤:",n),pe.value=((i=(q=n.response)==null?void 0:q.data)==null?void 0:i.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",pe.value)}finally{ye.value=!1}},ie=m(!1),_e=m({studentCreate:!1,studentImport:!1,studentExport:!1,agencyManagement:!1}),Le=async()=>{try{const ge=await ot.getSidebarPermissions();ge.data.code===0&&ge.data.message==="success"?(_e.value=ge.data.data,console.log("學員資料頁面權限:",_e.value)):console.error("獲取權限失敗:",ge.data.message)}catch(ge){console.error("獲取權限錯誤:",ge)}};return(ge,q)=>(t(),s(X,null,[e("div",hp,[e("div",wp,[Ge(ft,{breadcrumbs:[{name:"學員資料",path:"/student/information"}]})]),e("div",_p,[e("div",kp,[q[18]||(q[18]=e("span",null,"查詢學員:",-1)),e("div",$p,[P(e("input",{type:"text","onUpdate:modelValue":q[0]||(q[0]=i=>u.value=i),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名/手機/身分證字號",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ue(D,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:O,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},q[17]||(q[17]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:D}," 搜尋 "),q[19]||(q[19]=e("div",{class:"flex-1"},null,-1)),_e.value.studentImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:se}," 匯入學員 ")):G("",!0),_e.value.studentCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:A}," 新增學員 ")):G("",!0)]),e("div",Cp,[q[25]||(q[25]=e("span",null,"查詢班級:",-1)),P(e("select",{"onUpdate:modelValue":q[1]||(q[1]=i=>C.value=i),class:"p-2 border border-gray-300 outline-none w-40",onChange:q[2]||(q[2]=(...i)=>ge.handleYearOrSchoolChange&&ge.handleYearOrSchoolChange(...i)),onKeyup:Ue(j,["enter"])},[q[20]||(q[20]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le(b.value,i=>(t(),s("option",{key:i,value:i},l(i)+"年 ",9,Ep))),128))],544),[[Pe,C.value]]),P(e("select",{"onUpdate:modelValue":q[3]||(q[3]=i=>o.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(j,["enter"])},[q[21]||(q[21]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(X,null,le(Z.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Sp))),128))],544),[[Pe,o.value]]),P(e("select",{"onUpdate:modelValue":q[4]||(q[4]=i=>N.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(j,["enter"])},q[22]||(q[22]=[e("option",{value:""},"請選擇課程類型",-1),e("option",{value:"1"},"資安職能課程",-1),e("option",{value:"2"},"學分課程",-1)]),544),[[Pe,N.value]]),P(e("select",{"onUpdate:modelValue":q[5]||(q[5]=i=>K.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(j,["enter"])},[q[23]||(q[23]=e("option",{value:""},"請選擇機關",-1)),(t(!0),s(X,null,le(R.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Dp))),128))],544),[[Pe,K.value]]),P(e("select",{"onUpdate:modelValue":q[6]||(q[6]=i=>E.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(j,["enter"])},[q[24]||(q[24]=e("option",{value:""},"請選擇區域",-1)),(t(!0),s(X,null,le(c.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Mp))),128))],544),[[Pe,E.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:j}," 搜尋 "),q[26]||(q[26]=e("div",{class:"flex-1"},null,-1)),_e.value.agencyRead?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28 mr-2",onClick:J}," 機關管理 ")):G("",!0),_e.value.studentExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:De}," 匯出 Excel ")):G("",!0)])]),q[38]||(q[38]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Ap,[g.value?(t(),s("div",Ip,q[27]||(q[27]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Rp,[e("thead",null,[e("tr",Pp,[q[36]||(q[36]=e("th",{class:"border p-2"},"序",-1)),e("th",Up,[e("div",Np,[q[28]||(q[28]=me(" 上級機關 ")),e("button",{onClick:q[7]||(q[7]=i=>Q("parentAgencyName")),class:"ml-1 focus:outline-none"},[y.value==="parentAgencyName"&&r.value==="asc"?(t(),s("span",Tp,"▲")):y.value==="parentAgencyName"&&r.value==="desc"?(t(),s("span",Vp,"▼")):(t(),s("span",jp,"⇅"))])])]),e("th",Lp,[e("div",Fp,[q[29]||(q[29]=me(" 機關名稱 ")),e("button",{onClick:q[8]||(q[8]=i=>Q("subAgencyName")),class:"ml-1 focus:outline-none"},[y.value==="subAgencyName"&&r.value==="asc"?(t(),s("span",Op,"▲")):y.value==="subAgencyName"&&r.value==="desc"?(t(),s("span",qp,"▼")):(t(),s("span",Bp,"⇅"))])])]),e("th",Hp,[e("div",Wp,[q[30]||(q[30]=me(" 姓名 ")),e("button",{onClick:q[9]||(q[9]=i=>Q("name")),class:"ml-1 focus:outline-none"},[y.value==="name"&&r.value==="asc"?(t(),s("span",zp,"▲")):y.value==="name"&&r.value==="desc"?(t(),s("span",Kp,"▼")):(t(),s("span",Jp,"⇅"))])])]),e("th",Yp,[e("div",Gp,[q[31]||(q[31]=me(" 身份證字號 ")),e("button",{onClick:q[10]||(q[10]=i=>Q("idNumber")),class:"ml-1 focus:outline-none"},[y.value==="idNumber"&&r.value==="asc"?(t(),s("span",Zp,"▲")):y.value==="idNumber"&&r.value==="desc"?(t(),s("span",Qp,"▼")):(t(),s("span",Xp,"⇅"))])])]),e("th",ev,[e("div",tv,[q[32]||(q[32]=me(" 行動電話 ")),e("button",{onClick:q[11]||(q[11]=i=>Q("phone")),class:"ml-1 focus:outline-none"},[y.value==="phone"&&r.value==="asc"?(t(),s("span",sv,"▲")):y.value==="phone"&&r.value==="desc"?(t(),s("span",av,"▼")):(t(),s("span",ov,"⇅"))])])]),e("th",lv,[e("div",nv,[q[33]||(q[33]=me(" 狀態 ")),e("button",{onClick:q[12]||(q[12]=i=>Q("status")),class:"ml-1 focus:outline-none"},[y.value==="status"&&r.value==="asc"?(t(),s("span",rv,"▲")):y.value==="status"&&r.value==="desc"?(t(),s("span",iv,"▼")):(t(),s("span",dv,"⇅"))])])]),e("th",uv,[e("div",cv,[q[34]||(q[34]=me(" 補助類別 ")),e("button",{onClick:q[13]||(q[13]=i=>Q("subsidyCategory")),class:"ml-1 focus:outline-none"},[y.value==="subsidyCategory"&&r.value==="asc"?(t(),s("span",pv,"▲")):y.value==="subsidyCategory"&&r.value==="desc"?(t(),s("span",vv,"▼")):(t(),s("span",mv,"⇅"))])])]),e("th",bv,[e("div",fv,[q[35]||(q[35]=me(" 申請補助狀態 ")),e("button",{onClick:q[14]||(q[14]=i=>Q("subsidyStatus")),class:"ml-1 focus:outline-none"},[y.value==="subsidyStatus"&&r.value==="asc"?(t(),s("span",yv,"▲")):y.value==="subsidyStatus"&&r.value==="desc"?(t(),s("span",gv,"▼")):(t(),s("span",xv,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(a.value,(i,n)=>(t(),s("tr",{key:i.id,onClick:w=>S(i.id),class:"cursor-pointer hover:bg-gray-100"},[e("td",wv,l((U.value-1)*Ms+n+1),1),e("td",_v,l(p(i.parentAgencyName)),1),e("td",kv,l(p(i.subAgencyName)),1),e("td",$v,l(p(i.name)),1),e("td",Cv,l(_(i.idNumber)),1),e("td",Ev,l(p(i.phone)),1),e("td",Sv,l(p(i.status)),1),e("td",Dv,l(p(i.subsidyCategory)),1),e("td",Mv,l(p(i.subsidyStatus)),1)],8,hv))),128)),a.value.length===0?(t(),s("tr",Av,q[37]||(q[37]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])),!g.value&&a.value.length>0?(t(),s("div",Iv,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:U.value===1,onClick:H}," 上一頁 ",8,Rv),(t(!0),s(X,null,le(f.value,i=>(t(),s(X,{key:i},[i!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":i===U.value}]),onClick:n=>W(i)},l(i),11,Pv)):(t(),s("span",Uv,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:U.value===T.value,onClick:k}," 下一頁 ",8,Nv)])):G("",!0)])]),Y.value?(t(),s("div",Tv,[e("div",Vv,[q[39]||(q[39]=e("h3",{class:"text-lg font-medium mb-4"},"匯入學生",-1)),e("div",jv,[e("div",Lv,[e("input",{type:"file",ref_key:"fileInput",ref:ne,class:"hidden",onChange:Be,accept:".xlsx,.xls,.csv"},null,544),e("p",Fv,l(ue.value?ue.value.name:"請選擇 .xlsx 或.ods 檔案"),1),e("button",{onClick:Te,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),pe.value?(t(),s("p",Ov,l(pe.value),1)):G("",!0)]),e("div",qv,[e("button",{onClick:re,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:ye.value}," 取消 ",8,Bv),e("button",{onClick:ve,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!ue.value||ye.value},l(ye.value?"上傳中...":"上傳"),9,Hv)])])])):G("",!0),ie.value?(t(),s("div",Wv,[e("div",zv,[q[40]||(q[40]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",Kv,[e("div",Jv,[e("button",{onClick:q[15]||(q[15]=i=>$e(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:q[16]||(q[16]=i=>$e(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:we,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):G("",!0)],64))}},Gv=Fe(Yv,[["__scopeId","data-v-92d69826"]]),Zv={class:"flex flex-col items-center p-6"},Qv={class:"w-full max-w-[1500px]"},Xv={class:"w-full max-w-[1500px]"},em={class:"flex items-center space-x-4"},tm={class:"relative w-40"},sm=["disabled"],am={class:"w-full max-w-[1500px] overflow-auto"},om={key:0,class:"flex justify-center items-center py-10"},lm={key:1},nm={class:"w-full border-collapse"},rm={class:"bg-[#EEEFE7]"},im={class:"border p-2 w-[120px]",scope:"col"},dm={class:"flex items-center justify-center"},um={key:0},cm={key:1},pm={key:2},vm={class:"border p-2",scope:"col"},mm={class:"flex items-center justify-center"},bm={key:0},fm={key:1},ym={key:2},gm={class:"border p-2",scope:"col"},xm={class:"flex items-center justify-center"},hm={key:0},wm={key:1},_m={key:2},km={class:"border p-2",scope:"col"},$m={class:"flex items-center justify-center"},Cm={key:0},Em={key:1},Sm={key:2},Dm={class:"border p-2",scope:"col"},Mm={class:"flex items-center justify-center"},Am={key:0},Im={key:1},Rm={key:2},Pm={class:"border p-2",scope:"col"},Um={class:"flex items-center justify-center"},Nm={key:0},Tm={key:1},Vm={key:2},jm=["onClick"],Lm={class:"border p-2 text-center"},Fm={class:"border p-2 text-center"},Om={class:"border p-2 text-center"},qm={class:"border p-2 text-center"},Bm={class:"border p-2 text-center"},Hm={class:"border p-2 text-center"},Wm={class:"border p-2 text-center"},zm={key:0},Km={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Jm=["disabled"],Ym=["disabled","onClick"],Gm={key:1,class:"px-2"},Zm=["disabled"],Bs=20,Qm={__name:"History",setup(M){const h=We(),d=rt(),u=m(""),C=m(""),o=m("asc"),N=m(1),K=m(1),E=m(0),U=m(!1),T=m([]),z=m(!1),g=()=>{z.value=!z.value},a=S=>{if(S==null)return"";const x=Number(S);return isNaN(x)?S:z.value?x*18:x},R=S=>S,Z=Se(()=>{const S=[];if(K.value<=5)for(let L=1;L<=K.value;L++)S.push(L);else{S.push(1);let L=Math.max(2,N.value-1),de=Math.min(K.value-1,N.value+1);N.value<=3&&(de=Math.min(4,K.value-1)),N.value>=K.value-2&&(L=Math.max(2,K.value-3)),L>2&&S.push("...");for(let xe=L;xe<=de;xe++)S.push(xe);de<K.value-1&&S.push("..."),S.push(K.value)}return S}),$=async()=>{try{U.value=!0;const S=c();console.log("搜尋參數:",S);const x=await Lt.getLearnHistory(S);console.log("API 回應:",x.data),y(x.data)}catch(S){b(S)}finally{U.value=!1}},c=()=>{const S={limit:Bs};return N.value&&(S.page=N.value),u.value&&u.value.trim()!==""&&(S.keyword=u.value.trim()),C.value&&(S.sortBy=C.value),o.value&&(S.sortOrder=o.value),S},y=S=>{S.code===0&&S.message==="success"?r(S.data):(v.showError("載入失敗","獲取學習歷程失敗: "+S.message),console.error("獲取學習歷程失敗:",S.message))},r=S=>{T.value=S.list||[],N.value=S.page||1,K.value=S.totalPage||1,E.value=S.totalCount||0},b=S=>{console.error("獲取學習歷程錯誤:",S),S.response&&S.response.data?p(S.response.data):v.showError("載入失敗","獲取學習歷程錯誤，請稍後再試")},p=S=>{S.message?v.showError("載入失敗",`獲取學習歷程錯誤: ${S.message}`):S.title?v.showError("載入失敗",`獲取學習歷程錯誤: ${S.title}`):v.showError("載入失敗","獲取學習歷程錯誤，請稍後再試"),console.error("錯誤響應數據:",S)},_=S=>{S!==N.value&&!U.value&&(N.value=S)},f=()=>{N.value>1&&!U.value&&N.value--},V=()=>{N.value<K.value&&!U.value&&N.value++},W=()=>{U.value||(N.value=1,$())};Ee(N,()=>{$()});const H=()=>{d.query.page&&(N.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.sortBy&&(C.value=d.query.sortBy),d.query.sortOrder&&(o.value=d.query.sortOrder)};je(()=>{H(),$()});const k=()=>{u.value=""},D=S=>{C.value===S?o.value=o.value==="asc"?"desc":"asc":(C.value=S,o.value="asc"),N.value=1,$()},j=S=>{if(S){const x={from:"history",page:N.value,searchKeyword:u.value||void 0,sortBy:C.value||void 0,sortOrder:o.value||void 0};h.push({name:"Single",params:{id:S},query:x})}};return(S,x)=>(t(),s("div",Zv,[e("div",Qv,[Ge(ft,{breadcrumbs:[{name:"學習歷程",path:"/history"}]})]),e("div",Xv,[e("div",em,[x[8]||(x[8]=e("span",null,"查詢學員:",-1)),e("div",tm,[P(e("input",{type:"text","onUpdate:modelValue":x[0]||(x[0]=L=>u.value=L),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名、身份證、手機",onKeyup:Ue(W,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:k,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},x[7]||(x[7]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:U.value},l(U.value?"搜尋中...":"搜尋"),9,sm),x[9]||(x[9]=e("div",{class:"flex-grow"},null,-1)),e("button",{class:"px-4 py-2 bg-[#4e9875] hover:bg-[#3e7a5c] text-white",onClick:g}," 切換為"+l(z.value?"學分":"時數"),1)])]),x[15]||(x[15]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",am,[U.value?(t(),s("div",om,x[10]||(x[10]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",lm,[e("table",nm,[e("thead",null,[x[13]||(x[13]=e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",colspan:"2",scope:"colgroup"}),e("th",{class:"border p-2 text-center",colspan:"2",scope:"colgroup"},"資訊課程學分數"),e("th",{class:"border p-2 text-center",colspan:"2",scope:"colgroup"},"資安職能學分數"),e("th",{class:"border p-2 text-center",scope:"colgroup"},"合計")],-1)),e("tr",rm,[x[12]||(x[12]=e("th",{class:"border p-2 w-[60px]",scope:"col"},"序",-1)),e("th",im,[e("div",dm,[x[11]||(x[11]=me(" 姓名 ")),e("button",{onClick:x[1]||(x[1]=L=>D("studentName")),class:"ml-1 focus:outline-none"},[C.value==="studentName"&&o.value==="asc"?(t(),s("span",um,"▲")):C.value==="studentName"&&o.value==="desc"?(t(),s("span",cm,"▼")):(t(),s("span",pm,"⇅"))])])]),e("th",vm,[e("div",mm,[me(" 已完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:x[2]||(x[2]=L=>D("classCreditsCompleted")),class:"ml-1 focus:outline-none"},[C.value==="classCreditsCompleted"&&o.value==="asc"?(t(),s("span",bm,"▲")):C.value==="classCreditsCompleted"&&o.value==="desc"?(t(),s("span",fm,"▼")):(t(),s("span",ym,"⇅"))])])]),e("th",gm,[e("div",xm,[me(" 認列"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:x[3]||(x[3]=L=>D("classCertificatedCredits")),class:"ml-1 focus:outline-none"},[C.value==="classCertificatedCredits"&&o.value==="asc"?(t(),s("span",hm,"▲")):C.value==="classCertificatedCredits"&&o.value==="desc"?(t(),s("span",wm,"▼")):(t(),s("span",_m,"⇅"))])])]),e("th",km,[e("div",$m,[me(" 已完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:x[4]||(x[4]=L=>D("cyberSecCreditsCompleted")),class:"ml-1 focus:outline-none"},[C.value==="cyberSecCreditsCompleted"&&o.value==="asc"?(t(),s("span",Cm,"▲")):C.value==="cyberSecCreditsCompleted"&&o.value==="desc"?(t(),s("span",Em,"▼")):(t(),s("span",Sm,"⇅"))])])]),e("th",Dm,[e("div",Mm,[me(" 認列"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:x[5]||(x[5]=L=>D("cyberSecCertificatedCredits")),class:"ml-1 focus:outline-none"},[C.value==="cyberSecCertificatedCredits"&&o.value==="asc"?(t(),s("span",Am,"▲")):C.value==="cyberSecCertificatedCredits"&&o.value==="desc"?(t(),s("span",Im,"▼")):(t(),s("span",Rm,"⇅"))])])]),e("th",Pm,[e("div",Um,[me(" 總完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:x[6]||(x[6]=L=>D("earnedCredits")),class:"ml-1 focus:outline-none"},[C.value==="earnedCredits"&&o.value==="asc"?(t(),s("span",Nm,"▲")):C.value==="earnedCredits"&&o.value==="desc"?(t(),s("span",Tm,"▼")):(t(),s("span",Vm,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(T.value,(L,de)=>(t(),s("tr",{key:L.id,class:"cursor-pointer hover:bg-gray-100",onClick:xe=>j(L.id)},[e("td",Lm,l((N.value-1)*Bs+de+1),1),e("td",Fm,l(R(L.studentName)),1),e("td",Om,l(a(L.classCreditsCompleted)),1),e("td",qm,l(a(L.classCertificatedCredits)),1),e("td",Bm,l(a(L.cyberSecCreditsCompleted)),1),e("td",Hm,l(a(L.cyberSecCertificatedCredits)),1),e("td",Wm,l(a(L.earnedCredits)),1)],8,jm))),128)),T.value.length===0?(t(),s("tr",zm,x[14]||(x[14]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])])),!U.value&&T.value.length>0?(t(),s("div",Km,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===1||U.value,onClick:f}," 上一頁 ",8,Jm),(t(!0),s(X,null,le(Z.value,L=>(t(),s(X,{key:L},[L!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":L===N.value}]),disabled:U.value,onClick:de=>_(L)},l(L),11,Ym)):(t(),s("span",Gm,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===K.value||U.value,onClick:V}," 下一頁 ",8,Zm)])):G("",!0)])]))}},Xm=Fe(Qm,[["__scopeId","data-v-2f5ce219"]]),eb={class:"flex flex-col items-center p-6"},tb={class:"w-full max-w-[1500px]"},sb={class:"w-full max-w-[1500px] space-y-4"},ab={class:"flex items-center"},ob={class:"flex items-center"},lb={class:"flex items-center"},nb={class:"flex items-center space-x-4"},rb={class:"flex items-center"},ib={class:"flex items-center"},db={class:"flex items-center"},ub=["label"],cb=["value"],pb={class:"flex items-center"},vb={class:"flex items-center"},mb={class:"flex items-center"},bb={class:"w-32",for:"train-year"},fb=["placeholder"],yb={class:"flex items-center"},gb={class:"flex items-center"},xb={class:"flex items-center"},hb={class:"flex items-center"},wb={class:"flex items-center"},_b={class:"flex justify-center mt-8"},kb=["disabled"],$b={__name:"Credits",setup(M){const h=We(),d=m(1),u=m([]),C=m([]),o=m(null),N=Se(()=>d.value===1?"有效時間":"完訓時間"),K=Se(()=>d.value===1?"例：113/04/10":"例：113/04/30"),E=Se(()=>{const Z=U.value.CompletionDate;if(!Z)return!1;const $=Z.split("/");if($.length!==3)return!1;const c=parseInt($[0])+1911,y=parseInt($[1])-1,r=parseInt($[2]),b=new Date(c,y,r),p=new Date;return b.setHours(0,0,0,0),p.setHours(0,0,0,0),b.getTime()<p.getTime()}),U=m({studentName:"",idNumber:"",subjectName:"",traingUnit:"",CompletionDate:"",credit:0,courseSubjectId:0,trainingPeriod:"",certificateNumber:"",referenceDate:"",grade:null}),T=m(!1),z=()=>!U.value.studentName||!U.value.studentName.trim()?(v.showError("表單驗證失敗","請填寫申請學員姓名"),!1):!U.value.idNumber||!U.value.idNumber.trim()?(v.showError("表單驗證失敗","請填寫身分證字號"),!1):o.value?!U.value.subjectName||!U.value.subjectName.trim()?(v.showError("表單驗證失敗","請填寫課程名稱"),!1):!U.value.traingUnit||!U.value.traingUnit.trim()?(v.showError("表單驗證失敗","請填寫完訓學校"),!1):!U.value.CompletionDate||!U.value.CompletionDate.trim()?(v.showError("表單驗證失敗","請填寫完訓時間"),!1):!U.value.trainingPeriod||!U.value.trainingPeriod.trim()?(v.showError("表單驗證失敗","請填寫訓練起訖時間"),!1):!U.value.credit||isNaN(parseFloat(U.value.credit))||parseFloat(U.value.credit)<=0?(v.showError("表單驗證失敗","請填寫有效的學分數"),!1):!0:(v.showError("表單驗證失敗","請選擇科目"),!1),g=async()=>{try{if(console.log("開始提交表單..."),T.value=!0,!z()){T.value=!1;return}const Z={studentName:U.value.studentName,idNumber:U.value.idNumber,category:d.value,subjectName:U.value.subjectName,courseSubjectId:o.value?o.value.id:null,traingUnit:U.value.traingUnit,CompletionDate:U.value.CompletionDate,trainingPeriod:U.value.trainingPeriod,certificateNumber:U.value.certificateNumber,referenceDate:U.value.referenceDate,credit:parseFloat(U.value.credit),grade:U.value.grade};console.log("準備提交學分認證數據:",Z);const $=await Lt.creditCertification(Z);console.log("學分認證響應:",$.data),$.data.code===0&&$.data.message==="success"?(U.value={studentName:"",idNumber:"",subjectName:"",traingUnit:"",CompletionDate:"",credit:0,courseSubjectId:null,trainingPeriod:"",certificateNumber:"",referenceDate:"",grade:null},o.value=null,v.showSuccess("學分認證成功","學分認證申請已成功提交"),h.push("/credit-list")):(console.error("學分認證失敗:",$.data.message),v.showError("學分認證失敗",$.data.message||"學分認證申請失敗"))}catch(Z){if(console.error("學分認證整體錯誤:",Z),Z.response){console.error("API錯誤響應:",Z.response.status,Z.response.data);const $=Z.response.data.message||"學分認證申請失敗";v.showError("學分認證失敗",$)}else Z.request?(console.error("未收到API響應:",Z.request),v.showError("學分認證失敗","伺服器無響應，請稍後再試")):(console.error("API請求設置錯誤:",Z.message),v.showError("學分認證失敗","請求發送失敗，請稍後再試"))}finally{T.value=!1,console.log("表單提交處理完成")}};je(async()=>{try{const Z=await nt.getCourseSubjects();Z.data.code===0&&Z.data.data?(u.value=Z.data.data,a(d.value)):v.showError("載入失敗",Z.data.message||"獲取科目選項失敗")}catch(Z){console.error("獲取科目選項錯誤:",Z),v.showError("載入錯誤","獲取科目選項時發生錯誤")}});const a=Z=>{C.value=u.value.map(c=>{const y=c.items.filter(r=>Z===1&&r.isCyberSecClass||Z===2&&!r.isCyberSecClass);return{...c,items:y}}).filter(c=>c.items.length>0);const $=C.value.flatMap(c=>c.items);o.value&&!$.some(c=>c.id===o.value.id)&&(o.value=null)};Ee(d,Z=>{a(Z)});const R=()=>{const Z=U.value.trainingPeriod,$=d.value;if(!Z){U.value.CompletionDate="";return}const c=Z.split("-");let y="";c.length===2?y=c[1].trim():y=Z.trim();const r=y.split("/");if(r.length!==3){U.value.CompletionDate="";return}const b=parseInt(r[0])+1911,p=parseInt(r[1])-1,_=parseInt(r[2]);let f=new Date(b,p,_);$===1?f.setFullYear(f.getFullYear()+5):$===2&&f.setFullYear(f.getFullYear()+10);const V=f.getFullYear()-1911,W=(f.getMonth()+1).toString().padStart(2,"0"),H=f.getDate().toString().padStart(2,"0");U.value.CompletionDate=`${V}/${W}/${H}`};return Ee([()=>U.value.trainingPeriod,d],()=>{R()}),(Z,$)=>(t(),s("div",eb,[e("div",tb,[Ge(ft,{breadcrumbs:[{name:"認列清單",path:"/credit-list"},{name:"學分認列",path:"/credits"}]})]),e("div",sb,[e("div",ab,[$[13]||($[13]=e("label",{class:"w-32",for:"student-name"},"申請學員:",-1)),P(e("input",{id:"student-name","onUpdate:modelValue":$[0]||($[0]=c=>U.value.studentName=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.studentName]])]),e("div",ob,[$[14]||($[14]=e("label",{class:"w-32",for:"id-number"},"身分證字號:",-1)),P(e("input",{id:"id-number","onUpdate:modelValue":$[1]||($[1]=c=>U.value.idNumber=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.idNumber]])]),e("div",lb,[$[17]||($[17]=e("label",{class:"w-32",for:"course-type-1"},"課程類別:",-1)),e("div",nb,[e("label",rb,[P(e("input",{id:"course-type-1",type:"radio","onUpdate:modelValue":$[2]||($[2]=c=>d.value=c),value:1,class:"w-4 h-4 mr-1"},null,512),[[bt,d.value]]),$[15]||($[15]=e("span",null,"資安職能認列學分數",-1))]),e("label",ib,[P(e("input",{type:"radio","onUpdate:modelValue":$[3]||($[3]=c=>d.value=c),value:2,class:"w-4 h-4 mr-1"},null,512),[[bt,d.value]]),$[16]||($[16]=e("span",null,"資訊課程認列學分數",-1))])])]),e("div",db,[$[19]||($[19]=e("label",{class:"w-32",for:"course-subject"},"科目名稱:",-1)),P(e("select",{id:"course-subject","onUpdate:modelValue":$[4]||($[4]=c=>o.value=c),class:"p-2 border border-gray-300 outline-none w-60"},[$[18]||($[18]=e("option",{value:null},"請選擇科目",-1)),(t(!0),s(X,null,le(C.value,c=>(t(),s("optgroup",{key:c.name,label:c.name},[(t(!0),s(X,null,le(c.items,y=>(t(),s("option",{key:y.id,value:y},l(y.name),9,cb))),128))],8,ub))),128))],512),[[Pe,o.value]])]),e("div",pb,[$[20]||($[20]=e("label",{class:"w-32",for:"course-name"},"課程名稱:",-1)),P(e("input",{id:"course-name","onUpdate:modelValue":$[5]||($[5]=c=>U.value.subjectName=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.subjectName]]),$[21]||($[21]=e("div",{class:"text-gray-500 text-sm ml-2"},"(學分班近10年或職能班近5年進修科目相同之訓練課程)",-1))]),e("div",vb,[$[22]||($[22]=e("label",{class:"w-32",for:"train-school"},"完訓學校:",-1)),P(e("input",{id:"train-school","onUpdate:modelValue":$[6]||($[6]=c=>U.value.traingUnit=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.traingUnit]])]),e("div",mb,[e("label",bb,l(N.value)+":",1),P(e("input",{id:"train-year","onUpdate:modelValue":$[7]||($[7]=c=>U.value.CompletionDate=c),type:"text",class:ee(["p-2 border border-gray-300 outline-none w-60",{"text-red-500":E.value}]),placeholder:K.value},null,10,fb),[[te,U.value.CompletionDate]])]),e("div",yb,[$[23]||($[23]=e("label",{class:"w-32",for:"training-period"},"訓練起訖時間:",-1)),P(e("input",{id:"training-period","onUpdate:modelValue":$[8]||($[8]=c=>U.value.trainingPeriod=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60",placeholder:"例：112/03/01-112/03/31"},null,512),[[te,U.value.trainingPeriod]])]),e("div",gb,[$[24]||($[24]=e("label",{class:"w-32",for:"reference-date"},"參照日期起訖:",-1)),P(e("input",{id:"reference-date","onUpdate:modelValue":$[9]||($[9]=c=>U.value.referenceDate=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60",placeholder:"例：113/04/01-113/04/30"},null,512),[[te,U.value.referenceDate]]),$[25]||($[25]=e("div",{class:"text-gray-500 text-sm ml-2"},"(評量效期)",-1))]),e("div",xb,[$[26]||($[26]=e("label",{class:"w-32",for:"credit"},"學分數:",-1)),P(e("input",{id:"credit","onUpdate:modelValue":$[10]||($[10]=c=>U.value.credit=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.credit]])]),e("div",hb,[$[27]||($[27]=e("label",{class:"w-32",for:"grade"},"成績:",-1)),P(e("input",{id:"grade","onUpdate:modelValue":$[11]||($[11]=c=>U.value.grade=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.grade]])]),e("div",wb,[$[28]||($[28]=e("label",{class:"w-32",for:"certificate-number"},"證書編號:",-1)),P(e("input",{id:"certificate-number","onUpdate:modelValue":$[12]||($[12]=c=>U.value.certificateNumber=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[te,U.value.certificateNumber]])]),e("div",_b,[e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#438264] disabled:opacity-50 disabled:cursor-not-allowed",onClick:g,disabled:T.value,"aria-label":"送出學分認列申請"},l(T.value?"處理中...":"送出"),9,kb)])])]))}},Cb=Fe($b,[["__scopeId","data-v-23a59e52"]]),Mt={getExpenseList:M=>be.get("/v1/verification",{params:M}),getExpenseById:M=>be.get(`/v1/verification/${M}`),getStudentInfo:(M,h)=>be.get("/v1/verification/studentInfo",{params:{studentId:M,tab:h}}),updateExpenseStatus:(M,h)=>be.put(`/v1/verification/${M}`,h),getApplicationInfo:M=>be.get(`/v1/verification/info/${M}`),updateApplication:M=>be.put(`/v1/verification/${M.orderId}`,M),createExpense:M=>be.post("/v1/verification",M),getRemittanceApplications:()=>be.get("/v1/verification/remittance"),createRemittance:M=>be.post("/v1/verification/remittance",M),getRemittanceDetail:M=>be.get(`/v1/verification/remittance/${M}`),updateRemittance:M=>be.put(`/v1/verification/remittance/${M.remittanceId}`,M),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),exportRemittanceList:M=>be.post("/v1/verification/remittance/exportList",M,{responseType:"blob"}),exportRemittanceDetail:M=>be.post("/v1/verification/remittance/export",M,{responseType:"blob"}),rejectApplication:M=>be.post("/v1/verification/reject",M),exportNoPassExcel:M=>be.post("/v1/verification/export/nopass",M,{responseType:"blob"}),exportPassExcel:M=>be.post("/v1/verification/export/pass",M,{responseType:"blob"})},Eb={class:"flex flex-col items-center p-6"},Sb={class:"w-full max-w-[1500px]"},Db={class:"w-full max-w-[1500px]"},Mb={class:"mb-4 flex items-center"},Ab={class:"text-xl font-bold"},Ib={class:"mr-4"},Rb={class:"mb-4 border-b"},Pb={class:"flex"},Ub={key:0,class:"overflow-x-auto"},Nb={class:"w-full border-collapse min-w-full max-w-[1500px]"},Tb={class:"border p-2 text-center"},Vb={class:"border p-2 text-center"},jb={class:"border p-2 text-center"},Lb={class:"border p-2 text-center whitespace-pre-line"},Fb={class:"border p-2 text-center"},Ob={class:"border p-2 text-center"},qb={class:"border p-2 text-center"},Bb={class:"border p-2 text-center"},Hb={class:"border p-2 text-center"},Wb={class:"border p-2 text-center"},zb={class:"border p-2 text-center"},Kb={class:"border p-2 text-center"},Jb={key:1},Yb={class:"flex justify-end mb-4"},Gb={class:"overflow-x-auto"},Zb={class:"w-full border-collapse min-w-full max-w-[1500px]"},Qb=["onClick"],Xb={class:"border p-2 text-center"},ef={class:"border p-2 text-center"},tf={class:"border p-2 text-center"},sf={class:"border p-2 text-center"},af={class:"border p-2 text-center"},of={class:"border p-2 text-center"},lf={__name:"Expense",setup(M){const h=rt(),d=We(),u=m("history"),C=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:""}),o=m(""),N=m([]),K=m([]),E=m({verificationCreate:!1}),U=$=>$==null?"$------":`$${$.toLocaleString()}`,T=$=>{switch(parseInt($)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";case 5:return"待補件，不合格";default:return"未知狀態"}},z=$=>{switch(typeof $=="string"?parseInt($):$){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=()=>{d.push({path:"/grant-application",query:{studentId:C.value.id}})},a=$=>{d.push({path:"/grant-application-edit",query:{studentId:C.value.id,applicationId:$}})},R=async()=>{var $;try{const c=h.query.studentId,y=u.value==="history"?1:2;if(!c)return;const r=await Mt.getStudentInfo(c,y);if(r.data&&r.data.code===0){const b=r.data.data;C.value={id:b.studentId,studentName:b.studentName,bankCode:b.bankCode,branchCode:b.branchCode,bankAccount:b.bankAccount,studentIdentity:b.studentIdentity},o.value=b.agencyName,y===1?N.value=b.histories.map(p=>({id:p.learningHistoryId,courseCode:p.courseCode,courseName:p.courseName,schoolName:p.schoolName,startDate:p.startDate,endDate:p.endDate,hours:p.hours,status:p.status,certificateNumber:p.certificateNumber,credits:p.credits,subsidyCount:p.subsidyCount,applied:p.applied,remark:p.remark||"",accumulatedSubsidy:p.approvedAmount||0})):K.value=b.verifications.map(p=>({id:p.orderId,applyDate:p.applicationTime,batchNumber:p.batchNumber||"--",orderNumber:p.caseNumber,applyAmount:p.subsidyAmount,receiptAmount:p.receiptAmount,status:p.status}))}else{const b=(($=r.data)==null?void 0:$.message)||"獲取資料失敗，請稍後再試";throw new Error(b)}}catch(c){console.error("獲取費用核撥詳情失敗:",c),v.showError("貼心提醒","獲取費用核撥詳情失敗，即將返回列表頁"),d.push("/expense-list")}},Z=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?(E.value=$.data.data,console.log("費用核撥頁面權限:",E.value)):console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}};return Ee(u,async $=>{d.replace({query:{...h.query,tab:$}}),await R()}),je(()=>{if(!h.query.studentId){h.path==="/expense"&&(v.showError("貼心提醒","缺少必要的參數，請先選擇學員"),d.push("/expense-list"));return}if(h.query.tab){const c=h.query.tab;["history","applications"].includes(c)&&(u.value=c)}else d.replace({query:{...h.query,tab:u.value}});R(),Z()}),($,c)=>(t(),s("div",Eb,[e("div",Sb,[Ge(ft,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:"/expense"}]})]),e("div",Db,[e("div",Mb,[e("div",Ab,[e("span",Ib,l(o.value),1),e("span",null,[me(l(C.value.studentName)+" ",1),C.value.studentIdentity===1?(t(),s(X,{key:0},[me(" 全修班 ")],64)):C.value.studentIdentity===2?(t(),s(X,{key:1},[me(" 選修班 ")],64)):G("",!0)])])]),e("div",Rb,[e("div",Pb,[e("button",{class:ee(["px-4 py-2 mr-10 font-medium",u.value==="history"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-[#4e9875]"]),onClick:c[0]||(c[0]=y=>u.value="history")}," 學習歷程 ",2),e("button",{class:ee(["px-4 py-2 font-medium",u.value==="applications"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-[#4e9875]"]),onClick:c[1]||(c[1]=y=>u.value="applications")}," 申請表單 ",2)])]),u.value==="history"?(t(),s("div",Ub,[e("table",Nb,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"課程代號"),e("th",{class:"border p-2"},"科目"),e("th",{class:"border p-2"},"訓練單位"),e("th",{class:"border p-2"},"訓練日期起訖"),e("th",{class:"border p-2"},"上課時數"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"學分證書編號"),e("th",{class:"border p-2"},"取得學分"),e("th",{class:"border p-2"},"累積核撥費用"),e("th",{class:"border p-2"},[me("申請補助"),e("br"),me("次數")]),e("th",{class:"border p-2"},[me("已申請"),e("br"),me("(%)")]),e("th",{class:"border p-2"},"備註")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(N.value,(y,r)=>(t(),s("tr",{key:y.id,class:ee({"bg-[#F7F7F7]":r%2===1})},[e("td",Tb,l(y.courseCode),1),e("td",Vb,l(y.courseName),1),e("td",jb,l(y.schoolName),1),e("td",Lb,l(y.startDate)+"~"+l(y.endDate),1),e("td",Fb,l(y.hours),1),e("td",Ob,l(y.status),1),e("td",qb,l(y.certificateNumber||"--"),1),e("td",Bb,l(y.credits),1),e("td",Hb,l(U(y.accumulatedSubsidy)),1),e("td",Wb,l(y.subsidyCount),1),e("td",zb,l(y.applied),1),e("td",Kb,l(y.remark||"--"),1)],2))),128))])])])):G("",!0),u.value==="applications"?(t(),s("div",Jb,[e("div",Yb,[E.value.verificationCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] flex items-center",onClick:g},"新增申請單 ")):G("",!0)]),e("div",Gb,[e("table",Zb,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"申請日期"),e("th",{class:"border p-2"},"批號"),e("th",{class:"border p-2"},"單號"),e("th",{class:"border p-2"},"申請金額"),e("th",{class:"border p-2"},"收據金額"),e("th",{class:"border p-2"},"申請單狀態")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(K.value,(y,r)=>(t(),s("tr",{key:r,class:ee([{"bg-[#F7F7F7]":r%2===1},"hover:bg-gray-100 cursor-pointer"]),onClick:b=>a(y.id)},[e("td",Xb,l(y.applyDate),1),e("td",ef,l(y.batchNumber),1),e("td",tf,l(y.orderNumber),1),e("td",sf,l(U(y.applyAmount)),1),e("td",af,l(U(y.receiptAmount)),1),e("td",of,[e("span",{class:ee(["px-2 py-1 rounded text-sm",z(y.status)])},l(T(y.status)),3)])],10,Qb))),128))])])])])):G("",!0)])]))}},nf=Fe(lf,[["__scopeId","data-v-05893bb8"]]),Vs={getEffectTracking:M=>be.get("/v1/effectTracking",{params:M}),updateEffectTracking:(M,h)=>be.put(`/v1/effectTracking/${M}`,h),getDeclaration:M=>be.get(`/v1/effectTracking/declaration/${M}`),updateDeclaration:(M,h)=>be.put(`/v1/effectTracking/declaration/${M}`,h)},rf={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},df={class:"bg-white rounded-md shadow-lg w-[800px] max-w-[90%] max-h-[90vh] overflow-auto"},uf={class:"p-4"},cf={class:"w-full border border-black"},pf={class:"w-full border-collapse"},vf={class:"border-t border-black"},mf={class:"p-4"},bf={class:"checkbox-item"},ff={class:"checkbox-item"},yf={class:"checkbox-item"},gf={class:"checkbox-item"},xf={class:"border-t border-black"},hf={class:"p-4"},wf={class:"checkbox-item"},_f={class:"checkbox-item"},kf={class:"checkbox-item"},$f={class:"checkbox-item"},Cf={class:"checkbox-item"},Ef={class:"border-t border-black"},Sf={class:"p-4"},Df={class:"checkbox-item"},Mf={class:"checkbox-item"},Af={class:"checkbox-item"},If={class:"checkbox-item"},Rf={class:"border-t border-black"},Pf={class:"p-4"},Uf={class:"checkbox-item"},Nf={id:"otherRemarkGroup",class:"flex-1 leading-6"},Tf={class:"border-b border-black inline-block ml-2 w-[200px] align-text-bottom"},Vf=["disabled"],jf={class:"p-4 border-t flex justify-center space-x-4"},Lf=["disabled"],Ff={__name:"Certificate",props:{studentId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(M,{emit:h}){const d=M,u=h,C=m(d.show);Ee(()=>d.show,$=>{C.value=$,$&&d.studentId&&(U(),T())}),Ee(()=>d.studentId,($,c)=>{$&&C.value&&(U(),T())});const o=m({strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}),N=m(!1),K=m({performanceTrackingEdit:!1}),E=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?(K.value=$.data.data,console.log("職務內容頁面權限:",K.value)):console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}},U=()=>{d.initialData&&Object.keys(d.initialData).length>0?o.value={strategies:{...d.initialData.strategies},management:{...d.initialData.management},technical:{...d.initialData.technical},otherSelected:!!(d.initialData.remark&&String(d.initialData.remark).trim()),remark:d.initialData.remark||""}:o.value={strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}},T=async()=>{var $;if(d.studentId)try{const c=await Vs.getDeclaration(d.studentId);if(c&&c.data&&c.data.code===0){const y=c.data.data.options||[],r=c.data.data.remark||"";g(),y.forEach(b=>{z(b)}),o.value.remark=r}else console.error("API 返回錯誤:",(($=c==null?void 0:c.data)==null?void 0:$.message)||"未知錯誤")}catch(c){console.error("獲取資安工作項目數據失敗:",c),console.error("詳細錯誤信息:",c.response||c.message||c),v.showError("資料載入失敗","無法獲取職務內容資料")}},z=$=>{$>=1&&$<=4?o.value.strategies[`strategy${$}`]=!0:$>=5&&$<=9?o.value.management[`management${$-4}`]=!0:$>=10&&$<=13?o.value.technical[`technical${$-9}`]=!0:$===14&&(o.value.otherSelected=!0)},g=()=>{o.value={strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}},a=()=>{const $=[];for(let c=1;c<=4;c++)o.value.strategies[`strategy${c}`]&&$.push(c);for(let c=1;c<=5;c++)o.value.management[`management${c}`]&&$.push(c+4);for(let c=1;c<=4;c++)o.value.technical[`technical${c}`]&&$.push(c+9);return o.value.otherSelected&&$.push(14),$},R=async()=>{u("close")},Z=async()=>{var $;try{if(N.value=!0,!d.studentId){console.error("儲存失敗: 無學生ID"),v.showError("儲存失敗","無法識別學生資訊");return}const c=a();console.log("儲存前獲取的選項:",c);const y={studentId:d.studentId,options:c,remark:o.value.otherSelected?String(o.value.remark).trim():null};console.log("準備儲存資安工作項目數據:",y),console.log("API 請求路徑:",`/v1/effectTracking/declaration/${d.studentId}`);const r=await Vs.updateDeclaration(d.studentId,y);if(console.log("API 返回完整響應:",r),r&&r.data&&r.data.code===0)console.log("儲存成功:",r.data),v.showSuccess("儲存成功","資料已成功儲存"),u("save",y);else{const b=(($=r.data)==null?void 0:$.message)||"儲存失敗，請稍後再試";console.error("API 返回錯誤:",b),v.showError("儲存失敗",b)}}catch(c){console.error("儲存失敗:",c),console.error("詳細錯誤信息:",c.response||c.message||c),v.showError("儲存失敗",c.message||"儲存資料時發生錯誤")}finally{N.value=!1}};return je(()=>{console.log("Certificate 組件掛載，props.show =",d.show,"，studentId =",d.studentId),E(),U(),d.show&&d.studentId&&T()}),($,c)=>C.value?(t(),s("div",rf,[e("div",df,[e("div",{class:"p-4 border-b flex justify-between items-center"},[c[16]||(c[16]=e("h2",{class:"text-xl font-bold"},"投入資安工作項目",-1)),e("button",{onClick:R,class:"text-gray-500 hover:text-gray-700"},c[15]||(c[15]=[e("span",{class:"text-2xl"},"×",-1)]))]),e("div",uf,[e("div",cf,[c[35]||(c[35]=e("div",{class:"p-4 bg-[#5ea989] text-white font-bold text-center"}," 資通安全專職人員之職務內容分策略面、管理面及技術面等三大面向（可複選） ",-1)),e("table",pf,[e("tbody",null,[e("tr",vf,[c[21]||(c[21]=e("th",{class:"w-[15%] border-r border-black p-4 font-bold text-center"},"策略面",-1)),e("td",mf,[e("div",bf,[P(e("input",{type:"checkbox",id:"strategy1","onUpdate:modelValue":c[0]||(c[0]=y=>o.value.strategies.strategy1=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy1]]),c[17]||(c[17]=e("label",{for:"strategy1"},"機關（及所屬）資安政策、資源分配及整體防護策略之規劃。",-1))]),e("div",ff,[P(e("input",{type:"checkbox",id:"strategy2","onUpdate:modelValue":c[1]||(c[1]=y=>o.value.strategies.strategy2=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy2]]),c[18]||(c[18]=e("label",{for:"strategy2"},"機關導入資安治理成熟度之協調與推動。",-1))]),e("div",yf,[P(e("input",{type:"checkbox",id:"strategy3","onUpdate:modelValue":c[2]||(c[2]=y=>o.value.strategies.strategy3=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy3]]),c[19]||(c[19]=e("label",{for:"strategy3"},"資通安全維護計畫實施情形之績效評估與檢討。",-1))]),e("div",gf,[P(e("input",{type:"checkbox",id:"strategy4","onUpdate:modelValue":c[3]||(c[3]=y=>o.value.strategies.strategy4=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy4]]),c[20]||(c[20]=e("label",{for:"strategy4"},"（屬上級或監管機關者）稽核所屬（或監管）公務機關之資通安全維護計畫實施情形。",-1))])])]),e("tr",xf,[c[27]||(c[27]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"管理面",-1)),e("td",hf,[e("div",wf,[P(e("input",{type:"checkbox",id:"management1","onUpdate:modelValue":c[4]||(c[4]=y=>o.value.management.management1=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management1]]),c[22]||(c[22]=e("label",{for:"management1"},"訂定、修正及實施資通安全維護計畫並提出實施情形。",-1))]),e("div",_f,[P(e("input",{type:"checkbox",id:"management2","onUpdate:modelValue":c[5]||(c[5]=y=>o.value.management.management2=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management2]]),c[23]||(c[23]=e("label",{for:"management2"},"訂定及建立資通安全事件通報及應變機制。",-1))]),e("div",kf,[P(e("input",{type:"checkbox",id:"management3","onUpdate:modelValue":c[6]||(c[6]=y=>o.value.management.management3=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management3]]),c[24]||(c[24]=e("label",{for:"management3"},"辦理下列機關資通安全責任等級之應辦事項：資訊安全管理系統之導入及通過公正第三方之驗證、業務持續運作演練、辦理資通安全教育訓練等。",-1))]),e("div",$f,[P(e("input",{type:"checkbox",id:"management4","onUpdate:modelValue":c[7]||(c[7]=y=>o.value.management.management4=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management4]]),c[25]||(c[25]=e("label",{for:"management4"},"（屬上級或監管機關者）針對所屬（或監管）公務機關，審查其資通安全維護計畫及實施情形、辦理其資通安全事件通報之審核、應變協處與改善報告之審核。",-1))]),e("div",Cf,[P(e("input",{type:"checkbox",id:"management5","onUpdate:modelValue":c[8]||(c[8]=y=>o.value.management.management5=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management5]]),c[26]||(c[26]=e("label",{for:"management5"},"委外廠商管理與稽核。",-1))])])]),e("tr",Ef,[c[32]||(c[32]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"技術面",-1)),e("td",Sf,[e("div",Df,[P(e("input",{type:"checkbox",id:"technical1","onUpdate:modelValue":c[9]||(c[9]=y=>o.value.technical.technical1=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical1]]),c[28]||(c[28]=e("label",{for:"technical1"},"整合、分析與分享資通安全情資。",-1))]),e("div",Mf,[P(e("input",{type:"checkbox",id:"technical2","onUpdate:modelValue":c[10]||(c[10]=y=>o.value.technical.technical2=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical2]]),c[29]||(c[29]=e("label",{for:"technical2"},"配合主管機關辦理機關資通安全演練作業。",-1))]),e("div",Af,[P(e("input",{type:"checkbox",id:"technical3","onUpdate:modelValue":c[11]||(c[11]=y=>o.value.technical.technical3=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical3]]),c[30]||(c[30]=e("label",{for:"technical3"},"辦理下列機關資通安全責任等級之應辦事項：安全性檢測、資通安全健診、資通安全威脅偵測管理機制、政府組態基準、資通安全防護等。",-1))]),e("div",If,[P(e("input",{type:"checkbox",id:"technical4","onUpdate:modelValue":c[12]||(c[12]=y=>o.value.technical.technical4=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical4]]),c[31]||(c[31]=e("label",{for:"technical4"},"（屬上級或監管機關者）針對所屬（或監管）公務機關，規劃及辦理資通安全演練作業。",-1))])])]),e("tr",Rf,[c[34]||(c[34]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"其他",-1)),e("td",Pf,[e("div",Uf,[P(e("input",{type:"checkbox",id:"otherRemark","onUpdate:modelValue":c[13]||(c[13]=y=>o.value.otherSelected=y),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2","aria-controls":"otherRemarkGroup"},null,512),[[Ce,o.value.otherSelected]]),e("div",Nf,[c[33]||(c[33]=e("label",{for:"otherRemark",class:"inline"}," 擔任機關資安專責人員，主要其他涉及（資通安全管理法）所定應辦事項或防護措施執行等資安工作，具體項目說明如右： ",-1)),e("div",Tf,[P(e("input",{type:"text","onUpdate:modelValue":c[14]||(c[14]=y=>o.value.remark=y),class:"w-full outline-none",disabled:!o.value.otherSelected,"aria-label":"具體項目說明如右"},null,8,Vf),[[te,o.value.remark]])])])])])])])])])]),e("div",jf,[K.value.performanceTrackingEdit?(t(),s("button",{key:0,class:"px-8 py-2 rounded-md bg-[#4e9875] text-white hover:bg-[#4d8b6f]",onClick:Z,disabled:N.value},l(N.value?"儲存中...":"確認"),9,Lf)):G("",!0),e("button",{class:"px-8 py-2 rounded-md bg-gray-400 text-white hover:bg-gray-500",onClick:R}," 取消 ")])])])):G("",!0)}},qs=Fe(Ff,[["__scopeId","data-v-c4206363"]]),Of={class:"flex flex-col items-center p-6"},qf={class:"w-full max-w-[1500px]"},Bf={class:"w-full max-w-[1500px] flex items-center space-x-4 mb-6"},Hf={class:"relative w-40"},Wf=["value"],zf=["value"],Kf={class:"w-full max-w-[1500px]"},Jf={key:0,class:"flex justify-center items-center py-10"},Yf={key:1,class:"w-full border-collapse"},Gf={class:"border p-2"},Zf={class:"flex items-center justify-center"},Qf={key:0},Xf={key:1},ey={key:2},ty={class:"border p-2"},sy={class:"flex items-center justify-center"},ay={key:0},oy={key:1},ly={key:2},ny={class:"border p-2"},ry={class:"flex items-center justify-center"},iy={key:0},dy={key:1},uy={key:2},cy={class:"border p-2"},py={class:"flex items-center justify-center"},vy={key:0},my={key:1},by={key:2},fy={class:"border p-2"},yy={class:"flex items-center justify-center"},gy={key:0},xy={key:1},hy={key:2},wy={class:"border p-2"},_y={class:"flex items-center justify-center"},ky={key:0},$y={key:1},Cy={key:2},Ey={class:"border p-2"},Sy={class:"flex items-center justify-center"},Dy={key:0},My={key:1},Ay={key:2},Iy={class:"border p-2 text-center"},Ry={class:"border p-2 text-center"},Py={class:"border p-2 text-center"},Uy={class:"border p-2 text-center"},Ny={class:"border p-2 text-center"},Ty={class:"border p-2 text-center"},Vy={class:"border p-2 text-center"},jy={class:"border p-2 text-center"},Ly={class:"border p-2 text-center space-x-2"},Fy=["onClick"],Oy=["onClick"],qy={key:0},By={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Hy=["disabled"],Wy=["onClick"],zy={key:1,class:"px-2"},Ky=["disabled"],Jy={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Yy={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},Gy={class:"border border-gray-300 p-4 mb-4"},Zy={class:"mb-4"},Qy={class:"flex items-center mb-4"},Xy={class:"flex items-center space-x-4"},e1={class:"flex items-center"},t1={class:"flex items-center"},s1={class:"flex items-center"},a1={class:"flex items-center mb-4"},o1={class:"flex items-center"},l1={class:"flex items-center mb-4"},n1={class:"flex items-center"},r1={class:"flex items-center mt-1 ml-32"},i1={class:"border-b border-black w-full"},d1={class:"mt-4 p-3 border border-gray-300 mb-4"},u1={class:"grid grid-cols-2 gap-4"},c1={class:"border-b border-black w-full"},p1={class:"border-b border-black w-full"},v1={class:"border-b border-black w-full"},m1={class:"border-b border-black w-full"},b1={key:0,class:"ml-7"},f1={class:"mt-2"},y1={class:"flex items-start mb-2"},g1={class:"flex items-start mb-2"},x1={class:"flex items-start"},h1={class:"border-b border-black w-64 ml-2"},w1=["disabled"],_1={class:"flex justify-center space-x-2"},k1=["disabled"],$1={__name:"Management",setup(M){const h=We(),d=rt(),u=m({performanceTrackingEdit:!1}),C=async()=>{try{const ne=await ot.getSidebarPermissions();ne.data.code===0&&ne.data.message==="success"?(u.value=ne.data.data,console.log("追蹤管理頁面權限:",u.value)):console.error("獲取權限失敗:",ne.data.message)}catch(ne){console.error("獲取權限錯誤:",ne)}},o=m(""),N=m(""),K=m(""),E=m([]),U=m([]),T=m(1),z=m(20),g=m(1),a=m(0),R=m(!1),Z=m([]),$=m(""),c=m("asc"),y=m(!1),r=m(null),b=m(0),p=m(""),_=m(""),f=m(""),V=m(""),W=m(0),H=m(""),k=m(0),D=m(""),j=m(!1),S=m(null),x=m({}),L=Se(()=>!(!k.value||!b.value||Number(b.value)===2&&(!W.value||Number(W.value)===3&&!H.value.trim()))),de=async()=>{var ne;try{const se=await nt.getAgencyOptions();se.data&&se.data.code===0?E.value=se.data.data:console.error("獲取機關選項失敗:",((ne=se.data)==null?void 0:ne.message)||"未知錯誤")}catch(se){console.error("獲取機關選項錯誤:",se)}},xe=async()=>{var ne;try{const se=await nt.getStudentStatusOptions();se.data&&se.data.code===0?U.value=se.data.data:(console.error("獲取學員受訓狀態選項失敗:",((ne=se.data)==null?void 0:ne.message)||"未知錯誤"),U.value=[])}catch(se){console.error("獲取學員受訓狀態選項錯誤:",se),U.value=[]}},fe=Se(()=>{const ne=[];if(g.value<=5)for(let re=1;re<=g.value;re++)ne.push(re);else{ne.push(1);let re=Math.max(2,T.value-1),Te=Math.min(g.value-1,T.value+1);T.value<=3&&(Te=Math.min(4,g.value-1)),T.value>=g.value-2&&(re=Math.max(2,g.value-3)),re>2&&ne.push("...");for(let Be=re;Be<=Te;Be++)ne.push(Be);Te<g.value-1&&ne.push("..."),ne.push(g.value)}return ne}),ke=async()=>{try{R.value=!0;const ne={page:T.value,limit:z.value,agencyId:o.value||void 0,status:N.value||void 0,sortBy:$.value||void 0,sortOrder:c.value||void 0,keyword:K.value||void 0};console.log("獲取追蹤成效參數:",ne);const se=await Vs.getEffectTracking(ne);se.data.code===0?(Z.value=se.data.data.list.map(re=>({id:re.id,studentId:re.id,name:re.name,idNumber:re.idNumber,certificatedHours:re.certificatedHours||0,trainingHours:re.trainingHours||0,totalHours:re.totalHours||0,status:re.status,subAgencyName:re.subAgencyName,selectItem:re.selectItem,originalPosition:re.originalPosition||"",currentPosition:re.currentPosition||"",originalAgency:re.originalAgency||"",currentAgency:re.currentAgency||"",fillMethod:re.fillMethod,trackingReasonOption:re.trackingReasonOption,trackingReasonDetail:re.trackingReasonDetail||"",secWorkDetail:re.secWorkDetail,jobDescription:re.jobDescription,transferDate:re.transferDate||""})),a.value=se.data.data.totalCount||0,g.value=Math.ceil(a.value/z.value)):(console.error("獲取追蹤成效列表失敗:",se.data.message),Z.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗",se.data.message||"無法獲取追蹤成效列表，請稍後再試"))}catch(ne){console.error("獲取追蹤成效列表錯誤:",ne),Z.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗","無法獲取追蹤成效列表，請稍後再試")}finally{R.value=!1}},De=Se(()=>Z.value),we=ne=>{T.value=ne,ke()},$e=()=>{T.value>1&&(T.value--,ke())},ae=()=>{T.value<g.value&&(T.value++,ke())},O=ne=>{$.value===ne?c.value=c.value==="asc"?"desc":"asc":($.value=ne,c.value="asc"),ke()},A=ne=>{r.value=ne,b.value=ne.selectItem||0,p.value=ne.originalPosition||"",_.value=ne.currentPosition||"",f.value=ne.originalAgency||"",V.value=ne.currentAgency||"",W.value=ne.trackingReasonOption||0,H.value=ne.trackingReasonDetail||"",k.value=ne.fillMethod||0,D.value=ne.transferDate||"",y.value=!0},J=()=>{y.value=!1,r.value=null},Q=async()=>{var ne;if(r.value)try{const se={selectItem:b.value,originalPosition:p.value,currentPosition:_.value,originalAgency:f.value,currentAgency:V.value,trackingReasonOption:W.value,trackingReasonDetail:H.value,fillMethod:k.value,transferDate:D.value},re=await Vs.updateEffectTracking(r.value.id,se);if(re.data&&re.data.code===0){const Te=Z.value.findIndex(Be=>Be.id===r.value.id);Te!==-1&&(Z.value[Te].selectItem=b.value,Z.value[Te].originalPosition=p.value,Z.value[Te].currentPosition=_.value,Z.value[Te].originalAgency=f.value,Z.value[Te].currentAgency=V.value,Z.value[Te].trackingReasonOption=W.value,Z.value[Te].trackingReasonDetail=H.value,Z.value[Te].fillMethod=k.value,Z.value[Te].transferDate=D.value),v.showSuccess("儲存成功","已成功儲存學員資料"),ke()}else{const Te=((ne=re.data)==null?void 0:ne.message)||"儲存失敗，請稍後再試";v.showError("儲存失敗",Te)}}catch(se){console.error("更新追蹤成效資料錯誤:",se),v.showError("儲存失敗","更新資料時發生錯誤，請稍後再試")}finally{J()}},Y=()=>{console.log("搜尋條件:",{keyword:K.value,agency:o.value,status:N.value}),T.value=1,ke()},ue=ne=>{console.log("openEvidenceModal 被調用，學生ID:",ne.id),S.value=ne.id,x.value={},j.value=!0,console.log("當前狀態: showEvidenceModal =",j.value,"，selectedStudentId =",S.value)},pe=ne=>{console.log("保存證書數據:",ne),j.value=!1,ke(),v.showSuccess("儲存成功","職務內容已成功儲存")},ye=()=>{r.value?(console.log("打開職務內容彈窗，學生ID:",r.value.id),S.value=r.value.id,x.value={},j.value=!0):v.showError("錯誤","無法識別學生資訊")};return je(()=>{C(),de(),xe(),d.query.subAgencyName&&(o.value=d.query.subAgencyName),d.query.status&&(N.value=d.query.status),d.query.keyword&&(K.value=d.query.keyword),d.query.page&&(T.value=parseInt(d.query.page,10)||1),ke()}),Ee([o,N,K,T],()=>{h.replace({query:{...d.query,subAgencyName:o.value||void 0,status:N.value||void 0,keyword:K.value||void 0,page:T.value}})},{deep:!0}),(ne,se)=>(t(),s(X,null,[e("div",Of,[e("div",qf,[Ge(ft,{breadcrumbs:[{name:"追蹤管理",path:"/management"}]})]),e("div",Bf,[se[29]||(se[29]=e("span",null,"查詢:",-1)),e("div",Hf,[P(e("input",{type:"text","onUpdate:modelValue":se[0]||(se[0]=re=>K.value=re),class:"p-2 border border-gray-300 outline-none w-full",placeholder:"姓名/身分證字號",onKeyup:Ue(Y,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[te,K.value]]),K.value?(t(),s("button",{key:0,onClick:se[1]||(se[1]=re=>K.value=""),class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},se[26]||(se[26]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),P(e("select",{"onUpdate:modelValue":se[2]||(se[2]=re=>o.value=re),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(Y,["enter"])},[se[27]||(se[27]=e("option",{value:""},"薦派機關",-1)),(t(!0),s(X,null,le(E.value,re=>(t(),s("option",{key:re.id,value:re.id},l(re.name),9,Wf))),128))],544),[[Pe,o.value]]),P(e("select",{"onUpdate:modelValue":se[3]||(se[3]=re=>N.value=re),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(Y,["enter"])},[se[28]||(se[28]=e("option",{value:""},"學員受訓狀態",-1)),(t(!0),s(X,null,le(U.value,re=>(t(),s("option",{key:re.id,value:re.id},l(re.name),9,zf))),128))],544),[[Pe,N.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:Y}," 搜尋 ")]),se[41]||(se[41]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Kf,[R.value?(t(),s("div",Jf,se[30]||(se[30]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Yf,[e("thead",null,[e("tr",null,[se[38]||(se[38]=e("th",{class:"border p-2"}," 序 ",-1)),e("th",Gf,[e("div",Zf,[se[31]||(se[31]=me(" 機關名稱 ")),e("button",{onClick:se[4]||(se[4]=re=>O("subAgencyName")),class:"ml-1 focus:outline-none"},[$.value==="subAgencyName"&&c.value==="asc"?(t(),s("span",Qf,"▲")):$.value==="subAgencyName"&&c.value==="desc"?(t(),s("span",Xf,"▼")):(t(),s("span",ey,"⇅"))])])]),e("th",ty,[e("div",sy,[se[32]||(se[32]=me(" 姓名 ")),e("button",{onClick:se[5]||(se[5]=re=>O("name")),class:"ml-1 focus:outline-none"},[$.value==="name"&&c.value==="asc"?(t(),s("span",ay,"▲")):$.value==="name"&&c.value==="desc"?(t(),s("span",oy,"▼")):(t(),s("span",ly,"⇅"))])])]),e("th",ny,[e("div",ry,[se[33]||(se[33]=me(" 身份證字號 ")),e("button",{onClick:se[6]||(se[6]=re=>O("idNumber")),class:"ml-1 focus:outline-none"},[$.value==="idNumber"&&c.value==="asc"?(t(),s("span",iy,"▲")):$.value==="idNumber"&&c.value==="desc"?(t(),s("span",dy,"▼")):(t(),s("span",uy,"⇅"))])])]),e("th",cy,[e("div",py,[se[34]||(se[34]=me(" 認列時數 ")),e("button",{onClick:se[7]||(se[7]=re=>O("certificatedHours")),class:"ml-1 focus:outline-none"},[$.value==="certificatedHours"&&c.value==="asc"?(t(),s("span",vy,"▲")):$.value==="certificatedHours"&&c.value==="desc"?(t(),s("span",my,"▼")):(t(),s("span",by,"⇅"))])])]),e("th",fy,[e("div",yy,[se[35]||(se[35]=me(" 訓練時數 ")),e("button",{onClick:se[8]||(se[8]=re=>O("trainingHours")),class:"ml-1 focus:outline-none"},[$.value==="trainingHours"&&c.value==="asc"?(t(),s("span",gy,"▲")):$.value==="trainingHours"&&c.value==="desc"?(t(),s("span",xy,"▼")):(t(),s("span",hy,"⇅"))])])]),e("th",wy,[e("div",_y,[se[36]||(se[36]=me(" 總訓練時數 ")),e("button",{onClick:se[9]||(se[9]=re=>O("totalHours")),class:"ml-1 focus:outline-none"},[$.value==="totalHours"&&c.value==="asc"?(t(),s("span",ky,"▲")):$.value==="totalHours"&&c.value==="desc"?(t(),s("span",$y,"▼")):(t(),s("span",Cy,"⇅"))])])]),e("th",Ey,[e("div",Sy,[se[37]||(se[37]=me(" 狀態 ")),e("button",{onClick:se[10]||(se[10]=re=>O("status")),class:"ml-1 focus:outline-none"},[$.value==="status"&&c.value==="asc"?(t(),s("span",Dy,"▲")):$.value==="status"&&c.value==="desc"?(t(),s("span",My,"▼")):(t(),s("span",Ay,"⇅"))])])]),se[39]||(se[39]=e("th",{class:"border p-2"},"投入資安工作說明",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(De.value,(re,Te)=>(t(),s("tr",{key:re.id},[e("td",Iy,l((T.value-1)*z.value+Te+1),1),e("td",Ry,l(re.subAgencyName),1),e("td",Py,l(re.name),1),e("td",Uy,l(re.idNumber),1),e("td",Ny,l(re.certificatedHours),1),e("td",Ty,l(re.trainingHours),1),e("td",Vy,l(re.totalHours),1),e("td",jy,l(re.status),1),e("td",Ly,[e("button",{class:ee(["px-4 py-1 text-white hover:opacity-90",{"bg-[#4e9875]":re.secWorkDetail===1,"bg-red-500":re.secWorkDetail===2,"bg-[#3e4346]":re.secWorkDetail===3||re.secWorkDetail===void 0}]),onClick:Be=>A(re)}," 工作明細 ",10,Fy),e("button",{class:ee(["px-4 py-1 text-white hover:opacity-90",{"bg-[#4e9875]":re.jobDescription===1,"bg-[#3e4346]":re.jobDescription===3||re.jobDescription===void 0}]),onClick:Be=>ue(re)}," 職務內容 ",10,Oy)])]))),128)),Z.value.length===0?(t(),s("tr",qy,se[40]||(se[40]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])),!R.value&&Z.value.length>0?(t(),s("div",By,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:T.value===1,onClick:$e}," 上一頁 ",8,Hy),(t(!0),s(X,null,le(fe.value,re=>(t(),s(X,{key:re},[re!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":re===T.value}]),onClick:Te=>we(re)},l(re),11,Wy)):(t(),s("span",zy,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:T.value===g.value,onClick:ae}," 下一頁 ",8,Ky)])):G("",!0)])]),y.value?(t(),s("div",Jy,[e("div",Yy,[se[60]||(se[60]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",Gy,[e("div",Zy,[e("div",Qy,[se[45]||(se[45]=e("span",{class:"mr-4"},[me("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",Xy,[e("label",e1,[P(e("input",{type:"radio","onUpdate:modelValue":se[11]||(se[11]=re=>k.value=re),value:1,class:"w-4 h-4 mr-1"},null,512),[[bt,k.value]]),se[42]||(se[42]=e("span",null,"核撥申請",-1))]),e("label",t1,[P(e("input",{type:"radio","onUpdate:modelValue":se[12]||(se[12]=re=>k.value=re),value:2,class:"w-4 h-4 mr-1"},null,512),[[bt,k.value]]),se[43]||(se[43]=e("span",null,"電子郵件",-1))]),e("label",s1,[P(e("input",{type:"radio","onUpdate:modelValue":se[13]||(se[13]=re=>k.value=re),value:3,class:"w-4 h-4 mr-1"},null,512),[[bt,k.value]]),se[44]||(se[44]=e("span",null,"電訪",-1))])])]),e("div",a1,[e("div",o1,[P(e("input",{type:"radio","onUpdate:modelValue":se[14]||(se[14]=re=>b.value=re),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[bt,b.value]]),se[46]||(se[46]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:ye}," 回覆職務內容 "),se[47]||(se[47]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",l1,[e("div",n1,[P(e("input",{type:"radio","onUpdate:modelValue":se[15]||(se[15]=re=>b.value=re),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[bt,b.value]]),se[49]||(se[49]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",r1,[se[48]||(se[48]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",i1,[P(e("input",{type:"text","onUpdate:modelValue":se[16]||(se[16]=re=>D.value=re),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[te,D.value]])])])])]),e("div",d1,[e("div",u1,[e("div",null,[se[50]||(se[50]=e("div",{class:"mb-1"},"原機關",-1)),e("div",c1,[P(e("input",{type:"text","onUpdate:modelValue":se[17]||(se[17]=re=>f.value=re),class:"w-full outline-none"},null,512),[[te,f.value]])])]),e("div",null,[se[51]||(se[51]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",p1,[P(e("input",{type:"text","onUpdate:modelValue":se[18]||(se[18]=re=>V.value=re),class:"w-full outline-none"},null,512),[[te,V.value]])]),se[52]||(se[52]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[se[53]||(se[53]=e("div",{class:"mb-1"},"原職系",-1)),e("div",v1,[P(e("input",{type:"text","onUpdate:modelValue":se[19]||(se[19]=re=>p.value=re),class:"w-full outline-none"},null,512),[[te,p.value]])])]),e("div",null,[se[54]||(se[54]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",m1,[P(e("input",{type:"text","onUpdate:modelValue":se[20]||(se[20]=re=>_.value=re),class:"w-full outline-none"},null,512),[[te,_.value]])]),se[55]||(se[55]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(b.value)===2?(t(),s("div",b1,[se[59]||(se[59]=e("div",null,[me("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",f1,[e("div",y1,[P(e("input",{type:"radio","onUpdate:modelValue":se[21]||(se[21]=re=>W.value=re),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,W.value]]),se[56]||(se[56]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",g1,[P(e("input",{type:"radio","onUpdate:modelValue":se[22]||(se[22]=re=>W.value=re),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,W.value]]),se[57]||(se[57]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",x1,[P(e("input",{type:"radio","onUpdate:modelValue":se[23]||(se[23]=re=>W.value=re),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,W.value]]),se[58]||(se[58]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",h1,[P(e("input",{type:"text","onUpdate:modelValue":se[24]||(se[24]=re=>H.value=re),class:"w-full outline-none",disabled:Number(W.value)!==3},null,8,w1),[[te,H.value]])])])])])):G("",!0)])]),e("div",_1,[u.value.performanceTrackingEdit?(t(),s("button",{key:0,class:"px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",onClick:Q,disabled:!L.value}," 確認 ",8,k1)):G("",!0),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:J}," 取消 ")])])])):G("",!0),j.value?(t(),ps(qs,{key:1,show:j.value,studentId:S.value,initialData:x.value,onClose:se[25]||(se[25]=re=>j.value=!1),onSave:pe},null,8,["show","studentId","initialData"])):G("",!0)],64))}},C1=Fe($1,[["__scopeId","data-v-b69a9d01"]]),rs={getConsultations:M=>be.get("/v1/consultation",{params:M}),createConsultation:M=>be.post("/v1/consultation",M),updateConsultation:(M,h)=>be.put(`/v1/consultation/${M}`,h),deleteConsultation:M=>be.delete(`/v1/consultation/${M}`),confirmPassword:M=>be.post("/v1/user/confirmPwd",{password:M}),importConsultations:M=>be.post("/v1/consultation/import",M,{headers:{"Content-Type":"multipart/form-data"}}),deleteConsultationCategory:M=>be.delete(`/v1/consultationCategory/${M}`),addConsultationCategory:M=>be.post("/v1/consultationCategory",{name:M}),updateConsultationCategory:(M,h)=>be.put(`/v1/consultationCategory/${M}`,{id:M,name:h})},E1={class:"flex flex-col items-center p-6"},S1={class:"w-full max-w-[1500px]"},D1={class:"w-full max-w-[1500px]"},M1={class:"flex items-center space-x-4"},A1={class:"relative w-40"},I1=["value"],R1=["value"],P1=["value"],U1={class:"w-full max-w-[1500px]"},N1={class:"overflow-x-auto"},T1={class:"w-full border-collapse"},V1={class:"border p-2 text-center w-[100px]"},j1={class:"border p-2 text-center w-[50px]"},L1={class:"border p-2 w-[350px]"},F1={class:"font-bold mb-1"},O1={class:"border p-2 w-[350px]"},q1={class:"border p-2 text-center w-[100px]"},B1={class:"border p-2 text-center w-[100px]"},H1={class:"border p-2 text-center w-[100px]"},W1={class:"border p-2 text-center w-[100px]"},z1={class:"border p-2 text-center w-[100px]"},K1={class:"border p-2 text-center w-[100px]"},J1={class:"border p-2 text-center w-[100px]"},Y1={class:"border p-2 text-center w-[100px]"},G1={class:"border p-2 text-center w-[100px]"},Z1={class:"border p-2 text-center w-[100px]"},Q1={class:"flex justify-center space-x-2"},X1=["onClick"],eg=["onClick"],tg={key:0},sg=["colspan"],ag={key:0,class:"flex justify-center items-center space-x-2 mt-6"},og=["disabled"],lg=["onClick"],ng={key:1,class:"px-2"},rg=["disabled"],ig={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},dg={class:"bg-white p-6 rounded-lg w-[600px] max-h-[90vh] overflow-y-auto"},ug={class:"flex justify-between items-center mb-4"},cg={class:"text-xl font-bold"},pg={class:"space-y-4 flex flex-col items-center"},vg={class:"flex items-center w-full max-w-[440px]"},mg=["value"],bg={class:"flex items-center w-full max-w-[440px]"},fg={class:"flex-1"},yg={class:"flex w-full max-w-[440px]"},gg={class:"flex w-full max-w-[440px]"},xg={class:"flex items-center w-full max-w-[440px]"},hg={class:"flex items-center w-full max-w-[440px]"},wg={class:"flex items-center w-full max-w-[440px]"},_g={class:"flex items-center w-full max-w-[440px]"},kg={class:"flex items-center w-full max-w-[440px]"},$g={class:"flex items-center w-full max-w-[440px]"},Cg={class:"flex w-full max-w-[440px]"},Eg={class:"flex justify-center mt-6"},Sg=["disabled"],Dg={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Mg={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Ag={class:"mb-4"},Ig={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Rg={class:"mb-2"},Pg={key:0,class:"text-red-500 text-sm mt-2"},Ug={class:"flex justify-end space-x-2"},Ng=["disabled"],Tg=["disabled"],Vg={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},jg={class:"bg-white p-6 rounded-lg w-[500px] max-h-[90vh] overflow-y-auto"},Lg={class:"pr-2"},Fg={class:"mb-6"},Og={class:"border border-gray-300 rounded max-h-48 overflow-y-auto"},qg=["onClick"],Bg=["onClick"],Hg={key:0,class:"p-2 text-gray-500 text-center"},Wg={class:"space-y-4"},zg={class:"font-semibold mb-2"},Kg={class:"flex items-center"},Jg={class:"flex justify-end space-x-2"},Yg=["disabled"],Hs=10,Gg={__name:"QuestionManagement",setup(M){const h=Se(()=>{const i=new Date().getFullYear(),n=[];for(let w=i;w>=2024;w--)n.push(w);return n}),d=m(Array.from({length:12},(i,n)=>({value:n+1,label:`${(n+1).toString().padStart(2,"0")}月`}))),u=m([]),C=m(""),o=m(""),N=m(""),K=m(""),E=m(!1),U=m([]),T=Se(()=>U.value),z=m(1),g=m(1),a=m(0);Se(()=>T.value);const R=i=>{z.value=i,V()},Z=()=>{z.value>1&&(z.value--,V())},$=()=>{z.value<g.value&&(z.value++,V())},c=m(!1),y=m(!1),r=m({id:"",category:"",question:"",answer:"",updateTime:"",inquiryDate:"",type:"",asker:"",askerAgency:"",responder:"",status:"",remark:"",replyStatus:""}),b=m(null),p=m({consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationImport:!1,consultationReadDetail:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryEdit:!1,consultationCategoryDelete:!1}),_=async()=>{try{const i=await ot.getSidebarPermissions();i.data.code===0&&i.data.message==="success"?(p.value={...i.data.data,consultationCategoryRead:i.data.data.consultationCategoryRead||!1,consultationCategoryCreate:i.data.data.consultationCategoryCreate||!1,consultationCategoryEdit:i.data.data.consultationCategoryEdit||!1,consultationCategoryDelete:i.data.data.consultationCategoryDelete||!1},console.log("諮詢問題管理頁面權限:",p.value)):console.error("獲取權限失敗:",i.data.message)}catch(i){console.error("獲取權限錯誤:",i)}},f=async(i=!1)=>{if(!(!i&&u.value.length>0))try{const n=await nt.getConsultationCategoryOptions();n.data.code===0&&n.data.message==="success"?(u.value=n.data.data,Be.value=n.data.data):(console.error("獲取問題類別選項失敗:",n.data.message),v.showError("載入失敗","獲取問題類別選項失敗: "+n.data.message))}catch(n){console.error("獲取問題類別選項錯誤:",n),v.showError("載入失敗","獲取問題類別選項錯誤，請稍後再試")}},V=async()=>{try{E.value=!0;const i={page:z.value,limit:Hs,keyword:C.value||void 0,year:o.value||void 0,month:N.value||void 0,category:K.value||void 0};console.log("獲取問題列表參數:",i);const n=await rs.getConsultations(i);n.data.code===0?(U.value=n.data.data.list.map(w=>({id:w.id,category:W(w.category),categoryId:w.category,question:w.question,answer:w.ans,updateTime:w.updateDate,questionDate:w.questionDate,inquiryDate:w.questionDate,type:w.type||0,asker:w.asker||"",askerAgency:w.askerAgency||"",responder:w.responder||"",status:w.status||0,remark:w.remark||"",replyStatus:w.replyStatus||0})),a.value=n.data.data.totalCount,g.value=n.data.data.totalPage):(console.error("獲取問題列表失敗:",n.data.message),U.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗",n.data.message||"無法獲取問題列表，請稍後再試"))}catch(i){console.error("獲取問題列表錯誤:",i),U.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗","無法獲取問題列表，請稍後再試")}finally{E.value=!1}},W=i=>{if(!i)return"未知類別";const n=u.value.find(w=>w.id===i);return n?n.name:"未知類別"},H=i=>{switch(i){case 1:return"Email";case 2:return"電話";case 3:return"官方Line";default:return"未知"}},k=()=>{var w;const i=[{field:"category",message:"請選擇問題類別"},{field:"inquiryDate",message:"請選擇詢問時間"},{field:"question",message:"請填寫問題內容"},{field:"answer",message:"請填寫回覆內容"},{field:"type",message:"請選擇詢問方式"},{field:"askerAgency",message:"請填寫詢問機關"},{field:"asker",message:"請填寫詢問人員"},{field:"responder",message:"請填寫回答人員"},{field:"replyStatus",message:"請選擇回復狀況"}];if(r.value.status==="")return v.showError("提交失敗","請選擇處理狀況"),!1;for(const{field:ce,message:he}of i)if(!r.value[ce])return v.showError("提交失敗",he),!1;const n=(w=u.value.find(ce=>ce.name===r.value.category))==null?void 0:w.id;return n?{isValid:!0,categoryId:n}:(v.showError("提交失敗","請選擇有效的問題類別"),!1)},D=i=>{const n=new Date(r.value.inquiryDate),w=`${n.getFullYear()}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`;return{category:i,question:r.value.question,ans:r.value.answer,questionDate:w,type:r.value.type||void 0,asker:r.value.asker||void 0,askerAgency:r.value.askerAgency||void 0,responder:r.value.responder||void 0,status:r.value.status||void 0,remark:r.value.remark||void 0,replyStatus:r.value.replyStatus||void 0}},j=async i=>{let n;if(y.value?(i.id=r.value.id,n=await rs.updateConsultation(r.value.id,i)):n=await rs.createConsultation(i),n.data.code===0){const w=y.value?"更新":"新增";v.showSuccess(`${w}成功`,`問題已成功${w}`),c.value=!1,V()}else{const w=y.value?"更新":"新增";v.showError(`${w}失敗`,n.data.message||"操作失敗，請稍後再試")}},S=async()=>{try{E.value=!0;const i=k();if(!i.isValid){E.value=!1;return}const n=D(i.categoryId);await j(n)}catch(i){console.error("提交表單錯誤:",i);const n=y.value?"更新":"新增";v.showError(`${n}失敗`,"操作失敗，請稍後再試")}finally{E.value=!1}},x=i=>{y.value=!0;let n="";if(i.questionDate){const w=i.questionDate.split("/");w.length===3&&(n=`${w[0]}-${w[1]}-${w[2]}`)}r.value={id:i.id,category:i.category,question:i.question,answer:i.answer,updateTime:i.updateTime,inquiryDate:n,type:i.type,asker:i.asker,askerAgency:i.askerAgency,responder:i.responder,status:i.status,remark:i.remark,replyStatus:i.replyStatus},c.value=!0},L=async i=>{if(b.value=i.id,await v.confirmAsync("確認刪除",`確定要刪除問題「${i.question}」嗎？此操作無法復原。`)){const w=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(w===null||w===""){b.value=null;return}de(w)}else b.value=null},de=async i=>{try{if(E.value=!0,console.log("刪除問題ID:",b.value),(await rs.confirmPassword(i)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),E.value=!1,b.value=null;return}const w=await rs.deleteConsultation(b.value);w.data.code===0?(v.showSuccess("刪除成功","問題已成功刪除"),V()):v.showError("刪除失敗",w.data.message||"刪除失敗，請稍後再試")}catch(n){console.error("刪除問題錯誤:",n),n.response&&n.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除問題時發生錯誤，請稍後再試")}finally{E.value=!1,b.value=null}},xe=()=>{C.value=""},fe=()=>{console.log("使用關鍵字搜尋:",C.value,"年度:",o.value,"月份:",N.value,"類別:",K.value),z.value=1,V()},ke=m(!1),De=m(null),we=m(null),$e=m(!1),ae=m(""),O=()=>{ke.value=!0,we.value=null,ae.value=""},A=()=>{ke.value=!1,we.value=null,ae.value=""},J=()=>{De.value.click()},Q=i=>{const n=i.target.files[0];if(n){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(n.type)&&!n.name.endsWith(".xlsx")&&!n.name.endsWith(".xls")&&!n.name.endsWith(".csv")){ae.value="請選擇 .xlsx 檔案",we.value=null,i.target.value=null;return}we.value=n,ae.value=""}},Y=async()=>{var i,n,w;if(!we.value){ae.value="請選擇要上傳的檔案";return}try{$e.value=!0,ae.value="";const ce=new FormData;ce.append("file",we.value);const he=await rs.importConsultations(ce);if(he.data&&he.data.code===0){const Ve=he.data.message?he.data.message.replace(/\r\n|\n|\r/g,"<br>"):"問題資料已成功匯入";A(),v.showSuccess("上傳成功",Ve),V()}else ae.value=((i=he.data)==null?void 0:i.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",ae.value)}catch(ce){console.error("匯入問題檔案錯誤:",ce),ae.value=((w=(n=ce.response)==null?void 0:n.data)==null?void 0:w.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",ae.value)}finally{$e.value=!1}};je(()=>{_(),f().then(()=>{V()})});const ue=i=>{switch(i){case 1:return"處理中";case 2:return"已處理";default:return"未知"}},pe=i=>{switch(i){case 1:return"未回覆";case 2:return"已回覆";default:return"未知"}},ye=()=>{y.value=!1,r.value={id:"",category:"",question:"",answer:"",updateTime:"",inquiryDate:"",type:"",asker:"",askerAgency:"",responder:"",status:"",remark:"",replyStatus:""},c.value=!0},ne=m(!1),se=m(!1),re=m({id:null,name:""}),Te=m(!1),Be=m([]),ve=async()=>{ne.value=!0,se.value=!1,re.value={id:null,name:""},await f(!0)},ie=()=>{ne.value=!1},_e=i=>{se.value=!0,re.value={...i}},Le=()=>{se.value=!1,re.value={id:null,name:""}},ge=async i=>{if(await v.confirmAsync("確認刪除",`確定要刪除分類「${i.name}」嗎？此操作無法復原。`)){const w=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(w===null||w==="")return;try{if(Te.value=!0,(await rs.confirmPassword(w)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const he=await rs.deleteConsultationCategory(i.id);he.data.code===0?(v.showSuccess("刪除成功","分類已成功刪除"),await f(!0)):v.showError("刪除失敗",he.data.message||"刪除分類失敗，請稍後再試")}catch(ce){console.error("刪除分類錯誤:",ce),ce.response&&ce.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除分類時發生錯誤，請稍後再試")}finally{Te.value=!1}}},q=async()=>{if(!re.value.name.trim()){v.showError("操作失敗","分類名稱不能為空");return}Te.value=!0;try{let i;se.value?i=await rs.updateConsultationCategory(re.value.id,re.value.name):i=await rs.addConsultationCategory(re.value.name),i.data.code===0?(v.showSuccess("操作成功",`分類已成功${se.value?"更新":"新增"}`),await f(!0),Le()):v.showError("操作失敗",i.data.message||"分類操作失敗，請稍後再試")}catch(i){console.error("分類操作錯誤:",i),v.showError("操作失敗","分類操作時發生錯誤，請稍後再試")}finally{Te.value=!1}};return(i,n)=>(t(),s("div",E1,[e("div",S1,[Ge(ft,{breadcrumbs:[{name:"諮詢問題管理",path:"/question-management"}]})]),e("div",D1,[e("div",M1,[n[21]||(n[21]=e("span",null,"查詢問題:",-1)),e("div",A1,[P(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=w=>C.value=w),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"問題關鍵字",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ue(fe,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[te,C.value]]),C.value?(t(),s("button",{key:0,onClick:xe,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},n[17]||(n[17]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),P(e("select",{"onUpdate:modelValue":n[1]||(n[1]=w=>o.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(fe,["enter"])},[n[18]||(n[18]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(X,null,le(h.value,w=>(t(),s("option",{key:w,value:w},l(w)+"年 ",9,I1))),128))],544),[[Pe,o.value]]),P(e("select",{"onUpdate:modelValue":n[2]||(n[2]=w=>N.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(fe,["enter"])},[n[19]||(n[19]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(X,null,le(d.value,w=>(t(),s("option",{key:w.value,value:w.value},l(w.label),9,R1))),128))],544),[[Pe,N.value]]),P(e("select",{"onUpdate:modelValue":n[3]||(n[3]=w=>K.value=w),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(fe,["enter"])},[n[20]||(n[20]=e("option",{value:""},"請選擇問題類別",-1)),(t(!0),s(X,null,le(u.value,w=>(t(),s("option",{key:w.id,value:w.id},l(w.name),9,P1))),128))],544),[[Pe,K.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:fe}," 搜尋 "),n[22]||(n[22]=e("div",{class:"flex-grow"},null,-1)),p.value.consultationCategoryRead?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:ve}," 分類管理 ")):G("",!0),p.value.consultationImport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:O}," 匯入問題 ")):G("",!0),p.value.consultationCreate?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:ye}," 新增問題 ")):G("",!0)])]),n[56]||(n[56]=e("div",{class:"w-full max-w-[1500px] my-8"},[e("div",{class:"w-full h-[1px] bg-gray-300"})],-1)),e("div",U1,[e("div",N1,[e("table",T1,[e("thead",null,[e("tr",null,[n[28]||(n[28]=e("th",{class:"border p-2 w-[100px]"},"問題種類",-1)),n[29]||(n[29]=e("th",{class:"border p-2 w-[50px]"},"序",-1)),n[30]||(n[30]=e("th",{class:"border p-2 w-[350px]"},"問題",-1)),n[31]||(n[31]=e("th",{class:"border p-2 w-[350px]"},"回復",-1)),n[32]||(n[32]=e("th",{class:"border p-2 w-[100px]"},"詢問時間",-1)),n[33]||(n[33]=e("th",{class:"border p-2 w-[100px]"},"詢問方式",-1)),n[34]||(n[34]=e("th",{class:"border p-2 w-[100px]"},"詢問機關",-1)),p.value.consultationReadDetail?(t(),s(X,{key:0},[n[23]||(n[23]=e("th",{class:"border p-2 w-[100px]"},"詢問人員",-1)),n[24]||(n[24]=e("th",{class:"border p-2 w-[100px]"},"回答人員",-1)),n[25]||(n[25]=e("th",{class:"border p-2 w-[100px]"},"回復狀況",-1)),n[26]||(n[26]=e("th",{class:"border p-2 w-[100px]"},"處理狀況",-1)),n[27]||(n[27]=e("th",{class:"border p-2 w-[100px]"},"備註",-1))],64)):G("",!0),n[35]||(n[35]=e("th",{class:"border p-2 w-[100px]"},"更新時間",-1)),n[36]||(n[36]=e("th",{class:"border p-2 w-[100px]"},"操作",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(T.value,(w,ce)=>(t(),s("tr",{key:w.id},[e("td",V1,l(w.category),1),e("td",j1,l((z.value-1)*Hs+ce+1),1),e("td",L1,[e("div",F1,"Q. "+l(w.question),1)]),e("td",O1,"A."+l(w.answer),1),e("td",q1,l(w.questionDate),1),e("td",B1,l(H(w.type)),1),e("td",H1,l(w.askerAgency),1),p.value.consultationReadDetail?(t(),s(X,{key:0},[e("td",W1,l(w.asker),1),e("td",z1,l(w.responder),1),e("td",K1,l(pe(w.replyStatus)),1),e("td",J1,l(ue(w.status)),1),e("td",Y1,l(w.remark),1)],64)):G("",!0),e("td",G1,l(w.updateTime),1),e("td",Z1,[e("div",Q1,[p.value.consultationUpdate?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:he=>x(w)}," 編輯 ",8,X1)):G("",!0),p.value.consultationDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:he=>L(w)}," 刪除 ",8,eg)):G("",!0)])])]))),128)),T.value.length===0?(t(),s("tr",tg,[e("td",{colspan:p.value.consultationReadDetail?13:9,class:"border p-4 text-center"},"無符合條件的資料",8,sg)])):G("",!0)])])]),g.value>0?(t(),s("div",ag,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:z.value===1,onClick:Z}," 上一頁 ",8,og),(t(!0),s(X,null,le(g.value,w=>(t(),s(X,{key:w},[w===1||w===g.value||w>=z.value-2&&w<=z.value+2?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":w===z.value}]),onClick:ce=>R(w)},l(w),11,lg)):w===z.value-3||w===z.value+3?(t(),s("span",ng," ... ")):G("",!0)],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:z.value===g.value,onClick:$}," 下一頁 ",8,rg)])):G("",!0)]),c.value?(t(),s("div",ig,[e("div",dg,[e("div",ug,[e("h3",cg,l(y.value?"編輯問題":"新增問題"),1),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:n[4]||(n[4]=w=>c.value=!1)}," ✕ ")]),e("div",pg,[e("div",vg,[n[38]||(n[38]=e("span",{class:"w-24"},[me("問題類別:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[5]||(n[5]=w=>r.value.category=w),required:""},[n[37]||(n[37]=e("option",{value:""},"請選擇問題類別",-1)),(t(!0),s(X,null,le(u.value,w=>(t(),s("option",{key:w.id,value:w.name},l(w.name),9,mg))),128))],512),[[Pe,r.value.category]])]),e("div",bg,[n[39]||(n[39]=e("span",{class:"w-24"},[me("詢問時間:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",fg,[P(e("input",{type:"date",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":n[6]||(n[6]=w=>r.value.inquiryDate=w),required:""},null,512),[[te,r.value.inquiryDate]])])]),e("div",yg,[n[40]||(n[40]=e("span",{class:"w-24"},[me("問題內容:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-32 resize-none","onUpdate:modelValue":n[7]||(n[7]=w=>r.value.question=w),required:""},null,512),[[te,r.value.question]])]),e("div",gg,[n[41]||(n[41]=e("span",{class:"w-24"},[me("回覆內容:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-32 resize-none","onUpdate:modelValue":n[8]||(n[8]=w=>r.value.answer=w),required:""},null,512),[[te,r.value.answer]])]),e("div",xg,[n[43]||(n[43]=e("span",{class:"w-24"},[me("詢問方式:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[9]||(n[9]=w=>r.value.type=w),required:""},n[42]||(n[42]=[e("option",{value:""},"請選擇詢問方式",-1),e("option",{value:"1"},"Email",-1),e("option",{value:"2"},"電話",-1),e("option",{value:"3"},"官方Line",-1)]),512),[[Pe,r.value.type]])]),e("div",hg,[n[44]||(n[44]=e("span",{class:"w-24"},[me("詢問機關:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[10]||(n[10]=w=>r.value.askerAgency=w),placeholder:"請輸入詢問機關",required:""},null,512),[[te,r.value.askerAgency]])]),e("div",wg,[n[45]||(n[45]=e("span",{class:"w-24"},[me("詢問人員:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[11]||(n[11]=w=>r.value.asker=w),placeholder:"請輸入詢問人員",required:""},null,512),[[te,r.value.asker]])]),e("div",_g,[n[46]||(n[46]=e("span",{class:"w-24"},[me("回答人員:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[12]||(n[12]=w=>r.value.responder=w),placeholder:"請輸入回答人員",required:""},null,512),[[te,r.value.responder]])]),e("div",kg,[n[48]||(n[48]=e("span",{class:"w-24"},[me("回復狀況:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[13]||(n[13]=w=>r.value.replyStatus=w),required:""},n[47]||(n[47]=[e("option",{value:""},"請選擇回復狀況",-1),e("option",{value:"1"},"未回覆",-1),e("option",{value:"2"},"已回覆",-1)]),512),[[Pe,r.value.replyStatus]])]),e("div",$g,[n[50]||(n[50]=e("span",{class:"w-24"},[me("處理狀況:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[14]||(n[14]=w=>r.value.status=w),required:""},n[49]||(n[49]=[e("option",{value:""},"請選擇處理狀況",-1),e("option",{value:"1"},"處理中",-1),e("option",{value:"2"},"已處理",-1)]),512),[[Pe,r.value.status]])]),e("div",Cg,[n[51]||(n[51]=e("span",{class:"w-24"},"備註:",-1)),P(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-20 resize-none","onUpdate:modelValue":n[15]||(n[15]=w=>r.value.remark=w),placeholder:"請輸入備註"},null,512),[[te,r.value.remark]])]),e("div",Eg,[e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:S,disabled:E.value},l(E.value?"處理中...":"送出"),9,Sg)])])])])):G("",!0),ke.value?(t(),s("div",Dg,[e("div",Mg,[n[52]||(n[52]=e("h3",{class:"text-lg font-medium mb-4"},"匯入問題",-1)),e("div",Ag,[e("div",Ig,[e("input",{type:"file",ref_key:"fileInput",ref:De,class:"hidden",onChange:Q,accept:".xlsx,.xls,.csv"},null,544),e("p",Rg,l(we.value?we.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:J,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),ae.value?(t(),s("p",Pg,l(ae.value),1)):G("",!0)]),e("div",Ug,[e("button",{onClick:A,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:$e.value}," 取消 ",8,Ng),e("button",{onClick:Y,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!we.value||$e.value},l($e.value?"上傳中...":"上傳"),9,Tg)])])])):G("",!0),ne.value?(t(),s("div",Vg,[e("div",jg,[e("div",{class:"flex justify-between items-center mb-4"},[n[53]||(n[53]=e("h3",{class:"text-xl font-bold"},"分類管理",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:ie}," ✕ ")]),e("div",Lg,[e("div",Fg,[n[54]||(n[54]=e("h4",{class:"font-semibold mb-2"},"現有問題類別:",-1)),e("ul",Og,[(t(!0),s(X,null,le(Be.value,w=>(t(),s("li",{key:w.id,class:"flex justify-between items-center p-2 border-b last:border-b-0"},[e("span",null,l(w.name),1),e("div",null,[p.value.consultationCategoryEdit?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm mr-2",onClick:ce=>_e(w)}," 編輯 ",8,qg)):G("",!0),p.value.consultationCategoryDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:ce=>ge(w)}," 刪除 ",8,Bg)):G("",!0)])]))),128)),Be.value.length===0?(t(),s("li",Hg," 無任何問題類別 ")):G("",!0)])]),e("div",Wg,[e("h4",zg,l(se.value?"編輯分類":"新增分類")+":",1),e("div",Kg,[n[55]||(n[55]=e("label",{class:"w-24",for:"category-name"},[me("分類名稱:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{id:"category-name",type:"text","onUpdate:modelValue":n[16]||(n[16]=w=>re.value.name=w),class:"p-2 border border-gray-300 outline-none flex-1",placeholder:"請輸入分類名稱",required:""},null,512),[[te,re.value.name]])]),e("div",Jg,[se.value?(t(),s("button",{key:0,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:Le}," 取消編輯 ")):G("",!0),e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:q,disabled:!re.value.name.trim()||Te.value||(se.value?!p.value.consultationCategoryEdit:!p.value.consultationCategoryCreate)},l(Te.value?"處理中...":"送出"),9,Yg)])])])])])):G("",!0)]))}},Zg=Fe(Gg,[["__scopeId","data-v-247569c8"]]),Qg={class:"flex flex-col items-center p-6"},Xg={class:"w-full max-w-[1500px]"},e0={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},t0={class:"flex items-center space-x-4"},s0={class:"w-full max-w-[1500px]"},a0={key:0,class:"flex justify-center items-center py-10"},o0={key:1,class:"w-full border-collapse"},l0={class:"border p-2 text-center"},n0={class:"border p-2 text-center"},r0={class:"border p-2 text-center"},i0={class:"border p-2 text-center"},d0={class:"border p-2 text-center"},u0={class:"border p-2 text-center"},c0={class:"border p-2 text-center"},p0={class:"flex justify-center space-x-2"},v0=["onClick","aria-label"],m0=["onClick","aria-label"],b0={key:0},f0={key:2,class:"flex justify-center items-center space-x-2 mt-6"},y0=["disabled"],g0=["onClick","aria-label","aria-current"],x0={key:1,class:"px-2"},h0=["disabled"],w0={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_0={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},k0={class:"flex flex-col"},$0={class:"flex flex-col"},C0={class:"flex flex-col"},E0={class:"flex flex-col"},S0={class:"flex flex-col"},D0={class:"flex flex-col"},M0=["value"],A0={class:"flex justify-end space-x-2 mt-6"},I0=["disabled"],R0={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},P0={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},U0={class:"flex flex-col"},N0={class:"flex flex-col"},T0={class:"flex flex-col"},V0={class:"flex flex-col"},j0={class:"flex flex-col"},L0={class:"flex flex-col"},F0=["value"],O0={class:"flex flex-col"},q0={class:"border-0 p-0 m-0"},B0={class:"flex items-center space-x-2"},H0={class:"inline-flex items-center",for:"edit-enabled-true"},W0={class:"inline-flex items-center",for:"edit-enabled-false"},z0={class:"flex justify-end space-x-2 mt-6"},K0=["disabled"],Fs=20,J0={__name:"Roles",setup(M){const h=m(1),d=m(1),u=m(0),C=m(!1),o=m([]),N=m([]),K=m(!1),E=m(!1),U=m(!1),T=m({name:"",unit:"",title:"",account:"",password:"",role:""}),z=m(!1),g=m({id:"",name:"",unit:"",title:"",account:"",password:"",role:"",isEnabled:!0}),a=m(null),R=m({userCreate:!1,userUpdate:!1,userDelete:!1}),Z=S=>S==="-1"||S===-1||S===null||S===void 0?"缺":S,$=Se(()=>{const S=[];if(d.value<=5)for(let L=1;L<=d.value;L++)S.push(L);else{S.push(1);let L=Math.max(2,h.value-1),de=Math.min(d.value-1,h.value+1);h.value<=3&&(de=Math.min(4,d.value-1)),h.value>=d.value-2&&(L=Math.max(2,d.value-3)),L>2&&S.push("...");for(let xe=L;xe<=de;xe++)S.push(xe);de<d.value-1&&S.push("..."),S.push(d.value)}return S}),c=async()=>{try{K.value=!0;const S=await is.getRoleOptions();S.data.code===0&&S.data.message==="success"?N.value=S.data.data:(console.error("獲取使用者選項失敗:",S.data.message),v.showError("載入失敗","獲取使用者選項失敗: "+S.data.message))}catch(S){console.error("獲取使用者選項錯誤:",S),v.showError("載入失敗","獲取使用者選項錯誤，請稍後再試")}finally{K.value=!1}},y=async()=>{try{const S=await ot.getSidebarPermissions();S.data.code===0&&S.data.message==="success"?(R.value=S.data.data,console.log("使用者管理頁面權限:",R.value)):console.error("獲取權限失敗:",S.data.message)}catch(S){console.error("獲取權限錯誤:",S)}},r=async()=>{try{C.value=!0;const S={page:h.value,limit:Fs};console.log("獲取用戶列表參數:",S);const x=await is.getUserList(S);console.log("API 回應:",x.data),x.data.code===0&&x.data.message==="success"?(o.value=[...x.data.data.list],u.value=x.data.data.totalCount,d.value=x.data.data.totalPage||Math.ceil(u.value/Fs)):(console.error("獲取使用者列表失敗:",x.data.message),o.value=[],u.value=0,d.value=0,v.showError("載入失敗","獲取使用者列表失敗: "+x.data.message))}catch(S){console.error("獲取使用者列表錯誤:",S),o.value=[],u.value=0,d.value=0;let x=null;S.response&&S.response.data&&(x=S.response.data),x?(x.message?v.showError("載入失敗",`獲取使用者列表錯誤: ${x.message}`):x.title?v.showError("載入失敗",`獲取使用者列表錯誤: ${x.title}`):v.showError("載入失敗","獲取使用者列表錯誤，請稍後再試"),console.error("錯誤響應數據:",x)):v.showError("載入失敗","獲取使用者列表錯誤，請稍後再試")}finally{C.value=!1}},b=S=>{S!==h.value&&!C.value&&(h.value=S,r())},p=()=>{h.value>1&&!C.value&&(h.value--,r())},_=()=>{h.value<d.value&&!C.value&&(h.value++,r())},f=()=>{E.value=!0},V=async()=>{try{U.value=!0;const S=await is.createUser(T.value);S.data.code===0&&S.data.message==="success"?(v.showSuccess("新增成功","使用者已成功新增"),E.value=!1,T.value={name:"",unit:"",title:"",account:"",password:"",role:""},r()):v.showError("新增失敗","新增使用者失敗: "+S.data.message)}catch(S){console.error("新增使用者錯誤:",S),v.showError("新增失敗","新增使用者失敗，請稍後再試")}finally{U.value=!1}},W=async S=>{g.value={id:S.id,name:S.name,unit:S.unit,title:S.title,account:S.account,password:"",role:S.role,isEnabled:S.isEnabled},z.value=!0},H=async()=>{try{U.value=!0;const S={id:g.value.id,name:g.value.name,unit:g.value.unit,title:g.value.title,account:g.value.account,role:g.value.role,isEnabled:g.value.isEnabled};g.value.password&&g.value.password.trim()!==""&&(S.password=g.value.password),console.log("提交編輯數據:",S);const x=await is.updateUser(S.id,S);x.data.code===0&&x.data.message==="success"?(v.showSuccess("更新成功","使用者已成功更新"),z.value=!1,g.value={id:"",name:"",unit:"",title:"",account:"",password:"",role:"",isEnabled:!0},setTimeout(()=>{r()},300)):v.showError("更新失敗","更新使用者失敗: "+x.data.message)}catch(S){console.error("更新使用者錯誤:",S),v.showError("更新失敗","更新使用者失敗，請稍後再試")}finally{U.value=!1}},k=async S=>{if(a.value=S.id,await v.confirmAsync("確認刪除","確定要刪除此使用者嗎？此操作無法復原。")){const L=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(L===null||L===""){a.value=null;return}D(L)}else a.value=null},D=async S=>{try{if(U.value=!0,console.log("刪除使用者ID:",a.value),(await is.confirmPassword(S)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),U.value=!1,a.value=null;return}const L=await is.deleteUser(a.value);console.log("刪除結果:",L.data),L.data.code===0&&L.data.message==="success"?(v.showSuccess("刪除成功","使用者已成功刪除"),r()):(console.error("刪除使用者失敗:",L.data.message),v.showError("刪除失敗","刪除使用者失敗: "+L.data.message))}catch(x){console.error("刪除使用者錯誤:",x),x.response&&x.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除使用者時發生錯誤，請稍後再試")}finally{U.value=!1,a.value=null}},j=S=>{const x=N.value.find(L=>L.id===S);return x?x.name:"缺"};return je(()=>{y(),c(),r()}),(S,x)=>(t(),s("div",Qg,[e("div",Xg,[Ge(ft,{breadcrumbs:[{name:"使用者管理",path:"/roles"}]})]),e("div",e0,[e("div",t0,[R.value.userCreate?(t(),s("button",{key:0,onClick:f,class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white","aria-label":"新增使用者"}," 新增使用者 ")):G("",!0)])]),e("div",s0,[C.value?(t(),s("div",a0,x[16]||(x[16]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",o0,[x[18]||(x[18]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"序"),e("th",{class:"border p-2"},"單位"),e("th",{class:"border p-2"},"職稱"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"系統權限"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"操作")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(o.value,(L,de)=>(t(),s("tr",{key:L.id},[e("td",l0,l((h.value-1)*Fs+de+1),1),e("td",n0,l(Z(L.unit)),1),e("td",r0,l(Z(L.title)),1),e("td",i0,l(Z(L.name)),1),e("td",d0,l(j(L.role)),1),e("td",u0,[e("span",{class:ee([L.isEnabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(L.isEnabled?"啟用":"停用"),3)]),e("td",c0,[e("div",p0,[R.value.userUpdate?(t(),s("button",{key:0,onClick:xe=>W(L),class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm","aria-label":`編輯${L.name}的資料`}," 編輯 ",8,v0)):G("",!0),R.value.userDelete?(t(),s("button",{key:1,onClick:xe=>k(L),class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm","aria-label":`刪除${L.name}的資料`}," 刪除 ",8,m0)):G("",!0)])])]))),128)),o.value.length===0?(t(),s("tr",b0,x[17]||(x[17]=[e("td",{colspan:"6",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])),!C.value&&o.value.length>0?(t(),s("div",f0,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:h.value===1,onClick:p,"aria-label":"前往上一頁"}," 上一頁 ",8,y0),(t(!0),s(X,null,le($.value,L=>(t(),s(X,{key:L},[L!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":L===h.value}]),onClick:de=>b(L),"aria-label":`前往第${L}頁`,"aria-current":L===h.value?"page":void 0},l(L),11,g0)):(t(),s("span",x0,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:h.value===d.value,onClick:_,"aria-label":"前往下一頁"}," 下一頁 ",8,h0)])):G("",!0)]),E.value?(t(),s("div",w0,[e("div",_0,[x[26]||(x[26]=e("h3",{class:"text-xl font-bold mb-4"},"新增角色",-1)),e("form",{onSubmit:es(V,["prevent"]),class:"space-y-4"},[e("div",k0,[x[19]||(x[19]=e("label",{for:"add-name",class:"mb-1"},"姓名",-1)),P(e("input",{id:"add-name","onUpdate:modelValue":x[0]||(x[0]=L=>T.value.name=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,T.value.name]])]),e("div",$0,[x[20]||(x[20]=e("label",{for:"add-unit",class:"mb-1"},"單位",-1)),P(e("input",{id:"add-unit","onUpdate:modelValue":x[1]||(x[1]=L=>T.value.unit=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,T.value.unit]])]),e("div",C0,[x[21]||(x[21]=e("label",{for:"add-title",class:"mb-1"},"職稱",-1)),P(e("input",{id:"add-title","onUpdate:modelValue":x[2]||(x[2]=L=>T.value.title=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,T.value.title]])]),e("div",E0,[x[22]||(x[22]=e("label",{for:"add-account",class:"mb-1"},"帳號",-1)),P(e("input",{id:"add-account","onUpdate:modelValue":x[3]||(x[3]=L=>T.value.account=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,T.value.account]])]),e("div",S0,[x[23]||(x[23]=e("label",{for:"add-password",class:"mb-1"},"密碼",-1)),P(e("input",{id:"add-password","onUpdate:modelValue":x[4]||(x[4]=L=>T.value.password=L),type:"password",class:"border p-2 rounded",required:""},null,512),[[te,T.value.password]])]),e("div",D0,[x[25]||(x[25]=e("label",{for:"add-role",class:"mb-1"},"系統權限",-1)),P(e("select",{id:"add-role","onUpdate:modelValue":x[5]||(x[5]=L=>T.value.role=L),class:"border p-2 rounded",required:""},[x[24]||(x[24]=e("option",{value:""},"請選擇權限",-1)),(t(!0),s(X,null,le(N.value,L=>(t(),s("option",{key:L.id,value:L.id},l(L.name),9,M0))),128))],512),[[Pe,T.value.role]])]),e("div",A0,[e("button",{type:"button",onClick:x[6]||(x[6]=L=>E.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:U.value},l(U.value?"提交中...":"確認"),9,I0)])],32)])])):G("",!0),z.value?(t(),s("div",R0,[e("div",P0,[x[37]||(x[37]=e("h3",{class:"text-xl font-bold mb-4"},"編輯角色",-1)),e("form",{onSubmit:es(H,["prevent"]),class:"space-y-4"},[e("div",U0,[x[27]||(x[27]=e("label",{for:"edit-name",class:"mb-1"},"姓名",-1)),P(e("input",{id:"edit-name","onUpdate:modelValue":x[7]||(x[7]=L=>g.value.name=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,g.value.name]])]),e("div",N0,[x[28]||(x[28]=e("label",{for:"edit-unit",class:"mb-1"},"單位",-1)),P(e("input",{id:"edit-unit","onUpdate:modelValue":x[8]||(x[8]=L=>g.value.unit=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,g.value.unit]])]),e("div",T0,[x[29]||(x[29]=e("label",{for:"edit-title",class:"mb-1"},"職稱",-1)),P(e("input",{id:"edit-title","onUpdate:modelValue":x[9]||(x[9]=L=>g.value.title=L),type:"text",class:"border p-2 rounded",required:""},null,512),[[te,g.value.title]])]),e("div",V0,[x[30]||(x[30]=e("label",{for:"edit-account",class:"mb-1"},"帳號",-1)),P(e("input",{id:"edit-account","onUpdate:modelValue":x[10]||(x[10]=L=>g.value.account=L),type:"text",class:"border p-2 rounded cursor-not-allowed bg-gray-100",readonly:""},null,512),[[te,g.value.account]])]),e("div",j0,[x[31]||(x[31]=e("label",{for:"edit-password",class:"mb-1"},"密碼",-1)),P(e("input",{id:"edit-password","onUpdate:modelValue":x[11]||(x[11]=L=>g.value.password=L),type:"password",class:"border p-2 rounded",placeholder:"不修改請留空"},null,512),[[te,g.value.password]])]),e("div",L0,[x[33]||(x[33]=e("label",{for:"edit-role",class:"mb-1"},"系統權限",-1)),P(e("select",{id:"edit-role","onUpdate:modelValue":x[12]||(x[12]=L=>g.value.role=L),class:"border p-2 rounded",required:""},[x[32]||(x[32]=e("option",{value:""},"請選擇權限",-1)),(t(!0),s(X,null,le(N.value,L=>(t(),s("option",{key:L.id,value:L.id},l(L.name),9,F0))),128))],512),[[Pe,g.value.role]])]),e("div",O0,[e("fieldset",q0,[x[36]||(x[36]=e("legend",{class:"mb-1",id:"account-status-label"},"帳號狀態",-1)),e("div",B0,[e("label",H0,[P(e("input",{id:"edit-enabled-true",type:"radio","onUpdate:modelValue":x[13]||(x[13]=L=>g.value.isEnabled=L),value:!0,class:"form-radio text-[#4e9875]",name:"account-status"},null,512),[[bt,g.value.isEnabled]]),x[34]||(x[34]=e("span",{class:"ml-2"},"啟用",-1))]),e("label",W0,[P(e("input",{id:"edit-enabled-false",type:"radio","onUpdate:modelValue":x[14]||(x[14]=L=>g.value.isEnabled=L),value:!1,class:"form-radio text-[#4e9875]",name:"account-status"},null,512),[[bt,g.value.isEnabled]]),x[35]||(x[35]=e("span",{class:"ml-2"},"停用",-1))])])])]),e("div",z0,[e("button",{type:"button",onClick:x[15]||(x[15]=L=>z.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:U.value},l(U.value?"提交中...":"確認"),9,K0)])],32)])])):G("",!0)]))}},Y0=Fe(J0,[["__scopeId","data-v-a30593f0"]]),G0={class:"flex flex-col items-center justify-center min-h-screen bg-gray-100"},Z0={__name:"Unauthorized",setup(M){We();const h=async()=>{try{const u=await js.logout();u.data.code===0&&u.data.message==="success"?(d(),v.showSuccess("登出成功","您已成功登出系統"),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1e3)):(console.error("登出失敗:",u.data.message),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"))}catch(u){console.error("登出錯誤:",u),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"),d(),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1500)}},d=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(u=>{u.startsWith("app_")&&localStorage.removeItem(u)}),sessionStorage.clear()};return(u,C)=>(t(),s("div",G0,[e("div",{class:"p-8 bg-white rounded-lg shadow-md text-center max-w-md"},[C[0]||(C[0]=e("h1",{class:"text-3xl font-bold text-red-600 mb-4"},"未授權訪問",-1)),C[1]||(C[1]=e("div",{class:"text-gray-700 mb-6"},[e("p",{class:"mb-2"},"您沒有權限訪問此頁面。"),e("p",null,"請聯繫系統管理員獲取適當的權限，或返回您有權限的頁面。")],-1)),e("div",{class:"flex justify-center space-x-4"},[e("button",{onClick:h,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," 登出系統 ")])])]))}},Q0={class:"flex flex-col items-center"},X0={class:"w-full max-w-[1500px]"},ex={class:"flex items-center"},tx={class:"w-full max-w-[1500px] h-[1300px]"},sx=["src"],ax={__name:"Survey",props:{courseId:{type:[String,Number],required:!1,default:""}},setup(M){const h=M,d=m({satisfactionSurveyImport:!1}),u=async()=>{try{const N=await ot.getSidebarPermissions();N.data.code===0&&N.data.message==="success"?(d.value=N.data.data,console.log("滿意度調查頁面權限:",d.value)):console.error("獲取權限失敗:",N.data.message)}catch(N){console.error("獲取權限錯誤:",N)}};je(()=>{u()});const C=Se(()=>`https://dev-moda.mosji.co/dashboard/review?id=${h.courseId}`),o=async()=>{try{const N=document.createElement("input");N.type="file",N.accept=".xlsx,.xls",N.onchange=async K=>{var T,z,g;const E=K.target.files[0];if(!E)return;const U=new FormData;U.append("file",E),h.courseId&&U.append("courseId",h.courseId);try{const a=await Zt.importSurvey(U);if(a.data&&a.data.code===0){const R=a.data.message?a.data.message.replace(/\r\n|\n|\r/g,"<br>"):"問卷調查資料已成功匯入";v.showSuccess("匯入成功",R)}else{const R=((T=a.data)==null?void 0:T.message)||"匯入失敗，請確認檔案格式是否正確";v.showError("匯入失敗",R)}}catch(a){console.error("問卷調查資料匯入失敗:",a);const R=((g=(z=a.response)==null?void 0:z.data)==null?void 0:g.message)||"匯入過程中發生錯誤，請稍後再試";v.showError("匯入失敗",R)}},N.click()}catch(N){console.error("Excel 檔案上傳錯誤:",N),v.showError("匯入錯誤","匯入過程中發生錯誤，請稍後再試")}};return(N,K)=>(t(),s("div",Q0,[e("div",X0,[e("div",ex,[K[0]||(K[0]=e("div",{class:"flex-grow"},null,-1)),d.value.satisfactionSurveyImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] disabled:opacity-50 disabled:cursor-not-allowed",onClick:o}," 匯入滿意度調查 ")):G("",!0)])]),K[1]||(K[1]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",tx,[e("iframe",{src:C.value,class:"w-full h-full border-0",allowfullscreen:"",title:"問卷調查"},null,8,sx)]),K[2]||(K[2]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"space-y-2 text-sm text-gray-600"},[e("div",null,"備註："),e("div",null,"1. 問卷計算結果以班級／課程為一筆統計資料。"),e("div",null,"2. 分數指標為：非常滿意 100分、滿意 80分、普通 60分、不滿意 40分、非常不滿意 20分。")])],-1))]))}},ox=Fe(ax,[["__scopeId","data-v-f30b6fb9"]]),lx={class:"flex flex-col items-center p-6"},nx={class:"w-full max-w-[1500px] flex justify-between items-center"},rx={class:"w-full max-w-[1500px] flex justify-end mb-6"},ix={class:"space-x-4"},dx={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},ux={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},cx={class:"space-y-6"},px={class:"flex items-center"},vx=["disabled"],mx=["value"],bx={class:"flex items-center"},fx=["readonly"],yx={class:"flex items-center"},gx=["readonly"],xx={class:"flex items-center"},hx=["readonly"],wx={class:"flex items-center"},_x=["readonly"],kx={class:"flex flex-col"},$x={class:"ml-28"},Cx={class:"border border-gray-200 p-3 rounded","aria-labelledby":"timeSlotLabel"},Ex={key:0,class:"p-2"},Sx={class:"flex justify-between mb-2"},Dx={class:"font-medium"},Mx=["onClick"],Ax={class:"flex flex-wrap items-center"},Ix={class:"w-[31%]"},Rx=["id","disabled","onUpdate:modelValue","aria-label"],Px=["value"],Ux={class:"w-[31%]"},Nx=["id","onUpdate:modelValue","readonly","aria-label"],Tx={class:"w-[31%]"},Vx=["id","onUpdate:modelValue","readonly","aria-label"],jx={class:"space-y-6"},Lx={class:"flex items-center"},Fx=["readonly"],Ox={class:"flex items-center"},qx=["readonly"],Bx={class:"flex items-center"},Hx=["readonly"],Wx={class:"flex items-center"},zx=["readonly"],Kx={class:"flex items-center"},Jx=["disabled"],Yx={class:"flex items-center"},Gx=["readonly"],Zx={class:"flex items-center"},Qx=["readonly"],Xx={class:"flex items-center"},e2=["readonly"],t2={class:"w-full max-w-[1500px]"},s2={class:"flex border-b border-gray-300"},a2={key:2,class:"w-full max-w-[1500px] mt-4"},o2={key:0,class:"flex justify-center items-center py-10"},l2={key:1,class:"w-full border"},n2=["onClick"],r2={class:"border p-2 text-center"},i2={class:"border p-2 text-center"},d2={class:"border p-2 text-center"},u2={class:"border p-2 text-center"},c2={class:"border p-2 text-center"},p2={class:"border p-2 text-center"},v2={class:"border p-2 text-center"},m2={class:"border p-2 text-center"},b2={class:"border p-2 text-center"},f2={class:"border p-2 text-center"},y2={key:2,class:"text-center py-10 text-gray-500"},g2={key:3,class:"flex justify-center items-center space-x-2 mt-6"},x2=["disabled"],h2=["onClick"],w2={key:1,class:"px-2"},_2=["disabled"],k2={key:3,class:"w-full max-w-[1500px] mt-4"},$2=10,C2={__name:"CourseEdit",setup(M){const h=We(),d=rt(),u=m(!1),C=m(!0),o=m("attendance"),N=[{label:"週一",value:"週一"},{label:"週二",value:"週二"},{label:"週三",value:"週三"},{label:"週四",value:"週四"},{label:"週五",value:"週五"},{label:"週六",value:"週六"},{label:"週日",value:"週日"}],K=m([{day:"",startTime:"",endTime:""}]),E=m([]),U=m({id:"",schoolId:"",courseCode:"",courseName:"",startDate:"",endDate:"",classTime:"",hours:"",contactName:"",contactPhone:"",teacher:"",courseMode:"",classSize:"",graduates:"",respondents:""}),T=m({}),z=m([]),g=m(!1),a=()=>{K.value.push({day:"",startTime:"",endTime:""})},R=ve=>{K.value.splice(ve,1)},Z=ve=>{if(!ve||ve.length===0)return[{day:"",startTime:"",endTime:""}];try{return ve.map(ie=>ie.weekday===-1?{day:"",startTime:"",endTime:""}:{day:{1:"週一",2:"週二",3:"週三",4:"週四",5:"週五",6:"週六",7:"週日"}[ie.weekday]||"",startTime:ie.classStartTime||"",endTime:ie.classEndTime||""})}catch(ie){return console.error("解析上課時段錯誤:",ie),[{day:"",startTime:"",endTime:""}]}},$=()=>{if(g.value&&!u.value)return[{weekday:-1,classStartTime:"",classEndTime:""}];const ve=K.value.filter(ie=>ie.day);return ve.length===0?[{weekday:-1,classStartTime:"",classEndTime:""}]:ve.map(ie=>({weekday:{週一:1,週二:2,週三:3,週四:4,週五:5,週六:6,週日:7}[ie.day]||0,classStartTime:ie.startTime||"",classEndTime:ie.endTime||""}))},c=async()=>{try{C.value=!0,g.value=!1;const ve=d.params.id;if(console.log("正在獲取課程資料, ID:",ve),!y(ve))return;const ie=await Zt.getCourseById(ve);console.log("API回應資料:",ie.data),r(ie.data)}catch(ve){f(ve)}finally{C.value=!1}},y=ve=>ve?(console.log("發送API請求獲取課程詳細資料，ID:",ve),!0):(console.error("沒有課程ID，無法獲取課程資料"),v.showError("錯誤","沒有課程ID，無法獲取課程資料"),C.value=!1,!1),r=ve=>{if(ve.code!==0||ve.message!=="success"){console.error("獲取課程資料失敗:",ve.message),v.showError("錯誤",ve.message||"獲取課程資料失敗");return}const ie=ve.data.result;if(!ie){console.error("找不到課程資料"),v.showError("錯誤","找不到課程資料");return}b(ie)},b=ve=>{console.log("要處理的課程資料:",ve),p(ve),_(ve),T.value=JSON.parse(JSON.stringify(U.value)),z.value=JSON.parse(JSON.stringify(K.value))},p=ve=>{U.value={id:ve.id,schoolId:ve.school,courseName:ve.courseName,startDate:k(ve.startDate),endDate:k(ve.endDate),hours:ve.hours===-1?"缺":ve.hours,contactName:ve.contactName==="-1"?"缺":ve.contactName,contactPhone:ve.contactPhone==="-1"?"缺":ve.contactPhone,teacher:ve.teacher==="-1"?"缺":ve.teacher,courseCode:ve.courseCode,courseMode:ve.courseMode||"",classSize:ve.classSize===-1?"缺":ve.classSize,graduates:ve.graduates===-1?"缺":ve.graduates,respondents:ve.respondents===-1?"缺":ve.respondents},console.log("處理後的課程資料:",U.value)},_=ve=>{ve.timeSlots&&ve.timeSlots.length>0&&(g.value=ve.timeSlots.some(ie=>ie.weekday===-1),localStorage.setItem("courseHasTimeSlotWithNegativeOne",g.value)),console.log("原始 timeSlots:",ve.timeSlots),K.value=Z(ve.timeSlots),console.log("處理後的 timeSlots:",K.value)},f=ve=>{console.error("獲取課程資料錯誤:",ve),v.showError("錯誤","獲取課程資料時發生錯誤")},V=async()=>{try{const ve=await nt.getSchoolOptions();ve.data.code===0&&ve.data.message==="success"?E.value=ve.data.data:console.error("獲取訓練單位選項失敗:",ve.data.message)}catch(ve){console.error("獲取訓練單位選項錯誤:",ve)}},W=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&L():(T.value=JSON.parse(JSON.stringify(U.value)),z.value=JSON.parse(JSON.stringify(K.value)),g.value&&(K.value=[{day:"",startTime:"",endTime:""}]),u.value=!0)},H=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&de()},k=ve=>!ve||ve==="-1"?(console.log("日期為空或-1:",ve),""):(console.log("使用原始日期格式:",ve),ve),D=ve=>{if(!ve)return!0;const ie=/^(\d{1,3})[/-]([0-1]?\d)[/-]([0-3]?\d)$/;if(!ie.test(ve))return!1;const _e=ve.indexOf("/")>0?"/":"-";if(_e==="/"&&ve.indexOf("-")>0||_e==="-"&&ve.indexOf("/")>0)return!1;const Le=ve.match(ie),ge=parseInt(Le[2]),q=parseInt(Le[3]);return ge>=1&&ge<=12&&q>=1&&q<=31&&!((ge===4||ge===6||ge===9||ge===11)&&q>30)&&!(ge===2&&q>29)},j=()=>U.value.id?U.value.schoolId?U.value.courseName?!0:(v.showError("錯誤","請輸入課程名稱"),!1):(v.showError("錯誤","請選擇訓練單位"),!1):(v.showError("錯誤","課程 ID 不存在，無法更新課程"),!1),S=()=>U.value.startDate&&!D(U.value.startDate)?(v.showError("錯誤","開課日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1):U.value.endDate&&!D(U.value.endDate)?(v.showError("錯誤","結業日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1):!0,x=()=>{const ve=$();return{id:U.value.id,courseName:U.value.courseName,school:parseInt(U.value.schoolId),startDate:U.value.startDate,endDate:U.value.endDate,timeSlots:ve,hours:U.value.hours==="缺"?-1:parseInt(U.value.hours)||0,contactName:U.value.contactName==="缺"?"-1":U.value.contactName||"-1",contactPhone:U.value.contactPhone==="缺"?"-1":U.value.contactPhone||"-1",teacher:U.value.teacher==="缺"?"-1":U.value.teacher||"-1",courseCode:U.value.courseCode,courseMode:U.value.courseMode||"",classSize:U.value.classSize==="缺"?-1:parseInt(U.value.classSize)||0,graduates:U.value.graduates==="缺"?-1:parseInt(U.value.graduates)||0,respondents:U.value.respondents==="缺"?-1:parseInt(U.value.respondents)||0}},L=async()=>{try{if(C.value=!0,!j()){C.value=!1;return}if(!S()){C.value=!1;return}const ve=x(),ie=await Zt.updateCourse(U.value.id,ve);ie.data.code===0?(u.value=!1,await c(),await Y(),v.showSuccess("儲存成功","課程資料已成功更新")):v.showError("儲存失敗",ie.data.message||"儲存課程資料失敗")}catch(ve){console.error("儲存課程資料錯誤:",ve),v.showError("儲存失敗","儲存課程資料時發生錯誤")}finally{C.value=!1}},de=()=>{U.value=JSON.parse(JSON.stringify(T.value)),K.value=JSON.parse(JSON.stringify(z.value)),localStorage.getItem("courseHasTimeSlotWithNegativeOne")==="true"&&(g.value=!0),u.value=!1},xe=()=>{if(d.query.from==="course"){console.log("從課程頁面來，返回到課程頁面，保留頁碼:",d.query.page),console.log("完整路由參數:",d.query);const ve={page:d.query.page||"",year:d.query.year||"",school:d.query.school||"",course:d.query.course||"",month:d.query.month||"",searchKeyword:d.query.searchKeyword||"",sortBy:d.query.sortBy||"",sortOrder:d.query.sortOrder||""};Object.keys(ve).forEach(ie=>{ve[ie]===""&&delete ve[ie]}),console.log("返回課程頁面的最終參數:",ve),h.push({path:"/course",query:ve})}else console.log("不是從課程頁面來，使用 router.back()"),h.back()};Ee(()=>d.params.id,ve=>{ve?c():(console.error("沒有課程ID，無法獲取課程資料"),v.showError("錯誤","沒有課程ID，無法獲取課程資料"))}),je(()=>{localStorage.removeItem("courseHasTimeSlotWithNegativeOne"),V(),c(),Be()});const fe=m(1),ke=m(0),De=m(0),we=m([]),$e=m(!1),ae=Se(()=>ke.value<=5?O(ke.value):A(fe.value,ke.value,5)),O=ve=>{const ie=[];for(let _e=1;_e<=ve;_e++)ie.push(_e);return ie},A=(ve,ie,_e)=>{const Le=[],ge=Math.floor(_e/2);let q=ve-ge,i=ve+ge;q<1?(q=1,i=_e):i>ie&&(i=ie,q=ie-_e+1),J(Le,q);for(let n=q;n<=i;n++)Le.push(n);return Q(Le,i,ie),Le},J=(ve,ie)=>{ie<=1||(ve.push(1),ie>2&&ve.push("..."))},Q=(ve,ie,_e)=>{ie>=_e||(ie<_e-1&&ve.push("..."),ve.push(_e))},Y=async()=>{var ve,ie;try{$e.value=!0;const _e=d.params.id;if(!_e){console.error("沒有課程ID，無法獲取出缺勤資料"),v.showError("錯誤","沒有課程ID，無法獲取出缺勤資料"),$e.value=!1;return}const Le={page:fe.value,limit:$2,id:_e},ge=await Zt.getAbsenceHistory(Le);if(((ve=ge==null?void 0:ge.data)==null?void 0:ve.code)===0){const{list:q}=ge.data.data.result;De.value=ge.data.data.totalCount,ke.value=ge.data.data.totalPage,we.value=q.map(i=>({id:i.id,studentId:i.studentId===-1||i.studentId==="-1"?"缺":i.studentId,name:i.name,subsidyCategory:i.subsidyCategory===-1||i.subsidyCategory==="-1"?"缺":i.subsidyCategory,status:i.status===-1||i.status==="-1"?"缺":i.status,classHours:i.classHours===-1||i.classHours==="-1"?"缺":i.classHours,absenceHours:i.absenceHours===-1||i.absenceHours==="-1"?"缺":i.absenceHours,attendanceHours:i.attendanceHours===-1||i.attendanceHours==="-1"?"缺":i.attendanceHours,earnedCredits:i.earnedCredits===-1||i.earnedCredits==="-1"?"缺":i.earnedCredits,grade:i.grade===-1||i.grade==="-1"?"缺":i.grade,certificateNumber:i.certificateNumber===-1||i.certificateNumber==="-1"?"缺":i.certificateNumber}))}else console.error("獲取出缺勤資料失敗:",((ie=ge==null?void 0:ge.data)==null?void 0:ie.message)||"未知錯誤"),we.value=[],De.value=0,ke.value=0}catch(_e){console.error("獲取出缺勤資料錯誤:",_e),we.value=[],De.value=0,ke.value=0}finally{$e.value=!1}};Ee(()=>U.value.id,ve=>{ve&&Y()}),Ee(fe,()=>{Y()});const ue=ve=>{fe.value=ve},pe=()=>{fe.value>1&&fe.value--},ye=()=>{fe.value<ke.value&&fe.value++},ne=ve=>{if(ve){const ie={from:"courseEdit",courseId:d.params.id,page:fe.value,originalCoursePage:d.query.page||"1"};console.log("CourseEdit.vue goToSingle parameters:",{studentId:ve,courseId:d.params.id,finalQueryParams:ie}),h.push({name:"Single",params:{id:ve},query:ie})}},se=(ve,ie)=>{if(!u.value)return;const _e=ve.target.value,ge=_e.replace(/[^0-9/-]/g,"").slice(0,10);_e!==ge&&(U.value[ie]=ge)},re=async()=>{if(await v.confirmAsync("確認刪除",`確定要刪除課程「${U.value.courseName}」嗎？刪除後資料將無法恢復。`)){const ie=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(ie===null||ie==="")return;try{if(C.value=!0,(await Zt.confirmPassword(ie)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),C.value=!1;return}const Le=await Zt.deleteCourse(U.value.id);Le.data.code===0?(v.showSuccess("刪除成功","課程已成功刪除"),h.push({path:"/course",query:{page:d.query.page||"1",year:d.query.year||"",school:d.query.school||"",course:d.query.course||"",month:d.query.month||"",searchKeyword:d.query.searchKeyword||"",sortBy:d.query.sortBy||"",sortOrder:d.query.sortOrder||""}})):v.showError("刪除失敗",Le.data.message||"刪除課程失敗")}catch(_e){console.error("操作錯誤:",_e),_e.response&&_e.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除課程時發生錯誤，請稍後再試")}finally{C.value=!1}}},Te=m({courseDataUpdate:!1,courseDataDelete:!1,satisfactionRead:!1}),Be=async()=>{try{const ve=await ot.getSidebarPermissions();ve.data.code===0&&ve.data.message==="success"?(Te.value=ve.data.data,console.log("課程編輯頁面權限:",Te.value)):console.error("獲取權限失敗:",ve.data.message)}catch(ve){console.error("獲取權限錯誤:",ve)}};return(ve,ie)=>(t(),s("div",lx,[e("div",nx,[Ge(ft,{breadcrumbs:[{name:"課程內容",path:"/course"},{name:"課程編輯",path:"/course-edit"}]}),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:xe},ie[17]||(ie[17]=[e("span",{class:"mr-2"},"←",-1),me(" 回課程資訊頁面 ")]))]),ie[40]||(ie[40]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",rx,[e("div",ix,[u.value&&Te.value.courseDataDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:re}," 刪除課程 ")):G("",!0),u.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:H}," 取消 ")):G("",!0),Te.value.courseDataUpdate?(t(),s("button",{key:2,class:ee(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:W},l(u.value?"儲存":"內容編輯"),3)):G("",!0)])]),C.value?(t(),s("div",dx,ie[18]||(ie[18]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",ux,[e("div",cx,[e("div",px,[ie[20]||(ie[20]=e("label",{class:"w-28",for:"schoolId"},"訓練單位:",-1)),P(e("select",{id:"schoolId",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":ie[0]||(ie[0]=_e=>U.value.schoolId=_e)},[ie[19]||(ie[19]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(X,null,le(E.value,_e=>(t(),s("option",{key:_e.id,value:_e.id},l(_e.name),9,mx))),128))],10,vx),[[Pe,U.value.schoolId]])]),e("div",bx,[ie[21]||(ie[21]=e("label",{class:"w-28",for:"courseCode"},"課程編號:",-1)),P(e("input",{id:"courseCode",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[1]||(ie[1]=_e=>U.value.courseCode=_e),readonly:!u.value},null,10,fx),[[te,U.value.courseCode]])]),e("div",yx,[ie[22]||(ie[22]=e("label",{class:"w-28",for:"courseName"},"課程名稱:",-1)),P(e("input",{id:"courseName",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[2]||(ie[2]=_e=>U.value.courseName=_e),readonly:!u.value},null,10,gx),[[te,U.value.courseName]])]),e("div",xx,[ie[23]||(ie[23]=e("label",{class:"w-28",for:"startDate"},"開課日期:",-1)),P(e("input",{id:"startDate",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[3]||(ie[3]=_e=>U.value.startDate=_e),readonly:!u.value,placeholder:"請輸入民國年格式，例如：113/01/05",onInput:ie[4]||(ie[4]=_e=>se(_e,"startDate"))},null,42,hx),[[te,U.value.startDate]])]),e("div",wx,[ie[24]||(ie[24]=e("label",{class:"w-28",for:"endDate"},"結業日期:",-1)),P(e("input",{id:"endDate",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[5]||(ie[5]=_e=>U.value.endDate=_e),readonly:!u.value,placeholder:"請輸入民國年格式，例如：113/05/05",onInput:ie[6]||(ie[6]=_e=>se(_e,"endDate"))},null,42,_x),[[te,U.value.endDate]])]),e("div",kx,[ie[28]||(ie[28]=e("div",{class:"flex items-center"},[e("span",{class:"w-28",id:"timeSlotLabel"},"上課時段:")],-1)),e("div",$x,[e("div",Cx,[!u.value&&g.value?(t(),s("div",Ex,"缺")):(t(),s(X,{key:1},[(t(!0),s(X,null,le(K.value,(_e,Le)=>(t(),s("div",{key:Le},[e("div",Sx,[e("span",Dx,"時段 "+l(Le+1),1),u.value&&K.value.length>1?(t(),s("button",{key:0,onClick:ge=>R(Le),class:"text-red-500 text-sm"}," 刪除此時段 ",8,Mx)):G("",!0)]),e("div",Ax,[e("div",Ix,[P(e("select",{id:`timeSlotDay-${Le}`,class:ee(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":ge=>_e.day=ge,"aria-label":`選擇星期 時段${Le+1}`},[ie[25]||(ie[25]=e("option",{value:""},"請選擇星期",-1)),(t(),s(X,null,le(N,ge=>e("option",{key:ge.value,value:ge.value},l(ge.label),9,Px)),64))],10,Rx),[[Pe,_e.day]])]),ie[26]||(ie[26]=e("div",{class:"w-[3.5%] flex justify-center items-center"},[e("span",{class:"text-center"},"從")],-1)),e("div",Ux,[P(e("input",{id:`timeSlotStart-${Le}`,type:"time",class:ee(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ge=>_e.startTime=ge,readonly:!u.value,"aria-label":`開始時間 時段${Le+1}`},null,10,Nx),[[te,_e.startTime]])]),ie[27]||(ie[27]=e("div",{class:"w-[3.5%] flex justify-center items-center"},[e("span",{class:"text-center"},"至")],-1)),e("div",Tx,[P(e("input",{id:`timeSlotEnd-${Le}`,type:"time",class:ee(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ge=>_e.endTime=ge,readonly:!u.value,"aria-label":`結束時間 時段${Le+1}`},null,10,Vx),[[te,_e.endTime]])])])]))),128)),u.value?(t(),s("button",{key:0,onClick:a,class:"mt-2 px-3 py-1 bg-[#f3f4ec] hover:bg-[#e6e7df] text-[#4e9875] rounded border border-[#4e9875]"}," + 新增上課時段 ")):G("",!0)],64))])])])]),e("div",jx,[e("div",Lx,[ie[29]||(ie[29]=e("label",{class:"w-28",for:"hours"},"上課時數:",-1)),P(e("input",{id:"hours",type:"number",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[7]||(ie[7]=_e=>U.value.hours=_e),readonly:!u.value},null,10,Fx),[[te,U.value.hours]])]),e("div",Ox,[ie[30]||(ie[30]=e("label",{class:"w-28",for:"contactName"},"負責人員:",-1)),P(e("input",{id:"contactName",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[8]||(ie[8]=_e=>U.value.contactName=_e),readonly:!u.value},null,10,qx),[[te,U.value.contactName]])]),e("div",Bx,[ie[31]||(ie[31]=e("label",{class:"w-28",for:"contactPhone"},"聯絡方式:",-1)),P(e("input",{id:"contactPhone",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[9]||(ie[9]=_e=>U.value.contactPhone=_e),readonly:!u.value},null,10,Hx),[[te,U.value.contactPhone]])]),e("div",Wx,[ie[32]||(ie[32]=e("label",{class:"w-28",for:"teacher"},"授課老師:",-1)),P(e("input",{id:"teacher",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[10]||(ie[10]=_e=>U.value.teacher=_e),readonly:!u.value},null,10,zx),[[te,U.value.teacher]])]),e("div",Kx,[ie[34]||(ie[34]=e("label",{class:"w-28",for:"courseMode"},"訓練方式:",-1)),P(e("select",{id:"courseMode",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":ie[11]||(ie[11]=_e=>U.value.courseMode=_e)},ie[33]||(ie[33]=[e("option",{value:""},"請選擇訓練方式",-1),e("option",{value:"1"},"線上",-1),e("option",{value:"2"},"實體",-1),e("option",{value:"3"},"線上/實體",-1)]),10,Jx),[[Pe,U.value.courseMode]])]),e("div",Yx,[ie[35]||(ie[35]=e("label",{class:"w-28",for:"classSize"},"開課人數:",-1)),P(e("input",{id:"classSize",type:"number",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[12]||(ie[12]=_e=>U.value.classSize=_e),readonly:!u.value},null,10,Gx),[[te,U.value.classSize]])]),e("div",Zx,[ie[36]||(ie[36]=e("label",{class:"w-28",for:"graduates"},"結訓人數:",-1)),P(e("input",{id:"graduates",type:"number",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[13]||(ie[13]=_e=>U.value.graduates=_e),readonly:!u.value},null,10,Qx),[[te,U.value.graduates]])]),e("div",Xx,[ie[37]||(ie[37]=e("label",{class:"w-28",for:"respondents"},"問卷人數:",-1)),P(e("input",{id:"respondents",type:"number",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ie[14]||(ie[14]=_e=>U.value.respondents=_e),readonly:!u.value},null,10,e2),[[te,U.value.respondents]])])])])),ie[41]||(ie[41]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",t2,[e("div",s2,[e("button",{class:ee(["px-6 py-3 font-medium",o.value==="attendance"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-gray-800"]),onClick:ie[15]||(ie[15]=_e=>o.value="attendance")}," 出缺勤資訊 ",2),Te.value.satisfactionRead?(t(),s("button",{key:0,class:ee(["px-6 py-3 font-medium",o.value==="survey"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-gray-800"]),onClick:ie[16]||(ie[16]=_e=>o.value="survey")}," 滿意度調查 ",2)):G("",!0)])]),o.value==="attendance"?(t(),s("div",a2,[$e.value?(t(),s("div",o2,ie[38]||(ie[38]=[e("div",{class:"text-lg"},"出缺勤資料載入中...",-1)]))):we.value.length>0?(t(),s("table",l2,[ie[39]||(ie[39]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"序"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"補助類別"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"訓練時數"),e("th",{class:"border p-2"},"缺席時數"),e("th",{class:"border p-2"},"出席時數"),e("th",{class:"border p-2"},"取得學分數"),e("th",{class:"border p-2"},"成績"),e("th",{class:"border p-2"},"證書編號")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(we.value,(_e,Le)=>(t(),s("tr",{key:_e.id,class:"hover:bg-gray-100 cursor-pointer",onClick:ge=>ne(_e.id)},[e("td",r2,l(Le+1),1),e("td",i2,l(_e.name),1),e("td",d2,l(_e.subsidyCategory),1),e("td",u2,l(_e.status),1),e("td",c2,l(_e.classHours),1),e("td",p2,l(_e.absenceHours),1),e("td",v2,l(_e.attendanceHours),1),e("td",m2,l(_e.earnedCredits),1),e("td",b2,l(_e.grade),1),e("td",f2,l(_e.certificateNumber),1)],8,n2))),128))])])):(t(),s("div",y2," 尚無出缺勤資料 ")),ke.value>0?(t(),s("div",g2,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:fe.value===1,onClick:pe}," 上一頁 ",8,x2),(t(!0),s(X,null,le(ae.value,_e=>(t(),s(X,{key:_e},[_e!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":_e===fe.value}]),onClick:Le=>ue(_e)},l(_e),11,h2)):(t(),s("span",w2,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:fe.value===ke.value,onClick:ye}," 下一頁 ",8,_2)])):G("",!0)])):G("",!0),o.value==="survey"&&Te.value.satisfactionRead?(t(),s("div",k2,[Ge(ox,{courseId:St(d).params.id},null,8,["courseId"])])):G("",!0)]))}},E2=Fe(C2,[["__scopeId","data-v-255a7604"]]),S2={class:"flex flex-col items-center p-6"},D2={class:"w-full max-w-[1500px]"},M2={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},A2={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},I2={key:1,class:"w-full max-w-[1500px] grid grid-cols-3 gap-6"},R2={class:"space-y-6"},P2={class:"flex items-center"},U2={class:"flex items-center"},N2={class:"flex items-center"},T2={class:"space-y-6"},V2={class:"flex items-center"},j2=["value"],L2={class:"flex items-center"},F2={class:"flex items-center"},O2={class:"flex items-center"},q2={class:"flex items-center"},B2={class:"space-y-6"},H2={class:"flex items-center"},W2={class:"flex items-center"},z2={class:"flex items-center"},K2={class:"flex items-center"},J2={__name:"Add",setup(M){const h=We(),d=m(!1),u=k=>/^[A-Z]\d{9}$/.test(k),C=k=>/^09\d{8}$/.test(k),o=k=>{if(!k)return!0;const D=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;return k.length>254?!1:D.test(k)},N=k=>/^[\u4e00-\u9fa5a-zA-Z\s]+$/.test(k),K=k=>k?/^\d{3,7}$/.test(k):!0,E=k=>k?/^\d{3,4}$/.test(k):!0,U=k=>k?/^[0-9-]{8,16}$/.test(k):!0,z=m({...{name:"",gender:"1",idNumber:"",agencyId:"",phone:"",officePhone:"",officeEmail:"",email:"",subsidyCategory:"1",bankCode:"",branchCode:"",bankAccount:""}}),g=m([]),a=m(""),R=m("1"),Z=m("1"),$=async()=>{try{const k=await nt.getAgencyOptions();k.data.code===0&&k.data.message==="success"?g.value=k.data.data:v.showError("載入失敗","獲取機關選項失敗: "+k.data.message)}catch(k){v.showError("載入失敗","獲取機關選項錯誤"),console.error("獲取機關選項錯誤:",k)}},c=async()=>{await v.confirmAsync("確認離開","確定要離開嗎？所有未儲存的資料將會遺失。")&&h.back()},y=async()=>{if(r())try{d.value=!0;const k=f(),D=await V(k);W(D)}catch(k){H(k)}finally{d.value=!1}},r=()=>b()&&p()&&_(),b=()=>z.value.name?N(z.value.name)?z.value.idNumber?u(z.value.idNumber)?a.value?!0:(v.showError("貼心提醒","請選擇機關"),!1):(v.showError("貼心提醒","身分證字號格式不正確，請輸入第一個為大寫英文加上9碼數字"),!1):(v.showError("貼心提醒","請輸入身分證字號"),!1):(v.showError("貼心提醒","姓名格式不正確，只能包含中文、英文字母和空格"),!1):(v.showError("貼心提醒","請輸入姓名"),!1),p=()=>z.value.phone&&!C(z.value.phone)?(v.showError("貼心提醒","行動電話格式不正確，請輸入09開頭的10位數字"),!1):z.value.email&&!o(z.value.email)?(v.showError("貼心提醒","私人郵件格式不正確，請輸入有效的電子郵件地址"),!1):z.value.officeEmail&&!o(z.value.officeEmail)?(v.showError("貼心提醒","公務郵件格式不正確，請輸入有效的電子郵件地址"),!1):!0,_=()=>z.value.bankCode&&!K(z.value.bankCode)?(v.showError("貼心提醒","銀行代碼格式不正確，請輸入3-7位數字"),!1):z.value.branchCode&&!E(z.value.branchCode)?(v.showError("貼心提醒","分行代碼格式不正確，請輸入3-4位數字"),!1):z.value.bankAccount&&!U(z.value.bankAccount)?(v.showError("貼心提醒","銀行帳號格式不正確，請輸入8-16位數字，可包含連字符號"),!1):!0,f=()=>{const k={...z.value,gender:Number(R.value),agencyId:Number(a.value),subsidyCategory:Number(Z.value)};return Object.keys(k).forEach(D=>{(k[D]===""||k[D]===null||k[D]===void 0)&&(k[D]="")}),console.log("提交數據:",k),k},V=async k=>await Lt.addStudent(k),W=k=>{k.data.code===0?(v.showSuccess("貼心提醒","新增學員成功"),setTimeout(()=>{h.back()},1500)):v.showError("貼心提醒",k.data.message||"新增學員失敗")},H=k=>{console.error("新增學員錯誤:",k),v.showError("貼心提醒","新增學員失敗，請稍後再試")};return je(()=>{$()}),(k,D)=>(t(),s("div",S2,[e("div",D2,[Ge(ft,{breadcrumbs:[{name:"學員資料",path:"/student/information"},{name:"新增學員",path:"/student/add"}]})]),e("div",M2,[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:D[0]||(D[0]=j=>St(h).back()),"aria-label":"回學員資料頁面"},D[14]||(D[14]=[e("span",{class:"mr-2"},"←",-1),me(" 回學員資料頁面 ")]))]),D[32]||(D[32]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",{class:"w-full max-w-[1500px] flex justify-between items-center mb-6"},[D[15]||(D[15]=e("div",{class:"text-sm text-gray-600"},[e("span",{class:"text-red-500"},"*"),me(" 代表必填欄位 ")],-1)),e("div",{class:"space-x-4"},[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:c,"aria-label":"取消新增學員"}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:y,"aria-label":"儲存學員資料"}," 儲存 ")])]),d.value?(t(),s("div",A2,D[16]||(D[16]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",I2,[e("div",R2,[e("div",P2,[D[17]||(D[17]=e("label",{class:"w-24",for:"student-name"},[me("姓名:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{id:"student-name",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[1]||(D[1]=j=>z.value.name=j),placeholder:"請輸入姓名，只能填寫中英文"},null,512),[[te,z.value.name]])]),e("div",U2,[D[19]||(D[19]=e("label",{class:"w-24",for:"student-gender"},[me("性別:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"student-gender",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":D[2]||(D[2]=j=>R.value=j)},D[18]||(D[18]=[e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512),[[Pe,R.value]])]),e("div",N2,[D[20]||(D[20]=e("label",{class:"w-24",for:"student-id-number"},[me("身分證字號:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{id:"student-id-number",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[3]||(D[3]=j=>z.value.idNumber=j),placeholder:"大寫英文+9碼數字，例：A123456789",onInput:D[4]||(D[4]=j=>z.value.idNumber=z.value.idNumber.toUpperCase()),maxlength:"10"},null,544),[[te,z.value.idNumber]])])]),e("div",T2,[e("div",V2,[D[22]||(D[22]=e("label",{class:"w-24",for:"student-agency"},[me("機關名稱:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"student-agency",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":D[5]||(D[5]=j=>a.value=j)},[D[21]||(D[21]=e("option",{value:""},"請選擇機關",-1)),(t(!0),s(X,null,le(g.value,j=>(t(),s("option",{key:j.id,value:j.id},l(j.name),9,j2))),128))],512),[[Pe,a.value]])]),e("div",L2,[D[23]||(D[23]=e("label",{class:"w-24",for:"student-phone"},"行動電話:",-1)),P(e("input",{id:"student-phone",type:"tel",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[6]||(D[6]=j=>z.value.phone=j),placeholder:"09開頭的10位數字，例：0912345678",maxlength:"10"},null,512),[[te,z.value.phone]])]),e("div",F2,[D[24]||(D[24]=e("label",{class:"w-24",for:"student-office-phone"},"公務電話:",-1)),P(e("input",{id:"student-office-phone",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[7]||(D[7]=j=>z.value.officePhone=j),placeholder:"可填寫手機、市話(含區碼)或內線"},null,512),[[te,z.value.officePhone]])]),e("div",O2,[D[25]||(D[25]=e("label",{class:"w-24",for:"student-office-email"},"公務郵件:",-1)),P(e("input",{id:"student-office-email",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[8]||(D[8]=j=>z.value.officeEmail=j),placeholder:"例：example@gov.tw"},null,512),[[te,z.value.officeEmail]])]),e("div",q2,[D[26]||(D[26]=e("label",{class:"w-24",for:"student-email"},"私人郵件:",-1)),P(e("input",{id:"student-email",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[9]||(D[9]=j=>z.value.email=j),placeholder:"例：example@example.com"},null,512),[[te,z.value.email]])])]),e("div",B2,[e("div",H2,[D[28]||(D[28]=e("label",{class:"w-24",for:"subsidy-category"},[me("補助類別:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"subsidy-category",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":D[10]||(D[10]=j=>Z.value=j)},D[27]||(D[27]=[e("option",{value:"1"},"機關薦派",-1),e("option",{value:"2"},"自行報名",-1),e("option",{value:"3"},"非本計畫",-1)]),512),[[Pe,Z.value]])]),e("div",W2,[D[29]||(D[29]=e("label",{class:"w-24",for:"bank-code"},"銀行代碼:",-1)),P(e("input",{id:"bank-code",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[11]||(D[11]=j=>z.value.bankCode=j),placeholder:"請輸入3-7位數字的銀行代碼",maxlength:"7"},null,512),[[te,z.value.bankCode]])]),e("div",z2,[D[30]||(D[30]=e("label",{class:"w-24",for:"branch-code"},"分行代碼:",-1)),P(e("input",{id:"branch-code",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[12]||(D[12]=j=>z.value.branchCode=j),placeholder:"請輸入3-4位數字的分行代碼",maxlength:"4"},null,512),[[te,z.value.branchCode]])]),e("div",K2,[D[31]||(D[31]=e("label",{class:"w-24",for:"bank-account"},"銀行帳號:",-1)),P(e("input",{id:"bank-account",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":D[13]||(D[13]=j=>z.value.bankAccount=j),placeholder:"請輸入8-16位數字的銀行帳號，可包含連字符號",maxlength:"16"},null,512),[[te,z.value.bankAccount]])])])]))]))}},Y2=Fe(J2,[["__scopeId","data-v-9637f4f2"]]),G2={class:"flex flex-col items-center p-6"},Z2={class:"w-full max-w-[1500px] flex justify-between items-center"},Q2={class:"w-full max-w-[1500px] flex justify-end mb-6"},X2={class:"space-x-4"},eh=["aria-label"],th={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},sh={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},ah={class:"space-y-6"},oh={class:"flex items-center"},lh=["readonly"],nh={class:"flex items-center"},rh=["readonly"],ih={class:"flex items-center"},dh={class:"flex-1 flex items-center"},uh=["readonly"],ch=["readonly"],ph={__name:"SingleEdit",setup(M){const h=We(),d=rt(),u=m(!1),C=m(!1),o=m({id:0,certificateNumber:"",grade:-1,certificateStartDate:"",certificateEndDate:""}),N=m({}),K=Se(()=>{const Z=d.query.studentId;let $=[];if(Z)switch(d.query.originalFrom){case"information":$=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:`/student/single/${Z}`},{name:"學分編輯",path:""}];break;case"history":$=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${Z}`},{name:"學分編輯",path:""}];break;case"courseEdit":$=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${Z}`},{name:"學分編輯",path:""}];break;default:$=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${Z}`},{name:"學分編輯",path:""}]}else $=[{name:"學員管理",path:"/student/information"},{name:"學分編輯",path:""}];return $}),E=()=>{if(d.query.studentId){const Z=d.query.originalFrom;console.log("SingleEdit 返回 Single 頁面，原始來源:",Z),d.query.courseId,d.query.page,["year","school","course","agency","area","searchKeyword","month","sortBy","sortOrder"].forEach($=>{d.query[$]&&d.query[$]}),h.back()}else h.back()},U=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&z():(N.value=JSON.parse(JSON.stringify(o.value)),u.value=!0)},T=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&g()},z=()=>{u.value=!1,a(o.value)},g=()=>{o.value=JSON.parse(JSON.stringify(N.value)),u.value=!1},a=async Z=>{try{C.value=!0,console.log("保存學分資料:",Z);const $={grade:Number(Z.grade),certificateNumber:Z.certificateNumber,certificateStartDate:Z.certificateStartDate,certificateEndDate:Z.certificateEndDate},c=await Lt.updateLearnHistory(Z.id,$);c.data.code===0?v.showSuccess("儲存成功","學分資料已成功儲存"):v.showError("儲存失敗",c.data.message||"儲存學分資料時發生錯誤")}catch($){console.error("儲存學分資料錯誤:",$),v.showError("儲存失敗","儲存學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},R=async()=>{try{C.value=!0;const Z=d.params.id;if(!Z){console.error("未提供學習歷史ID");return}const $=await Lt.getLearnHistoryById(Z);if(console.log("API 回應:",$.data),!$.data.data||!$.data.data.result){console.error("API 回應格式錯誤:",$.data),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試");return}o.value={id:Z,certificateNumber:$.data.data.result.certificateNumber||"",grade:$.data.data.result.grade!==void 0?Number($.data.data.result.grade):-1,certificateStartDate:$.data.data.result.certificateStartDate||"",certificateEndDate:$.data.data.result.certificateEndDate||""},N.value=JSON.parse(JSON.stringify(o.value))}catch(Z){console.error("獲取學分資料錯誤:",Z),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}};return je(()=>{R()}),(Z,$)=>(t(),s("div",G2,[e("div",Z2,[Ge(ft,{breadcrumbs:K.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:E,"aria-label":"返回上一頁"},$[4]||($[4]=[e("span",{class:"mr-2"},"←",-1),me(" 回上一頁 ")]))]),$[10]||($[10]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",Q2,[e("div",X2,[u.value?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:T,"aria-label":"取消編輯"}," 取消 ")):G("",!0),e("button",{class:ee(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:U,"aria-label":u.value?"儲存編輯內容":"開始編輯內容"},l(u.value?"儲存":"內容編輯"),11,eh)])]),C.value?(t(),s("div",th,$[5]||($[5]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",sh,[e("div",ah,[e("div",oh,[$[6]||($[6]=e("label",{class:"w-36",for:"certificateNumber"},"學分證書編號:",-1)),P(e("input",{id:"certificateNumber",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":$[0]||($[0]=c=>o.value.certificateNumber=c),readonly:!u.value},null,10,lh),[[te,o.value.certificateNumber]])]),e("div",nh,[$[7]||($[7]=e("label",{class:"w-36",for:"creditGrade"},"成績:",-1)),P(e("input",{id:"creditGrade",type:"number",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":$[1]||($[1]=c=>o.value.grade=c),readonly:!u.value},null,10,rh),[[te,o.value.grade]])]),e("div",ih,[$[9]||($[9]=e("label",{class:"w-36",for:"certificateDates"},"證書參照日期起迄:",-1)),e("div",dh,[P(e("input",{id:"certificateStartDate",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":$[2]||($[2]=c=>o.value.certificateStartDate=c),readonly:!u.value,placeholder:"例：113/02/01"},null,10,uh),[[te,o.value.certificateStartDate]]),$[8]||($[8]=e("span",{class:"mx-2"},"~",-1)),P(e("input",{id:"certificateEndDate",type:"text",class:ee(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":$[3]||($[3]=c=>o.value.certificateEndDate=c),readonly:!u.value,placeholder:"例：116/02/01"},null,10,ch),[[te,o.value.certificateEndDate]])])])])]))]))}},vh=Fe(ph,[["__scopeId","data-v-a78d0233"]]),mh={class:"w-full h-full"},bh=["src"],fh={__name:"Dashboard",setup(M){const h=m("https://dev-moda.mosji.co/dashboard/");return je(()=>{const d=document.querySelector("iframe");d&&(d.style.height=`${window.innerHeight}px`)}),(d,u)=>(t(),s("div",mh,[e("iframe",{src:h.value,class:"w-full h-full border-0",title:"數據儀表板",allowfullscreen:""},null,8,bh)]))}},yh=Fe(fh,[["__scopeId","data-v-f531c2f3"]]),gh={class:"flex flex-col items-center p-6"},xh={class:"w-full max-w-[1500px]"},hh={class:"w-full max-w-[1500px] flex justify-end mb-2"},wh={class:"space-x-4"},_h=["disabled"],kh=["disabled"],$h={class:"w-full max-w-[1500px] border-2 border-black"},Ch={class:"w-full border-collapse"},Eh={class:"border-r border-black p-4 w-1/4"},Sh=["disabled"],Dh={value:""},Mh=["value"],Ah={class:"p-4 w-1/4"},Ih=["disabled"],Rh={value:""},Ph=["value"],Uh={class:"border-t-2 border-black p-4",colspan:"3"},Nh={class:"border-r border-t-2 border-black p-4",colspan:"1"},Th={class:"flex flex-col items-center"},Vh={class:"flex items-center mb-3"},jh={class:"flex items-center"},Lh={class:"border-t-2 border-black p-4"},Fh={class:"flex flex-col items-start"},Oh={class:"flex items-center mb-2"},qh=["checked"],Bh={class:"flex items-center flex-wrap"},Hh={class:"flex items-center mr-2"},Wh=["checked"],zh={class:"flex-1 min-w-[120px]"},Kh={class:"border-r border-t-2 border-black p-4",colspan:"1"},Jh={class:"border-t-2 border-black p-4",colspan:"1"},Yh={class:"w-full max-w-[1500px] border-2 border-black"},Gh={class:"w-full border-collapse"},Zh={class:"border-r border-black p-4 pl-8"},Qh={class:"flex items-center"},Xh={class:"border-r border-black p-4"},ew={class:"flex justify-around"},tw={class:"flex items-center"},sw=["checked","onChange"],aw={class:"flex items-center"},ow=["checked","onChange"],lw={class:"border-black p-4"},nw=["onUpdate:modelValue"],rw={class:"border-r border-black p-4 pl-8"},iw={class:"flex items-center"},dw={class:"border-r border-black p-4"},uw={class:"flex justify-around"},cw={class:"flex items-center"},pw=["checked","onChange"],vw={class:"flex items-center"},mw=["checked","onChange"],bw={class:"border-black p-4"},fw=["onUpdate:modelValue"],yw={class:"border-r border-black p-4 pl-8"},gw={class:"flex items-center"},xw={class:"border-r border-black p-4"},hw={class:"flex justify-around"},ww={class:"flex items-center"},_w=["checked","onChange"],kw={class:"flex items-center"},$w=["checked","onChange"],Cw={class:"border-black p-4"},Ew={key:0,class:"flex items-center"},Sw=["onUpdate:modelValue"],Dw={class:"border-r border-black p-4 pl-8"},Mw={class:"flex items-center"},Aw={class:"border-r border-black p-4"},Iw={class:"flex justify-around"},Rw={class:"flex items-center"},Pw=["checked","onChange"],Uw={class:"flex items-center"},Nw=["checked","onChange"],Tw={class:"border-black p-4"},Vw={key:0,class:"flex items-center"},jw=["onUpdate:modelValue"],Lw={class:"border-t-2 border-black p-4",colspan:"3"},Fw={class:"flex items-center mt-2"},Ow={class:"flex items-center mt-4"},qw={class:"flex items-center mr-6"},Bw=["checked"],Hw={class:"flex items-center"},Ww=["checked"],zw={class:"w-full max-w-[1500px] border-2 border-black mt-6"},Kw={class:"w-full border-collapse"},Jw={class:"p-4 w-3/4"},Yw={class:"w-full max-w-[1500px] mt-6"},Gw={class:"flex flex-wrap items-center"},Zw={class:"flex items-center ml-4"},Qw=["checked"],Xw={class:"flex items-center flex-wrap ml-6"},e_={class:"flex items-center mr-2"},t_=["checked"],s_=["disabled"],a_={__name:"Checklist",setup(M){const h=We();rt();const d=m([]),u=m([]),C=m(!1),o=m(!1),N=m(!1),K=m(!1),E=m({school:"",courseName:"",courseDate:"",year:"",month:"",day:"",startHour:"",startMinute:"",endHour:"",endMinute:"",inspectionType:"",inspectors:"",interviewee:"",onlineRemark:"",isOnline:!1,isOffline:!1,passCount:0,failCount:0,totalScore:"",improvement:"",needFollowUp:null,recheckRemark:"",questions:{"1-1":"(1) 授課師資與計畫相符","1-2":"(2) 課程內容依課程表授課","2-1":"(1) 陪課人員協助課堂服務","2-2":"(2) 製作教學日誌","2-3":"(3) 進行問卷調查","3-1":"(1) 場地符合授課需求","3-2":"(2) 有相應軟硬體設備進行授課，確保授課內容清楚傳達於學員。","3-3":"(3) 有提供穩定的網路連線功能進行授課，且提供穩定音訊、麥克風、即時訊息功能服務。(限查核線上課程)","4-1":"(1) 學員依規定簽到退","4-2":"(2) 備註遲到、請假及曠課人員","4-3":"(3) 提供授課課程教材","4-4":"(4) 確實填寫教學日誌","4-5":"(5) 投保公共意外責任險(限查核實體課程)"},checkResults:{"1-1":null,"1-2":null,"2-1":null,"2-2":null,"2-3":null,"3-1":null,"3-2":null,"3-3":null,"4-1":null,"4-2":null,"4-3":null,"4-4":null,"4-5":null},evidence:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""},hasPass:null,percentages:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""}}),U=async()=>{await v.confirmAsync("確認離開","確定要離開嗎？所有未儲存的資料將會遺失。")&&h.back()},T=()=>E.value.school?E.value.courseName?E.value.inspectionType?!0:(v.showError("貼心提醒","請選擇訪查方式"),!1):(v.showError("貼心提醒","請選擇課程名稱"),!1):(v.showError("貼心提醒","請選擇訪查學校"),!1),z=()=>{const S=/^[\u4e00-\u9fa5a-zA-Z\s]+$/;return E.value.inspectors?S.test(E.value.inspectors)?E.value.interviewee?S.test(E.value.interviewee)?!0:(v.showError("貼心提醒","聯絡人只能填寫中文和英文"),!1):(v.showError("貼心提醒","請輸入聯絡人"),!1):(v.showError("貼心提醒","訪查人員只能填寫中文和英文"),!1):(v.showError("貼心提醒","請輸入訪查人員"),!1)},g=()=>{const S=[1,2,3,4];let x=!1,L="",de="";const xe={1:"課程師資實施狀況",2:"人力安排情形",3:"環境設備實施狀況",4:"課程實施情形"};for(const fe of S){const ke=r(fe);for(const De of ke)(E.value.checkResults[De]===null||E.value.checkResults[De]===void 0)&&(x=!0,L||(L=xe[fe],de=E.value.questions[De]||`項目 ${De.split("-")[1]}`))}return x?(v.showError("貼心提醒",`請選擇所有查核項目的符合或不符合狀態。未選擇的項目：${L} - ${de}`),!1):!0},a=()=>{const S=E.value.year||"",x=E.value.month?String(E.value.month).padStart(2,"0"):"",L=E.value.day?String(E.value.day).padStart(2,"0"):"";if(!(S&&x&&L?`${S}/${x}/${L}`:""))return v.showError("貼心提醒","請填寫完整的訪查日期"),!1;const xe=/^\d+$/,fe={"開始時間(時)":E.value.startHour,"開始時間(分)":E.value.startMinute,"結束時間(時)":E.value.endHour,"結束時間(分)":E.value.endMinute};for(const[ke,De]of Object.entries(fe)){if(!De)return v.showError("貼心提醒",`請填寫${ke}`),!1;if(!xe.test(De))return v.showError("貼心提醒",`${ke}只能填寫數字`),!1}return!0},R=()=>E.value.inspectionType==="online"&&!E.value.onlineRemark?(v.showError("貼心提醒","請填寫線上訪查備註"),!1):!0,Z=()=>{const S=E.value.year||"",x=E.value.month?String(E.value.month).padStart(2,"0"):"",L=E.value.day?String(E.value.day).padStart(2,"0"):"",de=`${S}/${x}/${L}`,xe=String(E.value.startHour).padStart(2,"0"),fe=String(E.value.startMinute).padStart(2,"0"),ke=String(E.value.endHour).padStart(2,"0"),De=String(E.value.endMinute).padStart(2,"0");return{school:parseInt(E.value.school),course:parseInt(E.value.courseName),visitor:E.value.inspectors,visitDate:de,visitStartTime:`${xe}:${fe}`,visitEndTime:`${ke}:${De}`,visitMethod:E.value.inspectionType==="online"?1:2,interviewee:E.value.interviewee||null,onlineRemark:E.value.onlineRemark||null,isOnline:E.value.isOnline||null,isOffline:E.value.isOffline||null,totalScore:E.value.totalScore?parseInt(E.value.totalScore):null,passCount:E.value.passCount?parseInt(E.value.passCount):null,failCount:E.value.failCount?parseInt(E.value.failCount):null,improveRemark:E.value.improvement||null,needFollowUp:E.value.needFollowUp,recheckRemark:E.value.needFollowUp===!0&&E.value.recheckRemark||null,content:[{categoryName:"課程師資實施狀況",details:r(1).map(we=>({question:E.value.questions[we],ans:E.value.checkResults[we]===null?null:E.value.checkResults[we]===!0,remark:E.value.evidence[we]||null}))},{categoryName:"人力安排情形",details:r(2).map(we=>({question:E.value.questions[we],ans:E.value.checkResults[we]===null?null:E.value.checkResults[we]===!0,remark:E.value.evidence[we]||null}))},{categoryName:"環境設備實施狀況",details:r(3).map(we=>({question:E.value.questions[we],ans:E.value.checkResults[we]===null?null:E.value.checkResults[we]===!0,remark:E.value.evidence[we]||null}))},{categoryName:"課程實施情形",details:r(4).map(we=>({question:E.value.questions[we],ans:E.value.checkResults[we]===null?null:E.value.checkResults[we]===!0,remark:E.value.evidence[we]||null}))}]}},$=async()=>{var S;if(T()&&z()&&g()&&a()&&R())try{N.value=!0;const x=Z(),L=await Rs.createVisitHistory(x);if(L.data&&L.data.code===0){v.showSuccess("儲存成功","訪視記錄已成功儲存"),h.push("/supervision");return}v.showError("儲存失敗",((S=L.data)==null?void 0:S.message)||"儲存訪視記錄時發生錯誤")}catch(x){console.error("儲存訪視記錄錯誤:",x),v.showError("儲存失敗","儲存訪視記錄時發生錯誤，請稍後再試")}finally{N.value=!1}},c=async()=>{try{C.value=!0;const S=await nt.getSchoolOptions();S.data&&S.data.code===0&&Array.isArray(S.data.data)?d.value=S.data.data.map(x=>({value:x.id,label:x.name})):(console.error("學校資料格式不正確:",S.data),d.value=[])}catch(S){console.error("獲取學校列表失敗:",S),d.value=[]}finally{C.value=!1}},y=async S=>{if(!S){u.value=[],E.value.courseName="",E.value.courseDate="";return}try{o.value=!0;const x=await nt.getCourseData({school:S});x.data&&x.data.code===0&&Array.isArray(x.data.data)?(u.value=x.data.data.map(L=>({value:L.id,label:L.name,date:L.date||""})),u.value.length===1&&(E.value.courseName=u.value[0].value,E.value.courseDate=u.value[0].date||"")):(console.error("課程資料格式不正確:",x.data),u.value=[])}catch(x){console.error("獲取課程列表失敗:",x),E.value.courseName="",E.value.courseDate="",u.value=[]}finally{o.value=!1}};Ee(()=>E.value.school,S=>{S?y(S):(u.value=[],E.value.courseName="",E.value.courseDate="")}),Ee(()=>E.value.courseName,S=>{if(S){const x=u.value.find(L=>L.value===S);x&&(E.value.courseDate=x.date||"")}else E.value.courseDate=""}),je(()=>{c(),D()});const r=S=>{const x=`${S}-`;return Object.keys(E.value.questions).filter(de=>de.startsWith(x)).sort((de,xe)=>{const fe=parseInt(de.split("-")[1]),ke=parseInt(xe.split("-")[1]);return fe-ke})},b=()=>{const S=document.createElement("div");return S.style.width="100%",S.style.padding="20px",S},p=S=>{const x=document.createElement("h2");x.textContent="教學查核紀錄表",x.style.textAlign="center",x.style.marginBottom="20px",x.style.fontFamily="Arial, sans-serif",S.appendChild(x);const L=document.createElement("h2");L.textContent="113-116年推動政府資安人力職能轉換訓練服務",L.style.textAlign="center",L.style.marginBottom="20px",L.style.fontFamily="Arial, sans-serif",L.style.fontWeight="bold",S.insertBefore(L,x)},_=()=>{const S=document.createElement("div");S.style.marginBottom="20px";const x=document.createElement("h3");return x.textContent="一、訪查學校、時間及參與人員",x.style.fontWeight="bold",x.style.marginBottom="10px",S.appendChild(x),S},f=()=>{const S=document.createElement("table");return S.style.width="100%",S.style.borderCollapse="collapse",S.style.marginBottom="20px",S.style.border="1px solid #000",S},V=()=>{const S=d.value.find(xe=>xe.value===E.value.school),x=S?S.label:"",L=u.value.find(xe=>xe.value===E.value.courseName),de=L?L.label:"";return{schoolName:x,courseName:de}},W=(S,x)=>[{label1:"訪查學校",value1:S,label2:"課程名稱",value2:x},{label1:"授課時間",value1:E.value.courseDate,label2:"",value2:"",colspan:!0},{label1:"訪查時間(24 時制)",value1:"",label2:"訪查方式",value2:"",needCustom:!0},{label1:"聯絡人",value1:E.value.interviewee,label2:"訪查人員",value2:E.value.inspectors}],H=(S,x)=>{setTimeout(()=>{try{const L=window.open("","_blank");if(!L)throw new Error("無法開啟列印視窗，請檢查是否被瀏覽器阻擋");let de="<html><head><title>教學查核紀錄表</title>";de+="<style>",de+="body { font-family: Arial, sans-serif; padding: 20px; margin:  ; }",de+="h2 { text-align: center; margin-bottom: 20px; }",de+="h3 { margin-top: 20px; margin-bottom: 10px; }",de+="table { width: 100%; border-collapse: collapse; margin-bottom: 20px; page-break-inside: auto; }",de+="tr { page-break-inside: avoid; page-break-after: auto; }",de+="thead { display: table-header-group; }",de+="tfoot { display: table-footer-group; }",de+="th, td { border: 1px solid #000; padding: 6px; }",de+="th { background-color: #f2f2f2; text-align: center; }",de+="@media print {",de+="  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",de+="  th, td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",de+="  @page { margin: 0; size: auto; }",de+="  html { margin: 0; padding: 0.5cm; }",de+="  body { margin: 0; padding: 0; }",de+="  .signature-section { display: flex; justify-content: space-between; margin-top: 20px; }",de+="  .signature-box { margin-bottom: 10px; }",de+="}",de+="</style></head><body>",de+=S.innerHTML,de+="<script>",de+="window.onload = function() {",de+="  setTimeout(function() {",de+='    var style = document.createElement("style");',de+='    style.innerHTML = "@page { margin: 1cm; }";',de+="    document.head.appendChild(style);",de+="    window.print();",de+="  }, 300);",de+="};",de+="<\/script>",de+="</body></html>",L.document.open(),L.document.write(de),L.document.close(),L.addEventListener("afterprint",()=>{document.body.removeChild(S),v.showSuccess("貼心提醒","查核紀錄表已成功匯出為PDF"),x(!1)}),setTimeout(()=>{x(!1)},5e3)}catch(L){console.error("列印過程發生錯誤:",L),v.showError("匯出失敗",L.message||"列印過程發生錯誤"),x(!1)}},100)},k=async()=>{try{K.value=!0;const S=b();p(S);const x=_(),L=f(),{schoolName:de,courseName:xe}=V();W(de,xe).forEach(He=>{const Xe=document.createElement("tr");Xe.style.border="1px solid #000";const qe=document.createElement("td");if(qe.textContent=He.label1,qe.style.border="1px solid #000",qe.style.padding="8px",qe.style.fontWeight="bold",qe.style.width="20%",qe.style.textAlign="center",Xe.appendChild(qe),He.colspan){const ze=document.createElement("td");ze.setAttribute("colspan","3"),ze.textContent=He.value1,ze.style.border="1px solid #000",ze.style.padding="8px",Xe.appendChild(ze)}else if(He.needCustom&&He.label1==="訪查時間(24 時制)"){const ze=document.createElement("td");ze.style.border="1px solid #000",ze.style.padding="8px";const Je=document.createElement("div");Je.style.display="flex",Je.style.flexDirection="column",Je.style.alignItems="center";const Ye=document.createElement("div");Ye.style.display="flex",Ye.style.alignItems="center",Ye.style.marginBottom="8px";const ut=document.createElement("div");ut.style.display="inline-block",ut.style.position="relative",ut.style.marginRight="5px";const Ht=document.createElement("span");Ht.textContent=E.value.year||"",Ht.style.display="inline-block",Ht.style.minWidth="30px",Ht.style.textAlign="center",ut.appendChild(Ht);const Tt=document.createElement("div");Tt.style.position="absolute",Tt.style.bottom="-2px",Tt.style.left="0",Tt.style.width="100%",Tt.style.height="1px",Tt.style.backgroundColor="#000",ut.appendChild(Tt),Ye.appendChild(ut),Ye.appendChild(document.createTextNode(" 年 "));const Wt=document.createElement("div");Wt.style.display="inline-block",Wt.style.position="relative",Wt.style.marginRight="5px";const Vt=document.createElement("span");Vt.textContent=E.value.month||"",Vt.style.display="inline-block",Vt.style.minWidth="25px",Vt.style.textAlign="center",Wt.appendChild(Vt);const xt=document.createElement("div");xt.style.position="absolute",xt.style.bottom="-2px",xt.style.left="0",xt.style.width="100%",xt.style.height="1px",xt.style.backgroundColor="#000",Wt.appendChild(xt),Ye.appendChild(Wt),Ye.appendChild(document.createTextNode(" 月 "));const vt=document.createElement("div");vt.style.display="inline-block",vt.style.position="relative";const wt=document.createElement("span");wt.textContent=E.value.day||"",wt.style.display="inline-block",wt.style.minWidth="25px",wt.style.textAlign="center",vt.appendChild(wt);const It=document.createElement("div");It.style.position="absolute",It.style.bottom="-2px",It.style.left="0",It.style.width="100%",It.style.height="1px",It.style.backgroundColor="#000",vt.appendChild(It),Ye.appendChild(vt),Ye.appendChild(document.createTextNode(" 日")),Je.appendChild(Ye);const ht=document.createElement("div");ht.style.display="flex",ht.style.alignItems="center";const Jt=document.createElement("div");Jt.style.display="inline-block",Jt.style.position="relative";const Rt=document.createElement("span");Rt.textContent=E.value.startHour||"",Rt.style.display="inline-block",Rt.style.minWidth="25px",Rt.style.textAlign="center",Jt.appendChild(Rt);const Ae=document.createElement("div");Ae.style.position="absolute",Ae.style.bottom="-2px",Ae.style.left="0",Ae.style.width="100%",Ae.style.height="1px",Ae.style.backgroundColor="#000",Jt.appendChild(Ae),ht.appendChild(Jt),ht.appendChild(document.createTextNode(" : "));const Re=document.createElement("div");Re.style.display="inline-block",Re.style.position="relative",Re.style.marginRight="10px";const Me=document.createElement("span");Me.textContent=E.value.startMinute||"",Me.style.display="inline-block",Me.style.minWidth="25px",Me.style.textAlign="center",Re.appendChild(Me);const Ke=document.createElement("div");Ke.style.position="absolute",Ke.style.bottom="-2px",Ke.style.left="0",Ke.style.width="100%",Ke.style.height="1px",Ke.style.backgroundColor="#000",Re.appendChild(Ke),ht.appendChild(Re),ht.appendChild(document.createTextNode(" ~ "));const at=document.createElement("div");at.style.display="inline-block",at.style.position="relative";const Ze=document.createElement("span");Ze.textContent=E.value.endHour||"",Ze.style.display="inline-block",Ze.style.minWidth="25px",Ze.style.textAlign="center",at.appendChild(Ze);const it=document.createElement("div");it.style.position="absolute",it.style.bottom="-2px",it.style.left="0",it.style.width="100%",it.style.height="1px",it.style.backgroundColor="#000",at.appendChild(it),ht.appendChild(at),ht.appendChild(document.createTextNode(" : "));const mt=document.createElement("div");mt.style.display="inline-block",mt.style.position="relative";const Pt=document.createElement("span");Pt.textContent=E.value.endMinute||"",Pt.style.display="inline-block",Pt.style.minWidth="25px",Pt.style.textAlign="center",mt.appendChild(Pt);const Ft=document.createElement("div");Ft.style.position="absolute",Ft.style.bottom="-2px",Ft.style.left="0",Ft.style.width="100%",Ft.style.height="1px",Ft.style.backgroundColor="#000",mt.appendChild(Ft),ht.appendChild(mt),Je.appendChild(ht),ze.appendChild(Je),Xe.appendChild(ze);const Ut=document.createElement("td");Ut.textContent=He.label2,Ut.style.border="1px solid #000",Ut.style.padding="8px",Ut.style.fontWeight="bold",Ut.style.width="20%",Ut.style.textAlign="center",Xe.appendChild(Ut);const jt=document.createElement("td");jt.style.border="1px solid #000",jt.style.padding="8px",jt.style.width="30%",Xe.appendChild(jt)}else{const ze=document.createElement("td");if(ze.textContent=He.value1,ze.style.border="1px solid #000",ze.style.padding="8px",ze.style.width="30%",Xe.appendChild(ze),He.label2){const Je=document.createElement("td");Je.textContent=He.label2,Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.fontWeight="bold",Je.style.width="20%",Je.style.textAlign="center",Xe.appendChild(Je);const Ye=document.createElement("td");Ye.textContent=He.value2,Ye.style.border="1px solid #000",Ye.style.padding="8px",Ye.style.width="30%",Xe.appendChild(Ye)}}L.appendChild(Xe)});const ke=document.createElement("tr");ke.style.border="1px solid #000";const De=document.createElement("td");De.setAttribute("colspan","4"),De.style.border="1px solid #000",De.style.padding="30px";const we=document.createElement("div");we.style.display="flex",we.style.justifyContent="space-between",we.style.width="100%",we.style.marginTop="10px",we.style.marginBottom="10px",we.className="signature-section",["承辦","科長","高級分析師","組長"].forEach(He=>{const Xe=document.createElement("div");Xe.style.fontSize="14px",Xe.style.flex="1",Xe.style.padding="10px 5px",Xe.style.display="flex",Xe.style.alignItems="center",Xe.className="signature-box";const qe=document.createElement("span");qe.textContent=He+"：",qe.style.marginRight="5px",Xe.appendChild(qe);const ze=document.createElement("span");ze.innerHTML="&nbsp;",ze.style.flexGrow="1",ze.style.borderBottom="1px solid #000",ze.style.marginLeft="5px",ze.style.marginRight="5px",ze.style.height="20px",Xe.appendChild(ze),we.appendChild(Xe)}),De.appendChild(we),ke.appendChild(De),L.appendChild(ke),x.appendChild(L),S.appendChild(x);const ae=document.createElement("div");ae.style.marginBottom="20px";const O=document.createElement("h3");O.textContent="二、查核內容",O.style.fontWeight="bold",O.style.marginBottom="10px",ae.appendChild(O);const A=document.createElement("table");A.style.width="100%",A.style.borderCollapse="collapse",A.style.border="1px solid #000";const J=document.createElement("thead"),Q=document.createElement("tr");Q.style.border="1px solid #000";const Y=["查核項目","查核結果","佐證資料或說明原因"],ue=["50%","30%","20%"];Y.forEach((He,Xe)=>{const qe=document.createElement("th");qe.textContent=He,qe.style.border="1px solid #000",qe.style.padding="8px",qe.style.textAlign="center",qe.style.backgroundColor="#f2f2f2",qe.style.width=ue[Xe],Q.appendChild(qe)}),J.appendChild(Q),A.appendChild(J);const pe=document.createElement("tbody");[{id:1,title:"1、課程師資實施狀況（實地40%/線上20%）"},{id:2,title:"2、人力安排情形（實地15%/線上30%）"},{id:3,title:"3、環境設備實施狀況（實地20%/線上30%）"},{id:4,title:"4、課程實施情形（實地25%/線上20%）"}].forEach(He=>{const Xe=document.createElement("tr");Xe.style.border="1px solid #000";const qe=document.createElement("td");qe.setAttribute("colspan","3"),qe.textContent=He.title,qe.style.border="1px solid #000",qe.style.padding="8px",qe.style.fontWeight="bold",Xe.appendChild(qe),pe.appendChild(Xe),r(He.id).forEach(Je=>{const Ye=document.createElement("tr");Ye.style.border="1px solid #000";const ut=document.createElement("td");ut.textContent=E.value.questions[Je],ut.style.border="1px solid #000",ut.style.padding="8px",ut.style.paddingLeft="25px",Ye.appendChild(ut);const Ht=document.createElement("td");Ht.style.border="1px solid #000",Ht.style.padding="8px";const Tt=document.createElement("table");Tt.style.width="100%",Tt.style.border="none",Tt.style.borderCollapse="collapse",Tt.style.margin="0 auto";const Wt=document.createElement("tr"),Vt=document.createElement("td");Vt.style.border="none",Vt.style.width="50%",Vt.style.textAlign="center",Vt.style.verticalAlign="middle";const xt=document.createElement("div");xt.style.display="inline-flex",xt.style.alignItems="center",xt.style.justifyContent="center";const vt=document.createElement("div");vt.style.width="16px",vt.style.height="16px",vt.style.border="2px solid #000",vt.style.marginRight="5px",vt.style.display="inline-block",E.value.checkResults[Je]===!0&&(vt.style.backgroundColor="#000",vt.style.color="#fff",vt.innerHTML="&#10003;",vt.style.lineHeight="15px",vt.style.textAlign="center",vt.style.fontWeight="bold"),xt.appendChild(vt),xt.appendChild(document.createTextNode("符合")),Vt.appendChild(xt),Wt.appendChild(Vt);const wt=document.createElement("td");wt.style.border="none",wt.style.width="50%",wt.style.textAlign="center",wt.style.verticalAlign="middle";const It=document.createElement("div");It.style.display="inline-flex",It.style.alignItems="center",It.style.justifyContent="center";const ht=document.createElement("div");ht.style.width="16px",ht.style.height="16px",ht.style.border="2px solid #000",ht.style.marginRight="5px",ht.style.display="inline-block",E.value.checkResults[Je]===!1&&(ht.style.backgroundColor="#000",ht.style.color="#fff",ht.innerHTML="&#10003;",ht.style.lineHeight="15px",ht.style.textAlign="center",ht.style.fontWeight="bold"),It.appendChild(ht),It.appendChild(document.createTextNode("不符合")),wt.appendChild(It),Wt.appendChild(wt),Tt.appendChild(Wt),Ht.appendChild(Tt),Ye.appendChild(Ht);const Jt=document.createElement("td");if(Je==="3-3"){const Rt=document.createElement("div");Rt.style.display="flex",Rt.style.alignItems="center";const Ae=document.createElement("div");Ae.style.width="16px",Ae.style.height="16px",Ae.style.border="2px solid #000",Ae.style.marginRight="5px",Ae.style.display="inline-block",E.value.isOffline&&(Ae.style.backgroundColor="#000",Ae.style.color="#fff",Ae.innerHTML="&#10003;",Ae.style.lineHeight="15px",Ae.style.textAlign="center",Ae.style.fontWeight="bold"),Rt.appendChild(Ae),Rt.appendChild(document.createTextNode("實體課程")),Jt.appendChild(Rt)}else if(Je==="4-5"){const Rt=document.createElement("div");Rt.style.display="flex",Rt.style.alignItems="center";const Ae=document.createElement("div");Ae.style.width="16px",Ae.style.height="16px",Ae.style.border="2px solid #000",Ae.style.marginRight="5px",Ae.style.display="inline-block",E.value.isOnline&&(Ae.style.backgroundColor="#000",Ae.style.color="#fff",Ae.innerHTML="&#10003;",Ae.style.lineHeight="15px",Ae.style.textAlign="center",Ae.style.fontWeight="bold"),Rt.appendChild(Ae),Rt.appendChild(document.createTextNode("線上課程")),Jt.appendChild(Rt)}else Jt.textContent=E.value.evidence[Je]||"";Jt.style.border="1px solid #000",Jt.style.padding="8px",Ye.appendChild(Jt),pe.appendChild(Ye)})});const ne=document.createElement("tr");ne.style.border="1px solid #000";const se=document.createElement("td");se.setAttribute("colspan","3");const re=document.createElement("div");re.style.marginBottom="5px",re.style.padding="8px",re.style.fontWeight="bold",re.style.display="flex",re.style.alignItems="center",re.style.flexWrap="wrap";const Te=document.createElement("span");Te.textContent="5、",re.appendChild(Te);const Be=document.createElement("span");Be.style.position="relative",Be.style.display="inline-block",Be.style.minWidth="25px",Be.style.textAlign="center",Be.style.margin="0 5px";const ve=document.createElement("span");ve.textContent=E.value.passCount!==null&&E.value.passCount!==void 0?E.value.passCount:"",Be.appendChild(ve);const ie=document.createElement("div");ie.style.position="absolute",ie.style.bottom="-2px",ie.style.left="0",ie.style.width="100%",ie.style.height="1px",ie.style.backgroundColor="#000",Be.appendChild(ie),re.appendChild(Be);const _e=document.createElement("span");_e.textContent=" 個項目符合、",re.appendChild(_e);const Le=document.createElement("span");Le.style.position="relative",Le.style.display="inline-block",Le.style.minWidth="25px",Le.style.textAlign="center",Le.style.margin="0 5px";const ge=document.createElement("span");ge.textContent=E.value.failCount!==null&&E.value.failCount!==void 0?E.value.failCount:"",Le.appendChild(ge);const q=document.createElement("div");q.style.position="absolute",q.style.bottom="-2px",q.style.left="0",q.style.width="100%",q.style.height="1px",q.style.backgroundColor="#000",Le.appendChild(q),re.appendChild(Le);const i=document.createElement("span");i.textContent=" 個項目不符合。",re.appendChild(i),se.appendChild(re);const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.padding="0 8px 8px 8px";const w=document.createElement("div");w.style.display="flex",w.style.alignItems="center";const ce=document.createElement("span");ce.textContent="得分：",ce.style.marginRight="5px",ce.style.fontWeight="bold",w.appendChild(ce);const he=document.createElement("div");he.style.display="inline-block",he.style.position="relative",he.style.minWidth="40px";const Ve=document.createElement("span");Ve.textContent=E.value.totalScore||"",Ve.style.display="inline-block",Ve.style.minWidth="40px",Ve.style.textAlign="center",he.appendChild(Ve);const Qe=document.createElement("div");Qe.style.position="absolute",Qe.style.bottom="-2px",Qe.style.left="0",Qe.style.width="100%",Qe.style.height="1px",Qe.style.backgroundColor="#000",he.appendChild(Qe),w.appendChild(he),n.appendChild(w);const et=document.createElement("div");et.style.display="flex",et.style.marginLeft="40px",et.style.alignItems="center";const Ct=document.createElement("div");Ct.style.display="flex",Ct.style.alignItems="center",Ct.style.marginRight="20px";const ct=document.createElement("div");ct.style.width="16px",ct.style.height="16px",ct.style.border="2px solid #000",ct.style.marginRight="5px",ct.style.display="inline-block",E.value.hasPass===!0&&(ct.style.backgroundColor="#000",ct.style.color="#fff",ct.innerHTML="&#10003;",ct.style.lineHeight="15px",ct.style.textAlign="center",ct.style.fontWeight="bold"),Ct.appendChild(ct),Ct.appendChild(document.createTextNode("通過"));const lt=document.createElement("div");lt.style.display="flex",lt.style.alignItems="center";const dt=document.createElement("div");dt.style.width="16px",dt.style.height="16px",dt.style.border="2px solid #000",dt.style.marginRight="5px",dt.style.display="inline-block",E.value.hasPass===!1&&(dt.style.backgroundColor="#000",dt.style.color="#fff",dt.innerHTML="&#10003;",dt.style.lineHeight="15px",dt.style.textAlign="center",dt.style.fontWeight="bold"),lt.appendChild(dt),lt.appendChild(document.createTextNode("不通過")),et.appendChild(Ct),et.appendChild(lt),n.appendChild(et),se.appendChild(n),ne.appendChild(se),pe.appendChild(ne),A.appendChild(pe),ae.appendChild(A),S.appendChild(ae);const At=document.createElement("div");At.textContent="備註：說明原因應清楚描述，避免不確定的文字：如可能...。",At.style.padding="2px 0px",At.style.color="black",At.style.fontSize="16px",At.style.lineHeight="1",At.style.fontFamily="Arial, sans-serif",S.appendChild(At);const Et=document.createElement("table");Et.style.width="100%",Et.style.border="none",Et.style.borderCollapse="collapse",Et.style.margin="0",Et.style.padding="0";const ds=document.createElement("tr"),_t=document.createElement("td");_t.style.height="0px",_t.style.border="none",_t.innerHTML="&nbsp;",ds.appendChild(_t),Et.appendChild(ds),S.appendChild(Et);const ts=document.createElement("div");ts.style.marginBottom="10px";const qt=document.createElement("table");qt.style.width="100%",qt.style.borderCollapse="collapse",qt.style.border="1px solid #000";const Qt=document.createElement("tr");Qt.style.border="1px solid #000";const kt=document.createElement("td");kt.setAttribute("colspan","2"),kt.textContent="6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。",kt.style.border="1px solid #000",kt.style.padding="8px",kt.style.fontWeight="bold",kt.style.fontSize="15px",kt.style.lineHeight="1.5",Qt.appendChild(kt),qt.appendChild(Qt);const Kt=document.createElement("tr");Kt.style.border="1px solid #000";const Bt=document.createElement("td");Bt.textContent=`改善方法
(學校承辦人員)`,Bt.style.border="1px solid #000",Bt.style.padding="8px",Bt.style.width="25%",Bt.style.textAlign="center",Bt.style.verticalAlign="middle",Kt.appendChild(Bt);const B=document.createElement("td");B.textContent=E.value.improvement||"",B.style.border="1px solid #000",B.style.padding="8px",B.style.width="75%",B.style.minHeight="200px",B.style.height="200px",Kt.appendChild(B),qt.appendChild(Kt),ts.appendChild(qt),S.appendChild(ts);const I=document.createElement("div");I.style.marginTop="20px";const F=document.createElement("div");F.style.display="flex",F.style.alignItems="center",F.style.marginBottom="10px";const oe=document.createElement("h3");oe.textContent="三、追蹤調查",oe.style.fontWeight="bold",oe.style.margin="0",oe.style.padding="0",oe.style.marginRight="20px",F.appendChild(oe);const Ie=document.createElement("div");Ie.style.display="flex",Ie.style.alignItems="center",Ie.style.marginRight="20px";const Ne=document.createElement("div");Ne.style.width="16px",Ne.style.height="16px",Ne.style.border="2px solid #000",Ne.style.marginRight="5px",Ne.style.display="inline-block",E.value.needFollowUp===!1&&(Ne.style.backgroundColor="#000",Ne.style.color="#fff",Ne.innerHTML="&#10003;",Ne.style.lineHeight="15px",Ne.style.textAlign="center",Ne.style.fontWeight="bold"),Ie.appendChild(Ne),Ie.appendChild(document.createTextNode("不須追蹤")),F.appendChild(Ie);const Oe=document.createElement("div");Oe.style.display="flex",Oe.style.alignItems="center";const tt=document.createElement("div");if(tt.style.width="16px",tt.style.height="16px",tt.style.border="2px solid #000",tt.style.marginRight="5px",tt.style.display="inline-block",E.value.needFollowUp===!0&&(tt.style.backgroundColor="#000",tt.style.color="#fff",tt.innerHTML="&#10003;",tt.style.lineHeight="15px",tt.style.textAlign="center",tt.style.fontWeight="bold"),Oe.appendChild(tt),Oe.appendChild(document.createTextNode("需複查：")),E.value.needFollowUp===!0&&E.value.recheckRemark){Oe.style.display="flex",Oe.style.flexWrap="wrap",Oe.style.alignItems="center";const He=document.createElement("span");He.textContent=E.value.recheckRemark,He.style.marginLeft="5px",He.style.borderBottom="1px solid #000",He.style.display="inline-block",He.style.maxWidth="150px",He.style.wordBreak="break-all",He.style.whiteSpace="normal",Oe.appendChild(He)}else{Oe.style.display="flex",Oe.style.flexWrap="wrap",Oe.style.alignItems="center";const He=document.createElement("span");He.textContent="          ",He.style.marginLeft="5px",He.style.borderBottom="1px solid #000",He.style.display="inline-block",He.style.maxWidth="150px",Oe.appendChild(He)}F.appendChild(Oe),I.appendChild(F);const st=document.createElement("div");st.style.marginTop="10px";const Nt=document.createElement("p");Nt.textContent="備註：考量改善方法實施完成的時間點，後續計畫做以下安排。",st.appendChild(Nt);const Dt=document.createElement("p");Dt.textContent="1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。",st.appendChild(Dt);const yt=document.createElement("p");yt.textContent="2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。",st.appendChild(yt),I.appendChild(st),S.appendChild(I),S.style.position="absolute",S.style.left="-9999px",document.body.appendChild(S),setTimeout(()=>{if(L.rows&&L.rows.length>=3&&L.rows[2].cells.length>=4){const He=L.rows[2].cells[3];He.innerHTML="";const Xe=document.createElement("div");Xe.style.display="flex",Xe.style.flexDirection="column";const qe=document.createElement("div");qe.style.display="flex",qe.style.alignItems="center",qe.style.marginBottom="5px";const ze=document.createElement("div");ze.style.width="16px",ze.style.height="16px",ze.style.border="2px solid #000",ze.style.marginRight="5px",ze.style.display="inline-block",E.value.inspectionType==="onsite"&&(ze.style.backgroundColor="#000",ze.style.color="#fff",ze.innerHTML="&#10003;",ze.style.lineHeight="15px",ze.style.textAlign="center",ze.style.fontWeight="bold"),qe.appendChild(ze),qe.appendChild(document.createTextNode("實地訪查"));const Je=document.createElement("div");Je.style.display="flex",Je.style.alignItems="center";const Ye=document.createElement("div");if(Ye.style.width="16px",Ye.style.height="16px",Ye.style.border="2px solid #000",Ye.style.marginRight="5px",Ye.style.display="inline-block",E.value.inspectionType==="online"&&(Ye.style.backgroundColor="#000",Ye.style.color="#fff",Ye.innerHTML="&#10003;",Ye.style.lineHeight="15px",Ye.style.textAlign="center",Ye.style.fontWeight="bold"),Je.appendChild(Ye),Je.appendChild(document.createTextNode("線上訪查：")),E.value.inspectionType==="online"&&E.value.onlineRemark){Je.style.display="flex",Je.style.flexWrap="wrap",Je.style.alignItems="center";const ut=document.createElement("span");ut.textContent=E.value.onlineRemark,ut.style.marginLeft="5px",ut.style.borderBottom="1px solid #000",ut.style.display="inline-block",ut.style.maxWidth="150px",ut.style.wordBreak="break-all",ut.style.whiteSpace="normal",Je.appendChild(ut)}else{Je.style.display="flex",Je.style.flexWrap="wrap",Je.style.alignItems="center";const ut=document.createElement("span");ut.textContent="          ",ut.style.marginLeft="5px",ut.style.borderBottom="1px solid #000",ut.style.display="inline-block",ut.style.maxWidth="150px",Je.appendChild(ut)}Xe.appendChild(qe),Xe.appendChild(Je),He.appendChild(Xe)}H(S,He=>{K.value=He})},100)}catch(S){console.error("匯出查核紀錄表失敗:",S),v.showError("匯出失敗",S.message||"匯出查核紀錄表失敗，請稍後再試"),K.value=!1;const x=document.querySelector('div[style*="-9999px"]');x&&x.parentNode&&x.parentNode.removeChild(x)}};Ee(()=>E.value.needFollowUp,S=>{S===!1&&(E.value.recheckRemark="")}),Ee(()=>E.value.checkResults,S=>{D()},{deep:!0}),Ee(()=>E.value.inspectionType,(S,x)=>{D(),S==="onsite"?(E.value.isOffline=!0,E.value.isOnline=!1):S==="online"?(E.value.isOnline=!0,E.value.isOffline=!1):(S===""||S===null)&&(E.value.isOffline=!1,E.value.isOnline=!1)}),Ee(()=>E.value.isOffline,S=>{S===!0?(E.value.inspectionType="onsite",E.value.isOnline=!1):S===!1&&E.value.inspectionType==="onsite"&&(E.value.inspectionType="")}),Ee(()=>E.value.isOnline,S=>{S===!0?(E.value.inspectionType="online",E.value.isOffline=!1):S===!1&&E.value.inspectionType==="online"&&(E.value.inspectionType="")});const D=()=>{let S=0,x=0,L=0;const de=E.value.inspectionType==="onsite"?"3-3":"4-5",xe={1:{onsite:40,online:20},2:{onsite:15,online:30},3:{onsite:20,online:30},4:{onsite:25,online:20}};for(const fe of[1,2,3,4]){const De=r(fe).filter(J=>J!==de),we=De.length;if(we===0)continue;const ae=xe[fe][E.value.inspectionType==="onsite"?"onsite":"online"]/we;let O=0;for(const J of De)E.value.checkResults[J]===!0?(S++,O++):E.value.checkResults[J]===!1&&x++;const A=O*ae;L+=A}E.value.passCount=S,E.value.failCount=x,E.value.totalScore=Math.round(L),L>=70?E.value.hasPass=!0:L<70&&(S>0||x>0)&&(E.value.hasPass=!1)},j=(S,x)=>{E.value.checkResults[S]===x?E.value.checkResults[S]=null:E.value.checkResults[S]=x,D()};return(S,x)=>(t(),s("div",gh,[e("div",xh,[Ge(ft,{breadcrumbs:[{name:"訪視督課",path:"/supervision"},{name:"新增查核紀錄表",path:"/checklist"}]})]),x[68]||(x[68]=e("div",{class:"w-full max-w-[1500px] flex justify-center mt-6 mb-2"},[e("h1",{class:"text-2xl font-bold text-center"},"教學查核紀錄表")],-1)),e("div",hh,[e("div",wh,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:k,disabled:K.value},l(K.value?"匯出中...":"匯出 PDF"),9,_h),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:U}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:$,disabled:N.value},l(N.value?"儲存中...":"儲存"),9,kh)])]),x[69]||(x[69]=e("div",{class:"w-full max-w-[1500px] mb-2"},[e("h2",{class:"text-lg font-bold"},"一、訪查學校、時間及參與人員")],-1)),e("div",$h,[e("div",null,[e("table",Ch,[e("thead",null,[e("tr",null,[x[26]||(x[26]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 訪查學校 ",-1)),e("td",Eh,[P(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":x[0]||(x[0]=L=>E.value.school=L),disabled:C.value},[e("option",Dh,l(C.value?"載入中...":"請選擇學校"),1),(t(!0),s(X,null,le(d.value,L=>(t(),s("option",{key:L.value,value:L.value},l(L.label),9,Mh))),128))],8,Sh),[[Pe,E.value.school]])]),x[27]||(x[27]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 課程名稱 ",-1)),e("td",Ah,[P(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":x[1]||(x[1]=L=>E.value.courseName=L),disabled:!E.value.school||o.value},[e("option",Rh,l(E.value.school?o.value?"載入中...":"請選擇課程":"請先選擇學校"),1),(t(!0),s(X,null,le(u.value,L=>(t(),s("option",{key:L.value,value:L.value},l(L.label),9,Ph))),128))],8,Ih),[[Pe,E.value.courseName]])])])]),e("tbody",null,[e("tr",null,[x[28]||(x[28]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 授課時間 ",-1)),e("td",Uh,[P(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":x[2]||(x[2]=L=>E.value.courseDate=L),placeholder:"尚未選擇課程",disabled:""},null,512),[[te,E.value.courseDate]])])]),e("tr",null,[x[37]||(x[37]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"},[me(" 訪查時間"),e("br"),me("(24 時制) ")],-1)),e("td",Nh,[e("div",Th,[e("div",Vh,[P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[3]||(x[3]=L=>E.value.year=L)},null,512),[[te,E.value.year]]),x[29]||(x[29]=e("span",{class:"mx-1"},"年",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[4]||(x[4]=L=>E.value.month=L)},null,512),[[te,E.value.month]]),x[30]||(x[30]=e("span",{class:"mx-1"},"月",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[5]||(x[5]=L=>E.value.day=L)},null,512),[[te,E.value.day]]),x[31]||(x[31]=e("span",{class:"mx-1"},"日",-1))]),e("div",jh,[P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[6]||(x[6]=L=>E.value.startHour=L)},null,512),[[te,E.value.startHour]]),x[32]||(x[32]=e("span",{class:"mx-1"},":",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[7]||(x[7]=L=>E.value.startMinute=L)},null,512),[[te,E.value.startMinute]]),x[33]||(x[33]=e("span",{class:"mx-2"},"~",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[8]||(x[8]=L=>E.value.endHour=L)},null,512),[[te,E.value.endHour]]),x[34]||(x[34]=e("span",{class:"mx-1"},":",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":x[9]||(x[9]=L=>E.value.endMinute=L)},null,512),[[te,E.value.endMinute]])])])]),x[38]||(x[38]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查方式 ",-1)),e("td",Lh,[e("div",Fh,[e("div",Oh,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:E.value.inspectionType==="onsite",onChange:x[10]||(x[10]=L=>E.value.inspectionType=E.value.inspectionType==="onsite"?"":"onsite")},null,40,qh),x[35]||(x[35]=e("span",null,"實地訪查",-1))]),e("div",Bh,[e("div",Hh,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:E.value.inspectionType==="online",onChange:x[11]||(x[11]=L=>E.value.inspectionType=E.value.inspectionType==="online"?"":"online")},null,40,Wh),x[36]||(x[36]=e("span",null,"線上訪查：",-1))]),e("div",zh,[P(e("input",{type:"text",class:"border-b border-black p-1 w-full","onUpdate:modelValue":x[12]||(x[12]=L=>E.value.onlineRemark=L),placeholder:"請輸入...",style:{"max-width":"150px","word-break":"break-all","white-space":"normal","vertical-align":"bottom"}},null,512),[[te,E.value.onlineRemark]])])])])])]),e("tr",null,[x[39]||(x[39]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 聯絡人 ",-1)),e("td",Kh,[P(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":x[13]||(x[13]=L=>E.value.interviewee=L),placeholder:"請輸入聯絡人姓名..."},null,512),[[te,E.value.interviewee]])]),x[40]||(x[40]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查人員 ",-1)),e("td",Jh,[P(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":x[14]||(x[14]=L=>E.value.inspectors=L),placeholder:"請輸入訪查人員姓名..."},null,512),[[te,E.value.inspectors]])])])])])])]),x[70]||(x[70]=e("div",{class:"w-full max-w-[1500px] mt-6 mb-2"},[e("h2",{class:"text-lg font-bold"},"二、查核內容")],-1)),e("div",Yh,[e("table",Gh,[x[61]||(x[61]=e("thead",null,[e("tr",null,[e("th",{class:"border-r border-b-2 border-black p-4 w-[55%] font-bold text-center"},"查核項目"),e("th",{class:"border-r border-b-2 border-black p-4 w-[25%] font-bold text-center"},"查核結果"),e("th",{class:"border-b-2 border-black p-4 w-[20%] font-bold text-center"},[me("佐證資料或"),e("br"),me("說明原因")])])],-1)),e("tbody",null,[x[51]||(x[51]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"1、課程師資實施狀況（實地40%/線上20%）")])])],-1)),(t(!0),s(X,null,le(r(1),L=>(t(),s("tr",{key:L,class:"border-b-2 border-black"},[e("td",Zh,[e("div",Qh,[e("span",null,l(E.value.questions[L]),1)])]),e("td",Xh,[e("div",ew,[e("div",tw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!0,onChange:de=>j(L,!0)},null,40,sw),x[41]||(x[41]=e("span",null,"符合",-1))]),e("div",aw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!1,onChange:de=>j(L,!1)},null,40,ow),x[42]||(x[42]=e("span",null,"不符合",-1))])])]),e("td",lw,[P(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":de=>E.value.evidence[L]=de,placeholder:"請輸入佐證資料..."},null,8,nw),[[te,E.value.evidence[L]]])])]))),128)),x[52]||(x[52]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"2、人力安排情形（實地15%/線上30%）")])])],-1)),(t(!0),s(X,null,le(r(2),L=>(t(),s("tr",{key:L,class:"border-b-2 border-black"},[e("td",rw,[e("div",iw,[e("span",null,l(E.value.questions[L]),1)])]),e("td",dw,[e("div",uw,[e("div",cw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!0,onChange:de=>j(L,!0)},null,40,pw),x[43]||(x[43]=e("span",null,"符合",-1))]),e("div",vw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!1,onChange:de=>j(L,!1)},null,40,mw),x[44]||(x[44]=e("span",null,"不符合",-1))])])]),e("td",bw,[P(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":de=>E.value.evidence[L]=de,placeholder:"請輸入佐證資料..."},null,8,fw),[[te,E.value.evidence[L]]])])]))),128)),x[53]||(x[53]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"3、環境設備實施狀況（實地20%/線上30%）")])])],-1)),(t(!0),s(X,null,le(r(3),L=>(t(),s("tr",{key:L,class:"border-b-2 border-black"},[e("td",yw,[e("div",gw,[e("span",null,l(E.value.questions[L]),1)])]),e("td",xw,[e("div",hw,[e("div",ww,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!0,onChange:de=>j(L,!0)},null,40,_w),x[45]||(x[45]=e("span",null,"符合",-1))]),e("div",kw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!1,onChange:de=>j(L,!1)},null,40,$w),x[46]||(x[46]=e("span",null,"不符合",-1))])])]),e("td",Cw,[L==="3-3"?(t(),s("div",Ew,[P(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":x[15]||(x[15]=de=>E.value.isOffline=de),id:"isOffline"},null,512),[[Ce,E.value.isOffline]]),x[47]||(x[47]=e("label",{for:"isOffline",class:"cursor-pointer"},"實體課程",-1))])):P((t(),s("textarea",{key:1,class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":de=>E.value.evidence[L]=de,placeholder:"請輸入佐證資料..."},null,8,Sw)),[[te,E.value.evidence[L]]])])]))),128)),x[54]||(x[54]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"4、課程實施情形（實地25%/線上20%）")])])],-1)),(t(!0),s(X,null,le(r(4),L=>(t(),s("tr",{key:L,class:"border-b-2 border-black"},[e("td",Dw,[e("div",Mw,[e("span",null,l(E.value.questions[L]),1)])]),e("td",Aw,[e("div",Iw,[e("div",Rw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!0,onChange:de=>j(L,!0)},null,40,Pw),x[48]||(x[48]=e("span",null,"符合",-1))]),e("div",Uw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.checkResults[L]===!1,onChange:de=>j(L,!1)},null,40,Nw),x[49]||(x[49]=e("span",null,"不符合",-1))])])]),e("td",Tw,[L==="4-5"?(t(),s("div",Vw,[P(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":x[16]||(x[16]=de=>E.value.isOnline=de),id:"isOnline"},null,512),[[Ce,E.value.isOnline]]),x[50]||(x[50]=e("label",{for:"isOnline",class:"cursor-pointer"},"線上課程",-1))])):P((t(),s("textarea",{key:1,class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":de=>E.value.evidence[L]=de,placeholder:"請輸入佐證資料..."},null,8,jw)),[[te,E.value.evidence[L]]])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Lw,[x[60]||(x[60]=e("div",{class:"flex items-center font-bold"},"5、查核結果摘要：",-1)),e("div",Fw,[P(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":x[17]||(x[17]=L=>E.value.passCount=L)},null,512),[[te,E.value.passCount]]),x[55]||(x[55]=e("span",{class:"mr-2"},"個項目符合、",-1)),P(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":x[18]||(x[18]=L=>E.value.failCount=L)},null,512),[[te,E.value.failCount]]),x[56]||(x[56]=e("span",null,"個項目不符合。",-1))]),e("div",Ow,[x[59]||(x[59]=e("span",{class:"font-bold mr-2"},"得分：",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center mr-6","onUpdate:modelValue":x[19]||(x[19]=L=>E.value.totalScore=L)},null,512),[[te,E.value.totalScore]]),e("div",qw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.hasPass===!0,onChange:x[20]||(x[20]=L=>E.value.hasPass=E.value.hasPass===!0?null:!0)},null,40,Bw),x[57]||(x[57]=e("span",null,"通過",-1))]),e("div",Hw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.hasPass===!1,onChange:x[21]||(x[21]=L=>E.value.hasPass=E.value.hasPass===!1?null:!1)},null,40,Ww),x[58]||(x[58]=e("span",null,"不通過",-1))])])])])])])]),x[71]||(x[71]=e("div",{class:"w-full max-w-[1500px] mt-6"},[e("p",{class:"text-gray-700 mb-2"},"備註：說明原因應清楚描述，避免不確定的文字：如可能...。")],-1)),e("div",zw,[e("table",Kw,[x[63]||(x[63]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"border-b-2 border-black p-4 text-left font-bold",colspan:"2"}," 6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。 ")])],-1)),e("tbody",null,[e("tr",null,[x[62]||(x[62]=e("th",{scope:"row",class:"border-r-2 border-black p-4 w-1/4"},[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"text-center font-bold"},"改善方法"),e("div",{class:"text-center"},"(學校承辦人員)")])],-1)),e("td",Jw,[P(e("textarea",{class:"w-full h-64 border border-gray-300 p-2 outline-none resize-none","onUpdate:modelValue":x[22]||(x[22]=L=>E.value.improvement=L),placeholder:"請輸入改善方法..."},null,512),[[te,E.value.improvement]])])])])])]),e("div",Yw,[e("div",Gw,[x[66]||(x[66]=e("span",{class:"font-bold mr-2"},"三、追蹤調查",-1)),e("div",Zw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.needFollowUp===!1,onChange:x[23]||(x[23]=L=>E.value.needFollowUp=E.value.needFollowUp===!1?null:!1),id:"needFollowUp"},null,40,Qw),x[64]||(x[64]=e("label",{for:"needFollowUp",class:"cursor-pointer"},"不須追蹤",-1))]),e("div",Xw,[e("div",e_,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:E.value.needFollowUp===!0,onChange:x[24]||(x[24]=L=>E.value.needFollowUp=E.value.needFollowUp===!0?null:!0),id:"needRecheck"},null,40,t_),x[65]||(x[65]=e("label",{for:"needRecheck",class:"cursor-pointer"},"需複查：",-1))]),P(e("input",{type:"text",class:"border-b border-black ml-2 p-1","onUpdate:modelValue":x[25]||(x[25]=L=>E.value.recheckRemark=L),placeholder:"請輸入複查備註...",style:{"min-width":"120px","max-width":"150px",flex:"1","word-break":"break-all","white-space":"normal"},disabled:E.value.needFollowUp!==!0},null,8,s_),[[te,E.value.recheckRemark]])])]),x[67]||(x[67]=e("div",{class:"mt-2"},[e("p",null,"備註：考量改善方法實施完成的時間點，後續計畫做以下安排。"),e("p",{class:"mt-2"},"1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。"),e("p",{class:"mt-2"},"2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。")],-1))])]))}},o_=Fe(a_,[["__scopeId","data-v-831aa31a"]]),l_={class:"flex flex-col items-center p-6"},n_={class:"w-full max-w-[1500px]"},r_={class:"w-full max-w-[1500px] flex justify-end mb-2"},i_={class:"space-x-4"},d_=["disabled"],u_=["disabled"],c_={class:"w-full max-w-[1500px] border-2 border-black"},p_={class:"w-full border-collapse"},v_={class:"border-r border-black p-4 w-1/4"},m_=["disabled"],b_={value:""},f_=["value"],y_={class:"p-4 w-1/4"},g_=["disabled"],x_={value:""},h_=["value"],w_={class:"border-t-2 border-black p-4",colspan:"3"},__={class:"w-full p-2 bg-gray-100 rounded border border-gray-300"},k_={class:"border-r border-t-2 border-black p-4",colspan:"1"},$_={class:"flex flex-col items-center"},C_={class:"flex items-center mb-3"},E_=["readonly"],S_=["readonly"],D_=["readonly"],M_={class:"flex items-center"},A_=["readonly"],I_=["readonly"],R_=["readonly"],P_=["readonly"],U_={class:"border-t-2 border-black p-4"},N_={class:"flex flex-col items-start"},T_={class:"flex items-center mb-2"},V_=["checked","disabled"],j_={class:"flex items-center flex-wrap"},L_={class:"flex items-center mr-2"},F_=["checked","disabled"],O_={class:"flex-1 min-w-[120px]"},q_=["readonly"],B_={class:"border-t-2 border-r border-black p-4",colspan:"1"},H_=["readonly"],W_={class:"border-t-2 border-black p-4",colspan:"1"},z_=["readonly"],K_={class:"w-full max-w-[1500px] border-2 border-black"},J_={class:"w-full border-collapse"},Y_={class:"border-r border-black p-4 pl-8"},G_={class:"flex items-center"},Z_={class:"border-r border-black p-4"},Q_={class:"flex justify-around"},X_={class:"flex items-center"},ek=["checked","onChange","disabled"],tk={class:"flex items-center"},sk=["checked","onChange","disabled"],ak={class:"border-black p-4"},ok=["onUpdate:modelValue","readonly"],lk={class:"border-r border-black p-4 pl-8"},nk={class:"flex items-center"},rk={class:"border-r border-black p-4"},ik={class:"flex justify-around"},dk={class:"flex items-center"},uk=["checked","onChange","disabled"],ck={class:"flex items-center"},pk=["checked","onChange","disabled"],vk={class:"border-black p-4"},mk=["onUpdate:modelValue","readonly"],bk={class:"border-r border-black p-4 pl-8"},fk={class:"flex items-center"},yk={class:"border-r border-black p-4"},gk={class:"flex justify-around"},xk={class:"flex items-center"},hk=["checked","onChange","disabled"],wk={class:"flex items-center"},_k=["checked","onChange","disabled"],kk={class:"border-black p-4"},$k={key:0,class:"flex items-center"},Ck=["disabled"],Ek=["onUpdate:modelValue","readonly"],Sk={class:"border-r border-black p-4 pl-8"},Dk={class:"flex items-center"},Mk={class:"border-r border-black p-4"},Ak={class:"flex justify-around"},Ik={class:"flex items-center"},Rk=["checked","onChange","disabled"],Pk={class:"flex items-center"},Uk=["checked","onChange","disabled"],Nk={class:"border-black p-4"},Tk={key:0,class:"flex items-center"},Vk=["disabled"],jk=["onUpdate:modelValue","readonly"],Lk={class:"border-t-2 border-black p-4",colspan:"3"},Fk={class:"flex items-center mt-2"},Ok={class:"flex items-center mt-4"},qk={class:"flex items-center mr-6"},Bk=["checked","disabled"],Hk={class:"flex items-center"},Wk=["checked","disabled"],zk={class:"w-full max-w-[1500px] border-2 border-black mt-6"},Kk={class:"w-full border-collapse"},Jk={class:"p-4 w-3/4"},Yk=["readonly"],Gk={class:"w-full max-w-[1500px] mt-6"},Zk={class:"flex flex-wrap items-center"},Qk={class:"flex items-center ml-4"},Xk=["checked","disabled"],e4={class:"flex items-center flex-wrap ml-6"},t4={class:"flex items-center mr-2"},s4=["checked","disabled"],a4=["readonly"],o4={__name:"ChecklistEdit",setup(M){const h=rt(),d=We(),u=m([]),C=m([]),o=m(!1),N=m(!1),K=m(!1),E=m(!1),U=m(h.query.id),T=m(!1),z=m({}),g=m(!1),a=m({school:"",courseName:"",courseDate:"",interviewee:"",year:"",month:"",day:"",startHour:"",startMinute:"",endHour:"",endMinute:"",inspectionType:"",inspectors:"",onlineRemark:"",passCount:0,failCount:0,totalScore:0,checkResults:{"1-1":null,"1-2":null,"2-1":null,"2-2":null,"2-3":null,"3-1":null,"3-2":null,"3-3":null,"4-1":null,"4-2":null,"4-3":null,"4-4":null,"4-5":null},evidence:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""},questions:{"1-1":"(1) 授課師資與計畫相符","1-2":"(2) 課程內容依課程表授課","2-1":"(1) 陪課人員協助課堂服務","2-2":"(2) 製作教學日誌","2-3":"(3) 進行問卷調查","3-1":"(1) 場地符合授課需求","3-2":"(2) 有相應軟硬體設備進行授課，確保授課內容清楚傳達於學員。","3-3":"(3) 有提供穩定的網路連線功能進行授課，且提供穩定音訊、麥克風、即時訊息功能服務。(限查核線上課程)","4-1":"(1) 學員依規定簽到退","4-2":"(2) 備註遲到、請假及曠課人員","4-3":"(3) 提供授課課程教材","4-4":"(4) 確實填寫教學日誌","4-5":"(5) 投保公共意外責任險(限查核實體課程)"},isOnline:null,isOffline:null,hasPass:null,improvement:"",needFollowUp:null,recheckRemark:"",percentages:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""}}),R=Q=>{a.value.school=Q.school.toString(),a.value.courseName=Q.course.toString(),a.value.inspectors=Q.visitor,a.value.interviewee=Q.interviewee||"",a.value.onlineRemark=Q.onlineRemark||"",Q.schoolName&&(a.value.schoolName=Q.schoolName),Q.courseName&&(a.value.courseNameText=Q.courseName),a.value.courseDate=Q.date||"",console.log("設置課程日期:",a.value.courseDate)},Z=Q=>{Q.needFollowUp===!1?a.value.needFollowUp=!1:Q.needFollowUp===!0?a.value.needFollowUp=!0:a.value.needFollowUp=null,a.value.recheckRemark=Q.recheckRemark||"",a.value.passCount=Q.totalMatchedItems||0,a.value.failCount=Q.totalUnmatchedItems||0,a.value.inspectionType=Q.visitMethod===1?"online":"onsite",a.value.totalScore=Q.grade||0,a.value.hasPass=Q.isPass!==void 0?Q.isPass:null,a.value.improvement=Q.improveRemark||""},$=Q=>{if(Q.visitDate){const Y=Q.visitDate.split("/");Y.length===3&&(a.value.year=Y[0],a.value.month=Y[1],a.value.day=Y[2])}if(Q.visitStartTime){const Y=Q.visitStartTime.split(":");Y.length===2&&(a.value.startHour=Y[0],a.value.startMinute=Y[1])}if(Q.visitEndTime){const Y=Q.visitEndTime.split(":");Y.length===2&&(a.value.endHour=Y[0],a.value.endMinute=Y[1])}},c=(Q,Y)=>{const ue=Y.question.match(/^\((\d+)\)/);if(!ue||!ue[1])return;const pe=ue[1],ye=`${Q}-${pe}`;Y.score!==void 0&&(a.value.percentages[ye]=Y.score),Y.ans!==void 0&&(a.value.checkResults[ye]=Y.ans),Y.remark!==void 0&&(ye==="4-5"&&Y.remark==="線上課程"?a.value.isOnline=!0:ye==="3-3"&&Y.remark==="實體課程"?a.value.isOffline=!0:a.value.evidence[ye]=Y.remark),Y.question&&(a.value.questions[ye]=Y.question)},y=Q=>{!Q.content||!Array.isArray(Q.content)||Q.content.forEach(Y=>{if(!Y.details||!Array.isArray(Y.details))return;const ue=Y.categoryId.toString();Y.details.forEach(pe=>{c(ue,pe)})})},r=async()=>{var Q;if(!U.value){T.value=!0;return}try{E.value=!0;const Y=await Rs.getVisitHistoryById(U.value);if(Y.data&&Y.data.code===0){const ue=Y.data.data;R(ue),Z(ue),$(ue),y(ue),z.value=JSON.parse(JSON.stringify(a.value))}else v.showError("載入失敗",((Q=Y.data)==null?void 0:Q.message)||"無法獲取訪視記錄")}catch(Y){console.error("獲取訪視記錄錯誤:",Y),v.showError("載入失敗","獲取訪視記錄時發生錯誤")}finally{E.value=!1}},b=()=>{const Q={school:parseInt(a.value.school),course:parseInt(a.value.courseName),visitor:a.value.inspectors,visitDate:`${a.value.year}/${String(a.value.month).padStart(2,"0")}/${String(a.value.day).padStart(2,"0")}`,visitStartTime:`${String(a.value.startHour).padStart(2,"0")}:${String(a.value.startMinute).padStart(2,"0")}`,visitEndTime:`${String(a.value.endHour).padStart(2,"0")}:${String(a.value.endMinute).padStart(2,"0")}`,visitMethod:a.value.inspectionType==="online"?1:2,grade:a.value.totalScore?parseInt(a.value.totalScore):null,improveRemark:a.value.improvement||null,interviewee:a.value.interviewee||null,onlineRemark:a.value.inspectionType==="online"&&a.value.onlineRemark||null,needFollowUp:a.value.needFollowUp,recheckRemark:a.value.needFollowUp===!0&&a.value.recheckRemark||null,totalMatchedItems:a.value.passCount?parseInt(a.value.passCount):null,totalUnmatchedItems:a.value.failCount?parseInt(a.value.failCount):null,isOnline:a.value.isOnline||null,isOffline:a.value.isOffline||null,isPass:a.value.hasPass,content:[]};return[{id:1,name:"課程師資實施狀況"},{id:2,name:"人力安排情形"},{id:3,name:"環境設備實施狀況"},{id:4,name:"課程實施情形"}].forEach(Y=>{const ue=L(Y.id);ue.length>0&&Q.content.push({categoryId:Y.id,categoryName:Y.name,details:ue.map(pe=>{let ye=null;return pe==="4-5"&&a.value.isOnline?ye="線上課程":pe==="3-3"&&a.value.isOffline?ye="實體課程":ye=a.value.evidence[pe]||null,{question:a.value.questions[pe],score:a.value.percentages[pe]?parseInt(a.value.percentages[pe]):null,ans:a.value.checkResults[pe]===null?null:a.value.checkResults[pe]===!0,remark:ye}})})}),U.value&&(Q.id=parseInt(U.value)),Q},p=()=>a.value.school?a.value.courseName?a.value.inspectionType?a.value.inspectionType==="online"&&!a.value.onlineRemark?(v.showError("儲存失敗","請填寫線上訪查備註"),!1):!0:(v.showError("儲存失敗","請選擇訪查方式"),!1):(v.showError("儲存失敗","請選擇課程名稱"),!1):(v.showError("儲存失敗","請選擇訪查學校"),!1),_=()=>{const Q=/^[\u4e00-\u9fa5a-zA-Z\s]+$/;return a.value.inspectors?Q.test(a.value.inspectors)?a.value.interviewee?Q.test(a.value.interviewee)?!0:(v.showError("儲存失敗","聯絡人只能填寫中文和英文"),!1):(v.showError("儲存失敗","請輸入聯絡人"),!1):(v.showError("儲存失敗","訪查人員只能填寫中文和英文"),!1):(v.showError("儲存失敗","請輸入訪查人員"),!1)},f=()=>{if(!a.value.year||!a.value.month||!a.value.day)return v.showError("儲存失敗","請填寫完整的訪查日期"),!1;const Q=/^\d+$/,Y={"開始時間(時)":a.value.startHour,"開始時間(分)":a.value.startMinute,"結束時間(時)":a.value.endHour,"結束時間(分)":a.value.endMinute};for(const[ue,pe]of Object.entries(Y)){if(!pe)return v.showError("儲存失敗",`請填寫${ue}`),!1;if(!Q.test(pe))return v.showError("儲存失敗",`${ue}只能填寫數字`),!1}return!0},V=()=>{let Q=!1;return Object.keys(a.value.checkResults).forEach(Y=>{a.value.checkResults[Y]===null&&(Q=!0)}),Q?(v.showError("儲存失敗","請完成所有查核項目的評估"),!1):!0},W=async Q=>{let Y;return U.value?Y=await Rs.updateVisitHistory(U.value,Q):Y=await Rs.createVisitHistory(Q),Y},H=Q=>{var Y;return Q.data&&Q.data.code===0?(v.showSuccess("儲存成功","訪視記錄已成功儲存"),T.value=!1,d.push("/supervision"),!0):(v.showError("儲存失敗",((Y=Q.data)==null?void 0:Y.message)||"儲存訪視記錄時發生錯誤"),!1)},k=async()=>{if(!p()||!_()||!f()||!V())return;const Q=b();console.log("準備提交訪視記錄:",Q);try{K.value=!0;const Y=await W(Q);H(Y)}catch(Y){console.error("儲存訪視記錄錯誤:",Y),v.showError("儲存失敗","儲存訪視記錄時發生錯誤，請稍後再試")}finally{K.value=!1}},D=async()=>{o.value=!0;try{const Q=await nt.getSchoolOptions();Q.data&&Q.data.code===0&&Array.isArray(Q.data.data)?u.value=Q.data.data.map(Y=>({value:Y.id,label:Y.name})):(console.error("學校資料格式不正確:",Q.data),u.value=[])}catch(Q){console.error("獲取學校列表失敗:",Q),u.value=[]}finally{o.value=!1}},j=async Q=>{if(!Q){C.value=[],a.value.courseName="",a.value.courseDate="";return}N.value=!0;try{const Y=await nt.getCourseData({school:Q});Y.data&&Y.data.code===0&&Array.isArray(Y.data.data)?C.value=Y.data.data.map(ue=>({value:ue.id,label:ue.name,date:ue.date||""})):(console.error("課程資料格式不正確:",Y.data),C.value=[])}catch(Y){console.error("獲取課程列表失敗:",Y),a.value.courseName="",a.value.courseDate="",C.value=[]}finally{N.value=!1}};Ee(()=>a.value.school,Q=>{Q?j(Q):C.value=[]}),Ee(()=>a.value.courseName,Q=>{if(Q){const Y=C.value.find(ue=>ue.value===Q);Y&&(a.value.courseDate=Y.date||"")}else a.value.courseDate=""}),Ee(()=>a.value.needFollowUp,Q=>{Q===!1&&(a.value.recheckRemark="")});const S=async()=>{T.value?await v.confirmAsync("確認儲存","確定要儲存修改嗎？")&&k():(z.value=JSON.parse(JSON.stringify(a.value)),T.value=!0)},x=async()=>{await v.confirmAsync("確認離開","確定要離開頁面嗎？所有未儲存的修改將會遺失。")&&d.back()},L=Q=>{const Y=`${Q}-`;return Object.keys(a.value.questions).filter(pe=>pe.startsWith(Y)).sort((pe,ye)=>{const ne=parseInt(pe.split("-")[1]),se=parseInt(ye.split("-")[1]);return ne-se})},de=()=>{const Q=document.createElement("div");return Q.style.width="100%",Q.style.padding="20px",Q},xe=Q=>{const Y=u.value.find(ue=>ue.value===Q);return Y?Y.label:""},fe=Q=>{const Y=C.value.find(ue=>ue.value===Q);return Y?Y.label:""},ke=Q=>{if(a.value.schoolName)return a.value.schoolName;for(const Y of u.value)if(Y.value.toString()===Q.toString())return Y.label;return"請選擇學校"},De=Q=>{if(a.value.courseNameText)return a.value.courseNameText;for(const Y of C.value)if(Y.value.toString()===Q.toString())return Y.label;return"請選擇課程"},we=()=>{let Q=xe(a.value.school);Q||(Q=ke(a.value.school));let Y=fe(a.value.courseName);return Y||(Y=De(a.value.courseName)),{schoolName:Q,courseName:Y}},$e=async()=>{try{g.value=!0;const Q=de();(Ae=>{const Re=document.createElement("h2");Re.textContent="教學查核紀錄表",Re.style.textAlign="center",Re.style.marginBottom="20px",Re.style.fontFamily="Arial, sans-serif",Ae.appendChild(Re);const Me=document.createElement("h2");Me.textContent="113-116年推動政府資安人力職能轉換訓練服務",Me.style.textAlign="center",Me.style.marginBottom="20px",Me.style.fontFamily="Arial, sans-serif",Me.style.fontWeight="bold",Ae.insertBefore(Me,Re)})(Q);const ue=Ae=>{const Re=document.createElement("div");Re.style.marginBottom="20px";const Me=document.createElement("h3");return Me.textContent=Ae,Me.style.fontWeight="bold",Me.style.marginBottom="10px",Re.appendChild(Me),Re},pe=()=>{const Ae=document.createElement("table");return Ae.style.width="100%",Ae.style.borderCollapse="collapse",Ae.style.marginBottom="20px",Ae.style.border="1px solid #000",Ae},ye=ue("一、訪查學校、時間及參與人員"),ne=pe(),{schoolName:se,courseName:re}=we();console.log("匯出PDF - 學校選項:",u.value),console.log("匯出PDF - 選中的學校ID:",a.value.school),console.log("匯出PDF - 選中的學校名稱:",se),console.log("匯出PDF - 課程選項:",C.value),console.log("匯出PDF - 選中的課程ID:",a.value.courseName),console.log("匯出PDF - 選中的課程名稱:",re),console.log("匯出PDF - 最終使用的學校名稱:",se),console.log("匯出PDF - 最終使用的課程名稱:",re),((Ae,Re)=>[{label1:"訪查學校",value1:Ae,label2:"課程名稱",value2:Re},{label1:"授課時間",value1:a.value.courseDate,label2:"",value2:"",colspan:!0},{label1:"訪查時間(24 時制)",value1:"",label2:"訪查方式",value2:"",needCustom:!0},{label1:"聯絡人",value1:a.value.interviewee,label2:"訪查人員",value2:a.value.inspectors}])(se,re).forEach(Ae=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");if(Me.textContent=Ae.label1,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.fontWeight="bold",Me.style.width="20%",Me.style.textAlign="center",Re.appendChild(Me),Ae.colspan){const Ke=document.createElement("td");Ke.setAttribute("colspan","3"),Ke.textContent=Ae.value1,Ke.style.border="1px solid #000",Ke.style.padding="8px",Re.appendChild(Ke)}else if(Ae.needCustom&&Ae.label1==="訪查時間(24 時制)"){const Ke=document.createElement("td");Ke.style.border="1px solid #000",Ke.style.padding="8px";const at=document.createElement("div");at.style.display="flex",at.style.flexDirection="column",at.style.alignItems="center";const Ze=document.createElement("div");Ze.style.display="flex",Ze.style.alignItems="center",Ze.style.marginBottom="8px";const it=document.createElement("div");it.style.display="inline-block",it.style.position="relative",it.style.marginRight="5px";const mt=document.createElement("span");mt.textContent=a.value.year||"",mt.style.display="inline-block",mt.style.minWidth="30px",mt.style.textAlign="center",it.appendChild(mt);const Pt=document.createElement("div");Pt.style.position="absolute",Pt.style.bottom="-2px",Pt.style.left="0",Pt.style.width="100%",Pt.style.height="1px",Pt.style.backgroundColor="#000",it.appendChild(Pt),Ze.appendChild(it),Ze.appendChild(document.createTextNode(" 年 "));const Ft=document.createElement("div");Ft.style.display="inline-block",Ft.style.position="relative",Ft.style.marginRight="5px";const Ut=document.createElement("span");Ut.textContent=a.value.month||"",Ut.style.display="inline-block",Ut.style.minWidth="25px",Ut.style.textAlign="center",Ft.appendChild(Ut);const jt=document.createElement("div");jt.style.position="absolute",jt.style.bottom="-2px",jt.style.left="0",jt.style.width="100%",jt.style.height="1px",jt.style.backgroundColor="#000",Ft.appendChild(jt),Ze.appendChild(Ft),Ze.appendChild(document.createTextNode(" 月 "));const Ot=document.createElement("div");Ot.style.display="inline-block",Ot.style.position="relative";const as=document.createElement("span");as.textContent=a.value.day||"",as.style.display="inline-block",as.style.minWidth="25px",as.style.textAlign="center",Ot.appendChild(as);const Xt=document.createElement("div");Xt.style.position="absolute",Xt.style.bottom="-2px",Xt.style.left="0",Xt.style.width="100%",Xt.style.height="1px",Xt.style.backgroundColor="#000",Ot.appendChild(Xt),Ze.appendChild(Ot),Ze.appendChild(document.createTextNode(" 日")),at.appendChild(Ze);const $t=document.createElement("div");$t.style.display="flex",$t.style.alignItems="center";const os=document.createElement("div");os.style.display="inline-block",os.style.position="relative";const zt=document.createElement("span");zt.textContent=a.value.startHour||"",zt.style.display="inline-block",zt.style.minWidth="25px",zt.style.textAlign="center",os.appendChild(zt);const pt=document.createElement("div");pt.style.position="absolute",pt.style.bottom="-2px",pt.style.left="0",pt.style.width="100%",pt.style.height="1px",pt.style.backgroundColor="#000",os.appendChild(pt),$t.appendChild(os),$t.appendChild(document.createTextNode(" : "));const gs=document.createElement("div");gs.style.display="inline-block",gs.style.position="relative",gs.style.marginRight="10px";const _s=document.createElement("span");_s.textContent=a.value.startMinute||"",_s.style.display="inline-block",_s.style.minWidth="25px",_s.style.textAlign="center",gs.appendChild(_s);const ms=document.createElement("div");ms.style.position="absolute",ms.style.bottom="-2px",ms.style.left="0",ms.style.width="100%",ms.style.height="1px",ms.style.backgroundColor="#000",gs.appendChild(ms),$t.appendChild(gs),$t.appendChild(document.createTextNode(" ~ "));const ks=document.createElement("div");ks.style.display="inline-block",ks.style.position="relative";const $s=document.createElement("span");$s.textContent=a.value.endHour||"",$s.style.display="inline-block",$s.style.minWidth="25px",$s.style.textAlign="center",ks.appendChild($s);const bs=document.createElement("div");bs.style.position="absolute",bs.style.bottom="-2px",bs.style.left="0",bs.style.width="100%",bs.style.height="1px",bs.style.backgroundColor="#000",ks.appendChild(bs),$t.appendChild(ks),$t.appendChild(document.createTextNode(" : "));const Cs=document.createElement("div");Cs.style.display="inline-block",Cs.style.position="relative";const Es=document.createElement("span");Es.textContent=a.value.endMinute||"",Es.style.display="inline-block",Es.style.minWidth="25px",Es.style.textAlign="center",Cs.appendChild(Es);const fs=document.createElement("div");fs.style.position="absolute",fs.style.bottom="-2px",fs.style.left="0",fs.style.width="100%",fs.style.height="1px",fs.style.backgroundColor="#000",Cs.appendChild(fs),$t.appendChild(Cs),at.appendChild($t),Ke.appendChild(at),Re.appendChild(Ke);const ys=document.createElement("td");ys.textContent=Ae.label2,ys.style.border="1px solid #000",ys.style.padding="8px",ys.style.fontWeight="bold",ys.style.width="20%",ys.style.textAlign="center",Re.appendChild(ys);const Ss=document.createElement("td");Ss.style.border="1px solid #000",Ss.style.padding="8px",Ss.style.width="30%";const Ds=document.createElement("div");Ds.style.display="flex",Ds.style.flexDirection="column";const xs=document.createElement("div");xs.style.display="flex",xs.style.alignItems="center",xs.style.marginBottom="8px";const ls=document.createElement("div");ls.style.width="16px",ls.style.height="16px",ls.style.border="2px solid #000",ls.style.marginRight="5px",ls.style.display="inline-block",a.value.inspectionType==="onsite"&&(ls.style.backgroundColor="#000",ls.style.color="#fff",ls.innerHTML="&#10003;",ls.style.lineHeight="15px",ls.style.textAlign="center",ls.style.fontWeight="bold"),xs.appendChild(ls),xs.appendChild(document.createTextNode("實地訪查"));const ss=document.createElement("div");ss.style.display="flex",ss.style.alignItems="center";const ns=document.createElement("div");if(ns.style.width="16px",ns.style.height="16px",ns.style.border="2px solid #000",ns.style.marginRight="5px",ns.style.display="inline-block",a.value.inspectionType==="online"&&(ns.style.backgroundColor="#000",ns.style.color="#fff",ns.innerHTML="&#10003;",ns.style.lineHeight="15px",ns.style.textAlign="center",ns.style.fontWeight="bold"),ss.appendChild(ns),ss.appendChild(document.createTextNode("線上訪查：")),a.value.inspectionType==="online"&&a.value.onlineRemark){ss.style.display="flex",ss.style.flexWrap="wrap",ss.style.alignItems="center";const Yt=document.createElement("span");Yt.textContent=a.value.onlineRemark,Yt.style.marginLeft="5px",Yt.style.borderBottom="1px solid #000",Yt.style.display="inline-block",Yt.style.maxWidth="150px",Yt.style.wordBreak="break-all",Yt.style.whiteSpace="normal",ss.appendChild(Yt)}else{ss.style.display="flex",ss.style.flexWrap="wrap",ss.style.alignItems="center";const Yt=document.createElement("span");Yt.textContent="          ",Yt.style.marginLeft="5px",Yt.style.borderBottom="1px solid #000",Yt.style.display="inline-block",Yt.style.maxWidth="150px",ss.appendChild(Yt)}Ds.appendChild(xs),Ds.appendChild(ss),Ss.appendChild(Ds),Re.appendChild(Ss)}else{const Ke=document.createElement("td");if(Ke.textContent=Ae.value1,Ke.style.border="1px solid #000",Ke.style.padding="8px",Ke.style.width="30%",Re.appendChild(Ke),Ae.label2){const at=document.createElement("td");at.textContent=Ae.label2,at.style.border="1px solid #000",at.style.padding="8px",at.style.fontWeight="bold",at.style.width="20%",at.style.textAlign="center",Re.appendChild(at);const Ze=document.createElement("td");Ze.textContent=Ae.value2,Ze.style.border="1px solid #000",Ze.style.padding="8px",Ze.style.width="30%",Re.appendChild(Ze)}}ne.appendChild(Re)});const ve=Ae=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");Me.setAttribute("colspan","4"),Me.style.border="1px solid #000",Me.style.padding="30px";const Ke=document.createElement("div");Ke.style.display="flex",Ke.style.justifyContent="space-between",Ke.style.width="100%",Ke.style.marginTop="10px",Ke.style.marginBottom="10px",Ke.className="signature-section",["承辦","科長","高級分析師","組長"].forEach(Ze=>{const it=ie(Ze);Ke.appendChild(it)}),Me.appendChild(Ke),Re.appendChild(Me),Ae.appendChild(Re)},ie=Ae=>{const Re=document.createElement("div");Re.style.fontSize="14px",Re.style.flex="1",Re.style.padding="10px 5px",Re.style.display="flex",Re.style.alignItems="center",Re.className="signature-box";const Me=document.createElement("span");Me.textContent=Ae+"：",Me.style.marginRight="5px",Re.appendChild(Me);const Ke=document.createElement("span");return Ke.innerHTML="&nbsp;",Ke.style.flexGrow="1",Ke.style.borderBottom="1px solid #000",Ke.style.marginLeft="5px",Ke.style.marginRight="5px",Ke.style.height="20px",Re.appendChild(Ke),Re};ve(ne),ye.appendChild(ne),Q.appendChild(ye);const _e=ue("二、查核內容"),ge=(()=>{const Ae=document.createElement("table");return Ae.style.width="100%",Ae.style.borderCollapse="collapse",Ae.style.border="1px solid #000",Ae})(),q=document.createElement("thead"),i=document.createElement("tr");i.style.border="1px solid #000";const n=["查核項目","查核結果","佐證資料或說明原因"],w=["50%","30%","20%"];n.forEach((Ae,Re)=>{const Me=document.createElement("th");Me.textContent=Ae,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.textAlign="center",Me.style.backgroundColor="#f2f2f2",Me.style.width=w[Re],i.appendChild(Me)}),q.appendChild(i),ge.appendChild(q);const ce=document.createElement("tbody");[{id:1,title:"1、課程師資實施狀況（實地40%/線上20%）"},{id:2,title:"2、人力安排情形（實地15%/線上30%）"},{id:3,title:"3、環境設備實施狀況（實地20%/線上30%）"},{id:4,title:"4、課程實施情形（實地25%/線上20%）"}].forEach(Ae=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");Me.setAttribute("colspan","3"),Me.textContent=Ae.title,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.fontWeight="bold",Re.appendChild(Me),ce.appendChild(Re),L(Ae.id).forEach(at=>{const Ze=document.createElement("tr");Ze.style.border="1px solid #000";const it=document.createElement("td");it.textContent=a.value.questions[at],it.style.border="1px solid #000",it.style.padding="8px",it.style.paddingLeft="25px",Ze.appendChild(it);const mt=document.createElement("td");mt.style.border="1px solid #000",mt.style.padding="8px";const Pt=document.createElement("table");Pt.style.width="100%",Pt.style.border="none",Pt.style.borderCollapse="collapse",Pt.style.margin="0 auto";const Ft=document.createElement("tr"),Ut=document.createElement("td");Ut.style.border="none",Ut.style.width="50%",Ut.style.textAlign="center",Ut.style.verticalAlign="middle";const jt=document.createElement("div");jt.style.display="inline-flex",jt.style.alignItems="center",jt.style.justifyContent="center";const Ot=document.createElement("div");Ot.style.width="16px",Ot.style.height="16px",Ot.style.border="2px solid #000",Ot.style.marginRight="5px",Ot.style.display="inline-block",a.value.checkResults[at]===!0&&(Ot.style.backgroundColor="#000",Ot.style.color="#fff",Ot.innerHTML="&#10003;",Ot.style.lineHeight="15px",Ot.style.textAlign="center",Ot.style.fontWeight="bold"),jt.appendChild(Ot),jt.appendChild(document.createTextNode("符合")),Ut.appendChild(jt),Ft.appendChild(Ut);const as=document.createElement("td");as.style.border="none",as.style.width="50%",as.style.textAlign="center",as.style.verticalAlign="middle";const Xt=document.createElement("div");Xt.style.display="inline-flex",Xt.style.alignItems="center",Xt.style.justifyContent="center";const $t=document.createElement("div");$t.style.width="16px",$t.style.height="16px",$t.style.border="2px solid #000",$t.style.marginRight="5px",$t.style.display="inline-block",a.value.checkResults[at]===!1&&($t.style.backgroundColor="#000",$t.style.color="#fff",$t.innerHTML="&#10003;",$t.style.lineHeight="15px",$t.style.textAlign="center",$t.style.fontWeight="bold"),Xt.appendChild($t),Xt.appendChild(document.createTextNode("不符合")),as.appendChild(Xt),Ft.appendChild(as),Pt.appendChild(Ft),mt.appendChild(Pt),Ze.appendChild(mt);const os=document.createElement("td");if(at==="3-3"){const zt=document.createElement("div");zt.style.display="flex",zt.style.alignItems="center";const pt=document.createElement("div");pt.style.width="16px",pt.style.height="16px",pt.style.border="2px solid #000",pt.style.marginRight="5px",pt.style.display="inline-block",a.value.isOffline&&(pt.style.backgroundColor="#000",pt.style.color="#fff",pt.innerHTML="&#10003;",pt.style.lineHeight="15px",pt.style.textAlign="center",pt.style.fontWeight="bold"),zt.appendChild(pt),zt.appendChild(document.createTextNode("實體課程")),os.appendChild(zt)}else if(at==="4-5"){const zt=document.createElement("div");zt.style.display="flex",zt.style.alignItems="center";const pt=document.createElement("div");pt.style.width="16px",pt.style.height="16px",pt.style.border="2px solid #000",pt.style.marginRight="5px",pt.style.display="inline-block",a.value.isOnline&&(pt.style.backgroundColor="#000",pt.style.color="#fff",pt.innerHTML="&#10003;",pt.style.lineHeight="15px",pt.style.textAlign="center",pt.style.fontWeight="bold"),zt.appendChild(pt),zt.appendChild(document.createTextNode("線上課程")),os.appendChild(zt)}else os.textContent=a.value.evidence[at]||"";os.style.border="1px solid #000",os.style.padding="8px",Ze.appendChild(os),ce.appendChild(Ze)})});const Ve=document.createElement("tr");Ve.style.border="1px solid #000";const Qe=document.createElement("td");Qe.setAttribute("colspan","3");const et=document.createElement("div");et.style.marginBottom="5px",et.style.padding="8px",et.style.fontWeight="bold",et.style.display="flex",et.style.alignItems="center",et.style.flexWrap="wrap";const Ct=document.createElement("span");Ct.textContent="5、",et.appendChild(Ct);const ct=document.createElement("span");ct.style.position="relative",ct.style.display="inline-block",ct.style.minWidth="25px",ct.style.textAlign="center",ct.style.margin="0 5px";const lt=document.createElement("span");lt.textContent=a.value.passCount!==null&&a.value.passCount!==void 0?a.value.passCount:"",ct.appendChild(lt);const dt=document.createElement("div");dt.style.position="absolute",dt.style.bottom="-2px",dt.style.left="0",dt.style.width="100%",dt.style.height="1px",dt.style.backgroundColor="#000",ct.appendChild(dt),et.appendChild(ct);const At=document.createElement("span");At.textContent=" 個項目符合、",et.appendChild(At);const Et=document.createElement("span");Et.style.position="relative",Et.style.display="inline-block",Et.style.minWidth="25px",Et.style.textAlign="center",Et.style.margin="0 5px";const ds=document.createElement("span");ds.textContent=a.value.failCount!==null&&a.value.failCount!==void 0?a.value.failCount:"",Et.appendChild(ds);const _t=document.createElement("div");_t.style.position="absolute",_t.style.bottom="-2px",_t.style.left="0",_t.style.width="100%",_t.style.height="1px",_t.style.backgroundColor="#000",Et.appendChild(_t),et.appendChild(Et);const ts=document.createElement("span");ts.textContent=" 個項目不符合。",et.appendChild(ts),Qe.appendChild(et);const qt=document.createElement("div");qt.style.display="flex",qt.style.alignItems="center",qt.style.padding="0 8px 8px 8px";const Qt=document.createElement("div");Qt.style.display="flex",Qt.style.alignItems="center";const kt=document.createElement("span");kt.textContent="得分：",kt.style.marginRight="5px",kt.style.fontWeight="bold",Qt.appendChild(kt);const Kt=document.createElement("div");Kt.style.display="inline-block",Kt.style.position="relative",Kt.style.minWidth="40px";const Bt=document.createElement("span");Bt.textContent=a.value.totalScore||"",Bt.style.display="inline-block",Bt.style.minWidth="40px",Bt.style.textAlign="center",Kt.appendChild(Bt);const B=document.createElement("div");B.style.position="absolute",B.style.bottom="-2px",B.style.left="0",B.style.width="100%",B.style.height="1px",B.style.backgroundColor="#000",Kt.appendChild(B),Qt.appendChild(Kt),qt.appendChild(Qt);const I=document.createElement("div");I.style.display="flex",I.style.marginLeft="40px",I.style.alignItems="center";const F=document.createElement("div");F.style.display="flex",F.style.alignItems="center",F.style.marginRight="20px";const oe=document.createElement("div");oe.style.width="16px",oe.style.height="16px",oe.style.border="2px solid #000",oe.style.marginRight="5px",oe.style.display="inline-block",a.value.hasPass===!0&&(oe.style.backgroundColor="#000",oe.style.color="#fff",oe.innerHTML="&#10003;",oe.style.lineHeight="15px",oe.style.textAlign="center",oe.style.fontWeight="bold"),F.appendChild(oe),F.appendChild(document.createTextNode("通過"));const Ie=document.createElement("div");Ie.style.display="flex",Ie.style.alignItems="center";const Ne=document.createElement("div");Ne.style.width="16px",Ne.style.height="16px",Ne.style.border="2px solid #000",Ne.style.marginRight="5px",Ne.style.display="inline-block",a.value.hasPass===!1&&(Ne.style.backgroundColor="#000",Ne.style.color="#fff",Ne.innerHTML="&#10003;",Ne.style.lineHeight="15px",Ne.style.textAlign="center",Ne.style.fontWeight="bold"),Ie.appendChild(Ne),Ie.appendChild(document.createTextNode("不通過")),I.appendChild(F),I.appendChild(Ie),qt.appendChild(I),Qe.appendChild(qt),Ve.appendChild(Qe),ce.appendChild(Ve),ge.appendChild(ce),_e.appendChild(ge),Q.appendChild(_e),((Ae,Re)=>{const Me=document.createElement("div");Me.textContent=Re,Me.style.padding="2px 0px",Me.style.color="black",Me.style.fontSize="16px",Me.style.lineHeight="1",Me.style.fontFamily="Arial, sans-serif",Ae.appendChild(Me)})(Q,"備註：說明原因應清楚描述，避免不確定的文字：如可能...。");const tt=document.createElement("table");tt.style.width="100%",tt.style.border="none",tt.style.borderCollapse="collapse",tt.style.margin="0",tt.style.padding="0";const st=document.createElement("tr"),Nt=document.createElement("td");Nt.style.height="0px",Nt.style.border="none",Nt.innerHTML="&nbsp;",st.appendChild(Nt),tt.appendChild(st),Q.appendChild(tt);const Dt=()=>{const Ae=document.createElement("div");Ae.style.marginBottom="10px";const Re=document.createElement("table");return Re.style.width="100%",Re.style.borderCollapse="collapse",Re.style.border="1px solid #000",{section:Ae,table:Re}},{section:yt,table:He}=Dt(),Xe=document.createElement("tr");Xe.style.border="1px solid #000";const qe=document.createElement("td");qe.setAttribute("colspan","2"),qe.textContent="6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。",qe.style.border="1px solid #000",qe.style.padding="8px",qe.style.fontWeight="bold",qe.style.fontSize="15px",qe.style.lineHeight="1.5",Xe.appendChild(qe),He.appendChild(Xe);const ze=document.createElement("tr");ze.style.border="1px solid #000";const Je=document.createElement("td");Je.textContent=`改善方法
(學校承辦人員)`,Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.width="25%",Je.style.textAlign="center",Je.style.verticalAlign="middle",ze.appendChild(Je);const Ye=document.createElement("td");Ye.textContent=a.value.improvement||"",Ye.style.border="1px solid #000",Ye.style.padding="8px",Ye.style.width="75%",Ye.style.minHeight="200px",Ye.style.height="200px",ze.appendChild(Ye),He.appendChild(ze),yt.appendChild(He),Q.appendChild(yt);const ut=()=>{const Ae=document.createElement("div");Ae.style.marginTop="20px";const Re=document.createElement("div");return Re.style.display="flex",Re.style.alignItems="center",Re.style.marginBottom="10px",{section:Ae,header:Re}},{section:Ht,header:Tt}=ut(),Wt=document.createElement("h3");Wt.textContent="三、追蹤調查",Wt.style.fontWeight="bold",Wt.style.margin="0",Wt.style.padding="0",Wt.style.marginRight="20px",Tt.appendChild(Wt);const Vt=document.createElement("div");Vt.style.display="flex",Vt.style.alignItems="center",Vt.style.marginRight="20px";const xt=document.createElement("div");xt.style.width="16px",xt.style.height="16px",xt.style.border="2px solid #000",xt.style.marginRight="5px",xt.style.display="inline-block",a.value.needFollowUp===!1&&(xt.style.backgroundColor="#000",xt.style.color="#fff",xt.innerHTML="&#10003;",xt.style.lineHeight="15px",xt.style.textAlign="center",xt.style.fontWeight="bold"),Vt.appendChild(xt),Vt.appendChild(document.createTextNode("不須追蹤")),Tt.appendChild(Vt);const vt=document.createElement("div");vt.style.display="flex",vt.style.alignItems="center";const wt=document.createElement("div");if(wt.style.width="16px",wt.style.height="16px",wt.style.border="2px solid #000",wt.style.marginRight="5px",wt.style.display="inline-block",a.value.needFollowUp===!0&&(wt.style.backgroundColor="#000",wt.style.color="#fff",wt.innerHTML="&#10003;",wt.style.lineHeight="15px",wt.style.textAlign="center",wt.style.fontWeight="bold"),vt.appendChild(wt),vt.appendChild(document.createTextNode("需複查：")),a.value.needFollowUp===!0&&a.value.recheckRemark){vt.style.display="flex",vt.style.flexWrap="wrap",vt.style.alignItems="center";const Ae=document.createElement("span");Ae.textContent=a.value.recheckRemark,Ae.style.marginLeft="5px",Ae.style.borderBottom="1px solid #000",Ae.style.display="inline-block",Ae.style.maxWidth="150px",Ae.style.wordBreak="break-all",Ae.style.whiteSpace="normal",vt.appendChild(Ae)}else{vt.style.display="flex",vt.style.flexWrap="wrap",vt.style.alignItems="center";const Ae=document.createElement("span");Ae.textContent="          ",Ae.style.marginLeft="5px",Ae.style.borderBottom="1px solid #000",Ae.style.display="inline-block",Ae.style.maxWidth="150px",vt.appendChild(Ae)}Tt.appendChild(vt),Ht.appendChild(Tt);const It=document.createElement("div");It.style.marginTop="10px";const ht=document.createElement("p");ht.textContent="備註：考量改善方法實施完成的時間點，後續計畫做以下安排。",It.appendChild(ht);const Jt=document.createElement("p");Jt.textContent="1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。",It.appendChild(Jt);const Rt=document.createElement("p");Rt.textContent="2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。",It.appendChild(Rt),Ht.appendChild(It),Q.appendChild(Ht),Q.style.position="absolute",Q.style.left="-9999px",document.body.appendChild(Q),setTimeout(()=>{if(ne.rows&&ne.rows.length>=3&&ne.rows[2].cells.length>=4){const Re=ne.rows[2].cells[3];Re.innerHTML="";const Me=document.createElement("div");Me.style.display="flex",Me.style.flexDirection="column";const Ke=document.createElement("div");Ke.style.display="flex",Ke.style.alignItems="center",Ke.style.marginBottom="5px";const at=document.createElement("div");at.style.width="16px",at.style.height="16px",at.style.border="2px solid #000",at.style.marginRight="5px",at.style.display="inline-block",a.value.inspectionType==="onsite"&&(at.style.backgroundColor="#000",at.style.color="#fff",at.innerHTML="&#10003;",at.style.lineHeight="15px",at.style.textAlign="center",at.style.fontWeight="bold"),Ke.appendChild(at),Ke.appendChild(document.createTextNode("實地訪查"));const Ze=document.createElement("div");Ze.style.display="flex",Ze.style.alignItems="center";const it=document.createElement("div");if(it.style.width="16px",it.style.height="16px",it.style.border="2px solid #000",it.style.marginRight="5px",it.style.display="inline-block",a.value.inspectionType==="online"&&(it.style.backgroundColor="#000",it.style.color="#fff",it.innerHTML="&#10003;",it.style.lineHeight="15px",it.style.textAlign="center",it.style.fontWeight="bold"),Ze.appendChild(it),Ze.appendChild(document.createTextNode("線上訪查：")),a.value.inspectionType==="online"&&a.value.onlineRemark){Ze.style.display="flex",Ze.style.flexWrap="wrap",Ze.style.alignItems="center";const mt=document.createElement("span");mt.textContent=a.value.onlineRemark,mt.style.marginLeft="5px",mt.style.borderBottom="1px solid #000",mt.style.display="inline-block",mt.style.maxWidth="150px",mt.style.wordBreak="break-all",mt.style.whiteSpace="normal",Ze.appendChild(mt)}else{Ze.style.display="flex",Ze.style.flexWrap="wrap",Ze.style.alignItems="center";const mt=document.createElement("span");mt.textContent="          ",mt.style.marginLeft="5px",mt.style.borderBottom="1px solid #000",mt.style.display="inline-block",mt.style.maxWidth="150px",Ze.appendChild(mt)}Me.appendChild(Ke),Me.appendChild(Ze),Re.appendChild(Me)}const Ae=Re=>{let Me="<html><head><title>教學查核紀錄表</title>";return Me+="<style>",Me+="body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }",Me+="h2 { text-align: center; margin-bottom: 20px; }",Me+="h3 { margin-top: 20px; margin-bottom: 10px; }",Me+="table { width: 100%; border-collapse: collapse; margin-bottom: 20px; page-break-inside: auto; }",Me+="tr { page-break-inside: avoid; page-break-after: auto; }",Me+="thead { display: table-header-group; }",Me+="tfoot { display: table-footer-group; }",Me+="th, td { border: 1px solid #000; padding: 6px; }",Me+="th { background-color: #f2f2f2; text-align: center; }",Me+="@media print {",Me+="  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",Me+="  th, td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",Me+="  @page { margin: 0; size: auto; }",Me+="  html { margin: 0; padding: 0.5cm; }",Me+="  body { margin: 0; padding: 0; }",Me+="  .signature-section { display: flex; justify-content: space-between; margin-top: 20px; }",Me+="  .signature-box { margin-bottom: 10px; }",Me+="}",Me+="</style></head><body>",Me+=Re,Me+="<script>",Me+="window.onload = function() {",Me+="  setTimeout(function() {",Me+='    var style = document.createElement("style");',Me+='    style.innerHTML = "@page { margin: 1cm; }";',Me+="    document.head.appendChild(style);",Me+="    window.print();",Me+="  }, 300);",Me+="};",Me+="<\/script>",Me+="</body></html>",Me};try{const Re=window.open("","_blank");if(!Re)throw new Error("無法開啟列印視窗，請檢查是否被瀏覽器阻擋");const Me=Ae(Q.innerHTML);Re.document.open(),Re.document.write(Me),Re.document.close(),Re.addEventListener("afterprint",()=>{document.body.removeChild(Q),v.showSuccess("貼心提醒","查核紀錄表已成功匯出為PDF"),g.value=!1}),setTimeout(()=>{g.value=!1},5e3)}catch(Re){console.error("列印過程發生錯誤:",Re),v.showError("匯出失敗",Re.message||"列印過程發生錯誤"),g.value=!1}},100)}catch(Q){console.error("匯出查核紀錄表失敗:",Q),v.showError("匯出失敗",Q.message||"匯出查核紀錄表失敗，請稍後再試"),g.value=!1;const Y=document.querySelector('div[style*="-9999px"]');Y&&Y.parentNode&&Y.parentNode.removeChild(Y)}};je(()=>{O(),D(),U.value?r():T.value=!0,A()});const ae=m({visitUpdate:!1,visitExport:!1}),O=async()=>{try{const Q=await ot.getSidebarPermissions();Q.data.code===0&&Q.data.message==="success"?(ae.value=Q.data.data,console.log("訪視督課頁面權限:",ae.value)):console.error("獲取權限失敗:",Q.data.message)}catch(Q){console.error("獲取權限錯誤:",Q)}};Ee(()=>a.value.checkResults,Q=>{A()},{deep:!0}),Ee(()=>a.value.inspectionType,(Q,Y)=>{A(),Q==="onsite"?(a.value.isOffline=!0,a.value.isOnline=!1):Q==="online"?(a.value.isOnline=!0,a.value.isOffline=!1):(Q===""||Q===null)&&(a.value.isOffline=!1,a.value.isOnline=!1)}),Ee(()=>a.value.isOffline,Q=>{Q===!0?(a.value.inspectionType="onsite",a.value.isOnline=!1):Q===!1&&a.value.inspectionType==="onsite"&&(a.value.inspectionType="")}),Ee(()=>a.value.isOnline,Q=>{Q===!0?(a.value.inspectionType="online",a.value.isOffline=!1):Q===!1&&a.value.inspectionType==="online"&&(a.value.inspectionType="")});const A=()=>{let Q=0,Y=0,ue=0;const pe=a.value.inspectionType==="onsite"?"3-3":"4-5",ye={1:{onsite:40,online:20},2:{onsite:15,online:30},3:{onsite:20,online:30},4:{onsite:25,online:20}};for(const ne of[1,2,3,4]){const re=L(ne).filter(Le=>Le!==pe),Te=re.length;if(Te===0)continue;const ve=(ye[ne][a.value.inspectionType==="onsite"?"onsite":"online"]||0)/Te;let ie=0;for(const Le of re)a.value.checkResults[Le]===!0?(Q++,ie++):a.value.checkResults[Le]===!1&&Y++;const _e=ie*ve;ue+=_e}a.value.passCount=Q,a.value.failCount=Y,a.value.totalScore=Math.round(ue),ue>=70?a.value.hasPass=!0:ue<70&&(Q>0||Y>0)&&(a.value.hasPass=!1)},J=(Q,Y)=>{a.value.checkResults[Q]===Y?a.value.checkResults[Q]=null:a.value.checkResults[Q]=Y,A()};return(Q,Y)=>(t(),s("div",l_,[e("div",n_,[Ge(ft,{breadcrumbs:[{name:"訪視督課",path:"/supervision"},{name:"編輯查核紀錄表",path:"/checklist"}]})]),Y[67]||(Y[67]=e("div",{class:"w-full max-w-[1500px] flex justify-between mt-6 mb-2"},[e("h1",{class:"text-2xl font-bold text-center w-full"},"教學查核紀錄表")],-1)),e("div",r_,[e("div",i_,[ae.value.visitExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:$e,disabled:g.value},l(g.value?"匯出中...":"匯出 PDF"),9,d_)):G("",!0),T.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:x}," 取消 ")):G("",!0),ae.value.visitUpdate?(t(),s("button",{key:2,class:ee(["px-4 py-2",T.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:S,disabled:K.value},l(T.value?"儲存":"內容編輯"),11,u_)):G("",!0)])]),Y[68]||(Y[68]=e("div",{class:"w-full max-w-[1500px] mb-2"},[e("h2",{class:"text-lg font-bold"},"一、訪查學校、時間及參與人員")],-1)),e("div",c_,[e("div",null,[e("table",p_,[e("thead",null,[e("tr",null,[Y[25]||(Y[25]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 訪查學校 ",-1)),e("td",v_,[P(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Y[0]||(Y[0]=ue=>a.value.school=ue),disabled:o.value||!T.value},[e("option",b_,l(o.value?"載入中...":"請選擇學校"),1),(t(!0),s(X,null,le(u.value,ue=>(t(),s("option",{key:ue.value,value:ue.value},l(ue.label),9,f_))),128))],8,m_),[[Pe,a.value.school]])]),Y[26]||(Y[26]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 課程名稱 ",-1)),e("td",y_,[P(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Y[1]||(Y[1]=ue=>a.value.courseName=ue),disabled:!a.value.school||N.value||!T.value},[e("option",x_,l(a.value.school?N.value?"載入中...":"請選擇課程":"請先選擇學校"),1),(t(!0),s(X,null,le(C.value,ue=>(t(),s("option",{key:ue.value,value:ue.value},l(ue.label),9,h_))),128))],8,g_),[[Pe,a.value.courseName]])])])]),e("tbody",null,[e("tr",null,[Y[27]||(Y[27]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 授課時間 ",-1)),e("td",w_,[e("div",__,l(a.value.courseDate||"尚未選擇課程"),1)])]),e("tr",null,[Y[36]||(Y[36]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"},[me(" 訪查時間"),e("br"),me("(24 時制) ")],-1)),e("td",k_,[e("div",$_,[e("div",C_,[P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[2]||(Y[2]=ue=>a.value.year=ue),readonly:!T.value},null,8,E_),[[te,a.value.year]]),Y[28]||(Y[28]=e("span",{class:"mx-1"},"年",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[3]||(Y[3]=ue=>a.value.month=ue),readonly:!T.value},null,8,S_),[[te,a.value.month]]),Y[29]||(Y[29]=e("span",{class:"mx-1"},"月",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[4]||(Y[4]=ue=>a.value.day=ue),readonly:!T.value},null,8,D_),[[te,a.value.day]]),Y[30]||(Y[30]=e("span",{class:"mx-1"},"日",-1))]),e("div",M_,[P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[5]||(Y[5]=ue=>a.value.startHour=ue),readonly:!T.value},null,8,A_),[[te,a.value.startHour]]),Y[31]||(Y[31]=e("span",{class:"mx-1"},":",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[6]||(Y[6]=ue=>a.value.startMinute=ue),readonly:!T.value},null,8,I_),[[te,a.value.startMinute]]),Y[32]||(Y[32]=e("span",{class:"mx-2"},"~",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[7]||(Y[7]=ue=>a.value.endHour=ue),readonly:!T.value},null,8,R_),[[te,a.value.endHour]]),Y[33]||(Y[33]=e("span",{class:"mx-1"},":",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Y[8]||(Y[8]=ue=>a.value.endMinute=ue),readonly:!T.value},null,8,P_),[[te,a.value.endMinute]])])])]),Y[37]||(Y[37]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查方式 ",-1)),e("td",U_,[e("div",N_,[e("div",T_,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:a.value.inspectionType==="onsite",onChange:Y[9]||(Y[9]=ue=>a.value.inspectionType="onsite"),disabled:!T.value},null,40,V_),Y[34]||(Y[34]=e("span",null,"實地訪查",-1))]),e("div",j_,[e("div",L_,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:a.value.inspectionType==="online",onChange:Y[10]||(Y[10]=ue=>a.value.inspectionType="online"),disabled:!T.value},null,40,F_),Y[35]||(Y[35]=e("span",null,"線上訪查：",-1))]),e("div",O_,[P(e("input",{type:"text",class:"border-b border-black p-1 w-full","onUpdate:modelValue":Y[11]||(Y[11]=ue=>a.value.onlineRemark=ue),placeholder:"請輸入...",readonly:!T.value,style:{"max-width":"150px","word-break":"break-all","white-space":"normal","vertical-align":"bottom"}},null,8,q_),[[te,a.value.onlineRemark]])])])])])]),e("tr",null,[Y[38]||(Y[38]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 聯絡人 ",-1)),e("td",B_,[P(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":Y[12]||(Y[12]=ue=>a.value.interviewee=ue),placeholder:"請輸入聯絡人姓名...",readonly:!T.value},null,8,H_),[[te,a.value.interviewee]])]),Y[39]||(Y[39]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查人員 ",-1)),e("td",W_,[P(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":Y[13]||(Y[13]=ue=>a.value.inspectors=ue),placeholder:"請輸入訪查人員姓名...",readonly:!T.value},null,8,z_),[[te,a.value.inspectors]])])])])])])]),Y[69]||(Y[69]=e("div",{class:"w-full max-w-[1500px] mt-6 mb-2"},[e("h2",{class:"text-lg font-bold"},"二、查核內容")],-1)),e("div",K_,[e("table",J_,[Y[60]||(Y[60]=e("thead",null,[e("tr",null,[e("th",{class:"border-r border-b-2 border-black p-4 w-[55%] font-bold text-center"},"查核項目"),e("th",{class:"border-r border-b-2 border-black p-4 w-[25%] font-bold text-center"},"查核結果"),e("th",{class:"border-b-2 border-black p-4 w-[20%] font-bold text-center"},[me("佐證資料或"),e("br"),me("說明原因")])])],-1)),e("tbody",null,[Y[50]||(Y[50]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"1、課程師資實施狀況（實地40%/線上20%）")])])],-1)),(t(!0),s(X,null,le(L(1),ue=>(t(),s("tr",{key:ue,class:"border-b-2 border-black"},[e("td",Y_,[e("div",G_,[e("span",null,l(a.value.questions[ue]),1)])]),e("td",Z_,[e("div",Q_,[e("div",X_,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!0,onChange:pe=>J(ue,!0),disabled:!T.value},null,40,ek),Y[40]||(Y[40]=e("span",null,"符合",-1))]),e("div",tk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!1,onChange:pe=>J(ue,!1),disabled:!T.value},null,40,sk),Y[41]||(Y[41]=e("span",null,"不符合",-1))])])]),e("td",ak,[P(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":pe=>a.value.evidence[ue]=pe,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,ok),[[te,a.value.evidence[ue]]])])]))),128)),Y[51]||(Y[51]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"2、人力安排情形（實地15%/線上30%）")])])],-1)),(t(!0),s(X,null,le(L(2),ue=>(t(),s("tr",{key:ue,class:"border-b-2 border-black"},[e("td",lk,[e("div",nk,[e("span",null,l(a.value.questions[ue]),1)])]),e("td",rk,[e("div",ik,[e("div",dk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!0,onChange:pe=>J(ue,!0),disabled:!T.value},null,40,uk),Y[42]||(Y[42]=e("span",null,"符合",-1))]),e("div",ck,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!1,onChange:pe=>J(ue,!1),disabled:!T.value},null,40,pk),Y[43]||(Y[43]=e("span",null,"不符合",-1))])])]),e("td",vk,[P(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":pe=>a.value.evidence[ue]=pe,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,mk),[[te,a.value.evidence[ue]]])])]))),128)),Y[52]||(Y[52]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"3、環境設備實施狀況（實地20%/線上30%）")])])],-1)),(t(!0),s(X,null,le(L(3),ue=>(t(),s("tr",{key:ue,class:"border-b-2 border-black"},[e("td",bk,[e("div",fk,[e("span",null,l(a.value.questions[ue]),1)])]),e("td",yk,[e("div",gk,[e("div",xk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!0,onChange:pe=>J(ue,!0),disabled:!T.value},null,40,hk),Y[44]||(Y[44]=e("span",null,"符合",-1))]),e("div",wk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!1,onChange:pe=>J(ue,!1),disabled:!T.value},null,40,_k),Y[45]||(Y[45]=e("span",null,"不符合",-1))])])]),e("td",kk,[ue==="3-3"?(t(),s("div",$k,[P(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":Y[14]||(Y[14]=pe=>a.value.isOffline=pe),id:"isOffline",disabled:!T.value},null,8,Ck),[[Ce,a.value.isOffline]]),Y[46]||(Y[46]=e("label",{for:"isOffline",class:"cursor-pointer"},"實體課程",-1))])):P((t(),s("textarea",{key:1,class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":pe=>a.value.evidence[ue]=pe,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,Ek)),[[te,a.value.evidence[ue]]])])]))),128)),Y[53]||(Y[53]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"4、課程實施情形（實地25%/線上20%）")])])],-1)),(t(!0),s(X,null,le(L(4),ue=>(t(),s("tr",{key:ue,class:"border-b-2 border-black"},[e("td",Sk,[e("div",Dk,[e("span",null,l(a.value.questions[ue]),1)])]),e("td",Mk,[e("div",Ak,[e("div",Ik,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!0,onChange:pe=>J(ue,!0),disabled:!T.value},null,40,Rk),Y[47]||(Y[47]=e("span",null,"符合",-1))]),e("div",Pk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[ue]===!1,onChange:pe=>J(ue,!1),disabled:!T.value},null,40,Uk),Y[48]||(Y[48]=e("span",null,"不符合",-1))])])]),e("td",Nk,[ue==="4-5"?(t(),s("div",Tk,[P(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":Y[15]||(Y[15]=pe=>a.value.isOnline=pe),id:"isOnline",disabled:!T.value},null,8,Vk),[[Ce,a.value.isOnline]]),Y[49]||(Y[49]=e("label",{for:"isOnline",class:"cursor-pointer"},"線上課程",-1))])):P((t(),s("textarea",{key:1,class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":pe=>a.value.evidence[ue]=pe,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,jk)),[[te,a.value.evidence[ue]]])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Lk,[Y[59]||(Y[59]=e("div",{class:"flex items-center font-bold"},"5、查核結果摘要：",-1)),e("div",Fk,[P(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":Y[16]||(Y[16]=ue=>a.value.passCount=ue),readonly:""},null,512),[[te,a.value.passCount]]),Y[54]||(Y[54]=e("span",{class:"mr-2"},"個項目符合、",-1)),P(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":Y[17]||(Y[17]=ue=>a.value.failCount=ue),readonly:""},null,512),[[te,a.value.failCount]]),Y[55]||(Y[55]=e("span",null,"個項目不符合。",-1))]),e("div",Ok,[Y[58]||(Y[58]=e("span",{class:"font-bold mr-2"},"得分：",-1)),P(e("input",{type:"text",class:"w-16 border-b border-black text-center mr-6","onUpdate:modelValue":Y[18]||(Y[18]=ue=>a.value.totalScore=ue),readonly:""},null,512),[[te,a.value.totalScore]]),e("div",qk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.hasPass===!0,onChange:Y[19]||(Y[19]=ue=>a.value.hasPass=a.value.hasPass===!0?null:!0),disabled:!T.value},null,40,Bk),Y[56]||(Y[56]=e("span",null,"通過",-1))]),e("div",Hk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.hasPass===!1,onChange:Y[20]||(Y[20]=ue=>a.value.hasPass=a.value.hasPass===!1?null:!1),disabled:!T.value},null,40,Wk),Y[57]||(Y[57]=e("span",null,"不通過",-1))])])])])])])]),Y[70]||(Y[70]=e("div",{class:"w-full max-w-[1500px] mt-6"},[e("p",{class:"text-gray-700 mb-2"},"備註：說明原因應清楚描述，避免不確定的文字：如可能...。")],-1)),e("div",zk,[e("table",Kk,[Y[62]||(Y[62]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"border-b-2 border-black p-4 text-left font-bold",colspan:"2"}," 6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。 ")])],-1)),e("tbody",null,[e("tr",null,[Y[61]||(Y[61]=e("th",{scope:"row",class:"border-r-2 border-black p-4 w-1/4"},[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"text-center font-bold"},"改善方法"),e("div",{class:"text-center"},"(學校承辦人員)")])],-1)),e("td",Jk,[P(e("textarea",{class:"w-full h-64 border border-gray-300 p-2 outline-none resize-none","onUpdate:modelValue":Y[21]||(Y[21]=ue=>a.value.improvement=ue),placeholder:"請輸入改善方法...",readonly:!T.value},null,8,Yk),[[te,a.value.improvement]])])])])])]),e("div",Gk,[e("div",Zk,[Y[65]||(Y[65]=e("span",{class:"font-bold mr-2"},"三、追蹤調查",-1)),e("div",Qk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.needFollowUp===!1,onChange:Y[22]||(Y[22]=ue=>a.value.needFollowUp=a.value.needFollowUp===!1?null:!1),id:"needFollowUp",disabled:!T.value},null,40,Xk),Y[63]||(Y[63]=e("label",{for:"needFollowUp",class:"cursor-pointer"},"不須追蹤",-1))]),e("div",e4,[e("div",t4,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.needFollowUp===!0,onChange:Y[23]||(Y[23]=ue=>a.value.needFollowUp=a.value.needFollowUp===!0?null:!0),id:"needRecheck",disabled:!T.value},null,40,s4),Y[64]||(Y[64]=e("label",{for:"needRecheck",class:"cursor-pointer"},"需複查：",-1))]),P(e("input",{type:"text",class:"border-b border-black ml-2 p-1","onUpdate:modelValue":Y[24]||(Y[24]=ue=>a.value.recheckRemark=ue),placeholder:"請輸入複查備註...",style:{"min-width":"120px","max-width":"150px",flex:"1","word-break":"break-all","white-space":"normal"},readonly:!T.value||a.value.needFollowUp!==!0},null,8,a4),[[te,a.value.recheckRemark]])])]),Y[66]||(Y[66]=e("div",{class:"mt-2"},[e("p",null,"備註：考量改善方法實施完成的時間點，後續計畫做以下安排。"),e("p",{class:"mt-2"},"1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。"),e("p",{class:"mt-2"},"2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。")],-1))])]))}},l4=Fe(o4,[["__scopeId","data-v-2657f436"]]),n4={class:"flex flex-col items-center p-6"},r4={class:"w-full max-w-[1500px]"},i4={class:"w-full max-w-[1500px]"},d4={class:"flex items-center"},u4={class:"relative w-40 mx-4"},c4=["disabled"],p4={class:"w-full max-w-[1500px] overflow-auto"},v4={key:0,class:"flex justify-center items-center py-10"},m4={key:1},b4={class:"overflow-x-auto"},f4={class:"border-collapse",style:{"min-width":"10000px"}},y4={class:"bg-[#EEEFE7]"},g4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},x4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},h4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},w4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},_4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},k4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},$4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},C4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},E4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},S4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},D4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},M4=["onClick"],A4={class:"border p-2 text-center sticky-col left-0 bg-white",style:{"min-width":"60px"}},I4={class:"border p-2 text-center"},R4={class:"border p-2 text-center"},P4={class:"border p-2 text-center"},U4={class:"border p-2 text-center"},N4={class:"border p-2 text-center"},T4={class:"border p-2 text-center"},V4={class:"border p-2 text-center"},j4={class:"border p-2 text-center"},L4={class:"border p-2 text-center"},F4={class:"border p-2 text-center"},O4={class:"border p-2 text-center"},q4={class:"border p-2 text-center border-l-2 border-l-black"},B4={class:"bg-[#E6D7E2]"},H4={class:"border p-2 text-center border-l-2 border-l-black"},W4={class:"border p-2 text-center"},z4={class:"border p-2 text-center"},K4={class:"border p-2 text-center"},J4={class:"border p-2 text-center border-l-2 border-l-black"},Y4={class:"border p-2 text-center"},G4={class:"border p-2 text-center"},Z4={class:"border p-2 text-center"},Q4={class:"border p-2 text-center"},X4={class:"border p-2 text-center border-l-2 border-l-black"},e$={class:"border p-2 text-center"},t$={class:"border p-2 text-center"},s$={class:"border p-2 text-center"},a$={class:"border p-2 text-center border-l-2 border-l-black"},o$={class:"border p-2 text-center"},l$={class:"border p-2 text-center"},n$={class:"border p-2 text-center"},r$={class:"border p-2 text-center"},i$={class:"border p-2 text-center"},d$={class:"border p-2 text-center"},u$={class:"border p-2 text-center"},c$={class:"border p-2 text-center"},p$={class:"border p-2 text-center"},v$={class:"border p-2 text-center"},m$={class:"border p-2 text-center border-l-2 border-l-black"},b$={class:"border p-2 text-center"},f$={class:"border p-2 text-center"},y$={class:"border p-2 text-center"},g$={class:"border p-2 text-center border-l-2 border-l-black"},x$={class:"border p-2 text-center"},h$={class:"border p-2 text-center"},w$={class:"border p-2 text-center"},_$={class:"border p-2 text-center"},k$={class:"border p-2 text-center border-l-2 border-l-black"},$$={class:"border p-2 text-center"},C$={class:"border p-2 text-center"},E$={class:"border p-2 text-center"},S$={class:"border p-2 text-center border-l-2 border-l-black"},D$={class:"border p-2 text-center"},M$={class:"border p-2 text-center"},A$={class:"border p-2 text-center"},I$={class:"border p-2 text-center border-l-2 border-l-black"},R$={class:"border p-2 text-center"},P$={class:"border p-2 text-center"},U$={class:"border p-2 text-center"},N$={class:"border p-2 text-center"},T$={class:"border p-2 text-center"},V$={class:"border p-2 text-center"},j$={class:"border p-2 text-center border-l-2 border-l-black"},L$={class:"border p-2 text-center"},F$={class:"border p-2 text-center"},O$={class:"border p-2 text-center border-l-2 border-l-black"},q$={class:"border p-2 text-center"},B$={class:"border p-2 text-center"},H$={class:"border p-2 text-center"},W$={class:"border p-2 text-center"},z$={class:"border p-2 text-center"},K$={class:"border p-2 text-center"},J$={class:"border p-2 text-center"},Y$={class:"bg-[#F7F7F7]"},G$={class:"border p-2 text-center border-l-2 border-l-black"},Z$={class:"border p-2 text-center"},Q$={class:"border p-2 text-center"},X$={class:"border p-2 text-center"},e5={class:"border p-2 text-center border-l-2 border-l-black"},t5={class:"border p-2 text-center"},s5={class:"border p-2 text-center"},a5={class:"border p-2 text-center"},o5={class:"border p-2 text-center"},l5={class:"border p-2 text-center border-l-2 border-l-black"},n5={class:"border p-2 text-center"},r5={class:"border p-2 text-center"},i5={class:"border p-2 text-center"},d5={class:"border p-2 text-center border-l-2 border-l-black"},u5={class:"border p-2 text-center"},c5={class:"border p-2 text-center"},p5={class:"border p-2 text-center"},v5={class:"border p-2 text-center"},m5={class:"border p-2 text-center"},b5={class:"border p-2 text-center"},f5={class:"border p-2 text-center"},y5={class:"border p-2 text-center"},g5={class:"border p-2 text-center"},x5={class:"border p-2 text-center"},h5={class:"border p-2 text-center border-l-2 border-l-black"},w5={class:"border p-2 text-center"},_5={class:"border p-2 text-center"},k5={class:"border p-2 text-center"},$5={class:"border p-2 text-center border-l-2 border-l-black"},C5={class:"border p-2 text-center"},E5={class:"border p-2 text-center"},S5={class:"border p-2 text-center"},D5={class:"border p-2 text-center"},M5={class:"border p-2 text-center border-l-2 border-l-black"},A5={class:"border p-2 text-center"},I5={class:"border p-2 text-center"},R5={class:"border p-2 text-center"},P5={class:"border p-2 text-center border-l-2 border-l-black"},U5={class:"border p-2 text-center"},N5={class:"border p-2 text-center"},T5={class:"border p-2 text-center"},V5={class:"border p-2 text-center border-l-2 border-l-black"},j5={class:"border p-2 text-center"},L5={class:"border p-2 text-center"},F5={class:"border p-2 text-center"},O5={class:"border p-2 text-center"},q5={class:"border p-2 text-center"},B5={class:"border p-2 text-center"},H5={class:"border p-2 text-center border-l-2 border-l-black"},W5={class:"border p-2 text-center"},z5={class:"border p-2 text-center"},K5={class:"border p-2 text-center border-l-2 border-l-black"},J5={class:"border p-2 text-center"},Y5={class:"border p-2 text-center"},G5={class:"border p-2 text-center"},Z5={class:"border p-2 text-center"},Q5={class:"border p-2 text-center"},X5={class:"border p-2 text-center"},e3={class:"border p-2 text-center"},t3={class:"bg-[#E6D7E2]"},s3={class:"border p-2 text-center border-l-2 border-l-black"},a3={class:"border p-2 text-center"},o3={class:"border p-2 text-center"},l3={class:"border p-2 text-center"},n3={class:"border p-2 text-center border-l-2 border-l-black"},r3={class:"border p-2 text-center"},i3={class:"border p-2 text-center"},d3={class:"border p-2 text-center"},u3={class:"border p-2 text-center"},c3={class:"border p-2 text-center border-l-2 border-l-black"},p3={class:"border p-2 text-center"},v3={class:"border p-2 text-center"},m3={class:"border p-2 text-center"},b3={class:"border p-2 text-center border-l-2 border-l-black"},f3={class:"border p-2 text-center"},y3={class:"border p-2 text-center"},g3={class:"border p-2 text-center"},x3={class:"border p-2 text-center"},h3={class:"border p-2 text-center"},w3={class:"border p-2 text-center"},_3={class:"border p-2 text-center"},k3={class:"border p-2 text-center"},$3={class:"border p-2 text-center"},C3={class:"border p-2 text-center"},E3={class:"border p-2 text-center border-l-2 border-l-black"},S3={class:"border p-2 text-center"},D3={class:"border p-2 text-center"},M3={class:"border p-2 text-center"},A3={class:"border p-2 text-center border-l-2 border-l-black"},I3={class:"border p-2 text-center"},R3={class:"border p-2 text-center"},P3={class:"border p-2 text-center"},U3={class:"border p-2 text-center"},N3={class:"border p-2 text-center border-l-2 border-l-black"},T3={class:"border p-2 text-center"},V3={class:"border p-2 text-center"},j3={class:"border p-2 text-center"},L3={class:"border p-2 text-center border-l-2 border-l-black"},F3={class:"border p-2 text-center"},O3={class:"border p-2 text-center"},q3={class:"border p-2 text-center"},B3={class:"border p-2 text-center border-l-2 border-l-black"},H3={class:"border p-2 text-center"},W3={class:"border p-2 text-center"},z3={class:"border p-2 text-center"},K3={class:"border p-2 text-center"},J3={class:"border p-2 text-center"},Y3={class:"border p-2 text-center"},G3={class:"border p-2 text-center border-l-2 border-l-black"},Z3={class:"border p-2 text-center"},Q3={class:"border p-2 text-center"},X3={class:"border p-2 text-center border-l-2 border-l-black"},eC={class:"border p-2 text-center"},tC={class:"border p-2 text-center"},sC={class:"border p-2 text-center"},aC={class:"border p-2 text-center"},oC={class:"border p-2 text-center"},lC={class:"border p-2 text-center"},nC={class:"border p-2 text-center"},rC={key:2,class:"flex justify-center items-center space-x-2 mt-6"},iC=["disabled"],dC=["disabled","onClick"],uC={key:1,class:"px-2"},cC=["disabled"],pC={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},vC={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},mC={class:"mb-4"},bC={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},fC={class:"mb-2"},yC={key:0,class:"text-red-500 text-sm mt-2"},gC={class:"flex justify-end space-x-2"},xC=["disabled"],hC=["disabled"],Ws=20,wC={__name:"CreditList",setup(M){const h=We(),d=rt(),u=m(""),C=m(""),o=m("asc"),N=m(1),K=m(1),E=m(0),U=m(!1),T=m([]),z=m({}),g=m({}),a=m({}),R=m({creditCertificationImport:!1,creditCertificationCreate:!1}),Z=O=>O==="-1"||O===-1||O===null?"缺":O,$=m(!1),c=()=>{$.value=!$.value},y=O=>O==="-1"||O===-1||O===null?"缺":$.value?O:Math.round(O/18*10)/10,r=O=>Z(O),b=Se(()=>{const O=[];if(K.value<=5)for(let J=1;J<=K.value;J++)O.push(J);else{O.push(1);let J=Math.max(2,N.value-1),Q=Math.min(K.value-1,N.value+1);N.value<=3&&(Q=Math.min(4,K.value-1)),N.value>=K.value-2&&(J=Math.max(2,K.value-3)),J>2&&O.push("...");for(let Y=J;Y<=Q;Y++)O.push(Y);Q<K.value-1&&O.push("..."),O.push(K.value)}return O}),p=async()=>{try{U.value=!0;const O={page:N.value,limit:Ws,keyword:u.value.trim()||void 0};console.log("獲取學分申請列表參數:",O);const A=await Lt.getCreditList(O);A.data&&A.data.code===0?(T.value=A.data.data.list,E.value=A.data.data.totalCount,K.value=A.data.data.totalPage||Math.ceil(E.value/Ws),z.value=A.data.data.totalCreditHours||{},g.value=A.data.data.totalCourseHours||{},a.value=A.data.data.totalCombinedHours||{}):(console.error("獲取學分申請列表失敗:",A.data.message),v.showError("載入失敗",A.data.message||"獲取學分申請列表失敗"),T.value=[],E.value=0,K.value=1)}catch(O){console.error("獲取學分申請列表錯誤:",O),v.showError("載入失敗","獲取學分申請列表錯誤，請稍後再試"),T.value=[],E.value=0,K.value=1}finally{U.value=!1}},_=O=>{O!==N.value&&!U.value&&(N.value=O)},f=()=>{N.value>1&&!U.value&&N.value--},V=()=>{N.value<K.value&&!U.value&&N.value++},W=()=>{U.value||(N.value=1,p())};Ee(N,()=>{p()});const H=()=>{d.query.page&&(N.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.sortBy&&(C.value=d.query.sortBy),d.query.sortOrder&&(o.value=d.query.sortOrder)};je(()=>{H(),p(),ae()});const k=()=>{u.value=""},D=()=>{h.push({name:"Credits"})},j=O=>{if(O){const A={from:"credit-list",page:N.value,searchKeyword:u.value||void 0};h.push({name:"Single",params:{id:O},query:A})}},S=m(!1),x=m(null),L=m(""),de=m(!1),xe=m(null),fe=()=>{S.value=!0,L.value="",x.value=null,ws(()=>{xe.value&&(xe.value.value=null)})},ke=()=>{S.value=!1,x.value=null,L.value=""},De=()=>{xe.value.click()},we=O=>{const A=O.target.files[0];if(A){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(A.type)&&!A.name.endsWith(".xlsx")&&!A.name.endsWith(".xls")&&!A.name.endsWith(".csv")){L.value="請選擇 Excel 或 CSV 檔案",x.value=null,O.target.value=null;return}if(A.size>10*1024*1024){L.value="檔案大小不能超過 10MB",x.value=null,O.target.value=null;return}x.value=A,L.value=""}},$e=async()=>{var O,A,J;if(!x.value){L.value="請選擇要上傳的檔案";return}try{de.value=!0,L.value="";const Q=new FormData;Q.append("file",x.value);const Y=await Lt.importCreditCertification(Q);Y.data&&Y.data.code===0?(v.showSuccess("上傳成功","學分認列資料已成功匯入"),ke(),p()):(L.value=((O=Y.data)==null?void 0:O.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",L.value))}catch(Q){console.error("上傳學分認列檔案錯誤:",Q),L.value=((J=(A=Q.response)==null?void 0:A.data)==null?void 0:J.message)||"上傳過程中發生錯誤，請稍後再試",v.showError("上傳失敗",L.value)}finally{de.value=!1}},ae=async()=>{try{const O=await ot.getSidebarPermissions();O.data.code===0&&O.data.message==="success"?(R.value=O.data.data,console.log("學分認列頁面權限:",R.value)):console.error("獲取權限失敗:",O.data.message)}catch(O){console.error("獲取權限錯誤:",O)}};return(O,A)=>(t(),s("div",n4,[e("div",r4,[Ge(ft,{breadcrumbs:[{name:"認列清單",path:"/credit-list"}]})]),e("div",i4,[e("div",d4,[A[2]||(A[2]=e("span",null,"查詢學員:",-1)),e("div",u4,[P(e("input",{type:"text","onUpdate:modelValue":A[0]||(A[0]=J=>u.value=J),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名、身分證字號",onKeyup:Ue(W,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:k,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},A[1]||(A[1]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:U.value},l(U.value?"搜尋中...":"搜尋"),9,c4),A[3]||(A[3]=e("div",{class:"flex-grow"},null,-1)),e("button",{class:"px-4 py-2 bg-[#4e9875] hover:bg-[#3e7a5c] text-white mr-2",onClick:c}," 切換為"+l($.value?"學分":"時數"),1),R.value.creditCertificationImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d] mr-2",onClick:fe}," 匯入學分認列 ")):G("",!0),R.value.creditCertificationCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:D}," 新增學分認列 ")):G("",!0)])]),A[111]||(A[111]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",p4,[U.value?(t(),s("div",v4,A[4]||(A[4]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",m4,[e("div",b4,[e("table",f4,[e("thead",null,[A[67]||(A[67]=e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 sticky-col left-0 bg-[#EEEFE7]",colspan:"2",scope:"colgroup"},"學員資料"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資通安全概論"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"6",scope:"colgroup"},"資料庫應用"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資料結構"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"12",scope:"colgroup"},"資訊管理"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資通網路與安全"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"6",scope:"colgroup"},"資通網路與安全概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"計算機概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"程式設計概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"8",scope:"colgroup"},"資通安全管理"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"4",scope:"colgroup"},"資通安全法令與規範"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"9",scope:"colgroup"},"資通安全防護技術"),e("th",{class:"border p-2",colspan:"2",scope:"colgroup"},"備註")],-1)),e("tr",y4,[A[5]||(A[5]=e("th",{class:"sticky-col left-0 border p-2 bg-[#EEEFE7]",scope:"col"},"序號",-1)),A[6]||(A[6]=e("th",{class:"sticky-col left-60 border p-2 bg-[#EEEFE7]",scope:"col"},"姓名",-1)),A[7]||(A[7]=e("th",{class:"border p-2 border-l-2 border-l-black text-blue-500",scope:"col"},"資通安全概論",-1)),A[8]||(A[8]=e("th",{class:"border p-2",scope:"col"},"資料加密與保全",-1)),A[9]||(A[9]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"網路安全監控與分析",-1)),A[10]||(A[10]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"通訊與網路安全",-1)),e("th",g4,"小計"+l($.value?"時數":"學分"),1),A[11]||(A[11]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資料庫應用",-1)),A[12]||(A[12]=e("th",{class:"border p-2",scope:"col"},"資料庫架構規劃",-1)),A[13]||(A[13]=e("th",{class:"border p-2",scope:"col"},"資料庫管理",-1)),A[14]||(A[14]=e("th",{class:"border p-2",scope:"col"},"資料庫系統",-1)),A[15]||(A[15]=e("th",{class:"border p-2",scope:"col"},"資料庫與資料管理",-1)),e("th",x4,"小計"+l($.value?"時數":"學分"),1),A[16]||(A[16]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資料結構",-1)),A[17]||(A[17]=e("th",{class:"border p-2",scope:"col"},"編譯器設計",-1)),A[18]||(A[18]=e("th",{class:"border p-2",scope:"col"},"人工智慧理論與應用",-1)),A[19]||(A[19]=e("th",{class:"border p-2",scope:"col"},"人工智慧",-1)),e("th",h4,"小計"+l($.value?"時數":"學分"),1),A[20]||(A[20]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資訊管理",-1)),A[21]||(A[21]=e("th",{class:"border p-2",scope:"col"},"決策分析支援",-1)),A[22]||(A[22]=e("th",{class:"border p-2",scope:"col"},"資訊職能培力",-1)),A[23]||(A[23]=e("th",{class:"border p-2",scope:"col"},"系統分析",-1)),A[24]||(A[24]=e("th",{class:"border p-2",scope:"col"},"多媒體互動界面設計",-1)),A[25]||(A[25]=e("th",{class:"border p-2",scope:"col"},"服務介面設計",-1)),A[26]||(A[26]=e("th",{class:"border p-2",scope:"col"},"系統設計",-1)),A[27]||(A[27]=e("th",{class:"border p-2",scope:"col"},"軟體工程",-1)),A[28]||(A[28]=e("th",{class:"border p-2",scope:"col"},"人機介面",-1)),A[29]||(A[29]=e("th",{class:"border p-2",scope:"col"},"系統分析與設計",-1)),A[30]||(A[30]=e("th",{class:"border p-2",scope:"col"},"資訊應用概論",-1)),e("th",w4,"小計"+l($.value?"時數":"學分"),1),A[31]||(A[31]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通網路與安全",-1)),A[32]||(A[32]=e("th",{class:"border p-2",scope:"col"},"網路安全",-1)),A[33]||(A[33]=e("th",{class:"border p-2",scope:"col"},"電腦網路規劃與管理",-1)),A[34]||(A[34]=e("th",{class:"border p-2",scope:"col"},"資訊與網路應用政策",-1)),e("th",_4,"小計"+l($.value?"時數":"學分"),1),A[35]||(A[35]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通網路與安全概要",-1)),A[36]||(A[36]=e("th",{class:"border p-2",scope:"col"},"資訊與網路之技術標準與規範",-1)),A[37]||(A[37]=e("th",{class:"border p-2",scope:"col"},"通信與網路架構",-1)),A[38]||(A[38]=e("th",{class:"border p-2",scope:"col"},"資訊安全防護技術",-1)),A[39]||(A[39]=e("th",{class:"border p-2",scope:"col"},"資訊安全理論與實務",-1)),e("th",k4,"小計"+l($.value?"時數":"學分"),1),A[40]||(A[40]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"計算機概要",-1)),A[41]||(A[41]=e("th",{class:"border p-2",scope:"col"},"多媒體系統",-1)),A[42]||(A[42]=e("th",{class:"border p-2",scope:"col"},"作業系統",-1)),A[43]||(A[43]=e("th",{class:"border p-2",scope:"col"},"電子計算機概論",-1)),e("th",$4,"小計"+l($.value?"時數":"學分"),1),A[44]||(A[44]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"程式設計概要",-1)),A[45]||(A[45]=e("th",{class:"border p-2",scope:"col"},"程式語言",-1)),A[46]||(A[46]=e("th",{class:"border p-2",scope:"col"},"程式設計",-1)),A[47]||(A[47]=e("th",{class:"border p-2",scope:"col"},"機器學習",-1)),e("th",C4,"小計"+l($.value?"時數":"學分"),1),A[48]||(A[48]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全管理",-1)),A[49]||(A[49]=e("th",{class:"border p-2",scope:"col"},"資通安全政策",-1)),A[50]||(A[50]=e("th",{class:"border p-2",scope:"col"},"安全系統開發",-1)),A[51]||(A[51]=e("th",{class:"border p-2",scope:"col"},"資通安全風險與事故管理",-1)),A[52]||(A[52]=e("th",{class:"border p-2",scope:"col"},"資通系統稽核",-1)),A[53]||(A[53]=e("th",{class:"border p-2",scope:"col"},"效率查核",-1)),A[54]||(A[54]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"業務持續運作管理",-1)),e("th",E4,"小計"+l($.value?"時數":"學分"),1),A[55]||(A[55]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全法令與規範",-1)),A[56]||(A[56]=e("th",{class:"border p-2",scope:"col"},"情資分析與分享",-1)),A[57]||(A[57]=e("th",{class:"border p-2",scope:"col"},"資安事件通報應變",-1)),e("th",S4,"小計"+l($.value?"時數":"學分"),1),A[58]||(A[58]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全防護技術",-1)),A[59]||(A[59]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"惡意程式檢測",-1)),A[60]||(A[60]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"數位鑑識與處理",-1)),A[61]||(A[61]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"Web應用程式安全",-1)),A[62]||(A[62]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"系統及網站滲透測試",-1)),A[63]||(A[63]=e("th",{class:"border p-2",scope:"col"},"安全性檢測",-1)),A[64]||(A[64]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"網路架構與部署安全",-1)),A[65]||(A[65]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"弱點掃描與入侵偵測",-1)),e("th",D4,"小計"+l($.value?"時數":"學分"),1),A[66]||(A[66]=e("th",{class:"border p-2",scope:"col"},"不符合認列標準的科目",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(T.value,(J,Q)=>(t(),s("tr",{key:J.id,onClick:Y=>j(J.id),class:"cursor-pointer"},[e("td",A4,l(Q+1),1),e("td",{class:ee(["border p-2 text-center sticky-col left-60 bg-white",{"warning-bg":J.isWarning}]),style:{"min-width":"100px"}},l(J.studentName),3),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isCyberSecurityOverviewWarning}])},l(y(J.cyberSecurityOverview)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDataEncryptionWarning}])},l(y(J.dataEncryption)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityMonitoringWarning}])},l(y(J.securityMonitoring)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isNetworkCommunicationSecurityWarning}])},l(y(J.networkCommunicationSecurity)),3),e("td",I4,l(y(J.cyberSecurityOverviewTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isDatabaseApplicationWarning}])},l(y(J.databaseApplication)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDatabaseStructurePlanningWarning}])},l(y(J.databaseStructurePlanning)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDatabaseManagementWarning}])},l(y(J.databaseManagement)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDatabaseSystemsWarning}])},l(y(J.databaseSystems)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDatabaseAndDataManagementWarning}])},l(y(J.databaseAndDataManagement)),3),e("td",R4,l(y(J.dbApplicationTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isDataStructureWarning}])},l(y(J.dataStructure)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isCompilerDesignWarning}])},l(y(J.compilerDesign)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isAITheoryAndApplicationWarning}])},l(y(J.aiTheoryAndApplication)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isArtificialIntelligenceWarning}])},l(y(J.artificialIntelligence)),3),e("td",P4,l(y(J.dataStructTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isInformationManagementWarning}])},l(y(J.informationManagement)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDecisionSupportWarning}])},l(y(J.decisionSupport)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isITCompetencyDevelopmentWarning}])},l(y(J.itCompetencyDevelopment)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSystemAnalysisWarning}])},l(y(J.systemAnalysis)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isMultimediaInterfaceDesignWarning}])},l(y(J.multimediaInterfaceDesign)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isServiceInterfaceDesignWarning}])},l(y(J.serviceInterfaceDesign)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSystemDesignWarning}])},l(y(J.systemDesign)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSoftwareEngineeringWarning}])},l(y(J.softwareEngineering)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isHumanComputerInterfaceWarning}])},l(y(J.humanComputerInterface)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSystemAnalysisAndDesignWarning}])},l(y(J.systemAnalysisAndDesign)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isIntroToITApplicationsWarning}])},l(y(J.introToITApplications)),3),e("td",U4,l(y(J.infoManageTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isICTAndSecurityWarning}])},l(y(J.ictAndSecurity)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isNetworkSecurityWarning}])},l(y(J.networkSecurity)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isNetworkPlanningAndManagementWarning}])},l(y(J.networkPlanningAndManagement)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isITPolicyWarning}])},l(y(J.itPolicy)),3),e("td",N4,l(y(J.ictAndSecurityTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isICTOverviewWarning}])},l(y(J.ictOverview)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isTechnicalStandardsWarning}])},l(y(J.technicalStandards)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isNetworkArchitectureWarning}])},l(y(J.networkArchitecture)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityProtectionTechnologyWarning}])},l(y(J.securityProtectionTechnology)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityTheoryAndPracticeWarning}])},l(y(J.securityTheoryAndPractice)),3),e("td",T4,l(y(J.ictSecurityOverviewTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isComputerOverviewWarning}])},l(y(J.computerOverview)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isMultimediaSystemsWarning}])},l(y(J.multimediaSystems)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isOperatingSystemsWarning}])},l(y(J.operatingSystems)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isIntroToComputersWarning}])},l(y(J.introToComputers)),3),e("td",V4,l(y(J.computerOverviewTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isProgrammingOverviewWarning}])},l(y(J.programmingOverview)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isProgrammingLanguageWarning}])},l(y(J.programmingLanguage)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isProgrammingWarning}])},l(y(J.programming)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isMachineLearningWarning}])},l(y(J.machineLearning)),3),e("td",j4,l(y(J.programmingTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isSecurityManagementWarning}])},l(y(J.securityManagement)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityPolicyWarning}])},l(y(J.securityPolicy)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecureSystemDevelopmentWarning}])},l(y(J.secureSystemDevelopment)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityRiskManagementWarning}])},l(y(J.securityRiskManagement)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSystemAuditWarning}])},l(y(J.systemAudit)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isEfficiencyAuditWarning}])},l(y(J.efficiencyAudit)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isBusinessContinuityWarning}])},l(y(J.businessContinuity)),3),e("td",L4,l(y(J.securityManagementTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isSecurityLawsWarning}])},l(y(J.securityLaws)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isIntelligenceSharingWarning}])},l(y(J.intelligenceSharing)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isIncidentResponseWarning}])},l(y(J.incidentResponse)),3),e("td",F4,l(y(J.securityLawsAndRegulationsTotalHours)),1),e("td",{class:ee(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":J.isSecurityProtectionWarning}])},l(y(J.securityProtection)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isMalwareDetectionWarning}])},l(y(J.malwareDetection)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isDigitalForensicsWarning}])},l(y(J.digitalForensics)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isWebSecurityWarning}])},l(y(J.webSecurity)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isPenetrationTestingWarning}])},l(y(J.penetrationTesting)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isSecurityTestingWarning}])},l(y(J.securityTesting)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isNetworkDeploymentSecurityWarning}])},l(y(J.networkDeploymentSecurity)),3),e("td",{class:ee(["border p-2 text-center",{"warning-bg":J.isVulnerabilityDetectionWarning}])},l(y(J.vulnerabilityDetection)),3),e("td",O4,l(y(J.securityProtectionTechnologyTotalHours)),1),e("td",q4,l(J.remark||"-"),1)],8,M4))),128))]),e("tfoot",null,[e("tr",B4,[A[68]||(A[68]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#E6D7E2]"},"認列",-1)),A[69]||(A[69]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#E6D7E2]"},null,-1)),e("td",H4,l(r(z.value.cyberSecurityOverview)),1),e("td",W4,l(r(z.value.dataEncryption)),1),e("td",z4,l(r(z.value.securityMonitoring)),1),e("td",K4,l(r(z.value.networkCommunicationSecurity)),1),A[70]||(A[70]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",J4,l(r(z.value.databaseApplication)),1),e("td",Y4,l(r(z.value.databaseStructurePlanning)),1),e("td",G4,l(r(z.value.databaseManagement)),1),e("td",Z4,l(r(z.value.databaseSystems)),1),e("td",Q4,l(r(z.value.databaseAndDataManagement)),1),A[71]||(A[71]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",X4,l(r(z.value.dataStructure)),1),e("td",e$,l(r(z.value.compilerDesign)),1),e("td",t$,l(r(z.value.aiTheoryAndApplication)),1),e("td",s$,l(r(z.value.artificialIntelligence)),1),A[72]||(A[72]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",a$,l(r(z.value.informationManagement)),1),e("td",o$,l(r(z.value.decisionSupport)),1),e("td",l$,l(r(z.value.itCompetencyDevelopment)),1),e("td",n$,l(r(z.value.systemAnalysis)),1),e("td",r$,l(r(z.value.multimediaInterfaceDesign)),1),e("td",i$,l(r(z.value.serviceInterfaceDesign)),1),e("td",d$,l(r(z.value.systemDesign)),1),e("td",u$,l(r(z.value.softwareEngineering)),1),e("td",c$,l(r(z.value.humanComputerInterface)),1),e("td",p$,l(r(z.value.systemAnalysisAndDesign)),1),e("td",v$,l(r(z.value.introToITApplications)),1),A[73]||(A[73]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",m$,l(r(z.value.ictAndSecurity)),1),e("td",b$,l(r(z.value.networkSecurity)),1),e("td",f$,l(r(z.value.networkPlanningAndManagement)),1),e("td",y$,l(r(z.value.itPolicy)),1),A[74]||(A[74]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",g$,l(r(z.value.ictOverview)),1),e("td",x$,l(r(z.value.technicalStandards)),1),e("td",h$,l(r(z.value.networkArchitecture)),1),e("td",w$,l(r(z.value.securityProtectionTechnology)),1),e("td",_$,l(r(z.value.securityTheoryAndPractice)),1),A[75]||(A[75]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",k$,l(r(z.value.computerOverview)),1),e("td",$$,l(r(z.value.multimediaSystems)),1),e("td",C$,l(r(z.value.operatingSystems)),1),e("td",E$,l(r(z.value.introToComputers)),1),A[76]||(A[76]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",S$,l(r(z.value.programmingOverview)),1),e("td",D$,l(r(z.value.programmingLanguage)),1),e("td",M$,l(r(z.value.programming)),1),e("td",A$,l(r(z.value.machineLearning)),1),A[77]||(A[77]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",I$,l(r(z.value.securityManagement)),1),e("td",R$,l(r(z.value.securityPolicy)),1),e("td",P$,l(r(z.value.secureSystemDevelopment)),1),e("td",U$,l(r(z.value.securityRiskManagement)),1),e("td",N$,l(r(z.value.systemAudit)),1),e("td",T$,l(r(z.value.efficiencyAudit)),1),e("td",V$,l(r(z.value.businessContinuity)),1),A[78]||(A[78]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",j$,l(r(z.value.securityLaws)),1),e("td",L$,l(r(z.value.intelligenceSharing)),1),e("td",F$,l(r(z.value.incidentResponse)),1),A[79]||(A[79]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",O$,l(r(z.value.securityProtection)),1),e("td",q$,l(r(z.value.malwareDetection)),1),e("td",B$,l(r(z.value.digitalForensics)),1),e("td",H$,l(r(z.value.webSecurity)),1),e("td",W$,l(r(z.value.penetrationTesting)),1),e("td",z$,l(r(z.value.securityTesting)),1),e("td",K$,l(r(z.value.networkDeploymentSecurity)),1),e("td",J$,l(r(z.value.vulnerabilityDetection)),1),A[80]||(A[80]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),A[81]||(A[81]=e("td",{class:"border p-2 text-center"},null,-1))]),e("tr",Y$,[A[82]||(A[82]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#F7F7F7]"},"修課",-1)),A[83]||(A[83]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#F7F7F7]"},null,-1)),e("td",G$,l(r(g.value.cyberSecurityOverview)),1),e("td",Z$,l(r(g.value.dataEncryption)),1),e("td",Q$,l(r(g.value.securityMonitoring)),1),e("td",X$,l(r(g.value.networkCommunicationSecurity)),1),A[84]||(A[84]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",e5,l(r(g.value.databaseApplication)),1),e("td",t5,l(r(g.value.databaseStructurePlanning)),1),e("td",s5,l(r(g.value.databaseManagement)),1),e("td",a5,l(r(g.value.databaseSystems)),1),e("td",o5,l(r(g.value.databaseAndDataManagement)),1),A[85]||(A[85]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",l5,l(r(g.value.dataStructure)),1),e("td",n5,l(r(g.value.compilerDesign)),1),e("td",r5,l(r(g.value.aiTheoryAndApplication)),1),e("td",i5,l(r(g.value.artificialIntelligence)),1),A[86]||(A[86]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",d5,l(r(g.value.informationManagement)),1),e("td",u5,l(r(g.value.decisionSupport)),1),e("td",c5,l(r(g.value.itCompetencyDevelopment)),1),e("td",p5,l(r(g.value.systemAnalysis)),1),e("td",v5,l(r(g.value.multimediaInterfaceDesign)),1),e("td",m5,l(r(g.value.serviceInterfaceDesign)),1),e("td",b5,l(r(g.value.systemDesign)),1),e("td",f5,l(r(g.value.softwareEngineering)),1),e("td",y5,l(r(g.value.humanComputerInterface)),1),e("td",g5,l(r(g.value.systemAnalysisAndDesign)),1),e("td",x5,l(r(g.value.introToITApplications)),1),A[87]||(A[87]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",h5,l(r(g.value.ictAndSecurity)),1),e("td",w5,l(r(g.value.networkSecurity)),1),e("td",_5,l(r(g.value.networkPlanningAndManagement)),1),e("td",k5,l(r(g.value.itPolicy)),1),A[88]||(A[88]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",$5,l(r(g.value.ictOverview)),1),e("td",C5,l(r(g.value.technicalStandards)),1),e("td",E5,l(r(g.value.networkArchitecture)),1),e("td",S5,l(r(g.value.securityProtectionTechnology)),1),e("td",D5,l(r(g.value.securityTheoryAndPractice)),1),A[89]||(A[89]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",M5,l(r(g.value.computerOverview)),1),e("td",A5,l(r(g.value.multimediaSystems)),1),e("td",I5,l(r(g.value.operatingSystems)),1),e("td",R5,l(r(g.value.introToComputers)),1),A[90]||(A[90]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",P5,l(r(g.value.programmingOverview)),1),e("td",U5,l(r(g.value.programmingLanguage)),1),e("td",N5,l(r(g.value.programming)),1),e("td",T5,l(r(g.value.machineLearning)),1),A[91]||(A[91]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",V5,l(r(g.value.securityManagement)),1),e("td",j5,l(r(g.value.securityPolicy)),1),e("td",L5,l(r(g.value.secureSystemDevelopment)),1),e("td",F5,l(r(g.value.securityRiskManagement)),1),e("td",O5,l(r(g.value.systemAudit)),1),e("td",q5,l(r(g.value.efficiencyAudit)),1),e("td",B5,l(r(g.value.businessContinuity)),1),A[92]||(A[92]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",H5,l(r(g.value.securityLaws)),1),e("td",W5,l(r(g.value.intelligenceSharing)),1),e("td",z5,l(r(g.value.incidentResponse)),1),A[93]||(A[93]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",K5,l(r(g.value.securityProtection)),1),e("td",J5,l(r(g.value.malwareDetection)),1),e("td",Y5,l(r(g.value.digitalForensics)),1),e("td",G5,l(r(g.value.webSecurity)),1),e("td",Z5,l(r(g.value.penetrationTesting)),1),e("td",Q5,l(r(g.value.securityTesting)),1),e("td",X5,l(r(g.value.networkDeploymentSecurity)),1),e("td",e3,l(r(g.value.vulnerabilityDetection)),1),A[94]||(A[94]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),A[95]||(A[95]=e("td",{class:"border p-2 text-center"},null,-1))]),e("tr",t3,[A[96]||(A[96]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#E6D7E2]"},"加總",-1)),A[97]||(A[97]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#E6D7E2]"},null,-1)),e("td",s3,l(r(a.value.cyberSecurityOverview)),1),e("td",a3,l(r(a.value.dataEncryption)),1),e("td",o3,l(r(a.value.securityMonitoring)),1),e("td",l3,l(r(a.value.networkCommunicationSecurity)),1),A[98]||(A[98]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",n3,l(r(a.value.databaseApplication)),1),e("td",r3,l(r(a.value.databaseStructurePlanning)),1),e("td",i3,l(r(a.value.databaseManagement)),1),e("td",d3,l(r(a.value.databaseSystems)),1),e("td",u3,l(r(a.value.databaseAndDataManagement)),1),A[99]||(A[99]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",c3,l(r(a.value.dataStructure)),1),e("td",p3,l(r(a.value.compilerDesign)),1),e("td",v3,l(r(a.value.aiTheoryAndApplication)),1),e("td",m3,l(r(a.value.artificialIntelligence)),1),A[100]||(A[100]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",b3,l(r(a.value.informationManagement)),1),e("td",f3,l(r(a.value.decisionSupport)),1),e("td",y3,l(r(a.value.itCompetencyDevelopment)),1),e("td",g3,l(r(a.value.systemAnalysis)),1),e("td",x3,l(r(a.value.multimediaInterfaceDesign)),1),e("td",h3,l(r(a.value.serviceInterfaceDesign)),1),e("td",w3,l(r(a.value.systemDesign)),1),e("td",_3,l(r(a.value.softwareEngineering)),1),e("td",k3,l(r(a.value.humanComputerInterface)),1),e("td",$3,l(r(a.value.systemAnalysisAndDesign)),1),e("td",C3,l(r(a.value.introToITApplications)),1),A[101]||(A[101]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",E3,l(r(a.value.ictAndSecurity)),1),e("td",S3,l(r(a.value.networkSecurity)),1),e("td",D3,l(r(a.value.networkPlanningAndManagement)),1),e("td",M3,l(r(a.value.itPolicy)),1),A[102]||(A[102]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",A3,l(r(a.value.ictOverview)),1),e("td",I3,l(r(a.value.technicalStandards)),1),e("td",R3,l(r(a.value.networkArchitecture)),1),e("td",P3,l(r(a.value.securityProtectionTechnology)),1),e("td",U3,l(r(a.value.securityTheoryAndPractice)),1),A[103]||(A[103]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",N3,l(r(a.value.computerOverview)),1),e("td",T3,l(r(a.value.multimediaSystems)),1),e("td",V3,l(r(a.value.operatingSystems)),1),e("td",j3,l(r(a.value.introToComputers)),1),A[104]||(A[104]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",L3,l(r(a.value.programmingOverview)),1),e("td",F3,l(r(a.value.programmingLanguage)),1),e("td",O3,l(r(a.value.programming)),1),e("td",q3,l(r(a.value.machineLearning)),1),A[105]||(A[105]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",B3,l(r(a.value.securityManagement)),1),e("td",H3,l(r(a.value.securityPolicy)),1),e("td",W3,l(r(a.value.secureSystemDevelopment)),1),e("td",z3,l(r(a.value.securityRiskManagement)),1),e("td",K3,l(r(a.value.systemAudit)),1),e("td",J3,l(r(a.value.efficiencyAudit)),1),e("td",Y3,l(r(a.value.businessContinuity)),1),A[106]||(A[106]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",G3,l(r(a.value.securityLaws)),1),e("td",Z3,l(r(a.value.intelligenceSharing)),1),e("td",Q3,l(r(a.value.incidentResponse)),1),A[107]||(A[107]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",X3,l(r(a.value.securityProtection)),1),e("td",eC,l(r(a.value.malwareDetection)),1),e("td",tC,l(r(a.value.digitalForensics)),1),e("td",sC,l(r(a.value.webSecurity)),1),e("td",aC,l(r(a.value.penetrationTesting)),1),e("td",oC,l(r(a.value.securityTesting)),1),e("td",lC,l(r(a.value.networkDeploymentSecurity)),1),e("td",nC,l(r(a.value.vulnerabilityDetection)),1),A[108]||(A[108]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),A[109]||(A[109]=e("td",{class:"border p-2 text-center"},null,-1))])])])])])),!U.value&&T.value.length>0?(t(),s("div",rC,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===1||U.value,onClick:f}," 上一頁 ",8,iC),(t(!0),s(X,null,le(b.value,J=>(t(),s(X,{key:J},[J!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":J===N.value}]),disabled:U.value,onClick:Q=>_(J)},l(J),11,dC)):(t(),s("span",uC,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===K.value||U.value,onClick:V}," 下一頁 ",8,cC)])):G("",!0)]),S.value?(t(),s("div",pC,[e("div",vC,[A[110]||(A[110]=e("h3",{class:"text-lg font-medium mb-4"},"匯入學分認列資料",-1)),e("div",mC,[e("div",bC,[e("input",{type:"file",ref_key:"fileInput",ref:xe,class:"hidden",onChange:we,accept:".xlsx,.xls,.csv"},null,544),e("p",fC,l(x.value?x.value.name:"請選擇 Excel 檔案"),1),e("button",{onClick:De,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),L.value?(t(),s("p",yC,l(L.value),1)):G("",!0)]),e("div",gC,[e("button",{onClick:ke,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:de.value}," 取消 ",8,xC),e("button",{onClick:$e,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!x.value||de.value},l(de.value?"上傳中...":"上傳"),9,hC)])])])):G("",!0)]))}},_C=Fe(wC,[["__scopeId","data-v-a246cbd1"]]),kC={class:"w-full"},$C={class:"mb-6"},CC={class:"flex items-center space-x-4"},EC=["value"],SC={class:"relative w-60"},DC=["disabled"],MC={class:"overflow-auto"},AC={class:"w-full border-collapse"},IC={class:"bg-[#EEEFE7]"},RC={class:"border p-2"},PC={class:"flex items-center justify-center"},UC={key:0},NC={key:1},TC={key:2},VC={class:"border p-2"},jC={class:"flex items-center justify-center"},LC={key:0},FC={key:1},OC={key:2},qC={class:"border p-2"},BC={class:"flex items-center justify-center"},HC={key:0},WC={key:1},zC={key:2},KC={class:"border p-2"},JC={class:"flex items-center justify-center"},YC={key:0},GC={key:1},ZC={key:2},QC={class:"border p-2"},XC={class:"flex items-center justify-center"},e8={key:0},t8={key:1},s8={key:2},a8=["onClick"],o8={class:"border p-2 text-center"},l8={class:"border p-2 text-center"},n8={class:"border p-2 text-center"},r8={class:"border p-2 text-center"},i8={key:0},d8={colspan:"5",class:"border p-4 text-center"},u8={key:0,class:"flex justify-center items-center space-x-2 mt-6"},c8=["disabled"],p8=["onClick"],v8={key:1,class:"px-2"},m8=["disabled"],b8={__name:"NotApplied",props:{},emits:[],setup(M,{emit:h}){const d=We(),u=m([]),C=m(!1),o=m(""),N=m(""),K=m([{value:1,label:"機關薦派"},{value:2,label:"自行報名"}]),E=m(1),U=m(20),T=m(1),z=m(0),g=m(""),a=m("asc"),R=H=>{const k=K.value.find(D=>D.value===H);return k?k.label:"未知類別"},Z=H=>{if(H==="-1"||H===-1||H===null)return"缺";if(!H||typeof H!="string"||H.length<5)return H;const k=H.substring(0,2),D=H.substring(H.length-3),j="*".repeat(H.length-5);return k+j+D},$=Se(()=>{const H=[];if(T.value<=5)for(let D=1;D<=T.value;D++)H.push(D);else{H.push(1);let D=Math.max(2,E.value-1),j=Math.min(T.value-1,E.value+1);E.value<=3&&(j=Math.min(4,T.value-1)),E.value>=T.value-2&&(D=Math.max(2,T.value-3)),D>2&&H.push("...");for(let S=D;S<=j;S++)H.push(S);j<T.value-1&&H.push("..."),H.push(T.value)}return H}),c=async()=>{var H;try{C.value=!0;const k=await Mt.getExpenseList({page:E.value,limit:U.value,tab:1,status:N.value||void 0,keyword:o.value||void 0,sortBy:g.value||void 0,sortOrder:a.value||void 0});if(k.data&&k.data.code===0)u.value=k.data.data.list.map(D=>({studentId:D.studentId,studentCode:D.studentCode,studentName:D.studentName,idNumber:D.idNumber,agencyName:D.agencyName,category:y(D.subsidyCategory),credits:D.earnedCredits||0,studentIdentity:D.studentIdentity})),z.value=k.data.data.totalCount,T.value=k.data.data.totalPage,E.value=k.data.data.page;else throw new Error(((H=k.data)==null?void 0:H.message)||"獲取資料失敗")}catch(k){console.error("獲取未申請補助列表失敗:",k),v.showError("載入失敗",k.message||"獲取未申請補助列表失敗"),u.value=[],z.value=0,T.value=1}finally{C.value=!1}},y=H=>{const k=K.value.find(D=>D.label===H);return k?k.value:null},r=H=>{g.value===H?a.value=a.value==="asc"?"desc":"asc":(g.value=H,a.value="asc"),E.value=1,c()},b=H=>{H!==E.value&&(E.value=H)},p=()=>{E.value>1&&E.value--},_=()=>{E.value<T.value&&E.value++};Ee(E,()=>{c()}),je(()=>{c()});const f=H=>{d.push({path:"/expense",query:{studentId:H.studentId,studentName:H.studentName,idNumber:H.idNumber,studentCode:H.studentCode}}).catch(k=>{console.error("導航失敗:",k),v.showError("載入失敗","無法前往補助詳情頁面")}),console.log(`導航到學生 ${H.studentName} 的補助詳情頁面`)},V=()=>{o.value=""},W=()=>{E.value=1,c()};return(H,k)=>(t(),s("div",kC,[e("div",$C,[e("div",CC,[k[9]||(k[9]=e("span",null,"查詢條件:",-1)),P(e("select",{"onUpdate:modelValue":k[0]||(k[0]=D=>N.value=D),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(W,["enter"])},[k[7]||(k[7]=e("option",{value:""},"請選擇補助類別",-1)),(t(!0),s(X,null,le(K.value,D=>(t(),s("option",{key:D.value,value:D.value},l(D.label),9,EC))),128))],544),[[Pe,N.value]]),e("div",SC,[P(e("input",{"onUpdate:modelValue":k[1]||(k[1]=D=>o.value=D),type:"text",placeholder:"請輸入姓名或身分證字號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ue(W,["enter"])},null,544),[[te,o.value]]),o.value?(t(),s("button",{key:0,onClick:V,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},k[8]||(k[8]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:C.value}," 搜尋 ",8,DC)])]),k[15]||(k[15]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",null,[e("div",MC,[e("table",AC,[e("thead",null,[e("tr",IC,[e("th",RC,[e("div",PC,[k[10]||(k[10]=me(" 機關名稱 ")),e("button",{onClick:k[2]||(k[2]=D=>r("agencyName")),class:"ml-1 focus:outline-none"},[g.value==="agencyName"&&a.value==="asc"?(t(),s("span",UC,"▲")):g.value==="agencyName"&&a.value==="desc"?(t(),s("span",NC,"▼")):(t(),s("span",TC,"⇅"))])])]),e("th",VC,[e("div",jC,[k[11]||(k[11]=me(" 姓名 ")),e("button",{onClick:k[3]||(k[3]=D=>r("studentName")),class:"ml-1 focus:outline-none"},[g.value==="studentName"&&a.value==="asc"?(t(),s("span",LC,"▲")):g.value==="studentName"&&a.value==="desc"?(t(),s("span",FC,"▼")):(t(),s("span",OC,"⇅"))])])]),e("th",qC,[e("div",BC,[k[12]||(k[12]=me(" 身分證字號 ")),e("button",{onClick:k[4]||(k[4]=D=>r("idNumber")),class:"ml-1 focus:outline-none"},[g.value==="idNumber"&&a.value==="asc"?(t(),s("span",HC,"▲")):g.value==="idNumber"&&a.value==="desc"?(t(),s("span",WC,"▼")):(t(),s("span",zC,"⇅"))])])]),e("th",KC,[e("div",JC,[k[13]||(k[13]=me(" 補助類別 ")),e("button",{onClick:k[5]||(k[5]=D=>r("subsidyCategory")),class:"ml-1 focus:outline-none"},[g.value==="subsidyCategory"&&a.value==="asc"?(t(),s("span",YC,"▲")):g.value==="subsidyCategory"&&a.value==="desc"?(t(),s("span",GC,"▼")):(t(),s("span",ZC,"⇅"))])])]),e("th",QC,[e("div",XC,[k[14]||(k[14]=me(" 已取得學分數 ")),e("button",{onClick:k[6]||(k[6]=D=>r("earnedCredits")),class:"ml-1 focus:outline-none"},[g.value==="earnedCredits"&&a.value==="asc"?(t(),s("span",e8,"▲")):g.value==="earnedCredits"&&a.value==="desc"?(t(),s("span",t8,"▼")):(t(),s("span",s8,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(u.value,D=>(t(),s("tr",{key:D.id,class:"hover:bg-gray-100 cursor-pointer",onClick:j=>f(D)},[e("td",o8,l(D.agencyName),1),e("td",{class:ee(["border p-2 text-center",{"text-black":D.studentIdentity===1,"text-blue-500":D.studentIdentity===2}])},l(D.studentName),3),e("td",l8,l(Z(D.idNumber)),1),e("td",n8,l(R(D.category)),1),e("td",r8,l(D.credits),1)],8,a8))),128)),u.value.length===0?(t(),s("tr",i8,[e("td",d8,l(C.value?"載入中...":"無符合條件的資料"),1)])):G("",!0)])])]),!C.value&&u.value.length>0?(t(),s("div",u8,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===1,onClick:p}," 上一頁 ",8,c8),(t(!0),s(X,null,le($.value,D=>(t(),s(X,{key:D},[D!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":D===E.value}]),onClick:j=>b(D)},l(D),11,p8)):(t(),s("span",v8,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===T.value,onClick:_}," 下一頁 ",8,m8)])):G("",!0)])]))}},f8=Fe(b8,[["__scopeId","data-v-c013f18d"]]),y8={class:"w-full"},g8={class:"mb-6"},x8={class:"flex items-center space-x-4"},h8=["value"],w8={class:"relative w-60"},_8=["disabled"],k8={class:"overflow-auto"},$8={class:"w-full border-collapse"},C8={class:"bg-[#EEEFE7]"},E8={class:"border p-2"},S8={class:"flex items-center justify-center"},D8={key:0},M8={key:1},A8={key:2},I8={class:"border p-2"},R8={class:"flex items-center justify-center"},P8={key:0},U8={key:1},N8={key:2},T8={class:"border p-2"},V8={class:"flex items-center justify-center"},j8={key:0},L8={key:1},F8={key:2},O8={class:"border p-2"},q8={class:"flex items-center justify-center"},B8={key:0},H8={key:1},W8={key:2},z8=["onClick"],K8={class:"border p-2 text-center"},J8={class:"border p-2 text-center"},Y8={class:"border p-2 text-center"},G8={class:"border p-2 text-center"},Z8={key:0},Q8={colspan:"5",class:"border p-4 text-center"},X8={key:0,class:"flex justify-center items-center space-x-2 mt-6"},eE=["disabled"],tE=["onClick"],sE={key:1,class:"px-2"},aE=["disabled"],oE={__name:"AlreadyApplied",props:{},emits:[],setup(M,{emit:h}){const d=We(),u=m([]),C=m(!1),o=m(""),N=m(""),K=m([{value:1,label:"待申請"},{value:2,label:"審核中"},{value:3,label:"已完成"},{value:4,label:"已撥款"},{value:5,label:"待補件，不合格"}]),E=m(1),U=m(20),T=m(1),z=m(0),g=m(""),a=m("asc"),R=W=>{const H=K.value.find(k=>k.value===W);return H?H.label:"未知狀態"},Z=W=>{switch(parseInt(W)){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return""}},$=Se(()=>{const W=[];if(T.value<=5)for(let k=1;k<=T.value;k++)W.push(k);else{W.push(1);let k=Math.max(2,E.value-1),D=Math.min(T.value-1,E.value+1);E.value<=3&&(D=Math.min(4,T.value-1)),E.value>=T.value-2&&(k=Math.max(2,T.value-3)),k>2&&W.push("...");for(let j=k;j<=D;j++)W.push(j);D<T.value-1&&W.push("..."),W.push(T.value)}return W}),c=async()=>{var W;try{C.value=!0;const H=await Mt.getExpenseList({page:E.value,limit:U.value,tab:2,status:N.value||void 0,keyword:o.value||void 0,sortBy:g.value||void 0,sortOrder:a.value||void 0});if(H.data&&H.data.code===0)u.value=H.data.data.list.map(k=>({id:k.id,studentId:k.studentId,serialNumber:k.number,studentName:k.studentName,idNumber:k.idNumber,applyDate:k.applicationTime,status:k.status})),z.value=H.data.data.totalCount,T.value=H.data.data.totalPage,E.value=H.data.data.page;else throw new Error(((W=H.data)==null?void 0:W.message)||"獲取資料失敗")}catch(H){console.error("獲取已申請補助列表失敗:",H),v.showError("載入失敗",H.message||"獲取已申請補助列表失敗"),u.value=[],z.value=0,T.value=1}finally{C.value=!1}},y=W=>{g.value===W?a.value=a.value==="asc"?"desc":"asc":(g.value=W,a.value="asc"),E.value=1,c()},r=W=>{W!==E.value&&(E.value=W)},b=()=>{E.value>1&&E.value--},p=()=>{E.value<T.value&&E.value++};Ee(E,()=>{c()}),je(()=>{c()});const _=W=>{d.push({path:"/expense",query:{verificationId:W.id,studentId:W.studentId,serialNumber:W.serialNumber,studentName:W.studentName,status:W.status,totalAmount:W.totalAmount,tab:"applications"}}).catch(H=>{console.error("導航失敗:",H),v.showError("導航失敗","無法前往補助詳情頁面")}),console.log(`導航到申請 ${W.serialNumber} (驗證ID: ${W.id}, 學生ID: ${W.studentId}) 的補助詳情頁面，顯示申請表單標籤`)},f=()=>{o.value=""},V=()=>{E.value=1,c()};return(W,H)=>(t(),s("div",y8,[e("div",g8,[e("div",x8,[H[8]||(H[8]=e("span",null,"查詢條件:",-1)),P(e("select",{"onUpdate:modelValue":H[0]||(H[0]=k=>N.value=k),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(V,["enter"])},[H[6]||(H[6]=e("option",{value:""},"請選擇申請狀態",-1)),(t(!0),s(X,null,le(K.value,k=>(t(),s("option",{key:k.value,value:k.value},l(k.label),9,h8))),128))],544),[[Pe,N.value]]),e("div",w8,[P(e("input",{"onUpdate:modelValue":H[1]||(H[1]=k=>o.value=k),type:"text",placeholder:"請輸入姓名或單號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ue(V,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[te,o.value]]),o.value?(t(),s("button",{key:0,onClick:f,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},H[7]||(H[7]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:V,disabled:C.value}," 搜尋 ",8,_8)])]),H[13]||(H[13]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",null,[e("div",k8,[e("table",$8,[e("thead",null,[e("tr",C8,[e("th",E8,[e("div",S8,[H[9]||(H[9]=me(" 單號 ")),e("button",{onClick:H[2]||(H[2]=k=>y("number")),class:"ml-1 focus:outline-none"},[g.value==="number"&&a.value==="asc"?(t(),s("span",D8,"▲")):g.value==="number"&&a.value==="desc"?(t(),s("span",M8,"▼")):(t(),s("span",A8,"⇅"))])])]),e("th",I8,[e("div",R8,[H[10]||(H[10]=me(" 姓名 ")),e("button",{onClick:H[3]||(H[3]=k=>y("studentName")),class:"ml-1 focus:outline-none"},[g.value==="studentName"&&a.value==="asc"?(t(),s("span",P8,"▲")):g.value==="studentName"&&a.value==="desc"?(t(),s("span",U8,"▼")):(t(),s("span",N8,"⇅"))])])]),e("th",T8,[e("div",V8,[H[11]||(H[11]=me(" 申請日期 ")),e("button",{onClick:H[4]||(H[4]=k=>y("applicationTime")),class:"ml-1 focus:outline-none"},[g.value==="applicationTime"&&a.value==="asc"?(t(),s("span",j8,"▲")):g.value==="applicationTime"&&a.value==="desc"?(t(),s("span",L8,"▼")):(t(),s("span",F8,"⇅"))])])]),e("th",O8,[e("div",q8,[H[12]||(H[12]=me(" 申請狀態 ")),e("button",{onClick:H[5]||(H[5]=k=>y("status")),class:"ml-1 focus:outline-none"},[g.value==="status"&&a.value==="asc"?(t(),s("span",B8,"▲")):g.value==="status"&&a.value==="desc"?(t(),s("span",H8,"▼")):(t(),s("span",W8,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(u.value,k=>(t(),s("tr",{key:k.id,class:"hover:bg-gray-100 cursor-pointer",onClick:D=>_(k)},[e("td",K8,l(k.serialNumber),1),e("td",J8,l(k.studentName),1),e("td",Y8,l(k.applyDate),1),e("td",G8,[e("span",{class:ee(["px-2 py-1 rounded text-sm",Z(parseInt(k.status))])},l(R(parseInt(k.status))),3)])],8,z8))),128)),u.value.length===0?(t(),s("tr",Z8,[e("td",Q8,l(C.value?"載入中...":"無符合條件的資料"),1)])):G("",!0)])])]),!C.value&&u.value.length>0?(t(),s("div",X8,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===1,onClick:b}," 上一頁 ",8,eE),(t(!0),s(X,null,le($.value,k=>(t(),s(X,{key:k},[k!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":k===E.value}]),onClick:D=>r(k)},l(k),11,tE)):(t(),s("span",sE,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:E.value===T.value,onClick:p}," 下一頁 ",8,aE)])):G("",!0)])]))}},lE=Fe(oE,[["__scopeId","data-v-3670cbbf"]]),nE={class:"w-full"},rE={class:"mb-6"},iE={class:"flex items-center space-x-4"},dE=["value"],uE={class:"relative w-60"},cE=["disabled"],pE={class:"overflow-x-auto"},vE={class:"w-full border-collapse"},mE={class:"border p-2"},bE={class:"flex items-center justify-center"},fE={key:0},yE={key:1},gE={key:2},xE={class:"border p-2"},hE={class:"flex items-center justify-center"},wE={key:0},_E={key:1},kE={key:2},$E={class:"border p-2"},CE={class:"flex items-center justify-center"},EE={key:0},SE={key:1},DE={key:2},ME={class:"border p-2"},AE={class:"flex items-center justify-center"},IE={key:0},RE={key:1},PE={key:2},UE=["onClick"],NE={class:"border p-2 text-center"},TE={class:"border p-2 text-center"},VE={class:"border p-2 text-center"},jE={class:"border p-2 text-center"},LE={key:0},FE={colspan:"4",class:"border p-4 text-center"},OE={key:0,class:"flex justify-center items-center space-x-2 mt-6"},qE=["disabled"],BE=["onClick"],HE={key:1,class:"px-2"},WE=["disabled"],zE={__name:"RemittanceList",setup(M){const h=We(),d=m(""),u=m(""),C=m(!1),o=m([]),N=m([{value:1,label:"彙整中"},{value:2,label:"審核中"},{value:3,label:"已完成"},{value:4,label:"已撥款"}]),K=m(1),E=m(20),U=m(5),T=m(1),z=m(""),g=m("asc"),a=m({verificationCreate:!1}),R=D=>D==null?"$------":`$${D.toLocaleString()}`,Z=D=>{switch(parseInt(D)){case 1:return"彙整中";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";default:return"未知狀態"}},$=D=>{switch(typeof D=="string"?parseInt(D):D){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};Se(()=>o.value.length>0&&o.value.every(D=>D.selected));const c=Se(()=>{const D=[];if(T.value<=5)for(let S=1;S<=T.value;S++)D.push(S);else{D.push(1);let S=Math.max(2,K.value-1),x=Math.min(T.value-1,K.value+1);K.value<=3&&(x=Math.min(4,T.value-1)),K.value>=T.value-2&&(S=Math.max(2,T.value-3)),S>2&&D.push("...");for(let L=S;L<=x;L++)D.push(L);x<T.value-1&&D.push("..."),D.push(T.value)}return D}),y=D=>{z.value===D?g.value=g.value==="asc"?"desc":"asc":(z.value=D,g.value="asc"),K.value=1,_()},r=D=>{D!==K.value&&(K.value=D,_())},b=()=>{K.value>1&&(K.value--,_())},p=()=>{K.value<T.value&&(K.value++,_())},_=async()=>{var D;try{C.value=!0;const j={page:K.value,limit:E.value,tab:3,status:d.value||void 0,keyword:u.value||void 0,sortBy:z.value||void 0,sortOrder:g.value||void 0},S=await Mt.getExpenseList(j);if(S.data&&S.data.code===0){const x=S.data.data;if(o.value=x.list.map(L=>({id:L.remittanceId,applicationDate:L.applicationDate,batchNumber:L.batchNumber,applicationAmount:L.applicationAmount,status:L.status,selected:!1})),U.value=x.totalCount,T.value=x.totalPage,K.value>T.value&&T.value>0&&(K.value=T.value,x.page!==K.value)){_();return}}else{const x=((D=S.data)==null?void 0:D.message)||"獲取匯款清單失敗，請稍後再試";throw new Error(x)}}catch(j){console.error("獲取匯款清單失敗:",j),v.showError("載入失敗",j.message||"獲取匯款清單失敗"),o.value=[],U.value=0,T.value=1}finally{C.value=!1}},f=()=>{h.push("/remittance")},V=D=>{h.push({path:"/remittance-edit",query:{id:D}})},W=async()=>{try{const D=await ot.getSidebarPermissions();D.data.code===0&&D.data.message==="success"?(a.value=D.data.data,console.log("匯款清單頁面權限:",a.value)):console.error("獲取權限失敗:",D.data.message)}catch(D){console.error("獲取權限錯誤:",D)}};je(()=>{_(),W()});const H=()=>{u.value=""},k=()=>{K.value=1,_()};return(D,j)=>(t(),s("div",nE,[e("div",rE,[e("div",iE,[j[8]||(j[8]=e("span",null,"查詢條件:",-1)),P(e("select",{"onUpdate:modelValue":j[0]||(j[0]=S=>d.value=S),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ue(k,["enter"])},[j[6]||(j[6]=e("option",{value:""},"請選擇匯款狀態",-1)),(t(!0),s(X,null,le(N.value,S=>(t(),s("option",{key:S.value,value:S.value},l(S.label),9,dE))),128))],544),[[Pe,d.value]]),e("div",uE,[P(e("input",{"onUpdate:modelValue":j[1]||(j[1]=S=>u.value=S),type:"text",placeholder:"請輸入批號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ue(k,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:H,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},j[7]||(j[7]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:k,disabled:C.value}," 搜尋 ",8,cE),j[9]||(j[9]=e("div",{class:"flex-1"},null,-1)),a.value.verificationCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:f}," 新增匯款清單 ")):G("",!0)])]),j[14]||(j[14]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",pE,[e("table",vE,[e("thead",null,[e("tr",null,[e("th",mE,[e("div",bE,[j[10]||(j[10]=me(" 申請日期 ")),e("button",{onClick:j[2]||(j[2]=S=>y("applicationDate")),class:"ml-1 focus:outline-none"},[z.value==="applicationDate"&&g.value==="asc"?(t(),s("span",fE,"▲")):z.value==="applicationDate"&&g.value==="desc"?(t(),s("span",yE,"▼")):(t(),s("span",gE,"⇅"))])])]),e("th",xE,[e("div",hE,[j[11]||(j[11]=me(" 批號 ")),e("button",{onClick:j[3]||(j[3]=S=>y("batchNumber")),class:"ml-1 focus:outline-none"},[z.value==="batchNumber"&&g.value==="asc"?(t(),s("span",wE,"▲")):z.value==="batchNumber"&&g.value==="desc"?(t(),s("span",_E,"▼")):(t(),s("span",kE,"⇅"))])])]),e("th",$E,[e("div",CE,[j[12]||(j[12]=me(" 申請金額 ")),e("button",{onClick:j[4]||(j[4]=S=>y("applicationAmount")),class:"ml-1 focus:outline-none"},[z.value==="applicationAmount"&&g.value==="asc"?(t(),s("span",EE,"▲")):z.value==="applicationAmount"&&g.value==="desc"?(t(),s("span",SE,"▼")):(t(),s("span",DE,"⇅"))])])]),e("th",ME,[e("div",AE,[j[13]||(j[13]=me(" 匯款清單狀態 ")),e("button",{onClick:j[5]||(j[5]=S=>y("status")),class:"ml-1 focus:outline-none"},[z.value==="status"&&g.value==="asc"?(t(),s("span",IE,"▲")):z.value==="status"&&g.value==="desc"?(t(),s("span",RE,"▼")):(t(),s("span",PE,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(X,null,le(o.value,(S,x)=>(t(),s("tr",{key:S.id,class:ee([{"bg-[#F7F7F7]":x%2===1},"hover:bg-gray-100 cursor-pointer"]),onClick:L=>V(S.id)},[e("td",NE,l(S.applicationDate),1),e("td",TE,l(S.batchNumber),1),e("td",VE,l(R(S.applicationAmount)),1),e("td",jE,[e("span",{class:ee(["px-2 py-1 rounded text-sm",$(S.status)])},l(Z(S.status)),3)])],10,UE))),128)),o.value.length===0?(t(),s("tr",LE,[e("td",FE,l(C.value?"載入中...":"無符合條件的資料"),1)])):G("",!0)])])]),!C.value&&o.value.length>0?(t(),s("div",OE,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:K.value===1,onClick:b}," 上一頁 ",8,qE),(t(!0),s(X,null,le(c.value,S=>(t(),s(X,{key:S},[S!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":S===K.value}]),onClick:x=>r(S)},l(S),11,BE)):(t(),s("span",HE,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:K.value===T.value,onClick:p}," 下一頁 ",8,WE)])):G("",!0)]))}},KE=Fe(zE,[["__scopeId","data-v-a064cab5"]]),JE={class:"flex flex-col items-center p-6"},YE={class:"w-full max-w-[1500px]"},GE={class:"w-full max-w-[1500px]"},ZE={class:"flex border-b border-gray-300"},QE={class:"w-full max-w-[1500px] mt-6"},XE={key:0},e6={key:1},t6={key:2},s6={__name:"ExpenseList",setup(M){const h=rt(),d=We(),u=m("notApplied");return Ee(()=>u.value,C=>{d.replace({query:{...h.query,tab:C}})}),je(()=>{if(h.query.tab){const C=h.query.tab;["notApplied","alreadyApplied","remittance"].includes(C)&&(u.value=C)}else d.replace({query:{...h.query,tab:u.value}})}),(C,o)=>(t(),s("div",JE,[e("div",YE,[Ge(ft,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"}]})]),e("div",GE,[e("div",ZE,[e("button",{class:ee(["py-2 px-4 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="notApplied","text-gray-600 hover:text-gray-800":u.value!=="notApplied"}]),onClick:o[0]||(o[0]=N=>u.value="notApplied")}," 學員名單 ",2),e("button",{class:ee(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="alreadyApplied","text-gray-600 hover:text-gray-800":u.value!=="alreadyApplied"}]),onClick:o[1]||(o[1]=N=>u.value="alreadyApplied")}," 申請表單 ",2),e("button",{class:ee(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="remittance","text-gray-600 hover:text-gray-800":u.value!=="remittance"}]),onClick:o[2]||(o[2]=N=>u.value="remittance")}," 匯款清單 ",2)])]),e("div",QE,[u.value==="notApplied"?(t(),s("div",XE,[Ge(f8)])):G("",!0),u.value==="alreadyApplied"?(t(),s("div",e6,[Ge(lE)])):G("",!0),u.value==="remittance"?(t(),s("div",t6,[Ge(KE)])):G("",!0)])]))}},a6=Fe(s6,[["__scopeId","data-v-e6d1bc2c"]]),o6={class:"flex flex-col items-center p-6"},l6={class:"w-full max-w-[1500px]"},n6={class:"w-full max-w-[1500px]"},r6={class:"mb-4 flex justify-between"},i6={class:"text-xl font-bold mr-4"},d6={class:"text-xl font-bold"},u6={class:"flex flex-wrap items-center space-x-4 mb-4"},c6={class:"flex items-center mr-4"},p6={class:"flex items-center mr-4"},v6={class:"flex flex-wrap items-center space-x-4 mb-4"},m6={class:"flex items-center mr-4"},b6={class:"flex items-center"},f6={class:"flex items-center"},y6={class:"flex items-center"},g6={class:"flex items-center"},x6={class:"flex items-center"},h6={class:"flex items-center"},w6={class:"flex items-center ml-auto"},_6={class:"overflow-x-auto"},k6={class:"w-full border-collapse min-w-full max-w-[1500px]"},$6={class:"border p-2 sticky left-0 bg-[#EEEFE7] z-10"},C6=["checked"],E6=["id","onUpdate:modelValue","aria-label"],S6={class:"border p-2 text-center"},D6={class:"border p-2 text-center"},M6={class:"border p-2 text-center"},A6={class:"border p-2 text-center whitespace-pre-line"},I6={class:"border p-2 text-center"},R6={class:"border p-2 text-center"},P6={class:"border p-2 text-center"},U6={class:"border p-2 text-center"},N6={class:"border p-2 text-center"},T6={class:"border p-2 text-center"},V6={class:"border p-2 text-center"},j6={class:"border p-2 text-center"},L6=["id","onUpdate:modelValue","aria-label"],F6={class:"border p-2 text-center"},O6=["id","onUpdate:modelValue","aria-label"],q6={class:"border p-2 text-center"},B6={class:"flex flex-col items-center space-y-2"},H6=["for"],W6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},z6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],K6=["for"],J6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},Y6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],G6=["for"],Z6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},Q6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],X6=["for"],e7={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},t7=["id","onUpdate:modelValue","disabled","aria-label","onChange"],s7={class:"mt-4 mb-4 text-base"},a7={class:"font-bold"},o7={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},l7={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},n7={class:"border border-gray-300 p-4 mb-4"},r7={class:"mb-4"},i7={class:"flex items-center mb-4"},d7={class:"flex items-center space-x-4"},u7={class:"flex items-center"},c7={class:"flex items-center"},p7={class:"flex items-center"},v7={class:"flex items-center mb-4"},m7={class:"flex items-center"},b7={class:"flex items-center mb-4"},f7={class:"flex items-center"},y7={class:"flex items-center mt-1 ml-32"},g7={class:"border-b border-black w-full"},x7={class:"mt-4 p-3 border border-gray-300 mb-4"},h7={class:"grid grid-cols-2 gap-4"},w7={class:"border-b border-black w-full"},_7={class:"border-b border-black w-full"},k7={class:"border-b border-black w-full"},$7={class:"border-b border-black w-full"},C7={key:0,class:"ml-7"},E7={class:"mt-2"},S7={class:"flex items-start mb-2"},D7={class:"flex items-start mb-2"},M7={class:"flex items-start"},A7={class:"border-b border-black w-64 ml-2"},I7=["disabled"],R7={class:"flex justify-center space-x-2"},P7=["disabled"],U7={__name:"GrantApplication",setup(M){const h=rt(),d=We(),u=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:"",applicationNumber:"",applicationDate:""}),C=m(""),o=m("bank"),N=m(!1),K=m(null);m("");const E=m(""),U=m(""),T=m(""),z=m(""),g=m(0),a=m(0),R=m(0),Z=m(""),$=m(""),c=Se(()=>!(!a.value||!g.value||Number(g.value)===2&&(!R.value||Number(R.value)===3&&!Z.value.trim())));Ee(()=>o.value,i=>{console.log(`watch: 帳戶類型從舊值變更為新值: ${i}`),i==="post"&&(u.value.bankCode="700")});const y=m(""),r=m([]),b=m(!1),p=Se(()=>[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:u.value.id?`/expense?studentId=${u.value.id}`:"/expense-list"},{name:"申請單",path:"/expense-application"}]),_=Se(()=>r.value.filter(i=>i.selected).length),f=Se(()=>r.value.length>0&&r.value.every(i=>i.selected)),V=i=>i==null?"$------":`$${i.toLocaleString()}`,W=i=>{if(!i)return!0;const n=/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/;if(!n.test(i))return!1;const w=i.match(n),ce=parseInt(w[1])+1911,he=parseInt(w[2])-1,Ve=parseInt(w[3]);let Qe=new Date(ce,he,Ve);return Qe.getFullYear()===ce&&Qe.getMonth()===he&&Qe.getDate()===Ve},H=(i,n)=>{const w=i.target.value,he=w.replace(/[^\d/-]/g,"").slice(0,10);w!==he&&(u.value[n]=he)},k=i=>{console.log("toggleSelectAll: 觸發全選/取消全選功能。",i.target.checked);const n=i.target.checked;r.value.forEach(w=>{w.selected=n})},D=()=>{const i=r.value.filter(n=>n.selected||n.isSelected===!0);return i.length===0?(v.showError("貼心提醒","請至少選擇一門課程進行申請"),null):i},j=i=>i.some(w=>w.is80===2||w.is80===3||w.is15===2||w.is15===3||w.is5===2||w.is5===3||w.is0===2||w.is0===3?!1:!w.selected80&&!w.selected15&&!w.selected5&&!w.selected0)?(v.showError("貼心提醒","請為每個選中的課程選擇申請比例"),!1):!0,S=()=>!y.value||y.value<=0?(v.showError("貼心提醒","請輸入有效的收據金額"),!1):!0,x=i=>i.some(w=>!w.creditFee||w.creditFee<=0)?(v.showError("貼心提醒","請為所有選中的課程輸入有效的學分費"),!1):!0,L=i=>i.some(w=>(w.selected5||w.is5===2)&&(!w.securityWorkDetail||w.securityWorkDetail.trim()===""))?(v.showError("貼心提醒","請為所有選擇5%補助比例的課程填寫投入資安工作明細"),!1):!0,de=()=>{const i=u.value.applicationNumber.trim(),n=u.value.applicationDate.trim();if(!i||!n)return!0;const w=n.match(/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/);if(!w)return!1;const ce=w[1],he=w[2].padStart(2,"0"),Ve=`${ce}${he}`;return new RegExp(`^${Ve}.{4}$`).test(i)?!0:(v.showError("貼心提醒",`申請單號格式不正確。應為 "${Ve}xxxx" (xxxx為任意4碼字元)`),!1)},xe=i=>{const n=i.filter(w=>(w.selected5||w.is5===2)&&w.selectItem===1&&(!w.jobDescription||w.jobDescription!==1));if(n.length>0){v.showError("貼心提醒","請為所有選擇5%補助比例且已投入資安工作的課程填寫職務內容");const w=r.value.findIndex(ce=>ce.id===n[0].id);return w!==-1&&(K.value=w,setTimeout(()=>{Be()},500)),!1}return!0},fe=i=>{const n=i.some(he=>he.selected5||he.is5===2||he.is5===3),w=n?i.find(he=>he.selected5||he.is5===2||he.is5===3):null,ce=(he,Ve)=>he===3?3:Ve||he===2?2:1;return{studentId:u.value.id,bankCode:u.value.bankCode,branchCode:u.value.branchCode,bankAccount:u.value.bankAccount,accountType:o.value,receiptAmount:parseFloat(y.value)||0,number:u.value.applicationNumber||null,applicationDate:u.value.applicationDate||null,selectItem:n&&(w==null?void 0:w.selectItem)||0,originalPosition:n&&(w==null?void 0:w.originalPosition)||"",currentPosition:n&&(w==null?void 0:w.currentPosition)||"",originalAgency:n&&(w==null?void 0:w.originalAgency)||"",currentAgency:n&&(w==null?void 0:w.currentAgency)||"",transferDate:n&&(w==null?void 0:w.transferDate)||"",fillMethod:n?w==null?void 0:w.fillMethod:void 0,trackingReasonOption:n&&(w==null?void 0:w.selectItem)===2&&(w==null?void 0:w.trackingReasonOption)||0,trackingReasonDetail:n&&(w==null?void 0:w.selectItem)===2&&(w==null?void 0:w.trackingReasonDetail)||"",details:i.map(he=>{const Ve=ce(he.is80,he.selected80),Qe=ce(he.is15,he.selected15),et=ce(he.is5,he.selected5);return{learningHistoryId:he.id,remark:he.remark||null,is80:Ve,is15:Qe,is5:et,is0:ce(he.is0,he.selected0),creditFee:parseFloat(he.creditFee)||0,isSelected:he.selected||he.isSelected===!0}})}},ke=async()=>{var i;console.log("saveApplication: 開始儲存申請單。");try{const n=D();if(!n){console.log("saveApplication: 未選擇任何課程，停止儲存。");return}if(b.value=!0,!j(n)){console.log("saveApplication: 申請比例驗證失敗。"),b.value=!1;return}if(!S()){console.log("saveApplication: 收據金額驗證失敗。"),b.value=!1;return}if(!x(n)){console.log("saveApplication: 學分費驗證失敗。"),b.value=!1;return}if(!L(n)){console.log("saveApplication: 資安工作明細驗證失敗。"),b.value=!1;return}if(!xe(n)){console.log("saveApplication: 職務內容驗證失敗。"),b.value=!1;return}if(!u.value.applicationNumber||u.value.applicationNumber.trim()===""){v.showError("貼心提醒","申請單號為必填欄位"),b.value=!1;return}if(!de()){b.value=!1;return}if(!u.value.applicationDate||u.value.applicationDate.trim()===""){v.showError("貼心提醒","申請日期為必填欄位"),b.value=!1;return}if(!W(u.value.applicationDate)){v.showError("貼心提醒","申請日期格式不正確，請輸入民國年格式(如：113/01/01)"),b.value=!1;return}const w=fe(n);console.log("saveApplication: 準備提交的數據：",w);const ce=await Mt.createExpense(w);if(console.log("saveApplication: API 回傳：",ce.data),ce.data&&ce.data.code===0)console.log("saveApplication: 申請單儲存成功。"),v.showSuccess("貼心提醒","申請單已成功儲存"),d.push({path:"/expense",query:{studentId:u.value.id,tab:"applications"}});else{const he=((i=ce.data)==null?void 0:i.message)||"儲存失敗，請確認資料後再試";throw console.log("saveApplication: API 回傳失敗，錯誤訊息：",he),new Error(he)}}catch(n){console.error("儲存申請單失敗:",n),v.showError("貼心提醒",n.message||"儲存申請單失敗，請稍後再試")}finally{console.log("saveApplication: 儲存申請單流程結束。"),b.value=!1}},De=i=>{u.value={id:i.studentId,studentName:i.studentName,bankCode:i.bankCode||"",branchCode:i.branchCode||"",bankAccount:i.bankAccount||"",studentIdentity:i.studentIdentity,applicationNumber:i.applicationNumber||"",applicationDate:i.applicationDate||""},C.value=i.agencyName},we=i=>{i.accountType?o.value=i.accountType:i.bankType?o.value=i.bankType===1?"bank":"post":o.value=i.bankCode==="700"?"post":"bank",o.value==="post"&&(u.value.bankCode="700")},$e=i=>{const n=i.selectItem||0,w=i.originalPosition||"",ce=i.currentPosition||"",he=i.originalAgency||"",Ve=i.currentAgency||"",Qe=i.fillMethod||0,et=i.trackingReasonOption||0,Ct=i.trackingReasonDetail||"",ct=i.transferDate||"";r.value=i.histories.map(lt=>({id:lt.learningHistoryId,courseCode:lt.courseCode,courseName:lt.courseName,schoolName:lt.schoolName,startDate:lt.startDate,endDate:lt.endDate,hours:lt.hours,status:lt.status,certificateNumber:lt.certificateNumber,credits:lt.credits,subsidyCount:lt.subsidyCount,applied:lt.applied,remark:lt.remark||"",accumulatedSubsidy:lt.approvedAmount||0,selected:lt.isSelected||!1,selected80:!1,selected15:!1,selected5:!1,selected0:!1,is80:lt.is80||1,is15:lt.is15||1,is5:lt.is5||1,is0:lt.is0||1,creditFee:lt.creditFee||0,securityWorkDetail:lt.securityWorkDetail||"",isSecurityWorkConfirmed:!1,selectItem:n,originalPosition:w,currentPosition:ce,originalAgency:he,currentAgency:Ve,fillMethod:Qe,trackingReasonOption:et,trackingReasonDetail:Ct,transferDate:ct}))},ae=async()=>{var i;console.log("fetchExpenseDetails: 開始獲取費用核撥詳情。");try{const n=h.query.studentId;if(console.log("fetchExpenseDetails: 獲取學生ID：",n),!n){console.log("fetchExpenseDetails: 缺少學生ID，即將返回列表頁。"),v.showError("貼心提醒","缺少必要的參數，即將返回列表頁"),d.push("/expense-list");return}const w=await Mt.getStudentInfo(n,1);if(console.log("fetchExpenseDetails: API 回傳：",w.data),w.data&&w.data.code===0){console.log("fetchExpenseDetails: 成功獲取資料。");const ce=w.data.data;De(ce),we(ce),$e(ce)}else{const ce=((i=w.data)==null?void 0:i.message)||"獲取資料失敗，請稍後再試";throw console.log("fetchExpenseDetails: API 回傳失敗，錯誤訊息：",ce),new Error(ce)}}catch(n){console.error("獲取費用核撥詳情失敗:",n),v.showError("貼心提醒","獲取費用核撥詳情失敗，即將返回列表頁"),d.push("/expense-list")}};Ee(()=>r.value.map(i=>i.selected),i=>{console.log("watch: 課程選中狀態已更新。",i),r.value.forEach((n,w)=>{n.selected})},{deep:!0}),je(()=>{console.log("onMounted: 元件已掛載，開始獲取費用核撥詳情。"),ae()});const O=i=>{console.log("openSecurityWorkModal: 打開安全工作明細彈窗，索引：",i),K.value=i;const n=r.value[i];g.value=n.selectItem||0,a.value=n.fillMethod||0,E.value=n.originalPosition||"",U.value=n.currentPosition||"",T.value=n.originalAgency||"",z.value=n.currentAgency||"",R.value=n.trackingReasonOption||0,Z.value=n.trackingReasonDetail||"",$.value=n.transferDate||"",N.value=!0},A=i=>{r.value[i].selectItem=g.value,r.value[i].originalPosition=E.value,r.value[i].currentPosition=U.value,r.value[i].originalAgency=T.value,r.value[i].currentAgency=z.value,r.value[i].fillMethod=a.value,r.value[i].trackingReasonOption=R.value,r.value[i].trackingReasonDetail=Z.value,r.value[i].transferDate=$.value},J=()=>{let i="是，已投入資安工作。";return T.value&&z.value&&T.value!==z.value&&(i+=`
原機關：${T.value}，調任機關：${z.value}。`),E.value&&U.value&&E.value!==U.value&&(i+=`
原職系：${E.value}，調任職系：${U.value}。`),$.value&&(i+=`
調任日期：${$.value}。`),i},Q=()=>{let i="否，尚未投入資安工作。";return R.value===1?i+=`
原因：職涯規劃改變`:R.value===2?i+=`
原因：積極尋求機會中`:R.value===3&&Z.value&&(i+=`
原因：其他 - ${Z.value}`),$.value&&(i+=`
調任日期：${$.value}。`),i},Y=()=>{if(console.log("confirmSecurityWork: 確認安全工作明細。"),K.value===null)return;A(K.value);let i="";g.value===1?(i=J(),v.showInfo("貼心提醒",'您選擇了"已投入資安工作"，請記得點擊"回覆職務內容"按鈕填寫詳細資訊！')):g.value===2&&(i=Q()),r.value[K.value].securityWorkDetail=i,r.value[K.value].selected5=!0,N.value=!1,se.value=!0,r.value[K.value].isSecurityWorkConfirmed=!0,g.value===1&&Be()},ue=()=>{console.log("cancelSecurityWork: 取消安全工作明細。"),K.value!==null&&(r.value[K.value].selected5=!1,r.value[K.value].securityWorkDetail="",r.value[K.value].selectItem=0,r.value[K.value].jobDescription=0,r.value[K.value].jobContent={},r.value[K.value].isSecurityWorkConfirmed=!1,r.value.some(n=>n.isSecurityWorkConfirmed)||(se.value=!1)),N.value=!1},pe=m(!1),ye=m(null),ne=m(null),se=m(!1),re=(i,n)=>{r.value[n].selectItem=i.selectItem,r.value[n].originalPosition=i.originalPosition,r.value[n].currentPosition=i.currentPosition,r.value[n].originalAgency=i.originalAgency,r.value[n].currentAgency=i.currentAgency,r.value[n].fillMethod=i.fillMethod,r.value[n].trackingReasonOption=i.trackingReasonOption,r.value[n].trackingReasonDetail=i.trackingReasonDetail,r.value[n].transferDate=i.transferDate,r.value[n].securityWorkDetail=i.securityWorkDetail,i.jobDescription&&(r.value[n].jobDescription=i.jobDescription),i.jobContent&&(r.value[n].jobContent=i.jobContent)},Te=(i,n)=>{console.log(`toggleRatio: 切換補助比例，索引：${i}，比例：${n}`);const w=r.value[i];n==="0"?ie(w):(n==="80"||n==="15"||n==="5")&&_e(w),n==="5"?w.selected5?Le(w,i):ge(w):n==="0"&&w.selected0&&q()},Be=()=>{if(console.log("openJobContentModal: 打開職務內容彈窗。"),K.value!==null){const i=u.value.id;if(i){ye.value=i;const n=r.value[K.value];ne.value=n.jobContent||{},pe.value=!0}else v.showError("貼心提醒","無法獲取學生資訊")}else v.showError("貼心提醒","請先選擇課程")},ve=i=>{console.log("handleSaveJobContent: 處理保存職務內容，數據：",i),ne.value=i,K.value!==null&&(r.value[K.value].jobDescription=1,r.value[K.value].jobContent=i),v.showSuccess("貼心提醒","職務內容已成功儲存"),pe.value=!1},ie=i=>{i.selected0&&(i.selected80=!1,i.selected15=!1,i.selected5=!1,i.securityWorkDetail="",i.selectItem=0,i.jobDescription=0,i.jobContent={})},_e=i=>{(i.selected80||i.selected15||i.selected5)&&(i.selected0=!1)},Le=(i,n)=>{const w=()=>r.value.find(ce=>ce.isSecurityWorkConfirmed)||r.value.find(ce=>(ce.is5===2||ce.is5===3)&&ce.securityWorkDetail);if(!i.isSecurityWorkConfirmed&&!se.value)O(n);else{const ce=w();ce?re(ce,n):O(n)}},ge=i=>{i.securityWorkDetail="",i.selectItem=0,i.jobDescription=0,i.jobContent={},i.isSecurityWorkConfirmed=!1,r.value.some(w=>w.isSecurityWorkConfirmed)||(se.value=!1)},q=i=>{r.value.some(w=>w.selected5||w.is5===2||w.is5===3)||(se.value=!1)};return(i,n)=>(t(),s(X,null,[e("div",o6,[e("div",l6,[Ge(ft,{breadcrumbs:p.value},null,8,["breadcrumbs"])]),e("div",n6,[e("div",r6,[e("div",null,[e("span",i6,l(C.value),1),e("span",d6,[me(l(u.value.studentName)+" ",1),u.value.studentIdentity===1?(t(),s(X,{key:0},[me(" 全修班 ")],64)):u.value.studentIdentity===2?(t(),s(X,{key:1},[me(" 選修班 ")],64)):G("",!0)])]),e("div",null,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:ke}," 儲存 ")])]),e("div",u6,[e("div",c6,[n[26]||(n[26]=e("label",{for:"applicationNumber",class:"mr-2"},"申請單號:",-1)),P(e("input",{id:"applicationNumber",type:"text","onUpdate:modelValue":n[0]||(n[0]=w=>u.value.applicationNumber=w),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"請輸入申請單號"},null,512),[[te,u.value.applicationNumber]])]),e("div",p6,[n[27]||(n[27]=e("label",{for:"applicationDate",class:"mr-2"},"申請日期:",-1)),P(e("input",{id:"applicationDate",type:"text","onUpdate:modelValue":n[1]||(n[1]=w=>u.value.applicationDate=w),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入民國年格式，例如：113/01/05",onInput:n[2]||(n[2]=w=>H(w,"applicationDate"))},null,544),[[te,u.value.applicationDate]])])]),e("div",v6,[e("div",m6,[n[29]||(n[29]=e("label",{for:"accountType",class:"mr-2"},"帳戶類型:",-1)),P(e("select",{id:"accountType","onUpdate:modelValue":n[3]||(n[3]=w=>o.value=w),class:"border border-gray-300 p-1 w-24 outline-none"},n[28]||(n[28]=[e("option",{value:"bank"},"銀行",-1),e("option",{value:"post"},"郵局",-1)]),512),[[Pe,o.value]])]),o.value==="bank"?(t(),s(X,{key:0},[e("div",b6,[n[30]||(n[30]=e("label",{for:"bankCode",class:"mr-2"},"銀行代碼:",-1)),P(e("input",{id:"bankCode",type:"text","onUpdate:modelValue":n[4]||(n[4]=w=>u.value.bankCode=w),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"銀行代碼"},null,512),[[te,u.value.bankCode]])]),e("div",f6,[n[31]||(n[31]=e("label",{for:"branchCode",class:"mr-2"},"分行代碼:",-1)),P(e("input",{id:"branchCode",type:"text","onUpdate:modelValue":n[5]||(n[5]=w=>u.value.branchCode=w),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼"},null,512),[[te,u.value.branchCode]])]),e("div",y6,[n[32]||(n[32]=e("label",{for:"bankAccount",class:"mr-2"},"銀行帳號:",-1)),P(e("input",{id:"bankAccount",type:"text","onUpdate:modelValue":n[6]||(n[6]=w=>u.value.bankAccount=w),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"銀行帳號"},null,512),[[te,u.value.bankAccount]])])],64)):(t(),s(X,{key:1},[e("div",g6,[n[33]||(n[33]=e("label",{for:"postCode",class:"mr-2"},"郵局代碼:",-1)),P(e("input",{id:"postCode",type:"text","onUpdate:modelValue":n[7]||(n[7]=w=>u.value.bankCode=w),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"郵局代碼",disabled:""},null,512),[[te,u.value.bankCode]])]),e("div",x6,[n[34]||(n[34]=e("label",{for:"postBranchCode",class:"mr-2"},"分行代碼:",-1)),P(e("input",{id:"postBranchCode",type:"text","onUpdate:modelValue":n[8]||(n[8]=w=>u.value.branchCode=w),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼"},null,512),[[te,u.value.branchCode]])]),e("div",h6,[n[35]||(n[35]=e("label",{for:"postAccount",class:"mr-2"},"郵局帳號:",-1)),P(e("input",{id:"postAccount",type:"text","onUpdate:modelValue":n[9]||(n[9]=w=>u.value.bankAccount=w),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"郵局帳號"},null,512),[[te,u.value.bankAccount]])])],64)),n[37]||(n[37]=e("div",{class:"flex-grow"},null,-1)),e("div",w6,[n[36]||(n[36]=e("label",{for:"receiptAmount",class:"mr-2"},"收據金額:",-1)),P(e("input",{id:"receiptAmount",type:"text","onUpdate:modelValue":n[10]||(n[10]=w=>y.value=w),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入收據金額"},null,512),[[te,y.value]])])]),e("div",_6,[e("table",k6,[e("thead",null,[e("tr",null,[e("th",$6,[e("input",{id:"selectAll",type:"checkbox",onChange:k,checked:f.value,class:"w-4 h-4 cursor-pointer","aria-label":"全選"},null,40,C6)]),n[38]||(n[38]=e("th",{class:"border p-2"},"課程代號",-1)),n[39]||(n[39]=e("th",{class:"border p-2"},"科目",-1)),n[40]||(n[40]=e("th",{class:"border p-2"},"訓練單位",-1)),n[41]||(n[41]=e("th",{class:"border p-2"},"訓練日期起訖",-1)),n[42]||(n[42]=e("th",{class:"border p-2"},"上課時數",-1)),n[43]||(n[43]=e("th",{class:"border p-2"},"狀態",-1)),n[44]||(n[44]=e("th",{class:"border p-2"},"證書編號",-1)),n[45]||(n[45]=e("th",{class:"border p-2"},"取得學分",-1)),n[46]||(n[46]=e("th",{class:"border p-2"},"累積核撥費用",-1)),n[47]||(n[47]=e("th",{class:"border p-2"},[me("申請補助"),e("br"),me("次數")],-1)),n[48]||(n[48]=e("th",{class:"border p-2"},[me("已申請"),e("br"),me("(%)")],-1)),n[49]||(n[49]=e("th",{class:"border p-2"},"學分費",-1)),n[50]||(n[50]=e("th",{class:"border p-2"},"備註",-1)),n[51]||(n[51]=e("th",{class:"border p-2"},"申請比例",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(r.value,(w,ce)=>(t(),s("tr",{key:w.id,class:ee({"bg-[#F7F7F7]":ce%2===1})},[e("td",{class:ee(["border p-2 text-center sticky left-0 z-10",{"bg-white":ce%2===0,"bg-[#F7F7F7]":ce%2===1}])},[P(e("input",{id:`record-select-${ce}`,type:"checkbox","onUpdate:modelValue":he=>w.selected=he,class:"w-4 h-4 cursor-pointer","aria-label":`選擇課程：${w.courseName}`},null,8,E6),[[Ce,w.selected]])],2),e("td",S6,l(w.courseCode),1),e("td",D6,l(w.courseName),1),e("td",M6,l(w.schoolName),1),e("td",A6,l(w.startDate)+"~"+l(w.endDate),1),e("td",I6,l(w.hours),1),e("td",R6,l(w.status),1),e("td",P6,l(w.certificateNumber||"--"),1),e("td",U6,l(w.credits),1),e("td",N6,l(V(w.accumulatedSubsidy)),1),e("td",T6,l(w.subsidyCount),1),e("td",V6,l(w.applied),1),e("td",j6,[w.selected?P((t(),s("input",{key:0,id:`credit-fee-${ce}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":he=>w.creditFee=he,placeholder:"請輸入學分費","aria-label":`${w.courseName}的學分費`},null,8,L6)),[[te,w.creditFee]]):(t(),s(X,{key:1},[me(l(w.creditFee||"--"),1)],64))]),e("td",F6,[w.selected?P((t(),s("input",{key:0,id:`remark-${ce}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":he=>w.remark=he,placeholder:"請輸入備註","aria-label":`${w.courseName}的備註`},null,8,O6)),[[te,w.remark]]):(t(),s(X,{key:1},[me(l(w.remark||"--"),1)],64))]),e("td",q6,[e("div",B6,[e("label",{for:`rate80-${ce}`,class:"flex items-center cursor-pointer"},[w.is80===3||w.is80===2?(t(),s("div",W6,n[52]||(n[52]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate80-${ce}`,type:"checkbox","onUpdate:modelValue":he=>w.selected80=he,disabled:!w.selected||w.is80!==1||w.selected0||w.is0===2||w.is0===3,class:"mr-1","aria-label":`選擇${w.courseName}的80%補助比例`,onChange:he=>Te(ce,"80")},null,40,z6)),[[Ce,w.selected80]]),e("span",{class:ee(["text-sm",{"text-gray-400":w.is80===3||w.is80===2}])},"80%",2)],8,H6),e("label",{for:`rate15-${ce}`,class:"flex items-center cursor-pointer"},[w.is15===3||w.is15===2?(t(),s("div",J6,n[53]||(n[53]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate15-${ce}`,type:"checkbox","onUpdate:modelValue":he=>w.selected15=he,disabled:!w.selected||w.is15!==1||w.selected0||w.is0===2||w.is0===3,class:"mr-1","aria-label":`選擇${w.courseName}的15%補助比例`,onChange:he=>Te(ce,"15")},null,40,Y6)),[[Ce,w.selected15]]),e("span",{class:ee(["text-sm",{"text-gray-400":w.is15===3||w.is15===2}])},"15%",2)],8,K6),e("label",{for:`rate5-${ce}`,class:"flex items-center cursor-pointer"},[w.is5===3||w.is5===2?(t(),s("div",Z6,n[54]||(n[54]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate5-${ce}`,type:"checkbox","onUpdate:modelValue":he=>w.selected5=he,disabled:!w.selected||w.is5!==1||w.selected0||w.is0===2||w.is0===3,class:"mr-1","aria-label":`選擇${w.courseName}的5%補助比例`,onChange:he=>Te(ce,"5")},null,40,Q6)),[[Ce,w.selected5]]),e("span",{class:ee(["text-sm",{"text-gray-400":w.is5===3||w.is5===2}])},"5%",2)],8,G6),e("label",{for:`rate0-${ce}`,class:"flex items-center cursor-pointer"},[w.is0===3||w.is0===2?(t(),s("div",e7,n[55]||(n[55]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate0-${ce}`,type:"checkbox","onUpdate:modelValue":he=>w.selected0=he,disabled:!w.selected||w.is0!==1||w.selected80||w.is80===2||w.is80===3||w.selected15||w.is15===2||w.is15===3||w.selected5||w.is5===2||w.is5===3,class:"mr-1","aria-label":`選擇${w.courseName}的0%補助比例`,onChange:he=>Te(ce,"0")},null,40,t7)),[[Ce,w.selected0]]),e("span",{class:ee(["text-sm",{"text-gray-400":w.is0===3||w.is0===2}])},"0%",2)],8,X6)])])],2))),128))])])]),e("div",s7,[n[56]||(n[56]=me(" 本次申請共計 ")),e("span",a7,l(_.value),1),n[57]||(n[57]=me(" 門課程 "))])])]),N.value?(t(),s("div",o7,[e("div",l7,[n[76]||(n[76]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",n7,[e("div",r7,[e("div",i7,[n[61]||(n[61]=e("span",{class:"mr-4"},[me("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",d7,[e("label",u7,[P(e("input",{type:"radio","onUpdate:modelValue":n[11]||(n[11]=w=>a.value=w),value:1,class:"w-4 h-4 mr-1"},null,512),[[bt,a.value]]),n[58]||(n[58]=e("span",null,"核撥申請",-1))]),e("label",c7,[P(e("input",{type:"radio","onUpdate:modelValue":n[12]||(n[12]=w=>a.value=w),value:2,class:"w-4 h-4 mr-1"},null,512),[[bt,a.value]]),n[59]||(n[59]=e("span",null,"電子郵件",-1))]),e("label",p7,[P(e("input",{type:"radio","onUpdate:modelValue":n[13]||(n[13]=w=>a.value=w),value:3,class:"w-4 h-4 mr-1"},null,512),[[bt,a.value]]),n[60]||(n[60]=e("span",null,"電訪",-1))])])]),e("div",v7,[e("div",m7,[P(e("input",{type:"radio","onUpdate:modelValue":n[14]||(n[14]=w=>g.value=w),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[bt,g.value]]),n[62]||(n[62]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:Be}," 回覆職務內容 "),n[63]||(n[63]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",b7,[e("div",f7,[P(e("input",{type:"radio","onUpdate:modelValue":n[15]||(n[15]=w=>g.value=w),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[bt,g.value]]),n[65]||(n[65]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",y7,[n[64]||(n[64]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",g7,[P(e("input",{type:"text","onUpdate:modelValue":n[16]||(n[16]=w=>$.value=w),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[te,$.value]])])])])]),e("div",x7,[e("div",h7,[e("div",null,[n[66]||(n[66]=e("div",{class:"mb-1"},"原機關",-1)),e("div",w7,[P(e("input",{type:"text","onUpdate:modelValue":n[17]||(n[17]=w=>T.value=w),class:"w-full outline-none"},null,512),[[te,T.value]])])]),e("div",null,[n[67]||(n[67]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",_7,[P(e("input",{type:"text","onUpdate:modelValue":n[18]||(n[18]=w=>z.value=w),class:"w-full outline-none"},null,512),[[te,z.value]])]),n[68]||(n[68]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[n[69]||(n[69]=e("div",{class:"mb-1"},"原職系",-1)),e("div",k7,[P(e("input",{type:"text","onUpdate:modelValue":n[19]||(n[19]=w=>E.value=w),class:"w-full outline-none"},null,512),[[te,E.value]])])]),e("div",null,[n[70]||(n[70]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",$7,[P(e("input",{type:"text","onUpdate:modelValue":n[20]||(n[20]=w=>U.value=w),class:"w-full outline-none"},null,512),[[te,U.value]])]),n[71]||(n[71]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(g.value)===2?(t(),s("div",C7,[n[75]||(n[75]=e("div",null,[me("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",E7,[e("div",S7,[P(e("input",{type:"radio","onUpdate:modelValue":n[21]||(n[21]=w=>R.value=w),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,R.value]]),n[72]||(n[72]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",D7,[P(e("input",{type:"radio","onUpdate:modelValue":n[22]||(n[22]=w=>R.value=w),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,R.value]]),n[73]||(n[73]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",M7,[P(e("input",{type:"radio","onUpdate:modelValue":n[23]||(n[23]=w=>R.value=w),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,R.value]]),n[74]||(n[74]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",A7,[P(e("input",{type:"text","onUpdate:modelValue":n[24]||(n[24]=w=>Z.value=w),class:"w-full outline-none",disabled:Number(R.value)!==3},null,8,I7),[[te,Z.value]])])])])])):G("",!0)])]),e("div",R7,[e("button",{class:ee(["px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",{"cursor-not-allowed":!c.value}]),onClick:Y,disabled:!c.value}," 確認 ",10,P7),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:ue}," 取消 ")])])])):G("",!0),pe.value?(t(),ps(qs,{key:1,show:pe.value,studentId:ye.value,initialData:ne.value,onClose:n[25]||(n[25]=w=>pe.value=!1),onSave:ve},null,8,["show","studentId","initialData"])):G("",!0)],64))}},N7=Fe(U7,[["__scopeId","data-v-979169b8"]]),T7={class:"flex flex-col items-center p-6"},V7={class:"w-full max-w-[1500px]"},j7={class:"w-full max-w-[1500px]"},L7={class:"flex justify-start mb-2"},F7={class:"text-xl font-bold mr-4"},O7={class:"text-xl font-bold"},q7={class:"flex flex-wrap items-center space-x-4 mb-4"},B7={class:"flex items-center"},H7=["disabled"],W7={class:"flex items-center"},z7=["disabled"],K7={class:"flex items-center"},J7={class:"flex flex-wrap items-center space-x-4 mb-4"},Y7={class:"flex items-center mr-4"},G7=["disabled"],Z7={class:"flex items-center"},Q7=["disabled"],X7={class:"flex items-center"},eS=["disabled"],tS={class:"flex items-center"},sS=["disabled"],aS={class:"flex items-center"},oS={class:"flex items-center"},lS=["disabled"],nS={class:"flex items-center"},rS=["disabled"],iS={class:"flex items-center ml-auto"},dS=["disabled"],uS={class:"overflow-x-auto"},cS={class:"w-full border-collapse min-w-full max-w-[1500px]"},pS={class:"border p-2 sticky left-0 bg-[#EEEFE7] z-10"},vS=["checked","disabled"],mS=["id","onUpdate:modelValue","disabled","aria-label"],bS={class:"border p-2 text-center"},fS={class:"border p-2 text-center"},yS={class:"border p-2 text-center"},gS={class:"border p-2 text-center whitespace-pre-line"},xS={class:"border p-2 text-center"},hS={class:"border p-2 text-center"},wS={class:"border p-2 text-center"},_S={class:"border p-2 text-center"},kS={class:"border p-2 text-center"},$S={class:"border p-2 text-center"},CS={class:"border p-2 text-center"},ES={class:"border p-2 text-center"},SS=["id","onUpdate:modelValue","aria-label"],DS={class:"border p-2 text-center"},MS=["id","onUpdate:modelValue","aria-label"],AS={class:"border p-2 text-center"},IS={class:"flex flex-col items-center space-y-2"},RS=["for"],PS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},US=["id","onUpdate:modelValue","disabled","aria-label","onChange"],NS=["for"],TS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},VS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],jS=["for"],LS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},FS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],OS=["for"],qS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},BS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],HS={class:"flex justify-between"},WS={class:"mt-4 mb-4 text-base"},zS={class:"font-bold"},KS={class:"mt-4 mb-4 text-base"},JS={class:"font-bold"},YS={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},GS={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},ZS={class:"border border-gray-300 p-4 mb-4"},QS={class:"mb-4"},XS={class:"flex items-center mb-4"},e9={class:"flex items-center space-x-4"},t9={class:"flex items-center"},s9={class:"flex items-center"},a9={class:"flex items-center"},o9={class:"flex items-center mb-4"},l9={class:"flex items-center"},n9={class:"flex items-center mb-4"},r9={class:"flex items-center"},i9={class:"flex items-center mt-1 ml-32"},d9={class:"border-b border-black w-full"},u9={class:"mt-4 p-3 border border-gray-300 mb-4"},c9={class:"grid grid-cols-2 gap-4"},p9={class:"border-b border-black w-full"},v9={class:"border-b border-black w-full"},m9={class:"border-b border-black w-full"},b9={class:"border-b border-black w-full"},f9={key:0,class:"ml-7"},y9={class:"mt-2"},g9={class:"flex items-start mb-2"},x9={class:"flex items-start mb-2"},h9={class:"flex items-start"},w9={class:"border-b border-black w-64 ml-2"},_9=["disabled"],k9={class:"flex justify-center space-x-2"},$9=["disabled"],C9={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},E9={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},S9={class:"mb-4"},D9={class:"space-y-3"},M9={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},A9={class:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto"},I9={class:"text-gray-700"},R9={class:"ml-6 mt-2 space-y-2 text-gray-600"},P9=["onUpdate:modelValue"],U9={class:"mb-4"},N9={class:"text-gray-700"},T9={class:"mb-6"},V9={class:"text-gray-700 mb-2"},j9=["disabled"],L9={__name:"GrantApplicationEdit",setup(M){const h=rt(),d=We(),u=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:"",applicationNumber:"",applicationDate:""}),C=m("bank"),o=m(""),N=m("1"),K=m("1"),E=m(""),U=m(0),T=m([]),z=m(!1),g=m(!1),a=m(null);m("");const R=m(""),Z=m(""),$=m(""),c=m(""),y=m(0),r=m(0),b=m(0),p=m(""),_=m(""),f=m(!1),V=m(null),W=m(null),H=m(!1),k=m(!1),D=Se(()=>!(!r.value||!y.value||Number(y.value)===2&&(!b.value||Number(b.value)===3&&!p.value.trim()))),j=B=>{if(!B)return!0;const I=/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/;if(!I.test(B))return!1;const F=B.match(I),oe=parseInt(F[1])+1911,Ie=parseInt(F[2])-1,Ne=parseInt(F[3]);let Oe=new Date(oe,Ie,Ne);return Oe.getFullYear()===oe&&Oe.getMonth()===Ie&&Oe.getDate()===Ne},S=(B,I)=>{const F=B.target.value,Ie=F.replace(/[^\d/-]/g,"").slice(0,10);F!==Ie&&(u.value[I]=Ie)},x=Se(()=>T.value.filter(B=>B.selected).length),L=Se(()=>T.value.length>0&&T.value.every(B=>B.selected)),de=B=>B==null?"$------":`$${B.toLocaleString()}`,xe=B=>{switch(parseInt(B)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";case 5:return"待補件，不合格";default:return B}},fe=B=>{switch(typeof B=="string"?parseInt(B):B){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ke=B=>{console.log("toggleSelectAll: 觸發全選/取消全選功能。",B.target.checked);const I=B.target.checked;T.value.forEach(F=>{F.selected=I})},De=Se(()=>K.value==="1"),we=m({verificationUpdate:!1,verificationExport:!1}),$e=async()=>{console.log("fetchPermissions: 開始獲取用戶權限。");try{const B=await ot.getSidebarPermissions();console.log("fetchPermissions: API 回傳：",B.data),B.data.code===0&&B.data.message==="success"&&(we.value=B.data.data,console.log("fetchPermissions: 成功獲取權限：",we.value))}catch(B){console.error("獲取權限失敗:",B)}},ae=Se(()=>De.value&&we.value.verificationUpdate);Ee(()=>C.value,B=>{console.log(`watch: 帳戶類型從舊值變更為新值: ${B}`),B==="post"&&(u.value.bankCode="700")}),Ee(()=>T.value.map(B=>B.selected5),B=>{console.log("watch: 5%補助比例選中狀態已更新。",B),!T.value.some(F=>F.selected5||F.is5===2||F.is5===3)&&(k.value=!1)},{deep:!0});const O=(B,I)=>B===3?3:I||B===2?2:1,A=()=>{const B=T.value.filter(I=>I.selected);return B.length===0?(v.showError("貼心提醒","請至少選擇一門課程進行申請"),null):B},J=B=>B.some(F=>F.is80===2||F.is80===3||F.is15===2||F.is15===3||F.is5===2||F.is5===3||F.is0===2||F.is0===3?!1:!F.selected80&&!F.selected15&&!F.selected5&&!F.selected0)?(v.showError("貼心提醒","請為每個選中的課程選擇申請比例"),!1):!0,Q=B=>!E.value||E.value<=0?(v.showError("貼心提醒","請輸入有效的收據金額"),!1):B.some(F=>!F.creditFee||F.creditFee<=0)?(v.showError("貼心提醒","請為所有選中的課程輸入有效的學分費"),!1):!0,Y=B=>B.some(F=>(F.selected5||F.is5===2||F.is5===3)&&(!F.securityWorkDetail||F.securityWorkDetail.trim()===""))?(v.showError("貼心提醒","請為所有選擇5%補助比例的課程填寫投入資安工作明細"),!1):!0,ue=()=>{const B=h.query.applicationId;if(!B)return v.showError("貼心提醒","缺少必要的申請單ID參數"),{valid:!1};const I=T.value.filter(st=>{const Nt=st.isSelected,Dt=st.selected,yt=st.originalRemark!==st.remark,He=st.originalCreditFee!==st.creditFee,Xe=st.originalIs80!==O(st.is80,st.selected80),qe=st.originalIs15!==O(st.is15,st.selected15),ze=st.originalIs5!==O(st.is5,st.selected5),Je=st.originalIs0!==O(st.is0,st.selected0),Ye=(st.is5===2||st.is5===3)&&st.originalSecurityWorkDetail!==st.securityWorkDetail;return Nt||Dt&&!Nt||yt||He||Xe||qe||ze||Je||Ye}),F=h.query.bankCode||"",oe=h.query.branchCode||"",Ie=h.query.bankAccount||"",Ne=h.query.receiptAmount||"",Oe=u.value.bankCode!==F||u.value.branchCode!==oe||u.value.bankAccount!==Ie,tt=E.value!==Ne;return I.length===0&&!Oe&&!tt?(v.showInfo("貼心提醒","沒有修改任何資料，無需儲存"),{valid:!1}):{valid:!0,modifiedRecords:I,applicationId:Number(B)}},pe=(B,I)=>{const F=T.value.some(Ne=>Ne.selected5||Ne.is5===2||Ne.is5===3),oe=F?T.value.find(Ne=>Ne.selected5||Ne.is5===2||Ne.is5===3):null,Ie=F&&(oe==null?void 0:oe.selectItem)===2;return{orderId:I,studentId:Number(u.value.id),bankCode:u.value.bankCode,branchCode:u.value.branchCode,bankAccount:u.value.bankAccount,accountType:C.value,receiptAmount:parseFloat(E.value)||0,number:u.value.applicationNumber,applicationDate:u.value.applicationDate||null,selectItem:F&&(oe==null?void 0:oe.selectItem)||0,originalPosition:F&&(oe==null?void 0:oe.originalPosition)||"",currentPosition:F&&(oe==null?void 0:oe.currentPosition)||"",originalAgency:F&&(oe==null?void 0:oe.originalAgency)||"",currentAgency:F&&(oe==null?void 0:oe.currentAgency)||"",transferDate:F&&(oe==null?void 0:oe.transferDate)||"",fillMethod:F?oe==null?void 0:oe.fillMethod:void 0,trackingReasonOption:Ie&&(oe==null?void 0:oe.trackingReasonOption)||0,trackingReasonDetail:Ie&&(oe==null?void 0:oe.trackingReasonDetail)||"",details:B.map(Ne=>{const Oe=O(Ne.is80,Ne.selected80),tt=O(Ne.is15,Ne.selected15),st=O(Ne.is5,Ne.selected5);return{learningHistoryId:Number(Ne.id),remark:Ne.remark||null,is80:Oe,is15:tt,is5:st,is0:O(Ne.is0,Ne.selected0),creditFee:parseFloat(Ne.creditFee)||0,isSelected:Ne.selected}})}},ye=async()=>{var B;if(console.log("saveApplication: 開始儲存申請單。"),!De.value){console.log("saveApplication: 申請單不可編輯，停止儲存。");return}try{const I=A();if(!I){console.log("saveApplication: 未選擇任何課程，停止儲存。");return}if(z.value=!0,!J(I)){console.log("saveApplication: 申請比例驗證失敗。"),z.value=!1;return}if(!Q(I)){console.log("saveApplication: 收據金額或學分費驗證失敗。"),z.value=!1;return}if(!Y(I)){console.log("saveApplication: 資安工作明細驗證失敗。"),z.value=!1;return}if(!u.value.applicationNumber||u.value.applicationNumber.trim()===""){v.showError("貼心提醒","申請單號為必填欄位"),z.value=!1;return}if(!u.value.applicationDate||!j(u.value.applicationDate)){v.showError("貼心提醒","申請日期格式不正確，請輸入民國年格式(如：113/01/01)"),z.value=!1;return}const{valid:F,modifiedRecords:oe,applicationId:Ie}=ue();if(console.log("saveApplication: 檢查修改結果：",{valid:F,modifiedRecords:oe,applicationId:Ie}),!F){console.log("saveApplication: 沒有檢測到修改，停止儲存。"),z.value=!1;return}const Ne=pe(oe,Ie);console.log("saveApplication: 準備提交的數據：",Ne);const Oe=await Mt.updateApplication(Ne);if(console.log("saveApplication: API 回傳：",Oe.data),Oe.data&&Oe.data.code===0)console.log("saveApplication: 申請單更新成功。"),v.showSuccess("貼心提醒","申請單已成功更新"),d.push({path:"/expense",query:{studentId:u.value.id,tab:"applications"}});else{const tt=((B=Oe.data)==null?void 0:B.message)||"儲存失敗，請確認資料後再試";throw console.log("saveApplication: API 回傳失敗，錯誤訊息：",tt),new Error(tt)}}catch(I){console.error("儲存申請單失敗:",I),v.showError("貼心提醒",I.message||"儲存申請單失敗，請稍後再試")}finally{console.log("saveApplication: 儲存申請單流程結束。"),z.value=!1}},ne=B=>{console.log("openSecurityWorkModal: 打開安全工作明細彈窗，索引：",B);const F=T.value.find(Ie=>(Ie.selected5||Ie.is5===2||Ie.is5===3)&&(Ie.selectItem===2||Ie.selectItem===1&&Ie.jobDescription===1));if(F&&k.value){T.value[B].selectItem=F.selectItem,T.value[B].originalPosition=F.originalPosition,T.value[B].currentPosition=F.currentPosition,T.value[B].originalAgency=F.originalAgency,T.value[B].currentAgency=F.currentAgency,T.value[B].fillMethod=F.fillMethod,T.value[B].trackingReasonOption=F.trackingReasonOption,T.value[B].trackingReasonDetail=F.trackingReasonDetail,T.value[B].transferDate=F.transferDate,T.value[B].securityWorkDetail=F.securityWorkDetail,T.value[B].jobDescription=F.jobDescription,T.value[B].jobContent=F.jobContent,F.selectItem===1&&(!F.jobDescription||F.jobDescription!==1)&&v.showInfo("貼心提醒","您已選擇「已投入資安工作」，請記得點擊「回覆職務內容」按鈕填寫詳細資訊！");return}a.value=B;const oe=T.value[B];y.value=oe.selectItem||0,r.value=oe.fillMethod||0,R.value=oe.originalPosition||"",Z.value=oe.currentPosition||"",$.value=oe.originalAgency||"",c.value=oe.currentAgency||"",b.value=oe.trackingReasonOption||0,p.value=oe.trackingReasonDetail||"",_.value=oe.transferDate||"",g.value=!0},se=B=>{T.value[B].selectItem=y.value,T.value[B].originalPosition=R.value,T.value[B].currentPosition=Z.value,T.value[B].originalAgency=$.value,T.value[B].currentAgency=c.value,T.value[B].fillMethod=r.value,T.value[B].trackingReasonOption=b.value,T.value[B].trackingReasonDetail=p.value,T.value[B].transferDate=_.value},re=()=>{let B="是，已投入資安工作。";return $.value&&c.value&&$.value!==c.value&&(B+=`
原機關：${$.value}，調任機關：${c.value}。`),R.value&&Z.value&&R.value!==Z.value&&(B+=`
原職系：${R.value}，調任職系：${Z.value}。`),_.value&&(B+=`
調任日期：${_.value}。`),B},Te=()=>{let B="否，尚未投入資安工作。";return b.value===1?B+=`
原因：職涯規劃改變`:b.value===2?B+=`
原因：積極尋求機會中`:b.value===3&&p.value&&(B+=`
原因：其他 - ${p.value}`),_.value&&(B+=`
調任日期：${_.value}。`),B},Be=()=>{if(console.log("confirmSecurityWork: 確認安全工作明細。"),a.value===null)return;se(a.value);let B="";y.value===1?(B=re(),v.showInfo("貼心提醒",'您選擇了"已投入資安工作"，請記得點擊"回覆職務內容"按鈕填寫詳細資訊！')):y.value===2&&(B=Te()),T.value[a.value].securityWorkDetail=B,T.value[a.value].selected5=!0,g.value=!1,k.value=!0,y.value===1&&ie()},ve=()=>{console.log("cancelSecurityWork: 取消安全工作明細。"),a.value!==null&&(T.value[a.value].selected5=!1,T.value[a.value].securityWorkDetail="",T.value[a.value].selectItem=0,T.value[a.value].jobDescription=0,T.value[a.value].jobContent={},T.value.some((I,F)=>F!==a.value&&I.selected5&&I.securityWorkDetail&&I.selectItem)||(k.value=!1)),g.value=!1},ie=()=>{if(console.log("openJobContentModal: 打開職務內容彈窗。"),a.value!==null){const B=u.value.id;if(B){V.value=B;const I=T.value[a.value];W.value=I.jobContent||{},f.value=!0}else v.showError("貼心提醒","無法獲取學生資訊")}else v.showError("貼心提醒","請先選擇課程")},_e=B=>{console.log("handleSaveJobContent: 處理保存職務內容，數據：",B),W.value=B,a.value!==null&&(T.value[a.value].jobDescription=1,T.value[a.value].jobContent=B),v.showSuccess("貼心提醒","職務內容已成功儲存"),f.value=!1},Le=(B,I)=>{T.value[I].selectItem=B.selectItem,T.value[I].originalPosition=B.originalPosition,T.value[I].currentPosition=B.currentPosition,T.value[I].originalAgency=B.originalAgency,T.value[I].currentAgency=B.currentAgency,T.value[I].fillMethod=B.fillMethod,T.value[I].trackingReasonOption=B.trackingReasonOption,T.value[I].trackingReasonDetail=B.trackingReasonDetail,T.value[I].securityWorkDetail=B.securityWorkDetail,B.jobDescription&&(T.value[I].jobDescription=B.jobDescription),B.jobContent&&(T.value[I].jobContent=B.jobContent)},ge=B=>{u.value.id=B.studentId,u.value.studentName=B.studentName,u.value.bankCode=B.bankCode||"",u.value.branchCode=B.branchCode||"",u.value.bankAccount=B.bankAccount||"",u.value.studentIdentity=B.studentIdentity,u.value.applicationNumber=B.number,u.value.applicationDate=B.applicationDate||"",h.query.bankCode=B.bankCode||"",h.query.branchCode=B.branchCode||"",h.query.bankAccount=B.bankAccount||"",h.query.receiptAmount=B.receiptAmount||"",o.value=B.agencyName,N.value=String(B.status),K.value=String(B.status),E.value=B.receiptAmount,U.value=B.subsidyAmount},q=B=>{B.accountType?C.value=B.accountType:B.bankType?C.value=B.bankType===1?"bank":"post":C.value=B.bankCode==="700"?"post":"bank"},i=B=>{const I=B.selectItem||0,F=B.originalPosition||"",oe=B.currentPosition||"",Ie=B.originalAgency||"",Ne=B.currentAgency||"",Oe=B.fillMethod||0,tt=B.trackingReasonOption||0,st=B.trackingReasonDetail||"",Nt=B.transferDate||"";let Dt="";switch(I){case 1:Dt=`是，已調任職系，且轉至其他機關。
原職系為${F}，目前職系為${oe}。
原機關為${Ie}，目前機關為${Ne}。`;break;case 2:Dt=`是，已調任職系，尚未轉至其他機關。
原職系為${F}，目前職系為${oe}。`;break;case 3:Dt="否，尚在原單位，僅轉調工作任務/職稱/職級。";break;case 4:Dt="否，尚在原單位，持續進行工作任務。";break}Nt&&(Dt+=`
調任日期：${Nt}。`),T.value=B.details.map(yt=>{const He=yt.is80||1,Xe=yt.is15||1,qe=yt.is5||1,ze=yt.is0||1,Je=yt.creditFee||0,Ye=yt.remark||"",ut=qe===2||qe===3?Dt:"",Ht=yt.isSelected!==void 0?yt.isSelected:!1;return{id:yt.learningHistoryId,courseCode:yt.courseCode,courseName:yt.courseName,schoolName:yt.schoolName,startDate:yt.startDate,endDate:yt.endDate,hours:yt.hours,status:yt.status,certificateNumber:yt.certificateNumber,credits:yt.credits,subsidyCount:yt.subsidyCount,applied:yt.applied,remark:Ye,accumulatedSubsidy:yt.approvedAmount||0,selected:Ht,selected80:He===2,selected15:Xe===2,selected5:qe===2,selected0:ze===2,is80:He,is15:Xe,is5:qe,is0:ze,creditFee:Je,originalIs80:He,originalIs15:Xe,originalIs5:qe,originalIs0:ze,originalCreditFee:Je,originalRemark:Ye,originalSecurityWorkDetail:ut,isSelected:Ht,securityWorkDetail:ut,isSecurityWorkConfirmed:(qe===2||qe===3)&&ut!=="",selectItem:I,originalPosition:F,currentPosition:oe,originalAgency:Ie,currentAgency:Ne,fillMethod:Oe,trackingReasonOption:tt,trackingReasonDetail:st,transferDate:Nt}})},n=async()=>{var B;console.log("fetchExpenseDetails: 開始獲取申請單詳情。");try{const I=h.query.applicationId;if(console.log("fetchExpenseDetails: 獲取申請單ID：",I),!I){console.log("fetchExpenseDetails: 缺少申請單ID，即將返回列表頁。"),v.showError("貼心提醒","缺少必要的參數，即將返回列表頁"),d.push("/expense-list");return}const F=await Mt.getApplicationInfo(I);if(console.log("fetchExpenseDetails: API 回傳：",F.data),F.data&&F.data.code===0){console.log("fetchExpenseDetails: 成功獲取資料。");const oe=F.data.data;ge(oe),q(oe),i(oe)}else{const oe=((B=F.data)==null?void 0:B.message)||"獲取資料失敗，請稍後再試";throw console.log("fetchExpenseDetails: API 回傳失敗，錯誤訊息：",oe),new Error(oe)}}catch(I){console.error("獲取申請單詳情失敗:",I),v.showError("貼心提醒","獲取申請單詳情失敗，即將返回列表頁"),d.push("/expense-list")}},w=Se(()=>[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:u.value.id?`/expense?studentId=${u.value.id}`:"/expense-list"},{name:"編輯申請單",path:"/expense-application-edit"}]),ce=()=>{H.value=!0},he=()=>{H.value=!1},Ve=async B=>{if(B)await Qe(!0);else try{const I=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(I===null||I===""){he();return}const F=await Mt.confirmPassword(I);if(F.data.code!==0){v.showError("密碼錯誤",F.data.message||"管理員密碼驗證失敗"),he();return}const oe=await v.promptAsync("請輸入檔案密碼","請為匯出的檔案設置密碼","password");if(oe===null||oe===""){he();return}await Qe(!1,oe)}catch(I){console.error("密碼驗證或檔案匯出過程錯誤:",I),v.showError("匯出失敗","驗證過程中發生錯誤，請稍後再試"),he();return}he()},Qe=async(B,I="")=>{try{const F={id:Number(h.query.applicationId),password:I,isHidden:B},oe=await Mt.exportPassExcel(F),Ie=oe.headers["content-type"];if(!Ie||!Ie.includes("spreadsheetml.sheet"))try{const Dt=new Blob([oe.data],{type:"application/json"}),yt=await new Response(Dt).text(),He=JSON.parse(yt);console.error("匯出申請單失敗：伺服器返回錯誤：",He),v.showError("匯出失敗",He.message||"匯出過程中發生錯誤，請稍後再試");return}catch(Dt){console.error("匯出申請單失敗：無法解析回應內容",Dt),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const Ne=new Blob([oe.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Oe=window.URL.createObjectURL(Ne),tt=document.createElement("a");tt.href=Oe;const st=B?"隱蔽加密版":"無隱蔽版",Nt=`申請單資料_${u.value.applicationNumber}_${st}.xlsx`;tt.setAttribute("download",Nt),document.body.appendChild(tt),tt.click(),document.body.removeChild(tt),window.URL.revokeObjectURL(Oe),v.showSuccess("匯出成功","申請單資料已成功匯出為 Excel 檔案")}catch(F){if(console.error("匯出申請單失敗:",F),F.response&&F.response.data){const oe=F.response.data;v.showError("匯出失敗",oe.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};je(()=>{console.log("onMounted: 元件已掛載，開始獲取申請單詳情與權限。"),n(),$e()});const et=B=>{B.selected0&&(B.selected80=!1,B.selected15=!1,B.selected5=!1,B.securityWorkDetail="",B.selectItem=0,B.jobDescription=0,B.jobContent={})},Ct=B=>{(B.selected80||B.selected15||B.selected5)&&(B.selected0=!1)},ct=(B,I)=>{const F=()=>T.value.find(oe=>oe.isSecurityWorkConfirmed)||T.value.find(oe=>(oe.is5===2||oe.is5===3)&&oe.securityWorkDetail);if(!B.isSecurityWorkConfirmed&&!k.value)ne(I);else{const oe=F();oe?Le(oe,I):ne(I)}},lt=B=>{B.securityWorkDetail="",B.selectItem=0,B.jobDescription=0,B.jobContent={},B.isSecurityWorkConfirmed=!1,T.value.some(F=>F.isSecurityWorkConfirmed)||(k.value=!1)},dt=B=>{T.value.some(F=>F.selected5||F.is5===2||F.is5===3)||(k.value=!1)},At=(B,I)=>{console.log(`toggleRatio: 處理比例勾選變化，索引：${B}，比例類型：${I}`);const F=T.value[B];I==="0"?et(F):(I==="80"||I==="15"||I==="5")&&Ct(F),I==="5"?F.selected5?ct(F,B):lt(F):I==="0"&&F.selected0&&dt()},Et=m(!1),ds=m([{category:"一、文件未齊",modelGroup:"documentsMissingItems",items:[{modelKey:"form1",text:"1. 表單1:補助學分費/訓練費用申請書(雙面列印)。"},{modelKey:"form2",text:"2. 表單2:查詢個人資料同意書。"},{modelKey:"form3",text:"3. 表單3:撥款同意書(含帳戶存摺影本)。"},{modelKey:"form4",text:"4. 表單4:投入資安工作證明書。"},{modelKey:"form5",text:"5. 學分費/訓練費用繳納證明(收據正本)。"},{modelKey:"form6",text:"6. 學分證明、職能研習時數證明。"},{modelKey:"form7",text:"7. 資安職能訓練證書。"}]},{category:"二、文件缺漏",modelGroup:"documentsIncompleteItems",items:[{modelKey:"form1NotDoubleSided",text:"1. 表單1:未雙面列印。"},{modelKey:"missingSignature",text:"2. 漏簽名。"},{modelKey:"missingIDOrBankbook",text:"3. 未黏貼國民身分證或帳戶存摺影本。"},{modelKey:"alterationWithoutSeal",text:"4. 塗改處未蓋私章。"},{modelKey:"applicantInfoError",text:"5. 申請人個人資料填寫有誤。"}]}]),_t=m({documentsMissingItems:{form1:!1,form2:!1,form3:!1,form4:!1,form5:!1,form6:!1,form7:!1},documentsIncompleteItems:{form1NotDoubleSided:!1,missingSignature:!1,missingIDOrBankbook:!1,alterationWithoutSeal:!1,applicantInfoError:!1},notProjectStudent:!1,other:!1}),ts=m(""),qt=()=>{Et.value=!0},Qt=()=>{Et.value=!1,_t.value={documentsMissingItems:{form1:!1,form2:!1,form3:!1,form4:!1,form5:!1,form6:!1,form7:!1},documentsIncompleteItems:{form1NotDoubleSided:!1,missingSignature:!1,missingIDOrBankbook:!1,alterationWithoutSeal:!1,applicantInfoError:!1},notProjectStudent:!1,other:!1},ts.value=""},kt=async()=>{try{const B=Number(h.query.applicationId),I=Bt();if(!B||I.length===0){v.showError("請勾選至少一項不通過原因");return}await Mt.rejectApplication({orderId:B,details:I}),await Kt(B),Qt()}catch(B){v.showError("操作失敗",B.message||"匯出不通過名單失敗")}},Kt=async B=>{try{const I=await Mt.exportNoPassExcel({id:B,password:""},{responseType:"blob"}),F=I.headers["content-type"];if(F&&F.includes("application/json")){const Oe=await I.data.text(),tt=JSON.parse(Oe);v.showError("匯出失敗",tt.message||"未知錯誤");return}const oe=new Blob([I.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Ie=window.URL.createObjectURL(oe),Ne=document.createElement("a");Ne.href=Ie,Ne.setAttribute("download",`不通過名單_${u.value.applicationNumber}.xlsx`),document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),window.URL.revokeObjectURL(Ie),v.showSuccess("匯出成功","不通過名單已匯出"),n()}catch(I){v.showError("匯出失敗",I.message||"匯出不通過Excel失敗")}},Bt=()=>{const B=[],I=_t.value;return ds.value.forEach(F=>{F.items.forEach(oe=>{B.push({ans:I[F.modelGroup][oe.modelKey],question:oe.text})})}),B.push({ans:I.notProjectStudent,question:"非本計畫學員。"}),B.push({ans:I.other,question:"其他: "+(I.other?ts.value:"")}),B};return(B,I)=>(t(),s(X,null,[e("div",T7,[e("div",V7,[Ge(ft,{breadcrumbs:w.value},null,8,["breadcrumbs"])]),e("div",j7,[e("div",L7,[e("span",F7,l(o.value),1),e("span",O7,[me(l(u.value.studentName)+" ",1),u.value.studentIdentity===1?(t(),s(X,{key:0},[me(" 全修班 ")],64)):u.value.studentIdentity===2?(t(),s(X,{key:1},[me(" 選修班 ")],64)):G("",!0)]),I[31]||(I[31]=e("div",{class:"flex-grow"},null,-1)),we.value.verificationExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:qt}," 匯出不通過Excel ")):G("",!0),we.value.verificationExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:ce}," 匯出通過Excel ")):G("",!0),ae.value?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:ye}," 儲存 ")):G("",!0)]),e("div",q7,[e("div",B7,[I[32]||(I[32]=e("span",{class:"mr-2",id:"applicationNumberLabel"},"申請單號:",-1)),P(e("input",{id:"applicationNumber",type:"text","onUpdate:modelValue":I[0]||(I[0]=F=>u.value.applicationNumber=F),class:"border border-gray-300 p-1 w-48 outline-none",disabled:!De.value,placeholder:"請輸入申請單號","aria-labelledby":"applicationNumberLabel"},null,8,H7),[[te,u.value.applicationNumber]])]),e("div",W7,[I[33]||(I[33]=e("span",{class:"mr-2",id:"applicationDateLabel"},"申請日期:",-1)),P(e("input",{id:"applicationDate",type:"text","onUpdate:modelValue":I[1]||(I[1]=F=>u.value.applicationDate=F),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"例如：114/01/05",onInput:I[2]||(I[2]=F=>S(F,"applicationDate")),disabled:!De.value,"aria-labelledby":"applicationDateLabel"},null,40,z7),[[te,u.value.applicationDate]])]),I[35]||(I[35]=e("div",{class:"flex-grow"},null,-1)),e("div",K7,[I[34]||(I[34]=e("span",{class:"mr-2",id:"orderStatusLabel"},"申請單狀態:",-1)),e("span",{class:ee(["px-3 py-1 rounded text-sm",fe(N.value)]),"aria-labelledby":"orderStatusLabel"},l(xe(N.value)),3)])]),e("div",J7,[e("div",Y7,[I[37]||(I[37]=e("label",{class:"mr-2",for:"accountType"},"帳戶類型:",-1)),P(e("select",{id:"accountType","onUpdate:modelValue":I[3]||(I[3]=F=>C.value=F),class:"border border-gray-300 p-1 w-24 outline-none",disabled:!De.value},I[36]||(I[36]=[e("option",{value:"bank"},"銀行",-1),e("option",{value:"post"},"郵局",-1)]),8,G7),[[Pe,C.value]])]),C.value==="bank"?(t(),s(X,{key:0},[e("div",Z7,[I[38]||(I[38]=e("label",{class:"mr-2",for:"bankCode"},"銀行代碼:",-1)),P(e("input",{id:"bankCode",type:"text","onUpdate:modelValue":I[4]||(I[4]=F=>u.value.bankCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"銀行代碼",disabled:!De.value},null,8,Q7),[[te,u.value.bankCode]])]),e("div",X7,[I[39]||(I[39]=e("label",{class:"mr-2",for:"branchCode"},"分行代碼:",-1)),P(e("input",{id:"branchCode",type:"text","onUpdate:modelValue":I[5]||(I[5]=F=>u.value.branchCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼",disabled:!De.value},null,8,eS),[[te,u.value.branchCode]])]),e("div",tS,[I[40]||(I[40]=e("label",{class:"mr-2",for:"bankAccount"},"銀行帳號:",-1)),P(e("input",{id:"bankAccount",type:"text","onUpdate:modelValue":I[6]||(I[6]=F=>u.value.bankAccount=F),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"銀行帳號",disabled:!De.value},null,8,sS),[[te,u.value.bankAccount]])])],64)):(t(),s(X,{key:1},[e("div",aS,[I[41]||(I[41]=e("label",{class:"mr-2",for:"postCode"},"郵局代碼:",-1)),P(e("input",{id:"postCode",type:"text","onUpdate:modelValue":I[7]||(I[7]=F=>u.value.bankCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"郵局代碼",disabled:""},null,512),[[te,u.value.bankCode]])]),e("div",oS,[I[42]||(I[42]=e("label",{class:"mr-2",for:"postBranchCode"},"分行代碼:",-1)),P(e("input",{id:"postBranchCode",type:"text","onUpdate:modelValue":I[8]||(I[8]=F=>u.value.branchCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼",disabled:!De.value},null,8,lS),[[te,u.value.branchCode]])]),e("div",nS,[I[43]||(I[43]=e("label",{class:"mr-2",for:"postAccount"},"郵局帳號:",-1)),P(e("input",{id:"postAccount",type:"text","onUpdate:modelValue":I[9]||(I[9]=F=>u.value.bankAccount=F),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"郵局帳號",disabled:!De.value},null,8,rS),[[te,u.value.bankAccount]])])],64)),I[45]||(I[45]=e("div",{class:"flex-grow"},null,-1)),e("div",iS,[I[44]||(I[44]=e("label",{class:"mr-2",for:"receiptAmount"},"收據金額:",-1)),P(e("input",{id:"receiptAmount",type:"text","onUpdate:modelValue":I[10]||(I[10]=F=>E.value=F),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入收據金額",disabled:!De.value},null,8,dS),[[te,E.value]])])]),e("div",uS,[e("table",cS,[e("thead",null,[e("tr",null,[e("th",pS,[e("input",{id:"selectAll",type:"checkbox",onChange:ke,checked:L.value,class:"w-4 h-4 cursor-pointer",disabled:!De.value,"aria-label":"全選"},null,40,vS)]),I[46]||(I[46]=e("th",{class:"border p-2"},"課程代號",-1)),I[47]||(I[47]=e("th",{class:"border p-2"},"科目",-1)),I[48]||(I[48]=e("th",{class:"border p-2"},"訓練單位",-1)),I[49]||(I[49]=e("th",{class:"border p-2"},"訓練日期起訖",-1)),I[50]||(I[50]=e("th",{class:"border p-2"},"上課時數",-1)),I[51]||(I[51]=e("th",{class:"border p-2"},"狀態",-1)),I[52]||(I[52]=e("th",{class:"border p-2"},"證書編號",-1)),I[53]||(I[53]=e("th",{class:"border p-2"},"取得學分",-1)),I[54]||(I[54]=e("th",{class:"border p-2"},"累積核撥費用",-1)),I[55]||(I[55]=e("th",{class:"border p-2"},[me("申請補助"),e("br"),me("次數")],-1)),I[56]||(I[56]=e("th",{class:"border p-2"},[me("已申請"),e("br"),me("(%)")],-1)),I[57]||(I[57]=e("th",{class:"border p-2"},"學分費",-1)),I[58]||(I[58]=e("th",{class:"border p-2"},"備註",-1)),I[59]||(I[59]=e("th",{class:"border p-2"},"申請比例",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(T.value,(F,oe)=>(t(),s("tr",{key:F.id,class:ee({"bg-[#F7F7F7]":oe%2===1})},[e("td",{class:ee(["border p-2 text-center sticky left-0 z-10",{"bg-white":oe%2===0,"bg-[#F7F7F7]":oe%2===1}])},[P(e("input",{id:`record-select-${oe}`,type:"checkbox","onUpdate:modelValue":Ie=>F.selected=Ie,class:"w-4 h-4 cursor-pointer",disabled:!De.value,"aria-label":`選擇課程：${F.courseName}`},null,8,mS),[[Ce,F.selected]])],2),e("td",bS,l(F.courseCode),1),e("td",fS,l(F.courseName),1),e("td",yS,l(F.schoolName),1),e("td",gS,l(F.startDate)+"~"+l(F.endDate),1),e("td",xS,l(F.hours),1),e("td",hS,l(xe(F.status)),1),e("td",wS,l(F.certificateNumber||"--"),1),e("td",_S,l(F.credits),1),e("td",kS,l(de(F.accumulatedSubsidy)),1),e("td",$S,l(F.subsidyCount),1),e("td",CS,l(F.applied),1),e("td",ES,[F.selected&&De.value?P((t(),s("input",{key:0,id:`credit-fee-${oe}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Ie=>F.creditFee=Ie,placeholder:"請輸入學分費","aria-label":`${F.courseName}的學分費`},null,8,SS)),[[te,F.creditFee]]):(t(),s(X,{key:1},[me(l(F.creditFee||"--"),1)],64))]),e("td",DS,[F.selected&&De.value?P((t(),s("input",{key:0,id:`remark-${oe}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Ie=>F.remark=Ie,placeholder:"請輸入備註","aria-label":`${F.courseName}的備註`},null,8,MS)),[[te,F.remark]]):(t(),s(X,{key:1},[me(l(F.remark||"--"),1)],64))]),e("td",AS,[e("div",IS,[e("label",{for:`rate80-${oe}`,class:ee(["flex items-center",{"cursor-pointer":De.value}])},[F.is80===3||F.is80===2?(t(),s("div",PS,I[60]||(I[60]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate80-${oe}`,type:"checkbox","onUpdate:modelValue":Ie=>F.selected80=Ie,disabled:!F.selected||F.is80!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的80%補助比例`,onChange:Ie=>At(oe,"80")},null,40,US)),[[Ce,F.selected80]]),e("span",{class:ee(["text-sm",{"text-gray-400":F.is80===3||F.is80===2}])},"80%",2)],10,RS),e("label",{for:`rate15-${oe}`,class:ee(["flex items-center",{"cursor-pointer":De.value}])},[F.is15===3||F.is15===2?(t(),s("div",TS,I[61]||(I[61]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate15-${oe}`,type:"checkbox","onUpdate:modelValue":Ie=>F.selected15=Ie,disabled:!F.selected||F.is15!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的15%補助比例`,onChange:Ie=>At(oe,"15")},null,40,VS)),[[Ce,F.selected15]]),e("span",{class:ee(["text-sm",{"text-gray-400":F.is15===3||F.is15===2}])},"15%",2)],10,NS),e("label",{for:`rate5-${oe}`,class:ee(["flex items-center",{"cursor-pointer":De.value}])},[F.is5===3||F.is5===2?(t(),s("div",LS,I[62]||(I[62]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate5-${oe}`,type:"checkbox","onUpdate:modelValue":Ie=>F.selected5=Ie,disabled:!F.selected||F.is5!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的5%補助比例`,onChange:Ie=>At(oe,"5")},null,40,FS)),[[Ce,F.selected5]]),e("span",{class:ee(["text-sm",{"text-gray-400":F.is5===3||F.is5===2}])},"5%",2)],10,jS),e("label",{for:`rate0-${oe}`,class:ee(["flex items-center",{"cursor-pointer":De.value}])},[F.is0===3||F.is0===2?(t(),s("div",qS,I[63]||(I[63]=[e("span",{class:"text-gray-600"},"✓",-1)]))):P((t(),s("input",{key:1,id:`rate0-${oe}`,type:"checkbox","onUpdate:modelValue":Ie=>F.selected0=Ie,disabled:!F.selected||F.is0!==1||!De.value||F.selected80||F.is80===2||F.is80===3||F.selected15||F.is15===2||F.is15===3||F.selected5||F.is5===2||F.is5===3,class:"mr-1","aria-label":`選擇${F.courseName}的0%補助比例`,onChange:Ie=>At(oe,"0")},null,40,BS)),[[Ce,F.selected0]]),e("span",{class:ee(["text-sm",{"text-gray-400":F.is0===3||F.is0===2}])},"0%",2)],10,OS)])])],2))),128))])])]),e("div",HS,[e("div",WS,[I[64]||(I[64]=me(" 本次申請共計 ")),e("span",zS,l(x.value),1),I[65]||(I[65]=me(" 門課程 "))]),e("div",KS,[I[66]||(I[66]=me(" 申請金額 ")),e("span",JS,l(de(U.value)),1)])])])]),g.value?(t(),s("div",YS,[e("div",GS,[I[85]||(I[85]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",ZS,[e("div",QS,[e("div",XS,[I[70]||(I[70]=e("span",{class:"mr-4"},[me("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",e9,[e("label",t9,[P(e("input",{type:"radio","onUpdate:modelValue":I[11]||(I[11]=F=>r.value=F),value:1,class:"w-4 h-4 mr-1"},null,512),[[bt,r.value]]),I[67]||(I[67]=e("span",null,"核撥申請",-1))]),e("label",s9,[P(e("input",{type:"radio","onUpdate:modelValue":I[12]||(I[12]=F=>r.value=F),value:2,class:"w-4 h-4 mr-1"},null,512),[[bt,r.value]]),I[68]||(I[68]=e("span",null,"電子郵件",-1))]),e("label",a9,[P(e("input",{type:"radio","onUpdate:modelValue":I[13]||(I[13]=F=>r.value=F),value:3,class:"w-4 h-4 mr-1"},null,512),[[bt,r.value]]),I[69]||(I[69]=e("span",null,"電訪",-1))])])]),e("div",o9,[e("div",l9,[P(e("input",{type:"radio","onUpdate:modelValue":I[14]||(I[14]=F=>y.value=F),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[bt,y.value]]),I[71]||(I[71]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:ie}," 回覆職務內容 "),I[72]||(I[72]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",n9,[e("div",r9,[P(e("input",{type:"radio","onUpdate:modelValue":I[15]||(I[15]=F=>y.value=F),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[bt,y.value]]),I[74]||(I[74]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",i9,[I[73]||(I[73]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",d9,[P(e("input",{type:"text","onUpdate:modelValue":I[16]||(I[16]=F=>_.value=F),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[te,_.value]])])])])]),e("div",u9,[e("div",c9,[e("div",null,[I[75]||(I[75]=e("div",{class:"mb-1"},"原機關",-1)),e("div",p9,[P(e("input",{type:"text","onUpdate:modelValue":I[17]||(I[17]=F=>$.value=F),class:"w-full outline-none"},null,512),[[te,$.value]])])]),e("div",null,[I[76]||(I[76]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",v9,[P(e("input",{type:"text","onUpdate:modelValue":I[18]||(I[18]=F=>c.value=F),class:"w-full outline-none"},null,512),[[te,c.value]])]),I[77]||(I[77]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[I[78]||(I[78]=e("div",{class:"mb-1"},"原職系",-1)),e("div",m9,[P(e("input",{type:"text","onUpdate:modelValue":I[19]||(I[19]=F=>R.value=F),class:"w-full outline-none"},null,512),[[te,R.value]])])]),e("div",null,[I[79]||(I[79]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",b9,[P(e("input",{type:"text","onUpdate:modelValue":I[20]||(I[20]=F=>Z.value=F),class:"w-full outline-none"},null,512),[[te,Z.value]])]),I[80]||(I[80]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(y.value)===2?(t(),s("div",f9,[I[84]||(I[84]=e("div",null,[me("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",y9,[e("div",g9,[P(e("input",{type:"radio","onUpdate:modelValue":I[21]||(I[21]=F=>b.value=F),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,b.value]]),I[81]||(I[81]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",x9,[P(e("input",{type:"radio","onUpdate:modelValue":I[22]||(I[22]=F=>b.value=F),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,b.value]]),I[82]||(I[82]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",h9,[P(e("input",{type:"radio","onUpdate:modelValue":I[23]||(I[23]=F=>b.value=F),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[bt,b.value]]),I[83]||(I[83]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",w9,[P(e("input",{type:"text","onUpdate:modelValue":I[24]||(I[24]=F=>p.value=F),class:"w-full outline-none",disabled:Number(b.value)!==3},null,8,_9),[[te,p.value]])])])])])):G("",!0)])]),e("div",k9,[e("button",{class:ee(["px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",{"cursor-not-allowed":!D.value}]),onClick:Be,disabled:!D.value}," 確認 ",10,$9),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:ve}," 取消 ")])])])):G("",!0),f.value?(t(),ps(qs,{key:1,show:f.value,studentId:V.value,initialData:W.value,onClose:I[25]||(I[25]=F=>f.value=!1),onSave:_e},null,8,["show","studentId","initialData"])):G("",!0),H.value?(t(),s("div",C9,[e("div",E9,[I[86]||(I[86]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",S9,[e("div",D9,[e("button",{onClick:I[26]||(I[26]=F=>Ve(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:I[27]||(I[27]=F=>Ve(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:he,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):G("",!0),Et.value?(t(),s("div",M9,[e("div",A9,[I[91]||(I[91]=e("h3",{class:"text-lg font-bold mb-4"},"申請不通過原因",-1)),(t(!0),s(X,null,le(ds.value,F=>(t(),s("div",{key:F.category,class:"mb-4"},[e("span",I9,l(F.category),1),e("div",R9,[(t(!0),s(X,null,le(F.items,oe=>(t(),s("label",{key:oe.modelKey,class:"flex items-center text-sm"},[P(e("input",{type:"checkbox","onUpdate:modelValue":Ie=>_t.value[F.modelGroup][oe.modelKey]=Ie,class:"mr-2"},null,8,P9),[[Ce,_t.value[F.modelGroup][oe.modelKey]]]),me(" "+l(oe.text),1)]))),128))])]))),128)),e("div",U9,[e("label",N9,[I[87]||(I[87]=me(" 三、")),P(e("input",{type:"checkbox","onUpdate:modelValue":I[28]||(I[28]=F=>_t.value.notProjectStudent=F),class:"mr-2"},null,512),[[Ce,_t.value.notProjectStudent]]),I[88]||(I[88]=me("非本計畫學員。 "))])]),e("div",T9,[e("label",V9,[I[89]||(I[89]=me(" 四、")),P(e("input",{type:"checkbox","onUpdate:modelValue":I[29]||(I[29]=F=>_t.value.other=F),class:"mr-2"},null,512),[[Ce,_t.value.other]]),I[90]||(I[90]=me("其他: "))]),P(e("textarea",{"onUpdate:modelValue":I[30]||(I[30]=F=>ts.value=F),disabled:!_t.value.other,class:"w-full p-2 border border-gray-300 rounded-md resize-none",rows:"3",placeholder:"請輸入其他不通過原因"},null,8,j9),[[te,ts.value]])]),e("div",{class:"flex justify-end space-x-4"},[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] rounded-md",onClick:kt},"確定 "),e("button",{class:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400",onClick:Qt},"取消 ")])])])):G("",!0)],64))}},F9=Fe(L9,[["__scopeId","data-v-8f280725"]]),O9={class:"flex flex-col items-center p-6"},q9={class:"w-full max-w-[1500px]"},B9={class:"w-full max-w-[1500px] flex justify-end items-center mt-6 mb-6"},H9=["disabled"],W9={class:"w-full max-w-[1500px]"},z9={class:"overflow-x-auto"},K9={class:"w-full border-collapse"},J9={class:"border p-2"},Y9=["checked"],G9={class:"border p-2 text-center"},Z9=["onUpdate:modelValue"],Q9={class:"border p-2 text-center"},X9={class:"border p-2 text-center"},eD={class:"border p-2 text-center"},tD={class:"border p-2 text-center"},sD={class:"border p-2 text-center"},aD={class:"border p-2 text-center"},oD={class:"border p-2 text-center"},lD={key:0},nD={colspan:"8",class:"border p-4 text-center"},rD={__name:"Remittance",setup(M){const h=We(),d=m(!1),u=m(!1),C=m([]),o=g=>g==null?"$------":`$${g.toLocaleString()}`,N=g=>{switch(parseInt(g)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";default:return"未知狀態"}},K=g=>{switch(typeof g=="string"?parseInt(g):g){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},E=Se(()=>C.value.length>0&&C.value.every(g=>g.selected)),U=g=>{const a=g.target.checked;C.value.forEach(R=>{R.selected=a})},T=async()=>{var g;try{d.value=!0;const a=await Mt.getRemittanceApplications();if(a.data&&a.data.code===0)C.value=a.data.data.map(R=>({id:R.orderId,applyDate:R.applicationDate,orgName:R.agencyName,studentName:R.name,idNumber:R.idNumber,email:R.email,orderNumber:R.caseNumber,bankAccount:R.bankCode==="700"?`${R.bankCode}-${R.branchAccount}`:`${R.bankCode}-${R.branchCode}-${R.branchAccount}`,amount:R.subsidyAmount,status:R.status,selected:!1}));else{const R=((g=a.data)==null?void 0:g.message)||"獲取匯款申請列表失敗，請稍後再試";throw new Error(R)}}catch(a){console.error("獲取匯款申請列表失敗:",a),v.showError("載入失敗",a.message||"獲取匯款申請列表失敗"),C.value=[]}finally{d.value=!1}},z=async()=>{var g;try{const a=C.value.filter($=>$.selected);if(a.length===0){v.showError("貼心提醒","請至少選擇一個匯款申請");return}u.value=!0;const R=a.map($=>({orderId:$.id})),Z=await Mt.createRemittance(R);if(Z.data&&Z.data.code===0)v.showSuccess("貼心提醒","匯款清單已成功儲存"),h.push("/expense-list?tab=remittance");else{const $=((g=Z.data)==null?void 0:g.message)||"儲存匯款清單失敗，請稍後再試";throw new Error($)}}catch(a){console.error("儲存匯款清單失敗:",a),v.showError("儲存失敗",a.message||"儲存匯款清單失敗")}finally{u.value=!1}};return je(()=>{T()}),(g,a)=>(t(),s("div",O9,[e("div",q9,[Ge(ft,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"新增匯款清單",path:"/remittance"}]})]),e("div",B9,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:z,disabled:u.value},l(u.value?"儲存中...":"儲存"),9,H9)]),e("div",W9,[e("div",z9,[e("table",K9,[e("thead",null,[e("tr",null,[e("th",J9,[e("input",{type:"checkbox",onChange:U,checked:E.value,class:"w-4 h-4 cursor-pointer"},null,40,Y9)]),a[0]||(a[0]=e("th",{class:"border p-2"},"申請日期",-1)),a[1]||(a[1]=e("th",{class:"border p-2"},"機關名稱",-1)),a[2]||(a[2]=e("th",{class:"border p-2"},"姓名",-1)),a[3]||(a[3]=e("th",{class:"border p-2"},"單號",-1)),a[4]||(a[4]=e("th",{class:"border p-2"},"匯款帳號",-1)),a[5]||(a[5]=e("th",{class:"border p-2"},"申請金額",-1)),a[6]||(a[6]=e("th",{class:"border p-2"},"申請單狀態",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(C.value,(R,Z)=>(t(),s("tr",{key:R.id,class:ee({"bg-[#F7F7F7]":Z%2===1})},[e("td",G9,[P(e("input",{type:"checkbox","onUpdate:modelValue":$=>R.selected=$,class:"w-4 h-4 cursor-pointer"},null,8,Z9),[[Ce,R.selected]])]),e("td",Q9,l(R.applyDate),1),e("td",X9,l(R.orgName),1),e("td",eD,l(R.studentName),1),e("td",tD,l(R.orderNumber),1),e("td",sD,l(R.bankAccount),1),e("td",aD,l(o(R.amount)),1),e("td",oD,[e("span",{class:ee(["px-2 py-1 rounded text-sm",K(R.status)])},l(N(R.status)),3)])],2))),128)),C.value.length===0?(t(),s("tr",lD,[e("td",nD,l(d.value?"載入中...":"無符合條件的資料"),1)])):G("",!0)])])])])]))}},iD=Fe(rD,[["__scopeId","data-v-2c35235a"]]),dD={class:"flex flex-col items-center p-6"},uD={class:"w-full max-w-[1500px]"},cD={class:"w-full max-w-[1500px] flex justify-end items-center mb-2"},pD=["disabled"],vD=["disabled"],mD=["disabled"],bD={class:"w-full max-w-[1500px] flex justify-between items-center mb-2"},fD={class:"font-medium"},yD={class:"flex items-center"},gD=["value"],xD={class:"w-full max-w-[1500px]"},hD={class:"overflow-x-auto"},wD={class:"w-full border-collapse"},_D={class:"border p-2"},kD=["checked"],$D={class:"border p-2 text-center"},CD=["onUpdate:modelValue"],ED={class:"border p-2 text-center"},SD={class:"border p-2 text-center"},DD={class:"border p-2 text-center"},MD={class:"border p-2 text-center"},AD={class:"border p-2 text-center"},ID={class:"border p-2 text-center"},RD={class:"border p-2 text-center"},PD={class:"border p-2 text-center"},UD={class:"border p-2 text-center"},ND={class:"border p-2 text-center"},TD={class:"border p-2 text-center"},VD={class:"border p-2 text-center"},jD={class:"border p-2 text-center"},LD={key:0},FD={colspan:"14",class:"border p-4 text-center text-gray-500"},OD={class:"flex justify-end mt-4"},qD={class:"text-lg font-medium"},BD={key:0,class:"mt-4 w-full border p-4 bg-gray-50"},HD={class:"whitespace-pre-wrap"},WD={__name:"RemittanceEdit",setup(M){const h=We(),d=rt(),u=m(!1),C=m(!1),o=m(!1),N=m(null),K=m(""),E=m(0),U=m(""),T=m(!0),z=m([]),g=m("1"),a=m([{value:"1",label:"彙整中"},{value:"2",label:"審核中"},{value:"3",label:"已完成"},{value:"4",label:"已撥款"}]),R=m({verificationUpdate:!1,verificationExport:!1}),Z=m(!1),$=m(""),c=async()=>{try{const k=await ot.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?(R.value=k.data.data,console.log("匯款清單編輯頁面權限:",R.value)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},y=k=>{if(!k)return"114年5月";try{const D=k.match(/\d+/);if(D&&D[0]){const j=D[0];if(j.length>=5){const S=j.substring(0,3);let x=j.substring(3,5);return x.startsWith("0")&&(x=x.substring(1)),`${S}年${x}月`}}}catch(D){console.error("提取年月時出錯:",D)}return"114年5月"},r=k=>k==null?"$------":`$${k.toLocaleString()}`,b=Se(()=>z.value.length>0&&z.value.every(k=>k.selected)),p=k=>{const D=k.target.checked;z.value.forEach(j=>{j.selected=D})},_=async()=>{var k;try{u.value=!0,T.value=!0;const D=d.query.id;if(!D)throw new Error("未提供匯款清單ID");N.value=D;const j=await Mt.getRemittanceDetail(D);if(j.data&&j.data.code===0){const S=j.data.data;K.value=S.batchNumber,g.value=String(S.status),E.value=S.totalAmount||0,U.value=S.remark||"",z.value=S.details.map(x=>({id:x.orderId,applyDate:x.applicationDate,orgName:x.agencyName,studentName:x.name,idNumber:x.idNumber,email:x.email,orderNumber:x.caseNumber,schoolName:x.schoolName,trainingStartDate:x.trainingStartDate,trainingEndDate:x.trainingEndDate,courseName:x.courseName,credit:x.credit,singleCreditFee:x.singleCreditFee,creditFee:x.creditFee,subsidyPercent:x.subsidyPercent,subsidyAmount:x.subsidyAmount,status:x.status,selected:!0}))}else{const S=((k=j.data)==null?void 0:k.message)||"獲取匯款清單詳情失敗，請稍後再試";throw new Error(S)}}catch(D){console.error("獲取匯款清單詳情失敗:",D),v.showError("載入失敗",D.message||"獲取匯款清單詳情失敗"),z.value=[]}finally{u.value=!1,setTimeout(()=>{T.value=!1},200)}},f=async()=>{var k;try{const D=z.value.filter(de=>de.selected);if(D.length===0){v.showError("貼心提醒","請至少選擇一個匯款申請");return}const j=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(j===null||j==="")return;if(C.value=!0,(await Mt.confirmPassword(j)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),C.value=!1;return}const x={remittanceId:N.value,status:parseInt(g.value),remark:g.value==="4"?U.value:"",details:D.map(de=>({orderId:de.id}))};console.log("更新匯款清單項目:",x);const L=await Mt.updateRemittance(x);if(L.data&&L.data.code===0)v.showSuccess("貼心提醒","匯款清單已成功儲存"),h.push({path:"/expense-list",query:{tab:"remittance"}});else{const de=((k=L.data)==null?void 0:k.message)||"儲存匯款清單失敗，請稍後再試";throw new Error(de)}}catch(D){console.error("儲存匯款清單失敗:",D),D.response&&D.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("儲存失敗",D.message||"儲存匯款清單失敗")}finally{C.value=!1}},V=async()=>{const k=await v.promptAsync("編輯撥款備註","請修改撥款備註資訊","text",U.value);k!==null&&(U.value=k)};Ee(()=>g.value,async(k,D)=>{if(T.value){$.value=k;return}if(!T.value&&k==="4"&&D!=="4"&&!Z.value){const j=await v.promptAsync("撥款備註","請輸入撥款備註資訊","text",U.value);if(j===null){Z.value=!0,g.value=D,setTimeout(()=>{Z.value=!1},100);return}U.value=j}if(!T.value&&D==="4"&&k!=="4"&&!Z.value&&$.value==="4"&&!await v.confirmAsync("警示","此申請單狀態為已撥款，請確認正確申請單狀態")){Z.value=!0,g.value=D,setTimeout(()=>{Z.value=!1},100);return}}),je(()=>{_(),c()});const W=async()=>{try{if(z.value.length===0){v.showError("貼心提醒","無匯款申請資料可供匯出");return}o.value=!0;const k=await v.promptAsync("請輸入管理員密碼 (提供資安署主計室)","請輸入您的密碼以驗證身份","password");if(k===null||k===""){o.value=!1;return}if((await Mt.confirmPassword(k)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),o.value=!1;return}const j=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(j===null){o.value=!1;return}try{const S={id:N.value,password:j},x=await Mt.exportRemittanceList(S),L=x.headers["content-type"];if(!L||!L.includes("spreadsheetml.sheet")){try{const De=await new Response(x.data).text(),we=JSON.parse(De);console.error("匯出匯款清單失敗：伺服器返回錯誤：",we),v.showError("匯出失敗",we.message||"匯出過程中發生錯誤，請稍後再試")}catch(De){console.error("匯出匯款清單失敗：無法解析回應內容",De),v.showError("匯出失敗","回應格式不正確，請稍後再試")}o.value=!1;return}const de=new Blob([x.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),xe=new Date,fe=`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}-${String(xe.getDate()).padStart(2,"0")}`,ke=document.createElement("a");ke.href=URL.createObjectURL(de),ke.download=`${y(K.value)}補助學員訓練課程費用清單_${fe}.xlsx`,document.body.appendChild(ke),ke.click(),setTimeout(()=>{URL.revokeObjectURL(ke.href),document.body.removeChild(ke),v.showSuccess("貼心提醒","匯款清單已成功下載"),o.value=!1},100)}catch(S){console.error("匯出過程中發生錯誤:",S),v.showError("匯出失敗",S.message||"匯出過程中發生錯誤"),o.value=!1}}catch(k){console.error("匯出匯款清單失敗:",k),v.showError("匯出失敗",k.message||"匯出匯款清單失敗，請稍後再試"),o.value=!1}},H=async()=>{try{if(z.value.length===0){v.showError("貼心提醒","無匯款申請資料可供匯出");return}o.value=!0;const k=await v.promptAsync("請輸入管理員密碼 (提供健行科大主計室)","請輸入您的密碼以驗證身份","password");if(k===null||k===""){o.value=!1;return}if((await Mt.confirmPassword(k)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),o.value=!1;return}const j=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(j===null){o.value=!1;return}const S={id:N.value,password:j},x=await Mt.exportRemittanceDetail(S),L=x.headers["content-type"];if(!L||!L.includes("spreadsheetml.sheet"))try{const we=await new Response(x.data).text(),$e=JSON.parse(we);console.error("匯出匯款詳細清單失敗：伺服器返回錯誤：",$e),v.showError("匯出失敗",$e.message||"匯出過程中發生錯誤，請稍後再試"),o.value=!1;return}catch(we){console.error("匯出匯款詳細清單失敗：無法解析回應內容",we),v.showError("匯出失敗","回應格式不正確，請稍後再試"),o.value=!1;return}const de=new Blob([x.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),xe=document.createElement("a");xe.href=URL.createObjectURL(de);const fe=new Date,ke=`${fe.getFullYear()}-${String(fe.getMonth()+1).padStart(2,"0")}-${String(fe.getDate()).padStart(2,"0")}`,De=`匯款詳細清單_${K.value}_${ke}.xlsx`;xe.download=De,xe.click(),URL.revokeObjectURL(xe.href),v.showSuccess("匯出成功","匯款詳細清單已成功匯出")}catch(k){console.error("匯出匯款詳細清單失敗:",k),k.response&&k.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("匯出失敗",k.message||"匯出匯款詳細清單失敗，請稍後再試")}finally{o.value=!1}};return(k,D)=>(t(),s("div",dD,[e("div",uD,[Ge(ft,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"匯款清單編輯",path:"/remittance-edit"}]})]),e("div",cD,[R.value.verificationUpdate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:f,disabled:C.value},l(C.value?"儲存中...":"儲存"),9,pD)):G("",!0),R.value.verificationExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-2",onClick:W,disabled:o.value},l(o.value?"匯出中...":"列印匯款清單"),9,vD)):G("",!0),R.value.verificationExport?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:H,disabled:o.value},l(o.value?"匯出中...":"匯款資料明細"),9,mD)):G("",!0)]),e("div",bD,[e("div",null,[D[1]||(D[1]=me("批號：")),e("span",fD,l(K.value),1)]),e("div",yD,[D[2]||(D[2]=me(" 匯款清單狀態： ")),P(e("select",{"onUpdate:modelValue":D[0]||(D[0]=j=>g.value=j),class:"ml-2 border border-gray-300 p-1 outline-none"},[(t(!0),s(X,null,le(a.value,j=>(t(),s("option",{key:j.value,value:j.value},l(j.label),9,gD))),128))],512),[[Pe,g.value]])])]),e("div",xD,[e("div",hD,[e("table",wD,[e("thead",null,[e("tr",null,[e("th",_D,[e("input",{type:"checkbox",onChange:p,checked:b.value,class:"w-4 h-4 cursor-pointer"},null,40,kD)]),D[3]||(D[3]=e("th",{class:"border p-2"},"序號",-1)),D[4]||(D[4]=e("th",{class:"border p-2"},"申請日期",-1)),D[5]||(D[5]=e("th",{class:"border p-2"},"姓名",-1)),D[6]||(D[6]=e("th",{class:"border p-2"},"機關名稱",-1)),D[7]||(D[7]=e("th",{class:"border p-2"},"申請表編號",-1)),D[8]||(D[8]=e("th",{class:"border p-2"},"訓練單位",-1)),D[9]||(D[9]=e("th",{class:"border p-2"},"課程起訖",-1)),D[10]||(D[10]=e("th",{class:"border p-2"},"課程名稱",-1)),D[11]||(D[11]=e("th",{class:"border p-2"},"學分數/職能科數",-1)),D[12]||(D[12]=e("th",{class:"border p-2"},"每學分費/每科費用",-1)),D[13]||(D[13]=e("th",{class:"border p-2"},"合計學分(職能)費用",-1)),D[14]||(D[14]=e("th",{class:"border p-2"},"核撥比例",-1)),D[15]||(D[15]=e("th",{class:"border p-2"},"核撥金額",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(z.value,(j,S)=>(t(),s("tr",{key:j.id,class:ee({"bg-[#F7F7F7]":S%2===1})},[e("td",$D,[P(e("input",{type:"checkbox","onUpdate:modelValue":x=>j.selected=x,class:"w-4 h-4 cursor-pointer"},null,8,CD),[[Ce,j.selected]])]),e("td",ED,l(S+1),1),e("td",SD,l(j.applyDate),1),e("td",DD,l(j.studentName),1),e("td",MD,l(j.orgName),1),e("td",AD,l(j.orderNumber),1),e("td",ID,l(j.schoolName),1),e("td",RD,l(j.trainingStartDate)+" ~ "+l(j.trainingEndDate),1),e("td",PD,l(j.courseName),1),e("td",UD,l(j.credit),1),e("td",ND,l(r(j.singleCreditFee)),1),e("td",TD,l(r(j.creditFee)),1),e("td",VD,l(j.subsidyPercent)+"%",1),e("td",jD,l(r(j.subsidyAmount)),1)],2))),128)),z.value.length===0?(t(),s("tr",LD,[e("td",FD,l(u.value?"載入中...":"無匯款申請資料"),1)])):G("",!0)])])]),e("div",OD,[e("div",qD,[D[16]||(D[16]=me(" 合計申請金額：")),e("span",null,l(r(E.value)),1)])]),g.value==="4"&&U.value?(t(),s("div",BD,[e("div",{class:"flex justify-between items-center mb-2"},[D[17]||(D[17]=e("div",{class:"font-medium"},"撥款備註：",-1)),e("button",{onClick:V,class:"px-2 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded"}," 編輯備註 ")]),e("div",HD,l(U.value),1)])):G("",!0)])]))}},zD=Fe(WD,[["__scopeId","data-v-8f80f8d9"]]),us={getRoleList:(M={})=>(M.page&&(M.page=Number(M.page)),M.limit?M.limit=Number(M.limit):M.limit=20,be.get("/v1/role",{params:M})),createRole:M=>be.post("/v1/role",M),updateRole:(M,h)=>be.put(`/v1/role/${M}`,h),deleteRole:M=>be.delete(`/v1/role/${M}`),getRolePermissions:M=>be.get(`/v1/role/${M}`),updateRolePermissions:(M,h)=>be.put(`/v1/role/permission/${M}`,h),getLogs:(M={})=>{if(M.page&&(M.page=Number(M.page)),M.limit?M.limit=Number(M.limit):M.limit=20,M.startTime&&M.endTime&&(M.dateRange=[M.startTime,M.endTime],delete M.startTime,delete M.endTime),M.logLevel){let h;switch(M.logLevel){case"DEBUG":h=1;break;case"INFO":h=2;break;case"WARNING":h=3;break;case"ERROR":h=4;break;default:h=null}h&&(M.level=h),delete M.logLevel}return be.get("/v1/logs",{params:M})},exportLogs:(M={})=>be.get("/v1/logs/export",{params:M,responseType:"blob"}),exportDatabase:M=>be.post("/v1/export",M,{responseType:"blob"}),exportDump:()=>be.get("/v1/export/dump",{responseType:"blob"})},KD={class:"flex flex-col items-center p-6"},JD={class:"w-full max-w-[1500px]"},YD={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},GD={class:"w-full max-w-[1500px] overflow-auto"},ZD={key:0,class:"flex justify-center items-center py-10"},QD={key:1,class:"w-full border-collapse"},XD={class:"border p-2 text-center"},eM={class:"border p-2 text-center"},tM=["aria-label"],sM={class:"border p-2 text-center"},aM={class:"border p-2 text-center"},oM={class:"border p-2 text-center"},lM={class:"border p-2 text-center"},nM={class:"border p-2 text-center"},rM=["onClick","aria-label"],iM=["onClick","aria-label"],dM=["onClick","aria-label"],uM={key:0},cM={key:2,class:"flex justify-center items-center space-x-2 mt-6"},pM=["disabled"],vM=["onClick","aria-label","aria-current"],mM={key:1,class:"px-2"},bM=["disabled"],fM={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},yM={class:"bg-white p-6 rounded-lg shadow-lg w-[400px]"},gM={class:"text-lg font-bold mb-4"},xM={class:"mb-4"},hM={class:"mb-4"},wM={for:"roleEnabled",class:"flex items-center cursor-pointer"},_M={class:"switch"},zs=20,kM={__name:"RolePermissions",setup(M){const h=m(!1),d=We(),u=m([]),C=m(1),o=m(1),N=m(0),K=Se(()=>{const j=[];if(o.value<=5)for(let x=1;x<=o.value;x++)j.push(x);else{j.push(1);let x=Math.max(2,C.value-1),L=Math.min(o.value-1,C.value+1);C.value<=3&&(L=Math.min(4,o.value-1)),C.value>=o.value-2&&(x=Math.max(2,o.value-3)),x>2&&j.push("...");for(let de=x;de<=L;de++)j.push(de);L<o.value-1&&j.push("..."),j.push(o.value)}return j}),E=m(!1),U=m("新增角色"),T=m({id:null,name:"",isEnabled:!0,createdBy:"admin",createdAt:"",updatedBy:"admin",updatedAt:""}),z=m(!1),g=m({roleCreate:!1,roleUpdate:!1,roleDelete:!1}),a=async()=>{try{const j=await ot.getSidebarPermissions();j.data.code===0&&j.data.message==="success"?(g.value=j.data.data,console.log("角色權限管理頁面權限:",g.value)):console.error("獲取權限失敗:",j.data.message)}catch(j){console.error("獲取權限錯誤:",j)}},R=()=>{z.value=!1,U.value="新增角色",T.value={id:null,name:"",isEnabled:!0,createdBy:"admin",createdAt:"",updatedBy:"admin",updatedAt:""},E.value=!0},Z=()=>{E.value=!1},$=j=>{Z();const S=j?"角色已成功更新":"角色已成功新增";v.showSuccess(j?"更新成功":"新增成功",S),setTimeout(async()=>{await D()},300)},c=(j,S)=>{var L;const x=((L=j.data)==null?void 0:L.message)||(S?"角色更新失敗":"角色新增失敗");v.showError(S?"更新失敗":"新增失敗",x)},y=async()=>{if(!T.value.name){v.showError("儲存失敗","請輸入角色名稱");return}try{let j;z.value?j=await us.updateRole(T.value.id,T.value):j=await us.createRole(T.value),j.data&&j.data.code===0?$(z.value):c(j,z.value)}catch(j){console.error(z.value?"更新角色錯誤:":"新增角色錯誤:",j),v.showError(z.value?"更新失敗":"新增失敗","操作時發生錯誤，請稍後再試")}},r=j=>{z.value=!0,U.value="編輯角色",T.value={...j},E.value=!0},b=async()=>{const j=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");return j===null||j===""?null:(await is.confirmPassword(j)).data.code!==0?(v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),null):!0},p=async j=>{var L;const S=await us.deleteRole(j);if(S.data&&S.data.code===0)return v.showSuccess("刪除成功","角色已成功刪除"),setTimeout(async()=>{await D()},300),!0;const x=((L=S.data)==null?void 0:L.message)||"角色刪除失敗";return v.showError("刪除失敗",x),!1},_=j=>{console.error("刪除角色錯誤:",j),j.response&&j.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除角色時發生錯誤，請稍後再試")},f=async j=>{if(await v.confirmAsync("確認刪除",`確定要刪除角色「${j.name}」嗎？`))try{if(await b()===null)return;await p(j.id)}catch(x){_(x)}},V=j=>{d.push({name:"PermissionSettings",query:{roleId:j.id,roleName:j.name}})},W=j=>{j!==C.value&&!h.value&&(C.value=j,D())},H=()=>{C.value>1&&!h.value&&(C.value--,D())},k=()=>{C.value<o.value&&!h.value&&(C.value++,D())},D=async()=>{var j,S;try{h.value=!0;const x={page:C.value,limit:zs},L=await us.getRoleList(x);if(L.data&&L.data.code===0)u.value=L.data.data.result||[],N.value=L.data.data.totalCount||0,o.value=L.data.data.totalPage||Math.ceil(N.value/zs)||1,C.value>o.value&&o.value>0&&(C.value=1,await D());else if(console.error("獲取角色列表失敗:",(j=L.data)==null?void 0:j.message),u.value=[],N.value=0,o.value=0,!z.value){const de=((S=L.data)==null?void 0:S.message)||"獲取角色列表失敗";v.showError("載入失敗",de)}}catch(x){console.error("獲取角色列表錯誤:",x),u.value=[],N.value=0,o.value=0,z.value||v.showError("載入失敗","獲取角色列表錯誤，請稍後再試")}finally{h.value=!1}};return je(()=>{D(),a()}),(j,S)=>(t(),s("div",KD,[e("div",JD,[Ge(ft,{breadcrumbs:[{name:"角色管理",path:"/role-permissions"}]})]),e("div",YD,[g.value.roleCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:R,"aria-label":"新增角色"}," 新增角色 ")):G("",!0)]),e("div",GD,[h.value?(t(),s("div",ZD,S[2]||(S[2]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",QD,[S[4]||(S[4]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"角色名稱"),e("th",{class:"border p-2"},"啟用"),e("th",{class:"border p-2"},"建立人"),e("th",{class:"border p-2"},"建立日期"),e("th",{class:"border p-2"},"修改人"),e("th",{class:"border p-2"},"修改日期"),e("th",{class:"border p-2"},"功能")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(u.value,(x,L)=>(t(),s("tr",{key:L,class:"hover:bg-gray-100"},[e("td",XD,l(x.name),1),e("td",eM,[e("span",{class:ee({"text-[#4e9875] font-medium":x.isEnabled,"text-gray-500":!x.isEnabled}),"aria-label":`角色 ${x.name} ${x.isEnabled?"已啟用":"未啟用"}`},l(x.isEnabled?"啟用":"不啟用"),11,tM)]),e("td",sM,l(x.createdBy||"-"),1),e("td",aM,l(x.createdAt||"-"),1),e("td",oM,l(x.updatedBy||"-"),1),e("td",lM,l(x.updatedAt||"-"),1),e("td",nM,[g.value.roleUpdate?(t(),s("button",{key:0,class:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded mr-1",onClick:de=>r(x),"aria-label":`編輯角色 ${x.name}`}," 編輯 ",8,rM)):G("",!0),g.value.roleDelete?(t(),s("button",{key:1,class:"px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded mr-1",onClick:de=>f(x),"aria-label":`刪除角色 ${x.name}`}," 刪除 ",8,iM)):G("",!0),g.value.roleUpdate?(t(),s("button",{key:2,class:"px-2 py-1 bg-[#4e9875] hover:bg-[#3d7a5d] text-white rounded",onClick:de=>V(x),"aria-label":`設定角色 ${x.name} 的權限`}," 權限設定 ",8,dM)):G("",!0)])]))),128)),u.value.length===0?(t(),s("tr",uM,S[3]||(S[3]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無資料",-1)]))):G("",!0)])])),!h.value&&u.value.length>0?(t(),s("div",cM,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:C.value===1,onClick:H,"aria-label":"前往上一頁"}," 上一頁 ",8,pM),(t(!0),s(X,null,le(K.value,x=>(t(),s(X,{key:x},[x!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":x===C.value}]),onClick:L=>W(x),"aria-label":`前往第${x}頁`,"aria-current":x===C.value?"page":void 0},l(x),11,vM)):(t(),s("span",mM,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:C.value===o.value,onClick:k,"aria-label":"前往下一頁"}," 下一頁 ",8,bM)])):G("",!0)]),E.value?(t(),s("div",fM,[e("div",yM,[e("h2",gM,l(U.value),1),e("div",xM,[S[5]||(S[5]=e("label",{class:"block text-gray-700 mb-2",for:"roleName"},"角色名稱",-1)),P(e("input",{id:"roleName",type:"text","onUpdate:modelValue":S[0]||(S[0]=x=>T.value.name=x),class:"w-full border border-gray-300 p-2 rounded",placeholder:"請輸入角色名稱"},null,512),[[te,T.value.name]])]),e("div",hM,[e("label",wM,[S[7]||(S[7]=e("span",{class:"text-gray-700 mr-4"},"啟用狀態",-1)),e("span",_M,[P(e("input",{id:"roleEnabled",type:"checkbox","onUpdate:modelValue":S[1]||(S[1]=x=>T.value.isEnabled=x)},null,512),[[Ce,T.value.isEnabled]]),S[6]||(S[6]=e("span",{class:"slider round"},null,-1))])])]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded mr-2",onClick:Z,"aria-label":"取消操作"}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded",onClick:y,"aria-label":"儲存角色設定"}," 確定 ")])])])):G("",!0)]))}},$M=Fe(kM,[["__scopeId","data-v-e7dd6600"]]),CM={class:"flex flex-col items-center p-6"},EM={class:"w-full max-w-[1500px]"},SM={class:"w-full max-w-[1500px] bg-white rounded shadow-sm"},DM={class:"border-b border-gray-200 p-4"},MM={class:"flex items-center mb-4"},AM={class:"switch ml-2",for:"review-management-toggle"},IM={class:"ml-32 border rounded p-4 mb-2"},RM={class:"flex items-center mb-4"},PM={class:"switch ml-2",for:"review-list-toggle"},UM={class:"ml-32"},NM={class:"flex flex-wrap"},TM={class:"flex items-center mx-4 my-2"},VM={class:"flex items-center mx-4 my-2"},jM={class:"flex items-center mx-4 my-2"},LM={class:"flex items-center mx-4 my-2"},FM={class:"border-b border-gray-200 p-4"},OM={class:"flex items-center mb-4"},qM={class:"switch ml-2",for:"course-management-toggle"},BM={class:"ml-32 border rounded p-4 mb-2"},HM={class:"flex items-center mb-4"},WM={class:"switch ml-2",for:"course-content-toggle"},zM={class:"ml-32"},KM={class:"flex flex-wrap"},JM={class:"flex items-center mx-4 my-2"},YM={class:"flex items-center mx-4 my-2"},GM={class:"flex items-center mx-4 my-2"},ZM={class:"flex items-center mx-4 my-2"},QM={class:"flex items-center mx-4 my-2"},XM={class:"flex items-center mb-4"},eA={class:"switch ml-2",for:"supervision-visits-toggle"},tA={class:"ml-32"},sA={class:"flex flex-wrap"},aA={class:"flex items-center mx-4 my-2"},oA={class:"flex items-center mx-4 my-2"},lA={class:"flex items-center mx-4 my-2"},nA={class:"flex items-center mb-4"},rA={class:"switch ml-2",for:"satisfaction-survey-toggle"},iA={class:"ml-32"},dA={class:"flex flex-wrap"},uA={class:"flex items-center mx-4 my-2"},cA={class:"border-b border-gray-200 p-4"},pA={class:"flex items-center mb-4"},vA={class:"switch ml-2",for:"student-management-toggle"},mA={class:"ml-32 border rounded p-4 mb-2"},bA={class:"flex items-center mb-4"},fA={class:"switch ml-2",for:"student-info-toggle"},yA={class:"ml-32"},gA={class:"flex flex-wrap"},xA={class:"flex items-center mx-4 my-2"},hA={class:"flex items-center mx-4 my-2"},wA={class:"flex items-center mx-4 my-2"},_A={class:"flex items-center mx-4 my-2"},kA={class:"flex items-center mx-4 my-2"},$A={class:"flex items-center mx-4 my-2"},CA={class:"flex items-center mb-4"},EA={class:"switch ml-2",for:"learning-history-toggle"},SA={class:"flex items-center mb-4"},DA={class:"switch ml-2",for:"credit-recognition-toggle"},MA={class:"ml-32"},AA={class:"flex flex-wrap"},IA={class:"flex items-center mx-4 my-2"},RA={class:"flex items-center mx-4 my-2"},PA={class:"flex items-center mb-4"},UA={class:"switch ml-2",for:"agency-management-toggle"},NA={class:"ml-32"},TA={class:"flex flex-wrap"},VA={class:"flex items-center mx-4 my-2"},jA={class:"flex items-center mx-4 my-2"},LA={class:"flex items-center mx-4 my-2"},FA={class:"flex items-center mb-4"},OA={class:"switch ml-2",for:"student-is-non-project-toggle"},qA={class:"border-b border-gray-200 p-4"},BA={class:"flex items-center mb-4"},HA={class:"switch ml-2",for:"verification-management-toggle"},WA={class:"ml-32 border rounded p-4 mb-2"},zA={class:"flex items-center mb-4"},KA={class:"switch ml-2",for:"expense-toggle"},JA={class:"ml-32"},YA={class:"flex flex-wrap"},GA={class:"flex items-center mx-4 my-2"},ZA={class:"flex items-center mx-4 my-2"},QA={class:"flex items-center mx-4 my-2"},XA={class:"border-b border-gray-200 p-4"},eI={class:"flex items-center mb-4"},tI={class:"switch ml-2",for:"performance-tracking-toggle"},sI={class:"ml-32 border rounded p-4 mb-2"},aI={class:"flex items-center mb-4"},oI={class:"switch ml-2",for:"tracking-management-toggle"},lI={class:"ml-32"},nI={class:"flex flex-wrap"},rI={class:"flex items-center mx-4 my-2"},iI={class:"border-b border-gray-200 p-4"},dI={class:"flex items-center mb-4"},uI={class:"switch ml-2",for:"consultation-service-toggle"},cI={class:"ml-32 border rounded p-4 mb-2"},pI={class:"flex items-center mb-4"},vI={class:"switch ml-2",for:"question-management-toggle"},mI={class:"ml-32"},bI={class:"flex flex-wrap"},fI={class:"flex items-center mx-4 my-2"},yI={class:"flex items-center mx-4 my-2"},gI={class:"flex items-center mx-4 my-2"},xI={class:"flex items-center mx-4 my-2"},hI={class:"flex items-center mx-4 my-2"},wI={class:"flex items-center mb-4"},_I={class:"switch ml-2",for:"category-management-toggle"},kI={class:"ml-32"},$I={class:"flex flex-wrap"},CI={class:"flex items-center mx-4 my-2"},EI={class:"flex items-center mx-4 my-2"},SI={class:"flex items-center mx-4 my-2"},DI={class:"border-b border-gray-200 p-4"},MI={class:"flex items-center mb-4"},AI={class:"switch ml-2",for:"statistical-reports-toggle"},II={class:"border-b border-gray-200 p-4"},RI={class:"flex items-center mb-4"},PI={class:"switch ml-2",for:"dashboard-toggle"},UI={class:"border-b border-gray-200 p-4"},NI={class:"flex items-center mb-4"},TI={class:"switch ml-2",for:"tool-management-toggle"},VI={class:"ml-32 border rounded p-4 mb-2"},jI={class:"flex items-center mb-4"},LI={class:"switch ml-2",for:"file-manager-toggle"},FI={class:"ml-32"},OI={class:"flex flex-wrap"},qI={class:"flex items-center mx-4 my-2"},BI={class:"flex items-center mx-4 my-2"},HI={class:"flex items-center mx-4 my-2"},WI={class:"border-b border-gray-200 p-4"},zI={class:"flex items-center mb-4"},KI={class:"switch ml-2",for:"system-management-toggle"},JI={class:"ml-32 border rounded p-4 mb-2"},YI={class:"flex items-center mb-4"},GI={class:"switch ml-2",for:"role-management-toggle"},ZI={class:"ml-32"},QI={class:"flex flex-wrap"},XI={class:"flex items-center mx-4 my-2"},eR={class:"flex items-center mx-4 my-2"},tR={class:"flex items-center mx-4 my-2"},sR={class:"flex items-center mb-4"},aR={class:"switch ml-2",for:"role-permission-toggle"},oR={class:"ml-32"},lR={class:"flex flex-wrap"},nR={class:"flex items-center mx-4 my-2"},rR={class:"flex items-center mx-4 my-2"},iR={class:"flex items-center mx-4 my-2"},dR={class:"flex items-center mb-4"},uR={class:"switch ml-2",for:"system-log-toggle"},cR={class:"ml-32"},pR={class:"flex flex-wrap"},vR={class:"flex items-center mx-4 my-2"},mR={class:"flex items-center mb-4"},bR={class:"switch ml-2",for:"database-management-toggle"},fR={class:"ml-32"},yR={class:"flex flex-wrap"},gR={class:"flex items-center mx-4 my-2"},xR={__name:"PermissionSettings",setup(M){const h=rt(),d=We(),u=m(h.query.roleId||null),C=m(h.query.roleName||""),o=Gs({reviewManagement:{enabled:!0,edit:!0,approve:!0,import:!0,export:!0,reviewList:{enabled:!0}},courseManagement:{enabled:!0,courseContent:{enabled:!0,create:!0,edit:!0,delete:!0,import:!0,export:!0},supervisionVisits:{enabled:!0,create:!0,edit:!0,export:!0},satisfactionSurvey:{enabled:!0,import:!0}},studentManagement:{enabled:!0,studentInfo:{enabled:!0,create:!0,edit:!0,delete:!0,import:!0,export:!0,studentExportWord:!0},learningHistory:{enabled:!0},creditRecognition:{enabled:!0,create:!0,export:!0},agency:{enabled:!0,create:!0,edit:!0,delete:!0},isNonProject:!0},verificationManagement:{enabled:!0,expense:{enabled:!0,create:!0,edit:!0,export:!0}},performanceTracking:{enabled:!0,management:{enabled:!0,edit:!0}},consultationService:{enabled:!0,questionManagement:{enabled:!0,create:!0,edit:!0,delete:!0,readDetail:!0,import:!0},categoryManagement:{enabled:!0,create:!0,edit:!0,delete:!0}},dashboard:{enabled:!0},toolManagement:{enabled:!0,fileManager:{enabled:!0,create:!0,upload:!0,delete:!0}},systemManagement:{enabled:!0,roleManagement:{enabled:!0,create:!0,edit:!0,delete:!0},rolePermission:{enabled:!0,create:!0,edit:!0,delete:!0},log:{enabled:!0,export:!0},databaseManagement:{enabled:!0,export:!0}},reportAllRead:{enabled:!0}}),N=m(!1),K=async g=>{if(g)try{N.value=!0;const a=await us.getRolePermissions(g);a.data.code===0?(E(a.data.data),console.log("角色權限已載入",o)):(console.error("獲取角色權限設定錯誤:",a.data.message),v.showError("載入失敗","獲取權限設定發生錯誤，請稍後再試"))}catch(a){console.error("獲取角色權限設定錯誤:",a),v.showError("載入失敗","獲取權限設定發生錯誤，請稍後再試")}finally{N.value=!1}},E=g=>{o.reviewManagement.enabled=g.reviewManagement||!1,o.reviewManagement.edit=g.reviewManagementEdit||!1,o.reviewManagement.approve=g.reviewManagementApprove||!1,o.reviewManagement.import=g.reviewManagementImport||!1,o.reviewManagement.reviewList.enabled=g.reviewManagementRead||!1,o.reviewManagement.export=g.reviewManagementExport||!1,o.courseManagement.enabled=g.courseManagement||!1,o.courseManagement.courseContent.enabled=g.courseDataRead||!1,o.courseManagement.courseContent.create=g.courseDataCreate||!1,o.courseManagement.courseContent.edit=g.courseDataUpdate||!1,o.courseManagement.courseContent.delete=g.courseDataDelete||!1,o.courseManagement.courseContent.import=g.courseDataImport||!1,o.courseManagement.courseContent.export=g.courseDataExport||!1,o.courseManagement.supervisionVisits.enabled=g.visitRead||!1,o.courseManagement.supervisionVisits.create=g.visitCreate||!1,o.courseManagement.supervisionVisits.edit=g.visitUpdate||!1,o.courseManagement.supervisionVisits.export=g.visitExport||!1,o.courseManagement.satisfactionSurvey.enabled=g.satisfactionRead||!1,o.courseManagement.satisfactionSurvey.import=g.satisfactionSurveyImport||!1,o.studentManagement.enabled=g.studentManagement||!1,o.studentManagement.studentInfo.enabled=g.studentRead||!1,o.studentManagement.studentInfo.create=g.studentCreate||!1,o.studentManagement.studentInfo.edit=g.studentUpdate||!1,o.studentManagement.studentInfo.delete=g.studentDelete||!1,o.studentManagement.studentInfo.import=g.studentImport||!1,o.studentManagement.studentInfo.export=g.studentExport||!1,o.studentManagement.studentInfo.studentExportWord=g.studentExportWord||!1,o.studentManagement.learningHistory.enabled=g.learningHistory||!1,o.studentManagement.creditRecognition.enabled=g.creditCertificationRead||!1,o.studentManagement.creditRecognition.create=g.creditCertificationCreate||!1,o.studentManagement.creditRecognition.export=g.creditCertificationImport||!1,o.studentManagement.agency.enabled=g.agencyRead||!1,o.studentManagement.agency.create=g.agencyCreate||!1,o.studentManagement.agency.edit=g.agencyUpdate||!1,o.studentManagement.agency.delete=g.agencyDelete||!1,o.studentManagement.isNonProject=g.studentIsNonProject||!1,o.verificationManagement.enabled=g.verificationManagement||!1,o.verificationManagement.expense.enabled=g.verificationRead||!1,o.verificationManagement.expense.create=g.verificationCreate||!1,o.verificationManagement.expense.edit=g.verificationUpdate||!1,o.verificationManagement.expense.export=g.verificationExport||!1,o.performanceTracking.enabled=g.performanceTracking||!1,o.performanceTracking.management.enabled=g.performanceTrackingRead||!1,o.performanceTracking.management.edit=g.performanceTrackingEdit||!1,o.consultationService.enabled=g.consultationService||!1,o.consultationService.questionManagement.enabled=g.consultationRead||!1,o.consultationService.questionManagement.create=g.consultationCreate||!1,o.consultationService.questionManagement.edit=g.consultationUpdate||!1,o.consultationService.questionManagement.delete=g.consultationDelete||!1,o.consultationService.questionManagement.readDetail=g.consultationReadDetail||!1,o.consultationService.questionManagement.import=g.consultationImport||!1,o.consultationService.categoryManagement.enabled=g.consultationCategoryRead||!1,o.consultationService.categoryManagement.create=g.consultationCategoryCreate||!1,o.consultationService.categoryManagement.edit=g.consultationCategoryEdit||!1,o.consultationService.categoryManagement.delete=g.consultationCategoryDelete||!1,o.dashboard.enabled=g.dashboard||!1,o.toolManagement.enabled=g.tool||!1,o.toolManagement.fileManager.enabled=g.fileManager||!1,o.toolManagement.fileManager.create=g.fileManagerCreate||!1,o.toolManagement.fileManager.upload=g.fileManagerUpload||!1,o.toolManagement.fileManager.delete=g.fileManagerDelete||!1,o.systemManagement.enabled=g.systemManagement||!1,o.systemManagement.roleManagement.enabled=g.userRead||!1,o.systemManagement.roleManagement.create=g.userCreate||!1,o.systemManagement.roleManagement.edit=g.userUpdate||!1,o.systemManagement.roleManagement.delete=g.userDelete||!1,o.systemManagement.rolePermission.enabled=g.roleRead||!1,o.systemManagement.rolePermission.create=g.roleCreate||!1,o.systemManagement.rolePermission.edit=g.roleUpdate||!1,o.systemManagement.rolePermission.delete=g.roleDelete||!1,o.systemManagement.log.enabled=g.systemLogRead||!1,o.systemManagement.log.export=g.systemLogExport||!1,o.systemManagement.databaseManagement.enabled=g.dataBaseRead||!1,o.systemManagement.databaseManagement.export=g.dataBaseExport||!1,o.reportAllRead.enabled=g.reportAllRead||!1},U=()=>({reviewManagement:o.reviewManagement.enabled,reviewManagementRead:o.reviewManagement.reviewList.enabled,reviewManagementEdit:o.reviewManagement.edit,reviewManagementApprove:o.reviewManagement.approve,reviewManagementImport:o.reviewManagement.import,reviewManagementExport:o.reviewManagement.export,courseManagement:o.courseManagement.enabled,courseDataCreate:o.courseManagement.courseContent.create,courseDataUpdate:o.courseManagement.courseContent.edit,courseDataDelete:o.courseManagement.courseContent.delete,courseDataImport:o.courseManagement.courseContent.import,courseDataExport:o.courseManagement.courseContent.export,courseDataRead:o.courseManagement.courseContent.enabled,visitCreate:o.courseManagement.supervisionVisits.create,visitUpdate:o.courseManagement.supervisionVisits.edit,visitExport:o.courseManagement.supervisionVisits.export,visitRead:o.courseManagement.supervisionVisits.enabled,satisfactionSurveyImport:o.courseManagement.satisfactionSurvey.import,satisfactionRead:o.courseManagement.satisfactionSurvey.enabled,studentManagement:o.studentManagement.enabled,studentCreate:o.studentManagement.studentInfo.create,studentUpdate:o.studentManagement.studentInfo.edit,studentDelete:o.studentManagement.studentInfo.delete,studentImport:o.studentManagement.studentInfo.import,studentExport:o.studentManagement.studentInfo.export,studentExportWord:o.studentManagement.studentInfo.studentExportWord,studentRead:o.studentManagement.studentInfo.enabled,learningHistory:o.studentManagement.learningHistory.enabled,creditCertificationImport:o.studentManagement.creditRecognition.export,creditCertificationCreate:o.studentManagement.creditRecognition.create,creditCertificationRead:o.studentManagement.creditRecognition.enabled,agencyRead:o.studentManagement.agency.enabled,agencyCreate:o.studentManagement.agency.create,agencyUpdate:o.studentManagement.agency.edit,agencyDelete:o.studentManagement.agency.delete,studentIsNonProject:o.studentManagement.isNonProject,verificationManagement:o.verificationManagement.enabled,verificationCreate:o.verificationManagement.expense.create,verificationUpdate:o.verificationManagement.expense.edit,verificationExport:o.verificationManagement.expense.export,verificationRead:o.verificationManagement.expense.enabled,performanceTracking:o.performanceTracking.enabled,performanceTrackingRead:o.performanceTracking.management.enabled,performanceTrackingEdit:o.performanceTracking.management.edit,consultationService:o.consultationService.enabled,consultationCreate:o.consultationService.questionManagement.create,consultationUpdate:o.consultationService.questionManagement.edit,consultationDelete:o.consultationService.questionManagement.delete,consultationRead:o.consultationService.questionManagement.enabled,consultationReadDetail:o.consultationService.questionManagement.readDetail,consultationImport:o.consultationService.questionManagement.import,consultationCategoryRead:o.consultationService.categoryManagement.enabled,consultationCategoryCreate:o.consultationService.categoryManagement.create,consultationCategoryEdit:o.consultationService.categoryManagement.edit,consultationCategoryDelete:o.consultationService.categoryManagement.delete,dashboard:o.dashboard.enabled,tool:o.toolManagement.enabled,fileManager:o.toolManagement.fileManager.enabled,fileManagerCreate:o.toolManagement.fileManager.create,fileManagerUpload:o.toolManagement.fileManager.upload,fileManagerDelete:o.toolManagement.fileManager.delete,systemManagement:o.systemManagement.enabled,userCreate:o.systemManagement.roleManagement.create,userUpdate:o.systemManagement.roleManagement.edit,userDelete:o.systemManagement.roleManagement.delete,userRead:o.systemManagement.roleManagement.enabled,roleCreate:o.systemManagement.rolePermission.create,roleUpdate:o.systemManagement.rolePermission.edit,roleDelete:o.systemManagement.rolePermission.delete,roleRead:o.systemManagement.rolePermission.enabled,systemLogRead:o.systemManagement.log.enabled,systemLogExport:o.systemManagement.log.export,dataBaseRead:o.systemManagement.databaseManagement.enabled,dataBaseExport:o.systemManagement.databaseManagement.export,reportAllRead:o.reportAllRead.enabled}),T=async()=>{try{if(!u.value){v.showError("儲存失敗","無法識別角色ID，請返回角色列表重新選擇");return}N.value=!0;const g=U(),a=await us.updateRolePermissions(u.value,g);a.data.code===0?(v.showSuccess("儲存成功","權限設定已成功儲存"),d.push("/role-permissions"),UH()):(console.error("儲存權限設定錯誤:",a.data.message),v.showError("儲存失敗",a.data.message||"儲存權限設定發生錯誤，請稍後再試"))}catch(g){console.error("儲存權限設定錯誤:",g),v.showError("儲存失敗","儲存權限設定發生錯誤，請稍後再試")}finally{N.value=!1}},z=()=>{v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會丟失。").then(g=>{g&&(K(u.value),d.push("/role-permissions"))})};return Ee(()=>o.toolManagement.enabled,g=>{g||(o.toolManagement.fileManager.enabled=!1)}),Ee(()=>o.toolManagement.fileManager.enabled,g=>{g?o.toolManagement.enabled=!0:(o.toolManagement.fileManager.create=!1,o.toolManagement.fileManager.upload=!1,o.toolManagement.fileManager.delete=!1)}),Ee([()=>o.toolManagement.fileManager.create,()=>o.toolManagement.fileManager.upload,()=>o.toolManagement.fileManager.delete],g=>{g.some(a=>a)&&(o.toolManagement.enabled=!0,o.toolManagement.fileManager.enabled=!0)}),Ee(()=>o.reviewManagement.enabled,g=>{g||(o.reviewManagement.reviewList.enabled=!1,o.reviewManagement.edit=!1,o.reviewManagement.approve=!1,o.reviewManagement.import=!1,o.reviewManagement.export=!1)}),Ee(()=>o.reviewManagement.reviewList.enabled,g=>{g?o.reviewManagement.enabled=!0:(o.reviewManagement.edit=!1,o.reviewManagement.approve=!1,o.reviewManagement.import=!1,o.reviewManagement.export=!1)}),Ee([()=>o.reviewManagement.edit,()=>o.reviewManagement.approve,()=>o.reviewManagement.import,()=>o.reviewManagement.export],g=>{g.some(a=>a)&&(o.reviewManagement.enabled=!0,o.reviewManagement.reviewList.enabled=!0)}),Ee(()=>o.courseManagement.enabled,g=>{g||(o.courseManagement.courseContent.enabled=!1,o.courseManagement.supervisionVisits.enabled=!1,o.courseManagement.satisfactionSurvey.enabled=!1)}),Ee(()=>o.courseManagement.courseContent.enabled,g=>{g?o.courseManagement.enabled=!0:(o.courseManagement.courseContent.create=!1,o.courseManagement.courseContent.edit=!1,o.courseManagement.courseContent.delete=!1,o.courseManagement.courseContent.import=!1,o.courseManagement.courseContent.export=!1)}),Ee([()=>o.courseManagement.courseContent.create,()=>o.courseManagement.courseContent.edit,()=>o.courseManagement.courseContent.delete,()=>o.courseManagement.courseContent.import,()=>o.courseManagement.courseContent.export],g=>{g.some(a=>a)&&(o.courseManagement.enabled=!0,o.courseManagement.courseContent.enabled=!0)}),Ee(()=>o.courseManagement.supervisionVisits.enabled,g=>{g?o.courseManagement.enabled=!0:(o.courseManagement.supervisionVisits.create=!1,o.courseManagement.supervisionVisits.edit=!1,o.courseManagement.supervisionVisits.export=!1)}),Ee([()=>o.courseManagement.supervisionVisits.create,()=>o.courseManagement.supervisionVisits.edit,()=>o.courseManagement.supervisionVisits.export],g=>{g.some(a=>a)&&(o.courseManagement.enabled=!0,o.courseManagement.supervisionVisits.enabled=!0)}),Ee(()=>o.courseManagement.satisfactionSurvey.enabled,g=>{g?o.courseManagement.enabled=!0:o.courseManagement.satisfactionSurvey.import=!1}),Ee(()=>o.courseManagement.satisfactionSurvey.import,g=>{g&&(o.courseManagement.enabled=!0,o.courseManagement.satisfactionSurvey.enabled=!0)}),Ee(()=>o.studentManagement.enabled,g=>{g||(o.studentManagement.studentInfo.enabled=!1,o.studentManagement.learningHistory.enabled=!1,o.studentManagement.creditRecognition.enabled=!1,o.studentManagement.agency.enabled=!1,o.studentManagement.studentInfo.studentExportWord=!1)}),Ee(()=>o.studentManagement.studentInfo.enabled,g=>{g?o.studentManagement.enabled=!0:(o.studentManagement.studentInfo.create=!1,o.studentManagement.studentInfo.edit=!1,o.studentManagement.studentInfo.delete=!1,o.studentManagement.studentInfo.import=!1,o.studentManagement.studentInfo.export=!1,o.studentManagement.studentInfo.studentExportWord=!1,o.studentManagement.agency.enabled=!1,o.studentManagement.agency.create=!1,o.studentManagement.agency.edit=!1,o.studentManagement.agency.delete=!1)}),Ee([()=>o.studentManagement.studentInfo.create,()=>o.studentManagement.studentInfo.edit,()=>o.studentManagement.studentInfo.delete,()=>o.studentManagement.studentInfo.import,()=>o.studentManagement.studentInfo.export,()=>o.studentManagement.studentInfo.studentExportWord],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.studentInfo.enabled=!0)}),Ee(()=>o.studentManagement.learningHistory.enabled,g=>{g&&(o.studentManagement.enabled=!0)}),Ee(()=>o.studentManagement.creditRecognition.enabled,g=>{g?o.studentManagement.enabled=!0:(o.studentManagement.creditRecognition.create=!1,o.studentManagement.creditRecognition.export=!1)}),Ee([()=>o.studentManagement.creditRecognition.create,()=>o.studentManagement.creditRecognition.export],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.creditRecognition.enabled=!0)}),Ee(()=>o.verificationManagement.enabled,g=>{g||(o.verificationManagement.expense.enabled=!1)}),Ee(()=>o.verificationManagement.expense.enabled,g=>{g?o.verificationManagement.enabled=!0:(o.verificationManagement.expense.create=!1,o.verificationManagement.expense.edit=!1,o.verificationManagement.expense.export=!1)}),Ee([()=>o.verificationManagement.expense.create,()=>o.verificationManagement.expense.edit,()=>o.verificationManagement.expense.export],g=>{g.some(a=>a)&&(o.verificationManagement.enabled=!0,o.verificationManagement.expense.enabled=!0)}),Ee(()=>o.performanceTracking.enabled,g=>{g||(o.performanceTracking.management.enabled=!1)}),Ee(()=>o.performanceTracking.management.enabled,g=>{g||(o.performanceTracking.management.edit=!1)}),Ee(()=>o.performanceTracking.management.edit,g=>{g&&(o.performanceTracking.enabled=!0,o.performanceTracking.management.enabled=!0)}),Ee(()=>o.consultationService.enabled,g=>{g||(o.consultationService.questionManagement.enabled=!1,o.consultationService.questionManagement.create=!1,o.consultationService.questionManagement.edit=!1,o.consultationService.questionManagement.delete=!1,o.consultationService.questionManagement.readDetail=!1,o.consultationService.questionManagement.import=!1,o.consultationService.categoryManagement.enabled=!1,o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee(()=>o.consultationService.questionManagement.enabled,g=>{g?o.consultationService.enabled=!0:(o.consultationService.questionManagement.create=!1,o.consultationService.questionManagement.edit=!1,o.consultationService.questionManagement.delete=!1,o.consultationService.questionManagement.readDetail=!1,o.consultationService.questionManagement.import=!1,o.consultationService.categoryManagement.enabled=!1,o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee([()=>o.consultationService.questionManagement.create,()=>o.consultationService.questionManagement.edit,()=>o.consultationService.questionManagement.delete,()=>o.consultationService.questionManagement.readDetail,()=>o.consultationService.questionManagement.import],g=>{g.some(a=>a)&&(o.consultationService.enabled=!0,o.consultationService.questionManagement.enabled=!0)}),Ee(()=>o.consultationService.categoryManagement.enabled,g=>{g?(o.consultationService.enabled=!0,o.consultationService.questionManagement.enabled=!0):(o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee([()=>o.consultationService.categoryManagement.create,()=>o.consultationService.categoryManagement.edit,()=>o.consultationService.categoryManagement.delete],g=>{g.some(a=>a)&&(o.consultationService.enabled=!0,o.consultationService.categoryManagement.enabled=!0)}),Ee(()=>o.systemManagement.enabled,g=>{g||(o.systemManagement.roleManagement.enabled=!1,o.systemManagement.rolePermission.enabled=!1,o.systemManagement.log.enabled=!1,o.systemManagement.databaseManagement.enabled=!1)}),Ee(()=>o.systemManagement.roleManagement.enabled,g=>{g?o.systemManagement.enabled=!0:(o.systemManagement.roleManagement.create=!1,o.systemManagement.roleManagement.edit=!1,o.systemManagement.roleManagement.delete=!1)}),Ee([()=>o.systemManagement.roleManagement.create,()=>o.systemManagement.roleManagement.edit,()=>o.systemManagement.roleManagement.delete],g=>{g.some(a=>a)&&(o.systemManagement.enabled=!0,o.systemManagement.roleManagement.enabled=!0)}),Ee(()=>o.systemManagement.rolePermission.enabled,g=>{g?o.systemManagement.enabled=!0:(o.systemManagement.rolePermission.create=!1,o.systemManagement.rolePermission.edit=!1,o.systemManagement.rolePermission.delete=!1)}),Ee([()=>o.systemManagement.rolePermission.create,()=>o.systemManagement.rolePermission.edit,()=>o.systemManagement.rolePermission.delete],g=>{g.some(a=>a)&&(o.systemManagement.enabled=!0,o.systemManagement.rolePermission.enabled=!0)}),Ee(()=>o.systemManagement.log.enabled,g=>{g?o.systemManagement.enabled=!0:o.systemManagement.log.export=!1}),Ee(()=>o.systemManagement.log.export,g=>{g&&(o.systemManagement.enabled=!0,o.systemManagement.log.enabled=!0)}),Ee(()=>o.systemManagement.databaseManagement.enabled,g=>{g?o.systemManagement.enabled=!0:o.systemManagement.databaseManagement.export=!1}),Ee(()=>o.systemManagement.databaseManagement.export,g=>{g&&(o.systemManagement.enabled=!0,o.systemManagement.databaseManagement.enabled=!0)}),Ee(()=>o.studentManagement.agency.enabled,g=>{g?(o.studentManagement.enabled=!0,o.studentManagement.studentInfo.enabled=!0):(o.studentManagement.agency.create=!1,o.studentManagement.agency.edit=!1,o.studentManagement.agency.delete=!1)}),Ee([()=>o.studentManagement.agency.create,()=>o.studentManagement.agency.edit,()=>o.studentManagement.agency.delete],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.agency.enabled=!0)}),je(()=>{K(u.value)}),(g,a)=>(t(),s("div",CM,[e("div",EM,[Ge(ft,{breadcrumbs:[{name:"角色管理",path:"/role-permissions"},{name:C.value?`${C.value}權限設定`:"權限設定",path:""}]},null,8,["breadcrumbs"])]),e("div",{class:"w-full max-w-[1500px] flex justify-end mb-4"},[e("button",{class:"px-4 py-2 mr-2 bg-gray-200 text-gray-800 hover:bg-gray-300 focus:outline-none",onClick:z}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d] focus:outline-none",onClick:T}," 儲存 ")]),e("div",SM,[e("div",DM,[e("div",MM,[a[76]||(a[76]=e("div",{class:"w-32 font-bold",id:"review-management-label"},"資格審核管理",-1)),e("label",AM,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=R=>o.reviewManagement.enabled=R),id:"review-management-toggle","aria-labelledby":"review-management-label"},null,512),[[Ce,o.reviewManagement.enabled]]),a[75]||(a[75]=e("span",{class:"slider round"},null,-1))])]),e("div",IM,[e("div",RM,[a[78]||(a[78]=e("div",{class:"w-32",id:"review-list-label"},"審核名單",-1)),e("label",PM,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=R=>o.reviewManagement.reviewList.enabled=R),id:"review-list-toggle","aria-labelledby":"review-list-label"},null,512),[[Ce,o.reviewManagement.reviewList.enabled]]),a[77]||(a[77]=e("span",{class:"slider round"},null,-1))])]),e("div",UM,[e("div",NM,[e("div",TM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[2]||(a[2]=R=>o.reviewManagement.edit=R),id:"review-edit-toggle"},null,512),[[Ce,o.reviewManagement.edit]]),a[79]||(a[79]=e("label",{for:"review-edit-toggle"},"編輯",-1))]),e("div",VM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[3]||(a[3]=R=>o.reviewManagement.approve=R),id:"review-approve-toggle"},null,512),[[Ce,o.reviewManagement.approve]]),a[80]||(a[80]=e("label",{for:"review-approve-toggle"},"通過",-1))]),e("div",jM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[4]||(a[4]=R=>o.reviewManagement.import=R),id:"review-import-toggle"},null,512),[[Ce,o.reviewManagement.import]]),a[81]||(a[81]=e("label",{for:"review-import-toggle"},"匯入",-1))]),e("div",LM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[5]||(a[5]=R=>o.reviewManagement.export=R),id:"review-export-toggle"},null,512),[[Ce,o.reviewManagement.export]]),a[82]||(a[82]=e("label",{for:"review-export-toggle"},"匯出",-1))])])])])]),e("div",FM,[e("div",OM,[a[84]||(a[84]=e("div",{class:"w-32 font-bold",id:"course-management-label"},"課程管理",-1)),e("label",qM,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[6]||(a[6]=R=>o.courseManagement.enabled=R),id:"course-management-toggle","aria-labelledby":"course-management-label"},null,512),[[Ce,o.courseManagement.enabled]]),a[83]||(a[83]=e("span",{class:"slider round"},null,-1))])]),e("div",BM,[e("div",HM,[a[86]||(a[86]=e("div",{class:"w-32",id:"course-content-label"},"課程內容",-1)),e("label",WM,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=R=>o.courseManagement.courseContent.enabled=R),id:"course-content-toggle","aria-labelledby":"course-content-label"},null,512),[[Ce,o.courseManagement.courseContent.enabled]]),a[85]||(a[85]=e("span",{class:"slider round"},null,-1))])]),e("div",zM,[e("div",KM,[e("div",JM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[8]||(a[8]=R=>o.courseManagement.courseContent.create=R),id:"course-content-create"},null,512),[[Ce,o.courseManagement.courseContent.create]]),a[87]||(a[87]=e("label",{for:"course-content-create"},"新增",-1))]),e("div",YM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[9]||(a[9]=R=>o.courseManagement.courseContent.edit=R),id:"course-content-edit"},null,512),[[Ce,o.courseManagement.courseContent.edit]]),a[88]||(a[88]=e("label",{for:"course-content-edit"},"編輯",-1))]),e("div",GM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[10]||(a[10]=R=>o.courseManagement.courseContent.delete=R),id:"course-content-delete"},null,512),[[Ce,o.courseManagement.courseContent.delete]]),a[89]||(a[89]=e("label",{for:"course-content-delete"},"刪除",-1))]),e("div",ZM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[11]||(a[11]=R=>o.courseManagement.courseContent.import=R),id:"course-content-import"},null,512),[[Ce,o.courseManagement.courseContent.import]]),a[90]||(a[90]=e("label",{for:"course-content-import"},"匯入",-1))]),e("div",QM,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[12]||(a[12]=R=>o.courseManagement.courseContent.export=R),id:"course-content-export"},null,512),[[Ce,o.courseManagement.courseContent.export]]),a[91]||(a[91]=e("label",{for:"course-content-export"},"匯出",-1))])])]),e("div",XM,[a[93]||(a[93]=e("div",{class:"w-32",id:"supervision-visits-label"},"訪視督課",-1)),e("label",eA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[13]||(a[13]=R=>o.courseManagement.supervisionVisits.enabled=R),id:"supervision-visits-toggle","aria-labelledby":"supervision-visits-label"},null,512),[[Ce,o.courseManagement.supervisionVisits.enabled]]),a[92]||(a[92]=e("span",{class:"slider round"},null,-1))])]),e("div",tA,[e("div",sA,[e("div",aA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[14]||(a[14]=R=>o.courseManagement.supervisionVisits.create=R),id:"supervision-visits-create"},null,512),[[Ce,o.courseManagement.supervisionVisits.create]]),a[94]||(a[94]=e("label",{for:"supervision-visits-create"},"新增",-1))]),e("div",oA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[15]||(a[15]=R=>o.courseManagement.supervisionVisits.edit=R),id:"supervision-visits-edit"},null,512),[[Ce,o.courseManagement.supervisionVisits.edit]]),a[95]||(a[95]=e("label",{for:"supervision-visits-edit"},"編輯",-1))]),e("div",lA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[16]||(a[16]=R=>o.courseManagement.supervisionVisits.export=R),id:"supervision-visits-export"},null,512),[[Ce,o.courseManagement.supervisionVisits.export]]),a[96]||(a[96]=e("label",{for:"supervision-visits-export"},"匯出",-1))])])]),e("div",nA,[a[98]||(a[98]=e("div",{class:"w-32",id:"satisfaction-survey-label"},"滿意度調查",-1)),e("label",rA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[17]||(a[17]=R=>o.courseManagement.satisfactionSurvey.enabled=R),id:"satisfaction-survey-toggle","aria-labelledby":"satisfaction-survey-label"},null,512),[[Ce,o.courseManagement.satisfactionSurvey.enabled]]),a[97]||(a[97]=e("span",{class:"slider round"},null,-1))])]),e("div",iA,[e("div",dA,[e("div",uA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[18]||(a[18]=R=>o.courseManagement.satisfactionSurvey.import=R),id:"satisfaction-survey-import"},null,512),[[Ce,o.courseManagement.satisfactionSurvey.import]]),a[99]||(a[99]=e("label",{for:"satisfaction-survey-import"},"匯入",-1))])])])])]),e("div",cA,[e("div",pA,[a[101]||(a[101]=e("div",{class:"w-32 font-bold",id:"student-management-label"},"學員管理",-1)),e("label",vA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[19]||(a[19]=R=>o.studentManagement.enabled=R),id:"student-management-toggle","aria-labelledby":"student-management-label"},null,512),[[Ce,o.studentManagement.enabled]]),a[100]||(a[100]=e("span",{class:"slider round"},null,-1))])]),e("div",mA,[e("div",bA,[a[103]||(a[103]=e("div",{class:"w-32",id:"student-info-label"},"學員資料",-1)),e("label",fA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[20]||(a[20]=R=>o.studentManagement.studentInfo.enabled=R),id:"student-info-toggle","aria-labelledby":"student-info-label"},null,512),[[Ce,o.studentManagement.studentInfo.enabled]]),a[102]||(a[102]=e("span",{class:"slider round"},null,-1))])]),e("div",yA,[e("div",gA,[e("div",xA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[21]||(a[21]=R=>o.studentManagement.studentInfo.create=R),id:"student-info-create"},null,512),[[Ce,o.studentManagement.studentInfo.create]]),a[104]||(a[104]=e("label",{for:"student-info-create"},"新增",-1))]),e("div",hA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[22]||(a[22]=R=>o.studentManagement.studentInfo.edit=R),id:"student-info-edit"},null,512),[[Ce,o.studentManagement.studentInfo.edit]]),a[105]||(a[105]=e("label",{for:"student-info-edit"},"編輯",-1))]),e("div",wA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[23]||(a[23]=R=>o.studentManagement.studentInfo.delete=R),id:"student-info-delete"},null,512),[[Ce,o.studentManagement.studentInfo.delete]]),a[106]||(a[106]=e("label",{for:"student-info-delete"},"刪除",-1))]),e("div",_A,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[24]||(a[24]=R=>o.studentManagement.studentInfo.import=R),id:"student-info-import"},null,512),[[Ce,o.studentManagement.studentInfo.import]]),a[107]||(a[107]=e("label",{for:"student-info-import"},"匯入",-1))]),e("div",kA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[25]||(a[25]=R=>o.studentManagement.studentInfo.export=R),id:"student-info-export"},null,512),[[Ce,o.studentManagement.studentInfo.export]]),a[108]||(a[108]=e("label",{for:"student-info-export"},"匯出",-1))]),e("div",$A,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[26]||(a[26]=R=>o.studentManagement.studentInfo.studentExportWord=R),id:"student-info-student-export-word"},null,512),[[Ce,o.studentManagement.studentInfo.studentExportWord]]),a[109]||(a[109]=e("label",{for:"student-info-student-export-word"},"證書匯出",-1))])])]),e("div",CA,[a[111]||(a[111]=e("div",{class:"w-32",id:"learning-history-label"},"學習歷程",-1)),e("label",EA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[27]||(a[27]=R=>o.studentManagement.learningHistory.enabled=R),id:"learning-history-toggle","aria-labelledby":"learning-history-label"},null,512),[[Ce,o.studentManagement.learningHistory.enabled]]),a[110]||(a[110]=e("span",{class:"slider round"},null,-1))])]),a[123]||(a[123]=e("div",{class:"ml-32"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1)),e("div",SA,[a[113]||(a[113]=e("div",{class:"w-32",id:"credit-recognition-label"},"學分認列",-1)),e("label",DA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[28]||(a[28]=R=>o.studentManagement.creditRecognition.enabled=R),id:"credit-recognition-toggle","aria-labelledby":"credit-recognition-label"},null,512),[[Ce,o.studentManagement.creditRecognition.enabled]]),a[112]||(a[112]=e("span",{class:"slider round"},null,-1))])]),e("div",MA,[e("div",AA,[e("div",IA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[29]||(a[29]=R=>o.studentManagement.creditRecognition.create=R),id:"credit-recognition-create"},null,512),[[Ce,o.studentManagement.creditRecognition.create]]),a[114]||(a[114]=e("label",{for:"credit-recognition-create"},"新增",-1))]),e("div",RA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[30]||(a[30]=R=>o.studentManagement.creditRecognition.export=R),id:"credit-recognition-export"},null,512),[[Ce,o.studentManagement.creditRecognition.export]]),a[115]||(a[115]=e("label",{for:"credit-recognition-export"},"匯入",-1))])])]),e("div",PA,[a[117]||(a[117]=e("div",{class:"w-32",id:"agency-management-label"},"機關",-1)),e("label",UA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[31]||(a[31]=R=>o.studentManagement.agency.enabled=R),id:"agency-management-toggle","aria-labelledby":"agency-management-label"},null,512),[[Ce,o.studentManagement.agency.enabled]]),a[116]||(a[116]=e("span",{class:"slider round"},null,-1))])]),e("div",NA,[e("div",TA,[e("div",VA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[32]||(a[32]=R=>o.studentManagement.agency.create=R),id:"agency-create"},null,512),[[Ce,o.studentManagement.agency.create]]),a[118]||(a[118]=e("label",{for:"agency-create"},"新增",-1))]),e("div",jA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[33]||(a[33]=R=>o.studentManagement.agency.edit=R),id:"agency-edit"},null,512),[[Ce,o.studentManagement.agency.edit]]),a[119]||(a[119]=e("label",{for:"agency-edit"},"編輯",-1))]),e("div",LA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[34]||(a[34]=R=>o.studentManagement.agency.delete=R),id:"agency-delete"},null,512),[[Ce,o.studentManagement.agency.delete]]),a[120]||(a[120]=e("label",{for:"agency-delete"},"刪除",-1))])])]),e("div",FA,[a[122]||(a[122]=e("div",{class:"w-32",id:"student-is-non-project-label"},"非本計畫",-1)),e("label",OA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[35]||(a[35]=R=>o.studentManagement.isNonProject=R),id:"student-is-non-project-toggle","aria-labelledby":"student-is-non-project-label"},null,512),[[Ce,o.studentManagement.isNonProject]]),a[121]||(a[121]=e("span",{class:"slider round"},null,-1))])])])]),e("div",qA,[e("div",BA,[a[125]||(a[125]=e("div",{class:"w-32 font-bold",id:"verification-management-label"},"核撥作業",-1)),e("label",HA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[36]||(a[36]=R=>o.verificationManagement.enabled=R),id:"verification-management-toggle","aria-labelledby":"verification-management-label"},null,512),[[Ce,o.verificationManagement.enabled]]),a[124]||(a[124]=e("span",{class:"slider round"},null,-1))])]),e("div",WA,[e("div",zA,[a[127]||(a[127]=e("div",{class:"w-32",id:"expense-label"},"費用核撥",-1)),e("label",KA,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[37]||(a[37]=R=>o.verificationManagement.expense.enabled=R),id:"expense-toggle","aria-labelledby":"expense-label"},null,512),[[Ce,o.verificationManagement.expense.enabled]]),a[126]||(a[126]=e("span",{class:"slider round"},null,-1))])]),e("div",JA,[e("div",YA,[e("div",GA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[38]||(a[38]=R=>o.verificationManagement.expense.create=R),id:"expense-create"},null,512),[[Ce,o.verificationManagement.expense.create]]),a[128]||(a[128]=e("label",{for:"expense-create"},"新增",-1))]),e("div",ZA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[39]||(a[39]=R=>o.verificationManagement.expense.edit=R),id:"expense-edit"},null,512),[[Ce,o.verificationManagement.expense.edit]]),a[129]||(a[129]=e("label",{for:"expense-edit"},"編輯",-1))]),e("div",QA,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[40]||(a[40]=R=>o.verificationManagement.expense.export=R),id:"expense-export"},null,512),[[Ce,o.verificationManagement.expense.export]]),a[130]||(a[130]=e("label",{for:"expense-export"},"匯出",-1))])])])])]),e("div",XA,[e("div",eI,[a[132]||(a[132]=e("div",{class:"w-32 font-bold",id:"performance-tracking-label"},"追蹤成效",-1)),e("label",tI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[41]||(a[41]=R=>o.performanceTracking.enabled=R),id:"performance-tracking-toggle","aria-labelledby":"performance-tracking-label"},null,512),[[Ce,o.performanceTracking.enabled]]),a[131]||(a[131]=e("span",{class:"slider round"},null,-1))])]),e("div",sI,[e("div",aI,[a[134]||(a[134]=e("div",{class:"w-32",id:"tracking-management-label"},"追蹤管理",-1)),e("label",oI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[42]||(a[42]=R=>o.performanceTracking.management.enabled=R),id:"tracking-management-toggle","aria-labelledby":"tracking-management-label"},null,512),[[Ce,o.performanceTracking.management.enabled]]),a[133]||(a[133]=e("span",{class:"slider round"},null,-1))])]),e("div",lI,[e("div",nI,[e("div",rI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[43]||(a[43]=R=>o.performanceTracking.management.edit=R),id:"tracking-management-edit"},null,512),[[Ce,o.performanceTracking.management.edit]]),a[135]||(a[135]=e("label",{for:"tracking-management-edit"},"編輯",-1))])])])])]),e("div",iI,[e("div",dI,[a[137]||(a[137]=e("div",{class:"w-32 font-bold",id:"consultation-service-label"},"諮詢服務",-1)),e("label",uI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[44]||(a[44]=R=>o.consultationService.enabled=R),id:"consultation-service-toggle","aria-labelledby":"consultation-service-label"},null,512),[[Ce,o.consultationService.enabled]]),a[136]||(a[136]=e("span",{class:"slider round"},null,-1))])]),e("div",cI,[e("div",pI,[a[139]||(a[139]=e("div",{class:"w-32",id:"question-management-label"},"諮詢問題管理",-1)),e("label",vI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[45]||(a[45]=R=>o.consultationService.questionManagement.enabled=R),id:"question-management-toggle","aria-labelledby":"question-management-label"},null,512),[[Ce,o.consultationService.questionManagement.enabled]]),a[138]||(a[138]=e("span",{class:"slider round"},null,-1))])]),e("div",mI,[e("div",bI,[e("div",fI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[46]||(a[46]=R=>o.consultationService.questionManagement.create=R),id:"question-management-create"},null,512),[[Ce,o.consultationService.questionManagement.create]]),a[140]||(a[140]=e("label",{for:"question-management-create"},"新增",-1))]),e("div",yI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[47]||(a[47]=R=>o.consultationService.questionManagement.edit=R),id:"question-management-edit"},null,512),[[Ce,o.consultationService.questionManagement.edit]]),a[141]||(a[141]=e("label",{for:"question-management-edit"},"編輯",-1))]),e("div",gI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[48]||(a[48]=R=>o.consultationService.questionManagement.delete=R),id:"question-management-delete"},null,512),[[Ce,o.consultationService.questionManagement.delete]]),a[142]||(a[142]=e("label",{for:"question-management-delete"},"刪除",-1))]),e("div",xI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[49]||(a[49]=R=>o.consultationService.questionManagement.import=R),id:"question-management-import"},null,512),[[Ce,o.consultationService.questionManagement.import]]),a[143]||(a[143]=e("label",{for:"question-management-import"},"匯入",-1))]),e("div",hI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[50]||(a[50]=R=>o.consultationService.questionManagement.readDetail=R),id:"question-management-read-detail"},null,512),[[Ce,o.consultationService.questionManagement.readDetail]]),a[144]||(a[144]=e("label",{for:"question-management-read-detail"},"查看詳情",-1))])])]),e("div",wI,[a[146]||(a[146]=e("div",{class:"w-32",id:"category-management-label"},"問題分類管理",-1)),e("label",_I,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[51]||(a[51]=R=>o.consultationService.categoryManagement.enabled=R),id:"category-management-toggle","aria-labelledby":"category-management-label"},null,512),[[Ce,o.consultationService.categoryManagement.enabled]]),a[145]||(a[145]=e("span",{class:"slider round"},null,-1))])]),e("div",kI,[e("div",$I,[e("div",CI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[52]||(a[52]=R=>o.consultationService.categoryManagement.create=R),id:"category-management-create"},null,512),[[Ce,o.consultationService.categoryManagement.create]]),a[147]||(a[147]=e("label",{for:"category-management-create"},"新增分類",-1))]),e("div",EI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[53]||(a[53]=R=>o.consultationService.categoryManagement.edit=R),id:"category-management-edit"},null,512),[[Ce,o.consultationService.categoryManagement.edit]]),a[148]||(a[148]=e("label",{for:"category-management-edit"},"編輯分類",-1))]),e("div",SI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[54]||(a[54]=R=>o.consultationService.categoryManagement.delete=R),id:"category-management-delete"},null,512),[[Ce,o.consultationService.categoryManagement.delete]]),a[149]||(a[149]=e("label",{for:"category-management-delete"},"刪除分類",-1))])])])])]),e("div",DI,[e("div",MI,[a[151]||(a[151]=e("div",{class:"w-32 font-bold",id:"statistical-reports-label"},"統計報表",-1)),e("label",AI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[55]||(a[55]=R=>o.reportAllRead.enabled=R),id:"statistical-reports-toggle","aria-labelledby":"statistical-reports-label"},null,512),[[Ce,o.reportAllRead.enabled]]),a[150]||(a[150]=e("span",{class:"slider round"},null,-1))])]),a[152]||(a[152]=e("div",{class:"ml-32 border rounded p-4 mb-2"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1))]),e("div",II,[e("div",RI,[a[154]||(a[154]=e("div",{class:"w-32 font-bold",id:"dashboard-label"},"儀表板",-1)),e("label",PI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[56]||(a[56]=R=>o.dashboard.enabled=R),id:"dashboard-toggle","aria-labelledby":"dashboard-label"},null,512),[[Ce,o.dashboard.enabled]]),a[153]||(a[153]=e("span",{class:"slider round"},null,-1))])]),a[155]||(a[155]=e("div",{class:"ml-32 border rounded p-4 mb-2"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1))]),e("div",UI,[e("div",NI,[a[157]||(a[157]=e("div",{class:"w-32 font-bold",id:"tool-management-label"},"工具",-1)),e("label",TI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[57]||(a[57]=R=>o.toolManagement.enabled=R),id:"tool-management-toggle","aria-labelledby":"tool-management-label"},null,512),[[Ce,o.toolManagement.enabled]]),a[156]||(a[156]=e("span",{class:"slider round"},null,-1))])]),e("div",VI,[e("div",jI,[a[159]||(a[159]=e("div",{class:"w-32",id:"file-manager-label"},"檔案管理",-1)),e("label",LI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[58]||(a[58]=R=>o.toolManagement.fileManager.enabled=R),id:"file-manager-toggle","aria-labelledby":"file-manager-label"},null,512),[[Ce,o.toolManagement.fileManager.enabled]]),a[158]||(a[158]=e("span",{class:"slider round"},null,-1))])]),e("div",FI,[e("div",OI,[e("div",qI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[59]||(a[59]=R=>o.toolManagement.fileManager.create=R),id:"file-manager-create"},null,512),[[Ce,o.toolManagement.fileManager.create]]),a[160]||(a[160]=e("label",{for:"file-manager-create"},"新增",-1))]),e("div",BI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[60]||(a[60]=R=>o.toolManagement.fileManager.upload=R),id:"file-manager-upload"},null,512),[[Ce,o.toolManagement.fileManager.upload]]),a[161]||(a[161]=e("label",{for:"file-manager-upload"},"上傳",-1))]),e("div",HI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[61]||(a[61]=R=>o.toolManagement.fileManager.delete=R),id:"file-manager-delete"},null,512),[[Ce,o.toolManagement.fileManager.delete]]),a[162]||(a[162]=e("label",{for:"file-manager-delete"},"刪除",-1))])])])])]),e("div",WI,[e("div",zI,[a[164]||(a[164]=e("div",{class:"w-32 font-bold",id:"system-management-label"},"系統管理",-1)),e("label",KI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[62]||(a[62]=R=>o.systemManagement.enabled=R),id:"system-management-toggle","aria-labelledby":"system-management-label"},null,512),[[Ce,o.systemManagement.enabled]]),a[163]||(a[163]=e("span",{class:"slider round"},null,-1))])]),e("div",JI,[e("div",YI,[a[166]||(a[166]=e("div",{class:"w-32",id:"role-management-label"},"角色管理",-1)),e("label",GI,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[63]||(a[63]=R=>o.systemManagement.roleManagement.enabled=R),id:"role-management-toggle","aria-labelledby":"role-management-label"},null,512),[[Ce,o.systemManagement.roleManagement.enabled]]),a[165]||(a[165]=e("span",{class:"slider round"},null,-1))])]),e("div",ZI,[e("div",QI,[e("div",XI,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[64]||(a[64]=R=>o.systemManagement.roleManagement.create=R),id:"role-management-create"},null,512),[[Ce,o.systemManagement.roleManagement.create]]),a[167]||(a[167]=e("label",{for:"role-management-create"},"新增",-1))]),e("div",eR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[65]||(a[65]=R=>o.systemManagement.roleManagement.edit=R),id:"role-management-edit"},null,512),[[Ce,o.systemManagement.roleManagement.edit]]),a[168]||(a[168]=e("label",{for:"role-management-edit"},"編輯",-1))]),e("div",tR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[66]||(a[66]=R=>o.systemManagement.roleManagement.delete=R),id:"role-management-delete"},null,512),[[Ce,o.systemManagement.roleManagement.delete]]),a[169]||(a[169]=e("label",{for:"role-management-delete"},"刪除",-1))])])]),e("div",sR,[a[171]||(a[171]=e("div",{class:"w-32",id:"role-permission-label"},"角色權限",-1)),e("label",aR,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[67]||(a[67]=R=>o.systemManagement.rolePermission.enabled=R),id:"role-permission-toggle","aria-labelledby":"role-permission-label"},null,512),[[Ce,o.systemManagement.rolePermission.enabled]]),a[170]||(a[170]=e("span",{class:"slider round"},null,-1))])]),e("div",oR,[e("div",lR,[e("div",nR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[68]||(a[68]=R=>o.systemManagement.rolePermission.create=R),id:"role-permission-create"},null,512),[[Ce,o.systemManagement.rolePermission.create]]),a[172]||(a[172]=e("label",{for:"role-permission-create"},"新增",-1))]),e("div",rR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[69]||(a[69]=R=>o.systemManagement.rolePermission.edit=R),id:"role-permission-edit"},null,512),[[Ce,o.systemManagement.rolePermission.edit]]),a[173]||(a[173]=e("label",{for:"role-permission-edit"},"編輯",-1))]),e("div",iR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[70]||(a[70]=R=>o.systemManagement.rolePermission.delete=R),id:"role-permission-delete"},null,512),[[Ce,o.systemManagement.rolePermission.delete]]),a[174]||(a[174]=e("label",{for:"role-permission-delete"},"刪除",-1))])])]),e("div",dR,[a[176]||(a[176]=e("div",{class:"w-32",id:"system-log-label"},"系統日誌",-1)),e("label",uR,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[71]||(a[71]=R=>o.systemManagement.log.enabled=R),id:"system-log-toggle","aria-labelledby":"system-log-label"},null,512),[[Ce,o.systemManagement.log.enabled]]),a[175]||(a[175]=e("span",{class:"slider round"},null,-1))])]),e("div",cR,[e("div",pR,[e("div",vR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[72]||(a[72]=R=>o.systemManagement.log.export=R),id:"system-log-export"},null,512),[[Ce,o.systemManagement.log.export]]),a[177]||(a[177]=e("label",{for:"system-log-export"},"匯出",-1))])])]),e("div",mR,[a[179]||(a[179]=e("div",{class:"w-32",id:"database-management-label"},"資料庫管理",-1)),e("label",bR,[P(e("input",{type:"checkbox","onUpdate:modelValue":a[73]||(a[73]=R=>o.systemManagement.databaseManagement.enabled=R),id:"database-management-toggle","aria-labelledby":"database-management-label"},null,512),[[Ce,o.systemManagement.databaseManagement.enabled]]),a[178]||(a[178]=e("span",{class:"slider round"},null,-1))])]),e("div",fR,[e("div",yR,[e("div",gR,[P(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[74]||(a[74]=R=>o.systemManagement.databaseManagement.export=R),id:"database-management-export"},null,512),[[Ce,o.systemManagement.databaseManagement.export]]),a[180]||(a[180]=e("label",{for:"database-management-export"},"匯出",-1))])])])])])])]))}},hR=Fe(xR,[["__scopeId","data-v-39d99fb3"]]),wR={class:"flex flex-col items-center p-6"},_R={class:"w-full max-w-[1500px]"},kR={class:"w-full max-w-[1500px] bg-white p-4 rounded shadow-sm mt-4"},$R={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"},CR={class:"flex flex-col"},ER={class:"relative"},SR={class:"flex flex-col"},DR=["value"],MR={class:"flex flex-col"},AR={class:"text-sm font-medium mb-1 block",for:"startTime"},IR={key:0,class:"text-red-500 ml-1"},RR={class:"flex flex-col"},PR={class:"text-sm font-medium mb-1 block",for:"endTime"},UR={key:0,class:"text-red-500 ml-1"},NR={class:"flex flex-col"},TR={class:"flex justify-end mt-4"},VR=["disabled"],jR=["disabled"],LR={class:"w-full max-w-[1500px] mt-6"},FR={key:0,class:"flex justify-center items-center py-10"},OR={key:1},qR={class:"w-full border-collapse"},BR={class:"bg-[#EEEFE7]"},HR={class:"border p-2"},WR={class:"flex items-center justify-center"},zR={key:0},KR={key:1},JR={key:2},YR={class:"border p-2"},GR={class:"flex items-center justify-center"},ZR={key:0},QR={key:1},XR={key:2},eP={class:"border p-2"},tP={class:"flex items-center justify-center"},sP={key:0},aP={key:1},oP={key:2},lP={class:"border p-2"},nP={class:"flex items-center justify-center"},rP={key:0},iP={key:1},dP={key:2},uP={class:"border p-2"},cP={class:"flex items-center justify-center"},pP={key:0},vP={key:1},mP={key:2},bP={class:"border p-2"},fP={class:"flex items-center justify-center"},yP={key:0},gP={key:1},xP={key:2},hP={class:"border p-2 text-center"},wP={class:"border p-2 text-center"},_P={class:"border p-2 text-center"},kP={class:"border p-2 text-center"},$P={class:"border p-2 text-center"},CP={class:"border p-2"},EP={class:"border p-2 text-center"},SP=["onClick"],DP={key:0},MP={key:0,class:"flex justify-center items-center space-x-2 mt-6"},AP=["disabled"],IP=["disabled","onClick","aria-label","aria-current"],RP={key:1,class:"px-2"},PP=["disabled"],UP={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},NP={class:"bg-white p-6 rounded-lg shadow-lg w-[600px] max-h-[90vh] overflow-y-auto"},TP={class:"mb-4"},VP={class:"border p-2 mt-1 bg-gray-50 rounded-sm max-h-[200px] overflow-y-auto"},jP={class:"whitespace-pre-wrap break-words text-sm"},LP={key:0,class:"mt-4"},FP={class:"border p-2 mt-1 bg-gray-50 rounded-sm max-h-[200px] overflow-y-auto"},OP={class:"whitespace-pre-wrap break-words text-sm"},Ks=20,qP={__name:"LogList",setup(M){const h=We(),d=rt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),E=m(""),U=m(""),T=m(""),z=m(""),g=m(""),a=m(!1),R=m(1),Z=m(1),$=m(0),c=m([]),y=m(!1),r=m({}),b=m(""),p=m("asc"),_=m([]),f=m({systemLogExport:!1}),V=O=>{switch(O){case"DEBUG":return 1;case"INFO":return 2;case"WARNING":return 3;case"ERROR":return 4;default:return}},W=async()=>{var O;if(C.value&&!o.value||!C.value&&o.value){v.showError("請注意","起始時間和結束時間需同時填寫或同時留空");return}a.value=!0;try{const A=N.value?V(N.value):void 0,J={page:R.value,limit:Ks,keyword:u.value||void 0,startTime:C.value||void 0,endTime:o.value||void 0,level:A,action:K.value||void 0,account:T.value||void 0,ip:z.value||void 0,message:g.value||void 0,sortBy:b.value||void 0,sortOrder:p.value||void 0};console.log("查詢條件:",J);const Q=await us.getLogs(J);Q.data&&Q.data.code===0?(c.value=Q.data.data.list.map(Y=>({id:Y.id,time:Y.date||"-",level:H(Y.level),module:Y.action||"-",user:Y.account||"-",ip:Y.ip||"-",message:Y.message||"-",stackTrace:Y.detail||null})),$.value=Q.data.data.totalCount||0,Z.value=Q.data.data.totalPage||Math.ceil($.value/Ks)||1,R.value>Z.value&&Z.value>0&&(R.value=1,await W())):(c.value=[],$.value=0,Z.value=1,v.showError("載入失敗",((O=Q.data)==null?void 0:O.message)||"獲取日誌列表失敗"))}catch(A){console.error("獲取日誌列表錯誤:",A),c.value=[],$.value=0,Z.value=1,v.showError("載入失敗","獲取日誌列表時發生錯誤")}finally{a.value=!1}},H=O=>{switch(O){case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARNING";case 4:return"ERROR";default:return"未知"}},k=()=>{u.value="",C.value="",o.value="",N.value="",K.value="",E.value="",U.value="",T.value="",z.value="",g.value="",b.value="",p.value="asc",R.value=1,De(),W()},D=()=>{u.value=""},j=O=>{r.value=O,y.value=!0},S=()=>{y.value=!1},x=O=>{switch(O){case"INFO":return"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium";case"WARNING":return"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium";case"ERROR":return"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium";case"DEBUG":return"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium";default:return""}},L=Se(()=>{const O=[];if(Z.value<=5)for(let J=1;J<=Z.value;J++)O.push(J);else{O.push(1);let J=Math.max(2,R.value-1),Q=Math.min(Z.value-1,R.value+1);R.value<=3&&(Q=Math.min(4,Z.value-1)),R.value>=Z.value-2&&(J=Math.max(2,Z.value-3)),J>2&&O.push("...");for(let Y=J;Y<=Q;Y++)O.push(Y);Q<Z.value-1&&O.push("..."),O.push(Z.value)}return O}),de=O=>{O!==R.value&&!a.value&&(R.value=O,De(),W())},xe=()=>{R.value>1&&!a.value&&(R.value--,De(),W())},fe=()=>{R.value<Z.value&&!a.value&&(R.value++,De(),W())},ke=O=>{b.value===O?p.value=p.value==="asc"?"desc":"asc":(b.value=O,p.value="asc"),R.value=1,De(),W()},De=()=>{const O={page:R.value,keyword:u.value||void 0,startTime:C.value||void 0,endTime:o.value||void 0,level:N.value||void 0,action:K.value||void 0,account:T.value||void 0,ip:z.value||void 0,message:g.value||void 0,sortBy:b.value||void 0,sortOrder:p.value||void 0};Object.keys(O).forEach(A=>{O[A]===void 0&&delete O[A]}),h.replace({query:O})},we=async()=>{var O,A;try{const J=await nt.getLogFunctionOptions();J.data&&J.data.code===0?_.value=J.data.data:(console.error("獲取功能選項失敗:",(O=J.data)==null?void 0:O.message),v.showError("載入失敗",((A=J.data)==null?void 0:A.message)||"獲取功能選項失敗"))}catch(J){console.error("獲取功能選項錯誤:",J),v.showError("載入失敗","獲取功能選項時發生錯誤")}},$e=async()=>{if(C.value&&!o.value||!C.value&&o.value){v.showError("請注意","起始時間和結束時間需同時填寫或同時留空");return}try{const O=N.value?V(N.value):void 0,A={keyword:u.value||void 0,action:K.value||void 0,dateRange:C.value&&o.value?[C.value,o.value]:void 0,level:O,sortBy:b.value||void 0,sortOrder:p.value||void 0};console.log("匯出日誌參數:",A);const J=await us.exportLogs(A),Q=J.headers["content-type"];if(!Q||!Q.includes("spreadsheetml.sheet"))try{const se=new Blob([J.data],{type:"application/json"}),re=await new Response(se).text(),Te=JSON.parse(re);console.error("匯出日誌失敗：伺服器返回錯誤：",Te),v.showError("匯出失敗",Te.message||"匯出過程中發生錯誤，請稍後再試");return}catch(se){console.error("匯出日誌失敗：無法解析回應內容",se),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const Y=new Blob([J.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ue=document.createElement("a");ue.href=URL.createObjectURL(Y);const pe=new Date,ne=`系統日誌_${`${pe.getFullYear()}-${String(pe.getMonth()+1).padStart(2,"0")}-${String(pe.getDate()).padStart(2,"0")}`}.xlsx`;ue.download=ne,ue.click(),URL.revokeObjectURL(ue.href),v.showSuccess("匯出成功","系統日誌已成功匯出為 Excel 檔案")}catch(O){if(console.error("匯出日誌錯誤:",O),O.response&&O.response.data){const A=O.response.data;v.showError("匯出失敗",A.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},ae=async()=>{try{const O=await ot.getSidebarPermissions();O.data.code===0&&O.data.message==="success"?(f.value=O.data.data,console.log("系統日誌頁面權限:",f.value)):console.error("獲取權限失敗:",O.data.message)}catch(O){console.error("獲取權限錯誤:",O)}};return je(()=>{const O=d.query.page?parseInt(d.query.page):null,A=d.query.keyword||null,J=d.query.startTime||null,Q=d.query.endTime||null,Y=d.query.level||null,ue=d.query.action||null,pe=d.query.account||null,ye=d.query.ip||null,ne=d.query.message||null,se=d.query.sortBy||null,re=d.query.sortOrder||null;O&&(R.value=O),A&&(u.value=A),J&&(C.value=J),Q&&(o.value=Q),Y&&(N.value=Y),ue&&(K.value=ue),pe&&(T.value=pe),ye&&(z.value=ye),ne&&(g.value=ne),se&&(b.value=se),re&&(p.value=re),we(),W(),ae()}),(O,A)=>(t(),s("div",wR,[e("div",_R,[Ge(ft,{breadcrumbs:[{name:"系統日誌",path:"/log-list"}]})]),e("div",kR,[e("div",$R,[e("div",CR,[A[12]||(A[12]=e("label",{class:"mb-1 text-sm",for:"searchKeyword"},"關鍵字查詢",-1)),e("div",ER,[P(e("input",{id:"searchKeyword",type:"text","onUpdate:modelValue":A[0]||(A[0]=J=>u.value=J),class:"p-2 border border-gray-300 rounded outline-none w-full",placeholder:"請輸入關鍵字",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ue(W,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[te,u.value]]),u.value?(t(),s("button",{key:0,onClick:D,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},A[11]||(A[11]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)])]),e("div",SR,[A[14]||(A[14]=e("label",{class:"mb-1 text-sm",for:"selectedFunction"},"功能選擇",-1)),P(e("select",{id:"selectedFunction","onUpdate:modelValue":A[1]||(A[1]=J=>K.value=J),class:"p-2 border border-gray-300 rounded outline-none",onKeyup:Ue(W,["enter"])},[A[13]||(A[13]=e("option",{value:""},"全部功能",-1)),(t(!0),s(X,null,le(_.value,J=>(t(),s("option",{key:J.id,value:J.id},l(J.name),9,DR))),128))],544),[[Pe,K.value]])]),e("div",MR,[e("label",AR,[A[15]||(A[15]=me(" 起始時間 ")),o.value&&!C.value?(t(),s("span",IR,"*")):G("",!0),A[16]||(A[16]=e("span",{class:"text-xs text-gray-500"},"(兩個時間必須同時填寫)",-1))]),P(e("input",{id:"startTime",type:"datetime-local","onUpdate:modelValue":A[2]||(A[2]=J=>C.value=J),class:ee(["p-2 border border-gray-300 rounded outline-none",{"border-red-500":o.value&&!C.value}]),onKeyup:Ue(W,["enter"])},null,34),[[te,C.value]])]),e("div",RR,[e("label",PR,[A[17]||(A[17]=me(" 結束時間 ")),C.value&&!o.value?(t(),s("span",UR,"*")):G("",!0)]),P(e("input",{id:"endTime",type:"datetime-local","onUpdate:modelValue":A[3]||(A[3]=J=>o.value=J),class:ee(["p-2 border border-gray-300 rounded outline-none",{"border-red-500":C.value&&!o.value}]),onKeyup:Ue(W,["enter"])},null,34),[[te,o.value]])]),e("div",NR,[A[19]||(A[19]=e("label",{class:"mb-1 text-sm",for:"logLevel"},"Log等級",-1)),P(e("select",{id:"logLevel","onUpdate:modelValue":A[4]||(A[4]=J=>N.value=J),class:"p-2 border border-gray-300 rounded outline-none",onKeyup:Ue(W,["enter"])},A[18]||(A[18]=[Zs('<option value="" data-v-07e717fe>全部</option><option value="INFO" data-v-07e717fe>INFO</option><option value="WARNING" data-v-07e717fe>WARNING</option><option value="ERROR" data-v-07e717fe>ERROR</option><option value="DEBUG" data-v-07e717fe>DEBUG</option>',5)]),544),[[Pe,N.value]])])]),e("div",TR,[f.value.systemLogExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded mr-2 hover:bg-[#3d7a5d]",onClick:$e,disabled:a.value,"aria-label":"匯出日誌記錄"}," 匯出日誌 ",8,VR)):G("",!0),e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded mr-2 hover:bg-gray-300",onClick:k,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:W,disabled:a.value,"aria-label":"查詢日誌記錄"},l(a.value?"查詢中...":"查詢"),9,jR)])]),e("div",LR,[a.value?(t(),s("div",FR,A[20]||(A[20]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",OR,[e("table",qR,[e("thead",null,[e("tr",BR,[e("th",HR,[e("div",WR,[A[21]||(A[21]=me(" 時間 ")),e("button",{onClick:A[5]||(A[5]=J=>ke("date")),class:"ml-1 focus:outline-none","aria-label":"依時間排序"},[b.value==="date"&&p.value==="asc"?(t(),s("span",zR,"▲")):b.value==="date"&&p.value==="desc"?(t(),s("span",KR,"▼")):(t(),s("span",JR,"⇅"))])])]),e("th",YR,[e("div",GR,[A[22]||(A[22]=me(" 等級 ")),e("button",{onClick:A[6]||(A[6]=J=>ke("level")),class:"ml-1 focus:outline-none","aria-label":"依等級排序"},[b.value==="level"&&p.value==="asc"?(t(),s("span",ZR,"▲")):b.value==="level"&&p.value==="desc"?(t(),s("span",QR,"▼")):(t(),s("span",XR,"⇅"))])])]),e("th",eP,[e("div",tP,[A[23]||(A[23]=me(" 功能 ")),e("button",{onClick:A[7]||(A[7]=J=>ke("action")),class:"ml-1 focus:outline-none","aria-label":"依功能排序"},[b.value==="action"&&p.value==="asc"?(t(),s("span",sP,"▲")):b.value==="action"&&p.value==="desc"?(t(),s("span",aP,"▼")):(t(),s("span",oP,"⇅"))])])]),e("th",lP,[e("div",nP,[A[24]||(A[24]=me(" 使用者 ")),e("button",{onClick:A[8]||(A[8]=J=>ke("account")),class:"ml-1 focus:outline-none","aria-label":"依使用者排序"},[b.value==="account"&&p.value==="asc"?(t(),s("span",rP,"▲")):b.value==="account"&&p.value==="desc"?(t(),s("span",iP,"▼")):(t(),s("span",dP,"⇅"))])])]),e("th",uP,[e("div",cP,[A[25]||(A[25]=me(" IP ")),e("button",{onClick:A[9]||(A[9]=J=>ke("ip")),class:"ml-1 focus:outline-none","aria-label":"依IP位址排序"},[b.value==="ip"&&p.value==="asc"?(t(),s("span",pP,"▲")):b.value==="ip"&&p.value==="desc"?(t(),s("span",vP,"▼")):(t(),s("span",mP,"⇅"))])])]),e("th",bP,[e("div",fP,[A[26]||(A[26]=me(" 訊息內容 ")),e("button",{onClick:A[10]||(A[10]=J=>ke("message")),class:"ml-1 focus:outline-none","aria-label":"依訊息內容排序"},[b.value==="message"&&p.value==="asc"?(t(),s("span",yP,"▲")):b.value==="message"&&p.value==="desc"?(t(),s("span",gP,"▼")):(t(),s("span",xP,"⇅"))])])]),A[27]||(A[27]=e("th",{class:"border p-2"},"操作",-1))])]),e("tbody",null,[(t(!0),s(X,null,le(c.value,(J,Q)=>(t(),s("tr",{key:Q,class:"hover:bg-gray-100"},[e("td",hP,l(J.time),1),e("td",wP,[e("span",{class:ee(x(J.level))},l(J.level),3)]),e("td",_P,l(J.module),1),e("td",kP,l(J.user),1),e("td",$P,l(J.ip),1),e("td",CP,l(J.message),1),e("td",EP,[e("button",{class:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:Y=>j(J),"aria-label":"查看日誌詳情"}," 詳情 ",8,SP)])]))),128)),c.value.length===0?(t(),s("tr",DP,A[28]||(A[28]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])]),c.value.length>0?(t(),s("div",MP,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:R.value===1||a.value,onClick:xe,"aria-label":"前往上一頁"}," 上一頁 ",8,AP),(t(!0),s(X,null,le(L.value,J=>(t(),s(X,{key:J},[J!=="..."?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":J===R.value}]),disabled:a.value,onClick:Q=>de(J),"aria-label":`前往第 ${J} 頁`,"aria-current":J===R.value?"page":null},l(J),11,IP)):(t(),s("span",RP,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:R.value===Z.value||a.value,onClick:fe,"aria-label":"前往下一頁"}," 下一頁 ",8,PP)])):G("",!0)]))]),y.value?(t(),s("div",UP,[e("div",NP,[A[29]||(A[29]=e("h2",{class:"text-lg font-bold mb-4"},"日誌詳情",-1)),e("div",TP,[e("div",VP,[e("pre",jP,l(r.value.message),1)]),r.value.stackTrace?(t(),s("div",LP,[e("div",FP,[e("pre",OP,l(r.value.stackTrace),1)])])):G("",!0)]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:S,"aria-label":"關閉日誌詳情"}," 關閉 ")])])])):G("",!0)]))}},BP=Fe(qP,[["__scopeId","data-v-07e717fe"]]),HP={class:"flex flex-col items-center p-6"},WP={class:"w-full max-w-[1500px]"},zP={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},KP={key:1,class:"w-full max-w-[1500px]"},JP={class:"grid grid-cols-3 gap-4 mb-8"},YP={class:"flex items-center"},GP=["disabled"],ZP={value:""},QP=["value"],XP={class:"flex items-center"},eU=["disabled"],tU={value:""},sU=["value"],aU={class:"flex items-center"},oU={class:"flex items-center col-span-2"},lU={class:"flex items-center"},nU={class:"grid grid-cols-3 gap-4 mb-8"},rU={class:"flex items-center"},iU={class:"flex items-center"},dU={class:"flex items-center"},uU={class:"flex items-center"},cU=["disabled"],pU={value:""},vU=["value"],mU={class:"flex items-center"},bU={class:"flex items-center"},fU={class:"flex items-center"},yU={class:"flex items-center"},gU={class:"flex items-center"},xU={class:"flex items-center"},hU={class:"grid grid-cols-3 gap-4 mb-8"},wU={class:"flex items-center"},_U={class:"flex items-center"},kU={class:"grid grid-cols-3 gap-4 mb-8"},$U={class:"flex items-center"},CU={class:"flex items-center"},EU={class:"flex items-center"},SU={class:"grid grid-cols-3 gap-4 mb-8"},DU={class:"flex items-center"},MU={class:"flex items-center"},AU={class:"flex items-center"},IU={class:"w-full mb-8"},RU={__name:"AddCourseStudent",setup(M){const h=We();rt();const d=m(!1),u=m(!1),C=m(!1),o=m(!1),N=m([]),K=m([]),E=m([]),U=m({agency:"",courseName:"",courseMode:"",courseDate:"",location:"",name:"",gender:"",idNumber:"",organization:"",unit:"",department:"",title:"",phoneNumber:"",officePhone:"",officialEmail:"",courseFee:null,receiptNumber:"",totalHours:null,absentHours:null,attendanceHours:null,grade:null,isCertified:"",certificateNumber:"",remark:""}),T=async()=>{await v.confirmAsync("確認取消","是否要取消新增學員？已填寫的資料將不會被儲存。")&&h.back()},z=()=>U.value.agency?U.value.courseName?U.value.name?U.value.gender?U.value.idNumber?!0:(v.showError("儲存失敗","請填寫身分證字號"),!1):(v.showError("儲存失敗","請填寫性別"),!1):(v.showError("儲存失敗","請填寫學員姓名"),!1):(v.showError("儲存失敗","請選擇課程名稱"),!1):(v.showError("儲存失敗","請選擇訓練機構"),!1),g=async()=>{var r;if(!U.value.agency){E.value=[],U.value.courseName="",U.value.courseMode="",U.value.courseDate="",U.value.location="";return}try{o.value=!0;const b=await nt.getCourseData({school:U.value.agency});b.data&&b.data.code===0?(E.value=b.data.data.map(p=>({id:p.id,name:p.name,courseMode:a(p.courseMode),date:p.date||"",location:p.location||""})),E.value.length===1?(U.value.courseName=E.value[0].id,R()):U.value.courseName=""):(console.error("獲取課程選項失敗:",(r=b.data)==null?void 0:r.message),v.showError("載入失敗","獲取課程選項失敗"),E.value=[])}catch(b){console.error("獲取課程選項錯誤:",b),v.showError("載入失敗","獲取課程選項時發生錯誤"),E.value=[]}finally{o.value=!1}},a=r=>{switch(r){case 1:return"線上";case 2:return"實體";case 3:return"線上/實體";default:return"未指定"}},R=()=>{if(!U.value.courseName){U.value.courseMode="",U.value.courseDate="",U.value.location="";return}const r=E.value.find(b=>b.id===parseInt(U.value.courseName));r&&(U.value.courseMode=r.courseMode||"",U.value.courseDate=r.date||"",U.value.location=r.location||"")},Z=()=>({courseId:parseInt(U.value.courseName),studentName:U.value.name,gender:parseInt(U.value.gender),studentIdNumber:U.value.idNumber,agencyId:U.value.organization?parseInt(U.value.organization):void 0,unit:U.value.unit||"",department:U.value.department||"",jobTitle:U.value.title||"",phone:U.value.phoneNumber||"",officePhone:U.value.officePhone||"",officeEmail:U.value.officialEmail||"",receiptAmount:U.value.courseFee?parseInt(U.value.courseFee):0,receiptNumber:U.value.receiptNumber||"",classHours:U.value.totalHours?parseInt(U.value.totalHours):0,attendanceHours:U.value.attendanceHours?Number(U.value.attendanceHours):0,missedHours:U.value.absentHours?Number(U.value.absentHours):0,grade:U.value.grade?Number(U.value.grade):0,cerificationNumber:U.value.certificateNumber||"",remark:U.value.remark||""}),$=async()=>{var r;if(z())try{d.value=!0;const b=Z();console.log("提交的課程學員數據:",b);const p=await Zt.addCourseStudent(b);if(p.data&&p.data.code===0){v.showSuccess("新增成功","學員已成功新增到課程"),setTimeout(()=>{h.push("/course")},300);return}v.showError("新增失敗",((r=p.data)==null?void 0:r.message)||"新增學員時發生錯誤")}catch(b){console.error("新增學員錯誤:",b),v.showError("新增失敗","新增學員時發生錯誤，請稍後再試")}finally{d.value=!1}},c=async()=>{var r;try{u.value=!0;const b=await nt.getSchoolOptions();b.data&&b.data.code===0?N.value=b.data.data:(console.error("獲取訓練機構選項失敗:",(r=b.data)==null?void 0:r.message),v.showError("載入失敗","獲取訓練機構選項失敗"))}catch(b){console.error("獲取訓練機構選項錯誤:",b),v.showError("載入失敗","獲取訓練機構選項失敗")}finally{u.value=!1}},y=async()=>{var r;try{C.value=!0;const b=await nt.getAgencyOptions();b.data&&b.data.code===0?K.value=b.data.data:(console.error("獲取機關選項失敗:",(r=b.data)==null?void 0:r.message),v.showError("載入失敗","獲取機關選項失敗"))}catch(b){console.error("獲取機關選項錯誤:",b),v.showError("載入失敗","獲取機關選項失敗")}finally{C.value=!1}};return je(()=>{c(),y()}),(r,b)=>(t(),s("div",HP,[e("div",WP,[Ge(ft,{breadcrumbs:[{name:"課程內容",path:"/course"},{name:"新增課程學員",path:""}]})]),e("div",{class:"w-full max-w-[1500px] flex justify-between items-center mb-4"},[b[24]||(b[24]=e("div",{class:"text-sm text-gray-600"},[e("span",{class:"text-red-500"},"*"),me(" 代表必填欄位 ")],-1)),e("div",{class:"space-x-4"},[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:T}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:$}," 儲存 ")])]),d.value?(t(),s("div",zP,b[25]||(b[25]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",KP,[b[52]||(b[52]=e("h2",{class:"text-xl font-bold mb-6"},"班級資訊",-1)),e("div",JP,[e("div",YP,[b[26]||(b[26]=e("label",{class:"w-28",for:"agency"},[me("訓練機構:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"agency",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[0]||(b[0]=p=>U.value.agency=p),disabled:u.value,onChange:g},[e("option",ZP,l(u.value?"載入中...":"請選擇訓練機構"),1),(t(!0),s(X,null,le(N.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,QP))),128))],40,GP),[[Pe,U.value.agency]])]),e("div",XP,[b[27]||(b[27]=e("label",{class:"w-28",for:"courseName"},[me("課程名稱:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"courseName",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[1]||(b[1]=p=>U.value.courseName=p),disabled:!U.value.agency||o.value,onChange:R},[e("option",tU,l(U.value.agency?o.value?"載入中...":"請選擇課程":"請先選擇訓練機構"),1),(t(!0),s(X,null,le(E.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,sU))),128))],40,eU),[[Pe,U.value.courseName]])]),e("div",aU,[b[28]||(b[28]=e("label",{class:"w-28",for:"courseMode"},"訓練方式:",-1)),P(e("input",{id:"courseMode",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":b[2]||(b[2]=p=>U.value.courseMode=p),placeholder:"",readonly:""},null,512),[[te,U.value.courseMode]])]),e("div",oU,[b[29]||(b[29]=e("label",{class:"w-28",for:"courseDate"},"訓練日期:",-1)),P(e("input",{id:"courseDate",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":b[3]||(b[3]=p=>U.value.courseDate=p),placeholder:"",readonly:""},null,512),[[te,U.value.courseDate]])]),e("div",lU,[b[30]||(b[30]=e("label",{class:"w-28",for:"location"},"訓練地點:",-1)),P(e("input",{id:"location",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":b[4]||(b[4]=p=>U.value.location=p),placeholder:"",readonly:""},null,512),[[te,U.value.location]])])]),b[53]||(b[53]=e("h2",{class:"text-xl font-bold mb-6"},"學員基本資料",-1)),e("div",nU,[e("div",rU,[b[31]||(b[31]=e("label",{class:"w-28",for:"name"},[me("姓名:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{id:"name",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[5]||(b[5]=p=>U.value.name=p),placeholder:"姓名"},null,512),[[te,U.value.name]])]),e("div",iU,[b[33]||(b[33]=e("label",{class:"w-28",for:"gender"},[me("性別:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{id:"gender",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[6]||(b[6]=p=>U.value.gender=p)},b[32]||(b[32]=[e("option",{value:""},"請選擇",-1),e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512),[[Pe,U.value.gender]])]),e("div",dU,[b[34]||(b[34]=e("label",{class:"w-28",for:"idNumber"},[me("身分證字號:"),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{id:"idNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[7]||(b[7]=p=>U.value.idNumber=p),placeholder:"身分證字號"},null,512),[[te,U.value.idNumber]])]),e("div",uU,[b[35]||(b[35]=e("label",{class:"w-28",for:"organization"},"機關名稱:",-1)),P(e("select",{id:"organization",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[8]||(b[8]=p=>U.value.organization=p),disabled:C.value},[e("option",pU,l(C.value?"載入中...":"請選擇機關"),1),(t(!0),s(X,null,le(K.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,vU))),128))],8,cU),[[Pe,U.value.organization]])]),e("div",mU,[b[36]||(b[36]=e("label",{class:"w-28",for:"unit"},"單位:",-1)),P(e("input",{id:"unit",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[9]||(b[9]=p=>U.value.unit=p),placeholder:"單位"},null,512),[[te,U.value.unit]])]),e("div",bU,[b[37]||(b[37]=e("label",{class:"w-28",for:"department"},"部門:",-1)),P(e("input",{id:"department",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[10]||(b[10]=p=>U.value.department=p),placeholder:"部門"},null,512),[[te,U.value.department]])]),e("div",fU,[b[38]||(b[38]=e("label",{class:"w-28",for:"title"},"職稱:",-1)),P(e("input",{id:"title",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[11]||(b[11]=p=>U.value.title=p),placeholder:"職稱"},null,512),[[te,U.value.title]])]),e("div",yU,[b[39]||(b[39]=e("label",{class:"w-28",for:"phoneNumber"},"手機號碼:",-1)),P(e("input",{id:"phoneNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[12]||(b[12]=p=>U.value.phoneNumber=p),placeholder:"手機號碼"},null,512),[[te,U.value.phoneNumber]])]),e("div",gU,[b[40]||(b[40]=e("label",{class:"w-28",for:"officePhone"},"公務電話:",-1)),P(e("input",{id:"officePhone",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[13]||(b[13]=p=>U.value.officePhone=p),placeholder:"公務電話"},null,512),[[te,U.value.officePhone]])]),e("div",xU,[b[41]||(b[41]=e("label",{class:"w-28",for:"officialEmail"},"公務信箱:",-1)),P(e("input",{id:"officialEmail",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[14]||(b[14]=p=>U.value.officialEmail=p),placeholder:"公務電子郵件"},null,512),[[te,U.value.officialEmail]])])]),b[54]||(b[54]=e("h2",{class:"text-xl font-bold mb-6"},"費用及收據",-1)),e("div",hU,[e("div",wU,[b[42]||(b[42]=e("label",{class:"w-28",for:"courseFee"},"學分費:",-1)),P(e("input",{id:"courseFee",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[15]||(b[15]=p=>U.value.courseFee=p),placeholder:"學分費"},null,512),[[te,U.value.courseFee]])]),e("div",_U,[b[43]||(b[43]=e("label",{class:"w-28",for:"receiptNumber"},"收據編號:",-1)),P(e("input",{id:"receiptNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[16]||(b[16]=p=>U.value.receiptNumber=p),placeholder:"收據編號"},null,512),[[te,U.value.receiptNumber]])])]),b[55]||(b[55]=e("h2",{class:"text-xl font-bold mb-6"},"出缺勤統計",-1)),e("div",kU,[e("div",$U,[b[44]||(b[44]=e("label",{class:"w-28",for:"totalHours"},"訓練時數:",-1)),P(e("input",{id:"totalHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[17]||(b[17]=p=>U.value.totalHours=p),placeholder:"訓練時數"},null,512),[[te,U.value.totalHours]])]),e("div",CU,[b[45]||(b[45]=e("label",{class:"w-28",for:"absentHours"},"缺席時數:",-1)),P(e("input",{id:"absentHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[18]||(b[18]=p=>U.value.absentHours=p),placeholder:"缺席時數"},null,512),[[te,U.value.absentHours]])]),e("div",EU,[b[46]||(b[46]=e("label",{class:"w-28",for:"attendanceHours"},"出席時數:",-1)),P(e("input",{id:"attendanceHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[19]||(b[19]=p=>U.value.attendanceHours=p),placeholder:"出席時數"},null,512),[[te,U.value.attendanceHours]])])]),b[56]||(b[56]=e("h2",{class:"text-xl font-bold mb-6"},"成績及證書",-1)),e("div",SU,[e("div",DU,[b[47]||(b[47]=e("label",{class:"w-28",for:"grade"},"成績:",-1)),P(e("input",{id:"grade",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[20]||(b[20]=p=>U.value.grade=p),placeholder:"成績"},null,512),[[te,U.value.grade]])]),e("div",MU,[b[49]||(b[49]=e("label",{class:"w-28",for:"isCertified"},"是否發證:",-1)),P(e("select",{id:"isCertified",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[21]||(b[21]=p=>U.value.isCertified=p)},b[48]||(b[48]=[e("option",{value:""},"請選擇",-1),e("option",{value:"是"},"是",-1),e("option",{value:"否"},"否",-1)]),512),[[Pe,U.value.isCertified]])]),e("div",AU,[b[50]||(b[50]=e("label",{class:"w-28",for:"certificateNumber"},"證書編號:",-1)),P(e("input",{id:"certificateNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":b[22]||(b[22]=p=>U.value.certificateNumber=p),placeholder:"證書編號"},null,512),[[te,U.value.certificateNumber]])])]),b[57]||(b[57]=e("h2",{class:"text-xl font-bold mb-6"},"其他",-1)),e("div",IU,[b[51]||(b[51]=e("label",{class:"block mb-2",for:"remark"},"備註:",-1)),P(e("textarea",{id:"remark",class:"w-full p-2 border border-[#4e9875] outline-none focus:outline-none min-h-[100px]","onUpdate:modelValue":b[23]||(b[23]=p=>U.value.remark=p),placeholder:"備註"},null,512),[[te,U.value.remark]])])]))]))}},PU=Fe(RU,[["__scopeId","data-v-ac1ba15c"]]),Gt={getFolderContents:(M=[])=>{const h={};return M&&M.length>0&&(h.path=M),console.log("API 調用路徑陣列:",M),be.get("/v1/fileManage",{params:h,paramsSerializer:d=>{const u=new URLSearchParams;return Object.keys(d).forEach(C=>{const o=d[C];Array.isArray(o)?o.forEach(N=>{u.append(C,N)}):u.append(C,o)}),u.toString()}})},createFolder:(M,h=[])=>{const d={folderName:M.trim(),path:Array.isArray(h)?[...h]:[]};return console.log("API 創建資料夾:",d),be.post("/v1/fileManage/create",d)},_getPrefixedFormDataEntries:(M,h)=>{const d=[];for(const u of M.keys())u.startsWith(h)&&d.push(M.get(u));return d},uploadFiles:(M,h)=>be.post("/v1/fileManage/upload",M,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:h}),searchFiles:(M,h=[])=>{const d={keyword:M.trim()};return h&&h.length>0&&(d.path=h),console.log("API 搜尋關鍵字:",M),console.log("API 搜尋路徑陣列:",h),be.get("/v1/fileManage",{params:d,paramsSerializer:u=>{const C=new URLSearchParams;return Object.keys(u).forEach(o=>{const N=u[o];Array.isArray(N)?N.forEach(K=>{C.append(o,K)}):C.append(o,N)}),C.toString()}})},deleteItems:M=>{const d={items:M.map(u=>{const C={...u};return!C.path||!Array.isArray(C.path)?C.path=[]:C.path=[...C.path],C})};return console.log("API 批次刪除請求:",d),be.delete("/v1/fileManage",{data:d})},getFileUrl:(M,h=null,d=[])=>{const u=localStorage.getItem("fileBaseUrl")||"";let C="";if(d&&d.length>0){const o=d.join("/");C=`${u}${o}/${M}`}else h?C=`${u}${h}/${M}`:M.includes("/")?C=`${u}${M}`:C=`${u}${M}`;return console.log("獲取檔案 URL:",{fileName:M,folderPath:h,pathArray:d,fileUrl:C}),Promise.resolve({data:{code:0,message:"success",data:{url:C}}})}},UU={class:"flex flex-col items-center p-6"},NU={class:"w-full max-w-[1500px]"},TU={class:"w-full max-w-[1500px] mt-4"},VU={class:"bg-white p-4 rounded shadow-sm flex flex-wrap items-center gap-4"},jU={class:"flex-1 min-w-[300px]"},LU={class:"flex items-center gap-1 text-sm"},FU={class:"flex items-center flex-wrap"},OU=["onClick"],qU={class:"flex-1 min-w-[300px]"},BU={class:"relative"},HU={class:"mt-4 bg-white rounded shadow-sm p-4 min-h-[400px]"},WU={key:0,class:"mb-4 bg-gray-100 p-3 rounded flex flex-wrap items-center justify-between"},zU={class:"flex items-center gap-3"},KU={class:"text-sm text-gray-700"},JU={class:"font-bold text-blue-700"},YU={key:1,class:"flex justify-center items-center py-10"},GU={key:2},ZU={class:"mb-4 flex justify-between items-center"},QU={class:"text-sm text-gray-600"},XU={key:0,class:"text-center py-10 text-gray-500"},eN={key:1},tN={class:"text-lg font-bold mb-2"},sN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},aN=["onClick"],oN={class:"flex items-center"},lN=["id","value"],nN={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},rN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},iN={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},dN=["title"],uN={key:0,class:"mt-1 text-xs text-gray-500"},cN={key:3,class:"text-center py-10 text-gray-500"},pN={key:4},vN={key:0,class:"mb-6"},mN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},bN=["onClick"],fN={class:"flex items-center"},yN=["id","value"],gN=["title"],xN={class:"mt-1 text-xs text-gray-500"},hN={key:0,class:"mt-2 border-t pt-2"},wN=["onClick"],_N=["id","value"],kN={class:"text-blue-500 mr-1"},$N={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},CN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},EN=["title"],SN={key:1},DN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},MN=["onClick"],AN={class:"flex items-center"},IN=["id","value"],RN={class:"text-blue-500 mr-2"},PN={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},UN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},NN=["title"],TN={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},VN={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},jN={class:"mb-4"},LN={key:0,class:"text-red-500 text-sm mt-1"},FN={class:"flex justify-end space-x-2"},ON=["disabled"],qN={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},BN={class:"bg-white p-6 rounded-md shadow-lg w-[500px] max-w-[90%]"},HN={class:"mb-4"},WN={id:"uploadPath",class:"p-2 bg-gray-100 rounded text-sm"},zN={class:"mb-4"},KN=["disabled"],JN={class:"mb-4"},YN={key:0},GN={key:1,class:"text-left"},ZN={class:"mb-2 font-medium"},QN={class:"max-h-[150px] overflow-y-auto"},XN={class:"truncate"},eT={class:"flex justify-end space-x-2"},tT=["disabled"],sT=["disabled"],aT={key:0,class:"mt-4"},oT={class:"flex justify-between mb-1"},lT={class:"text-sm"},nT={class:"w-full bg-gray-200 rounded-full h-2"},rT={key:2,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},iT={class:"relative bg-white p-4 rounded-md shadow-lg max-w-4xl max-h-[90vh] w-[90vw] flex flex-col"},dT={class:"flex-1 overflow-auto flex items-center justify-center bg-gray-100 p-2 rounded"},uT={key:0,class:"text-center py-10"},cT={key:1,class:"text-center py-10 text-red-500"},pT=["src","alt"],vT={class:"mt-3 text-sm text-gray-600"},mT={key:0},bT={key:3,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},fT={class:"relative bg-white p-4 rounded-md shadow-lg max-w-4xl max-h-[90vh] w-[90vw] flex flex-col"},yT={class:"flex-1 overflow-auto bg-gray-100 p-4 rounded"},gT={key:0,class:"text-center py-10"},xT={key:1,class:"text-center py-10 text-red-500"},hT={key:2,class:"h-full"},wT=["src"],_T={key:1,class:"whitespace-pre-wrap text-sm font-mono p-4 bg-white rounded border text-preview-content"},kT={class:"mt-3 text-sm text-gray-600"},$T={key:0},CT={class:"mt-2 flex space-x-2"},ET=["href"],ST={__name:"FileManagement",setup(M){const h=We(),d=rt(),u=m({fileManagerCreate:!1,fileManagerUpload:!1,fileManagerDelete:!1}),C=async()=>{try{const B=await ot.getSidebarPermissions();B.data.code===0&&B.data.message==="success"?(u.value=B.data.data,console.log("檔案管理頁面權限:",u.value)):console.error("獲取權限失敗:",B.data.message)}catch(B){console.error("獲取權限錯誤:",B)}},o=m(!1),N=m(""),K=m("根目錄"),E=m([]),U=m([]),T=m([]),z=m(!1),g=m([]),a=m(!1),R=m(null),Z=m(!1),$=m(""),c=m(""),y=m(!1),r=m(!1),b=m(null),p=m([]),_=m(!1),f=m(0),V=m(!1),W=m(""),H=m(""),k=m(!1),D=m(""),j=m(!1),S=m({name:""}),x=m(""),L=m(!1),de=m(!1),xe=m(!1),fe=m({name:""}),ke=m(""),De=m(!1),we=m(!1),$e=m(""),ae=Se(()=>{var I;return(I=S.value)!=null&&I.name?S.value.name.replace(/image|圖片|照片|預覽|preview/gi,"").trim()||S.value.name:""});Ee(H,B=>{!B.trim()&&k.value&&ge()});const O=Se(()=>{if(!k.value||!D.value.trim())return[];const B=D.value,I=[],F=(Ie,Ne)=>{Ie.forEach(Oe=>{const tt=[...Ne],st=tt.join("/");if(Oe.name.includes(B)&&I.push({name:Oe.name,isFolder:Oe.isFolder,id:Oe.isFolder?`folder_${st}/${Oe.name}`:`file_${st}/${Oe.name}`,folderPath:st,...Oe.isFolder?{folders:Oe.folders,files:Oe.files}:{},actualPathArray:tt}),Oe.isFolder){const Nt=[...tt,Oe.name];Oe.folders&&Oe.folders.length>0&&F(Oe.folders.map(Dt=>({...Dt,isFolder:!0})),Nt),Oe.files&&Oe.files.length>0&&F(Oe.files.map(Dt=>({...Dt,isFolder:!1})),Nt)}})},oe=T.value||[];return F(E.value.map(Ie=>({...Ie,isFolder:!0})),oe),F(U.value.map(Ie=>({...Ie,isFolder:!1})),oe),I}),A=async B=>{if(console.log("點擊搜尋結果項目:",B),B.isFolder){const F=(B.actualPathArray?[...B.actualPathArray,B.name]:[B.name]).join("/");J(F)}else{const I=B.actualPathArray||[];if(q(B.name))n({name:B.name,size:B.size,folderPath:I.join("/"),actualPathArray:I});else if(i(B.name))dt({name:B.name,size:B.size,folderPath:I.join("/"),actualPathArray:I});else{console.log("點擊了非預覽類型檔案:",B.name);try{const F=await Gt.getFileUrl(B.name,null,I);if(F.data.code===0){const oe=document.createElement("a");oe.href=F.data.data.url,oe.target="_blank",oe.download=B.name,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)}else v.showError("下載失敗","無法獲取檔案下載連結")}catch(F){console.error("下載檔案錯誤:",F),v.showError("下載失敗","下載檔案時發生錯誤")}}}},J=async(B="")=>{try{o.value=!0,console.log("嘗試載入路徑:",B||"(根目錄)"),k.value=!1,z.value&&kt(),E.value=[],U.value=[];let I=[];if(B){const oe=B.replace(/\/+/g,"/").replace(/(^\/|\/$)/g,"");oe&&(I=oe.split("/"))}T.value=I,console.log("API 請求路徑陣列:",T.value);const F=await Gt.getFolderContents(T.value);if(F.data.code===0&&F.data.message==="success"){const oe=F.data.data;if(console.log("API返回的完整資料:",oe),R.value=oe,oe.pathUrl&&localStorage.setItem("fileBaseUrl",oe.pathUrl),E.value=(oe.folders||[]).map(Ie=>({name:Ie.name,files:Ie.files||[],folders:Ie.folders||[]})),U.value=oe.files||[],N.value=B,K.value=oe.name||"根目錄",B)h.replace({query:{path:B}});else{const Ie=window.location.pathname;window.history.pushState({},document.title,Ie)}}else console.error("獲取資料夾內容失敗:",F.data.message),v.showError("載入失敗","獲取資料夾內容失敗: "+F.data.message)}catch(I){console.error("獲取資料夾內容錯誤:",I),v.showError("載入失敗","無法獲取資料夾內容，請稍後再試")}finally{o.value=!1}},Q=B=>{k.value=!1,H.value="",z.value&&kt();{const I=window.location.pathname;window.history.pushState({},document.title,I),N.value="",T.value=[]}J(B)},Y=B=>{if(B<0||B>=T.value.length)return;z.value&&kt();const F=T.value.slice(0,B+1).join("/");J(F)},ue=B=>{if(console.log("開啟資料夾:",B),k.value){k.value=!1,H.value="",J(B);return}let I=N.value?`${N.value}/${B}`:B;J(I)},pe=B=>{if(B===0)return"0 Bytes";const I=1024,F=["Bytes","KB","MB","GB","TB"],oe=Math.floor(Math.log(B)/Math.log(I));return parseFloat((B/Math.pow(I,oe)).toFixed(2))+" "+F[oe]},ye=()=>{Z.value=!0,$.value="",c.value=""},ne=()=>{Z.value=!1,$.value="",c.value=""},se=async()=>{if(!$.value.trim()){c.value="請輸入資料夾名稱";return}if(/[/\\:*?"<>|]/.test($.value)){c.value='資料夾名稱不能包含以下字符: / \\ : * ? " < > |';return}if(E.value.some(F=>F.name===$.value)){c.value="資料夾已存在";return}try{y.value=!0;const F=$.value,oe=await Gt.createFolder(F,T.value);oe.data.code===0&&oe.data.message==="success"?(ne(),await J(N.value),v.showSuccess("建立成功",`資料夾 "${F}" 已成功建立`)):(console.error("建立資料夾失敗:",oe.data.message),v.showError("建立失敗","建立資料夾失敗: "+oe.data.message))}catch(F){console.error("建立資料夾錯誤:",F),v.showError("建立失敗","無法建立資料夾，請稍後再試")}finally{y.value=!1}},re=()=>{r.value=!0,p.value=[],f.value=0,W.value=""},Te=()=>{r.value=!1,p.value=[],f.value=0,W.value=""},Be=()=>{b.value.click()},ve=B=>{const I=Array.from(B.target.files);I.length!==0&&(p.value=[...p.value,...I],B.target.value="")},ie=B=>{V.value=!1;const I=Array.from(B.dataTransfer.files);I.length!==0&&(p.value=[...p.value,...I])},_e=async()=>{if(p.value.length===0){v.showError("上傳錯誤","請選擇要上傳的檔案");return}try{_.value=!0,f.value=0;const B=new FormData;T.value.length>0&&(T.value.forEach((oe,Ie)=>{B.append(`path[${Ie}]`,oe)}),console.log("上傳檔案路徑陣列:",T.value)),p.value.forEach(oe=>{B.append("files",oe)}),p.value.length===1&&W.value.trim()&&B.append("fileName",W.value.trim()),console.log("FormData 內容預覽:");for(const oe of B.entries())console.log(oe[0],oe[1]);const I=p.value.length,F=await Gt.uploadFiles(B,oe=>{oe.lengthComputable&&(f.value=oe.loaded/oe.total*100)});F.data.code===0&&F.data.message==="success"?(Te(),await J(N.value),v.showSuccess("上傳成功",`已成功上傳 ${I} 個檔案`)):(console.error("上傳檔案失敗:",F.data.message),v.showError("上傳失敗",F.data.message||"上傳檔案時出現錯誤"))}catch(B){console.error("上傳檔案錯誤:",B),v.showError("上傳失敗","上傳檔案時發生錯誤，請稍後再試")}finally{_.value=!1}};je(()=>{C();const B=d.query.path||"";console.log("初始路徑:",B),J(B)});const Le=async()=>{if(!H.value.trim()){v.showInfo("提示","請輸入搜尋關鍵字");return}z.value&&kt();try{o.value=!0,k.value=!0,D.value=H.value,E.value=[],U.value=[],console.log("搜尋關鍵字:",H.value);const B=await Gt.searchFiles(H.value,T.value);if(B.data.code===0&&B.data.message==="success"){const I=B.data.data;if(console.log("搜尋結果:",I),E.value=I.folders||[],U.value=I.files||[],O.value.length===0)v.showInfo("搜尋結果",`沒有找到與 "${H.value}" 相關的檔案或資料夾`);else{let F=O.value.length;v.showSuccess("搜尋結果",`找到 ${F} 個符合 "${H.value}" 的檔案`)}}else console.error("搜尋失敗:",B.data.message),v.showError("搜尋失敗","搜尋檔案和資料夾失敗: "+B.data.message),k.value=!1}catch(B){console.error("搜尋錯誤:",B),v.showError("搜尋失敗","搜尋時發生錯誤，請稍後再試"),k.value=!1}finally{o.value=!1}},ge=()=>{k.value=!1,H.value="",D.value="",z.value&&kt(),N.value="";const B=window.location.pathname;window.history.pushState({},document.title,B),J("")},q=B=>{const I=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"],F=B.toLowerCase().substring(B.lastIndexOf("."));return I.includes(F)},i=B=>{const I=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".csv",".log"],F=B.toLowerCase().substring(B.lastIndexOf("."));return I.includes(F)},n=async B=>{S.value=B,L.value=!0,de.value=!1,j.value=!0;try{let I;if(B.actualPathArray&&B.actualPathArray.length>0?I=await Gt.getFileUrl(B.name,null,B.actualPathArray):B.folderPath?I=await Gt.getFileUrl(B.name,B.folderPath):I=await Gt.getFileUrl(B.name,null,T.value),I.data.code===0&&I.data.message==="success"){const F=I.data.data.url;x.value=F,console.log("設置圖片預覽URL:",F),w(F)}else ce("獲取圖片URL失敗: "+I.data.message)}catch(I){ce("獲取圖片預覽錯誤: "+I)}},w=B=>{const I=new Image;I.onload=()=>{L.value=!1,de.value=!1},I.onerror=()=>{L.value=!1,de.value=!0,console.error("圖片載入失敗:",B)},I.src=B},ce=B=>{L.value=!1,de.value=!0,console.error(B)},he=()=>{j.value=!1,S.value={name:""},x.value="",L.value=!1,de.value=!1},Ve=B=>{q(B.name)?n(B):i(B.name)?dt(B):(console.log("點擊了非預覽類型檔案:",B.name),Gt.getFileUrl(B.name,null,T.value).then(I=>{if(I.data.code===0){const F=document.createElement("a");F.href=I.data.data.url,F.target="_blank",F.download=B.name,document.body.appendChild(F),F.click(),document.body.removeChild(F)}else v.showError("下載失敗","無法獲取檔案下載連結")}).catch(I=>{console.error("下載檔案錯誤:",I),v.showError("下載失敗","下載檔案時發生錯誤")}))},Qe=(B,I)=>{const F={...B,folderPath:I};console.log("點擊搜尋結果中的資料夾檔案:",B.name,"在資料夾:",I),q(B.name)?et(F):i(B.name)?dt(F):(console.log("點擊了搜尋結果中非預覽類型檔案:",B.name,"在資料夾:",I),Gt.getFileUrl(B.name,I).then(oe=>{if(oe.data.code===0){const Ie=document.createElement("a");Ie.href=oe.data.data.url,Ie.target="_blank",Ie.download=B.name,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie)}else v.showError("下載失敗","無法獲取檔案下載連結")}).catch(oe=>{console.error("下載搜尋結果檔案錯誤:",oe),v.showError("下載失敗","下載檔案時發生錯誤")}))},et=async B=>{S.value=B,L.value=!0,de.value=!1,j.value=!0;try{const I=B.name,F=B.folderPath;console.log("資料夾內圖片預覽:",I,"在資料夾:",F);const oe=await Gt.getFileUrl(I,F);if(oe.data.code===0&&oe.data.message==="success"){const Ie=oe.data.data.url;x.value=Ie,console.log("設置資料夾內圖片預覽URL:",Ie),w(Ie)}else ce("獲取資料夾內圖片URL失敗: "+oe.data.message)}catch(I){ce("獲取資料夾內圖片預覽錯誤: "+I)}},Ct=()=>{L.value=!1,de.value=!1},ct=()=>{L.value=!1,de.value=!0,console.error("圖片載入失敗:",x.value)},lt=async()=>{L.value=!0,de.value=!1,S.value.actualPathArray&&S.value.actualPathArray.length>0?await n({name:S.value.name,size:S.value.size,actualPathArray:S.value.actualPathArray}):S.value.folderPath?await n({name:S.value.name,size:S.value.size,folderPath:S.value.folderPath}):await n(S.value)},dt=async B=>{fe.value=B,De.value=!0,we.value=!1,xe.value=!0,ke.value="",$e.value="";try{let I;if(B.actualPathArray&&B.actualPathArray.length>0?I=await Gt.getFileUrl(B.name,null,B.actualPathArray):B.folderPath?I=await Gt.getFileUrl(B.name,B.folderPath):I=await Gt.getFileUrl(B.name,null,T.value),I.data.code===0&&I.data.message==="success"){const F=I.data.data.url;console.log("文本檔案預覽URL:",F),$e.value=F,ke.value=`正在嘗試載入文本內容...

如果無法正常顯示，您可以點擊下方的「在新視窗中開啟」按鈕查看檔案內容。`,De.value=!1}else De.value=!1,we.value=!0,console.error("獲取文本檔案URL失敗:",I.data.message)}catch(I){De.value=!1,we.value=!0,console.error("獲取文本檔案預覽錯誤:",I)}},At=()=>{xe.value=!1,fe.value={name:""},ke.value="",De.value=!1,we.value=!1},Et=async()=>{De.value=!0,we.value=!1,fe.value.actualPathArray&&fe.value.actualPathArray.length>0?await dt({name:fe.value.name,size:fe.value.size,actualPathArray:fe.value.actualPathArray}):fe.value.folderPath?await dt({name:fe.value.name,size:fe.value.size,folderPath:fe.value.folderPath}):await dt(fe.value)},ds=async()=>{if(!z.value){z.value=!0,g.value=[];return}await _t()},_t=async()=>{if(g.value.length===0){v.showInfo("提示","請選擇要刪除的項目");return}await v.confirmAsync("確認刪除",`確定要刪除選中的 ${g.value.length} 個項目嗎？刪除後資料將無法恢復。`)&&await ts()},ts=async()=>{const B=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(!(B===null||B===""))try{if(a.value=!0,(await Zt.confirmPassword(B)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}await Qt(),kt()}catch(I){console.error("操作錯誤:",I),qt(I)}finally{a.value=!1}},qt=B=>{B.response&&B.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","批次刪除時發生錯誤，請稍後再試")},Qt=async()=>{if(g.value.length===0)return;const B=g.value.map(oe=>({name:oe.name,isFolder:oe.isFolder,path:oe.path||[]}));console.log("處理後的刪除項目:",B);const I=B.length,F=await Gt.deleteItems(B);return F.data.code===0?(await J(N.value),v.showSuccess("刪除成功",`成功刪除 ${I} 個項目`),!0):(console.error("批次刪除失敗:",F.data.message),v.showError("刪除失敗","批次刪除項目失敗: "+F.data.message),!1)},kt=()=>{z.value=!1,g.value=[]},Kt=()=>{if(z.value)if(k.value)g.value=O.value.map(B=>({name:B.name,isFolder:B.isFolder,path:B.actualPathArray||[]}));else{const B=[];E.value.forEach(I=>{B.push({name:I.name,isFolder:!0,path:T.value})}),U.value.forEach(I=>{B.push({name:I.name,isFolder:!1,path:T.value})}),g.value=B}},Bt=B=>{const I=B.folders?B.folders.length:0,F=B.files?B.files.length:0,oe=[];return I>0&&oe.push(`${I} 個資料夾`),F>0&&oe.push(`${F} 個檔案`),oe.length>0?oe.join(", "):"空資料夾"};return(B,I)=>(t(),s(X,null,[e("div",UU,[e("div",NU,[Ge(ft,{breadcrumbs:[{name:"檔案管理",path:"/"}]})]),e("div",TU,[e("div",VU,[e("div",jU,[e("div",LU,[I[17]||(I[17]=e("span",{class:"font-bold"},"目前位置：",-1)),e("div",FU,[e("span",{class:"cursor-pointer text-blue-600 hover:underline",onClick:I[0]||(I[0]=F=>Q(""))}," 根目錄 "),T.value.length>0?(t(!0),s(X,{key:0},le(T.value,(F,oe)=>(t(),s(X,{key:oe},[I[16]||(I[16]=e("span",{class:"mx-1"},"/",-1)),e("span",{class:"cursor-pointer text-blue-600 hover:underline",onClick:Ie=>Y(oe)},l(F),9,OU)],64))),128)):G("",!0)])])]),e("div",qU,[e("div",BU,[P(e("input",{type:"text","onUpdate:modelValue":I[1]||(I[1]=F=>H.value=F),placeholder:"搜尋檔案或資料夾...",class:"w-full px-4 py-2 border border-gray-300 rounded-md pr-10 outline-none",onKeyup:Ue(Le,["enter"])},null,544),[[te,H.value]]),e("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:Le},I[18]||(I[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)]))])]),e("div",null,[u.value.fileManagerCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:ye}," 新增資料夾 ")):G("",!0)]),e("div",null,[u.value.fileManagerUpload?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:re}," 上傳檔案 ")):G("",!0)]),e("div",null,[u.value.fileManagerDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",onClick:ds},l(z.value?"確定刪除":"批次刪除"),1)):G("",!0)])]),e("div",HU,[z.value?(t(),s("div",WU,[e("div",zU,[e("button",{onClick:Kt,class:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600"}," 全選 "),e("button",{onClick:I[2]||(I[2]=F=>g.value=[]),class:"px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400"}," 取消選擇 "),e("button",{onClick:kt,class:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600"}," 退出刪除模式 ")]),e("div",KU,[I[19]||(I[19]=me(" 已選擇 ")),e("span",JU,l(g.value.length),1),I[20]||(I[20]=me(" 個項目 "))])])):G("",!0),o.value?(t(),s("div",YU,I[21]||(I[21]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):k.value?(t(),s("div",GU,[e("div",ZU,[e("div",QU,' 搜尋 "'+l(H.value)+'" 的結果： ',1),e("button",{onClick:ge,class:"text-sm text-blue-600 hover:underline"}," 返回檔案列表 ")]),O.value.length===0?(t(),s("div",XU," 沒有找到符合的檔案或資料夾 ")):(t(),s("div",eN,[e("h3",tN,"搜尋結果 ("+l(O.value.length)+" 個項目)",1),e("div",sN,[(t(!0),s(X,null,le(O.value,F=>(t(),s("div",{key:F.id,class:"border rounded-md p-3 hover:bg-gray-50 cursor-pointer",onClick:oe=>z.value?null:A(F)},[e("div",oN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:I[4]||(I[4]=es(()=>{},["stop"]))},[P(e("input",{type:"checkbox",id:`search-item-${F.id}`,"onUpdate:modelValue":I[3]||(I[3]=oe=>g.value=oe),value:{name:F.name,isFolder:F.isFolder,path:F.actualPathArray,folder:F.folderPath},class:"w-4 h-4 cursor-pointer"},null,8,lN),[[Ce,g.value]])])):G("",!0),e("div",{class:ee(["mr-2",{"text-yellow-500":F.isFolder,"text-blue-500":!F.isFolder}])},[F.isFolder?(t(),s("svg",nN,I[22]||(I[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"},null,-1)]))):q(F.name)?(t(),s("svg",rN,I[23]||(I[23]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",iN,I[24]||(I[24]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))],2),e("div",{class:"truncate",title:F.name},l(F.name),9,dN)]),F.folderPath?(t(),s("div",uN," 在資料夾: "+l(F.folderPath),1)):G("",!0)],8,aN))),128))])]))])):E.value.length===0&&U.value.length===0?(t(),s("div",cN," 此資料夾為空 ")):(t(),s("div",pN,[E.value.length>0?(t(),s("div",vN,[I[29]||(I[29]=e("h3",{class:"text-lg font-bold mb-2"},"資料夾",-1)),e("div",mN,[(t(!0),s(X,null,le(E.value,F=>(t(),s("div",{key:F.name,class:"border rounded-md p-3 cursor-pointer hover:bg-gray-50",onClick:oe=>z.value?null:ue(F.name)},[e("div",fN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:I[6]||(I[6]=es(()=>{},["stop"]))},[P(e("input",{type:"checkbox",id:`folder-${F.name}`,"onUpdate:modelValue":I[5]||(I[5]=oe=>g.value=oe),value:{name:F.name,isFolder:!0,path:T.value},class:"w-4 h-4 cursor-pointer"},null,8,yN),[[Ce,g.value]])])):G("",!0),I[25]||(I[25]=e("div",{class:"text-yellow-500 mr-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})])],-1)),e("div",{class:"truncate",title:F.name},l(F.name),9,gN)]),e("div",xN,l(Bt(F)),1),k.value&&F.files&&F.files.length?(t(),s("div",hN,[I[28]||(I[28]=e("div",{class:"text-xs font-medium text-gray-700 mb-1"},"符合條件的檔案:",-1)),(t(!0),s(X,null,le(F.files,oe=>(t(),s("div",{key:oe.name,class:"flex items-center py-1 px-2 hover:bg-gray-100 rounded text-xs cursor-pointer",onClick:es(Ie=>Qe(oe,F.name),["stop"])},[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:I[8]||(I[8]=es(()=>{},["stop"]))},[P(e("input",{type:"checkbox",id:`folder-file-${F.name}-${oe.name}`,"onUpdate:modelValue":I[7]||(I[7]=Ie=>g.value=Ie),value:{name:oe.name,isFolder:!1,folder:F.name},class:"w-4 h-4 cursor-pointer"},null,8,_N),[[Ce,g.value]])])):G("",!0),e("div",kN,[q(oe.name)?(t(),s("svg",$N,I[26]||(I[26]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",CN,I[27]||(I[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),e("div",{class:"truncate",title:oe.name},l(oe.name),9,EN)],8,wN))),128))])):G("",!0)],8,bN))),128))])])):G("",!0),U.value.length>0?(t(),s("div",SN,[I[32]||(I[32]=e("h3",{class:"text-lg font-bold mb-2"},"檔案",-1)),e("div",DN,[(t(!0),s(X,null,le(U.value,F=>(t(),s("div",{key:F.name,class:"border rounded-md p-3 hover:bg-gray-50 cursor-pointer",onClick:oe=>z.value?null:Ve(F)},[e("div",AN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:I[10]||(I[10]=es(()=>{},["stop"]))},[P(e("input",{type:"checkbox",id:`file-${F.name}`,"onUpdate:modelValue":I[9]||(I[9]=oe=>g.value=oe),value:{name:F.name,isFolder:!1,path:T.value},class:"w-4 h-4 cursor-pointer"},null,8,IN),[[Ce,g.value]])])):G("",!0),e("div",RN,[q(F.name)?(t(),s("svg",PN,I[30]||(I[30]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",UN,I[31]||(I[31]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),e("div",{class:"truncate",title:F.name},l(F.name),9,NN)])],8,MN))),128))])])):G("",!0)]))])])]),Z.value?(t(),s("div",TN,[e("div",VN,[I[34]||(I[34]=e("h3",{class:"text-lg font-medium mb-4"},"新增資料夾",-1)),e("div",jN,[I[33]||(I[33]=e("label",{for:"newFolderName",class:"block text-sm font-medium text-gray-700 mb-1"},"資料夾名稱",-1)),P(e("input",{id:"newFolderName",type:"text","onUpdate:modelValue":I[11]||(I[11]=F=>$.value=F),class:"w-full p-2 border border-gray-300 rounded outline-none",placeholder:"請輸入資料夾名稱",onKeyup:Ue(se,["enter"])},null,544),[[te,$.value]]),c.value?(t(),s("p",LN,l(c.value),1)):G("",!0)]),e("div",FN,[e("button",{onClick:ne,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 "),e("button",{onClick:se,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:y.value},l(y.value?"建立中...":"建立"),9,ON)])])])):G("",!0),r.value?(t(),s("div",qN,[e("div",BN,[I[41]||(I[41]=e("h3",{class:"text-lg font-medium mb-4"},"上傳檔案",-1)),e("div",HN,[I[35]||(I[35]=e("label",{for:"uploadPath",class:"block text-sm font-medium text-gray-700 mb-1"},"上傳至路徑",-1)),e("div",WN,l(N.value||"根目錄"),1)]),e("div",zN,[I[36]||(I[36]=e("label",{for:"uploadFileName",class:"text-sm font-medium text-gray-700 mb-1 flex justify-between"},[e("span",null,"指定檔案名稱（可選）"),e("span",{class:"text-xs text-gray-500"},"僅在上傳單一檔案時有效")],-1)),P(e("input",{id:"uploadFileName",type:"text","onUpdate:modelValue":I[12]||(I[12]=F=>W.value=F),class:"w-full p-2 border border-gray-300 rounded outline-none",disabled:p.value.length!==1,placeholder:"輸入檔案名稱"},null,8,KN),[[te,W.value]])]),e("div",JN,[I[39]||(I[39]=e("label",{for:"fileInput",class:"text-sm font-medium text-gray-700 mb-1"},"選擇檔案",-1)),e("div",{class:ee(["border-dashed border-2 border-gray-300 p-6 rounded-md text-center",{"bg-blue-50 border-blue-300":V.value}]),onDragover:I[14]||(I[14]=es(F=>V.value=!0,["prevent"])),onDragleave:I[15]||(I[15]=es(F=>V.value=!1,["prevent"])),onDrop:es(ie,["prevent"])},[e("input",{id:"fileInput",type:"file",ref_key:"fileInput",ref:b,class:"hidden",onChange:ve,multiple:""},null,544),p.value.length===0?(t(),s("div",YN,[I[37]||(I[37]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),I[38]||(I[38]=e("p",{class:"mt-1"},"拖曳檔案至此處，或",-1)),e("button",{onClick:Be,class:"mt-2 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," 選擇檔案 ")])):(t(),s("div",GN,[e("p",ZN,"已選擇 "+l(p.value.length)+" 個檔案:",1),e("ul",QN,[(t(!0),s(X,null,le(p.value,(F,oe)=>(t(),s("li",{key:oe,class:"flex justify-between items-center py-1"},[e("div",XN,l(F.name),1)]))),128))]),e("button",{onClick:I[13]||(I[13]=F=>p.value=[]),class:"mt-2 text-red-600 text-sm hover:text-red-800"}," 清除全部 ")]))],34)]),e("div",eT,[e("button",{onClick:Te,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:_.value}," 取消 ",8,tT),e("button",{onClick:_e,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:_.value||p.value.length===0},l(_.value?"上傳中...":"上傳"),9,sT)]),_.value?(t(),s("div",aT,[e("div",oT,[I[40]||(I[40]=e("span",{class:"text-sm"},"上傳進度",-1)),e("span",lT,l(Math.round(f.value))+"%",1)]),e("div",nT,[e("div",{class:"bg-[#4e9875] h-2 rounded-full",style:Qs({width:f.value+"%"})},null,4)])])):G("",!0)])])):G("",!0),j.value?(t(),s("div",rT,[e("div",iT,[e("div",{class:"flex justify-between items-center mb-3"},[I[43]||(I[43]=e("h3",{class:"text-lg font-medium"},"圖片預覽",-1)),e("button",{onClick:he,class:"text-gray-500 hover:text-gray-700"},I[42]||(I[42]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",dT,[L.value?(t(),s("div",uT,I[44]||(I[44]=[e("svg",{class:"animate-spin h-10 w-10 text-gray-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("div",null,"圖片載入中...",-1)]))):de.value?(t(),s("div",cT,[I[45]||(I[45]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),I[46]||(I[46]=e("div",null,"圖片載入失敗",-1)),I[47]||(I[47]=e("div",{class:"mt-2 text-sm"}," 可能是因為檔案路徑錯誤或者檔案不存在 ",-1)),e("div",{class:"mt-4"},[e("button",{onClick:lt,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," 重試 ")])])):(t(),s("img",{key:2,src:x.value,alt:ae.value,class:"max-w-full max-h-[calc(90vh-120px)] object-contain",onLoad:Ct,onError:ct},null,40,pT))]),e("div",vT,[e("div",null,"檔案名稱: "+l(S.value.name),1),S.value.size?(t(),s("div",mT,"檔案大小: "+l(pe(S.value.size)),1)):G("",!0)])])])):G("",!0),xe.value?(t(),s("div",bT,[e("div",fT,[e("div",{class:"flex justify-between items-center mb-3"},[I[49]||(I[49]=e("h3",{class:"text-lg font-medium"},"文本檔案預覽",-1)),e("button",{onClick:At,class:"text-gray-500 hover:text-gray-700"},I[48]||(I[48]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",yT,[De.value?(t(),s("div",gT,I[50]||(I[50]=[e("svg",{class:"animate-spin h-10 w-10 text-gray-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("div",null,"文本載入中...",-1)]))):we.value?(t(),s("div",xT,[I[51]||(I[51]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),I[52]||(I[52]=e("div",null,"文本載入失敗",-1)),I[53]||(I[53]=e("div",{class:"mt-2 text-sm"}," 可能是因為檔案路徑錯誤或者檔案不存在 ",-1)),e("div",{class:"mt-4"},[e("button",{onClick:Et,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," 重試 ")])])):(t(),s("div",hT,[$e.value?(t(),s("iframe",{key:0,src:$e.value,class:"w-full h-[calc(90vh-200px)] border-0 rounded",title:"文本檔案內容預覽"},null,8,wT)):(t(),s("pre",_T,l(ke.value),1))]))]),e("div",kT,[e("div",null,"檔案名稱: "+l(fe.value.name),1),fe.value.size?(t(),s("div",$T,"檔案大小: "+l(pe(fe.value.size)),1)):G("",!0),e("div",CT,[$e.value?(t(),s("a",{key:0,href:$e.value,target:"_blank",class:"inline-block px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"}," 在新視窗中開啟 ",8,ET)):G("",!0)])])])])):G("",!0)],64))}},DT=Fe(ST,[["__scopeId","data-v-e0c17a53"]]),MT={class:"flex flex-col items-center p-6"},AT={class:"w-full max-w-[600px] mb-6"},IT={key:0,class:"mt-2 text-red-500"},RT={class:"w-full max-w-[600px] bg-white p-6 shadow-md rounded"},PT={class:"mb-4"},UT={class:"mb-4"},NT={class:"mb-6"},TT={key:0,class:"mb-4 p-2 bg-red-100 text-red-700 rounded"},VT={class:"flex justify-end space-x-4"},jT=["disabled"],LT=["disabled"],FT={__name:"Password",setup(M){const h=We(),d=m(!1),u=m(!1),C=Gs({oldPassword:"",newPassword:"",confirmPassword:""}),o=m(""),N=m(!1),K=async()=>{try{const R=await ot.getSidebarPermissions();if(R.data.code===0&&R.data.message==="success"){const Z=R.data.data;d.value=Z.isNeedChangePwd===!0,d.value||Z.systemManagement&&Z.userRead?u.value=!0:(v.showError("無權限訪問","您沒有權限訪問此頁面"),setTimeout(()=>{h.push("/")},1500))}else v.showError("獲取權限失敗","請重新登入"),setTimeout(()=>{E()},1500)}catch(R){console.error("獲取權限錯誤:",R),v.showError("獲取權限錯誤","請重新登入"),setTimeout(()=>{E()},1500)}},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(R=>{R.startsWith("app_")&&localStorage.removeItem(R)}),sessionStorage.clear(),window.location.href="/login?t="+new Date().getTime()},U=R=>R.length>=12&&/[A-Z]/.test(R)&&/[a-z]/.test(R)&&/\d/.test(R),T=()=>C.newPassword===C.confirmPassword,z=()=>C.newPassword!==C.oldPassword,g=async()=>{var R,Z,$;if(o.value="",!U(C.newPassword)){o.value="新密碼必須至少包含12個字符，並包含大小寫字母和數字";return}if(!T()){o.value="新密碼與確認密碼不一致";return}if(!z()){o.value="新密碼不能與舊密碼相同";return}try{N.value=!0;const c=await is.updatePassword({oldPassword:C.oldPassword,newPassword:C.newPassword});if(c.data&&c.data.code===0)v.showSuccess("密碼修改成功","您的密碼已成功更新，請使用新密碼登入"),setTimeout(()=>{E()},1500);else{const y=((R=c.data)==null?void 0:R.message)||"密碼更新失敗，請稍後再試";o.value=y,v.showError("密碼更新失敗",y)}}catch(c){console.error("密碼更新錯誤:",c);const y=(($=(Z=c.response)==null?void 0:Z.data)==null?void 0:$.message)||"密碼更新失敗，請稍後再試";o.value=y,v.showError("密碼更新失敗",y)}finally{N.value=!1}},a=async()=>{if(d.value){v.showError("無法取消","您必須修改密碼才能繼續使用系統");return}await v.confirmAsync("確認離開","確定要離開嗎？所有未保存的更改將會丟失。")&&h.back()};return je(()=>{K()}),(R,Z)=>(t(),s("div",MT,[e("div",AT,[Z[3]||(Z[3]=e("h1",{class:"text-2xl font-bold"},"重設密碼",-1)),d.value?(t(),s("p",IT,"您的帳號需要修改密碼才能繼續使用系統")):G("",!0)]),e("div",RT,[e("form",{onSubmit:es(g,["prevent"])},[e("div",PT,[Z[4]||(Z[4]=e("label",{for:"old-password",class:"block mb-2 font-medium"},"舊密碼",-1)),P(e("input",{type:"password",id:"old-password","onUpdate:modelValue":Z[0]||(Z[0]=$=>C.oldPassword=$),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請輸入舊密碼",required:""},null,512),[[te,C.oldPassword]])]),e("div",UT,[Z[5]||(Z[5]=e("label",{for:"new-password",class:"block mb-2 font-medium"},"新密碼",-1)),P(e("input",{type:"password",id:"new-password","onUpdate:modelValue":Z[1]||(Z[1]=$=>C.newPassword=$),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請輸入新密碼",required:""},null,512),[[te,C.newPassword]]),Z[6]||(Z[6]=e("p",{class:"mt-1 text-sm text-gray-500"}," 密碼必須至少包含12個字符，並包含大小寫字母和數字。 ",-1))]),e("div",NT,[Z[7]||(Z[7]=e("label",{for:"confirm-password",class:"block mb-2 font-medium"},"確認新密碼",-1)),P(e("input",{type:"password",id:"confirm-password","onUpdate:modelValue":Z[2]||(Z[2]=$=>C.confirmPassword=$),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請再次輸入新密碼",required:""},null,512),[[te,C.confirmPassword]])]),o.value?(t(),s("div",TT,l(o.value),1)):G("",!0),e("div",VT,[e("button",{type:"button",class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:a,disabled:N.value||d.value,"aria-label":"取消修改密碼"}," 取消 ",8,jT),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",disabled:N.value,"aria-label":"提交修改密碼"},l(N.value?"提交中...":"提交"),9,LT)])],32)])]))}},OT=Fe(FT,[["__scopeId","data-v-622703ef"]]),qT={class:"flex flex-col items-center p-6"},BT={class:"w-full max-w-[1500px]"},HT={class:"w-full max-w-[1500px] mt-2"},WT={class:"flex border-b border-gray-200"},zT={class:"mt-6"},KT={key:0,class:"bg-white p-6 rounded-lg shadow-sm"},JT={class:"mb-6 bg-gray-50 p-4 rounded-md"},YT={class:"space-y-4"},GT={class:"flex items-center space-x-4"},ZT={for:"export-scope-all",class:"inline-flex items-center"},QT={for:"export-scope-selected",class:"inline-flex items-center"},XT={key:0,class:"pl-4 border-l-2 border-gray-200"},eV={class:"grid grid-cols-3 gap-2"},tV=["for"],sV=["id","value"],aV={class:"ml-2"},oV={class:"flex items-center"},lV={class:"flex flex-col space-y-4"},nV={class:"flex items-center space-x-4"},rV=["disabled"],iV={key:0},dV={key:1},uV={key:1,class:"text-blue-600"},cV={key:2,class:"text-green-600"},pV={key:3,class:"text-red-600"},vV={key:0,class:"w-full max-w-lg"},mV={class:"relative pt-1"},bV={class:"flex items-center justify-between mb-2"},fV={class:"text-right"},yV={class:"text-xs font-semibold inline-block text-blue-600"},gV={class:"overflow-hidden h-2 text-xs flex rounded bg-blue-200"},xV={key:1,class:"bg-white p-6 rounded-lg shadow-sm"},hV={class:"flex flex-col space-y-4"},wV={class:"flex items-center space-x-4"},_V=["disabled"],kV={key:0},$V={key:1},CV={key:1,class:"text-blue-600"},EV={key:2,class:"text-green-600"},SV={key:3,class:"text-red-600"},DV={__name:"Database",setup(M){const h=m("export"),d=m({dataBaseExport:!1}),u=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?d.value=$.data.data:console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}},C=m({scope:"all",selectedTables:[],fileName:`database_export_${new Date().toISOString().split("T")[0]}`}),o=m([]),N=async()=>{try{const $=await nt.getTables();$.data.code===0&&$.data.message==="success"?o.value=$.data.data:(console.error("獲取資料表列表失敗:",$.data.message),v.showError("載入失敗","獲取資料表列表時發生錯誤"))}catch($){console.error("獲取資料表列表錯誤:",$),v.showError("載入失敗","獲取資料表列表時發生錯誤")}},K=m(!1),E=m(0),U=m(!1),T=m(null),z=async()=>{var $,c;if(C.value.scope==="selected"&&C.value.selectedTables.length===0){v.showError("選擇錯誤","請至少選擇一個要匯出的資料表");return}U.value=!1,T.value=null,K.value=!0,E.value=0;try{const y=setInterval(()=>{E.value<90&&(E.value+=1)},200),r={selectItem:C.value.scope==="all"?1:2,tables:C.value.scope==="selected"?C.value.selectedTables:[],name:C.value.fileName||`database_export_${new Date().toISOString().split("T")[0]}`},b=await us.exportDatabase(r);clearInterval(y),E.value=100;const p=window.URL.createObjectURL(new Blob([b.data])),_=document.createElement("a");_.href=p;const f=`${r.name}.json`;_.setAttribute("download",f),document.body.appendChild(_),_.click(),_.parentNode.removeChild(_),window.URL.revokeObjectURL(p),setTimeout(()=>{K.value=!1,U.value=!0,v.showSuccess("匯出成功",`資料庫已成功匯出為 ${f}`)},500)}catch(y){console.error("匯出過程中發生錯誤:",y),T.value=((c=($=y.response)==null?void 0:$.data)==null?void 0:c.message)||y.message||"匯出過程中發生未知錯誤",K.value=!1,E.value=0,v.showError("匯出失敗",T.value)}};je(()=>{u(),N()});const g=m(!1),a=m(!1),R=m(null),Z=async()=>{var $,c;g.value=!0,a.value=!1,R.value=null;try{const y=await us.exportDump(),r=`database-backup_${new Date().toISOString().split("T")[0]}.sql`,b=window.URL.createObjectURL(new Blob([y.data])),p=document.createElement("a");p.href=b,p.setAttribute("download",r),document.body.appendChild(p),p.click(),p.parentNode.removeChild(p),window.URL.revokeObjectURL(b),a.value=!0,v.showSuccess("備份成功","資料庫備份檔案已開始下載。")}catch(y){console.error("備份過程中發生錯誤:",y),R.value=((c=($=y.response)==null?void 0:$.data)==null?void 0:c.message)||y.message||"備份過程中發生未知錯誤",v.showError("備份失敗",R.value)}finally{g.value=!1}};return($,c)=>(t(),s("div",qT,[e("div",BT,[Ge(ft,{breadcrumbs:[{name:"資料庫管理",path:"/database"}]})]),e("div",HT,[e("div",WT,[e("button",{onClick:c[0]||(c[0]=y=>h.value="export"),class:ee(["py-2 px-4 text-base font-medium",h.value==="export"?"border-b-2 border-[#4e9875] text-[#4e9875]":"text-gray-500 hover:text-gray-700"])}," 資料庫匯出 ",2),e("button",{onClick:c[1]||(c[1]=y=>h.value="backup"),class:ee(["py-2 px-4 text-base font-medium",h.value==="backup"?"border-b-2 border-[#4e9875] text-[#4e9875]":"text-gray-500 hover:text-gray-700"])}," 資料庫備份 ",2)]),e("div",zT,[h.value==="export"?(t(),s("div",KT,[c[14]||(c[14]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold mb-2"},"資料庫匯出"),e("p",{class:"text-gray-600"},"您可以匯出整個資料庫的資料為 JSON 格式檔案，便於備份或資料遷移。")],-1)),e("div",JT,[c[12]||(c[12]=e("h4",{class:"font-medium mb-4"},"匯出設定",-1)),e("div",YT,[e("fieldset",null,[c[8]||(c[8]=e("legend",{class:"block mb-2"},"匯出範圍：",-1)),e("div",GT,[e("label",ZT,[P(e("input",{id:"export-scope-all",type:"radio","onUpdate:modelValue":c[2]||(c[2]=y=>C.value.scope=y),value:"all",name:"exportScope",class:"form-radio"},null,512),[[bt,C.value.scope]]),c[6]||(c[6]=e("span",{class:"ml-2"},"全部資料",-1))]),e("label",QT,[P(e("input",{id:"export-scope-selected",type:"radio","onUpdate:modelValue":c[3]||(c[3]=y=>C.value.scope=y),value:"selected",name:"exportScope",class:"form-radio"},null,512),[[bt,C.value.scope]]),c[7]||(c[7]=e("span",{class:"ml-2"},"選擇特定資料表",-1))])])]),C.value.scope==="selected"?(t(),s("fieldset",XT,[c[9]||(c[9]=e("legend",{class:"block mb-2"},"選擇資料表：",-1)),e("div",eV,[(t(!0),s(X,null,le(o.value,y=>(t(),s("label",{key:y.id,for:`table-${y.id}`,class:"inline-flex items-center"},[P(e("input",{id:`table-${y.id}`,type:"checkbox","onUpdate:modelValue":c[4]||(c[4]=r=>C.value.selectedTables=r),value:y.id,class:"form-checkbox"},null,8,sV),[[Ce,C.value.selectedTables]]),e("span",aV,l(y.name),1)],8,tV))),128))])])):G("",!0),e("div",null,[c[11]||(c[11]=e("label",{for:"file-name",class:"block mb-2"},"檔案名稱：",-1)),e("div",oV,[P(e("input",{id:"file-name",type:"text","onUpdate:modelValue":c[5]||(c[5]=y=>C.value.fileName=y),class:"p-2 border border-gray-300 rounded w-full max-w-md outline-none",placeholder:"輸入檔案名稱（不含副檔名）"},null,512),[[te,C.value.fileName]]),c[10]||(c[10]=e("span",{class:"ml-2"},".json",-1))])])])]),e("div",lV,[e("div",nV,[d.value.dataBaseExport?(t(),s("button",{key:0,onClick:z,class:"px-6 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",disabled:K.value,"aria-label":"匯出資料庫"},[K.value?(t(),s("span",dV,"匯出中...")):(t(),s("span",iV,"開始匯出"))],8,rV)):G("",!0),K.value?(t(),s("span",uV,"正在匯出資料，請勿關閉視窗...")):G("",!0),U.value?(t(),s("span",cV,"匯出成功！")):G("",!0),T.value?(t(),s("span",pV,"匯出失敗："+l(T.value),1)):G("",!0)]),K.value?(t(),s("div",vV,[e("div",mV,[e("div",bV,[c[13]||(c[13]=e("div",null,[e("span",{class:"text-xs font-semibold inline-block text-blue-600"}," 匯出進度 ")],-1)),e("div",fV,[e("span",yV,l(E.value)+"% ",1)])]),e("div",gV,[e("div",{style:Qs({width:E.value+"%"}),class:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"},null,4)])])])):G("",!0)])])):G("",!0),h.value==="backup"?(t(),s("div",xV,[c[15]||(c[15]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold mb-2"},"資料庫備份"),e("p",{class:"text-gray-600"},"您可以點擊下方按鈕來備份整個資料庫，系統將會下載一個 SQL dump 檔案。")],-1)),e("div",hV,[e("div",wV,[d.value.dataBaseExport?(t(),s("button",{key:0,onClick:Z,class:"px-6 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",disabled:g.value,"aria-label":"備份資料庫"},[g.value?(t(),s("span",$V,"備份中...")):(t(),s("span",kV,"開始備份"))],8,_V)):G("",!0),g.value?(t(),s("span",CV,"正在處理備份，請稍候...")):G("",!0),a.value?(t(),s("span",EV,"備份檔案已開始下載！")):G("",!0),R.value?(t(),s("span",SV,"備份失敗："+l(R.value),1)):G("",!0)])])])):G("",!0)])])]))}},MV=Fe(DV,[["__scopeId","data-v-79b50d50"]]),AV={class:"flex flex-col items-center p-6"},IV={class:"w-full max-w-[1500px]"},RV={class:"w-full max-w-[1500px]"},PV={class:"flex items-center space-x-4"},UV={class:"relative w-40"},NV={class:"w-full max-w-[1500px]"},TV={class:"overflow-x-auto"},VV={class:"w-full border-collapse"},jV={class:"border p-2 text-center"},LV={class:"border p-2 text-center"},FV={class:"border p-2 text-center"},OV={class:"border p-2 text-center"},qV={class:"flex justify-center space-x-2"},BV=["onClick"],HV=["onClick"],WV={key:0},zV={key:0,class:"flex justify-center items-center space-x-2 mt-6"},KV=["disabled"],JV=["onClick"],YV={key:1,class:"px-2"},GV=["disabled"],ZV={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},QV={class:"bg-white p-6 rounded-lg w-[500px] max-h-[90vh] overflow-y-auto"},XV={class:"flex justify-between items-center mb-4"},ej={class:"text-xl font-bold"},tj={class:"space-y-4 flex flex-col items-center"},sj={class:"flex items-center w-full max-w-[440px]"},aj={class:"flex-1"},oj=["value"],lj={class:"flex items-center w-full max-w-[440px]"},nj={class:"flex-1"},rj={class:"flex items-center w-full max-w-[440px]"},ij={class:"flex-1"},dj={class:"flex justify-end space-x-2 w-full max-w-[440px] mt-4"},uj=["disabled"],Js=20,cj={__name:"Agency",setup(M){const h=m(""),d=m([]),u=m(1),C=m(1),o=m(0),N=m(!1),K=m(!1),E=m(!1),U=m({id:"",code:"",name:"",parentAgencyId:""}),T=m(null),z=m(""),g=m(!1),a=m({agencyCreate:!1,agencyUpdate:!1,agencyDelete:!1}),R=m([]),Z=()=>{h.value=""},$=()=>{u.value=1,c()},c=async()=>{try{const k={page:u.value,limit:Js,keyword:h.value||void 0},D=await nt.getAgencies(k);D.data.code===0?(d.value=D.data.data.list,o.value=D.data.data.totalCount,C.value=D.data.data.totalPage):(console.error("獲取機關列表失敗:",D.data.message),d.value=[],o.value=0,C.value=0,v.showError("獲取資料失敗",D.data.message||"無法獲取機關列表，請稍後再試"))}catch(k){console.error("獲取機關列表錯誤:",k),v.showError("獲取資料失敗","連接伺服器時發生錯誤，請稍後再試"),d.value=[],o.value=0,C.value=0}},y=k=>{u.value=k,c()},r=()=>{u.value>1&&(u.value--,c())},b=()=>{u.value<C.value&&(u.value++,c())},p=async()=>{K.value=!1,U.value={id:"",code:"",name:"",parentAgencyId:""};const k=await nt.getAgencies({limit:1e3});k.data.code===0&&(R.value=k.data.data.list.filter(D=>D.id!==U.value.id)),N.value=!0},_=async k=>{K.value=!0,U.value={id:k.id,code:k.code,name:k.name,parentAgencyId:k.parentAgencyId||""};const D=await nt.getAgencies({limit:1e3});D.data.code===0&&(R.value=D.data.data.list.filter(j=>j.id!==U.value.id)),N.value=!0},f=async k=>{if(T.value=k.id,z.value=k.name,await v.confirmAsync("確認刪除",`確定要刪除「${k.name}」嗎？此操作無法復原。`)){const j=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(j===null||j===""){T.value=null,z.value="";return}V(j)}else T.value=null,z.value=""},V=async k=>{if(T.value)try{if(g.value=!0,(await rs.confirmPassword(k)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),g.value=!1,showDeleteConfirm.value=!1,T.value=null,z.value="";return}const j=await nt.deleteAgency(T.value);j.data.code===0?(v.showSuccess("刪除成功","機關已成功刪除"),c()):v.showError("刪除失敗",j.data.message||"刪除機關失敗，請稍後再試")}catch(D){console.error("刪除機關錯誤:",D),D.response&&D.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除機關時發生錯誤，請稍後再試")}finally{g.value=!1,showDeleteConfirm.value=!1,T.value=null,z.value=""}},W=async()=>{if(!U.value.code||!U.value.name){v.showError("儲存失敗","請填寫所有必填欄位");return}try{E.value=!0;let k;K.value?k=await nt.updateAgency({id:U.value.id,code:U.value.code,name:U.value.name,parentAgencyId:U.value.parentAgencyId||null}):k=await nt.createAgency({code:U.value.code,name:U.value.name,parentAgencyId:U.value.parentAgencyId||null}),k.data.code===0?(v.showSuccess("儲存成功",`機關已成功${K.value?"更新":"新增"}`),N.value=!1,c()):v.showError("儲存失敗",k.data.message||`${K.value?"更新":"新增"}機關失敗，請稍後再試`)}catch(k){console.error(`${K.value?"更新":"新增"}機關錯誤:`,k),v.showError("儲存失敗","連接伺服器時發生錯誤，請稍後再試")}finally{E.value=!1}},H=async()=>{try{const k=await ot.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?(a.value=k.data.data,console.log("機關管理頁面權限:",a.value)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}};return je(()=>{H(),c()}),(k,D)=>(t(),s("div",AV,[e("div",IV,[Ge(ft,{breadcrumbs:[{name:"學員管理",path:"student/information"},{name:"機關管理",path:"/agency"}]})]),e("div",RV,[e("div",PV,[D[7]||(D[7]=e("span",null,"關鍵字搜尋:",-1)),e("div",UV,[P(e("input",{type:"text","onUpdate:modelValue":D[0]||(D[0]=j=>h.value=j),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"機關名稱/編號",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ue($,["enter"])},null,544),[[te,h.value]]),h.value?(t(),s("button",{key:0,onClick:Z,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},D[6]||(D[6]=[e("span",{class:"text-lg"},"×",-1)]))):G("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:$}," 查詢 "),D[8]||(D[8]=e("div",{class:"flex-1"},null,-1)),a.value.agencyCreate?(t(),s("button",{key:0,class:"ml-auto px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:p}," 新增機關 ")):G("",!0)])]),D[15]||(D[15]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",NV,[e("div",TV,[e("table",VV,[D[10]||(D[10]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2 w-[80px]"},"序"),e("th",{class:"border p-2 w-[150px]"},"機關編號"),e("th",{class:"border p-2"},"機關名稱"),e("th",{class:"border p-2 w-[150px]"},"操作")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(d.value,(j,S)=>(t(),s("tr",{key:j.id},[e("td",jV,l((u.value-1)*Js+S+1),1),e("td",LV,l(j.code),1),e("td",FV,l(j.name),1),e("td",OV,[e("div",qV,[a.value.agencyUpdate?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:x=>_(j)}," 編輯 ",8,BV)):G("",!0),a.value.agencyDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:x=>f(j)}," 刪除 ",8,HV)):G("",!0)])])]))),128)),d.value.length===0?(t(),s("tr",WV,D[9]||(D[9]=[e("td",{colspan:"4",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])])]),C.value>0?(t(),s("div",zV,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===1,onClick:r}," 上一頁 ",8,KV),(t(!0),s(X,null,le(C.value,j=>(t(),s(X,{key:j},[j===1||j===C.value||j>=u.value-2&&j<=u.value+2?(t(),s("button",{key:0,class:ee(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":j===u.value}]),onClick:S=>y(j)},l(j),11,JV)):j===u.value-3||j===u.value+3?(t(),s("span",YV," ... ")):G("",!0)],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===C.value,onClick:b}," 下一頁 ",8,GV)])):G("",!0)]),N.value?(t(),s("div",ZV,[e("div",QV,[e("div",XV,[e("h3",ej,l(K.value?"編輯機關":"新增機關"),1),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:D[1]||(D[1]=j=>N.value=!1)}," ✕ ")]),e("div",tj,[e("div",sj,[D[12]||(D[12]=e("span",{class:"w-24"},"上級機關:",-1)),e("div",aj,[P(e("select",{class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":D[2]||(D[2]=j=>U.value.parentAgencyId=j)},[D[11]||(D[11]=e("option",{value:""},"無上級機關",-1)),(t(!0),s(X,null,le(R.value,j=>(t(),s("option",{key:j.id,value:j.id},l(j.name),9,oj))),128))],512),[[Pe,U.value.parentAgencyId]])])]),e("div",lj,[D[13]||(D[13]=e("span",{class:"w-24"},[me("機關編號:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",nj,[P(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":D[3]||(D[3]=j=>U.value.code=j),required:"",placeholder:"請輸入機關編號"},null,512),[[te,U.value.code]])])]),e("div",rj,[D[14]||(D[14]=e("span",{class:"w-24"},[me("機關名稱:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",ij,[P(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":D[4]||(D[4]=j=>U.value.name=j),required:"",placeholder:"請輸入機關名稱"},null,512),[[te,U.value.name]])])]),e("div",dj,[e("button",{class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:D[5]||(D[5]=j=>N.value=!1)}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:W,disabled:E.value},l(E.value?"儲存中...":"儲存"),9,uj)])])])])):G("",!0)]))}},pj=Fe(cj,[["__scopeId","data-v-b85370a7"]]),gt={getConsultCount:M=>be.get("/v1/reportCollection/other/consultCount",{params:M}),getGovDetail:M=>be.get("/v1/reportCollection/student/govDetail",{params:M}),exportGovDetail:M=>be.get("/v1/reportCollection/course/student/govDetail/export",{params:M,responseType:"blob"}),getVocationalCourseParticipants:M=>be.get("/v1/reportCollection/course/studentTotal/career",{params:M}),exportVocationalCourseParticipants:M=>be.get("/v1/reportCollection/course/studentTotal/career/export",{params:M,responseType:"blob"}),getCreditCourseParticipants:M=>be.get("/v1/reportCollection/course/studentTotal/credit",{params:M}),exportCreditCourseParticipants:M=>be.get("/v1/reportCollection/course/studentTotal/credit/export",{params:M,responseType:"blob"}),getVocationalCourseCount:M=>be.get("/v1/reportCollection/course/courseTotal/career",{params:M}),exportVocationalCourseCount:M=>be.get("/v1/reportCollection/course/courseTotal/career/export",{params:M,responseType:"blob"}),getCreditCourseCount:M=>be.get("/v1/reportCollection/course/courseTotal/credit",{params:M}),getCreditWeekdayClassCount:M=>be.get("/v1/reportCollection/course/workdayTypeCount",{params:M}),exportCreditWeekdayClassCount:M=>be.get("/v1/reportCollection/course/workdayTypeCount/export",{params:M,responseType:"blob"}),getCreditWeekendClassCount:M=>be.get("/v1/reportCollection/course/holidayTypeCount",{params:M}),exportCreditWeekendClassCount:M=>be.get("/v1/reportCollection/course/holidayTypeCount/export",{params:M,responseType:"blob"}),getVocationalClassCount:M=>be.get("/v1/reportCollection/course/careerTypeCount",{params:M}),exportVocationalClassCount:M=>be.get("/v1/reportCollection/course/careerTypeCount/export",{params:M,responseType:"blob"}),getStudentCertificateCount:M=>be.get("/v1/reportCollection/student/certificateCount",{params:M}),exportStudentCertificateCount:M=>be.get("/v1/reportCollection/student/certificateCount/export",{params:M,responseType:"blob"}),getStudentProgressTracking:M=>be.get("/v1/reportCollection/student/progressTracking",{params:M}),exportStudentProgressTracking:M=>be.get("/v1/reportCollection/student/progressTracking/export",{params:M,responseType:"blob"}),getConsultType:M=>be.get("/v1/reportCollection/other/consultType",{params:M}),exportConsultCount:()=>be.get("/v1/reportCollection/other/consultCount/export",{responseType:"blob"}),exportMonthlyConsultationMethodStats:M=>be.get("/v1/reportCollection/other/consultType/export",{params:M,responseType:"blob"}),getStudentCourseCompletedStatus:M=>be.get("/v1/reportCollection/student/courseCompletdStatus",{params:M}),exportStudentCourseCompletedStatus:M=>be.get("/v1/reportCollection/student/courseCompletedStatus/export",{params:M,responseType:"blob"}),exportCreditCourseCount:M=>be.get("/v1/reportCollection/course/courseTotal/credit/export",{params:M,responseType:"blob"}),getFinanceAppropriationDetail:M=>be.get("/v1/reportCollection/finance/appropriationDetail",{params:M}),exportFinanceAppropriationDetail:M=>be.get("/v1/reportCollection/finance/appropriationDetail/export",{params:M,responseType:"blob"})},vj={class:"w-full max-w-[1500px] mb-6"},mj={class:"flex items-center space-x-4"},bj=["value"],fj=["value"],yj=["disabled"],gj={class:"w-full max-w-[1500px] mt-6"},xj={key:0,class:"flex justify-center items-center py-10"},hj={key:1,class:"w-full border-collapse table-fixed"},wj={class:"bg-[#EEEFE7]"},_j=["colspan","rowspan"],kj={key:0,class:"bg-[#EEEFE7]"},$j=["rowspan"],Cj={key:0},Ej=["colspan"],Sj={__name:"CreditCourseCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]),N=We(),K=Se(()=>u.value||d.value!==""&&h.value===""),E=Se(()=>{const _=[];for(let f=1;f<=12;f++)_.push(f);return _}),U=Se(()=>{const _=[];for(let f=1;f<=31;f++)_.push(f);return _}),T=Se(()=>{const _=[];return C.value.forEach(f=>{f.children?_.push(...f.children):["area","schoolName"].includes(f.key)||_.push(f)}),_}),z=Se(()=>C.value.some(_=>_.children&&_.children.length>0)),g=m({reportAllExport:!1}),a=async()=>{try{const _=await ot.getSidebarPermissions();_.data.code===0&&_.data.message==="success"?(g.value=_.data.data,console.log("學分班開課數量統計頁面權限:",g.value)):console.error("獲取權限失敗:",_.data.message)}catch(_){console.error("獲取權限錯誤:",_)}},R=Se(()=>{const _=[];let f=null,V=0,W=-1;return!Array.isArray(o.value)||o.value.length===0?[]:(o.value.forEach((H,k)=>{const D={...H};D.type==="total"||D.type==="subtotal"?(D._display_area=!0,D._area_rowspan=1,f!==null&&W!==-1&&(_[W]._area_rowspan=V),f=null,V=0,W=-1):D.area&&D.area!==f?(f!==null&&W!==-1&&(_[W]._area_rowspan=V),f=D.area,V=1,W=_.length,D._display_area=!0):(V++,D._display_area=!1),_.push(D),k===o.value.length-1&&f!==null&&W!==-1&&(_[W]._area_rowspan=V)}),_)}),Z=(_,f)=>{const V={border:!0,"p-2":!0,"text-center":!0};return _.type==="subtotal"?(V["bg-gray-200"]=!0,V["font-bold"]=!0):_.type==="total"&&(V["bg-orange-100"]=!0,V["font-bold"]=!0),V},$=(_,f,V)=>{let W=0;V.forEach(H=>{(H.xAxis||[]).forEach(k=>{const D=`${H.name}_${k}`;_[D]=f[W]??0,W++})}),_.total_courses=f[f.length-1]??0};Ee([h,d],()=>{r()});const c=()=>{if(K.value){d.value!==""&&h.value===""&&v.showError("錯誤","不能單獨搜尋日期，請選擇月份。");return}y()},y=async()=>{var _;u.value=!0;try{const f={};h.value!==""&&(f.month=parseInt(h.value)),d.value!==""&&(f.day=parseInt(d.value));const V=await gt.getCreditCourseCount(f);if(V.data.code===0&&V.data.data){const W=V.data.data,H=[],k=[];if(Array.isArray(W.xList)&&W.xList.forEach(j=>{if(Array.isArray(j.xAxis)){const S=[];let x=0;j.xAxis.forEach(L=>{S.push({label:L,key:`${j.name}_${L}`})}),x=S.length,H.push({label:j.name,key:`${j.name}_group`,colspan:x,children:S})}}),C.value=[{label:"區域",key:"area",rowspan:2},{label:"學校名稱",key:"schoolName",rowspan:2},...H,{label:"合計開課數量",key:"total_courses",rowspan:2,type:"total"}],Array.isArray(W.yList)&&Array.isArray(W.xData)){let j=0;W.yList.forEach((S,x)=>{if(S.name.includes("小計")){const L={area:S.name,schoolName:"",type:"subtotal",total_courses:0};Array.isArray(W.xData[j])&&$(L,W.xData[j],W.xList),k.push(L),j++}else Array.isArray(S.yAxis)&&S.yAxis.forEach((L,de)=>{const xe={area:de===0?S.name:"",schoolName:L,type:"data",total_courses:0};Array.isArray(W.xData[j])&&$(xe,W.xData[j],W.xList),k.push(xe),j++})})}const D={area:"總計",schoolName:"",type:"total",total_courses:Array.isArray(W.xAxisSums)?W.xAxisSums[W.xAxisSums.length-1]??0:0};Array.isArray(W.xAxisSums)&&$(D,W.xAxisSums,W.xList),k.push(D),o.value=k}else C.value=[],o.value=[],v.showError("查詢失敗",((_=V.data)==null?void 0:_.message)||"API 回傳異常")}catch(f){console.error("獲取報表數據錯誤:",f),C.value=[],o.value=[],v.showError("查詢失敗",(f==null?void 0:f.message)||"API 請求失敗")}finally{u.value=!1}},r=()=>{const _={month:h.value!==""?h.value:void 0,day:d.value!==""?d.value:void 0};Object.keys(_).forEach(f=>{_[f]===void 0&&delete _[f]}),N.replace({query:_})};je(()=>{const _=new URLSearchParams(window.location.search),f=_.get("month"),V=_.get("day");h.value=f?parseInt(f):"",d.value=V?parseInt(V):"",y(),Ee(()=>window.location.search,()=>{const W=new URLSearchParams(window.location.search),H=W.get("month"),k=W.get("day"),D=H?parseInt(H):"",j=k?parseInt(k):"";D!==h.value&&(h.value=D),j!==d.value&&(d.value=j)}),a()});const b=()=>{p()},p=async()=>{try{const _={month:h.value!==""?parseInt(h.value):void 0,day:d.value!==""?parseInt(d.value):void 0},f=await gt.exportCreditCourseCount(_),V=f.headers["content-type"];if(!V||!V.includes("spreadsheetml.sheet"))try{const j=new Blob([f.data],{type:"application/json"}),S=await new Response(j).text(),x=JSON.parse(S);console.error("匯出學分班開課數量統計失敗：伺服器返回錯誤：",x),v.showError("匯出失敗",x.message||"匯出過程中發生錯誤，請稍後再試");return}catch(j){console.error("匯出學分班開課數量統計失敗：無法解析回應內容",j),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const W=new Blob([f.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),H=window.URL.createObjectURL(W),k=document.createElement("a");k.href=H;const D=`學分班開課數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;k.setAttribute("download",D),document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(H),v.showSuccess("匯出成功","學分班開課數量統計已成功匯出為 Excel 檔案")}catch(_){if(console.error("匯出學分班開課數量統計失敗:",_),_.response&&_.response.data){const f=_.response.data;v.showError("匯出失敗",f.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(_,f)=>(t(),s("div",null,[f[7]||(f[7]=e("h3",{class:"text-xl font-bold mb-4"},"開課數量統計表(學分班)",-1)),e("div",vj,[e("div",mj,[f[4]||(f[4]=e("span",null,"查詢日期:",-1)),P(e("select",{id:"searchMonth","onUpdate:modelValue":f[0]||(f[0]=V=>h.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(c,["enter"])},[f[2]||(f[2]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(X,null,le(E.value,V=>(t(),s("option",{key:V,value:V},l(V)+"月 ",9,bj))),128))],544),[[Pe,h.value]]),P(e("select",{id:"searchDay","onUpdate:modelValue":f[1]||(f[1]=V=>d.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(c,["enter"])},[f[3]||(f[3]=e("option",{value:""},"請選擇日",-1)),(t(!0),s(X,null,le(U.value,V=>(t(),s("option",{key:V,value:V},l(V)+"日 ",9,fj))),128))],544),[[Pe,d.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:c,disabled:K.value,"aria-label":"查詢開課數量"}," 搜尋 ",8,yj),f[5]||(f[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:b}," 匯出 Excel ")):G("",!0)])]),e("div",gj,[u.value?(t(),s("div",xj,f[6]||(f[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",hj,[e("thead",null,[e("tr",wj,[(t(!0),s(X,null,le(C.value,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":V.type==="subtotal"||V.type==="total"}])},l(V.label),11,_j))),128))]),z.value?(t(),s("tr",kj,[(t(!0),s(X,null,le(C.value,V=>(t(),s(X,{key:V.key},[V.children?(t(!0),s(X,{key:0},le(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(R.value,(V,W)=>(t(),s("tr",{key:W,class:ee(Z(V))},[V._display_area?(t(),s("td",{key:0,rowspan:V._area_rowspan,class:ee(Z(V))},l(V.area),11,$j)):G("",!0),e("td",{class:ee(Z(V))},l(V.schoolName),3),(t(!0),s(X,null,le(T.value,H=>(t(),s("td",{key:H.key,class:ee(Z(V))},l(V[H.key]),3))),128))],2))),128)),o.value.length===0?(t(),s("tr",Cj,[e("td",{colspan:T.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,Ej)])):G("",!0)])]))])]))}},Dj=Fe(Sj,[["__scopeId","data-v-488e6fca"]]),Mj={class:"w-full max-w-[1500px] mb-6"},Aj={class:"flex items-center space-x-4"},Ij=["value"],Rj=["value"],Pj=["disabled"],Uj={class:"w-full max-w-[1500px] mt-6"},Nj={key:0,class:"flex justify-center items-center py-10"},Tj={key:1,class:"w-full border-collapse table-fixed"},Vj={class:"bg-[#EEEFE7]"},jj=["colspan","rowspan"],Lj={key:0,class:"bg-[#EEEFE7]"},Fj=["rowspan"],Oj={key:0},qj=["colspan"],Bj={__name:"VocationalCourseCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]),N=We(),K=Se(()=>u.value||d.value!==""&&h.value===""),E=Se(()=>{const _=[];for(let f=1;f<=12;f++)_.push(f);return _}),U=Se(()=>{const _=[];if(h.value!==""){const f=new Date().getFullYear()-1911,V=h.value,W=new Date(f,V,0).getDate();for(let H=1;H<=W;H++)_.push(H)}else for(let f=1;f<=31;f++)_.push(f);return _}),T=Se(()=>{const _=[];return C.value.forEach(f=>{f.children?_.push(...f.children):["area","schoolName"].includes(f.key)||_.push(f)}),_}),z=Se(()=>C.value.some(_=>_.children&&_.children.length>0)),g=m({reportAllExport:!1}),a=async()=>{try{const _=await ot.getSidebarPermissions();_.data.code===0&&_.data.message==="success"?(g.value=_.data.data,console.log("職能班開課數量統計頁面權限:",g.value.reportAllExport)):console.error("獲取權限失敗:",_.data.message)}catch(_){console.error("獲取權限錯誤:",_)}},R=Se(()=>{const _=[];let f=null,V=0,W=-1;return!Array.isArray(o.value)||o.value.length===0?[]:(o.value.forEach((H,k)=>{const D={...H};D.type==="total"||D.type==="subtotal"?(D._display_area=!0,D._area_rowspan=1,f!==null&&W!==-1&&(_[W]._area_rowspan=V),f=null,V=0,W=-1):D.area&&D.area!==f?(f!==null&&W!==-1&&(_[W]._area_rowspan=V),f=D.area,V=1,W=_.length,D._display_area=!0):(V++,D._display_area=!1),_.push(D),k===o.value.length-1&&f!==null&&W!==-1&&(_[W]._area_rowspan=V)}),_)}),Z=(_,f)=>{const V={border:!0,"p-2":!0,"text-center":!0};return _.type==="subtotal"?(V["bg-gray-200"]=!0,V["font-bold"]=!0):_.type==="total"&&(V["bg-orange-100"]=!0,V["font-bold"]=!0),V};Ee([h,d],()=>{y()});const $=(_,f,V)=>{let W=0;V.forEach(H=>{(H.xAxis||[]).forEach(k=>{const D=`${H.name}_${k}`;_[D]=f[W]??0,W++})}),_.total_courses=f[f.length-1]??0},c=async()=>{var _;u.value=!0;try{const f={};h.value!==""&&(f.month=parseInt(h.value)),d.value!==""&&(f.day=parseInt(d.value));const V=await gt.getVocationalCourseCount(f);if(V.data.code===0&&V.data.data){const W=V.data.data,H=[],k=[];if(Array.isArray(W.xList)&&W.xList.forEach(j=>{if(Array.isArray(j.xAxis)){const S=j.xAxis.map(x=>({label:x,key:`${j.name}_${x}`}));H.push({label:j.name,key:`${j.name}_group`,colspan:S.length,children:S})}}),C.value=[{label:"區域",key:"area",rowspan:2},{label:"學校名稱",key:"schoolName",rowspan:2},...H,{label:"合計開課數量",key:"total_courses",rowspan:2,type:"total"}],Array.isArray(W.yList)&&Array.isArray(W.xData)){let j=0;W.yList.forEach((S,x)=>{if(S.name.includes("小計")){const L={area:S.name,schoolName:"",type:"subtotal",total_courses:0};Array.isArray(W.xData[j])&&$(L,W.xData[j],W.xList),k.push(L),j++}else Array.isArray(S.yAxis)&&S.yAxis.forEach((L,de)=>{const xe={area:de===0?S.name:"",schoolName:L,type:"data",total_courses:0};Array.isArray(W.xData[j])&&$(xe,W.xData[j],W.xList),k.push(xe),j++})})}const D={area:"總計",schoolName:"",type:"total",total_courses:Array.isArray(W.xAxisSums)?W.xAxisSums[W.xAxisSums.length-1]??0:0};Array.isArray(W.xAxisSums)&&$(D,W.xAxisSums,W.xList),k.push(D),o.value=k}else C.value=[],o.value=[],v.showError("查詢失敗",((_=V.data)==null?void 0:_.message)||"API 回傳異常")}catch(f){console.error("獲取報表數據錯誤:",f),C.value=[],o.value=[],v.showError("查詢失敗",(f==null?void 0:f.message)||"API 請求失敗")}finally{u.value=!1}},y=()=>{const _={month:h.value!==""?h.value:void 0,day:d.value!==""?d.value:void 0};Object.keys(_).forEach(f=>{_[f]===void 0&&delete _[f]}),N.replace({query:_})},r=()=>{if(K.value){v.showError("請選擇月份和日期");return}y(),c()};je(()=>{const _=new URLSearchParams(window.location.search),f=_.get("month"),V=_.get("day");h.value=f?parseInt(f):"",d.value=V?parseInt(V):"",c(),Ee(()=>window.location.search,()=>{const W=new URLSearchParams(window.location.search),H=W.get("month"),k=W.get("day"),D=H?parseInt(H):"",j=k?parseInt(k):"";D!==h.value&&(h.value=D),j!==d.value&&(d.value=j)}),a()});const b=()=>{p()},p=async()=>{try{const _={month:h.value!==""?parseInt(h.value):void 0,day:d.value!==""?parseInt(d.value):void 0},f=await gt.exportVocationalCourseCount(_),V=f.headers["content-type"];if(!V||!V.includes("spreadsheetml.sheet"))try{const j=new Blob([f.data],{type:"application/json"}),S=await new Response(j).text(),x=JSON.parse(S);console.error("匯出職能班開課數量統計失敗：伺服器返回錯誤：",x),v.showError("匯出失敗",x.message||"匯出過程中發生錯誤，請稍後再試");return}catch(j){console.error("匯出職能班開課數量統計失敗：無法解析回應內容",j),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const W=new Blob([f.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),H=window.URL.createObjectURL(W),k=document.createElement("a");k.href=H;const D=`職能班開課數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;k.setAttribute("download",D),document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(H),v.showSuccess("匯出成功","職能班開課數量統計已成功匯出為 Excel 檔案")}catch(_){if(console.error("匯出職能班開課數量統計失敗:",_),_.response&&_.response.data){const f=_.response.data;v.showError("匯出失敗",f.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(_,f)=>(t(),s("div",null,[f[7]||(f[7]=e("h3",{class:"text-xl font-bold mb-4"},"開課數量統計表(職能班)",-1)),e("div",Mj,[e("div",Aj,[f[4]||(f[4]=e("span",null,"查詢日期:",-1)),P(e("select",{"onUpdate:modelValue":f[0]||(f[0]=V=>h.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(r,["enter"])},[f[2]||(f[2]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(X,null,le(E.value,V=>(t(),s("option",{key:V,value:V},l(V)+"月 ",9,Ij))),128))],544),[[Pe,h.value]]),P(e("select",{"onUpdate:modelValue":f[1]||(f[1]=V=>d.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(r,["enter"])},[f[3]||(f[3]=e("option",{value:""},"請選擇日",-1)),(t(!0),s(X,null,le(U.value,V=>(t(),s("option",{key:V,value:V},l(V)+"日 ",9,Rj))),128))],544),[[Pe,d.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:r,disabled:K.value,"aria-label":"查詢開課數量"}," 搜尋 ",8,Pj),f[5]||(f[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:b}," 匯出 Excel ")):G("",!0)])]),e("div",Uj,[u.value?(t(),s("div",Nj,f[6]||(f[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Tj,[e("thead",null,[e("tr",Vj,[(t(!0),s(X,null,le(C.value,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":V.type==="subtotal"||V.type==="total"}])},l(V.label),11,jj))),128))]),z.value?(t(),s("tr",Lj,[(t(!0),s(X,null,le(C.value,V=>(t(),s(X,{key:V.key},[V.children?(t(!0),s(X,{key:0},le(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(R.value,(V,W)=>(t(),s("tr",{key:W,class:ee(Z(V))},[V._display_area?(t(),s("td",{key:0,rowspan:V._area_rowspan,class:ee(Z(V))},l(V.area),11,Fj)):G("",!0),e("td",{class:ee(Z(V))},l(V.schoolName),3),(t(!0),s(X,null,le(T.value,H=>(t(),s("td",{key:H.key,class:ee(Z(V))},l(V[H.key]),3))),128))],2))),128)),o.value.length===0?(t(),s("tr",Oj,[e("td",{colspan:T.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,qj)])):G("",!0)])]))])]))}},Hj=Fe(Bj,[["__scopeId","data-v-957d8093"]]),Wj={class:"w-full max-w-[1500px] mt-4"},zj={class:"flex items-center space-x-4"},Kj={class:"flex items-center space-x-2"},Jj={class:"flex items-center space-x-2"},Yj=["disabled"],Gj={class:"w-full max-w-[1500px] mt-6"},Zj={key:0,class:"flex justify-center items-center py-10"},Qj={key:1,class:"w-full border-collapse table-fixed"},Xj={class:"bg-[#EEEFE7]"},eL=["colspan","rowspan"],tL={key:0,class:"bg-[#EEEFE7]"},sL=["colspan","rowspan"],aL={key:1,class:"bg-[#EEEFE7]"},oL=["rowspan"],lL=["rowspan"],nL={key:0},rL=["colspan"],iL={__name:"CreditCourseParticipants",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const b=[];return C.value.forEach(p=>{p.children?p.children.forEach(_=>{_.children?b.push(..._.children):b.push(_)}):["item_no","region_type","university_name","total","region_total_col"].includes(p.key)||b.push(p)}),b}),E=Se(()=>C.value.some(b=>b.children&&b.children.length>0)),U=Se(()=>C.value.some(b=>b.children&&b.children.some(p=>p.children&&p.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const b=await ot.getSidebarPermissions();b.data.code===0&&b.data.message==="success"?(T.value=b.data.data,console.log("學分班課程參訓人數統計頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",b.data.message)}catch(b){console.error("獲取權限錯誤:",b)}},g=Se(()=>{const b=[];let p=null,_=0,f=-1;return o.value.forEach((V,W)=>{const H={...V};H.type==="total"?(H._display_region=!1,H._display_item_no=!1,H._region_rowspan=1,p!==null&&f!==-1&&(b[f]._region_rowspan=_),p=null,_=0,f=-1):H.region_type!==""&&H.region_type!==p?(p!==null&&f!==-1&&(b[f]._region_rowspan=_),p=H.region_type,_=1,f=b.length,H._display_region=!0,H._display_item_no=!0):(_++,H._display_region=!1,H._display_item_no=!0),b.push(H),W===o.value.length-1&&p!==null&&f!==-1&&(b[f]._region_rowspan=_)}),b}),a=(b,p)=>{const _={border:!0,"p-2":!0,"text-center":!0};return b.type==="total"&&(_["bg-orange-100"]=!0,_["font-bold"]=!0),_},R=()=>{h.value="",d.value="",c(),$()},Z=()=>{$()},$=async()=>{var b;u.value=!0;try{const p={};h.value&&d.value&&(p.dateRange=[h.value,d.value]);const _=await gt.getCreditCourseParticipants(p);if(_.data.code===0&&_.data.data){const f=_.data.data,V=Array.isArray(f.xAxis)?f.xAxis.map((S,x)=>({label:S,key:`course_${x+1}`})):[],W=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/參訓人數",key:"course_participants_main",colspan:V.length,children:V},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=W;const H=[];let k=1,D=0;Array.isArray(f.yList)&&Array.isArray(f.xData)&&f.yList.forEach((S,x)=>{Array.isArray(S.yAxis)&&S.yAxis.forEach((L,de)=>{const xe={item_no:k++,region_type:de===0?S.name:"",university_name:L},fe=Array.isArray(f.xData[D])?f.xData[D]:[];(f.xAxis||[]).forEach((De,we)=>{xe[`course_${we+1}`]=fe[we]??0}),xe.total=Array.isArray(f.yAxisSums)?f.yAxisSums[D]??0:0;let ke="";de===0&&(ke=Array.isArray(f.groupByTotal)?f.groupByTotal[x]??0:0),xe.region_total_col=ke,H.push(xe),D++})});const j={type:"total"};j.item_no="",j.region_type="",j.university_name="",(f.xAxis||[]).forEach((S,x)=>{j[`course_${x+1}`]=Array.isArray(f.xAxisSums)?f.xAxisSums[x]??0:0}),j.total=f.total??0,j.region_total_col="",H.push(j),o.value=H}else C.value=[],o.value=[],v.showError("查詢失敗",((b=_.data)==null?void 0:b.message)||"API 回傳異常")}catch(p){C.value=[],o.value=[],v.showError("查詢失敗",(p==null?void 0:p.message)||"API 請求失敗")}finally{u.value=!1}},c=()=>{const b={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(b).forEach(p=>{b[p]===void 0&&delete b[p]}),N.replace({query:b})};je(()=>{const b=new URLSearchParams(window.location.search),p=b.get("startDate"),_=b.get("endDate");p&&(h.value=p),_&&(d.value=_),$(),Ee(()=>window.location.search,()=>{const f=new URLSearchParams(window.location.search),V=f.get("startDate"),W=f.get("endDate");V!==h.value&&(h.value=V||""),W!==d.value&&(d.value=W||""),$()}),z()});const y=()=>{r()},r=async()=>{try{const b={dateRange:h.value&&d.value?[h.value,d.value]:void 0},p=await gt.exportCreditCourseParticipants(b),_=p.headers["content-type"];if(!_||!_.includes("spreadsheetml.sheet"))try{const k=new Blob([p.data],{type:"application/json"}),D=await new Response(k).text(),j=JSON.parse(D);console.error("匯出學分班課程參訓人數統計失敗：伺服器返回錯誤：",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤，請稍後再試");return}catch(k){console.error("匯出學分班課程參訓人數統計失敗：無法解析回應內容",k),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const f=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL(f),W=document.createElement("a");W.href=V;const H=`學分班課程參訓人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;W.setAttribute("download",H),document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(V),v.showSuccess("匯出成功","學分班課程參訓人數統計已成功匯出為 Excel 檔案")}catch(b){if(console.error("匯出學分班課程參訓人數統計失敗:",b),b.response&&b.response.data){const p=b.response.data;v.showError("匯出失敗",p.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(b,p)=>(t(),s("div",null,[p[7]||(p[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程參訓人數統計表",-1)),e("div",Wj,[e("div",zj,[p[4]||(p[4]=e("span",null,"查詢日期:",-1)),e("div",Kj,[p[2]||(p[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":p[0]||(p[0]=_=>h.value=_),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(Z,["enter"])},null,34),[[te,h.value]])]),e("div",Jj,[p[3]||(p[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":p[1]||(p[1]=_=>d.value=_),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(Z,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:R,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:Z,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,Yj),p[5]||(p[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:y}," 匯出 Excel ")):G("",!0)])]),e("div",Gj,[u.value?(t(),s("div",Zj,p[6]||(p[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Qj,[e("thead",null,[e("tr",Xj,[(t(!0),s(X,null,le(C.value,_=>(t(),s("th",{key:_.key,colspan:_.colspan||1,rowspan:_.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":_.type==="subtotal"||_.type==="total"}])},l(_.label),11,eL))),128))]),E.value?(t(),s("tr",tL,[(t(!0),s(X,null,le(C.value,_=>(t(),s(X,{key:_.key},[_.children?(t(!0),s(X,{key:0},le(_.children,f=>(t(),s("th",{key:f.key,colspan:f.colspan||1,rowspan:f.rowspan||1,class:"border p-2 text-center"},l(f.label),9,sL))),128)):G("",!0)],64))),128))])):G("",!0),U.value?(t(),s("tr",aL,[(t(!0),s(X,null,le(C.value,_=>(t(),s(X,{key:_.key},[_.children?(t(!0),s(X,{key:0},le(_.children,f=>(t(),s(X,{key:f.key},[(t(!0),s(X,null,le(f.children,V=>(t(),s("th",{key:V.key,class:"border p-2 text-center"},l(V.label),1))),128))],64))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(g.value,(_,f)=>(t(),s(X,{key:f},[_.type==="total"?(t(),s("tr",{key:0,class:ee(a(_))},[e("td",{colspan:"3",class:ee(a(_))},"總計",2),(t(!0),s(X,null,le(K.value,V=>(t(),s("td",{key:V.key,class:ee(a(_))},l(_[V.key]),3))),128)),e("td",{class:ee(a(_))},l(_.total),3),e("td",{class:ee(a(_))},l(_.region_total_col),3)],2)):(t(),s("tr",{key:1,class:ee(a(_))},[_._display_item_no?(t(),s("td",{key:0,class:ee(a(_))},l(_.item_no),3)):G("",!0),_._display_region?(t(),s("td",{key:1,rowspan:_._region_rowspan,class:ee(a(_))},l(_.region_type),11,oL)):G("",!0),e("td",{class:ee(a(_))},l(_.university_name),3),(t(!0),s(X,null,le(K.value,V=>(t(),s(X,{key:V.key},[V.key.startsWith("course_")?(t(),s("td",{key:0,class:ee(a(_))},l(_[V.key]),3)):G("",!0)],64))),128)),e("td",{class:ee(a(_))},l(_.total),3),_._display_region?(t(),s("td",{key:2,rowspan:_._region_rowspan,class:ee(a(_))},l(_.region_total_col),11,lL)):G("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",nL,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,rL)])):G("",!0)])]))])]))}},dL=Fe(iL,[["__scopeId","data-v-e9149593"]]),uL={class:"w-full max-w-[1500px] mt-4"},cL={class:"flex items-center space-x-4"},pL={class:"flex items-center space-x-2"},vL={class:"flex items-center space-x-2"},mL=["disabled"],bL={class:"w-full max-w-[1500px] mt-6"},fL={key:0,class:"flex justify-center items-center py-10"},yL={key:1,class:"w-full border-collapse table-fixed"},gL={class:"bg-[#EEEFE7]"},xL=["colspan","rowspan"],hL={key:0,class:"bg-[#EEEFE7]"},wL=["colspan","rowspan"],_L={key:1,class:"bg-[#EEEFE7]"},kL=["rowspan"],$L=["rowspan"],CL={key:0},EL=["colspan"],SL={__name:"VocationalCourseParticipants",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const b=[];return C.value.forEach(p=>{p.children?p.children.forEach(_=>{_.children?b.push(..._.children):b.push(_)}):["item_no","region_type","university_name","total","region_total_col"].includes(p.key)||b.push(p)}),b}),E=Se(()=>C.value.some(b=>b.children&&b.children.length>0)),U=Se(()=>C.value.some(b=>b.children&&b.children.some(p=>p.children&&p.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const b=await ot.getSidebarPermissions();b.data.code===0&&b.data.message==="success"?(T.value=b.data.data,console.log("職能班課程參訓人數統計頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",b.data.message)}catch(b){console.error("獲取權限錯誤:",b)}},g=Se(()=>{const b=[];let p=null,_=0,f=-1;return o.value.forEach((V,W)=>{const H={...V};H.type==="total"?(H._display_region=!1,H._display_item_no=!1,H._region_rowspan=1,p!==null&&f!==-1&&(b[f]._region_rowspan=_),p=null,_=0,f=-1):H.region_type!==""&&H.region_type!==p?(p!==null&&f!==-1&&(b[f]._region_rowspan=_),p=H.region_type,_=1,f=b.length,H._display_region=!0,H._display_item_no=!0):(_++,H._display_region=!1,H._display_item_no=!0),b.push(H),W===o.value.length-1&&p!==null&&f!==-1&&(b[f]._region_rowspan=_)}),b}),a=(b,p)=>{const _={border:!0,"p-2":!0,"text-center":!0};return b.type==="total"&&(_["bg-orange-100"]=!0,_["font-bold"]=!0),_},R=()=>{h.value="",d.value="",c(),$()},Z=()=>{$()},$=async()=>{var b;u.value=!0;try{const p={};h.value&&d.value&&(p.dateRange=[h.value,d.value]);const _=await gt.getVocationalCourseParticipants(p);if(_.data.code===0&&_.data.data){const f=_.data.data,V=Array.isArray(f.xAxis)?f.xAxis.map((S,x)=>({label:S,key:`course_${x+1}`})):[],W=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/參訓人數",key:"course_participants_main",colspan:V.length,children:V},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=W;const H=[];let k=1,D=0;Array.isArray(f.yList)&&Array.isArray(f.xData)&&f.yList.forEach((S,x)=>{Array.isArray(S.yAxis)&&S.yAxis.forEach((L,de)=>{const xe={item_no:k++,region_type:de===0?S.name:"",university_name:L},fe=Array.isArray(f.xData[D])?f.xData[D]:[];(f.xAxis||[]).forEach((De,we)=>{xe[`course_${we+1}`]=fe[we]??0}),xe.total=Array.isArray(f.yAxisSums)?f.yAxisSums[D]??0:0;let ke="";de===0&&(ke=Array.isArray(f.groupByTotal)?f.groupByTotal[x]??0:0),xe.region_total_col=ke,H.push(xe),D++})});const j={type:"total"};j.item_no="",j.region_type="",j.university_name="",(f.xAxis||[]).forEach((S,x)=>{j[`course_${x+1}`]=Array.isArray(f.xAxisSums)?f.xAxisSums[x]??0:0}),j.total=f.total??0,j.region_total_col="",H.push(j),o.value=H}else C.value=[],o.value=[],v.showError("查詢失敗",((b=_.data)==null?void 0:b.message)||"API 回傳異常")}catch(p){C.value=[],o.value=[],v.showError("查詢失敗",(p==null?void 0:p.message)||"API 請求失敗")}finally{u.value=!1}},c=()=>{const b={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(b).forEach(p=>{b[p]===void 0&&delete b[p]}),N.replace({query:b})};je(()=>{const b=new URLSearchParams(window.location.search),p=b.get("startDate"),_=b.get("endDate");p&&(h.value=p),_&&(d.value=_),$(),Ee(()=>window.location.search,()=>{const f=new URLSearchParams(window.location.search),V=f.get("startDate"),W=f.get("endDate");V!==h.value&&(h.value=V||""),W!==d.value&&(d.value=W||""),$()}),z()});const y=()=>{r()},r=async()=>{try{const b={dateRange:h.value&&d.value?[h.value,d.value]:void 0},p=await gt.exportVocationalCourseParticipants(b),_=p.headers["content-type"];if(!_||!_.includes("spreadsheetml.sheet"))try{const k=new Blob([p.data],{type:"application/json"}),D=await new Response(k).text(),j=JSON.parse(D);console.error("匯出職能班課程參訓人數統計失敗：伺服器返回錯誤：",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤，請稍後再試");return}catch(k){console.error("匯出職能班課程參訓人數統計失敗：無法解析回應內容",k),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const f=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL(f),W=document.createElement("a");W.href=V;const H=`職能班課程參訓人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;W.setAttribute("download",H),document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(V),v.showSuccess("匯出成功","職能班課程參訓人數統計已成功匯出為 Excel 檔案")}catch(b){if(console.error("匯出職能班課程參訓人數統計失敗:",b),b.response&&b.response.data){const p=b.response.data;v.showError("匯出失敗",p.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(b,p)=>(t(),s("div",null,[p[7]||(p[7]=e("h3",{class:"text-xl font-bold mb-4"},"職能班課程參訓人數統計表",-1)),e("div",uL,[e("div",cL,[p[4]||(p[4]=e("span",null,"查詢日期:",-1)),e("div",pL,[p[2]||(p[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":p[0]||(p[0]=_=>h.value=_),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(Z,["enter"])},null,34),[[te,h.value]])]),e("div",vL,[p[3]||(p[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":p[1]||(p[1]=_=>d.value=_),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(Z,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:R,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:Z,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,mL),p[5]||(p[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:y}," 匯出 Excel ")):G("",!0)])]),e("div",bL,[u.value?(t(),s("div",fL,p[6]||(p[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",yL,[e("thead",null,[e("tr",gL,[(t(!0),s(X,null,le(C.value,_=>(t(),s("th",{key:_.key,colspan:_.colspan||1,rowspan:_.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":_.type==="subtotal"||_.type==="total"}])},l(_.label),11,xL))),128))]),E.value?(t(),s("tr",hL,[(t(!0),s(X,null,le(C.value,_=>(t(),s(X,{key:_.key},[_.children?(t(!0),s(X,{key:0},le(_.children,f=>(t(),s("th",{key:f.key,colspan:f.colspan||1,rowspan:f.rowspan||1,class:"border p-2 text-center"},l(f.label),9,wL))),128)):G("",!0)],64))),128))])):G("",!0),U.value?(t(),s("tr",_L,[(t(!0),s(X,null,le(C.value,_=>(t(),s(X,{key:_.key},[_.children?(t(!0),s(X,{key:0},le(_.children,f=>(t(),s(X,{key:f.key},[(t(!0),s(X,null,le(f.children,V=>(t(),s("th",{key:V.key,class:"border p-2 text-center"},l(V.label),1))),128))],64))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(g.value,(_,f)=>(t(),s(X,{key:f},[_.type==="total"?(t(),s("tr",{key:0,class:ee(a(_))},[e("td",{colspan:"3",class:ee(a(_))},"總計",2),(t(!0),s(X,null,le(K.value,V=>(t(),s("td",{key:V.key,class:ee(a(_))},l(_[V.key]),3))),128)),e("td",{class:ee(a(_))},l(_.total),3),e("td",{class:ee(a(_))},l(_.region_total_col),3)],2)):(t(),s("tr",{key:1,class:ee(a(_))},[_._display_item_no?(t(),s("td",{key:0,class:ee(a(_))},l(_.item_no),3)):G("",!0),_._display_region?(t(),s("td",{key:1,rowspan:_._region_rowspan,class:ee(a(_))},l(_.region_type),11,kL)):G("",!0),e("td",{class:ee(a(_))},l(_.university_name),3),(t(!0),s(X,null,le(K.value,V=>(t(),s(X,{key:V.key},[V.key.startsWith("course_")?(t(),s("td",{key:0,class:ee(a(_))},l(_[V.key]),3)):G("",!0)],64))),128)),e("td",{class:ee(a(_))},l(_.total),3),_._display_region?(t(),s("td",{key:2,rowspan:_._region_rowspan,class:ee(a(_))},l(_.region_total_col),11,$L)):G("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",CL,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,EL)])):G("",!0)])]))])]))}},DL=Fe(SL,[["__scopeId","data-v-d7f373d0"]]),ML={class:"w-full max-w-[1500px] mt-4"},AL={class:"flex items-center space-x-4"},IL={class:"flex items-center space-x-2"},RL={class:"flex items-center space-x-2"},PL=["disabled"],UL={class:"w-full max-w-[1500px] mt-6"},NL={key:0,class:"flex justify-center items-center py-10"},TL={key:1,class:"w-full border-collapse table-fixed"},VL={class:"bg-[#EEEFE7]"},jL=["colspan","rowspan"],LL={class:"bg-[#EEEFE7]"},FL={class:"border p-2 text-center"},OL={class:"border p-2 text-center"},qL={class:"border p-2 text-center"},BL={class:"border p-2 text-center"},HL={class:"border p-2 text-center"},WL={class:"border p-2 text-center"},zL={class:"border p-2 text-center"},KL={class:"border p-2 text-center"},JL={key:0},YL=["colspan"],GL={__name:"AgencyParticipants",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const $=[];return C.value.forEach(c=>{c.children?$.push(...c.children):$.push(c)}),$}),E=m({reportAllExport:!1}),U=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?(E.value=$.data.data,console.log("機關參訓人數統計表頁面權限:",E.value.reportAllExport)):console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}},T=()=>{h.value="",d.value="",a(),g()},z=()=>{g()},g=async()=>{var $;u.value=!0;try{const c={};h.value&&d.value&&(c.dateRange=[h.value,d.value]);const y=await gt.getGovDetail(c);if(y.data.code===0&&y.data.data&&Array.isArray(y.data.data.list)){const r=[{label:"序號",key:"item_no",rowspan:2},{label:"機關名稱",key:"agency_name",rowspan:2},{label:"機關薦派",key:"recommended",colspan:2,children:[{label:"參訓人數",key:"recommended_participants"},{label:"取消人數",key:"recommended_cancelled"}]},{label:"自行報名",key:"self_report",colspan:2,children:[{label:"參訓人數",key:"self_report_participants"},{label:"取消人數",key:"self_report_cancelled"}]},{label:"合計",key:"total",colspan:2,children:[{label:"參訓人數",key:"total_participants"},{label:"取消人數",key:"total_cancelled"}]}];C.value=r,o.value=y.data.data.list.map((b,p,_)=>({item_no:p===_.length-1?"":p+1,agency_name:b.name,recommended_participants:b.assigned??0,recommended_cancelled:b.assignedCancelled??0,self_report_participants:b.self??0,self_report_cancelled:b.selfCancelled??0,total_participants:b.total??0,total_cancelled:b.totalCancelled??0}))}else C.value=[],o.value=[],v.showError("查詢失敗",(($=y.data)==null?void 0:$.message)||"API 回傳異常")}catch(c){C.value=[],o.value=[],v.showError("查詢失敗",(c==null?void 0:c.message)||"API 請求失敗")}finally{u.value=!1}},a=()=>{const $={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys($).forEach(c=>{$[c]===void 0&&delete $[c]}),N.replace({query:$})};je(()=>{const $=new URLSearchParams(window.location.search),c=$.get("startDate"),y=$.get("endDate");c&&(h.value=c),y&&(d.value=y),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),b=r.get("startDate"),p=r.get("endDate");b!==h.value&&(h.value=b||""),p!==d.value&&(d.value=p||""),g()}),U()});const R=()=>{Z()},Z=async()=>{try{const $={dateRange:h.value&&d.value?[h.value,d.value]:void 0},c=await gt.exportGovDetail($),y=c.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const f=new Blob([c.data],{type:"application/json"}),V=await new Response(f).text(),W=JSON.parse(V);console.error("匯出機關參訓人數統計表失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(f){console.error("匯出機關參訓人數統計表失敗：無法解析回應內容",f),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(r),p=document.createElement("a");p.href=b;const _=`機關參訓人數統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",_),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(b),v.showSuccess("匯出成功","機關參訓人數統計表已成功匯出為 Excel 檔案")}catch($){if(console.error("匯出機關參訓人數統計表失敗:",$),$.response&&$.response.data){const c=$.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return($,c)=>(t(),s("div",null,[c[7]||(c[7]=e("h3",{class:"text-xl font-bold mb-4"},"機關參訓人數統計表",-1)),e("div",ML,[e("div",AL,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",IL,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=y=>h.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(z,["enter"])},null,34),[[te,h.value]])]),e("div",RL,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=y=>d.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(z,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:T,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:z,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,PL),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),E.value&&E.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:R}," 匯出 Excel ")):G("",!0)])]),e("div",UL,[u.value?(t(),s("div",NL,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",TL,[e("thead",null,[e("tr",VL,[(t(!0),s(X,null,le(C.value,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:"border p-2 text-center"},l(y.label),9,jL))),128))]),e("tr",LL,[(t(!0),s(X,null,le(C.value,y=>(t(),s(X,{key:y.key},[y.children?(t(!0),s(X,{key:0},le(y.children,r=>(t(),s("th",{key:r.key,class:"border p-2 text-center"},l(r.label),1))),128)):G("",!0)],64))),128))])]),e("tbody",null,[(t(!0),s(X,null,le(o.value,(y,r)=>(t(),s("tr",{key:r},[e("td",FL,l(y.item_no),1),e("td",OL,l(y.agency_name),1),e("td",qL,l(y.recommended_participants),1),e("td",BL,l(y.recommended_cancelled),1),e("td",HL,l(y.self_report_participants),1),e("td",WL,l(y.self_report_cancelled),1),e("td",zL,l(y.total_participants),1),e("td",KL,l(y.total_cancelled),1)]))),128)),o.value.length===0?(t(),s("tr",JL,[e("td",{colspan:K.value.length,class:"border p-4 text-center"},"無符合條件的資料",8,YL)])):G("",!0)])]))])]))}},ZL=Fe(GL,[["__scopeId","data-v-f93c269b"]]),QL={class:"w-full max-w-[1500px] mb-6 flex justify-end"},XL={class:"w-full max-w-[1500px] mt-6"},eF={key:0,class:"flex justify-center items-center py-10"},tF={key:1,class:"w-full border-collapse table-fixed"},sF={class:"bg-[#EEEFE7]"},aF=["colspan","rowspan"],oF={class:"bg-[#EEEFE7]"},lF={class:"border p-2 text-center"},nF={key:0,class:"border p-2 text-center"},rF={class:"border p-2 text-center"},iF={key:0},dF=["colspan"],uF={__name:"ConsultationTypeStats",setup(M){const h=m(!1),d=m([]),u=m([]),C=m({reportAllExport:!1}),o=async()=>{try{const T=await ot.getSidebarPermissions();T.data.code===0&&T.data.message==="success"?(C.value=T.data.data,console.log("諮詢問題類型及服務人數統計表頁面權限:",C.value.reportAllExport)):console.error("獲取權限失敗:",T.data.message)}catch(T){console.error("獲取權限錯誤:",T)}},N=()=>{U()},K=Se(()=>{const T=[];return d.value.forEach(z=>{z.key==="question_type_service_count"&&z.children?T.push(...z.children):["year_month","total"].includes(z.key)||T.push(z)}),T}),E=async()=>{var T;h.value=!0;try{const z=await gt.getConsultCount();if(z.data.code===0&&z.data.data){const g=z.data.data,a=g.xAxis.map(c=>({label:c,key:c})),R=[{label:"年度/月份",key:"year_month",rowspan:2},{label:"問題類型/服務人數",key:"question_type_service_count",colspan:a.length,children:a},{label:"合計",key:"total",rowspan:2}];d.value=R;const Z=[];g.yAxis.forEach((c,y)=>{const r={year_month:c};a.forEach((b,p)=>{r[b.key]=g.xData[y]?g.xData[y][p]:""}),r.total=g.yAxisSums[y]??0,Z.push(r)});const $={year_month:"合計",type:"total"};a.forEach((c,y)=>{$[c.key]=g.xAxisSums[y]??0}),$.total=g.total??0,Z.push($),u.value=Z}else console.error("獲取諮詢統計數據失敗:",((T=z.data)==null?void 0:T.message)||"未知錯誤"),d.value=[],u.value=[]}catch(z){console.error("獲取諮詢統計數據錯誤:",z),d.value=[],u.value=[]}finally{h.value=!1}};je(()=>{E(),o()});const U=async()=>{try{const T=await gt.exportConsultCount(),z=T.headers["content-type"];if(!z||!z.includes("spreadsheetml.sheet"))try{const $=new Blob([T.data],{type:"application/json"}),c=await new Response($).text(),y=JSON.parse(c);console.error("匯出諮詢問題類型及服務人數統計失敗：伺服器返回錯誤：",y),v.showError("匯出失敗",y.message||"匯出過程中發生錯誤，請稍後再試");return}catch($){console.error("匯出諮詢問題類型及服務人數統計失敗：無法解析回應內容",$),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const g=new Blob([T.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(g),R=document.createElement("a");R.href=a;const Z=`諮詢問題類型及服務人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;R.setAttribute("download",Z),document.body.appendChild(R),R.click(),document.body.removeChild(R),window.URL.revokeObjectURL(a),v.showSuccess("匯出成功","諮詢問題類型及服務人數統計已成功匯出為 Excel 檔案")}catch(T){if(console.error("匯出諮詢問題類型及服務人數統計失敗:",T),T.response&&T.response.data){const z=T.response.data;v.showError("匯出失敗",z.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(T,z)=>(t(),s("div",null,[z[1]||(z[1]=e("h3",{class:"text-xl font-bold mb-4"},"諮詢問題類型及服務人數統計表",-1)),e("div",QL,[C.value&&C.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:N,"aria-label":"匯出 Excel"}," 匯出 Excel ")):G("",!0)]),e("div",XL,[h.value?(t(),s("div",eF,z[0]||(z[0]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",tF,[e("thead",null,[e("tr",sF,[(t(!0),s(X,null,le(d.value,g=>(t(),s("th",{key:g.key,colspan:g.colspan||1,rowspan:g.rowspan||1,class:"border p-2 text-center"},l(g.label),9,aF))),128))]),e("tr",oF,[(t(!0),s(X,null,le(d.value,g=>(t(),s(X,{key:g.key},[g.children?(t(!0),s(X,{key:0},le(g.children,a=>(t(),s("th",{key:a.key,class:"border p-2 text-center"},l(a.label),1))),128)):G("",!0)],64))),128))])]),e("tbody",null,[(t(!0),s(X,null,le(u.value,(g,a)=>(t(),s("tr",{key:a},[e("td",lF,l(g.year_month),1),(t(!0),s(X,null,le(K.value,R=>(t(),s(X,{key:R.key},[["year_month","total"].includes(R.key)?G("",!0):(t(),s("td",nF,l(g[R.key]),1))],64))),128)),e("td",rF,l(g.total),1)]))),128)),u.value.length===0?(t(),s("tr",iF,[e("td",{colspan:K.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,dF)])):G("",!0)])]))])]))}},cF=Fe(uF,[["__scopeId","data-v-3039d3ef"]]),pF={class:"w-full max-w-[1500px] mt-4"},vF={class:"flex items-center space-x-4"},mF={class:"flex items-center space-x-2"},bF={class:"flex items-center space-x-2"},fF=["disabled"],yF={class:"w-full max-w-[1500px] mt-6"},gF={key:0,class:"flex justify-center items-center py-10"},xF={key:1,class:"w-full border-collapse table-fixed"},hF={class:"bg-[#EEEFE7]"},wF=["colspan","rowspan"],_F={key:0,class:"bg-[#EEEFE7]"},kF=["colspan","rowspan"],$F={key:1,class:"bg-[#EEEFE7]"},CF=["rowspan"],EF=["rowspan"],SF={key:0},DF=["colspan"],MF={__name:"CreditWeekdayClassCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(_=>{_.children?_.children.forEach(f=>{f.children?p.push(...f.children):p.push(f)}):["item_no","region_type","university_name","total","region_total_col"].includes(_.key)||p.push(_)}),p}),E=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),U=Se(()=>C.value.some(p=>p.children&&p.children.some(_=>_.children&&_.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await ot.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("學分班課程開班數量（平日班）頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,_,f)=>f===0?Array.isArray(p.groupByTotal)?p.groupByTotal[_]??0:0:"",a=Se(()=>{const p=[];let _=null,f=0,V=-1;return o.value.forEach((W,H)=>{const k={...W};k.type==="total"?(k._display_region=!1,k._display_item_no=!1,k._region_rowspan=1,_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=null,f=0,V=-1):k.region_type!==""&&k.region_type!==_?(_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=k.region_type,f=1,V=p.length,k._display_region=!0,k._display_item_no=!0):(f++,k._display_region=!1,k._display_item_no=!0),p.push(k),H===o.value.length-1&&_!==null&&V!==-1&&(p[V]._region_rowspan=f)}),p}),R=(p,_)=>{const f={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(f["bg-orange-100"]=!0,f["font-bold"]=!0),f},Z=()=>{h.value="",d.value="",y(),c()},$=()=>{c()},c=async()=>{var p;u.value=!0;try{const _={};h.value&&d.value&&(_.dateRange=[h.value,d.value]);const f=await gt.getCreditWeekdayClassCount(_);if(f.data.code===0&&f.data.data){const V=f.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((x,L)=>({label:x,key:`course_${L+1}`})):[],H=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=H;const k=[];let D=1,j=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((x,L)=>{Array.isArray(x.yAxis)&&x.yAxis.forEach((de,xe)=>{const fe={item_no:D++,region_type:xe===0?x.name:"",university_name:de},ke=Array.isArray(V.xData[j])?V.xData[j]:[];(V.xAxis||[]).forEach((De,we)=>{fe[`course_${we+1}`]=ke[we]??0}),fe.total=Array.isArray(V.yAxisSums)?V.yAxisSums[j]??0:0,fe.region_total_col=g(V,L,xe),k.push(fe),j++})});const S={type:"total"};S.item_no="",S.region_type="",S.university_name="",(V.xAxis||[]).forEach((x,L)=>{S[`course_${L+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[L]??0:0}),S.total=V.total??0,S.region_total_col="",k.push(S),o.value=k}else C.value=[],o.value=[],v.showError("查詢失敗",((p=f.data)==null?void 0:p.message)||"API 回傳異常")}catch(_){C.value=[],o.value=[],v.showError("查詢失敗",(_==null?void 0:_.message)||"API 請求失敗")}finally{u.value=!1}},y=()=>{const p={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(_=>{p[_]===void 0&&delete p[_]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),_=p.get("startDate"),f=p.get("endDate");_&&(h.value=_),f&&(d.value=f),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),H=V.get("endDate");W!==h.value&&(h.value=W||""),H!==d.value&&(d.value=H||""),c()}),z()});const r=()=>{b()},b=async()=>{try{const p={dateRange:h.value&&d.value?[h.value,d.value]:void 0},_=await gt.exportCreditWeekdayClassCount(p),f=_.headers["content-type"];if(!f||!f.includes("spreadsheetml.sheet"))try{const D=new Blob([_.data],{type:"application/json"}),j=await new Response(D).text(),S=JSON.parse(j);console.error("匯出學分班課程開班數量統計（平日班）失敗：伺服器返回錯誤：",S),v.showError("匯出失敗",S.message||"匯出過程中發生錯誤，請稍後再試");return}catch(D){console.error("匯出學分班課程開班數量統計（平日班）失敗：無法解析回應內容",D),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([_.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),H=document.createElement("a");H.href=W;const k=`學分班課程開班數量（平日班）_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;H.setAttribute("download",k),document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","學分班課程開班數量統計（平日班）已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出學分班課程開班數量統計（平日班）失敗:",p),p.response&&p.response.data){const _=p.response.data;v.showError("匯出失敗",_.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,_)=>(t(),s("div",null,[_[7]||(_[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程開班數量(平日班)統計表",-1)),e("div",pF,[e("div",vF,[_[4]||(_[4]=e("span",null,"查詢日期:",-1)),e("div",mF,[_[2]||(_[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":_[0]||(_[0]=f=>h.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,h.value]])]),e("div",bF,[_[3]||(_[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":_[1]||(_[1]=f=>d.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:Z,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:$,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,fF),_[5]||(_[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):G("",!0)])]),e("div",yF,[u.value?(t(),s("div",gF,_[6]||(_[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",xF,[e("thead",null,[e("tr",hF,[(t(!0),s(X,null,le(C.value,f=>(t(),s("th",{key:f.key,colspan:f.colspan||1,rowspan:f.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":f.type==="subtotal"||f.type==="total"}])},l(f.label),11,wF))),128))]),E.value?(t(),s("tr",_F,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,kF))),128)):G("",!0)],64))),128))])):G("",!0),U.value?(t(),s("tr",$F,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s(X,{key:V.key},[(t(!0),s(X,null,le(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(a.value,(f,V)=>(t(),s(X,{key:V},[f.type==="total"?(t(),s("tr",{key:0,class:ee(R(f))},[e("td",{colspan:"3",class:ee(R(f))},"總計",2),(t(!0),s(X,null,le(K.value,W=>(t(),s("td",{key:W.key,class:ee(R(f))},l(f[W.key]),3))),128)),e("td",{class:ee(R(f))},l(f.total),3),e("td",{class:ee(R(f))},l(f.region_total_col),3)],2)):(t(),s("tr",{key:1,class:ee(R(f))},[f._display_item_no?(t(),s("td",{key:0,class:ee(R(f))},l(f.item_no),3)):G("",!0),f._display_region?(t(),s("td",{key:1,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_type),11,CF)):G("",!0),e("td",{class:ee(R(f))},l(f.university_name),3),(t(!0),s(X,null,le(K.value,W=>(t(),s(X,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:ee(R(f))},l(f[W.key]),3)):G("",!0)],64))),128)),e("td",{class:ee(R(f))},l(f.total),3),f._display_region?(t(),s("td",{key:2,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_total_col),11,EF)):G("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",SF,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,DF)])):G("",!0)])]))])]))}},AF=Fe(MF,[["__scopeId","data-v-bfb9d94b"]]),IF={class:"w-full max-w-[1500px] mt-4"},RF={class:"flex items-center space-x-4"},PF={class:"flex items-center space-x-2"},UF={class:"flex items-center space-x-2"},NF=["disabled"],TF={class:"w-full max-w-[1500px] mt-6"},VF={key:0,class:"flex justify-center items-center py-10"},jF={key:1,class:"w-full border-collapse table-fixed"},LF={class:"bg-[#EEEFE7]"},FF=["colspan","rowspan"],OF={key:0,class:"bg-[#EEEFE7]"},qF=["colspan","rowspan"],BF={key:1,class:"bg-[#EEEFE7]"},HF=["rowspan"],WF=["rowspan"],zF={key:0},KF=["colspan"],JF={__name:"CreditWeekendClassCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(_=>{_.children?_.children.forEach(f=>{f.children?p.push(...f.children):p.push(f)}):["item_no","region_type","university_name","total","region_total_col"].includes(_.key)||p.push(_)}),p}),E=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),U=Se(()=>C.value.some(p=>p.children&&p.children.some(_=>_.children&&_.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await ot.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("學分班課程開班數量（假日班）頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,_,f)=>f===0?Array.isArray(p.groupByTotal)?p.groupByTotal[_]??0:0:"",a=Se(()=>{const p=[];let _=null,f=0,V=-1;return o.value.forEach((W,H)=>{const k={...W};k.type==="total"?(k._display_region=!1,k._display_item_no=!1,k._region_rowspan=1,_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=null,f=0,V=-1):k.region_type!==""&&k.region_type!==_?(_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=k.region_type,f=1,V=p.length,k._display_region=!0,k._display_item_no=!0):(f++,k._display_region=!1,k._display_item_no=!0),p.push(k),H===o.value.length-1&&_!==null&&V!==-1&&(p[V]._region_rowspan=f)}),p}),R=(p,_)=>{const f={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(f["bg-orange-100"]=!0,f["font-bold"]=!0),f},Z=()=>{h.value="",d.value="",y(),c()},$=()=>{c()},c=async()=>{var p;u.value=!0;try{const _={};h.value&&d.value&&(_.dateRange=[h.value,d.value]);const f=await gt.getCreditWeekendClassCount(_);if(f.data.code===0&&f.data.data){const V=f.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((x,L)=>({label:x,key:`course_${L+1}`})):[],H=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=H;const k=[];let D=1,j=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((x,L)=>{Array.isArray(x.yAxis)&&x.yAxis.forEach((de,xe)=>{const fe={item_no:D++,region_type:xe===0?x.name:"",university_name:de},ke=Array.isArray(V.xData[j])?V.xData[j]:[];(V.xAxis||[]).forEach((De,we)=>{fe[`course_${we+1}`]=ke[we]??0}),fe.total=Array.isArray(V.yAxisSums)?V.yAxisSums[j]??0:0,fe.region_total_col=g(V,L,xe),k.push(fe),j++})});const S={type:"total"};S.item_no="",S.region_type="",S.university_name="",(V.xAxis||[]).forEach((x,L)=>{S[`course_${L+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[L]??0:0}),S.total=V.total??0,S.region_total_col="",k.push(S),o.value=k}else C.value=[],o.value=[],v.showError("查詢失敗",((p=f.data)==null?void 0:p.message)||"API 回傳異常")}catch(_){C.value=[],o.value=[],v.showError("查詢失敗",(_==null?void 0:_.message)||"API 請求失敗")}finally{u.value=!1}},y=()=>{const p={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(_=>{p[_]===void 0&&delete p[_]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),_=p.get("startDate"),f=p.get("endDate");_&&(h.value=_),f&&(d.value=f),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),H=V.get("endDate");W!==h.value&&(h.value=W||""),H!==d.value&&(d.value=H||""),c()}),z()});const r=()=>{b()},b=async()=>{try{const p={dateRange:h.value&&d.value?[h.value,d.value]:void 0},_=await gt.exportCreditWeekendClassCount(p),f=_.headers["content-type"];if(!f||!f.includes("spreadsheetml.sheet"))try{const D=new Blob([_.data],{type:"application/json"}),j=await new Response(D).text(),S=JSON.parse(j);console.error("匯出學分班課程開班數量統計（假日班）失敗：伺服器返回錯誤：",S),v.showError("匯出失敗",S.message||"匯出過程中發生錯誤，請稍後再試");return}catch(D){console.error("匯出學分班課程開班數量統計（假日班）失敗：無法解析回應內容",D),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([_.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),H=document.createElement("a");H.href=W;const k=`學分班課程開班數量（假日班）_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;H.setAttribute("download",k),document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","學分班課程開班數量統計（假日班）已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出學分班課程開班數量統計（假日班）失敗:",p),p.response&&p.response.data){const _=p.response.data;v.showError("匯出失敗",_.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,_)=>(t(),s("div",null,[_[7]||(_[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程開班數量(假日班)統計表",-1)),e("div",IF,[e("div",RF,[_[4]||(_[4]=e("span",null,"查詢日期:",-1)),e("div",PF,[_[2]||(_[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":_[0]||(_[0]=f=>h.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,h.value]])]),e("div",UF,[_[3]||(_[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":_[1]||(_[1]=f=>d.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:Z,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:$,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,NF),_[5]||(_[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):G("",!0)])]),e("div",TF,[u.value?(t(),s("div",VF,_[6]||(_[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",jF,[e("thead",null,[e("tr",LF,[(t(!0),s(X,null,le(C.value,f=>(t(),s("th",{key:f.key,colspan:f.colspan||1,rowspan:f.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":f.type==="subtotal"||f.type==="total"}])},l(f.label),11,FF))),128))]),E.value?(t(),s("tr",OF,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,qF))),128)):G("",!0)],64))),128))])):G("",!0),U.value?(t(),s("tr",BF,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s(X,{key:V.key},[(t(!0),s(X,null,le(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(a.value,(f,V)=>(t(),s(X,{key:V},[f.type==="total"?(t(),s("tr",{key:0,class:ee(R(f))},[e("td",{colspan:"3",class:ee(R(f))},"總計",2),(t(!0),s(X,null,le(K.value,W=>(t(),s("td",{key:W.key,class:ee(R(f))},l(f[W.key]),3))),128)),e("td",{class:ee(R(f))},l(f.total),3),e("td",{class:ee(R(f))},l(f.region_total_col),3)],2)):(t(),s("tr",{key:1,class:ee(R(f))},[f._display_item_no?(t(),s("td",{key:0,class:ee(R(f))},l(f.item_no),3)):G("",!0),f._display_region?(t(),s("td",{key:1,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_type),11,HF)):G("",!0),e("td",{class:ee(R(f))},l(f.university_name),3),(t(!0),s(X,null,le(K.value,W=>(t(),s(X,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:ee(R(f))},l(f[W.key]),3)):G("",!0)],64))),128)),e("td",{class:ee(R(f))},l(f.total),3),f._display_region?(t(),s("td",{key:2,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_total_col),11,WF)):G("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",zF,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,KF)])):G("",!0)])]))])]))}},YF=Fe(JF,[["__scopeId","data-v-4aaac724"]]),GF={class:"w-full max-w-[1500px] mt-4"},ZF={class:"flex items-center space-x-4"},QF={class:"flex items-center space-x-2"},XF={class:"flex items-center space-x-2"},eO=["disabled"],tO={class:"w-full max-w-[1500px] mt-6"},sO={key:0,class:"flex justify-center items-center py-10"},aO={key:1,class:"w-full border-collapse table-fixed"},oO={class:"bg-[#EEEFE7]"},lO=["colspan","rowspan"],nO={key:0,class:"bg-[#EEEFE7]"},rO=["colspan","rowspan"],iO={key:1,class:"bg-[#EEEFE7]"},dO=["rowspan"],uO=["rowspan"],cO={key:0},pO=["colspan"],vO={__name:"VocationalClassCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(_=>{_.children?_.children.forEach(f=>{f.children?p.push(...f.children):p.push(f)}):["item_no","region_type","university_name","total","region_total_col"].includes(_.key)||p.push(_)}),p}),E=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),U=Se(()=>C.value.some(p=>p.children&&p.children.some(_=>_.children&&_.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await ot.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("職能班課程開班數量頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,_,f)=>f===0?Array.isArray(p.groupByTotal)?p.groupByTotal[_]??0:0:"",a=Se(()=>{const p=[];let _=null,f=0,V=-1;return o.value.forEach((W,H)=>{const k={...W};k.type==="total"?(k._display_region=!1,k._display_item_no=!1,k._region_rowspan=1,_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=null,f=0,V=-1):k.region_type!==""&&k.region_type!==_?(_!==null&&V!==-1&&(p[V]._region_rowspan=f),_=k.region_type,f=1,V=p.length,k._display_region=!0,k._display_item_no=!0):(f++,k._display_region=!1,k._display_item_no=!0),p.push(k),H===o.value.length-1&&_!==null&&V!==-1&&(p[V]._region_rowspan=f)}),p}),R=(p,_)=>{const f={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(f["bg-orange-100"]=!0,f["font-bold"]=!0),f},Z=()=>{h.value="",d.value="",y(),c()},$=()=>{c()},c=async()=>{var p;u.value=!0;try{const _={};h.value&&d.value&&(_.dateRange=[h.value,d.value]);const f=await gt.getVocationalClassCount(_);if(f.data.code===0&&f.data.data){const V=f.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((x,L)=>({label:x,key:`course_${L+1}`})):[],H=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=H;const k=[];let D=1,j=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((x,L)=>{Array.isArray(x.yAxis)&&x.yAxis.forEach((de,xe)=>{const fe={item_no:D++,region_type:xe===0?x.name:"",university_name:de},ke=Array.isArray(V.xData[j])?V.xData[j]:[];(V.xAxis||[]).forEach((De,we)=>{fe[`course_${we+1}`]=ke[we]??0}),fe.total=Array.isArray(V.yAxisSums)?V.yAxisSums[j]??0:0,fe.region_total_col=g(V,L,xe),k.push(fe),j++})});const S={type:"total"};S.item_no="",S.region_type="",S.university_name="",(V.xAxis||[]).forEach((x,L)=>{S[`course_${L+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[L]??0:0}),S.total=V.total??0,S.region_total_col="",k.push(S),o.value=k}else C.value=[],o.value=[],v.showError("查詢失敗",((p=f.data)==null?void 0:p.message)||"API 回傳異常")}catch(_){C.value=[],o.value=[],v.showError("查詢失敗",(_==null?void 0:_.message)||"API 請求失敗")}finally{u.value=!1}},y=()=>{const p={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(_=>{p[_]===void 0&&delete p[_]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),_=p.get("startDate"),f=p.get("endDate");_&&(h.value=_),f&&(d.value=f),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),H=V.get("endDate");W!==h.value&&(h.value=W||""),H!==d.value&&(d.value=H||""),c()}),z()});const r=()=>{b()},b=async()=>{try{const p={dateRange:h.value&&d.value?[h.value,d.value]:void 0},_=await gt.exportVocationalClassCount(p),f=_.headers["content-type"];if(!f||!f.includes("spreadsheetml.sheet"))try{const D=new Blob([_.data],{type:"application/json"}),j=await new Response(D).text(),S=JSON.parse(j);console.error("匯出職能班課程開班數量統計失敗：伺服器返回錯誤：",S),v.showError("匯出失敗",S.message||"匯出過程中發生錯誤，請稍後再試");return}catch(D){console.error("匯出職能班課程開班數量統計失敗：無法解析回應內容",D),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([_.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),H=document.createElement("a");H.href=W;const k=`職能班課程開班數量_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;H.setAttribute("download",k),document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","職能班課程開班數量統計已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出職能班課程開班數量統計失敗:",p),p.response&&p.response.data){const _=p.response.data;v.showError("匯出失敗",_.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,_)=>(t(),s("div",null,[_[7]||(_[7]=e("h3",{class:"text-xl font-bold mb-4"},"職能班課程開班數量統計表",-1)),e("div",GF,[e("div",ZF,[_[4]||(_[4]=e("span",null,"查詢日期:",-1)),e("div",QF,[_[2]||(_[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":_[0]||(_[0]=f=>h.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,h.value]])]),e("div",XF,[_[3]||(_[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":_[1]||(_[1]=f=>d.value=f),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue($,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:Z,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:$,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,eO),_[5]||(_[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):G("",!0)])]),e("div",tO,[u.value?(t(),s("div",sO,_[6]||(_[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",aO,[e("thead",null,[e("tr",oO,[(t(!0),s(X,null,le(C.value,f=>(t(),s("th",{key:f.key,colspan:f.colspan||1,rowspan:f.rowspan||1,class:ee(["border p-2 text-center",{"bg-gray-200":f.type==="subtotal"||f.type==="total"}])},l(f.label),11,lO))),128))]),E.value?(t(),s("tr",nO,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,rO))),128)):G("",!0)],64))),128))])):G("",!0),U.value?(t(),s("tr",iO,[(t(!0),s(X,null,le(C.value,f=>(t(),s(X,{key:f.key},[f.children?(t(!0),s(X,{key:0},le(f.children,V=>(t(),s(X,{key:V.key},[(t(!0),s(X,null,le(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):G("",!0)],64))),128))])):G("",!0)]),e("tbody",null,[(t(!0),s(X,null,le(a.value,(f,V)=>(t(),s(X,{key:V},[f.type==="total"?(t(),s("tr",{key:0,class:ee(R(f))},[e("td",{colspan:"3",class:ee(R(f))},"總計",2),(t(!0),s(X,null,le(K.value,W=>(t(),s("td",{key:W.key,class:ee(R(f))},l(f[W.key]),3))),128)),e("td",{class:ee(R(f))},l(f.total),3),e("td",{class:ee(R(f))},l(f.region_total_col),3)],2)):(t(),s("tr",{key:1,class:ee(R(f))},[f._display_item_no?(t(),s("td",{key:0,class:ee(R(f))},l(f.item_no),3)):G("",!0),f._display_region?(t(),s("td",{key:1,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_type),11,dO)):G("",!0),e("td",{class:ee(R(f))},l(f.university_name),3),(t(!0),s(X,null,le(K.value,W=>(t(),s(X,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:ee(R(f))},l(f[W.key]),3)):G("",!0)],64))),128)),e("td",{class:ee(R(f))},l(f.total),3),f._display_region?(t(),s("td",{key:2,rowspan:f._region_rowspan,class:ee(R(f))},l(f.region_total_col),11,uO)):G("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",cO,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,pO)])):G("",!0)])]))])]))}},mO=Fe(vO,[["__scopeId","data-v-de529341"]]),bO={class:"w-full max-w-[1500px] mt-4"},fO={class:"flex items-center space-x-4"},yO={class:"flex items-center space-x-2"},gO={class:"flex items-center space-x-2"},xO=["disabled"],hO={class:"w-full max-w-[1500px] mt-6"},wO={key:0,class:"flex justify-center items-center py-10"},_O={key:1,class:"w-full border-collapse table-fixed"},kO={class:"bg-[#EEEFE7]"},$O={class:"border p-2 text-center"},CO={class:"border p-2 text-center"},EO={class:"border p-2 text-center"},SO={class:"border p-2 text-center"},DO={class:"border p-2 text-center"},MO={class:"border p-2 text-center font-bold bg-orange-100"},AO={class:"border p-2 text-center font-bold bg-orange-100"},IO={class:"border p-2 text-center font-bold bg-orange-100"},RO={key:0},PO=["colspan"],UO={__name:"StudentCourseParticipation",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([{label:"序號",key:"item_no"},{label:"課程數量",key:"course_label"},{label:"學分班",key:"credit"},{label:"職能班",key:"vocational"},{label:"合計",key:"total"}]),o=m([]);rt();const N=We(),K=Se(()=>{const $=o.value.reduce((y,r)=>y+(Number(r.credit)||0),0),c=o.value.reduce((y,r)=>y+(Number(r.vocational)||0),0);return{credit:$,vocational:c,total:$+c}}),E=()=>{h.value="",d.value="",a(),g()},U=()=>{g()},T=m({reportAllExport:!1}),z=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?(T.value=$.data.data,console.log("學員修課課程數量統計表頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}},g=async()=>{var $,c,y,r;u.value=!0;try{const b={};h.value&&d.value&&(b.dateRange=[h.value,d.value]);const p=await gt.getStudentCourseCompletedStatus(b);if((($=p==null?void 0:p.data)==null?void 0:$.code)===0&&Array.isArray((y=(c=p==null?void 0:p.data)==null?void 0:c.data)==null?void 0:y.list)){const _=p.data.data.list,f=_.slice(0,Math.max(_.length-1,0));o.value=f.map((V,W)=>({item_no:W+1,course_label:(V==null?void 0:V.name)??"",credit:(V==null?void 0:V.creditCount)??0,vocational:(V==null?void 0:V.cyberCount)??0,total:(V==null?void 0:V.total)??((V==null?void 0:V.creditCount)??0)+((V==null?void 0:V.cyberCount)??0)}))}else o.value=[],v.showError("查詢失敗",((r=p==null?void 0:p.data)==null?void 0:r.message)||"API 回傳異常")}catch(b){o.value=[],v.showError("查詢失敗",(b==null?void 0:b.message)||"資料載入失敗")}finally{u.value=!1}},a=()=>{const $={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys($).forEach(c=>{$[c]===void 0&&delete $[c]}),N.replace({query:$})};je(()=>{const $=new URLSearchParams(window.location.search),c=$.get("startDate"),y=$.get("endDate");c&&(h.value=c),y&&(d.value=y),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),b=r.get("startDate"),p=r.get("endDate");b!==h.value&&(h.value=b||""),p!==d.value&&(d.value=p||""),g()}),z()});const R=()=>{Z()},Z=async()=>{try{const $={};h.value&&d.value&&($.dateRange=[h.value,d.value]);const c=await gt.exportStudentCourseCompletedStatus($),y=c.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const f=new Blob([c.data],{type:"application/json"}),V=await new Response(f).text(),W=JSON.parse(V);console.error("匯出學員修課課程數量統計失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(f){console.error("匯出學員修課課程數量統計失敗：無法解析回應內容",f),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(r),p=document.createElement("a");p.href=b;const _=`學員修課課程數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",_),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(b),v.showSuccess("匯出成功","學員修課課程數量統計已成功匯出為 Excel 檔案")}catch($){if(console.error("匯出學員修課課程數量統計失敗:",$),$.response&&$.response.data){const c=$.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return($,c)=>(t(),s("div",null,[c[8]||(c[8]=e("h3",{class:"text-xl font-bold mb-4"},"學員參加課程統計表",-1)),e("div",bO,[e("div",fO,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",yO,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=y=>h.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(U,["enter"])},null,34),[[te,h.value]])]),e("div",gO,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=y=>d.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(U,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:E,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:U,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢修課統計"}," 搜尋 ",8,xO),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:R}," 匯出 Excel ")):G("",!0)])]),e("div",hO,[u.value?(t(),s("div",wO,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",_O,[e("thead",null,[e("tr",kO,[(t(!0),s(X,null,le(C.value,y=>(t(),s("th",{key:y.key,class:"border p-2 text-center"},l(y.label),1))),128))])]),e("tbody",null,[(t(!0),s(X,null,le(o.value,(y,r)=>(t(),s("tr",{key:r},[e("td",$O,l(y.item_no),1),e("td",CO,l(y.course_label),1),e("td",EO,l(y.credit),1),e("td",SO,l(y.vocational),1),e("td",DO,l(y.total),1)]))),128)),e("tr",null,[c[7]||(c[7]=e("td",{class:"border p-2 text-center font-bold bg-orange-100",colspan:"2"},"總計",-1)),e("td",MO,l(K.value.credit),1),e("td",AO,l(K.value.vocational),1),e("td",IO,l(K.value.total),1)]),o.value.length===0?(t(),s("tr",RO,[e("td",{colspan:C.value.length,class:"border p-4 text-center"},"無符合條件的資料",8,PO)])):G("",!0)])]))])]))}},NO=Fe(UO,[["__scopeId","data-v-51ab62dd"]]),TO={class:"w-full max-w-[1500px] mt-4"},VO={class:"flex items-center space-x-4"},jO={class:"flex items-center space-x-2"},LO={class:"flex items-center space-x-2"},FO=["disabled"],OO={class:"w-full max-w-[1500px] mt-6"},qO={key:0,class:"flex justify-center items-center py-10"},BO={key:1,class:"w-full border-collapse table-fixed"},HO={class:"border p-2 text-center"},WO={class:"border p-2 text-center"},zO={class:"border p-2 text-center"},KO={class:"border p-2 text-center font-bold bg-orange-100",colspan:"2"},JO={class:"border p-2 text-center font-bold bg-orange-100"},YO={key:0},GO={__name:"StudentSecurityCertificateCount",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]);rt();const o=We(),N=Se(()=>C.value.reduce(($,c)=>$+(Number(c.count)||0),0)),K=m(""),E=()=>{h.value="",d.value="",a(),g()},U=()=>{g()},T=m({reportAllExport:!1}),z=async()=>{try{const $=await ot.getSidebarPermissions();$.data.code===0&&$.data.message==="success"?(T.value=$.data.data,console.log("學員資安證書完成人數統計表頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",$.data.message)}catch($){console.error("獲取權限錯誤:",$)}},g=async()=>{var $,c,y,r;u.value=!0;try{const b={};h.value&&d.value&&(b.dateRange=[h.value,d.value]);const p=await gt.getStudentCertificateCount(b);if((($=p==null?void 0:p.data)==null?void 0:$.code)===0&&Array.isArray((y=(c=p==null?void 0:p.data)==null?void 0:c.data)==null?void 0:y.list)){const _=p.data.data.list,f=_[_.length-1];K.value=(f==null?void 0:f.name)??"總計";const V=_.slice(0,Math.max(_.length-1,0));C.value=V.map((W,H)=>({item_no:H+1,certificate_name:(W==null?void 0:W.name)??"",count:(W==null?void 0:W.count)??0}))}else C.value=[],v.showError("查詢失敗",((r=p==null?void 0:p.data)==null?void 0:r.message)||"API 回傳異常")}catch(b){C.value=[],v.showError("查詢失敗",(b==null?void 0:b.message)||"資料載入失敗")}finally{u.value=!1}},a=()=>{const $={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys($).forEach(c=>{$[c]===void 0&&delete $[c]}),o.replace({query:$})};je(()=>{const $=new URLSearchParams(window.location.search),c=$.get("startDate"),y=$.get("endDate");c&&(h.value=c),y&&(d.value=y),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),b=r.get("startDate"),p=r.get("endDate");b!==h.value&&(h.value=b||""),p!==d.value&&(d.value=p||""),g()}),z()});const R=()=>{Z()},Z=async()=>{try{const $={dateRange:h.value&&d.value?[h.value,d.value]:void 0},c=await gt.exportStudentCertificateCount($),y=c.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const f=new Blob([c.data],{type:"application/json"}),V=await new Response(f).text(),W=JSON.parse(V);console.error("匯出學員資安證書完成人數統計表失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(f){console.error("匯出學員資安證書完成人數統計表失敗：無法解析回應內容",f),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(r),p=document.createElement("a");p.href=b;const _=`學員資安證書完成人數統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",_),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(b),v.showSuccess("匯出成功","學員資安證書完成人數統計表已成功匯出為 Excel 檔案")}catch($){if(console.error("匯出學員資安證書完成人數統計表失敗:",$),$.response&&$.response.data){const c=$.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return($,c)=>(t(),s("div",null,[c[9]||(c[9]=e("h3",{class:"text-xl font-bold mb-4"},"學員資安職能證書完成人數統計表",-1)),e("div",TO,[e("div",VO,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",jO,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=y=>h.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(U,["enter"])},null,34),[[te,h.value]])]),e("div",LO,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=y=>d.value=y),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(U,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:E,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:U,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢資安證書統計"}," 搜尋 ",8,FO),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:R}," 匯出 Excel ")):G("",!0)])]),e("div",OO,[u.value?(t(),s("div",qO,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",BO,[c[8]||(c[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center"},"序號"),e("th",{class:"border p-2 text-center"},"證書名稱"),e("th",{class:"border p-2 text-center"},"完成人數")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(C.value,(y,r)=>(t(),s("tr",{key:r},[e("td",HO,l(y.item_no),1),e("td",WO,l(y.certificate_name),1),e("td",zO,l(y.count),1)]))),128)),e("tr",null,[e("td",KO,l(K.value),1),e("td",JO,l(N.value),1)]),C.value.length===0?(t(),s("tr",YO,c[7]||(c[7]=[e("td",{colspan:3,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])]))])]))}},ZO=Fe(GO,[["__scopeId","data-v-e7a34be0"]]),QO={class:"w-full max-w-[1500px] mt-4"},XO={class:"flex items-center space-x-4"},eq={class:"flex items-center space-x-2"},tq={class:"flex items-center space-x-2"},sq=["disabled"],aq={class:"w-full max-w-[1500px] mt-6"},oq={key:0,class:"flex justify-center items-center py-10"},lq={key:1,class:"w-full border-collapse table-fixed"},nq={class:"border p-2 text-center"},rq={class:"border p-2 text-center"},iq={key:0},dq={__name:"StudentProgressStats",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]);rt();const o=We(),N=()=>{h.value="",d.value="",z(),T()},K=()=>{T()},E=m({reportAllExport:!1}),U=async()=>{try{const R=await ot.getSidebarPermissions();R.data.code===0&&R.data.message==="success"?(E.value=R.data.data,console.log("學員進度情形統計表頁面權限:",E.value.reportAllExport)):console.error("獲取權限失敗:",R.data.message)}catch(R){console.error("獲取權限錯誤:",R)}},T=async()=>{var R,Z,$,c;u.value=!0;try{const y={};h.value&&d.value&&(y.dateRange=[h.value,d.value]);const r=await gt.getStudentProgressTracking(y);((R=r==null?void 0:r.data)==null?void 0:R.code)===0&&Array.isArray(($=(Z=r==null?void 0:r.data)==null?void 0:Z.data)==null?void 0:$.list)?C.value=r.data.data.list.map(b=>({progress_label:(b==null?void 0:b.name)??"",count:(b==null?void 0:b.count)??0})):(C.value=[],v.showError("查詢失敗",((c=r==null?void 0:r.data)==null?void 0:c.message)||"API 回傳異常"))}catch(y){C.value=[],v.showError("查詢失敗",(y==null?void 0:y.message)||"資料載入失敗")}finally{u.value=!1}},z=()=>{const R={startDate:h.value||void 0,endDate:d.value||void 0};Object.keys(R).forEach(Z=>{R[Z]===void 0&&delete R[Z]}),o.replace({query:R})};je(()=>{const R=new URLSearchParams(window.location.search),Z=R.get("startDate"),$=R.get("endDate");Z&&(h.value=Z),$&&(d.value=$),T(),Ee(()=>window.location.search,()=>{const c=new URLSearchParams(window.location.search),y=c.get("startDate"),r=c.get("endDate");y!==h.value&&(h.value=y||""),r!==d.value&&(d.value=r||""),T()}),U()});const g=()=>{a()},a=async()=>{try{const R={dateRange:h.value&&d.value?[h.value,d.value]:void 0},Z=await gt.exportStudentProgressTracking(R),$=Z.headers["content-type"];if(!$||!$.includes("spreadsheetml.sheet"))try{const p=new Blob([Z.data],{type:"application/json"}),_=await new Response(p).text(),f=JSON.parse(_);console.error("匯出學員進度情形統計表失敗：伺服器返回錯誤：",f),v.showError("匯出失敗",f.message||"匯出過程中發生錯誤，請稍後再試");return}catch(p){console.error("匯出學員進度情形統計表失敗：無法解析回應內容",p),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const c=new Blob([Z.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=window.URL.createObjectURL(c),r=document.createElement("a");r.href=y;const b=`學員進度情形統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;r.setAttribute("download",b),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(y),v.showSuccess("匯出成功","學員進度情形統計表已成功匯出為 Excel 檔案")}catch(R){if(console.error("匯出學員進度情形統計表失敗:",R),R.response&&R.response.data){const Z=R.response.data;v.showError("匯出失敗",Z.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(R,Z)=>(t(),s("div",null,[Z[9]||(Z[9]=e("h3",{class:"text-xl font-bold mb-4"},"學員進度追蹤統計表",-1)),e("div",QO,[e("div",XO,[Z[4]||(Z[4]=e("span",null,"查詢日期:",-1)),e("div",eq,[Z[2]||(Z[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),P(e("input",{id:"startDate",type:"date","onUpdate:modelValue":Z[0]||(Z[0]=$=>h.value=$),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!h.value}]),onKeyup:Ue(K,["enter"])},null,34),[[te,h.value]])]),e("div",tq,[Z[3]||(Z[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),P(e("input",{id:"endDate",type:"date","onUpdate:modelValue":Z[1]||(Z[1]=$=>d.value=$),class:ee(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":h.value&&!d.value}]),onKeyup:Ue(K,["enter"])},null,34),[[te,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:N,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:K,disabled:u.value||h.value&&!d.value||!h.value&&d.value||h.value&&d.value&&new Date(h.value)>new Date(d.value),"aria-label":"查詢進度統計"}," 搜尋 ",8,sq),Z[5]||(Z[5]=e("div",{class:"flex-grow"},null,-1)),E.value&&E.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:g}," 匯出 Excel ")):G("",!0)])]),e("div",aq,[u.value?(t(),s("div",oq,Z[6]||(Z[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",lq,[Z[8]||(Z[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center"},"進度情形"),e("th",{class:"border p-2 text-center"},"人數")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(C.value,($,c)=>(t(),s("tr",{key:c},[e("td",nq,l($.progress_label),1),e("td",rq,l($.count),1)]))),128)),C.value.length===0?(t(),s("tr",iq,Z[7]||(Z[7]=[e("td",{colspan:2,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])]))])]))}},uq=Fe(dq,[["__scopeId","data-v-1a703230"]]),cq={class:"w-full max-w-[1500px] mt-4"},pq={class:"flex items-center space-x-4"},vq={class:"flex items-center space-x-2"},mq=["value"],bq={class:"flex items-center space-x-2"},fq=["value"],yq=["disabled"],gq={class:"w-full max-w-[1500px] mt-6"},xq={key:0,class:"flex justify-center items-center py-10"},hq={key:1,class:"w-full border-collapse table-fixed"},wq={class:"border p-2 text-center"},_q={class:"border p-2 text-center"},kq={class:"border p-2 text-center"},$q={class:"border p-2 text-center"},Cq={class:"border p-2 text-center"},Eq={class:"border p-2 text-center"},Sq={class:"border p-2 text-center"},Dq={class:"border p-2 text-center"},Mq={class:"border p-2 text-center"},Aq={class:"border p-2 text-center"},Iq={class:"border p-2 text-center"},Rq={class:"border p-2 text-center"},Pq={class:"border p-2 text-center"},Uq={class:"border p-2 text-center"},Nq={class:"border p-2 text-center"},Tq={class:"border p-2 text-center"},Vq={key:0,class:"bg-orange-100 font-bold"},jq={class:"border p-2 text-center"},Lq={class:"border p-2 text-center"},Fq={class:"border p-2 text-center"},Oq={class:"border p-2 text-center"},qq={class:"border p-2 text-center"},Bq={class:"border p-2 text-center"},Hq={class:"border p-2 text-center"},Wq={class:"border p-2 text-center"},zq={class:"border p-2 text-center"},Kq={class:"border p-2 text-center"},Jq={class:"border p-2 text-center"},Yq={class:"border p-2 text-center"},Gq={class:"border p-2 text-center"},Zq={class:"border p-2 text-center"},Qq={class:"border p-2 text-center"},Xq={key:1},eB=1+4*3+3,tB={__name:"FundingAllocationStats",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);rt();const N=We(),K=Se(()=>{const y=Array.isArray(o.value)?o.value:[],r=b=>typeof y[b]=="number"?y[b]:(y==null?void 0:y[b])??0;return{grant80_pending:r(0),grant80_count:r(1),grant80_amount:r(2),grant15_pending:r(3),grant15_count:r(4),grant15_amount:r(5),grant5_pending:r(6),grant5_count:r(7),grant5_amount:r(8),grant100_pending:r(9),grant100_count:r(10),grant100_amount:r(11),sum_pending:r(12),sum_granted_count:r(13),sum_granted_amount:r(14)}}),E=Se(()=>{const y=new Date().getFullYear(),r=[];for(let b=y;b>=2024;b--)r.push(b);return r}),U=Se(()=>{const y=[];for(let r=1;r<=12;r++)y.push(r);return y.map(r=>String(r).padStart(2,"0"))}),T=()=>{h.value="",d.value="",Z(),R()},z=()=>{R()},g=m({reportAllExport:!1}),a=async()=>{try{const y=await ot.getSidebarPermissions();y.data.code===0&&y.data.message==="success"?(g.value=y.data.data,console.log("經費核撥統計表頁面權限:",g.value.reportAllExport)):console.error("獲取權限失敗:",y.data.message)}catch(y){console.error("獲取權限錯誤:",y)}},R=async()=>{var y,r,b,p,_,f;u.value=!0;try{const V={};h.value&&(V.year=parseInt(h.value)),d.value&&(V.month=parseInt(d.value));const W=await gt.getFinanceAppropriationDetail(V);if(((y=W==null?void 0:W.data)==null?void 0:y.code)===0&&Array.isArray((b=(r=W==null?void 0:W.data)==null?void 0:r.data)==null?void 0:b.yAxis)&&Array.isArray((_=(p=W==null?void 0:W.data)==null?void 0:p.data)==null?void 0:_.xData)){const H=W.data.data.yAxis,k=W.data.data.xData;o.value=Array.isArray(W.data.data.xAxisSums)?W.data.data.xAxisSums:[],C.value=H.map((D,j)=>{const S=Array.isArray(k[j])?k[j]:[];return{month_label:D,grant80_pending:(S==null?void 0:S[0])??0,grant80_count:(S==null?void 0:S[1])??0,grant80_amount:(S==null?void 0:S[2])??0,grant15_pending:(S==null?void 0:S[3])??0,grant15_count:(S==null?void 0:S[4])??0,grant15_amount:(S==null?void 0:S[5])??0,grant5_pending:(S==null?void 0:S[6])??0,grant5_count:(S==null?void 0:S[7])??0,grant5_amount:(S==null?void 0:S[8])??0,grant100_pending:(S==null?void 0:S[9])??0,grant100_count:(S==null?void 0:S[10])??0,grant100_amount:(S==null?void 0:S[11])??0,sum_pending:(S==null?void 0:S[12])??0,sum_granted_count:(S==null?void 0:S[13])??0,sum_granted_amount:(S==null?void 0:S[14])??0}})}else C.value=[],v.showError("查詢失敗",((f=W==null?void 0:W.data)==null?void 0:f.message)||"API 回傳異常")}catch(V){C.value=[],v.showError("查詢失敗",(V==null?void 0:V.message)||"資料載入失敗")}finally{u.value=!1}},Z=()=>{const y={year:h.value||void 0,month:d.value||void 0};Object.keys(y).forEach(r=>{y[r]===void 0&&delete y[r]}),N.replace({query:y})};je(()=>{const y=new URLSearchParams(window.location.search),r=y.get("year"),b=y.get("month");r&&(h.value=r),b&&(d.value=b),R(),Ee(()=>window.location.search,()=>{const p=new URLSearchParams(window.location.search),_=p.get("year"),f=p.get("month");_!==h.value&&(h.value=_||""),f!==d.value&&(d.value=f||""),R()}),a()});const $=()=>{c()},c=async()=>{try{const y={};h.value&&(y.year=parseInt(h.value)),d.value&&(y.month=parseInt(d.value));const r=await gt.exportFinanceAppropriationDetail(y),b=r.headers["content-type"];if(!b||!b.includes("spreadsheetml.sheet"))try{const W=new Blob([r.data],{type:"application/json"}),H=await new Response(W).text(),k=JSON.parse(H);console.error("匯出經費核撥統計表失敗：伺服器返回錯誤：",k),v.showError("匯出失敗",k.message||"匯出過程中發生錯誤，請稍後再試");return}catch(W){console.error("匯出經費核撥統計表失敗：無法解析回應內容",W),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const p=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=window.URL.createObjectURL(p),f=document.createElement("a");f.href=_;const V=`經費核撥統計表_${h.value||new Date().getFullYear()}${String(d.value||new Date().getMonth()+1).padStart(2,"0")}.xlsx`;f.setAttribute("download",V),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(_),v.showSuccess("匯出成功","經費核撥統計表已成功匯出為 Excel 檔案")}catch(y){if(console.error("匯出經費核撥統計表失敗:",y),y.response&&y.response.data){const r=y.response.data;v.showError("匯出失敗",r.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(y,r)=>(t(),s("div",null,[r[9]||(r[9]=e("h3",{class:"text-xl font-bold mb-4"},"經費核撥統計表",-1)),e("div",cq,[e("div",pq,[r[4]||(r[4]=e("span",null,"查詢日期:",-1)),e("div",vq,[P(e("select",{id:"year","onUpdate:modelValue":r[0]||(r[0]=b=>h.value=b),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(z,["enter"])},[r[2]||(r[2]=e("option",{value:""},"請選擇年",-1)),(t(!0),s(X,null,le(E.value,b=>(t(),s("option",{key:b,value:b},l(b)+"年 ",9,mq))),128))],544),[[Pe,h.value]])]),e("div",bq,[P(e("select",{id:"month","onUpdate:modelValue":r[1]||(r[1]=b=>d.value=b),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(z,["enter"])},[r[3]||(r[3]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(X,null,le(U.value,b=>(t(),s("option",{key:b,value:b},l(b)+"月 ",9,fq))),128))],544),[[Pe,d.value]])]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:z,disabled:u.value,"aria-label":"查詢核撥統計"}," 搜尋 ",8,yq),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:T,"aria-label":"重置查詢條件"}," 重置 "),r[5]||(r[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:$}," 匯出 Excel ")):G("",!0)])]),e("div",gq,[u.value?(t(),s("div",xq,r[6]||(r[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",hq,[r[8]||(r[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥年度/月份"),e("th",{class:"border p-2 text-center",colspan:12,scope:"col"},"核撥比例 / 核撥人數 / 核撥金額"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"待申請人數合計"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥人數合計"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥金額合計")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥80%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥15%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥5%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥100%")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(C.value,(b,p)=>(t(),s("tr",{key:p},[e("td",wq,l(b.month_label),1),e("td",_q,l(b.grant80_pending),1),e("td",kq,l(b.grant80_count),1),e("td",$q,l(b.grant80_amount),1),e("td",Cq,l(b.grant15_pending),1),e("td",Eq,l(b.grant15_count),1),e("td",Sq,l(b.grant15_amount),1),e("td",Dq,l(b.grant5_pending),1),e("td",Mq,l(b.grant5_count),1),e("td",Aq,l(b.grant5_amount),1),e("td",Iq,l(b.grant100_pending),1),e("td",Rq,l(b.grant100_count),1),e("td",Pq,l(b.grant100_amount),1),e("td",Uq,l(b.sum_pending),1),e("td",Nq,l(b.sum_granted_count),1),e("td",Tq,l(b.sum_granted_amount),1)]))),128)),C.value.length>0?(t(),s("tr",Vq,[r[7]||(r[7]=e("td",{class:"border p-2 text-center"},"合計",-1)),e("td",jq,l(K.value.grant80_pending),1),e("td",Lq,l(K.value.grant80_count),1),e("td",Fq,l(K.value.grant80_amount),1),e("td",Oq,l(K.value.grant15_pending),1),e("td",qq,l(K.value.grant15_count),1),e("td",Bq,l(K.value.grant15_amount),1),e("td",Hq,l(K.value.grant5_pending),1),e("td",Wq,l(K.value.grant5_count),1),e("td",zq,l(K.value.grant5_amount),1),e("td",Kq,l(K.value.grant100_pending),1),e("td",Jq,l(K.value.grant100_count),1),e("td",Yq,l(K.value.grant100_amount),1),e("td",Gq,l(K.value.sum_pending),1),e("td",Zq,l(K.value.sum_granted_count),1),e("td",Qq,l(K.value.sum_granted_amount),1)])):G("",!0),C.value.length===0?(t(),s("tr",Xq,[e("td",{colspan:eB,class:"border p-4 text-center"},"無符合條件的資料")])):G("",!0)])]))])]))}},sB=Fe(tB,[["__scopeId","data-v-963a9460"]]),aB={class:"w-full max-w-[1500px] mt-4"},oB={class:"flex items-center space-x-4"},lB={class:"flex items-center space-x-2"},nB=["value"],rB={class:"flex items-center space-x-2"},iB=["value"],dB=["disabled"],uB={class:"w-full max-w-[1500px] mt-6"},cB={key:0,class:"flex justify-center items-center py-10"},pB={key:1,class:"w-full border-collapse table-fixed"},vB={class:"border p-2 text-center"},mB={class:"border p-2 text-center"},bB={class:"border p-2 text-center"},fB={class:"border p-2 text-center"},yB={class:"border p-2 text-center"},gB={class:"border p-2 text-center"},xB={class:"border p-2 text-center"},hB={class:"border p-2 text-center"},wB={class:"bg-yellow-200 font-bold"},_B={class:"border p-2 text-center"},kB={class:"border p-2 text-center"},$B={class:"border p-2 text-center"},CB={class:"border p-2 text-center"},EB={class:"border p-2 text-center"},SB={class:"border p-2 text-center"},DB={key:0},MB={__name:"MonthlyConsultationMethodStats",setup(M){const h=m(""),d=m(""),u=m(!1),C=m([]),o=m({reportAllExport:!1}),N=async()=>{try{const c=await ot.getSidebarPermissions();c.data.code===0&&c.data.message==="success"?(o.value=c.data.data,console.log("每月諮詢管道統計表頁面權限:",o.value.reportAllExport)):console.error("獲取權限失敗:",c.data.message)}catch(c){console.error("獲取權限錯誤:",c)}};rt();const K=We(),E=Se(()=>{const c=y=>C.value.reduce((r,b)=>r+(Number(b[y])||0),0);return{email_month:c("email_month"),email_total:c("email_total"),phone_month:c("phone_month"),phone_total:c("phone_total"),line_month:c("line_month"),line_total:c("line_total")}}),U=Se(()=>{const c=new Date().getFullYear(),y=[];for(let r=c;r>=2024;r--)y.push(r);return y}),T=Se(()=>{const c=[];for(let y=1;y<=12;y++)c.push(y);return c.map(y=>String(y).padStart(2,"0"))}),z=()=>{h.value="",d.value="",R(),a()},g=()=>{a()},a=async()=>{var c,y,r,b,p,_;u.value=!0;try{const f={};h.value&&(f.year=h.value),d.value&&(f.month=d.value);const V=await gt.getConsultType(f);if(((c=V==null?void 0:V.data)==null?void 0:c.code)===0&&Array.isArray((r=(y=V==null?void 0:V.data)==null?void 0:y.data)==null?void 0:r.yAxis)&&Array.isArray((p=(b=V==null?void 0:V.data)==null?void 0:b.data)==null?void 0:p.xData)){const W=V.data.data.yAxis,H=V.data.data.xData;C.value=W.map((k,D)=>{const j=Array.isArray(H[D])?H[D]:[];return{item_no:D+1,category:k,email_month:(j==null?void 0:j[0])??0,email_total:(j==null?void 0:j[1])??0,phone_month:(j==null?void 0:j[2])??0,phone_total:(j==null?void 0:j[3])??0,line_month:(j==null?void 0:j[4])??0,line_total:(j==null?void 0:j[5])??0}})}else C.value=[],v.showError("查詢失敗",((_=V==null?void 0:V.data)==null?void 0:_.message)||"API 回傳異常")}catch(f){C.value=[],v.showError("查詢失敗",(f==null?void 0:f.message)||"資料載入失敗")}finally{u.value=!1}},R=()=>{const c={year:h.value||void 0,month:d.value||void 0};Object.keys(c).forEach(y=>{c[y]===void 0&&delete c[y]}),K.replace({query:c})};je(()=>{const c=new URLSearchParams(window.location.search),y=c.get("year"),r=c.get("month");h.value=y||"",d.value=r||"",a(),Ee(()=>window.location.search,()=>{const b=new URLSearchParams(window.location.search),p=b.get("year"),_=b.get("month");p!==h.value&&(h.value=p||""),_!==d.value&&(d.value=_||""),a()}),N()});const Z=()=>{$()},$=async()=>{try{const c={};h.value&&(c.year=parseInt(h.value)),d.value&&(c.month=parseInt(d.value));const y=await gt.exportMonthlyConsultationMethodStats(c),r=y.headers["content-type"];if(!r||!r.includes("spreadsheetml.sheet"))try{const V=new Blob([y.data],{type:"application/json"}),W=await new Response(V).text(),H=JSON.parse(W);console.error("匯出每月諮詢管道統計失敗：伺服器返回錯誤：",H),v.showError("匯出失敗",H.message||"匯出過程中發生錯誤，請稍後再試");return}catch(V){console.error("匯出每月諮詢管道統計失敗：無法解析回應內容",V),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const b=new Blob([y.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(b),_=document.createElement("a");_.href=p;const f=`每月諮詢管道統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;_.setAttribute("download",f),document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(p),v.showSuccess("匯出成功","每月諮詢管道統計已成功匯出為 Excel 檔案")}catch(c){if(console.error("匯出每月諮詢管道統計失敗:",c),c.response&&c.response.data){const y=c.response.data;v.showError("匯出失敗",y.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(c,y)=>(t(),s("div",null,[y[10]||(y[10]=e("h3",{class:"text-xl font-bold mb-4"},"每月諮詢方式統計表",-1)),e("div",aB,[e("div",oB,[y[4]||(y[4]=e("span",null,"查詢日期:",-1)),e("div",lB,[P(e("select",{id:"year","onUpdate:modelValue":y[0]||(y[0]=r=>h.value=r),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(g,["enter"])},[y[2]||(y[2]=e("option",{value:""},"請選擇年",-1)),(t(!0),s(X,null,le(U.value,r=>(t(),s("option",{key:r,value:r},l(r)+"年 ",9,nB))),128))],544),[[Pe,h.value]])]),e("div",rB,[P(e("select",{id:"month","onUpdate:modelValue":y[1]||(y[1]=r=>d.value=r),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ue(g,["enter"])},[y[3]||(y[3]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(X,null,le(T.value,r=>(t(),s("option",{key:r,value:r},l(r)+"月 ",9,iB))),128))],544),[[Pe,d.value]])]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:g,disabled:u.value||!h.value&&d.value,"aria-label":"查詢每月諮詢管道統計"}," 搜尋 ",8,dB),e("button",{class:"px-4 py-2 bg-gray-200 hover:bg-gray-300",onClick:z,"aria-label":"重置查詢條件"}," 重置 "),y[5]||(y[5]=e("div",{class:"flex-grow"},null,-1)),o.value&&o.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:Z}," 匯出 Excel ")):G("",!0)])]),e("div",uB,[u.value?(t(),s("div",cB,y[6]||(y[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",pB,[y[9]||(y[9]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",rowspan:"2",scope:"col"},"序號"),e("th",{class:"border p-2 text-center",rowspan:"2",scope:"col"},"問題類別"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"Email"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"電話"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"官方Line")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數")])],-1)),e("tbody",null,[(t(!0),s(X,null,le(C.value,(r,b)=>(t(),s("tr",{key:b},[e("td",vB,l(r.item_no),1),e("td",mB,l(r.category),1),e("td",bB,l(r.email_month),1),e("td",fB,l(r.email_total),1),e("td",yB,l(r.phone_month),1),e("td",gB,l(r.phone_total),1),e("td",xB,l(r.line_month),1),e("td",hB,l(r.line_total),1)]))),128)),e("tr",wB,[y[7]||(y[7]=e("td",{class:"border p-2 text-center",colspan:"2"},"總計",-1)),e("td",_B,l(E.value.email_month),1),e("td",kB,l(E.value.email_total),1),e("td",$B,l(E.value.phone_month),1),e("td",CB,l(E.value.phone_total),1),e("td",EB,l(E.value.line_month),1),e("td",SB,l(E.value.line_total),1)]),C.value.length===0?(t(),s("tr",DB,y[8]||(y[8]=[e("td",{colspan:8,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):G("",!0)])]))])]))}},AB=Fe(MB,[["__scopeId","data-v-54bcbe2f"]]),IB={class:"flex flex-col items-center p-6"},RB={class:"w-full max-w-[1500px]"},PB={class:"w-full max-w-[1500px]"},UB={class:"flex border-b border-gray-300"},NB={class:"w-full max-w-[1500px] mt-6"},TB={key:0},VB={class:"mb-4"},jB=["value"],LB={key:1},FB={class:"mb-4"},OB=["value"],qB={key:2},BB={class:"mb-4"},HB=["value"],WB={key:3},zB={class:"mb-4"},KB=["value"],JB={__name:"StatisticalReports",setup(M){const h=rt(),d=We(),u=m({reportAllRead:!1}),C=m("courseManagement"),o=m("CreditCourseCount"),N=m("AgencyParticipants"),K=m("FundingAllocationStats"),E=m("ConsultationTypeStats"),U=[{label:"開課數量統計表(學分班)",value:"CreditCourseCount",component:Dj},{label:"開課數量統計表(職能班)",value:"VocationalCourseCount",component:Hj},{label:"學分班課程參訓人數統計表",value:"CreditCourseParticipants",component:dL},{label:"職能班課程參訓人數統計表",value:"VocationalCourseParticipants",component:DL},{label:"學分班課程開班數量(平日班)統計表",value:"CreditWeekdayClassCount",component:AF},{label:"學分班課程開班數量(假日班)統計表",value:"CreditWeekendClassCount",component:YF},{label:"職能班課程開班數量統計表",value:"VocationalClassCount",component:mO}],T=[{label:"機關參訓人數統計表",value:"AgencyParticipants",component:ZL},{label:"學員參加課程統計表",value:"StudentCourseParticipation",component:NO},{label:"學員資安職能證書完成人數統計表",value:"StudentSecurityCertificateCount",component:ZO},{label:"學員進度追蹤統計表",value:"StudentProgressStats",component:uq}],z=[{label:"經費核撥統計表",value:"FundingAllocationStats",component:sB}],g=[{label:"諮詢問題類型及服務人數統計表",value:"ConsultationTypeStats",component:cF},{label:"每月諮詢方式統計表",value:"MonthlyConsultationMethodStats",component:AB}];Ee(()=>C.value,r=>{const b={tab:r};r==="courseManagement"?b.courseReport=o.value:r==="studentManagement"?b.studentReport=N.value:r==="allocationOperations"?b.allocationOperationsReport=K.value:r==="consultationServices"&&(b.consultationReport=E.value),d.replace({query:b})});const a=async()=>{var r;try{const b=await ot.getSidebarPermissions();b.data.code===0&&b.data.message==="success"?(u.value=b.data.data,u.value.reportAllRead||(console.log("無權限訪問統計報表頁面，導航到首頁。"),d.replace("/"))):(console.error("獲取權限失敗:",((r=b.data)==null?void 0:r.message)||"未知錯誤"),d.replace("/"))}catch(b){console.error("獲取權限錯誤:",b),d.replace("/")}};je(()=>{a();let r={};const b=["courseManagement","studentManagement","allocationOperations","consultationServices"];h.query.tab&&b.includes(h.query.tab)?C.value=h.query.tab:(C.value="courseManagement",r.tab="courseManagement"),C.value==="courseManagement"?y("courseReport",o,U,r,"CreditCourseCount"):C.value==="studentManagement"?y("studentReport",N,T,r,"AgencyParticipants"):C.value==="consultationServices"&&y("consultationReport",E,g,r,"ConsultationTypeStats"),(Object.keys(r).length>0||!h.query.tab)&&d.replace({query:r})}),Ee(()=>o.value,r=>{d.replace({query:{...h.query,courseReport:r}})}),Ee(()=>N.value,r=>{d.replace({query:{...h.query,studentReport:r}})}),Ee(()=>K.value,r=>{d.replace({query:{...h.query,allocationOperationsReport:r}})}),Ee(()=>E.value,r=>{d.replace({query:{...h.query,consultationReport:r}})});const R=Se(()=>{const r=U.find(b=>b.value===o.value);return r?r.component:null}),Z=Se(()=>{const r=T.find(b=>b.value===N.value);return r?r.component:null}),$=Se(()=>{const r=z.find(b=>b.value===K.value);return r?r.component:null}),c=Se(()=>{const r=g.find(b=>b.value===E.value);return r?r.component:null}),y=(r,b,p,_,f)=>{if(h.query[r]){const V=h.query[r];p.some(W=>W.value===V)?b.value=V:(b.value=f,_[r]=f)}else _[r]=b.value};return(r,b)=>(t(),s("div",IB,[e("div",RB,[Ge(ft,{breadcrumbs:[{name:"統計報表",path:"/statistical-reports"}]})]),e("div",PB,[e("div",UB,[e("button",{class:ee(["py-2 px-4 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="courseManagement","text-gray-600 hover:text-gray-800":C.value!=="courseManagement"}]),onClick:b[0]||(b[0]=p=>C.value="courseManagement")}," 課程管理 ",2),e("button",{class:ee(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="studentManagement","text-gray-600 hover:text-gray-800":C.value!=="studentManagement"}]),onClick:b[1]||(b[1]=p=>C.value="studentManagement")}," 學員管理 ",2),e("button",{class:ee(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="allocationOperations","text-gray-600 hover:text-gray-800":C.value!=="allocationOperations"}]),onClick:b[2]||(b[2]=p=>C.value="allocationOperations")}," 核撥作業 ",2),e("button",{class:ee(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="consultationServices","text-gray-600 hover:text-gray-800":C.value!=="consultationServices"}]),onClick:b[3]||(b[3]=p=>C.value="consultationServices")}," 諮詢服務 ",2)])]),e("div",NB,[C.value==="courseManagement"?(t(),s("div",TB,[e("div",VB,[b[8]||(b[8]=e("label",{for:"courseReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),P(e("select",{id:"courseReportSelect","onUpdate:modelValue":b[4]||(b[4]=p=>o.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(X,null,le(U,p=>e("option",{key:p.value,value:p.value},l(p.label),9,jB)),64))],512),[[Pe,o.value]])]),R.value?(t(),ps(Ns(R.value),{key:0})):G("",!0)])):G("",!0),C.value==="studentManagement"?(t(),s("div",LB,[e("div",FB,[b[9]||(b[9]=e("label",{for:"studentReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),P(e("select",{id:"studentReportSelect","onUpdate:modelValue":b[5]||(b[5]=p=>N.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(X,null,le(T,p=>e("option",{key:p.value,value:p.value},l(p.label),9,OB)),64))],512),[[Pe,N.value]])]),Z.value?(t(),ps(Ns(Z.value),{key:0})):G("",!0)])):G("",!0),C.value==="allocationOperations"?(t(),s("div",qB,[e("div",BB,[b[10]||(b[10]=e("label",{for:"allocationOperationsReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),P(e("select",{id:"allocationOperationsReportSelect","onUpdate:modelValue":b[6]||(b[6]=p=>K.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(X,null,le(z,p=>e("option",{key:p.value,value:p.value},l(p.label),9,HB)),64))],512),[[Pe,K.value]])]),$.value?(t(),ps(Ns($.value),{key:0})):G("",!0)])):G("",!0),C.value==="consultationServices"?(t(),s("div",WB,[e("div",zB,[b[11]||(b[11]=e("label",{for:"consultationReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),P(e("select",{id:"consultationReportSelect","onUpdate:modelValue":b[7]||(b[7]=p=>E.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(X,null,le(g,p=>e("option",{key:p.value,value:p.value},l(p.label),9,KB)),64))],512),[[Pe,E.value]])]),c.value?(t(),ps(Ns(c.value),{key:0})):G("",!0)])):G("",!0)])]))}},YB=Fe(JB,[["__scopeId","data-v-bb01fd60"]]),GB={class:"flex flex-col items-center p-6"},ZB={class:"w-full max-w-[1500px] flex justify-between items-center"},QB={class:"w-full max-w-[1500px] flex justify-end mb-6"},XB={class:"space-x-4"},eH=["aria-label"],tH={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},sH={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},aH={class:"space-y-6"},oH={class:"flex items-center"},lH={class:"flex items-center"},nH=["disabled"],rH={class:"flex items-center"},iH=["disabled"],dH={class:"flex items-center"},uH=["label"],cH=["value"],pH=["value"],vH={class:"flex items-center"},mH=["readonly"],bH={class:"flex items-center"},fH=["readonly"],yH={class:"flex items-center"},gH={class:"w-32",for:"completionDate"},xH=["readonly","placeholder"],hH={class:"flex items-center"},wH=["readonly"],_H={class:"flex items-center"},kH=["readonly"],$H={class:"flex items-center"},CH=["readonly"],EH={class:"flex items-center"},SH=["readonly"],DH={class:"flex items-center"},MH=["readonly"],AH={__name:"CreditsEdit",setup(M){const h=We(),d=rt(),u=m(!1),C=m(!1),o=m(1),N=m({id:0,certificateNumber:"",courseSubjectId:null,subjectName:"",traingUnit:"",trainingPeriod:"",CompletionDate:"",referenceDate:"",credit:0,grade:null}),K=m([]),E=m([]),U=Se({get:()=>{for(const H of K.value){const k=H.items.find(D=>D.id===N.value.courseSubjectId);if(k)return k}return null},set:H=>{N.value.courseSubjectId=H?H.id:null}}),T=Se(()=>{if(!K.value||K.value.length===0||!N.value.courseSubjectId)return"缺";for(const H of K.value){const k=H.items.find(D=>D.id===N.value.courseSubjectId);if(k)return k.name}return"缺"}),z=m({}),g=Se(()=>o.value===1?"有效時間":"完訓時間"),a=Se(()=>o.value===1?"例：113/04/10":"例：113/04/30"),R=Se(()=>{const H=N.value.CompletionDate;if(!H)return!1;const k=H.split("/");if(k.length!==3)return!1;const D=parseInt(k[0])+1911,j=parseInt(k[1])-1,S=parseInt(k[2]),x=new Date(D,j,S),L=new Date;return x.setHours(0,0,0,0),L.setHours(0,0,0,0),x.getTime()<L.getTime()}),Z=Se(()=>{const H=d.query.studentId;let k=[];if(H)switch(d.query.originalFrom){case"information":k=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:`/student/single/${H}`},{name:"認列編輯",path:""}];break;case"history":k=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${H}`},{name:"認列編輯",path:""}];break;case"courseEdit":k=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${H}`},{name:"認列編輯",path:""}];break;default:k=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${H}`},{name:"認列編輯",path:""}]}else k=[{name:"學員管理",path:"/student/information"},{name:"認列編輯",path:""}];return k}),$=()=>{if(d.query.studentId){const H=d.query.originalFrom;console.log("CreditsEdit 返回 Single 頁面，原始來源:",H),d.query.courseId,d.query.page,["year","school","course","agency","area","searchKeyword","month","sortBy","sortOrder"].forEach(k=>{d.query[k]&&d.query[k]}),h.back()}else h.back()},c=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&r():(z.value=JSON.parse(JSON.stringify(N.value)),u.value=!0)},y=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&b()},r=()=>{p(N.value)},b=()=>{N.value=JSON.parse(JSON.stringify(z.value)),u.value=!1},p=async H=>{try{C.value=!0,console.log("準備保存學分資料:",H);const k={id:H.id,certificateNumber:H.certificateNumber,courseSubjectId:H.courseSubjectId,subjectName:H.subjectName,traingUnit:H.traingUnit,trainingPeriod:H.trainingPeriod,CompletionDate:H.CompletionDate,referenceDate:H.referenceDate,credit:parseFloat(H.credit),category:o.value,grade:H.grade},D=await Lt.updateCreditCertification(H.id,k);D.data.code===0?(v.showSuccess("儲存成功","學分資料已成功儲存"),_()):(v.showError("儲存失敗",D.data.message||"儲存學分資料失敗"),console.error("儲存學分資料失敗:",D.data.message))}catch(k){console.error("儲存學分資料錯誤:",k),v.showError("儲存失敗","儲存學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},_=async()=>{try{C.value=!0;const H=d.params.id;if(!H){console.error("未提供學習歷史ID");return}const k=await Lt.getCreditCertificationById(H);if(console.log("API 回應:",k.data),!k.data.data){console.error("API 回應格式錯誤:",k.data),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試");return}const D=k.data.data;N.value={id:H,certificateNumber:D.certificateNumber||"",courseSubjectId:D.courseSubjectId||null,subjectName:D.subjectName||"",traingUnit:D.traingUnit||"",trainingPeriod:D.trainingPeriod||"",CompletionDate:D.CompletionDate||"",referenceDate:D.referenceDate||"",credit:D.credit||0,category:D.category||1,grade:D.grade||null},o.value=N.value.category,W(),z.value=JSON.parse(JSON.stringify(N.value)),u.value=!1,console.log("獲取到的學分資料:",N.value)}catch(H){console.error("獲取學分資料錯誤:",H),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},f=async()=>{try{const H=await nt.getCourseSubjects();H.data.code===0&&H.data.data?(K.value=H.data.data,console.log("獲取到的科目選項:",K.value),V(o.value)):v.showError("載入失敗",H.data.message||"獲取科目選項失敗")}catch(H){console.error("獲取科目選項錯誤:",H),v.showError("載入錯誤","獲取科目選項時發生錯誤")}},V=H=>{E.value=K.value.map(D=>{const j=D.items.filter(S=>H===1&&S.isCyberSecClass||H===2&&!S.isCyberSecClass);return{...D,items:j}}).filter(D=>D.items.length>0);const k=E.value.flatMap(D=>D.items);U.value&&!k.some(D=>D.id===U.value.id)&&(U.value=null)},W=()=>{const H=N.value.trainingPeriod,k=o.value;if(!H){N.value.CompletionDate="";return}const D=H.split("-");let j="";D.length===2?j=D[1].trim():j=H.trim();const S=j.split("/");if(S.length!==3){N.value.CompletionDate="";return}const x=parseInt(S[0])+1911,L=parseInt(S[1])-1,de=parseInt(S[2]);let xe=new Date(x,L,de);k===1?xe.setFullYear(xe.getFullYear()+5):k===2&&xe.setFullYear(xe.getFullYear()+10);const fe=xe.getFullYear()-1911,ke=(xe.getMonth()+1).toString().padStart(2,"0"),De=xe.getDate().toString().padStart(2,"0");N.value.CompletionDate=`${fe}/${ke}/${De}`};return Ee([o,()=>N.value.trainingPeriod],([H])=>{V(H),W()}),je(async()=>{await f(),_()}),(H,k)=>(t(),s("div",GB,[e("div",ZB,[Ge(ft,{breadcrumbs:Z.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:$,"aria-label":"返回上一頁"},k[11]||(k[11]=[e("span",{class:"mr-2"},"←",-1),me(" 回上一頁 ")]))]),k[27]||(k[27]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",QB,[e("div",XB,[u.value?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:y,"aria-label":"取消編輯"}," 取消 ")):G("",!0),e("button",{class:ee(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:c,"aria-label":u.value?"儲存編輯內容":"開始編輯內容"},l(u.value?"儲存":"內容編輯"),11,eH)])]),C.value?(t(),s("div",tH,k[12]||(k[12]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",sH,[e("div",aH,[e("div",oH,[k[15]||(k[15]=e("label",{class:"w-28",for:"course-type"},"課程類別:",-1)),e("div",{class:ee(["flex items-center space-x-4",u.value?"":"input-display-readonly"])},[e("label",lH,[P(e("input",{id:"course-type-1",type:"radio","onUpdate:modelValue":k[0]||(k[0]=D=>o.value=D),value:1,class:"w-4 h-4 mr-1",disabled:!u.value},null,8,nH),[[bt,o.value]]),k[13]||(k[13]=e("span",null,"資安職能認列學分數",-1))]),e("label",rH,[P(e("input",{id:"course-type-2",type:"radio","onUpdate:modelValue":k[1]||(k[1]=D=>o.value=D),value:2,class:"w-4 h-4 mr-1",disabled:!u.value},null,8,iH),[[bt,o.value]]),k[14]||(k[14]=e("span",null,"資訊課程認列學分數",-1))])],2)]),e("div",dH,[k[17]||(k[17]=e("label",{class:"w-32",for:"courseSubject"},"科目名稱:",-1)),u.value?P((t(),s("select",{key:0,id:"courseSubject",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[2]||(k[2]=D=>U.value=D)},[k[16]||(k[16]=e("option",{value:null},"請選擇科目",-1)),(t(!0),s(X,null,le(E.value,D=>(t(),s("optgroup",{key:D.name,label:D.name},[(t(!0),s(X,null,le(D.items,j=>(t(),s("option",{key:j.id,value:j},l(j.name),9,cH))),128))],8,uH))),128))],2)),[[Pe,U.value]]):(t(),s("input",{key:1,id:"courseSubject-display",type:"text",class:"p-2 outline-none w-60 border border-gray-300",value:T.value,readonly:"","aria-labelledby":"courseSubject"},null,8,pH))]),e("div",vH,[k[18]||(k[18]=e("label",{class:"w-32",for:"subjectName"},"課程名稱:",-1)),P(e("input",{id:"subjectName",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[3]||(k[3]=D=>N.value.subjectName=D),readonly:!u.value,placeholder:"請輸入課程名稱"},null,10,mH),[[te,N.value.subjectName]]),k[19]||(k[19]=e("div",{class:"text-gray-500 text-sm ml-2"},"(學分班近10年或職能班近5年進修科目相同之訓練課程)",-1))]),e("div",bH,[k[20]||(k[20]=e("label",{class:"w-32",for:"traingUnit"},"完訓學校:",-1)),P(e("input",{id:"traingUnit",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[4]||(k[4]=D=>N.value.traingUnit=D),readonly:!u.value,placeholder:"請輸入完訓學校"},null,10,fH),[[te,N.value.traingUnit]])]),e("div",yH,[e("label",gH,l(g.value)+":",1),P(e("input",{id:"completionDate",type:"text",class:ee(["p-2 outline-none w-60 border",[u.value?"border-[#4e9875]":"border-gray-300",{"text-red-500":R.value&&!u.value}]]),"onUpdate:modelValue":k[5]||(k[5]=D=>N.value.CompletionDate=D),readonly:!u.value,placeholder:a.value},null,10,xH),[[te,N.value.CompletionDate]])]),e("div",hH,[k[21]||(k[21]=e("label",{class:"w-32",for:"trainingPeriod"},"訓練起訖時間:",-1)),P(e("input",{id:"trainingPeriod",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[6]||(k[6]=D=>N.value.trainingPeriod=D),readonly:!u.value,placeholder:"例：112/03/01-112/03/31"},null,10,wH),[[te,N.value.trainingPeriod]])]),e("div",_H,[k[22]||(k[22]=e("label",{class:"w-32",for:"referenceDate"},"參照日期起訖:",-1)),P(e("input",{id:"referenceDate",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[7]||(k[7]=D=>N.value.referenceDate=D),readonly:!u.value,placeholder:"例：113/04/01-113/04/30"},null,10,kH),[[te,N.value.referenceDate]]),k[23]||(k[23]=e("div",{class:"text-gray-500 text-sm ml-2"},"(評量效期)",-1))]),e("div",$H,[k[24]||(k[24]=e("label",{class:"w-32",for:"credit"},"學分數:",-1)),P(e("input",{id:"credit",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[8]||(k[8]=D=>N.value.credit=D),readonly:!u.value,placeholder:"請輸入學分數"},null,10,CH),[[te,N.value.credit]])]),e("div",EH,[k[25]||(k[25]=e("label",{class:"w-32",for:"grade"},"成績:",-1)),P(e("input",{id:"grade",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[9]||(k[9]=D=>N.value.grade=D),readonly:!u.value,placeholder:"請輸入成績"},null,10,SH),[[te,N.value.grade]])]),e("div",DH,[k[26]||(k[26]=e("label",{class:"w-32",for:"certificateNumber"},"證書編號:",-1)),P(e("input",{id:"certificateNumber",type:"text",class:ee(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":k[10]||(k[10]=D=>N.value.certificateNumber=D),readonly:!u.value},null,10,MH),[[te,N.value.certificateNumber]])])])]))]))}},IH=Fe(AH,[["__scopeId","data-v-5df3547e"]]),RH=[{path:"/",redirect:"/course"},{path:"/login",name:"Login",component:wa,meta:{requiresAuth:!1}},{path:"/initial/:id",name:"InitialReview",component:cl},{path:"/search",name:"SearchList",component:Pn},{path:"/course",name:"Course",component:Ni},{path:"/attendance",name:"Attendance",component:dd},{path:"/supervision",name:"Supervision",component:Su},{path:"/student/single/:id",name:"Single",component:xp},{path:"/student/information",name:"Information",component:Gv},{path:"/history",name:"History",component:Xm},{path:"/credits",name:"Credits",component:Cb},{path:"/expense",name:"Expense",component:nf},{path:"/management",name:"Management",component:C1},{path:"/question-management",name:"QuestionManagement",component:Zg},{path:"/roles",name:"Roles",component:Y0},{path:"/unauthorized",name:"Unauthorized",component:Z0,meta:{requiresAuth:!0}},{path:"/course-edit/:id",name:"CourseEdit",component:E2},{path:"/student/add",name:"Add",component:Y2},{path:"/student/single-edit/:id",name:"SingleEdit",component:vh},{path:"/student/credits-edit/:id",name:"CreditsEdit",component:IH},{path:"/board",name:"Dashboard",component:yh},{path:"/checklist",name:"Checklist",component:o_},{path:"/checklist-edit",name:"ChecklistEdit",component:l4},{path:"/credit-list",name:"CreditList",component:_C},{path:"/expense-list",name:"ExpenseList",component:a6},{path:"/grant-application",name:"GrantApplication",component:N7},{path:"/grant-application-edit",name:"GrantApplicationEdit",component:F9},{path:"/remittance",name:"Remittance",component:iD},{path:"/remittance-edit",name:"RemittanceEdit",component:zD},{path:"/role-permissions",name:"RolePermissions",component:$M},{path:"/permission-settings",name:"PermissionSettings",component:hR},{path:"/log-list",name:"LogList",component:BP},{path:"/add-course-student",name:"AddCourseStudent",component:PU},{path:"/file-management",name:"FileManagement",component:DT},{path:"/password",name:"Password",component:OT},{path:"/database",name:"Database",component:MV},{path:"/agency",name:"Agency",component:pj},{path:"/statistical-reports",name:"StatisticalReports",component:YB}],Ps=ta({history:sa(),routes:RH}),Us={"/search":{main:"reviewManagement",read:"reviewManagementRead"},"/course":{main:"courseManagement",read:"courseDataRead"},"/course-edit":{main:"courseManagement",read:"courseDataRead"},"/supervision":{main:"courseManagement",read:"visitRead"},"/survey":{main:"courseManagement",read:"satisfactionRead"},"/supervision-edit":{main:"courseManagement",read:"visitRead"},"/checklist":{main:"courseManagement",read:"visitRead"},"/checklist-edit":{main:"courseManagement",read:"visitRead"},"/student/information":{main:"studentManagement",read:"studentRead"},"/student/single":{main:"studentManagement",read:"studentRead"},"/student/single-edit":{main:"studentManagement",read:"studentRead"},"/student/credits-edit":{main:"studentManagement",read:"creditCertificationRead"},"/history":{main:"studentManagement",read:"learningHistory"},"/credits":{main:"studentManagement",read:"creditCertificationRead"},"/student/add":{main:"studentManagement",read:"studentRead"},"/credit-list":{main:"studentManagement",read:"creditCertificationRead"},"/agency":{main:"studentManagement",read:"studentRead"},"/expense":{main:"verificationManagement",read:"verificationRead"},"/expense-list":{main:"verificationManagement",read:"verificationRead"},"/grant-application":{main:"verificationManagement",read:"verificationRead"},"/grant-application-edit":{main:"verificationManagement",read:"verificationRead"},"/remittance":{main:"verificationManagement",read:"verificationRead"},"/remittance-edit":{main:"verificationManagement",read:"verificationRead"},"/management":{main:"performanceTracking",read:"performanceTrackingRead"},"/question-management":{main:"consultationService",read:"consultationRead"},"/board":{main:"dashboard",read:null},"/file-management":{main:"tool",read:"fileManager"},"/roles":{main:"systemManagement",read:"userRead"},"/role-permissions":{main:"systemManagement",read:"roleRead"},"/permission-settings":{main:"systemManagement",read:"roleRead"},"/log-list":{main:"systemManagement",read:"systemLogRead"},"/database":{main:"systemManagement",read:"dataBaseRead"},"/password":{main:"systemManagement",read:"userRead"},"/statistical-reports":{main:"reportAllRead",read:null}};let hs=null,As=null;const PH=async()=>hs||As||(As=new Promise(M=>{ot.getSidebarPermissions().then(h=>{h.data.code===0&&h.data.message==="success"?(hs=h.data.data,document.dispatchEvent(new CustomEvent("permissions_updated",{detail:hs})),M(hs)):M(null)}).catch(h=>{console.error("獲取權限失敗:",h),M(null)}).finally(()=>{setTimeout(()=>{As=null},200)})}),As),UH=()=>{hs=null},NH=M=>["/login","/unauthorized"].includes(M),TH=(M,h,d)=>M.isNeedChangePwd===!0&&h!=="/password"?(d("/password"),!0):!1,VH=(M,h,d)=>h.specialCase&&h.main==="isNeedChangePwd"?M.isNeedChangePwd===!0||M.systemManagement&&M.userRead?(d(),!0):(d("/unauthorized"),!0):!1,jH=(M,h,d)=>h?M[h.main]===!0?h.read&&M[h.read]!==!0?(console.log(`用戶有主權限 ${h.main} 但缺少讀取權限 ${h.read}`),d("/unauthorized"),!0):!1:(d("/unauthorized"),!0):!1;Ps.beforeEach(async(M,h,d)=>{if(NH(M.path)){d();return}if(!localStorage.getItem("token")){d("/login");return}const C=await PH();if(!C){d("/unauthorized");return}if(TH(C,M.path,d))return;if(M.path==="/password"&&C.isNeedChangePwd===!0){d();return}const o=LH(M.path);VH(C,o||{},d)||jH(C,o,d)||d()});function LH(M){for(const h in Us)if(M.startsWith(h))return Us[h];return null}function FH(M){if(!M)return null;const h=[{key:"courseManagement",path:"/course"},{key:"studentManagement",path:"/student/information"},{key:"verificationManagement",path:"/expense-list"},{key:"reviewManagement",path:"/search"},{key:"performanceTracking",path:"/management"},{key:"consultationService",path:"/question-management"},{key:"dashboard",path:"/board"},{key:"systemManagement",path:"/roles"},{key:"tool",path:"/file-management"}];for(const d of h)if(M[d.key]){const u=Us[d.path];if(!u)continue;if(!u.read||M[u.read])return d.path}for(const[d,u]of Object.entries(Us)){const C=M[u.main],o=!u.read||M[u.read];if(C&&o)return d}return null}Ps.options.getFirstAvailablePath=FH;const OH={class:"w-full fixed top-0 left-0 z-50"},qH={class:"border-b bg-[#EEEFE7] flex justify-between items-center"},BH={class:"flex-1 flex justify-center"},HH={class:"flex"},WH=["onMouseenter"],zH={key:0,class:"absolute left-0 w-48 bg-[#F7F7F7] shadow-lg z-50"},KH={key:0,class:"ml-2 text-gray-400"},JH={key:0,class:"absolute left-full top-0 w-48 bg-[#F7F7F7] shadow-lg hidden group-hover/sub:block"},YH={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},GH={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},ZH={class:"flex flex-col"},QH={class:"flex flex-col"},XH={class:"flex flex-col"},eW={class:"flex flex-col"},tW={class:"flex flex-col"},sW={class:"flex justify-end space-x-2 mt-6"},aW=["disabled"],oW={__name:"Header",setup(M){const h=rt();We();const d=m(null),u=m({reviewManagement:!1,reviewManagementRead:!1,reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementImport:!1,courseManagement:!1,courseDataCreate:!1,courseDataUpdate:!1,courseDataDelete:!1,courseDataImport:!1,courseDataExport:!1,courseDataRead:!1,visitCreate:!1,visitUpdate:!1,visitExport:!1,visitRead:!1,satisfactionSurveyImport:!1,satisfactionRead:!1,studentManagement:!1,studentCreate:!1,studentUpdate:!1,studentDelete:!1,studentImport:!1,studentExport:!1,studentRead:!1,learningHistory:!1,creditCertificationImport:!1,creditCertificationCreate:!1,creditCertificationRead:!1,verificationManagement:!1,verificationCreate:!1,verificationUpdate:!1,verificationExport:!1,verificationRead:!1,performanceTracking:!1,performanceTrackingRead:!1,performanceTrackingEdit:!1,consultationService:!1,consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationRead:!1,consultationReadDetail:!1,consultationImport:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryUpdate:!1,consultationCategoryDelete:!1,systemManagement:!1,userCreate:!1,userUpdate:!1,userDelete:!1,userRead:!1,roleCreate:!1,roleUpdate:!1,roleDelete:!1,roleRead:!1,systemLogRead:!1,systemLogExport:!1,dataBaseRead:!1,dataBaseExport:!1,dashboard:!1,tool:!1,fileManager:!1,fileManagerCreate:!1,fileManagerUpload:!1,fileManageDelete:!1}),C=m(!1),o=m(!1),N=m({id:null,name:"",unit:"",title:"",account:"",password:""}),K=async()=>{try{const $=await js.logout();$.data.code===0&&$.data.message==="success"?(E(),v.showSuccess("登出成功","您已成功登出系統"),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1e3)):(console.error("登出失敗:",$.data.message),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"))}catch($){console.error("登出錯誤:",$),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"),E(),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1500)}},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach($=>{$.startsWith("app_")&&localStorage.removeItem($)}),sessionStorage.clear(),u.value={reviewManagement:!1,reviewManagementRead:!1,reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementImport:!1,courseManagement:!1,courseDataCreate:!1,courseDataUpdate:!1,courseDataDelete:!1,courseDataImport:!1,courseDataExport:!1,courseDataRead:!1,visitCreate:!1,visitUpdate:!1,visitExport:!1,visitRead:!1,satisfactionSurveyImport:!1,satisfactionRead:!1,studentManagement:!1,studentCreate:!1,studentUpdate:!1,studentDelete:!1,studentImport:!1,studentExport:!1,studentRead:!1,learningHistory:!1,creditCertificationImport:!1,creditCertificationCreate:!1,creditCertificationRead:!1,verificationManagement:!1,verificationCreate:!1,verificationUpdate:!1,verificationExport:!1,verificationRead:!1,performanceTracking:!1,performanceTrackingRead:!1,performanceTrackingEdit:!1,consultationService:!1,consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationRead:!1,consultationReadDetail:!1,consultationImport:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryUpdate:!1,consultationCategoryDelete:!1,systemManagement:!1,userCreate:!1,userUpdate:!1,userDelete:!1,userRead:!1,roleCreate:!1,roleUpdate:!1,roleDelete:!1,roleRead:!1,systemLogRead:!1,systemLogExport:!1,dataBaseRead:!1,dataBaseExport:!1,dashboard:!1,tool:!1,fileManager:!1,fileManagerCreate:!1,fileManagerUpload:!1,fileManageDelete:!1,agencyRead:!1,agencyCreate:!1,agencyUpdate:!1,agencyDelete:!1,reportAllRead:!1}},U=$=>{$.detail&&(u.value=$.detail,console.log("權限數據已從路由守衛更新"))},T=[{name:"開課計畫審查",permissionKey:"reviewManagement",path:"/search"},{name:"課程管理",permissionKey:"courseManagement",children:[{name:"課程內容",path:"/course",permissionKey:"courseDataRead"},{name:"訪視督課",path:"/supervision",permissionKey:"visitRead"}]},{name:"學員管理",permissionKey:"studentManagement",children:[{name:"學員資料",path:"/student/information",permissionKey:"studentRead"},{name:"學習歷程",path:"/history",permissionKey:"learningHistory"},{name:"學分認列",path:"/credit-list",permissionKey:"creditCertificationRead"}]},{name:"核撥作業",permissionKey:"verificationManagement",path:"/expense-list"},{name:"追蹤成效",permissionKey:"performanceTracking",path:"/management"},{name:"諮詢服務",permissionKey:"consultationService",path:"/question-management"},{name:"統計報表",permissionKey:"reportAllRead",path:"/statistical-reports"},{name:"儀表板",permissionKey:"dashboard",path:"/board"},{name:"工具",permissionKey:"tool",path:"/file-management"},{name:"系統管理",permissionKey:"systemManagement",children:[{name:"使用者管理",path:"/roles",permissionKey:"userRead"},{name:"角色管理",path:"/role-permissions",permissionKey:"roleRead"},{name:"系統日誌",path:"/log-list",permissionKey:"systemLogRead"},{name:"資料庫管理",path:"/database",permissionKey:"dataBaseRead"}]}],z=Se(()=>JSON.parse(JSON.stringify(T)).filter(c=>{if(c.permissionKey&&!u.value[c.permissionKey])return!1;if(c.children&&c.children.length>0){if(c.children=c.children.filter(y=>y.permissionKey&&u.value[y.permissionKey]===!0),c.permissionKey&&u.value[c.permissionKey]&&c.children.length===0)return!1}else if(c.path){const y=Us[c.path];if(!y)return!1;const r=u.value[y.main]===!0,b=!y.read||u.value[y.read]===!0;return r&&b}return!0})),g=$=>d.value===$||h.path.startsWith("/"+$.toLowerCase());je(()=>{document.addEventListener("permissions_updated",U),document.addEventListener("user_login_success",a),setTimeout(()=>{Object.keys(u.value).length===0&&(console.log("路由守衛未提供權限數據，Header組件主動獲取"),fetchSidebarPermissions())},100)});const a=()=>{console.log("檢測到用戶登入成功，重新獲取權限"),fetchSidebarPermissions()};aa(()=>{document.removeEventListener("permissions_updated",U),document.removeEventListener("user_login_success",a)});const R=async()=>{try{const $=await is.getProfile();if($.data.code===0&&$.data.message==="success"){const c=$.data.data;N.value={id:c.id,name:c.name,unit:c.unit,title:c.title,account:c.account,password:""}}}catch($){console.error("獲取個人資料錯誤:",$)}C.value=!0},Z=async()=>{if(!N.value.id){v.showError("錯誤","無法獲取使用者ID，無法更新資料。");return}o.value=!0;try{const $={id:N.value.id,account:N.value.account};N.value.password&&($.password=N.value.password);const c=await is.updateProfile(N.value.id,$);c.data.code===0&&c.data.message==="success"?(v.showSuccess("更新成功","您的個人資料已更新。"),C.value=!1):v.showError("更新失敗",c.data.message||"更新個人資料時發生錯誤。")}catch($){console.error("更新個人資料錯誤:",$),v.showError("更新失敗","更新個人資料時發生錯誤，請稍後再試。")}finally{o.value=!1}};return($,c)=>{const y=Os("router-link");return t(),s("div",null,[e("header",OH,[c[7]||(c[7]=Zs('<div class="bg-[#3e4346] text-white p-2 flex justify-between items-center" data-v-b68a750a><div class="flex items-center mx-12" data-v-b68a750a><h1 class="text-2xl" data-v-b68a750a>推動政府資安人力職能轉換訓練服務</h1></div><div class="flex items-center mx-12" data-v-b68a750a><div class="flex items-center" data-v-b68a750a><img src="'+ra+'" alt="Logo" class="h-16" data-v-b68a750a><div class="ml-2" data-v-b68a750a><div class="text-lg font-bold" data-v-b68a750a>數位發展部資通安全署</div><div class="text-sm" data-v-b68a750a>Administration for Cyber Security, moda</div></div></div></div></div>',1)),e("nav",qH,[e("div",BH,[e("ul",HH,[(t(!0),s(X,null,le(z.value,(r,b)=>(t(),s("li",{key:b,class:"relative group",onMouseenter:p=>d.value=r.name,onMouseleave:c[0]||(c[0]=p=>d.value=null)},[r.children?(t(),s(X,{key:0},[e("div",{class:ee(["px-6 py-3 inline-block hover:bg-gray-100 text-center cursor-default",{"bg-[#F7F7F7]":g(r.name)}])},l(r.name),3),d.value===r.name?(t(),s("ul",zH,[(t(!0),s(X,null,le(r.children,(p,_)=>(t(),s("li",{key:_,class:"relative group/sub"},[Ge(y,{to:p.path,class:"px-4 py-2 w-full inline-flex justify-between items-center hover:bg-gray-50"},{default:Is(()=>[me(l(p.name)+" ",1),p.children?(t(),s("span",KH,"▶")):G("",!0)]),_:2},1032,["to"]),p.children?(t(),s("ul",JH,[(t(!0),s(X,null,le(p.children,(f,V)=>(t(),s("li",{key:V},[Ge(y,{to:f.path,class:"px-4 py-2 w-full inline-block hover:bg-gray-50"},{default:Is(()=>[me(l(f.name),1)]),_:2},1032,["to"])]))),128))])):G("",!0)]))),128))])):G("",!0)],64)):(t(),ps(y,{key:1,to:r.path,class:ee(["px-6 py-3 inline-block hover:bg-gray-100 text-center",{"bg-[#F7F7F7]":g(r.name)}])},{default:Is(()=>[me(l(r.name),1)]),_:2},1032,["to","class"]))],40,WH))),128))])]),e("div",{class:"mr-6 flex items-center space-x-2"},[e("button",{onClick:R,class:"px-4 py-1 my-2 bg-gray-500 text-white hover:bg-gray-600 rounded","aria-label":"開啟設定"}," 設定 "),e("button",{onClick:K,class:"px-4 py-1 my-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded"}," 登出 ")])])]),c[14]||(c[14]=e("div",{class:"h-[132px]"},null,-1)),C.value?(t(),s("div",YH,[e("div",GH,[c[13]||(c[13]=e("h3",{class:"text-xl font-bold mb-4"},"個人設定",-1)),e("form",{onSubmit:es(Z,["prevent"]),class:"space-y-4"},[e("div",ZH,[c[8]||(c[8]=e("label",{for:"settings-name",class:"mb-1"},"姓名",-1)),P(e("input",{id:"settings-name","onUpdate:modelValue":c[1]||(c[1]=r=>N.value.name=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[te,N.value.name]])]),e("div",QH,[c[9]||(c[9]=e("label",{for:"settings-unit",class:"mb-1"},"單位",-1)),P(e("input",{id:"settings-unit","onUpdate:modelValue":c[2]||(c[2]=r=>N.value.unit=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[te,N.value.unit]])]),e("div",XH,[c[10]||(c[10]=e("label",{for:"settings-title",class:"mb-1"},"職稱",-1)),P(e("input",{id:"settings-title","onUpdate:modelValue":c[3]||(c[3]=r=>N.value.title=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[te,N.value.title]])]),e("div",eW,[c[11]||(c[11]=e("label",{for:"settings-account",class:"mb-1"},"帳號",-1)),P(e("input",{id:"settings-account","onUpdate:modelValue":c[4]||(c[4]=r=>N.value.account=r),type:"text",class:"border p-2 rounded cursor-not-allowed bg-gray-100 outline-none",readonly:""},null,512),[[te,N.value.account]])]),e("div",tW,[c[12]||(c[12]=e("label",{for:"settings-password",class:"mb-1"},"新密碼",-1)),P(e("input",{id:"settings-password","onUpdate:modelValue":c[5]||(c[5]=r=>N.value.password=r),type:"password",class:"border p-2 rounded outline-none",placeholder:"不修改請留空"},null,512),[[te,N.value.password]])]),e("div",sW,[e("button",{type:"button",onClick:c[6]||(c[6]=r=>C.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:o.value},l(o.value?"更新中...":"確認更新"),9,aW)])],32)])])):G("",!0)])}}},lW=Fe(oW,[["__scopeId","data-v-b68a750a"]]),nW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},rW={class:"bg-white rounded-lg shadow-lg w-96 z-10 max-h-[90vh] overflow-y-auto"},iW={class:"bg-red-600 text-white p-4"},dW={class:"text-lg font-medium"},uW={class:"p-6"},cW={class:"flex items-start"},pW={class:"text-gray-700"},vW={__name:"ErrorModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"操作失敗"},message:{type:String,default:"操作過程中發生錯誤"}},emits:["close"],setup(M,{emit:h}){const d=h,u=()=>{d("close")};return(C,o)=>M.visible?(t(),s("div",nW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:u}),e("div",rW,[e("div",iW,[e("h3",dW,l(M.title),1)]),e("div",uW,[e("div",cW,[o[0]||(o[0]=e("svg",{class:"w-6 h-6 text-red-600 mr-3 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",pW,l(M.message),1)])]),e("div",{class:"bg-gray-50 px-4 py-3 flex justify-end"},[e("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:u}," 確定 ")])])])):G("",!0)}},mW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},bW={class:"bg-white rounded-lg shadow-lg w-96 z-10 max-h-[90vh] overflow-y-auto"},fW={class:"bg-[#4e9875] text-white p-4"},yW={class:"text-lg font-medium"},gW={class:"p-6"},xW={class:"flex items-center"},hW={class:"text-gray-700"},wW={__name:"SuccessModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"操作成功"},message:{type:String,default:"資料已成功儲存"},autoClose:{type:Boolean,default:!0},duration:{type:Number,default:3e3}},emits:["close"],setup(M,{emit:h}){const d=M,u=h,C=()=>{u("close")};let o=null;return Ee(()=>d.visible,N=>{N&&d.autoClose&&(clearTimeout(o),o=setTimeout(()=>{C()},d.duration))}),je(()=>()=>{clearTimeout(o)}),(N,K)=>M.visible?(t(),s("div",mW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:C}),e("div",bW,[e("div",fW,[e("h3",yW,l(M.title),1)]),e("div",gW,[e("div",xW,[K[0]||(K[0]=e("svg",{class:"w-6 h-6 text-[#4e9875] mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),e("p",hW,l(M.message),1)])]),e("div",{class:"bg-gray-50 px-4 py-3 flex justify-end"},[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:C}," 確定 ")])])])):G("",!0)}},_W={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},kW={class:"bg-white rounded-lg shadow-lg w-96 z-10 overflow-hidden"},$W={class:"bg-gray-700 text-white p-4"},CW={class:"text-lg font-medium"},EW={class:"p-6"},SW={class:"flex items-start"},DW={class:"text-gray-700"},MW={class:"bg-gray-50 px-4 py-3 flex justify-end space-x-3"},AW={__name:"ConfirmModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"確認操作"},message:{type:String,default:"確定要執行此操作嗎？"},confirmText:{type:String,default:"確定"},cancelText:{type:String,default:"取消"}},emits:["confirm","cancel"],setup(M,{emit:h}){const d=h,u=()=>{d("confirm")},C=()=>{d("cancel")};return(o,N)=>M.visible?(t(),s("div",_W,[N[1]||(N[1]=e("div",{class:"absolute inset-0 bg-black opacity-50"},null,-1)),e("div",kW,[e("div",$W,[e("h3",CW,l(M.title),1)]),e("div",EW,[e("div",SW,[N[0]||(N[0]=e("svg",{class:"w-6 h-6 text-yellow-500 mr-3 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",DW,l(M.message),1)])]),e("div",MW,[e("button",{class:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",onClick:C},l(M.cancelText),1),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:u},l(M.confirmText),1)])])])):G("",!0)}},IW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},RW={class:"bg-white rounded-lg shadow-lg w-96 relative z-10 max-h-[90vh] overflow-y-auto"},PW={class:"p-4 border-b border-gray-200 flex justify-between items-center"},UW={class:"text-lg font-medium text-gray-800"},NW={class:"p-4"},TW={class:"flex"},VW={class:"ml-3"},jW=["innerHTML"],LW={class:"px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse bg-gray-50 rounded-b-lg"},FW={__name:"InfoModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"信息"},message:{type:String,default:""}},emits:["close"],setup(M){return(h,d)=>M.visible?(t(),s("div",IW,[d[4]||(d[4]=e("div",{class:"fixed inset-0 bg-black opacity-50"},null,-1)),e("div",RW,[e("div",PW,[e("h3",UW,l(M.title),1),e("button",{onClick:d[0]||(d[0]=u=>h.$emit("close")),class:"text-gray-500 hover:text-gray-700"},d[2]||(d[2]=[e("span",{class:"text-xl"},"×",-1)]))]),e("div",NW,[e("div",TW,[d[3]||(d[3]=e("div",{class:"flex-shrink-0 mx-2"},[e("svg",{class:"h-6 w-6 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",VW,[e("p",{class:"text-sm text-gray-600",innerHTML:M.message},null,8,jW)])])]),e("div",LW,[e("button",{onClick:d[1]||(d[1]=u=>h.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"}," 確定 ")])])])):G("",!0)}},OW={key:0,class:"fixed inset-0 flex items-center justify-center z-[1000]"},qW={class:"bg-white rounded-lg shadow-xl p-6 w-96 relative z-10"},BW={class:"text-xl font-bold mb-4"},HW={class:"mb-6"},WW={class:"text-gray-600 mb-4"},zW=["type"],KW={__name:"PromptModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"請輸入"},message:{type:String,default:""},type:{type:String,default:"text"},value:{type:String,default:""}},emits:["confirm","cancel"],setup(M,{emit:h}){const d=M,u=h,C=m(d.value);Ee(()=>d.value,K=>{C.value=K}),Ee(()=>d.visible,K=>{K&&(C.value="")});const o=()=>{u("confirm",C.value)},N=()=>{u("cancel")};return(K,E)=>M.visible?(t(),s("div",OW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:N}),e("div",qW,[e("div",BW,l(M.title),1),e("div",HW,[e("p",WW,l(M.message),1),P(e("input",{"onUpdate:modelValue":E[0]||(E[0]=U=>C.value=U),type:M.type,class:"w-full border border-gray-300 rounded p-2 focus:outline-none focus:border-[#4e9875]",onKeyup:Ue(o,["enter"])},null,40,zW),[[oa,C.value]])]),e("div",{class:"flex justify-end space-x-2"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:N}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:o}," 確定 ")])])])):G("",!0)}},JW=Fe(KW,[["__scopeId","data-v-0082ed9e"]]),YW={__name:"GlobalModals",setup(M){const h=()=>{v.closeConfirm(),document.dispatchEvent(new CustomEvent("confirm_ok"))},d=()=>{v.closeConfirm(),document.dispatchEvent(new CustomEvent("confirm_cancel"))},u=o=>{document.dispatchEvent(new CustomEvent("prompt_confirm",{detail:o})),v.closePrompt()},C=()=>{document.dispatchEvent(new CustomEvent("prompt_cancel")),v.closePrompt()};return(o,N)=>(t(),s(X,null,[Ge(vW,{visible:St(v).errorModal.visible.value,title:St(v).errorModal.title.value,message:St(v).errorModal.message.value,onClose:N[0]||(N[0]=K=>St(v).closeError())},null,8,["visible","title","message"]),Ge(wW,{visible:St(v).successModal.visible.value,title:St(v).successModal.title.value,message:St(v).successModal.message.value,onClose:N[1]||(N[1]=K=>St(v).closeSuccess())},null,8,["visible","title","message"]),Ge(AW,{visible:St(v).confirmModal.visible.value,title:St(v).confirmModal.title.value,message:St(v).confirmModal.message.value,onConfirm:h,onCancel:d},null,8,["visible","title","message"]),Ge(FW,{visible:St(v).infoModal.visible.value,title:St(v).infoModal.title.value,message:St(v).infoModal.message.value,onClose:N[2]||(N[2]=K=>St(v).closeInfo())},null,8,["visible","title","message"]),Ge(JW,{visible:St(v).promptModal.visible.value,title:St(v).promptModal.title.value,message:St(v).promptModal.message.value,type:St(v).promptModal.type.value,value:St(v).promptModal.value.value,onConfirm:u,onCancel:C},null,8,["visible","title","message","type","value"])],64))}};class GW{constructor(){this.timeoutId=null,this.inactivityTime=1e3*60*1e3,this.isInitialized=!1}init(){this.isInitialized||(this.setupEventListeners(),this.resetTimer(),this.isInitialized=!0,console.log("自動登出服務已初始化，閒置時間設定為",this.inactivityTime/6e4,"分鐘"))}setupEventListeners(){const h=["mousedown","mousemove","keypress","scroll","touchstart"];this.resetTimerBound=this.resetTimer.bind(this),h.forEach(d=>{document.addEventListener(d,this.resetTimerBound)}),window.addEventListener("beforeunload",()=>{this.clearTimer()})}resetTimer(){this.clearTimer(),this.timeoutId=setTimeout(()=>this.logout(),this.inactivityTime)}clearTimer(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}async logout(){try{console.log("用戶閒置超過",this.inactivityTime/6e4,"分鐘，執行自動登出"),v.showInfo("自動登出","由於長時間未操作，系統已自動登出");const h=()=>{document.removeEventListener("info_close",h),this.performLogout()};document.addEventListener("info_close",h)}catch(h){console.error("自動登出錯誤:",h),this.performLogout()}}async performLogout(){try{await js.logout()}catch(h){console.error("登出 API 調用失敗:",h)}finally{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(h=>{h.startsWith("app_")&&localStorage.removeItem(h)}),sessionStorage.clear(),window.location.href="/login?reload=true&t="+new Date().getTime()}}stop(){this.clearTimer(),this.resetTimerBound&&["mousedown","mousemove","keypress","scroll","touchstart"].forEach(d=>{document.removeEventListener(d,this.resetTimerBound)}),this.isInitialized=!1,console.log("自動登出服務已停止")}}const Ts=new GW,ZW={class:"min-h-screen flex flex-col"},QW={class:"flex-1"},XW={__name:"App",setup(M){const h=rt(),d=We(),u=Se(()=>h.path==="/login"),C=Se(()=>localStorage.getItem("token")!==null),o=Se(()=>!u.value&&C.value),N=()=>{console.log("偵測到用戶登出事件，進行頁面重置"),h.path!=="/login"&&d.push("/login")};return Ee(C,K=>{K?Ts.init():Ts.stop()}),je(()=>{C.value&&Ts.init(),document.addEventListener("user_logout",N)}),la(()=>{Ts.stop(),document.removeEventListener("user_logout",N)}),(K,E)=>{const U=Os("router-view");return t(),s("div",ZW,[o.value?(t(),ps(lW,{key:0})):G("",!0),e("main",QW,[Ge(U)]),Ge(YW)])}}},ea=na(XW);ea.use(Ps);ea.mount("#app");
