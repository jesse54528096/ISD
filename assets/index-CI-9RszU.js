import{r as m,a as Gs,o as je,c as s,b as e,w as Ot,d as J,e as I,v as ee,t as l,u as We,f as t,g as Os,h as Qe,i as Rs,j as xe,F as Z,k as re,l as lt,m as Se,n as Ee,p as X,q as gs,s as Pe,x as Ne,y as ct,z as Ce,A as ls,B as xt,C as Qs,D as Zs,E as Xs,G as Ts,H as sa,I as aa,J as oa,K as la,L as na,M as ra}from"./vendor-I8ioMcur.js";(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))u(C);new MutationObserver(C=>{for(const o of C)if(o.type==="childList")for(const N of o.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&u(N)}).observe(document,{childList:!0,subtree:!0});function d(C){const o={};return C.integrity&&(o.integrity=C.integrity),C.referrerPolicy&&(o.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?o.credentials="include":C.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(C){if(C.ep)return;C.ep=!0;const o=d(C);fetch(C.href,o)}})();const ia="/ISD/assets/logo-5ffiGhVj.png",v={errorModal:{visible:m(!1),title:m("操作失敗"),message:m("")},successModal:{visible:m(!1),title:m("操作成功"),message:m("")},confirmModal:{visible:m(!1),title:m("確認"),message:m("")},infoModal:{visible:m(!1),title:m("信息"),message:m("")},promptModal:{visible:m(!1),title:m("請輸入"),message:m(""),value:m(""),type:m("text"),callback:null},showError(D,x){this.errorModal.title.value=D||"操作失敗",this.errorModal.message.value=x||"發生錯誤，請稍後再試",this.errorModal.visible.value=!0},closeError(){this.errorModal.visible.value=!1},showSuccess(D,x){this.successModal.title.value=D||"操作成功",this.successModal.message.value=x||"操作已成功完成",this.successModal.visible.value=!0},closeSuccess(){this.successModal.visible.value=!1},showConfirm(D,x){this.confirmModal.title.value=D||"確認",this.confirmModal.message.value=x||"請確認您的選擇",this.confirmModal.visible.value=!0},closeConfirm(){this.confirmModal.visible.value=!1},showInfo(D,x){this.infoModal.title.value=D||"信息",this.infoModal.message.value=x||"",this.infoModal.visible.value=!0},closeInfo(){this.infoModal.visible.value=!1,document.dispatchEvent(new CustomEvent("info_close"))},confirmAsync(D,x){return this.showConfirm(D,x),new Promise(d=>{const u=()=>{d(!0),document.removeEventListener("confirm_ok",u),document.removeEventListener("confirm_cancel",C)},C=()=>{d(!1),document.removeEventListener("confirm_ok",u),document.removeEventListener("confirm_cancel",C)};document.addEventListener("confirm_ok",u,{once:!0}),document.addEventListener("confirm_cancel",C,{once:!0})})},showPrompt(D,x,d="text"){this.promptModal.title.value=D||"請輸入",this.promptModal.message.value=x||"",this.promptModal.value.value="",this.promptModal.type.value=d,this.promptModal.visible.value=!0},confirmPrompt(D){this.promptModal.callback&&this.promptModal.callback(D),this.closePrompt()},cancelPrompt(){this.promptModal.callback&&this.promptModal.callback(null),this.closePrompt()},closePrompt(){this.promptModal.visible.value=!1,this.promptModal.value.value="",this.promptModal.callback=null},promptAsync(D,x,d="text"){return this.showPrompt(D,x,d),new Promise(u=>{this.promptModal.callback=u;const C=N=>{N.detail&&typeof N.detail=="string"?u(N.detail):u(""),document.removeEventListener("prompt_confirm",C),document.removeEventListener("prompt_cancel",o)},o=()=>{u(null),document.removeEventListener("prompt_confirm",C),document.removeEventListener("prompt_cancel",o)};document.addEventListener("prompt_confirm",C),document.addEventListener("prompt_cancel",o)})}},da="https://dev-moda.mosji.co",he=Gs.create({baseURL:da,timeout:2e4,headers:{"Content-Type":"application/json"}});let is=!1;const ea=new AbortController;he.interceptors.request.use(D=>{if(is)return Promise.reject({isLoginExpired:!0});const x=localStorage.getItem("token");if(x&&(D.headers.Authorization=`Bearer ${x}`),D.method==="get"&&D.params){const d={};Object.keys(D.params).forEach(u=>{D.params[u]!==null&&D.params[u]!==void 0&&D.params[u]!==""&&(d[u]=D.params[u])}),D.params=d}return D.signal=ea.signal,D},D=>Promise.reject(D));he.interceptors.response.use(D=>D.data&&D.data.message==="請重新登入"?(Fs(),Promise.reject({isLoginExpired:!0})):D,D=>{if(D.isLoginExpired)return Promise.reject(D);if(D.response&&D.response.status===401&&!is)return Fs(),Promise.reject({isLoginExpired:!0});if(Gs.isCancel(D))return Promise.reject({isLoginExpired:!0});if(D.response){if(D.response.data&&D.response.data.message==="請重新登入"&&!is)return Fs(),Promise.reject({isLoginExpired:!0});is||v.showError("請求失敗",D.response.data.message||"發生錯誤，請稍後再試")}else D.request&&!is?v.showError("連接失敗","無法連接到伺服器，請檢查網路連線"):!is&&!D.isLoginExpired&&v.showError("請求錯誤","請求發生錯誤，請稍後再試");return Promise.reject(D)});const Fs=()=>{is||(is=!0,ea.abort(),localStorage.removeItem("token"),v.showError("登入已過期","請重新登入"),setTimeout(()=>{window.location.href="/login"},1500))},Ls={login:(D,x)=>he.post("/v1/login",{account:D,password:x}),logout:()=>he.post("/v1/logout")},tt={getSidebarPermissions:()=>he.get("/v1/sidebar")},ua="/ISD/assets/5hpvkmlj-DCdXzIFe.svg",ca={class:"min-h-screen flex items-center justify-center bg-gray-100"},pa={class:"flex flex-col items-center"},va={class:"w-[600px] bg-white shadow-lg"},ma={class:"flex justify-center"},ba={class:"flex justify-center"},fa={class:"flex justify-center"},ya={class:"w-[400px] flex space-x-2"},ga={key:0,class:"flex justify-center"},xa={class:"text-red-500"},ha={class:"flex justify-center"},wa=["disabled"],_a={__name:"Login",setup(D){We();const x=m(""),d=m(""),u=m(!1),C=m(""),o=m(null),N=m(""),K=m(""),$=()=>{const b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let r="";const f=y=>{const V=new Uint32Array(1);return window.crypto.getRandomValues(V),V[0]%y},p=f(10),w=f(26)+10;r+=b[p],r+=b[w];for(let y=0;y<2;y++){const V=f(b.length);r+=b[V]}return r.split("").sort(()=>{const y=new Uint32Array(1);return window.crypto.getRandomValues(y),.5-y[0]/4294967295}).join("")},P=()=>{if(!o.value)return;const b=o.value.getContext("2d"),r=o.value.width,f=o.value.height;o.value.width=r,o.value.height=f,K.value=$();const p=()=>{const w=new Uint32Array(1);return window.crypto.getRandomValues(w),w[0]/4294967295};b.fillStyle="#f0f0f0",b.fillRect(0,0,r,f);for(let w=0;w<2;w++)b.strokeStyle=`rgb(${p()*200}, ${p()*200}, ${p()*200})`,b.lineWidth=.5,b.beginPath(),b.moveTo(p()*r,p()*f),b.lineTo(p()*r,p()*f),b.stroke();for(let w=0;w<15;w++)b.fillStyle=`rgb(${p()*200}, ${p()*200}, ${p()*200})`,b.beginPath(),b.arc(p()*r,p()*f,.8,0,2*Math.PI),b.fill();b.font="bold 50px Arial",b.textAlign="center",b.textBaseline="middle";for(let w=0;w<K.value.length;w++){const y=K.value[w],V=r*(w+1)/(K.value.length+1),W=f/2+p()*4-2;b.fillStyle=`rgb(${Math.floor(p()*80)}, ${Math.floor(p()*80)}, ${Math.floor(p()*80)})`,b.save(),b.translate(V,W),b.rotate((p()-.5)*.2),b.fillText(y,0,0),b.restore()}},T=()=>{P()},z=()=>N.value?N.value.toUpperCase()!==K.value?(C.value="驗證碼錯誤",T(),N.value="",!1):!0:(C.value="請輸入驗證碼",!1),g=()=>(C.value="",!x.value||!d.value?(C.value="請輸入帳號和密碼",!1):z()),a=b=>{C.value=b||"登入失敗，請檢查帳號密碼",T(),N.value=""},A=b=>{window.location.href=b},G=b=>{if(b.isNeedChangePwd===!0){A("/password");return}if(!Object.values(b).some(p=>p===!0)){A("/unauthorized");return}const f=Us.options.getFirstAvailablePath?Us.options.getFirstAvailablePath(b):null;A(f||"/unauthorized")},k=async()=>{try{const b=await tt.getSidebarPermissions();b.data.code===0&&b.data.message==="success"?G(b.data.data):A("/unauthorized")}catch(b){console.error("獲取權限失敗:",b),A("/unauthorized")}},c=async()=>{var b,r;if(g())try{u.value=!0;const f=await Ls.login(x.value,d.value);f.data.code===0&&f.data.message==="success"?(localStorage.setItem("token",f.data.data.token),await k()):a(f.data.message)}catch(f){console.error("登入錯誤:",f);const p=((r=(b=f.response)==null?void 0:b.data)==null?void 0:r.message)||"登入失敗，請稍後再試";a(p)}finally{u.value=!1}};return je(()=>{setTimeout(()=>{P()},0)}),(b,r)=>(t(),s("div",ca,[e("div",pa,[r[5]||(r[5]=e("div",{class:"mb-4 flex items-center"},[e("img",{src:ua,alt:"數位發展部資通安全署",class:"h-20"})],-1)),e("div",va,[r[4]||(r[4]=e("div",{class:"w-full bg-gray-700 text-white p-4"},[e("h1",{class:"text-center text-xl"}," 113-116年推動政府資安人力職能轉換訓練服務委外案 "),e("h2",{class:"text-center text-lg mt-2"}," 學習歷程資料管理系統 ")],-1)),e("form",{onSubmit:Ot(c,["prevent"]),class:"space-y-4 p-6"},[e("div",ma,[I(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=f=>x.value=f),placeholder:"帳號",class:"w-[400px] px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[ee,x.value]])]),e("div",ba,[I(e("input",{type:"password","onUpdate:modelValue":r[1]||(r[1]=f=>d.value=f),placeholder:"密碼",class:"w-[400px] px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[ee,d.value]])]),e("div",fa,[e("div",ya,[I(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=f=>N.value=f),placeholder:"請輸入驗證碼",class:"flex-1 px-4 py-2 border-2 border-gray-300 focus:outline-none"},null,512),[[ee,N.value]]),e("div",{class:"w-32 h-10 flex items-center justify-center relative cursor-pointer",onClick:T},[e("canvas",{ref_key:"captchaCanvas",ref:o,class:"w-full h-full border-2 border-gray-300"},null,512),r[3]||(r[3]=e("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300"},[e("div",{class:"bg-black bg-opacity-20 w-full h-full flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1))])])]),C.value?(t(),s("div",ga,[e("p",xa,l(C.value),1)])):J("",!0),e("div",ha,[e("button",{type:"submit",class:"w-[200px] py-2 px-4 bg-[#4e9875] hover:bg-[#438264] text-white",disabled:u.value},l(u.value?"登入中...":"登入"),9,wa)])],32)])])]))}},ka={class:"flex items-center text-sm space-x-2 mb-6"},$a={key:1,class:"text-[#4e9875] font-medium"},pt={__name:"Breadcrumb",props:{breadcrumbs:{type:Array,required:!0,default:()=>[]}},setup(D){return(x,d)=>{const u=Os("router-link");return t(),s("div",ka,[Qe(u,{to:"/",class:"text-gray-600 hover:text-gray-800"},{default:Rs(()=>d[0]||(d[0]=[xe("首頁")])),_:1}),d[2]||(d[2]=e("span",{class:"text-gray-500"},"/",-1)),(t(!0),s(Z,null,re(D.breadcrumbs,(C,o)=>(t(),s(Z,{key:o},[o<D.breadcrumbs.length-1?(t(),s(Z,{key:0},[Qe(u,{to:C.path,class:"text-gray-600 hover:text-gray-800"},{default:Rs(()=>[xe(l(C.name),1)]),_:2},1032,["to"]),d[1]||(d[1]=e("span",{class:"text-gray-500"},"/",-1))],64)):(t(),s("span",$a,l(C.name),1))],64))),128))])}}},os={getReviews:D=>he.get("/v1/review",{params:D}),getReviewById:D=>he.get(`/v1/review/${D}`),updateReview:(D,x)=>he.put(`/v1/review/${D}`,x),updateReviewStatus:(D,x)=>he.put(`/v1/review/status/${D}`,x),importReviews:D=>he.post("/v1/review/import",D,{headers:{"Content-Type":"multipart/form-data"}}),deleteReview:D=>he.delete("/v1/review",{data:D}),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),exportReviewToExcel:D=>he.get(`/v1/review/export/${D}`,{responseType:"blob"})},Le=(D,x)=>{const d=D.__vccOpts||D;for(const[u,C]of x)d[u]=C;return d},Ca={class:"flex flex-col items-center p-6"},Ea={class:"w-full max-w-[1500px]"},Sa={class:"w-full max-w-[1500px]"},Da={class:"bg-gray-100 p-4"},Ma={class:"flex justify-between items-center"},Aa={class:"space-x-4"},Ia=["aria-label"],Ra={class:"w-full max-w-[1500px]"},Pa={class:"space-y-6 mt-6"},Ua={class:"grid grid-cols-2 gap-6"},Na={class:"flex items-center"},Ta=["readonly"],Va={class:"flex items-center"},ja=["readonly"],La={class:"flex items-center"},Fa=["readonly"],qa={class:"flex items-center"},Oa=["readonly"],Ba={class:"flex items-center"},Ha=["readonly"],Wa={class:"w-full border"},za={class:"border p-2"},Ka={class:"relative"},Ja=["onUpdate:modelValue","readonly"],Ya={class:"border p-2"},Ga={class:"relative"},Qa=["onUpdate:modelValue","readonly"],Za={class:"border p-2"},Xa={class:"relative"},eo=["onUpdate:modelValue","readonly"],to={class:"border p-2"},so={class:"relative"},ao=["onUpdate:modelValue","readonly"],oo={class:"relative"},lo=["onUpdate:modelValue","readonly"],no={class:"relative"},ro=["onUpdate:modelValue","readonly"],io={class:"border p-2"},uo={class:"relative"},co=["onUpdate:modelValue","readonly"],po={class:"flex justify-end items-center mb-4 mt-4"},vo={class:"w-full border"},mo={class:"bg-[#EEEFE7]"},bo={key:0,class:"border p-2 w-[5%]",scope:"col"},fo={class:"border p-2"},yo=["onUpdate:modelValue","readonly"],go={class:"border p-2"},xo={class:"relative"},ho=["onUpdate:modelValue","readonly"],wo={class:"border p-2 text-center"},_o={class:"flex flex-col"},ko=["onUpdate:modelValue","readonly","onInput"],$o=["onUpdate:modelValue","readonly","onInput"],Co={class:"border p-2"},Eo=["onUpdate:modelValue","readonly"],So={class:"border p-2"},Do=["onUpdate:modelValue","readonly"],Mo={key:0,class:"border p-2"},Ao=["onClick"],Io={class:"flex justify-between items-center mb-4"},Ro={class:"w-full border mt-4"},Po={class:"bg-[#EEEFE7]"},Uo={key:0,class:"border p-2 w-[5%]",scope:"col"},No={class:"border p-2"},To=["onUpdate:modelValue","readonly"],Vo={class:"border p-2"},jo=["onUpdate:modelValue","readonly"],Lo={class:"border p-2"},Fo={class:"relative"},qo=["onUpdate:modelValue","readonly"],Oo={key:0,class:"border p-2"},Bo=["onClick"],Ho={class:"flex justify-between items-center mb-4"},Wo={class:"w-full border"},zo={class:"bg-[#EEEFE7]"},Ko={key:0,class:"border p-2 w-[5%]",scope:"col"},Jo={class:"border p-2"},Yo=["onUpdate:modelValue","readonly"],Go={class:"border p-2"},Qo={class:"relative"},Zo=["onUpdate:modelValue","readonly"],Xo={key:0,class:"border p-2"},el=["onClick"],tl={class:"w-full"},sl={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"學校資安領域課程及專業師資投入數"},al={class:"w-full"},ol={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"轉任職系開班經驗"},ll={class:"w-full"},nl={key:1,class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-label":"其他備註事項"},rl={class:"mb-4 space-x-2 flex items-center"},il=["disabled"],dl=["disabled"],ul={key:2,class:"ml-4"},cl={__name:"InitialReview",setup(D){const x=We(),d=lt(),u=m(d.params.id),C=m(!0),o=m({reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementExport:!1}),N=async()=>{try{if(!await v.confirmAsync("確認刪除","確定要刪除此審核表單嗎？刪除後資料將無法恢復。"))return;const q=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(q===null||q==="")return;if((await os.confirmPassword(q)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const Y=await v.promptAsync("刪除原因","請輸入刪除此審核表單的原因：","text");if(Y===null||Y==="")return;const fe=await os.deleteReview({id:u.value,reason:Y});fe.data.code===0?(v.showSuccess("刪除成功","審核表單已成功刪除"),x.push("/search")):v.showError("刪除失敗",fe.data.message||"刪除審核表單失敗")}catch(oe){console.error("刪除審核表單錯誤:",oe),v.showError("刪除失敗","刪除審核表單時發生錯誤，請稍後再試")}},K=async()=>{try{const oe=await tt.getSidebarPermissions();oe.data.code===0&&oe.data.message==="success"?(o.value=oe.data.data,console.log("審核表單頁面權限:",o.value)):console.error("獲取權限失敗:",oe.data.message)}catch(oe){console.error("獲取權限錯誤:",oe)}},$=m({name:"",taxId:"",contact:"",phone:"",email:""}),P=m(""),T=m(""),z=m(""),g=m([{id:1,courseName:"",categoryText:"",outline:"",timeLocation:{period:"",weekly:"",location:""},lecturer:""}]),a=m([]),A=m([]),G=m([]),k=m(""),c=m(0),b=Se(()=>c.value===1||c.value===2),r=async()=>{try{const oe=await os.exportReviewToExcel(u.value);if(oe.data){const q=oe.headers["content-disposition"];let S=`審核表單_${u.value}.xlsx`;if(q){const le=q.match(/filename\*?=['"]?(?:UTF-8''|)([a-zA-Z0-9_.%-]+)['"]?/);le&&le[1]&&(S=decodeURIComponent(le[1]))}const Y=window.URL.createObjectURL(new Blob([oe.data])),fe=document.createElement("a");fe.href=Y,fe.setAttribute("download",S),document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),window.URL.revokeObjectURL(Y),v.showSuccess("匯出成功","審核表單已成功匯出為 Excel 檔案")}else v.showError("匯出失敗","匯出 Excel 檔案失敗")}catch(oe){console.error("匯出 Excel 錯誤:",oe),v.showError("匯出錯誤","匯出 Excel 檔案時發生錯誤，請稍後再試")}},f=oe=>{$.value={name:oe.schoolName||"",taxId:oe.taxId||"",contact:oe.contactName||"",phone:oe.contactPhone||"",email:oe.contactEmail||""}},p=oe=>{if(g.value=[{id:1,courseName:oe.courseName||"",categoryText:oe.courseCategory||"",outline:oe.outline||"",timeLocation:{period:"",weekly:"",location:""},lecturer:oe.teacher||""}],oe.timePlace){const q=oe.timePlace.split(" "),S=q.slice(0,3).join(" "),Y=q.slice(3,5).join(" "),fe=q.slice(5).join(" ");g.value[0].timeLocation={period:S,weekly:Y,location:fe}}},w=oe=>{oe&&oe.length>0?a.value=oe.map((q,S)=>{let Y="";if(q.startDate){const fe=q.startDate.split(" "),le=fe[0]||"",Q=q.timeRange||fe[1]||"";Y=`${le}
${Q}`}return{id:S+1,sequence:String(S+1).padStart(2,"0"),outline:q.outline||"",datetime:Y,hours:q.hours||"",lecturer:q.teacher||""}}):a.value=[]},y=oe=>{oe&&oe.length>0?A.value=oe.map((q,S)=>({id:S+1,sequence:String(S+1),name:q.name||"",education:q.educationCert||""})):A.value=[]},V=oe=>{oe&&oe.length>0?G.value=oe.map((q,S)=>({id:S+1,item:q.item||"",description:q.description||""})):G.value=[]},W=async()=>{var oe;if(!u.value){v.showError("參數錯誤","無法獲取審核資料，缺少必要參數"),C.value=!1;return}try{C.value=!0;const q=await os.getReviewById(u.value);if(q.data&&q.data.code===0){const S=q.data.data;f(S),p(S),w(S.schedules),y(S.teachers),V(S.fees),P.value=S.securityInvestment||"",T.value=S.transferExperience||"",z.value=S.otherRemarks||"",c.value=S.status||0,k.value=S.rejectReason||"",gs(()=>{document.querySelectorAll("textarea").forEach(ue)})}else v.showError("獲取失敗",((oe=q.data)==null?void 0:oe.message)||"獲取審核資料失敗")}catch(q){console.error("獲取審核詳情錯誤:",q),v.showError("獲取錯誤","獲取審核資料時發生錯誤，請稍後再試")}finally{C.value=!1}},O=(oe,q,S)=>{const Y=oe.datetime.split(`
`);Y[S]=q,oe.datetime=Y.join(`
`)},_=()=>{const oe=a.value.length+1;a.value.push({id:oe,sequence:String(oe).padStart(2,"0"),outline:"",datetime:`
`,hours:"",lecturer:""})},E=oe=>{const q=a.value.findIndex(S=>S.id===oe);q!==-1&&a.value.splice(q,1)},L=()=>{const oe=A.value.length+1;A.value.push({id:oe,sequence:String(oe),name:"",education:""})},j=oe=>{const q=A.value.findIndex(S=>S.id===oe);q!==-1&&A.value.splice(q,1)},R=()=>{G.value.push({id:G.value.length+1,item:"",description:""})},U=oe=>{const q=G.value.findIndex(S=>S.id===oe);q!==-1&&G.value.splice(q,1)},te=oe=>{oe.style.height="auto",oe.style.height=Math.min(oe.scrollHeight,400)+"px"},ue=oe=>{oe.style.height="auto",oe.style.height=Math.max(60,oe.scrollHeight)+"px"},ye=m(!1),ke=async()=>{var oe;if(ye.value)try{const q={id:u.value,schoolName:$.value.name,taxId:$.value.taxId,contactName:$.value.contact,contactPhone:$.value.phone,contactEmail:$.value.email,timePlace:`${g.value[0].timeLocation.period} ${g.value[0].timeLocation.weekly} ${g.value[0].timeLocation.location}`,courseName:g.value[0].courseName,courseCategory:g.value[0].categoryText,outline:g.value[0].outline,teacher:g.value[0].lecturer,securityInvestment:P.value,transferExperience:T.value,otherRemarks:z.value,schedules:a.value.map(Y=>{const fe=Y.datetime.split(`
`);let le=fe[0]||"",Q=fe[1]||"";return{outline:Y.outline,startDate:le,timeRange:Q,hours:parseInt(Y.hours)||0,teacher:Y.lecturer}}),teachers:A.value.map(Y=>({name:Y.name,educationCert:Y.education})),fees:G.value.map(Y=>({item:Y.item,description:Y.description}))},S=await os.updateReview(u.value,q);S.data&&S.data.code===0?(ye.value=!1,v.showSuccess("儲存成功","表單資料已成功儲存"),W()):v.showError("儲存失敗",((oe=S.data)==null?void 0:oe.message)||"儲存表單資料失敗")}catch(q){console.error("儲存表單資料錯誤:",q),v.showError("儲存錯誤","儲存表單資料時發生錯誤，請稍後再試")}else ye.value=!0},De=async()=>{try{await v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會遺失。")&&(ye.value=!1,W())}catch(oe){console.error("取消編輯發生錯誤:",oe)}},$e=async()=>{var oe;try{if(await v.confirmAsync("確認審核","確定要將此課程審核為不通過嗎？")){const S=await v.promptAsync("請輸入不通過原因","請輸入課程審核不通過的原因：","text");if(S){const Y=await os.updateReviewStatus(u.value,{id:u.value,status:2,rejectReason:S});Y.data&&Y.data.code===0?(c.value=2,k.value=S,v.showSuccess("審核完成","課程已審核為不通過"),x.push("/search")):v.showError("審核失敗",((oe=Y.data)==null?void 0:oe.message)||"審核操作失敗")}else v.showError("審核未完成","請提供不通過原因")}}catch(q){console.error("審核過程發生錯誤:",q),v.showError("審核失敗","審核過程發生錯誤，請稍後再試")}},ve=async()=>{var oe;try{if(await v.confirmAsync("確認審核","確定要將此課程審核為通過嗎？")){const S=await v.promptAsync("請輸入審核通過日期","請輸入課程審核通過的日期 (例如: 2023-01-01)","date");if(!S){v.showError("審核未完成","請提供審核通過日期");return}await gs();const Y=await v.promptAsync("請輸入課程編號","請輸入要分配給此課程的編號：","text");if(Y){const fe=await os.updateReviewStatus(u.value,{id:u.value,status:1,courseCode:Y,approvedDate:S});fe.data&&fe.data.code===0?(c.value=1,v.showSuccess("審核成功",`課程已成功審核通過，編號: ${Y}`),x.push("/search")):v.showError("審核失敗",((oe=fe.data)==null?void 0:oe.message)||"審核操作失敗")}}}catch(q){console.error("審核過程發生錯誤:",q),v.showError("審核失敗","審核過程發生錯誤，請稍後再試")}};return Ee(()=>d.params.id,oe=>{oe&&oe!==u.value&&(u.value=oe,W())}),je(()=>{K(),W()}),(oe,q)=>(t(),s("div",Ca,[e("div",Ea,[Qe(pt,{breadcrumbs:[{name:"審核名單",path:"/search"},{name:"審核表單",path:`/initial/${u.value}`}]},null,8,["breadcrumbs"])]),e("div",Sa,[e("div",Da,[e("div",Ma,[q[21]||(q[21]=e("h2",{class:"text-xl"},"學校辦理轉任資訊處理職系專長訓練審查意見表",-1)),e("div",Aa,[o.value.reviewManagementExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:r}," 匯出 Excel ")):J("",!0),ye.value&&o.value.reviewManagementEdit?(t(),s("button",{key:1,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:N,"aria-label":"刪除審核表單"}," 刪除表單 ")):J("",!0),ye.value?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:De,"aria-label":"取消編輯"}," 取消 ")):J("",!0),o.value.reviewManagementEdit?(t(),s("button",{key:3,class:X(["px-4 py-2",ye.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:ke,"aria-label":ye.value?"儲存編輯":"開始編輯"},l(ye.value?"儲存":"內容編輯"),11,Ia)):J("",!0)])])]),q[22]||(q[22]=e("div",{class:"w-full h-[1px] bg-gray-300"},null,-1))]),e("div",Ra,[e("div",Pa,[e("section",null,[q[28]||(q[28]=e("h3",{class:"text-lg font-bold mb-4"},"一、學校基本資料：",-1)),e("div",Ua,[e("div",Na,[q[23]||(q[23]=e("label",{class:"w-24",for:"school-name"},"學校名稱:",-1)),I(e("input",{id:"school-name","onUpdate:modelValue":q[0]||(q[0]=S=>$.value.name=S),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!ye.value},null,8,Ta),[[ee,$.value.name]])]),e("div",Va,[q[24]||(q[24]=e("label",{class:"w-24",for:"tax-id"},"統一編號:",-1)),I(e("input",{id:"tax-id","onUpdate:modelValue":q[1]||(q[1]=S=>$.value.taxId=S),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!ye.value},null,8,ja),[[ee,$.value.taxId]])]),e("div",La,[q[25]||(q[25]=e("label",{class:"w-24",for:"contact-person"},"聯絡窗口:",-1)),I(e("input",{id:"contact-person","onUpdate:modelValue":q[2]||(q[2]=S=>$.value.contact=S),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!ye.value},null,8,Fa),[[ee,$.value.contact]])]),e("div",qa,[q[26]||(q[26]=e("label",{class:"w-24",for:"contact-phone"},"聯絡電話:",-1)),I(e("input",{id:"contact-phone","onUpdate:modelValue":q[3]||(q[3]=S=>$.value.phone=S),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!ye.value},null,8,Oa),[[ee,$.value.phone]])]),e("div",Ba,[q[27]||(q[27]=e("label",{class:"w-24",for:"contact-email"},"電子信箱:",-1)),I(e("input",{id:"contact-email","onUpdate:modelValue":q[4]||(q[4]=S=>$.value.email=S),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none text-center",readonly:!ye.value},null,8,Ha),[[ee,$.value.email]])])])]),e("section",null,[q[36]||(q[36]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},"二、本案規劃課程表：")],-1)),e("table",Wa,[q[29]||(q[29]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2 w-[12.5%]",scope:"col"},"課程名稱"),e("th",{class:"border p-2 w-[12.5%]",scope:"col"},"類別"),e("th",{class:"border p-2 w-[40%]",scope:"col"},"課程大綱"),e("th",{class:"border p-2 w-[20%]",scope:"col"},"時間及地點"),e("th",{class:"border p-2 w-[15%]",scope:"col"},"講師")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(g.value,(S,Y)=>(t(),s("tr",{key:S.id},[e("td",za,[e("div",Ka,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.courseName),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.courseName=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[5]||(q[5]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,Ja),[[ee,S.courseName]])])]),e("td",Ya,[e("div",Ga,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.categoryText),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.categoryText=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none whitespace-pre-wrap",onInput:q[6]||(q[6]=fe=>ue(fe.target)),rows:"3",readonly:!ye.value},null,40,Qa),[[ee,S.categoryText]])])]),e("td",Za,[e("div",Xa,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.outline),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.outline=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none whitespace-pre-wrap",onInput:q[7]||(q[7]=fe=>ue(fe.target)),rows:"3",readonly:!ye.value},null,40,eo),[[ee,S.outline]])])]),e("td",to,[e("div",so,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.timeLocation.period),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.timeLocation.period=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none mb-1",onInput:q[8]||(q[8]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,ao),[[ee,S.timeLocation.period]])]),e("div",oo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.timeLocation.weekly),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.timeLocation.weekly=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none mb-1",onInput:q[9]||(q[9]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,lo),[[ee,S.timeLocation.weekly]])]),e("div",no,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.timeLocation.location),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.timeLocation.location=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[10]||(q[10]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,ro),[[ee,S.timeLocation.location]])])]),e("td",io,[e("div",uo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.lecturer),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.lecturer=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[11]||(q[11]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,co),[[ee,S.lecturer]])])])]))),128))])]),e("div",po,[ye.value?(t(),s("button",{key:0,onClick:_,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增課程規劃欄位"}," 新增欄位 ")):J("",!0)]),e("table",vo,[e("thead",null,[q[35]||(q[35]=e("tr",null,[e("th",{colspan:"6",class:"border p-2 bg-[#EEEFE7] text-left",scope:"colgroup"},"課程規劃")],-1)),e("tr",mo,[q[30]||(q[30]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"項次",-1)),q[31]||(q[31]=e("th",{class:"border p-2 w-[55%]",scope:"col"},"課程大綱",-1)),q[32]||(q[32]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"日期及時間",-1)),q[33]||(q[33]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"時數",-1)),q[34]||(q[34]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"講師",-1)),ye.value?(t(),s("th",bo,"操作")):J("",!0)])]),e("tbody",null,[(t(!0),s(Z,null,re(a.value,(S,Y)=>(t(),s("tr",{key:S.id},[e("td",fo,[I(e("input",{"onUpdate:modelValue":fe=>S.sequence=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,yo),[[ee,S.sequence]])]),e("td",go,[e("div",xo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.outline),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.outline=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[12]||(q[12]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,ho),[[ee,S.outline]])])]),e("td",wo,[e("div",_o,[I(e("input",{"onUpdate:modelValue":fe=>S.datetime.split(`
`)[0]=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none mb-1",readonly:!ye.value,onInput:fe=>O(S,fe.target.value,0),placeholder:""},null,40,ko),[[ee,S.datetime.split(`
`)[0]]]),I(e("input",{"onUpdate:modelValue":fe=>S.datetime.split(`
`)[1]=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value,onInput:fe=>O(S,fe.target.value,1),placeholder:""},null,40,$o),[[ee,S.datetime.split(`
`)[1]]])])]),e("td",Co,[I(e("input",{"onUpdate:modelValue":fe=>S.hours=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,Eo),[[ee,S.hours]])]),e("td",So,[I(e("input",{"onUpdate:modelValue":fe=>S.lecturer=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,Do),[[ee,S.lecturer]])]),ye.value?(t(),s("td",Mo,[ye.value?(t(),s("button",{key:0,onClick:fe=>E(S.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此課程大綱"}," 刪除 ",8,Ao)):J("",!0)])):J("",!0)]))),128))])])]),e("section",null,[e("div",Io,[q[37]||(q[37]=e("h3",{class:"text-lg font-bold"},"三、師資及課程安排：",-1)),ye.value?(t(),s("button",{key:0,onClick:L,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增師資欄位"}," 新增欄位 ")):J("",!0)]),e("table",Ro,[e("thead",null,[e("tr",Po,[q[38]||(q[38]=e("th",{class:"border p-2 w-[5%]",scope:"col"},"項次",-1)),q[39]||(q[39]=e("th",{class:"border p-2 w-[15%]",scope:"col"},"姓名",-1)),q[40]||(q[40]=e("th",{class:"border p-2 w-[75%]",scope:"col"},"講師學/經歷資料",-1)),ye.value?(t(),s("th",Uo,"操作")):J("",!0)])]),e("tbody",null,[(t(!0),s(Z,null,re(A.value,(S,Y)=>(t(),s("tr",{key:S.id},[e("td",No,[I(e("input",{"onUpdate:modelValue":fe=>S.sequence=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,To),[[ee,S.sequence]])]),e("td",Vo,[I(e("input",{"onUpdate:modelValue":fe=>S.name=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,jo),[[ee,S.name]])]),e("td",Lo,[e("div",Fo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.education),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.education=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[13]||(q[13]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,qo),[[ee,S.education]])])]),ye.value?(t(),s("td",Oo,[ye.value?(t(),s("button",{key:0,onClick:fe=>j(S.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此師資項目"}," 刪除 ",8,Bo)):J("",!0)])):J("",!0)]))),128))])])]),e("section",null,[e("div",Ho,[q[41]||(q[41]=e("h3",{class:"text-lg font-bold"},"四、開課費用：",-1)),ye.value?(t(),s("button",{key:0,onClick:R,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]","aria-label":"新增開課費用欄位"}," 新增欄位 ")):J("",!0)]),e("table",Wo,[e("thead",null,[e("tr",zo,[q[42]||(q[42]=e("th",{class:"border p-2 w-[47.5%]",scope:"col"},"項目",-1)),q[43]||(q[43]=e("th",{class:"border p-2 w-[47.5%]",scope:"col"},"說明",-1)),ye.value?(t(),s("th",Ko,"操作")):J("",!0)])]),e("tbody",null,[(t(!0),s(Z,null,re(G.value,(S,Y)=>(t(),s("tr",{key:S.id},[e("td",Jo,[I(e("input",{"onUpdate:modelValue":fe=>S.item=fe,type:"text",class:"w-full text-center bg-transparent border-none focus:outline-none",readonly:!ye.value},null,8,Yo),[[ee,S.item]])]),e("td",Go,[e("div",Qo,[e("div",{class:"invisible whitespace-pre-wrap",ref_for:!0,ref:"contentMirror"},l(S.description),513),I(e("textarea",{"onUpdate:modelValue":fe=>S.description=fe,class:"w-full text-center bg-transparent border-none focus:outline-none resize-none",onInput:q[14]||(q[14]=fe=>ue(fe.target)),rows:"1",readonly:!ye.value},null,40,Zo),[[ee,S.description]])])]),ye.value?(t(),s("td",Xo,[ye.value?(t(),s("button",{key:0,onClick:fe=>U(S.id),class:"px-3 py-1 bg-red-500 text-white hover:bg-red-600","aria-label":"刪除此開課費用項目"}," 刪除 ",8,el)):J("",!0)])):J("",!0)]))),128))])])]),e("section",null,[q[44]||(q[44]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[xe("五、學校資安領域課程及專業師資投入數（近三年）："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",tl,[ye.value?I((t(),s("textarea",{key:0,"onUpdate:modelValue":q[15]||(q[15]=S=>P.value=S),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入學校資安領域課程及專業師資投入數資料",rows:"4",onInput:q[16]||(q[16]=S=>te(S.target)),"aria-label":"學校資安領域課程及專業師資投入數"},null,544)),[[ee,P.value]]):(t(),s("div",sl,l(P.value||"無資料"),1))])]),e("section",null,[q[45]||(q[45]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[xe("六、轉任職系開班經驗（近五年）："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",al,[ye.value?I((t(),s("textarea",{key:0,"onUpdate:modelValue":q[17]||(q[17]=S=>T.value=S),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入轉任職系開班經驗資料",rows:"4",onInput:q[18]||(q[18]=S=>te(S.target)),"aria-label":"轉任職系開班經驗"},null,544)),[[ee,T.value]]):(t(),s("div",ol,l(T.value||"無資料"),1))])]),e("section",null,[q[46]||(q[46]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-bold"},[xe("七、其他備註事項："),e("span",{class:"text-sm font-normal text-gray-500"},"（非必填欄位）")])],-1)),e("div",ll,[ye.value?I((t(),s("textarea",{key:0,"onUpdate:modelValue":q[19]||(q[19]=S=>z.value=S),class:"w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",placeholder:"請輸入其他備註事項",rows:"4",onInput:q[20]||(q[20]=S=>te(S.target)),"aria-label":"其他備註事項"},null,544)),[[ee,z.value]]):(t(),s("div",nl,l(z.value||"無資料"),1))])]),e("section",null,[e("div",rl,[o.value.reviewManagementApprove?(t(),s("button",{key:0,onClick:ve,class:X(["px-4 py-2 bg-[#4e9875] text-white",b.value?"cursor-not-allowed":"hover:bg-[#3e7a5c]"]),disabled:b.value,"aria-label":"審核通過"}," 審核通過 ",10,il)):J("",!0),o.value.reviewManagementApprove?(t(),s("button",{key:1,onClick:$e,class:X(["px-4 py-2 bg-red-500 text-white",b.value?"cursor-not-allowed":"hover:bg-red-600"]),disabled:b.value,"aria-label":"審核不通過"}," 審核不通過 ",10,dl)):J("",!0),k.value?(t(),s("div",ul," 不通過原因："+l(k.value),1)):J("",!0)])])])])]))}},pl=Le(cl,[["__scopeId","data-v-3abb1b43"]]),ot={getAgencyOptions:()=>he.get("/v1/options/agency"),getSchoolOptions:()=>he.get("/v1/options/school"),getCourseOptions:()=>he.get("/v1/options/course"),getCourseData:D=>he.get("/v1/options/courseData",{params:D}),getAreaOptions:()=>he.get("/v1/options/area"),getCourseMonths:D=>he.get("/v1/options/courseMonth",{params:{year:D}}),getLogFunctionOptions:()=>he.get("/v1/options/logs"),getStudentStatusOptions:()=>he.get("/v1/options/studentStatus"),getConsultationCategoryOptions:()=>he.get("/v1/options/consultationCategories"),getTables:()=>he.get("/v1/options/tables"),getAgencies:D=>he.get("/v1/agency",{params:D}),createAgency:D=>he.post("/v1/agency",D),updateAgency:D=>he.put(`/v1/agency/${D.id}`,D),deleteAgency:D=>he.delete(`/v1/agency/${D}`),getCourseSubjects:()=>he.get("/v1/options/courseSubject")},vl={class:"flex flex-col items-center p-6"},ml={class:"w-full max-w-[1500px]"},bl={class:"w-full max-w-[1500px]"},fl={class:"flex items-center space-x-4"},yl=["value"],gl=["value"],xl=["value"],hl=["value"],wl={class:"relative w-50"},_l={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},kl={key:1,class:"w-full max-w-[1500px]"},$l={class:"w-full border"},Cl={class:"bg-[#EEEFE7]"},El={class:"border p-2"},Sl={class:"flex items-center justify-center"},Dl={key:0},Ml={key:1},Al={key:2},Il={class:"border p-2"},Rl={class:"flex items-center justify-center"},Pl={key:0},Ul={key:1},Nl={key:2},Tl={class:"border p-2"},Vl={class:"flex items-center justify-center"},jl={key:0},Ll={key:1},Fl={key:2},ql={class:"border p-2"},Ol={class:"flex items-center justify-center"},Bl={key:0},Hl={key:1},Wl={key:2},zl={class:"border p-2"},Kl={class:"flex items-center justify-center"},Jl={key:0},Yl={key:1},Gl={key:2},Ql={class:"border p-2"},Zl={class:"flex items-center justify-center"},Xl={key:0},en={key:1},tn={key:2},sn={class:"border p-2"},an={class:"flex items-center justify-center"},on={key:0},ln={key:1},nn={key:2},rn={class:"border p-2 text-center"},dn={class:"border p-2 text-center"},un={class:"border p-2 text-center"},cn={class:"border p-2 text-center"},pn={class:"border p-2 text-center"},vn={class:"border p-2 text-center"},mn={class:"border p-2 text-center"},bn={class:"border p-2 text-center"},fn={class:"border p-2"},yn=["onClick"],gn={key:0},xn={key:0,class:"flex justify-center items-center space-x-2 mt-6"},hn=["disabled"],wn=["onClick"],_n={key:1,class:"px-2"},kn=["disabled"],$n={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Cn={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},En={class:"mb-4"},Sn={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Dn={class:"mb-2"},Mn={key:0,class:"text-red-500 text-sm mt-2"},An={class:"flex justify-end space-x-2"},In=["disabled"],Rn=["disabled"],Pn={__name:"SearchList",setup(D){const x=We(),d=m({reviewManagementImport:!1}),u=async()=>{try{const se=await tt.getSidebarPermissions();se.data.code===0&&se.data.message==="success"?(d.value=se.data.data,console.log("審核名單頁面權限:",d.value)):console.error("獲取權限失敗:",se.data.message)}catch(se){console.error("獲取權限錯誤:",se)}},C=async()=>{try{const se=await ot.getSchoolOptions();se.data.code===0&&se.data.message==="success"?G.value=se.data.data:console.error("獲取學校選項失敗:",se.data.message)}catch(se){console.error("獲取學校選項錯誤:",se)}},o=async()=>{try{const se=await ot.getCourseOptions();if(se.data.code===0&&se.data.message==="success")if(se.data.data&&Array.isArray(se.data.data)){const ie=[];se.data.data.forEach(de=>{de.items&&Array.isArray(de.items)?de.items.forEach(ae=>{ie.push({id:ae.id,name:ae.name,categoryId:de.id,categoryName:de.name})}):ie.push({id:de.id,name:de.name})}),k.value=ie}else k.value=se.data.data||[];else console.error("獲取科目選項失敗:",se.data.message)}catch(se){console.error("獲取科目選項錯誤:",se)}},N=async()=>{try{if(!P.value){A.value=Array.from({length:12},(ie,de)=>({value:String(de+1),label:`${de+1}月`}));return}const se=await ot.getCourseMonths(P.value);se.data.code===0&&se.data.message==="success"?(A.value=se.data.data.map(ie=>({value:String(ie),label:`${ie}月`})),T.value&&!A.value.find(ie=>ie.value===T.value)&&(T.value="")):(console.error("獲取月份選項失敗:",se.data.message),A.value=Array.from({length:12},(ie,de)=>({value:String(de+1),label:`${de+1}月`})))}catch(se){console.error("獲取月份選項錯誤:",se),A.value=Array.from({length:12},(ie,de)=>({value:String(de+1),label:`${de+1}月`}))}},K=m(""),$=m(""),P=m(""),T=m(""),z=m(""),g=m(""),a=Se(()=>{const se=new Date().getFullYear()-1911,ie=[];for(let de=se;de>=113;de--)ie.push(de);return ie}),A=m([]),G=m([]),k=m([]),c=m(""),b=m("asc"),r=m(1),f=m(20),p=m(0),w=m(!1),y=m([]),V=Se(()=>Math.ceil(p.value/f.value)),W=Se(()=>{const se=[];if(V.value<=5)for(let de=1;de<=V.value;de++)se.push(de);else{se.push(1);let de=Math.max(2,r.value-1),ae=Math.min(V.value-1,r.value+1);r.value<=3&&(ae=Math.min(V.value-1,4)),r.value>=V.value-2&&(de=Math.max(2,V.value-5+2)),de>2&&se.push("...");for(let ce=de;ce<=ae;ce++)se.push(ce);ae<V.value-1&&se.push("..."),se.push(V.value)}return se}),O=se=>({1:"北區",2:"中區",3:"南區",4:"東區",5:"離島"})[se]||"未知區域",_=se=>se||"--",E=se=>({1:"通過",2:"未通過",3:"審核中"})[se]||"未知狀態",L=async()=>{var se,ie;w.value=!0;try{const de={page:r.value,limit:f.value,keyword:$.value||void 0,status:K.value||void 0,year:P.value||void 0,month:T.value||void 0,school:z.value||void 0,subjectId:g.value||void 0,sortBy:c.value||void 0,sortOrder:b.value||void 0},ae=await os.getReviews(de);ae.data&&ae.data.code===0?(y.value=ae.data.data.list||[],p.value=ae.data.data.totalCount||0,console.log("獲取審核列表成功:",y.value)):(console.error("獲取審核列表失敗:",((se=ae.data)==null?void 0:se.message)||"未知錯誤"),y.value=[],p.value=0,v.showError("獲取資料失敗",((ie=ae.data)==null?void 0:ie.message)||"無法獲取審核列表，請稍後再試"))}catch(de){console.error("獲取審核列表失敗:",de),y.value=[],p.value=0,v.showError("獲取資料失敗",de.message||"無法獲取審核列表，請稍後再試")}finally{w.value=!1}},j=se=>{c.value===se?b.value=b.value==="asc"?"desc":"asc":(c.value=se,b.value="asc"),r.value=1,L()},R=se=>{se!=="..."&&(r.value=se,L())},U=()=>{r.value>1&&(r.value--,L())},te=()=>{r.value<V.value&&(r.value++,L())},ue=()=>{r.value=1,L()};Ee(P,()=>{N()});const ye=()=>{$.value=""},ke=se=>{x.push({name:"InitialReview",params:{id:se}})},De=m(!1),$e=m(null),ve=m(null),oe=m(!1),q=m(""),S=()=>{De.value=!0,ve.value=null,q.value=""},Y=()=>{De.value=!1,ve.value=null,q.value=""},fe=()=>{$e.value.click()},le=se=>{const ie=se.target.files[0];if(ie){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(ie.type)&&!ie.name.endsWith(".xlsx")&&!ie.name.endsWith(".xls")&&!ie.name.endsWith(".csv")){q.value="請選擇 .xlsx 檔案",ve.value=null,se.target.value=null;return}ve.value=ie,q.value=""}},Q=async()=>{var se,ie,de;if(!ve.value){q.value="請選擇要上傳的檔案";return}try{oe.value=!0,q.value="";const ae=new FormData;ae.append("file",ve.value);const ce=await os.importReviews(ae);if(ce.data&&ce.data.code===0){const Ie=ce.data.message?ce.data.message.replace(/\r\n|\n|\r/g,`
`):"課程計畫已成功匯入";Y(),v.showSuccess("上傳成功",Ie),L()}else q.value=((se=ce.data)==null?void 0:se.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",q.value)}catch(ae){console.error("匯入課程計畫錯誤:",ae),q.value=((de=(ie=ae.response)==null?void 0:ie.data)==null?void 0:de.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",q.value)}finally{oe.value=!1}};return je(()=>{u(),C(),o(),N(),L()}),(se,ie)=>(t(),s(Z,null,[e("div",vl,[e("div",ml,[Qe(pt,{breadcrumbs:[{name:"審核名單",path:"/search"}]})]),e("div",bl,[e("div",fl,[ie[19]||(ie[19]=e("span",null,"查詢:",-1)),I(e("select",{"onUpdate:modelValue":ie[0]||(ie[0]=de=>K.value=de),class:"p-2 border border-gray-300 outline-none",onKeyup:Ne(ue,["enter"])},ie[13]||(ie[13]=[e("option",{value:""},"全部",-1),e("option",{value:"1"},"通過",-1),e("option",{value:"2"},"未通過",-1),e("option",{value:"3"},"審核中",-1)]),544),[[Pe,K.value]]),I(e("select",{"onUpdate:modelValue":ie[1]||(ie[1]=de=>P.value=de),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[ie[14]||(ie[14]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(a.value,de=>(t(),s("option",{key:de,value:de},l(de)+"年 ",9,yl))),128))],544),[[Pe,P.value]]),I(e("select",{"onUpdate:modelValue":ie[2]||(ie[2]=de=>T.value=de),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[ie[15]||(ie[15]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(Z,null,re(A.value,de=>(t(),s("option",{key:de.value,value:de.value},l(de.label),9,gl))),128))],544),[[Pe,T.value]]),I(e("select",{"onUpdate:modelValue":ie[3]||(ie[3]=de=>z.value=de),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[ie[16]||(ie[16]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(Z,null,re(G.value,de=>(t(),s("option",{key:de.id,value:de.id},l(de.name),9,xl))),128))],544),[[Pe,z.value]]),I(e("select",{"onUpdate:modelValue":ie[4]||(ie[4]=de=>g.value=de),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[ie[17]||(ie[17]=e("option",{value:""},"請選擇科目名稱",-1)),(t(!0),s(Z,null,re(k.value,de=>(t(),s("option",{key:de.id,value:de.id},l(de.name),9,hl))),128))],544),[[Pe,g.value]]),e("div",wl,[I(e("input",{"onUpdate:modelValue":ie[5]||(ie[5]=de=>$.value=de),type:"text",placeholder:"請輸入訓練單位/課程編碼/課程名稱",class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",onKeyup:Ne(ue,["enter"]),"aria-label":"搜尋關鍵字輸入欄位",readonly:"",onfocus:"this.removeAttribute('readonly');"},null,544),[[ee,$.value]]),$.value?(t(),s("button",{key:0,onClick:ye,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},ie[18]||(ie[18]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{onClick:ue,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 搜尋 "),ie[20]||(ie[20]=e("div",{class:"flex-1"},null,-1)),d.value.reviewManagementImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-30",onClick:S}," 匯入課程計畫 ")):J("",!0)])]),ie[32]||(ie[32]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),w.value?(t(),s("div",_l,ie[21]||(ie[21]=[e("div",{class:"text-xl"},"資料載入中...",-1)]))):(t(),s("div",kl,[e("table",$l,[e("thead",null,[e("tr",Cl,[ie[29]||(ie[29]=e("th",{class:"border p-2 w-16"},"序",-1)),e("th",El,[e("div",Sl,[ie[22]||(ie[22]=xe(" 區域 ")),e("button",{onClick:ie[6]||(ie[6]=de=>j("area")),class:"ml-1 focus:outline-none"},[c.value==="area"&&b.value==="asc"?(t(),s("span",Dl,"▲")):c.value==="area"&&b.value==="desc"?(t(),s("span",Ml,"▼")):(t(),s("span",Al,"⇅"))])])]),e("th",Il,[e("div",Rl,[ie[23]||(ie[23]=xe(" 訓練單位 ")),e("button",{onClick:ie[7]||(ie[7]=de=>j("schoolName")),class:"ml-1 focus:outline-none"},[c.value==="schoolName"&&b.value==="asc"?(t(),s("span",Pl,"▲")):c.value==="schoolName"&&b.value==="desc"?(t(),s("span",Ul,"▼")):(t(),s("span",Nl,"⇅"))])])]),e("th",Tl,[e("div",Vl,[ie[24]||(ie[24]=xe(" 課程編碼 ")),e("button",{onClick:ie[8]||(ie[8]=de=>j("courseCode")),class:"ml-1 focus:outline-none"},[c.value==="courseCode"&&b.value==="asc"?(t(),s("span",jl,"▲")):c.value==="courseCode"&&b.value==="desc"?(t(),s("span",Ll,"▼")):(t(),s("span",Fl,"⇅"))])])]),e("th",ql,[e("div",Ol,[ie[25]||(ie[25]=xe(" 課程名稱 ")),e("button",{onClick:ie[9]||(ie[9]=de=>j("courseName")),class:"ml-1 focus:outline-none"},[c.value==="courseName"&&b.value==="asc"?(t(),s("span",Bl,"▲")):c.value==="courseName"&&b.value==="desc"?(t(),s("span",Hl,"▼")):(t(),s("span",Wl,"⇅"))])])]),e("th",zl,[e("div",Kl,[ie[26]||(ie[26]=xe(" 開課日期 ")),e("button",{onClick:ie[10]||(ie[10]=de=>j("startDate")),class:"ml-1 focus:outline-none"},[c.value==="startDate"&&b.value==="asc"?(t(),s("span",Jl,"▲")):c.value==="startDate"&&b.value==="desc"?(t(),s("span",Yl,"▼")):(t(),s("span",Gl,"⇅"))])])]),e("th",Ql,[e("div",Zl,[ie[27]||(ie[27]=xe(" 結業日期 ")),e("button",{onClick:ie[11]||(ie[11]=de=>j("endDate")),class:"ml-1 focus:outline-none"},[c.value==="endDate"&&b.value==="asc"?(t(),s("span",Xl,"▲")):c.value==="endDate"&&b.value==="desc"?(t(),s("span",en,"▼")):(t(),s("span",tn,"⇅"))])])]),e("th",sn,[e("div",an,[ie[28]||(ie[28]=xe(" 審核狀態 ")),e("button",{onClick:ie[12]||(ie[12]=de=>j("status")),class:"ml-1 focus:outline-none"},[c.value==="status"&&b.value==="asc"?(t(),s("span",on,"▲")):c.value==="status"&&b.value==="desc"?(t(),s("span",ln,"▼")):(t(),s("span",nn,"⇅"))])])]),ie[30]||(ie[30]=e("th",{class:"border p-2"},"審核內容",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(y.value,(de,ae)=>(t(),s("tr",{key:de.id},[e("td",rn,l((r.value-1)*f.value+ae+1),1),e("td",dn,l(O(de.area)),1),e("td",un,l(de.schoolName),1),e("td",cn,l(de.courseCode),1),e("td",pn,l(de.courseName),1),e("td",vn,l(_(de.startDate)),1),e("td",mn,l(_(de.endDate)),1),e("td",bn,l(E(de.status)),1),e("td",fn,[e("button",{onClick:ce=>ke(de.id),class:"px-4 py-1 bg-[#3e4346] text-white hover:bg-[#4e5356] mr-2"}," 審核表單 ",8,yn)])]))),128)),y.value.length===0?(t(),s("tr",gn,ie[31]||(ie[31]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])]),V.value>0?(t(),s("div",xn,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:r.value===1,onClick:U}," 上一頁 ",8,hn),(t(!0),s(Z,null,re(W.value,de=>(t(),s(Z,{key:de},[de!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":de===r.value}]),onClick:ae=>R(de)},l(de),11,wn)):(t(),s("span",_n,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:r.value===V.value,onClick:te}," 下一頁 ",8,kn)])):J("",!0)]))]),De.value?(t(),s("div",$n,[e("div",Cn,[ie[33]||(ie[33]=e("h3",{class:"text-lg font-medium mb-4"},"匯入課程計畫",-1)),e("div",En,[e("div",Sn,[e("input",{type:"file",ref_key:"fileInput",ref:$e,class:"hidden",onChange:le,accept:".xlsx,.xls,.csv"},null,544),e("p",Dn,l(ve.value?ve.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:fe,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),q.value?(t(),s("p",Mn,l(q.value),1)):J("",!0)]),e("div",An,[e("button",{onClick:Y,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:oe.value}," 取消 ",8,In),e("button",{onClick:Q,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!ve.value||oe.value},l(oe.value?"上傳中...":"上傳"),9,Rn)])])])):J("",!0)],64))}},Un=Le(Pn,[["__scopeId","data-v-a56f880f"]]),jt={getCourses:D=>he.get("/v1/course",{params:D}),getCourseById:D=>he.get(`/v1/course/${D}`),updateCourse:(D,x)=>he.put(`/v1/course/${D}`,x),getAbsenceHistory:D=>he.get("/v1/absence",{params:D}),exportCourses:D=>he.post("/v1/course/export",D,{responseType:"blob"}),updateCourseStatus:(D,x)=>he.put(`/v1/course/status/${D}`,x),checkCourseImport:D=>he.post("/v1/course/importCheck",D,{headers:{"Content-Type":"multipart/form-data"}}),importCourses:D=>he.post("/v1/course/import",D,{headers:{"Content-Type":"multipart/form-data"}}),deleteCourse:D=>he.delete(`/v1/course/${D}`),addCourseStudent:D=>he.post("/v1/course",D),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),importSurvey:D=>he.post("/v1/survey",D,{headers:{"Content-Type":"multipart/form-data"}})},Nn={class:"flex flex-col items-center p-6"},Tn={class:"w-full max-w-[1500px]"},Vn={class:"w-full max-w-[1500px]"},jn={class:"flex items-center space-x-4 mb-4"},Ln={class:"relative w-72"},Fn={class:"w-full max-w-[1500px]"},qn={class:"flex items-center space-x-4"},On=["value"],Bn=["value"],Hn=["value"],Wn=["value"],zn=["value"],Kn={class:"w-full max-w-[1500px]"},Jn={key:0,class:"flex justify-center items-center py-10"},Yn={key:1,class:"w-full border-collapse"},Gn={class:"bg-[#EEEFE7]"},Qn={class:"border p-2"},Zn={class:"flex flex-col items-center"},Xn={key:0},er={key:1},tr={key:2},sr={class:"border p-2"},ar={class:"flex flex-col items-center"},or={key:0},lr={key:1},nr={key:2},rr={class:"border p-2"},ir={class:"flex flex-col items-center"},dr={key:0},ur={key:1},cr={key:2},pr={class:"border p-2"},vr={class:"flex flex-col items-center"},mr={key:0},br={key:1},fr={key:2},yr={class:"border p-2"},gr={class:"flex flex-col items-center"},xr={key:0},hr={key:1},wr={key:2},_r={class:"border p-2"},kr={class:"flex flex-col items-center"},$r={key:0},Cr={key:1},Er={key:2},Sr={class:"border p-2"},Dr={class:"flex flex-col items-center"},Mr={key:0},Ar={key:1},Ir={key:2},Rr={class:"border p-2"},Pr={class:"flex flex-col items-center"},Ur={key:0},Nr={key:1},Tr={key:2},Vr={class:"border p-2"},jr={class:"flex flex-col items-center"},Lr={key:0},Fr={key:1},qr={key:2},Or={class:"border p-2"},Br={class:"flex flex-col items-center"},Hr={key:0},Wr={key:1},zr={key:2},Kr={class:"border p-2"},Jr={class:"flex flex-col items-center"},Yr={key:0},Gr={key:1},Qr={key:2},Zr={class:"border p-2"},Xr={class:"flex flex-col items-center"},ei={key:0},ti={key:1},si={key:2},ai=["onClick"],oi={class:"border p-2 text-center"},li={class:"border p-2 text-center"},ni={class:"border p-2 text-center"},ri={class:"border p-2 text-center"},ii={class:"border p-2 text-center"},di=["onUpdate:modelValue","onChange"],ui={class:"border p-2 text-center"},ci={class:"border p-2 text-center"},pi={class:"border p-2 text-center"},vi={class:"border p-2 text-center"},mi={class:"border p-2 text-center"},bi={class:"border p-2 text-center"},fi={key:0},yi={key:2,class:"flex justify-center items-center space-x-2 mt-6"},gi=["disabled"],xi=["onClick"],hi={key:1,class:"px-2"},wi=["disabled"],_i={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ki={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},$i={class:"mb-4"},Ci={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Ei={class:"mb-2"},Si={key:0,class:"text-red-500 text-sm mt-2"},Di={class:"flex justify-end space-x-2"},Mi=["disabled"],Ai={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ii={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Ri={class:"mb-4"},Pi={class:"space-y-3"},Ui=20,Ni={__name:"Course",setup(D){const x=We(),d=lt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),$=m(""),P=m([]),T=m([]),z=m([]),g=m([{value:"",label:"請選擇課程類型"},{value:"1",label:"資安職能課程"},{value:"2",label:"學分課程"}]),a=m(""),A=m("asc"),G=Se(()=>{const i=new Date().getFullYear()-1911,n=[];for(let h=i;h>=113;h--)n.push(h);return n}),k=m(1),c=m(1),b=m(0),r=m(!1),f=m([]),p=Se(()=>c.value<=5?w(c.value):y(k.value,c.value,5)),w=i=>{const n=[];for(let h=1;h<=i;h++)n.push(h);return n},y=(i,n,h)=>{const be=[],_e=Math.floor(h/2);let Ve=i-_e,st=i+_e;Ve<1?(Ve=1,st=h):st>n&&(st=n,Ve=n-h+1),V(be,Ve);for(let it=Ve;it<=st;it++)be.push(it);return W(be,st,n),be},V=(i,n)=>{n<=1||(i.push(1),n>2&&i.push("..."))},W=(i,n,h)=>{n>=h||(n<h-1&&i.push("..."),i.push(h))},O=m({courseDataCreate:!1,courseDataImport:!1,courseDataExport:!1}),_=async()=>{try{const i=await tt.getSidebarPermissions();i.data.code===0&&i.data.message==="success"?(O.value=i.data.data,console.log("課程頁面權限:",O.value)):console.error("獲取權限失敗:",i.data.message)}catch(i){console.error("獲取權限錯誤:",i)}},E=async()=>{try{const i=await ot.getSchoolOptions();i.data.code===0&&i.data.message==="success"?P.value=i.data.data:console.error("獲取學校選項失敗:",i.data.message)}catch(i){console.error("獲取學校選項錯誤:",i)}},L=async()=>{try{const i=await ot.getCourseOptions();if(i.data.code===0&&i.data.message==="success")if(i.data.data&&Array.isArray(i.data.data)){const n=[];i.data.data.forEach(h=>{h.items&&Array.isArray(h.items)?h.items.forEach(be=>{n.push({id:be.id,name:be.name,categoryId:h.id,categoryName:h.name})}):n.push({id:h.id,name:h.name})}),T.value=n}else T.value=i.data.data||[];else console.error("獲取科目選項失敗:",i.data.message)}catch(i){console.error("獲取科目選項錯誤:",i)}},j=async()=>{try{if(!C.value){z.value=Array.from({length:12},(n,h)=>({value:String(h+1),label:`${h+1}月`}));return}const i=await ot.getCourseMonths(C.value);i.data.code===0&&i.data.message==="success"?(z.value=i.data.data.map(n=>({value:String(n),label:`${n}月`})),K.value&&!z.value.find(n=>n.value===K.value)&&(K.value="")):(console.error("獲取月份選項失敗:",i.data.message),z.value=Array.from({length:12},(n,h)=>({value:String(h+1),label:`${h+1}月`})))}catch(i){console.error("獲取月份選項錯誤:",i),z.value=Array.from({length:12},(n,h)=>({value:String(h+1),label:`${h+1}月`}))}},R=async()=>{var i;try{r.value=!0,console.log("開始獲取課程列表...");const n={page:k.value,limit:Ui,year:C.value||null,school:o.value||null,subjectId:N.value||null,courseType:$.value||null,month:K.value||null,keyword:u.value||null,sortBy:a.value,sortOrder:A.value};console.log("API請求參數:",n);const h=await jt.getCourses(n);console.log("API回應:",h.data),h.data.code===0?h.data.data&&h.data.data.result?(f.value=h.data.data.result||[],b.value=h.data.data.totalCount||0,c.value=h.data.data.totalPage||1,console.log("獲取成功，總數:",b.value)):(console.error("API回應缺少 result 欄位"),f.value=[],b.value=0,c.value=0):(console.error("獲取課程列表失敗:",h.data.message),f.value=[],b.value=0,c.value=0,v.showError("載入失敗",((i=h.data)==null?void 0:i.message)||"無法獲取課程列表，請稍後再試"))}catch(n){console.error("獲取課程列表錯誤:",n),f.value=[],b.value=0,c.value=0,v.showError("載入失敗",n.message||"無法獲取課程列表，請稍後再試")}finally{console.log("加載狀態設為false"),r.value=!1}},U=()=>{u.value=""},te=()=>{k.value=1,R()},ue=()=>{k.value=1,R()},ye=i=>{i!==k.value&&(k.value=i)},ke=()=>{k.value>1&&k.value--},De=()=>{k.value<c.value&&k.value++},$e=(i,n="default")=>{if(i===-1||i==="-1")return"缺";if(n==="school"&&P.value.length>0){const h=P.value.find(be=>be.id===i);return h?h.name:i}return n==="status"&&{1:"授課中",2:"已結業",3:"已取消",4:"未開課"}[i]||i},ve=i=>{a.value===i?A.value=A.value==="asc"?"desc":"asc":(a.value=i,A.value="asc"),k.value=1,R()},oe=i=>{if(i){const n={page:k.value,year:C.value,school:o.value,subjectId:N.value,courseType:$.value,month:K.value,searchKeyword:u.value,sortBy:a.value,sortOrder:A.value};x.replace({path:x.currentRoute.value.path,query:n});const h=Object.entries(n).reduce((be,[_e,Ve])=>(Ve!==void 0&&Ve!==""&&(be[_e]=Ve),be),{});console.log("從課程頁面跳轉到課程編輯頁面，保留原始頁碼:",k.value),x.push({path:`/course-edit/${i}`,query:{...h,from:"course"}})}},q=()=>{x.push("/add-course-student")},S=()=>{const{page:i,year:n,school:h,searchKeyword:be,subjectId:_e,month:Ve,courseType:st,sortBy:it,sortOrder:ut}=d.query;i&&(k.value=parseInt(i)),n&&(C.value=n),h&&(o.value=h),_e&&(N.value=_e),st&&($.value=st),Ve&&(K.value=Ve),be&&(be.value=be),it&&(a.value=it),ut&&(A.value=ut)};Ee(()=>d.query,(i,n)=>{if(JSON.stringify(i)!==JSON.stringify(n)&&(console.log("URL參數變更，恢復狀態:",i),Object.keys(i).length>0)){S();const h=n.page!==i.page&&i.page,be=n.year!==i.year||n.school!==i.school||n.subjectId!==i.subjectId||n.month!==i.month||n.courseType!==i.courseType||n.searchKeyword!==i.searchKeyword||n.sortBy!==i.sortBy||n.sortOrder!==i.sortOrder;(h||be)&&R()}},{deep:!0}),Ee(C,()=>{j()}),Ee(k,i=>{x.replace({path:x.currentRoute.value.path,query:{...d.query,page:i.toString()}}),R()}),je(()=>{E(),L(),j(),_(),S(),R()});const Y=m(!1),fe=()=>{Y.value=!0},le=()=>{Y.value=!1},Q=async i=>{if(i)await se(i);else try{const n=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(n===null||n==="")return;const h=await jt.confirmPassword(n);if(h.data.code!==0){v.showError("密碼錯誤",h.data.message||"管理員密碼驗證失敗");return}const be=await v.promptAsync("請輸入檔案密碼","請為匯出的檔案設置密碼","password");if(be===null||be==="")return;await se(i,be)}catch(n){console.error("密碼驗證或檔案匯出過程錯誤:",n),v.showError("匯出失敗","驗證過程中發生錯誤，請稍後再試");return}le()},se=async(i,n="")=>{try{const h={year:C.value||null,school:o.value||null,subjectId:N.value||null,courseType:$.value||null,month:K.value||null,keyword:u.value||null,isHidden:i,password:n},be=await jt.exportCourses(h),_e=be.headers["content-type"];if(!_e||!_e.includes("spreadsheetml.sheet"))try{const qe=new Blob([be.data],{type:"application/json"}),gt=await new Response(qe).text(),vt=JSON.parse(gt);console.error("匯出課程失敗：伺服器返回錯誤：",vt),v.showError("匯出失敗",vt.message||"匯出過程中發生錯誤，請稍後再試");return}catch(qe){console.error("匯出課程失敗：無法解析回應內容",qe),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const Ve=new Blob([be.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),st=window.URL.createObjectURL(Ve),it=document.createElement("a");it.href=st;const ut=i?"隱蔽加密版":"無隱蔽版",ht=`課程資料_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}_${ut}.xlsx`;it.setAttribute("download",ht),document.body.appendChild(it),it.click(),document.body.removeChild(it),window.URL.revokeObjectURL(st),v.showSuccess("匯出成功","課程資料已成功匯出為 Excel 檔案")}catch(h){if(console.error("匯出課程失敗:",h),h.response&&h.response.data){const be=h.response.data;v.showError("匯出失敗",be.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},ie=async(i,n)=>{var h;try{const be=await jt.updateCourseStatus(i,{id:i,status:parseInt(n)});be.data&&be.data.code===0?v.showSuccess("更新成功","課程狀態已更新"):v.showError("更新失敗",((h=be.data)==null?void 0:h.message)||"更新課程狀態時發生錯誤")}catch(be){console.error("更新課程狀態錯誤:",be),v.showError("更新失敗","更新課程狀態時發生錯誤，請稍後再試")}},de=m(!1),ae=m(null),ce=m(null),Ie=m(!1),Be=m(""),me=()=>{de.value=!0,ce.value=null,Be.value=""},pe=()=>{de.value=!1,ce.value=null,Be.value=""},we=()=>{ae.value.click()},He=i=>{const n=i.target.files[0];if(n){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(n.type)&&!n.name.endsWith(".xlsx")&&!n.name.endsWith(".xls")&&!n.name.endsWith(".csv")){Be.value="請選擇 .xlsx 檔案",ce.value=null,i.target.value=null;return}ce.value=n,Be.value=""}},ge=async()=>{var i,n,h;if(!ce.value){Be.value="請選擇要上傳的檔案";return}try{Ie.value=!0,Be.value="";const be=new FormData;be.append("file",ce.value);const _e=await jt.checkCourseImport(be);if(_e.data&&_e.data.code===0)await H(be);else{const Ve=((i=_e.data)==null?void 0:i.message)||"部分課程已存在，是否確定要繼續匯入？";await v.confirmAsync("確認匯入",Ve)?await H(be):Ie.value=!1}}catch(be){console.error("上傳課程檔案錯誤:",be),Be.value=((h=(n=be.response)==null?void 0:n.data)==null?void 0:h.message)||"上傳過程中發生錯誤，請稍後再試",v.showError("上傳失敗",Be.value),Ie.value=!1}},H=async i=>{var n,h,be;try{const _e=await jt.importCourses(i);if(_e.data&&_e.data.code===0){const Ve=_e.data.message?_e.data.message.replace(/\r\n|\n|\r/g,"<br>"):"課程資料已成功匯入";v.showInfo("上傳成功",Ve);const st=()=>{pe(),R(),document.removeEventListener("info_close",st)};document.addEventListener("info_close",st)}else Be.value=((n=_e.data)==null?void 0:n.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",Be.value)}catch(_e){console.error("匯入課程檔案錯誤:",_e),Be.value=((be=(h=_e.response)==null?void 0:h.data)==null?void 0:be.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",Be.value)}finally{Ie.value=!1}};return(i,n)=>(t(),s(Z,null,[e("div",Nn,[e("div",Tn,[Qe(pt,{breadcrumbs:[{name:"課程內容",path:"/course"}]})]),e("div",Vn,[e("div",jn,[n[22]||(n[22]=e("span",null,"關鍵字查詢:",-1)),e("div",Ln,[I(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=h=>u.value=h),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"訓練單位/課程名稱",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ne(te,["enter"]),"aria-label":"關鍵字搜尋輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:U,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},n[21]||(n[21]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:te}," 搜尋 "),n[23]||(n[23]=e("div",{class:"flex-grow"},null,-1)),O.value.courseDataImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:me}," 匯入課程名單 ")):J("",!0),O.value.courseDataCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:q}," 新增課程名單 ")):J("",!0)])]),e("div",Fn,[e("div",qn,[n[28]||(n[28]=e("span",null,"查詢班級:",-1)),I(e("select",{"onUpdate:modelValue":n[1]||(n[1]=h=>C.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[n[24]||(n[24]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(G.value,h=>(t(),s("option",{key:h,value:h},l(h)+"年 ",9,On))),128))],544),[[Pe,C.value]]),I(e("select",{"onUpdate:modelValue":n[2]||(n[2]=h=>K.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[n[25]||(n[25]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(Z,null,re(z.value,h=>(t(),s("option",{key:h.value,value:h.value},l(h.label),9,Bn))),128))],544),[[Pe,K.value]]),I(e("select",{"onUpdate:modelValue":n[3]||(n[3]=h=>o.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[n[26]||(n[26]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(Z,null,re(P.value,h=>(t(),s("option",{key:h.id,value:h.id},l(h.name),9,Hn))),128))],544),[[Pe,o.value]]),I(e("select",{"onUpdate:modelValue":n[4]||(n[4]=h=>N.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[n[27]||(n[27]=e("option",{value:""},"請選擇科目名稱",-1)),(t(!0),s(Z,null,re(T.value,h=>(t(),s("option",{key:h.id,value:h.id},l(h.name),9,Wn))),128))],544),[[Pe,N.value]]),I(e("select",{"onUpdate:modelValue":n[5]||(n[5]=h=>$.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ue,["enter"])},[(t(!0),s(Z,null,re(g.value,h=>(t(),s("option",{key:h.value,value:h.value},l(h.label),9,zn))),128))],544),[[Pe,$.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:ue}," 搜尋 "),n[29]||(n[29]=e("div",{class:"flex-grow"},null,-1)),O.value.courseDataExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:fe}," 匯出 Excel ")):J("",!0)])]),n[45]||(n[45]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Kn,[r.value?(t(),s("div",Jn,n[30]||(n[30]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Yn,[e("thead",null,[e("tr",Gn,[e("th",Qn,[e("div",Zn,[n[31]||(n[31]=e("span",null,"課程編號",-1)),e("button",{onClick:n[6]||(n[6]=h=>ve("courseCode")),class:"mt-1 focus:outline-none"},[a.value==="courseCode"&&A.value==="asc"?(t(),s("span",Xn,"▲")):a.value==="courseCode"&&A.value==="desc"?(t(),s("span",er,"▼")):(t(),s("span",tr,"⇅"))])])]),e("th",sr,[e("div",ar,[n[32]||(n[32]=e("span",null,"訓練單位",-1)),e("button",{onClick:n[7]||(n[7]=h=>ve("school")),class:"mt-1 focus:outline-none"},[a.value==="school"&&A.value==="asc"?(t(),s("span",or,"▲")):a.value==="school"&&A.value==="desc"?(t(),s("span",lr,"▼")):(t(),s("span",nr,"⇅"))])])]),e("th",rr,[e("div",ir,[n[33]||(n[33]=e("span",null,"課程名稱",-1)),e("button",{onClick:n[8]||(n[8]=h=>ve("courseName")),class:"mt-1 focus:outline-none"},[a.value==="courseName"&&A.value==="asc"?(t(),s("span",dr,"▲")):a.value==="courseName"&&A.value==="desc"?(t(),s("span",ur,"▼")):(t(),s("span",cr,"⇅"))])])]),e("th",pr,[e("div",vr,[n[34]||(n[34]=e("span",null,"開課日期",-1)),e("button",{onClick:n[9]||(n[9]=h=>ve("startDate")),class:"mt-1 focus:outline-none"},[a.value==="startDate"&&A.value==="asc"?(t(),s("span",mr,"▲")):a.value==="startDate"&&A.value==="desc"?(t(),s("span",br,"▼")):(t(),s("span",fr,"⇅"))])])]),e("th",yr,[e("div",gr,[n[35]||(n[35]=e("span",null,"結業日期",-1)),e("button",{onClick:n[10]||(n[10]=h=>ve("endDate")),class:"mt-1 focus:outline-none"},[a.value==="endDate"&&A.value==="asc"?(t(),s("span",xr,"▲")):a.value==="endDate"&&A.value==="desc"?(t(),s("span",hr,"▼")):(t(),s("span",wr,"⇅"))])])]),e("th",_r,[e("div",kr,[n[36]||(n[36]=e("span",null,"課程狀態",-1)),e("button",{onClick:n[11]||(n[11]=h=>ve("status")),class:"mt-1 focus:outline-none"},[a.value==="status"&&A.value==="asc"?(t(),s("span",$r,"▲")):a.value==="status"&&A.value==="desc"?(t(),s("span",Cr,"▼")):(t(),s("span",Er,"⇅"))])])]),e("th",Sr,[e("div",Dr,[n[37]||(n[37]=e("span",null,"報名人數",-1)),e("button",{onClick:n[12]||(n[12]=h=>ve("registered")),class:"mt-1 focus:outline-none"},[a.value==="registered"&&A.value==="asc"?(t(),s("span",Mr,"▲")):a.value==="registered"&&A.value==="desc"?(t(),s("span",Ar,"▼")):(t(),s("span",Ir,"⇅"))])])]),e("th",Rr,[e("div",Pr,[n[38]||(n[38]=e("span",null,"開課人數",-1)),e("button",{onClick:n[13]||(n[13]=h=>ve("classSize")),class:"mt-1 focus:outline-none"},[a.value==="classSize"&&A.value==="asc"?(t(),s("span",Ur,"▲")):a.value==="classSize"&&A.value==="desc"?(t(),s("span",Nr,"▼")):(t(),s("span",Tr,"⇅"))])])]),e("th",Vr,[e("div",jr,[n[39]||(n[39]=e("span",null,"結訓人數",-1)),e("button",{onClick:n[14]||(n[14]=h=>ve("graduates")),class:"mt-1 focus:outline-none"},[a.value==="graduates"&&A.value==="asc"?(t(),s("span",Lr,"▲")):a.value==="graduates"&&A.value==="desc"?(t(),s("span",Fr,"▼")):(t(),s("span",qr,"⇅"))])])]),e("th",Or,[e("div",Br,[n[40]||(n[40]=e("span",null,"結訓比率",-1)),e("button",{onClick:n[15]||(n[15]=h=>ve("graduationRate")),class:"mt-1 focus:outline-none"},[a.value==="graduationRate"&&A.value==="asc"?(t(),s("span",Hr,"▲")):a.value==="graduationRate"&&A.value==="desc"?(t(),s("span",Wr,"▼")):(t(),s("span",zr,"⇅"))])])]),e("th",Kr,[e("div",Jr,[n[41]||(n[41]=e("span",null,"問卷人數",-1)),e("button",{onClick:n[16]||(n[16]=h=>ve("respondents")),class:"mt-1 focus:outline-none"},[a.value==="respondents"&&A.value==="asc"?(t(),s("span",Yr,"▲")):a.value==="respondents"&&A.value==="desc"?(t(),s("span",Gr,"▼")):(t(),s("span",Qr,"⇅"))])])]),e("th",Zr,[e("div",Xr,[n[42]||(n[42]=e("span",null,"課程滿意度",-1)),e("button",{onClick:n[17]||(n[17]=h=>ve("satisfactionRate")),class:"mt-1 focus:outline-none"},[a.value==="satisfactionRate"&&A.value==="asc"?(t(),s("span",ei,"▲")):a.value==="satisfactionRate"&&A.value==="desc"?(t(),s("span",ti,"▼")):(t(),s("span",si,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(f.value,h=>(t(),s("tr",{key:h.id,class:"hover:bg-gray-100 cursor-pointer",onClick:be=>oe(h.id)},[e("td",oi,l($e(h.courseCode)),1),e("td",li,l($e(h.school,"school")),1),e("td",ni,l($e(h.courseName)),1),e("td",ri,l($e(h.startDate)),1),e("td",ii,l($e(h.endDate)),1),e("td",{class:"border p-2 text-center",onClick:n[18]||(n[18]=Ot(()=>{},["stop"]))},[I(e("select",{class:"p-1 border border-gray-300 outline-none w-full bg-white","onUpdate:modelValue":be=>h.status=be,onChange:be=>ie(h.id,h.status)},n[43]||(n[43]=[e("option",{value:"1"},"授課中",-1),e("option",{value:"2"},"已結業",-1),e("option",{value:"3"},"已取消",-1),e("option",{value:"4"},"未開課",-1)]),40,di),[[Pe,h.status]])]),e("td",ui,l($e(h.registered)),1),e("td",ci,l($e(h.classSize)),1),e("td",pi,l($e(h.graduates)),1),e("td",vi,l($e(h.graduationRate))+"%",1),e("td",mi,l($e(h.respondents)),1),e("td",bi,l($e(h.satisfactionRate))+"%",1)],8,ai))),128)),f.value.length===0?(t(),s("tr",fi,n[44]||(n[44]=[e("td",{colspan:"12",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])),!r.value&&f.value.length>0?(t(),s("div",yi,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:k.value===1,onClick:ke}," 上一頁 ",8,gi),(t(!0),s(Z,null,re(p.value,h=>(t(),s(Z,{key:h},[h!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":h===k.value}]),onClick:be=>ye(h)},l(h),11,xi)):(t(),s("span",hi,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:k.value===c.value,onClick:De}," 下一頁 ",8,wi)])):J("",!0)])]),de.value?(t(),s("div",_i,[e("div",ki,[n[46]||(n[46]=e("h3",{class:"text-lg font-medium mb-4"},"匯入課程",-1)),e("div",$i,[e("div",Ci,[e("input",{type:"file",ref_key:"fileInput",ref:ae,class:"hidden",onChange:He,accept:".xlsx,.xls,.csv"},null,544),e("p",Ei,l(ce.value?ce.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:we,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),Be.value?(t(),s("p",Si,l(Be.value),1)):J("",!0)]),e("div",Di,[e("button",{onClick:pe,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 "),e("button",{onClick:ge,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!ce.value||Ie.value},l(Ie.value?"上傳中...":"上傳"),9,Mi)])])])):J("",!0),Y.value?(t(),s("div",Ai,[e("div",Ii,[n[47]||(n[47]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",Ri,[e("div",Pi,[e("button",{onClick:n[19]||(n[19]=h=>Q(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:n[20]||(n[20]=h=>Q(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:le,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):J("",!0)],64))}},Ti=Le(Ni,[["__scopeId","data-v-5325d679"]]),Vi={class:"flex flex-col items-center p-6"},ji={class:"w-full max-w-[1500px] mb-6"},Li={class:"flex items-center space-x-4"},Fi=["value"],qi=["value"],Oi=["disabled"],Bi=["value"],Hi={class:"w-full max-w-[1500px] mb-6 text-sm"},Wi={class:"w-full max-w-[1500px]"},zi={key:0,class:"flex justify-center items-center py-10"},Ki={key:1,class:"w-full border"},Ji=["onClick"],Yi={class:"border p-2 text-center"},Gi={class:"border p-2 text-center"},Qi={class:"border p-2 text-center"},Zi={class:"border p-2 text-center"},Xi={class:"border p-2 text-center"},ed={class:"border p-2 text-center"},td={class:"border p-2 text-center"},sd={class:"border p-2 text-center"},ad={key:2,class:"text-center py-10 text-gray-500"},od={key:3,class:"flex justify-center items-center space-x-2 mt-6"},ld=["disabled"],nd=["onClick"],rd=["disabled"],id=20,dd={__name:"Attendance",setup(D){const x=We(),d=lt(),u=m(1),C=m(""),o=m(""),N=m(""),K=m([]),$=m([]),P=m([]),T=m(!1),z=m({school:"",courseName:"",startDate:"",endDate:"",trainStudent:0,graduates:0}),g=m(0),a=m(0),A=Se(()=>{const W=new Date().getFullYear()-1911,O=[];for(let _=W;_>=113;_--)O.push(_);return O}),G=Se(()=>C.value&&o.value),k=async()=>{try{const W=await ot.getSchoolOptions();W.data.code===0&&W.data.message==="success"?K.value=W.data.data:console.error("獲取學校選項失敗:",W.data.message)}catch(W){console.error("獲取學校選項錯誤:",W)}},c=async()=>{try{const W={year:C.value,school:o.value},O=await ot.getCourseData(W);O.data.code===0&&O.data.message==="success"?$.value=O.data.data:(console.error("獲取課程選項失敗:",O.data.message),$.value=[])}catch(W){console.error("獲取課程選項錯誤:",W),$.value=[]}},b=()=>{N.value="",$.value=[],C.value&&o.value&&c()};Ee(N,W=>{W&&(u.value=1,r())});const r=async()=>{var W,O;try{T.value=!0;const _={page:u.value,limit:id,id:N.value},E=await jt.getAbsenceHistory(_);if(((W=E==null?void 0:E.data)==null?void 0:W.code)===0){const{school:L,courseName:j,startDate:R,endDate:U,trainStudent:te,graduates:ue,list:ye}=E.data.data.result;g.value=E.data.data.totalCount,a.value=E.data.data.totalPage,z.value={school:L,courseName:j,startDate:R,endDate:U,trainStudent:te,graduates:ue},P.value=ye.map(ke=>({id:ke.id,studentId:ke.studentId===-1||ke.studentId==="-1"?"缺":ke.studentId,name:ke.name,absenceHours:ke.absenceHours===-1||ke.absenceHours==="-1"?"缺":ke.absenceHours,attendanceHours:ke.classHours===-1||ke.classHours==="-1"?"缺":ke.classHours,satisfaction:ke.satisfaction===-1||ke.satisfaction==="-1"?"缺":ke.satisfaction,credits:ke.earnedCredits===-1||ke.earnedCredits==="-1"?"缺":ke.earnedCredits,grade:ke.grade===-1||ke.grade==="-1"?"缺":ke.grade,certificateNo:ke.certificateNumber===-1||ke.certificateNumber==="-1"?"缺":ke.certificateNumber}))}else console.error("獲取出席資料失敗:",((O=E==null?void 0:E.data)==null?void 0:O.message)||"未知錯誤"),P.value=[],g.value=0,a.value=0}catch(_){console.error("獲取出席資料錯誤:",_),P.value=[],g.value=0,a.value=0}finally{T.value=!1}};Ee(u,()=>{N.value&&r()});const f=async()=>{d.query.page&&(u.value=parseInt(d.query.page,10)||1),d.query.year&&(C.value=d.query.year),d.query.school&&(o.value=d.query.school,C.value&&o.value&&await c()),d.query.course&&(N.value=d.query.course,N.value&&r())};je(async()=>{await k(),await f()});const p=W=>{u.value=W},w=()=>{u.value>1&&u.value--},y=()=>{u.value<a.value&&u.value++},V=W=>{if(W){const O={from:"attendance",page:u.value,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0};x.push({name:"Single",params:{id:W},query:O})}};return(W,O)=>(t(),s("div",Vi,[O[9]||(O[9]=e("div",{class:"w-full max-w-[1500px]-w-[1500px]-w-[1500px] mb-6"},[e("h2",{class:"text-2xl font-bold"},"出缺勤")],-1)),e("div",ji,[e("div",Li,[O[6]||(O[6]=e("span",null,"查詢班級:",-1)),I(e("select",{"onUpdate:modelValue":O[0]||(O[0]=_=>C.value=_),class:"p-2 border border-gray-300 outline-none w-40",onChange:b},[O[3]||(O[3]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(A.value,_=>(t(),s("option",{key:_,value:_},l(_)+"年 ",9,Fi))),128))],544),[[Pe,C.value]]),I(e("select",{"onUpdate:modelValue":O[1]||(O[1]=_=>o.value=_),class:"p-2 border border-gray-300 outline-none w-40",onChange:b},[O[4]||(O[4]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(Z,null,re(K.value,_=>(t(),s("option",{key:_.id,value:_.id},l(_.name),9,qi))),128))],544),[[Pe,o.value]]),I(e("select",{"onUpdate:modelValue":O[2]||(O[2]=_=>N.value=_),class:"p-2 border border-gray-300 outline-none w-40",disabled:!G.value},[O[5]||(O[5]=e("option",{value:""},"請選擇課程名稱",-1)),(t(!0),s(Z,null,re($.value,_=>(t(),s("option",{key:_.id,value:_.id},l(_.name),9,Bi))),128))],8,Oi),[[Pe,N.value]])])]),e("div",Hi,[e("div",null,"訓練單位: "+l(z.value.school),1),e("div",null,"訓練課程: "+l(z.value.courseName),1),e("div",null,"訓練日期: "+l(z.value.startDate)+"~"+l(z.value.endDate),1),e("div",null,"訓練人數: "+l(z.value.trainStudent)+" 結訓人數: "+l(z.value.graduates),1)]),e("div",Wi,[T.value?(t(),s("div",zi,O[7]||(O[7]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):P.value.length>0?(t(),s("table",Ki,[O[8]||(O[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"學號"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"缺課時數"),e("th",{class:"border p-2"},"上課時數"),e("th",{class:"border p-2"},"課程滿意度"),e("th",{class:"border p-2"},"取得學分數"),e("th",{class:"border p-2"},"成績"),e("th",{class:"border p-2"},"證書編號")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(P.value,_=>(t(),s("tr",{key:_.id,class:"cursor-pointer hover:bg-gray-100",onClick:E=>V(_.id)},[e("td",Yi,l(_.studentId),1),e("td",Gi,l(_.name),1),e("td",Qi,l(_.absenceHours),1),e("td",Zi,l(_.attendanceHours),1),e("td",Xi,l(_.satisfaction),1),e("td",ed,l(_.credits),1),e("td",td,l(_.grade),1),e("td",sd,l(_.certificateNo),1)],8,Ji))),128))])])):(t(),s("div",ad," 無符合條件的資料 ")),a.value>0?(t(),s("div",od,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===1,onClick:w}," 上一頁 ",8,ld),(t(!0),s(Z,null,re(a.value,_=>(t(),s("button",{key:_,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":_===u.value}]),onClick:E=>p(_)},l(_),11,nd))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===a.value,onClick:y}," 下一頁 ",8,rd)])):J("",!0)])]))}},ud=Le(dd,[["__scopeId","data-v-a2536600"]]),Ps={getVisitHistory:D=>he.get("/v1/visitHistory",{params:D}),getVisitHistoryById:D=>he.get(`/v1/visitHistory/${D}`),createVisitHistory:D=>he.post("/v1/visitHistory",D),updateVisitHistory:(D,x)=>he.put(`/v1/visitHistory/${D}`,x),exportVisitHistory:D=>he.get(`/v1/visitHistory/export/${D}`,{responseType:"blob"}),exportVisitHistoryTemp:D=>he.post("/v1/visitHistory/export",D,{responseType:"blob"})},cd={class:"flex flex-col items-center p-6"},pd={class:"w-full max-w-[1500px]"},vd={class:"w-full max-w-[1500px]"},md={class:"flex items-center space-x-4"},bd=["value"],fd={value:""},yd=["value"],gd={value:""},xd=["value"],hd=["disabled"],wd={class:"w-full max-w-[1500px]"},_d={class:"flex justify-between items-center mb-4"},kd={class:"overflow-auto"},$d={class:"w-full border-collapse"},Cd={class:"bg-[#EEEFE7]"},Ed={class:"border p-2"},Sd={class:"flex items-center justify-center"},Dd={key:0},Md={key:1},Ad={key:2},Id={class:"border p-2"},Rd={class:"flex items-center justify-center"},Pd={key:0},Ud={key:1},Nd={key:2},Td={class:"border p-2"},Vd={class:"flex items-center justify-center"},jd={key:0},Ld={key:1},Fd={key:2},qd={class:"border p-2"},Od={class:"flex items-center justify-center"},Bd={key:0},Hd={key:1},Wd={key:2},zd={class:"border p-2"},Kd={class:"flex items-center justify-center"},Jd={key:0},Yd={key:1},Gd={key:2},Qd={class:"border p-2"},Zd={class:"flex items-center justify-center"},Xd={key:0},eu={key:1},tu={key:2},su={class:"border p-2"},au={class:"flex items-center justify-center"},ou={key:0},lu={key:1},nu={key:2},ru=["onClick"],iu={class:"border p-2 text-center"},du={class:"border p-2 text-center"},uu={class:"border p-2 text-center"},cu={class:"border p-2 text-center"},pu={class:"border p-2 text-center"},vu={class:"border p-2 text-center"},mu={class:"border p-2 text-center"},bu={key:0},fu={colspan:"7",class:"border p-4 text-center"},yu={key:0,class:"flex justify-center items-center space-x-2 mt-6"},gu=["disabled"],xu=["onClick"],hu={key:1,class:"px-2"},wu=["disabled"],_u={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ku={class:"bg-white p-6 rounded-lg w-[500px]"},$u={class:"space-y-4"},Cu={class:"flex items-center"},Eu={class:"flex items-center"},Su={__name:"Supervision",setup(D){const x=We(),d=lt(),u=m([]),C=m([]),o=m(!1),N=m(!1),K=m(!1),$=m(1),P=m(10),T=m(1),z=m(0),g=m(""),a=m("asc");m(!1);const A=m(!1),G=m({label:"",value:""}),k=Se(()=>{const ve=new Date().getFullYear()-1911,oe=[];for(let q=ve;q>=113;q--)oe.push(q);return oe}),c=m([{id:1,label:"訪視單位:",value:"健行學校財團法人健行科技大學"},{id:2,label:"訪視日期:",value:"114/02/17"},{id:3,label:"訪視課程:",value:"資通安全管理"},{id:4,label:"訪視時間:",value:"20:00 (24小時制)"},{id:5,label:"訪視人員:",value:"王○明"}]),b=m([]);m([{id:1,filename:"",fileUrl:""},{id:2,filename:"",fileUrl:""},{id:3,filename:"",fileUrl:""}]);const r=m(""),f=m(""),p=m(""),w=Se(()=>{const ve=[];if(T.value<=5)for(let q=1;q<=T.value;q++)ve.push(q);else{ve.push(1);let q=Math.max(2,$.value-1),S=Math.min(T.value-1,$.value+1);$.value<=3&&(S=Math.min(4,T.value-1)),$.value>=T.value-2&&(q=Math.max(2,T.value-3)),q>2&&ve.push("...");for(let Y=q;Y<=S;Y++)ve.push(Y);S<T.value-1&&ve.push("..."),ve.push(T.value)}return ve}),y=async()=>{var ve;try{K.value=!0;const oe={page:$.value,limit:P.value,sortBy:g.value||void 0,sortOrder:a.value||void 0};r.value&&r.value!=="all"&&(oe.year=r.value),f.value&&(oe.school=f.value),p.value&&(oe.course=p.value);const q=await Ps.getVisitHistory(oe);q.data&&q.data.code===0?(b.value=q.data.data.list||[],z.value=q.data.data.totalCount||0,T.value=Math.ceil(z.value/P.value)||1):(console.error("獲取訪視資料失敗:",q.data),v.showError("載入失敗",((ve=q.data)==null?void 0:ve.message)||"獲取訪視資料失敗"),b.value=[],z.value=0,T.value=1)}catch(oe){console.error("獲取訪視資料失敗:",oe),v.showError("載入失敗",oe.message||"獲取訪視資料失敗"),b.value=[],z.value=0,T.value=1}finally{K.value=!1}},V=ve=>{const oe=u.value.find(q=>q.value===ve);return oe?oe.label:ve},W=ve=>{const oe=C.value.find(q=>q.value===ve);return oe?oe.label:ve},O=async()=>{try{o.value=!0;const ve=await ot.getSchoolOptions();ve.data&&ve.data.code===0&&Array.isArray(ve.data.data)?u.value=ve.data.data.map(oe=>({value:oe.id,label:oe.name})):(console.error("學校資料格式不正確:",ve.data),u.value=[])}catch(ve){console.error("獲取學校列表失敗:",ve),u.value=[]}finally{o.value=!1}},_=async ve=>{if(!ve){C.value=[],p.value="";return}try{N.value=!0;const oe=await ot.getCourseData({school:ve});oe.data&&oe.data.code===0&&Array.isArray(oe.data.data)?C.value=oe.data.data.map(q=>({value:q.id,label:q.name})):(console.error("課程資料格式不正確:",oe.data),C.value=[])}catch(oe){console.error("獲取課程列表失敗:",oe),p.value="",C.value=[]}finally{N.value=!1}};Ee(()=>f.value,ve=>{ve?_(ve):(C.value=[],p.value="")}),Ee($,()=>{y()});const E=ve=>{ve!==$.value&&($.value=ve)},L=()=>{$.value>1&&$.value--},j=()=>{$.value<T.value&&$.value++},R=ve=>{g.value===ve?a.value=a.value==="asc"?"desc":"asc":(g.value=ve,a.value="asc"),$.value=1,y()},U=()=>{if(!G.value.label){v.showError("新增欄位失敗","請輸入欄位名稱");return}c.value.push({id:c.value.length+1,label:G.value.label+":",value:G.value.value}),A.value=!1},te=()=>{A.value=!1},ue=ve=>{ve?x.push({path:"/checklist-edit",query:{id:ve}}):x.push({path:"/checklist-edit"})},ye=()=>{x.push({name:"Checklist"})},ke=()=>{d.query.page&&($.value=parseInt(d.query.page,10)||1),d.query.year&&(r.value=d.query.year),d.query.school&&(f.value=d.query.school),d.query.course&&(p.value=d.query.course),d.query.sortBy&&(g.value=d.query.sortBy),d.query.sortOrder&&(a.value=d.query.sortOrder)},De=m({visitCreate:!1}),$e=async()=>{try{const ve=await tt.getSidebarPermissions();ve.data.code===0&&ve.data.message==="success"?(De.value=ve.data.data,console.log("訪視督課頁面權限:",De.value)):console.error("獲取權限失敗:",ve.data.message)}catch(ve){console.error("獲取權限錯誤:",ve)}};return je(()=>{ke(),y(),O(),$e()}),(ve,oe)=>(t(),s("div",cd,[e("div",pd,[Qe(pt,{breadcrumbs:[{name:"訪視督課",path:"/supervision"}]})]),e("div",vd,[e("div",md,[oe[13]||(oe[13]=e("span",{id:"queryLabelSpan"},"查詢班級:",-1)),I(e("select",{id:"selectedYear","onUpdate:modelValue":oe[0]||(oe[0]=q=>r.value=q),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ne(y,["enter"])},[oe[12]||(oe[12]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(k.value,q=>(t(),s("option",{key:q,value:q},l(q)+"年 ",9,bd))),128))],544),[[Pe,r.value]]),I(e("select",{id:"selectedSchool","onUpdate:modelValue":oe[1]||(oe[1]=q=>f.value=q),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ne(y,["enter"])},[e("option",fd,l(o.value?"載入中...":"請選擇訓練單位"),1),(t(!0),s(Z,null,re(u.value,q=>(t(),s("option",{key:q.value,value:q.value},l(q.label),9,yd))),128))],544),[[Pe,f.value]]),I(e("select",{id:"selectedCourse","onUpdate:modelValue":oe[2]||(oe[2]=q=>p.value=q),class:"p-2 border border-gray-300 outline-none w-40","aria-labelledby":"queryLabelSpan",onKeyup:Ne(y,["enter"])},[e("option",gd,l(f.value?N.value?"載入中...":"請選擇課程名稱":"請先選擇訓練單位"),1),(t(!0),s(Z,null,re(C.value,q=>(t(),s("option",{key:q.value,value:q.value},l(q.label),9,xd))),128))],544),[[Pe,p.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:y,disabled:K.value}," 搜尋 ",8,hd)])]),oe[25]||(oe[25]=e("div",{class:"w-full max-w-[1500px] h-[1px] bg-gray-300 my-6"},null,-1)),e("div",wd,[e("div",_d,[oe[14]||(oe[14]=e("h2",{class:"text-2xl font-bold"},"訪查紀錄",-1)),De.value.visitCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:ye}," 新增訪視 ")):J("",!0)]),e("div",kd,[e("table",$d,[e("thead",null,[e("tr",Cd,[e("th",Ed,[e("div",Sd,[oe[15]||(oe[15]=xe(" 訪查單位 ")),e("button",{onClick:oe[3]||(oe[3]=q=>R("school")),class:"ml-1 focus:outline-none"},[g.value==="school"&&a.value==="asc"?(t(),s("span",Dd,"▲")):g.value==="school"&&a.value==="desc"?(t(),s("span",Md,"▼")):(t(),s("span",Ad,"⇅"))])])]),e("th",Id,[e("div",Rd,[oe[16]||(oe[16]=xe(" 訪查日期 ")),e("button",{onClick:oe[4]||(oe[4]=q=>R("visitDate")),class:"ml-1 focus:outline-none"},[g.value==="visitDate"&&a.value==="asc"?(t(),s("span",Pd,"▲")):g.value==="visitDate"&&a.value==="desc"?(t(),s("span",Ud,"▼")):(t(),s("span",Nd,"⇅"))])])]),e("th",Td,[e("div",Vd,[oe[17]||(oe[17]=xe(" 訪查課程 ")),e("button",{onClick:oe[5]||(oe[5]=q=>R("course")),class:"ml-1 focus:outline-none"},[g.value==="course"&&a.value==="asc"?(t(),s("span",jd,"▲")):g.value==="course"&&a.value==="desc"?(t(),s("span",Ld,"▼")):(t(),s("span",Fd,"⇅"))])])]),e("th",qd,[e("div",Od,[oe[18]||(oe[18]=xe(" 訪查時間 ")),e("button",{onClick:oe[6]||(oe[6]=q=>R("visitStartTime")),class:"ml-1 focus:outline-none"},[g.value==="visitStartTime"&&a.value==="asc"?(t(),s("span",Bd,"▲")):g.value==="visitStartTime"&&a.value==="desc"?(t(),s("span",Hd,"▼")):(t(),s("span",Wd,"⇅"))])])]),e("th",zd,[e("div",Kd,[oe[19]||(oe[19]=xe(" 訪查人員 ")),e("button",{onClick:oe[7]||(oe[7]=q=>R("visitor")),class:"ml-1 focus:outline-none"},[g.value==="visitor"&&a.value==="asc"?(t(),s("span",Jd,"▲")):g.value==="visitor"&&a.value==="desc"?(t(),s("span",Yd,"▼")):(t(),s("span",Gd,"⇅"))])])]),e("th",Qd,[e("div",Zd,[oe[20]||(oe[20]=xe(" 訪查方式 ")),e("button",{onClick:oe[8]||(oe[8]=q=>R("visitMethod")),class:"ml-1 focus:outline-none"},[g.value==="visitMethod"&&a.value==="asc"?(t(),s("span",Xd,"▲")):g.value==="visitMethod"&&a.value==="desc"?(t(),s("span",eu,"▼")):(t(),s("span",tu,"⇅"))])])]),e("th",su,[e("div",au,[oe[21]||(oe[21]=xe(" 查核得分 ")),e("button",{onClick:oe[9]||(oe[9]=q=>R("grade")),class:"ml-1 focus:outline-none"},[g.value==="grade"&&a.value==="asc"?(t(),s("span",ou,"▲")):g.value==="grade"&&a.value==="desc"?(t(),s("span",lu,"▼")):(t(),s("span",nu,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(b.value,q=>(t(),s("tr",{key:q.id,class:"hover:bg-gray-100 cursor-pointer",onClick:S=>ue(q.id)},[e("td",iu,l(V(q.school)),1),e("td",du,l(q.visitDate),1),e("td",uu,l(W(q.course)),1),e("td",cu,l(`${q.visitStartTime}-${q.visitEndTime}`),1),e("td",pu,l(q.visitor),1),e("td",vu,l(q.visitMethod===1?"線上訪查":"實地訪查"),1),e("td",mu,l(q.grade),1)],8,ru))),128)),b.value.length===0?(t(),s("tr",bu,[e("td",fu,l(K.value?"載入中...":"無符合條件的資料"),1)])):J("",!0)])])]),!K.value&&b.value.length>0?(t(),s("div",yu,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===1,onClick:L}," 上一頁 ",8,gu),(t(!0),s(Z,null,re(w.value,q=>(t(),s(Z,{key:q},[q!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":q===$.value}]),onClick:S=>E(q)},l(q),11,xu)):(t(),s("span",hu,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===T.value,onClick:j}," 下一頁 ",8,wu)])):J("",!0)]),A.value?(t(),s("div",_u,[e("div",ku,[oe[24]||(oe[24]=e("h3",{class:"text-xl font-bold mb-4"},"新增欄位",-1)),e("div",$u,[e("div",Cu,[oe[22]||(oe[22]=e("label",{class:"w-24 text-right mr-4",for:"newFieldLabel"},"欄位名稱:",-1)),I(e("input",{id:"newFieldLabel","onUpdate:modelValue":oe[10]||(oe[10]=q=>G.value.label=q),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none",placeholder:"請輸入欄位名稱"},null,512),[[ee,G.value.label]])]),e("div",Eu,[oe[23]||(oe[23]=e("label",{class:"w-24 text-right mr-4",for:"newFieldValue"},"預設值:",-1)),I(e("input",{id:"newFieldValue","onUpdate:modelValue":oe[11]||(oe[11]=q=>G.value.value=q),type:"text",class:"flex-1 p-2 border border-gray-300 outline-none",placeholder:"請輸入預設值（選填）"},null,512),[[ee,G.value.value]])])]),e("div",{class:"flex justify-end space-x-4 mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded",onClick:te}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",onClick:U}," 確認 ")])])])):J("",!0)]))}},Du=Le(Su,[["__scopeId","data-v-0f4db9dc"]]),Dt={getStudents:(D={})=>(D.page&&(D.page=Number(D.page)),D.limit?D.limit=Number(D.limit):D.limit=20,D.keyword===""&&delete D.keyword,console.log("studentApi.getStudents 參數:",D),console.log("studentApi.getStudents 關鍵字參數:",D.keyword),he.get("/v1/student",{params:D})),getStudentById:D=>he.get(`/v1/student/${D}`),updateStudent:D=>he.put(`/v1/student/${D.id}`,D),getLearnHistory:(D={})=>{const x={};return D.page?x.page=Number(D.page):x.page=1,D.limit?x.limit=Number(D.limit):x.limit=20,D.keyword&&D.keyword.trim()!==""&&(x.keyword=D.keyword.trim()),D.sortBy&&(x.sortBy=D.sortBy),D.sortOrder&&(x.sortOrder=D.sortOrder),console.log("studentApi.getLearnHistory 參數:",x),he.get("/v1/learnHistory",{params:x})},creditCertification:D=>he.post("/v1/creditCertification",D),uploadFiles:(D,x,d)=>{const u=new FormData;return D.forEach(C=>{u.append("files",C)}),x&&u.append("fileName",x),d&&u.append("folderName",d),he.post("/v1/upload/files",u,{headers:{"Content-Type":"multipart/form-data"}})},exportStudents:D=>he.post("/v1/student/export",D,{responseType:"blob"}),addStudent:D=>he.post("/v1/student",D),getLearnHistoryById:D=>he.get(`/v1/learnHistory/${D}`),updateLearnHistory:(D,x)=>he.put(`/v1/learnHistory/${D}`,x),getCreditList:(D={})=>(D.page&&(D.page=Number(D.page)),D.limit&&(D.limit=Number(D.limit)),console.log("studentApi.getCreditList 參數:",D),he.get("/v1/creditCertification",{params:D})),updateCreditStatus:(D,x)=>he.put(`/v1/creditCertification/status/${D}`,{id:Number(D),status:Number(x)}),importCreditCertification:D=>he.post("/v1/creditCertification/import",D,{headers:{"Content-Type":"multipart/form-data"}}),importStudents:D=>he.post("/v1/student/import",D,{headers:{"Content-Type":"multipart/form-data"}}),deleteStudent:D=>he.delete(`/v1/student/${D}`),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),getCreditCertificationById:D=>he.get(`/v1/creditCertification/${D}`),updateCreditCertification:(D,x)=>he.put(`/v1/creditCertification/${D}`,x),exportCertificate:D=>he.get(`/v1/student/export/word/${D}`,{responseType:"blob"})},es={getUserList:(D={})=>(D.page&&(D.page=Number(D.page)),D.limit?D.limit=Number(D.limit):D.limit=20,console.log("userApi.getUserList 參數:",D),he.get("/v1/user",{params:D})),getRoleOptions:()=>he.get("/v1/options/roles"),createUser:D=>he.post("/v1/user",D),updateUser:(D,x)=>(x.unit!==void 0&&(x.unit=String(x.unit)),x.title!==void 0&&(x.title=String(x.title)),console.log("發送更新用戶數據:",x),he.put(`/v1/user/${D}`,x)),deleteUser:D=>he.delete(`/v1/user/${D}`),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),updatePassword:D=>he.put("/v1/user/resetPwd",{password:D.oldPassword,newPassword:D.newPassword}),getProfile:()=>he.get("/v1/user/info"),updateProfile:(D,x)=>he.put(`/v1/user/info/${D}`,x)},Mu={class:"flex flex-col items-center p-6"},Au={class:"w-full max-w-[1500px] flex justify-between items-center"},Iu={class:"w-full max-w-[1500px] flex justify-end mb-6"},Ru={class:"flex space-x-4"},Pu={key:2,class:"flex items-center space-x-2"},Uu={key:0,class:"flex items-center space-x-2"},Nu={class:"font-bold text-[#4e9875]"},Tu=["aria-label"],Vu=["aria-label"],ju={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},Lu={key:1,class:"w-full max-w-[1500px] grid grid-cols-3 gap-6"},Fu={class:"space-y-6"},qu={class:"flex items-center"},Ou=["readonly"],Bu=["value"],Hu={class:"flex items-center"},Wu=["readonly"],zu={class:"flex items-center"},Ku=["value"],Ju={class:"flex items-center"},Yu=["readonly"],Gu={class:"flex items-center"},Qu=["disabled"],Zu=["value"],Xu={class:"flex items-center"},ec=["readonly"],tc=["value"],sc={class:"flex items-center"},ac=["readonly"],oc=["value"],lc={class:"space-y-6"},nc={class:"flex items-center"},rc=["readonly"],ic=["value"],dc={class:"flex items-center"},uc=["readonly"],cc=["value"],pc={class:"flex items-center"},vc=["readonly"],mc=["value"],bc={class:"flex items-center"},fc=["readonly"],yc=["value"],gc={class:"flex items-center"},xc=["readonly"],hc=["value"],wc={key:0,class:"flex items-center"},_c=["readonly"],kc=["value"],$c={class:"space-y-6"},Cc={class:"flex items-center"},Ec=["disabled"],Sc={class:"flex items-center"},Dc=["readonly"],Mc=["value"],Ac={class:"flex items-center"},Ic=["readonly"],Rc=["value"],Pc={class:"flex items-center"},Uc=["readonly"],Nc=["value"],Tc={class:"flex items-center"},Vc=["readonly"],jc=["value"],Lc={key:0,class:"flex items-center"},Fc=["readonly"],qc=["value"],Oc={class:"w-full max-w-[1500px] mb-6"},Bc={class:"w-full"},Hc={key:1,id:"remark-display",class:"w-full p-3 border border-gray-300 rounded min-h-[60px] whitespace-pre-wrap bg-gray-50","aria-labelledby":"remark-label"},Wc={key:0,class:"text-right text-xs text-gray-500 mt-1"},zc={class:"w-full max-w-[1500px]"},Kc={class:"w-full border-collapse","aria-labelledby":"course-records-heading"},Jc={key:0},Yc=["onClick","aria-label"],Gc={class:"border p-2 text-center"},Qc={class:"border p-2 text-center"},Zc={class:"border p-2 text-center"},Xc={class:"border p-2 text-center"},ep={class:"border p-2 text-center"},tp={class:"border p-2 text-center"},sp={class:"border p-2 text-center"},ap={class:"border p-2 text-center"},op={class:"border p-2 text-center"},lp={class:"border p-2 text-center"},np={class:"w-full border-collapse","aria-labelledby":"credit-recognition-heading"},rp={key:0},ip=["onClick","aria-label"],dp={class:"border p-2 text-center"},up={class:"border p-2 text-center"},cp={class:"border p-2 text-center"},pp={class:"border p-2 text-center"},vp={class:"border p-2 text-center"},mp={class:"border p-2 text-center"},bp={class:"border p-2 text-center"},fp={class:"border p-2 text-center"},yp={class:"border p-2 text-center"},gp={class:"border p-2 text-center"},xp={__name:"Single",setup(D){const x=We(),d=lt(),u=m(!1),C=m(!0),o=m(null),N=m({id:0,name:"",gender:0,idNumber:"",subAgencyName:"",unitName:"",phone:"",officePhone:"",officeEmail:"",email:"",subsidyCategory:1,cancelDate:"",cancelReason:"",bankCode:"",branchCode:"",bankAccount:"",remark:"",histories:[],birthday:"",address:"",registrationDate:"",creditCertifications:[],number:""});m("history");const K=m({}),$=Se({get:()=>{var H;return((H=N.value.subsidyCategory)==null?void 0:H.toString())||"1"},set:H=>{N.value.subsidyCategory=parseInt(H)}}),P=m([]),T=m([]),z=Se({get:()=>N.value.parentAgencyId,set:H=>{N.value.parentAgencyId=parseInt(H)}});Se(()=>{if(N.value.parentAgencyId===-1||N.value.parentAgencyId===0||!N.value.parentAgencyId)return"無上級機關";const H=T.value.find(i=>i.id===N.value.parentAgencyId);return H?H.name:"無上級機關"});const g=Se({get:()=>{var H;return((H=N.value.gender)==null?void 0:H.toString())||"1"},set:H=>{N.value.gender=parseInt(H)}}),a=H=>H===-1||H==="-1"?"缺":H,A=H=>{switch(H){case 1:return"男";case 2:return"女";case 3:return"其他";default:return"缺"}};Ee($,(H,i)=>{if(H==="4"&&i!=="4"&&!N.value.cancelDate){const n=new Date,h=n.getFullYear()-1911,be=String(n.getMonth()+1).padStart(2,"0"),_e=String(n.getDate()).padStart(2,"0");N.value.cancelDate=`${h}/${be}/${_e}`}});const G=m({studentUpdate:!1,studentDelete:!1,studentExportWord:!1}),k=async()=>{try{const H=await tt.getSidebarPermissions();H.data.code===0&&H.data.message==="success"?(G.value=H.data.data,console.log("學員詳情頁面權限:",G.value)):console.error("獲取權限失敗:",H.data.message)}catch(H){console.error("獲取權限錯誤:",H)}},c=async()=>{if(u.value){if(!b())return;await v.confirmAsync("確認儲存","確定要儲存修改嗎？")&&w()}else K.value=JSON.parse(JSON.stringify(N.value)),u.value=!0},b=()=>r()?f()&&p()&&ve()&&Be():!1,r=()=>N.value.phone&&!De(N.value.phone)?(v.showError("貼心提醒","行動電話格式不正確，請輸入09開頭的10位數字"),!1):N.value.email&&!$e(N.value.email)?(v.showError("貼心提醒","私人郵件格式不正確，請輸入有效的電子郵件格式"),!1):N.value.officeEmail&&!$e(N.value.officeEmail)?(v.showError("貼心提醒","公務郵件格式不正確，請輸入有效的電子郵件格式"),!1):!0,f=()=>{if($.value==="4"){if(!N.value.cancelDate)return v.showError("貼心提醒","請輸入取消日期"),!1;if(!Y(N.value.cancelDate))return v.showError("貼心提醒","取消日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1;if(!N.value.cancelReason)return v.showError("貼心提醒","請輸入取消原因"),!1}return!0},p=()=>N.value.bankCode&&!oe(N.value.bankCode)?(v.showError("貼心提醒","銀行代碼格式不正確，請輸入3-7位數字"),!1):N.value.branchCode&&!q(N.value.branchCode)?(v.showError("貼心提醒","分行代碼格式不正確，請輸入3-4位數字"),!1):N.value.bankAccount&&!S(N.value.bankAccount)?(v.showError("貼心提醒","銀行帳號格式不正確，請輸入8-16位數字，可包含連字符號"),!1):!0,w=()=>{W(N.value)},y=async()=>{await v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會丟失。")&&V()},V=()=>{N.value=JSON.parse(JSON.stringify(K.value)),u.value=!1},W=async H=>{try{C.value=!0;const i=O(H);console.log("準備更新的學生資料:",i),await _(i)}catch(i){L(i)}finally{C.value=!1}},O=H=>({id:H.id,name:H.name,gender:H.gender,idNumber:H.idNumber,subAgencyName:H.subAgencyName===""||H.subAgencyName==="缺"||H.subAgencyName==="-1"?null:H.subAgencyName,parentAgencyId:H.parentAgencyId===-1?null:H.parentAgencyId,unitName:H.unitName===""||H.unitName==="缺"||H.unitName==="-1"?null:H.unitName,phone:H.phone,officePhone:H.officePhone===""||H.officePhone==="缺"||H.officePhone==="-1"?null:H.officePhone,officeEmail:H.officeEmail===""||H.officeEmail==="缺"||H.officeEmail==="-1"?null:H.officeEmail,email:H.email===""||H.email==="缺"||H.email==="-1"?null:H.email,subsidyCategory:H.subsidyCategory,cancelDate:H.subsidyCategory===4&&H.cancelDate||null,cancelReason:H.subsidyCategory===4&&H.cancelReason||null,bankCode:H.bankCode===""||H.bankCode==="缺"||H.bankCode==="-1"?null:H.bankCode,branchCode:H.branchCode===""||H.branchCode==="缺"||H.branchCode==="-1"?null:H.branchCode,bankAccount:H.bankAccount===""||H.bankAccount==="缺"||H.bankAccount==="-1"?null:H.bankAccount,remark:H.remark||"",birthday:H.birthday||null,address:H.address||null,registrationDate:H.registrationDate||null}),_=async H=>{try{const i=await Dt.updateStudent(H);i.data.code===0?(v.showSuccess("儲存成功","學生資料已成功儲存"),j()):(E(i.data),await j())}catch(i){console.error("API 調用出錯:",i),v.showError("儲存失敗","連接伺服器發生錯誤，請稍後再試"),await j()}},E=H=>{let i=H.message;v.showError("儲存失敗","保存學生資料失敗: "+i),console.error("保存學生資料失敗:",H.message)},L=async H=>{v.showError("儲存失敗","保存學生資料錯誤，請稍後再試"),console.error("保存學生資料錯誤:",H),H.response&&(console.error("錯誤響應數據:",H.response.data),H.response.data&&H.response.data.message&&v.showError("儲存失敗",H.response.data.message)),await j()},j=async()=>{try{C.value=!0;const H=d.params.id;if(!H){console.error("未提供學生ID");return}const i=await Dt.getStudentById(H);i.data.code===0?He(i.data.data.result):ge(new Error("獲取學生詳細資料失敗"),i.data)}catch(H){ge(H,H.response)}finally{C.value=!1}},R=async()=>{try{const H=await ot.getAgencyOptions();H.data.code===0&&H.data.message==="success"?P.value=H.data.data:console.error("獲取機關選項失敗:",H.data.message)}catch(H){console.error("獲取機關選項錯誤:",H)}},U=async()=>{try{const H=await ot.getAgencyOptions();H.data.code===0&&H.data.message==="success"?(T.value=H.data.data,N.value.id&&z.value&&!T.value.some(i=>i.id===z.value)&&T.value.push({id:z.value,name:"無上級機關"})):console.error("獲取上級機關選項失敗:",H.data.message)}catch(H){console.error("獲取上級機關選項錯誤:",H)}};Ee(()=>d.params.id,H=>{H&&j()}),je(()=>{j(),R(),U(),k(),gs(()=>{o.value&&ce()})}),Ee(u,H=>{H&&gs(()=>{o.value&&ce()})});const te=()=>{if(d.query.from){let H={};switch(d.query.from){case"information":H={path:"/student/information",query:{page:d.query.page,year:d.query.year,school:d.query.school,course:d.query.course,agency:d.query.agency,area:d.query.area,searchKeyword:d.query.searchKeyword}};break;case"history":H={path:"/history",query:{page:d.query.page,searchKeyword:d.query.searchKeyword}};break;case"courseEdit":if(d.query.courseId){const i=d.query.courseId;console.log("返回到課程編輯頁面，courseId:",i);const n={from:"course",page:d.query.originalCoursePage||d.query.page||"1",year:d.query.year,school:d.query.school,course:d.query.course,month:d.query.month,searchKeyword:d.query.searchKeyword,sortBy:d.query.sortBy,sortOrder:d.query.sortOrder};Object.keys(n).forEach(h=>{(n[h]===void 0||n[h]===null||n[h]==="")&&delete n[h]}),H={path:`/course-edit/${i}`,query:n}}else{console.log("無法找到 courseId，使用瀏覽器返回功能"),x.back();return}break;default:x.back();return}Object.keys(H.query||{}).forEach(i=>{H.query[i]===void 0&&delete H.query[i]}),console.log("Single.vue 返回到目標頁面:",H.path,"參數:",H.query),x.push(H)}else x.back()},ue=H=>{const i=d.query.from,n={...d.query,originalFrom:i,studentId:d.params.id,from:void 0};Object.keys(n).forEach(h=>{n[h]===void 0&&delete n[h]}),x.push({name:"SingleEdit",params:{id:H},query:n})},ye=H=>{const i=d.query.from,n={...d.query,originalFrom:i,studentId:d.params.id,from:void 0};Object.keys(n).forEach(h=>{n[h]===void 0&&delete n[h]}),x.push({name:"CreditsEdit",params:{id:H},query:n})},ke=Se(()=>{const H=d.query.from;let i=[];if(console.log("Single.vue breadcrumbs parameters:",{from:H,courseId:d.query.courseId,allParams:d.query}),H==="courseEdit"&&d.query.courseId)return console.log("從課程編輯頁面進入，使用 courseEdit 麵包屑"),i=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${d.params.id}`}],i;switch(H){case"information":i=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:""}];break;case"history":i=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${d.params.id}`}];break;case"courseEdit":i=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${d.params.id}`}];break;default:i=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${d.params.id}`}]}return i}),De=H=>/^09\d{8}$/.test(H),$e=H=>{if(!H)return!0;const i=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;return H.length>254?!1:i.test(H)},ve=()=>N.value.birthday&&!Y(N.value.birthday)?(v.showError("貼心提醒","生日日期格式不正確，請輸入民國年格式(如：113/01/01)"),!1):!0,oe=H=>H?/^\d{3,7}$/.test(H):!0,q=H=>H?/^\d{3,4}$/.test(H):!0,S=H=>H?/^[\d-]{8,16}$/.test(H):!0,Y=H=>{if(!H)return!0;const i=/^(\d{1,3})([/-])(\d{1,2})\2(\d{1,2})$/;if(!i.test(H))return!1;const n=H.match(i),h=parseInt(n[1])+1911,be=parseInt(n[3])-1,_e=parseInt(n[4]);let Ve=new Date(h,be,_e);return console.log(Ve.toDateString("yyyy-MM-dd")),Ve.getFullYear()===h&&Ve.getMonth()===be&&Ve.getDate()===_e},fe=(H,i)=>{if(!u.value)return;const n=H.target.value,be=n.replace(/[^\d/-]/g,"").slice(0,10);n!==be&&(N.value[i]=be)},le=async()=>{if(!await v.confirmAsync("確認刪除",`確定要刪除學生「${N.value.name}」嗎？刪除後資料將無法恢復。`))return;const i=await Q();if(i)try{if(C.value=!0,!await se(i))return;await ie()}catch(n){ae(n)}finally{C.value=!1}},Q=async()=>{const H=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");return H===null||H===""?null:H},se=async H=>{try{return(await Dt.confirmPassword(H)).data.code!==0?(v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),!1):!0}catch(i){return v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"),console.error("密碼驗證錯誤:",i),!1}},ie=async()=>{try{const H=await Dt.deleteStudent(N.value.id);H.data.code===0?(v.showSuccess("刪除成功","學生資料已成功刪除"),de()):v.showError("刪除失敗",H.data.message||"刪除學生資料失敗")}catch(H){v.showError("刪除失敗","刪除學生資料時發生錯誤，請稍後再試"),console.error("刪除學生錯誤:",H)}},de=()=>{d.query.from==="information"?x.push({path:"/student/information",query:{page:d.query.page,searchKeyword:d.query.searchKeyword,year:d.query.year,school:d.query.school,course:d.query.course,agency:d.query.agency,area:d.query.area}}):x.push("/student/information")},ae=H=>{console.error("操作錯誤:",H),H.response&&H.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除學生資料時發生錯誤，請稍後再試")},ce=()=>{const H=o.value;H&&(H.style.height="auto",H.style.height=Math.min(H.scrollHeight,400)+"px")},Ie=async()=>{const H=d.params.id;if(!H){v.showError("列印失敗","無法獲取學生ID");return}const i=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(!(i===null||i==="")){C.value=!0;try{if((await es.confirmPassword(i)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const h=await Dt.exportCertificate(H);if(h.data){const be=new Blob([h.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),_e=window.URL.createObjectURL(be),Ve=document.createElement("a");Ve.href=_e,Ve.download=`${N.value.name}結訓證書.docx`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),window.URL.revokeObjectURL(_e),v.showSuccess("列印成功","結訓證書已成功下載")}else v.showError("列印失敗",h.data.message||"列印結訓證書失敗")}catch(n){console.error("列印結訓證書錯誤:",n),v.showError("列印失敗","列印結訓證書時發生錯誤，請稍後再試")}finally{C.value=!1}}},Be=()=>u.value&&N.value.registrationDate&&!Y(N.value.registrationDate)?(v.showError("貼心提醒","參訓報名日格式不正確，請輸入民國年格式(如：113/01/01)"),!1):!0,me=H=>{H.histories||(H.histories=[]),H.creditCertifications||(H.creditCertifications=[])},pe=H=>{N.value.number=H.number||null,N.value=H,g.value=String(H.gender||1),N.value.subAgencyName=H.subAgencyName||"",z.value=H.parentAgencyId||-1,$.value=String(H.subsidyCategory||1),N.value.registrationDate=H.registrationDate||""},we=H=>{T.value.length>0&&z.value&&!T.value.some(i=>i.id===z.value)&&T.value.push({id:z.value,name:"無上級機關"})},He=H=>{me(H),pe(H),K.value=JSON.parse(JSON.stringify(H)),we(),console.log("獲取到的學生資料:",H),u.value=!1},ge=(H,i)=>{var n;console.error("獲取學生詳細資料錯誤:",H),i?(console.error("錯誤響應數據:",i.data),v.showError("數據獲取失敗",((n=i.data)==null?void 0:n.message)||"連接服務器時發生錯誤")):v.showError("數據獲取失敗",H.message||"連接服務器時發生錯誤")};return(H,i)=>(t(),s("div",Mu,[e("div",Au,[Qe(pt,{breadcrumbs:ke.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:te,"aria-label":"回上一頁"},i[23]||(i[23]=[e("span",{class:"mr-2"},"←",-1),xe(" 回上一頁 ")]))]),i[55]||(i[55]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Iu,[e("div",Ru,[u.value&&G.value.studentDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:le,"aria-label":"刪除學生資料"}," 刪除學生 ")):J("",!0),u.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:y,"aria-label":"取消編輯"}," 取消 ")):J("",!0),!u.value&&G.value.studentExportWord?(t(),s("div",Pu,[N.value.number?(t(),s("div",Uu,[i[24]||(i[24]=e("span",{class:"text-gray-700"},"證書編號:",-1)),e("span",Nu,l(N.value.number),1)])):J("",!0),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:Ie,"aria-label":N.value.number?"已列印結訓證書":"列印結訓證書"},l(N.value.number?"已列印":"列印結訓證書"),9,Tu)])):J("",!0),G.value.studentUpdate?(t(),s("button",{key:3,class:X(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:c,"aria-label":u.value?"儲存學生資料":"編輯學生資料"},l(u.value?"儲存":"內容編輯"),11,Vu)):J("",!0)])]),C.value?(t(),s("div",ju,i[25]||(i[25]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",Lu,[e("div",Fu,[e("div",qu,[i[26]||(i[26]=e("label",{class:"w-24",for:"student-registration-date"},"參訓報名日:",-1)),u.value?I((t(),s("input",{key:0,id:"student-registration-date",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[0]||(i[0]=n=>N.value.registrationDate=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[1]||(i[1]=n=>fe(n,"registrationDate")),readonly:!u.value},null,40,Ou)),[[ee,N.value.registrationDate]]):(t(),s("input",{key:1,id:"student-registration-date-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.registrationDate),readonly:"","aria-labelledby":"student-registration-date"},null,8,Bu))]),e("div",Hu,[i[27]||(i[27]=e("label",{class:"w-24",for:"student-name"},"姓名:",-1)),I(e("input",{id:"student-name",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[2]||(i[2]=n=>N.value.name=n),readonly:!u.value},null,10,Wu),[[ee,N.value.name]])]),e("div",zu,[i[29]||(i[29]=e("label",{class:"w-24",for:"student-gender"},"性別:",-1)),u.value?I((t(),s("select",{key:0,id:"student-gender",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[3]||(i[3]=n=>g.value=n)},i[28]||(i[28]=[e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512)),[[Pe,g.value]]):(t(),s("input",{key:1,id:"student-gender-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:A(N.value.gender),readonly:"","aria-labelledby":"student-gender"},null,8,Ku))]),e("div",Ju,[i[30]||(i[30]=e("label",{class:"w-24",for:"student-id-number"},"身分證字號:",-1)),I(e("input",{id:"student-id-number",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[4]||(i[4]=n=>N.value.idNumber=n),readonly:!u.value},null,10,Yu),[[ee,N.value.idNumber]])]),e("div",Gu,[i[32]||(i[32]=e("label",{class:"w-24",for:"student-parent-agency"},"上級機關:",-1)),I(e("select",{id:"student-parent-agency",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":i[5]||(i[5]=n=>z.value=n)},[i[31]||(i[31]=e("option",{value:""},"無上級機關",-1)),(t(!0),s(Z,null,re(T.value,n=>(t(),s("option",{key:n.id,value:n.id},l(n.name),9,Zu))),128))],10,Qu),[[Pe,z.value]])]),e("div",Xu,[i[33]||(i[33]=e("label",{class:"w-24",for:"student-agency"},"機關名稱:",-1)),u.value?I((t(),s("input",{key:0,id:"student-agency",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[6]||(i[6]=n=>N.value.subAgencyName=n),placeholder:"請輸入機關名稱",readonly:!u.value},null,8,ec)),[[ee,N.value.subAgencyName]]):(t(),s("input",{key:1,id:"student-agency-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.subAgencyName),readonly:"","aria-labelledby":"student-agency"},null,8,tc))]),e("div",sc,[i[34]||(i[34]=e("label",{class:"w-24",for:"student-unit"},"單位:",-1)),u.value?I((t(),s("input",{key:0,id:"student-unit",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[7]||(i[7]=n=>N.value.unitName=n),placeholder:"請輸入單位名稱",readonly:!u.value},null,8,ac)),[[ee,N.value.unitName]]):(t(),s("input",{key:1,id:"student-unit-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.unitName),readonly:"","aria-labelledby":"student-unit"},null,8,oc))])]),e("div",lc,[e("div",nc,[i[35]||(i[35]=e("label",{class:"w-24",for:"student-office-phone"},"公務電話:",-1)),u.value?I((t(),s("input",{key:0,id:"student-office-phone",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[8]||(i[8]=n=>N.value.officePhone=n),placeholder:"可填寫手機、市話(含區碼)或內線",readonly:!u.value},null,8,rc)),[[ee,N.value.officePhone]]):(t(),s("input",{key:1,id:"student-office-phone-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.officePhone),readonly:"","aria-labelledby":"student-office-phone"},null,8,ic))]),e("div",dc,[i[36]||(i[36]=e("label",{class:"w-24",for:"student-phone"},"行動電話:",-1)),u.value?I((t(),s("input",{key:0,id:"student-phone",type:"tel",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":i[9]||(i[9]=n=>N.value.phone=n),placeholder:"09開頭的10位數字，例：0912345678",maxlength:"10",readonly:!u.value},null,10,uc)),[[ee,N.value.phone]]):(t(),s("input",{key:1,id:"student-phone-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.phone),readonly:"","aria-labelledby":"student-phone"},null,8,cc))]),e("div",pc,[i[37]||(i[37]=e("label",{class:"w-24",for:"student-office-email"},"公務郵件:",-1)),u.value?I((t(),s("input",{key:0,id:"student-office-email",type:"email",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[10]||(i[10]=n=>N.value.officeEmail=n),placeholder:"例：example@gov.tw",readonly:!u.value},null,8,vc)),[[ee,N.value.officeEmail]]):(t(),s("input",{key:1,id:"student-office-email-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.officeEmail),readonly:"","aria-labelledby":"student-office-email"},null,8,mc))]),e("div",bc,[i[38]||(i[38]=e("label",{class:"w-24",for:"student-email"},"私人郵件:",-1)),u.value?I((t(),s("input",{key:0,id:"student-email",type:"email",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[11]||(i[11]=n=>N.value.email=n),placeholder:"例：example@example.com",readonly:!u.value},null,8,fc)),[[ee,N.value.email]]):(t(),s("input",{key:1,id:"student-email-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.email),readonly:"","aria-labelledby":"student-email"},null,8,yc))]),e("div",gc,[i[39]||(i[39]=e("label",{class:"w-24",for:"student-birthday"},"生日:",-1)),u.value?I((t(),s("input",{key:0,id:"student-birthday",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[12]||(i[12]=n=>N.value.birthday=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[13]||(i[13]=n=>fe(n,"birthday")),readonly:!u.value},null,40,xc)),[[ee,N.value.birthday]]):(t(),s("input",{key:1,id:"student-birthday-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.birthday),readonly:"","aria-labelledby":"student-birthday"},null,8,hc))]),$.value==="4"?(t(),s("div",wc,[i[40]||(i[40]=e("label",{class:"w-24",for:"student-cancel-date"},"取消日期:",-1)),u.value?I((t(),s("input",{key:0,id:"student-cancel-date",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[14]||(i[14]=n=>N.value.cancelDate=n),placeholder:"請輸入民國年格式，例如：113/01/05",onInput:i[15]||(i[15]=n=>fe(n,"cancelDate")),readonly:!u.value},null,40,_c)),[[ee,N.value.cancelDate]]):(t(),s("input",{key:1,id:"student-cancel-date-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.cancelDate),readonly:"","aria-labelledby":"student-cancel-date"},null,8,kc))])):J("",!0)]),e("div",$c,[e("div",Cc,[i[42]||(i[42]=e("label",{class:"w-24",for:"subsidy-category"},"補助類別:",-1)),I(e("select",{id:"subsidy-category",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":i[16]||(i[16]=n=>$.value=n)},i[41]||(i[41]=[e("option",{value:"1"},"機關薦派",-1),e("option",{value:"2"},"自行報名",-1),e("option",{value:"3"},"非本計畫",-1),e("option",{value:"4"},"已取消",-1)]),10,Ec),[[Pe,$.value]])]),e("div",Sc,[i[43]||(i[43]=e("label",{class:"w-24",for:"bank-code"},"銀行代碼:",-1)),u.value?I((t(),s("input",{key:0,id:"bank-code",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[17]||(i[17]=n=>N.value.bankCode=n),placeholder:"請輸入3-7位數字的銀行代碼",maxlength:"7",readonly:!u.value},null,8,Dc)),[[ee,N.value.bankCode]]):(t(),s("input",{key:1,id:"bank-code-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.bankCode),readonly:"","aria-labelledby":"bank-code"},null,8,Mc))]),e("div",Ac,[i[44]||(i[44]=e("label",{class:"w-24",for:"branch-code"},"分行代碼:",-1)),u.value?I((t(),s("input",{key:0,id:"branch-code",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[18]||(i[18]=n=>N.value.branchCode=n),placeholder:"請輸入3-4位數字的分行代碼",maxlength:"4",readonly:!u.value},null,8,Ic)),[[ee,N.value.branchCode]]):(t(),s("input",{key:1,id:"branch-code-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.branchCode),readonly:"","aria-labelledby":"branch-code"},null,8,Rc))]),e("div",Pc,[i[45]||(i[45]=e("label",{class:"w-24",for:"bank-account"},"銀行帳號:",-1)),u.value?I((t(),s("input",{key:0,id:"bank-account",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[19]||(i[19]=n=>N.value.bankAccount=n),placeholder:"請輸入8-16位數字的銀行帳號，可包含連字符號",maxlength:"16",readonly:!u.value},null,8,Uc)),[[ee,N.value.bankAccount]]):(t(),s("input",{key:1,id:"bank-account-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.bankAccount),readonly:"","aria-labelledby":"bank-account"},null,8,Nc))]),e("div",Tc,[i[46]||(i[46]=e("label",{class:"w-24",for:"student-address"},"收件地址:",-1)),u.value?I((t(),s("input",{key:0,id:"student-address",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[20]||(i[20]=n=>N.value.address=n),placeholder:"請輸入收件地址",readonly:!u.value},null,8,Vc)),[[ee,N.value.address]]):(t(),s("input",{key:1,id:"student-address-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.address),readonly:"","aria-labelledby":"student-address"},null,8,jc))]),$.value==="4"?(t(),s("div",Lc,[i[47]||(i[47]=e("label",{class:"w-24",for:"student-cancel-reason"},"取消原因:",-1)),u.value?I((t(),s("input",{key:0,id:"student-cancel-reason",type:"text",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":i[21]||(i[21]=n=>N.value.cancelReason=n),placeholder:"請輸入取消原因",readonly:!u.value},null,8,Fc)),[[ee,N.value.cancelReason]]):(t(),s("input",{key:1,id:"student-cancel-reason-display",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none",value:a(N.value.cancelReason),readonly:"","aria-labelledby":"student-cancel-reason"},null,8,qc))])):J("",!0)])])),i[56]||(i[56]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Oc,[i[48]||(i[48]=e("div",{class:"text-lg mb-3",id:"remark-label"},"備註",-1)),e("div",Bc,[u.value?I((t(),s("textarea",{key:0,id:"student-remark","onUpdate:modelValue":i[22]||(i[22]=n=>N.value.remark=n),class:X(["w-full p-3 border border-[#4e9875] rounded outline-none focus:outline-none min-h-[100px] resize-y",u.value?"border-[#4e9875]":"border-gray-300"]),placeholder:"請輸入備註，最多1000字",maxlength:"1000",rows:"4",onInput:ce,ref_key:"remarkTextarea",ref:o,"aria-labelledby":"remark-label"},null,34)),[[ee,N.value.remark]]):(t(),s("div",Hc,l(N.value.remark||"無備註"),1))]),u.value?(t(),s("div",Wc,l(N.value.remark?N.value.remark.length:0)+"/1000 ",1)):J("",!0)]),i[57]||(i[57]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",zc,[i[53]||(i[53]=e("div",{class:"text-xl font-bold mb-4 pb-2"},"上課紀錄",-1)),e("table",Kc,[i[50]||(i[50]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",scope:"col"},"課程代號"),e("th",{class:"border p-2",scope:"col"},"科目"),e("th",{class:"border p-2",scope:"col"},"訓練單位"),e("th",{class:"border p-2",scope:"col"},"訓練日期起訖"),e("th",{class:"border p-2",scope:"col"},"狀態"),e("th",{class:"border p-2",scope:"col"},"已認列學分"),e("th",{class:"border p-2",scope:"col"},"應取得學分"),e("th",{class:"border p-2",scope:"col"},"已取得學分"),e("th",{class:"border p-2",scope:"col"},"學分證書編號"),e("th",{class:"border p-2",scope:"col"},"成績")])],-1)),e("tbody",null,[N.value.histories&&N.value.histories.length===0?(t(),s("tr",Jc,i[49]||(i[49]=[e("td",{colspan:"10",class:"border p-4 text-center"},"無上課紀錄",-1)]))):N.value.histories&&N.value.histories.length>0?(t(!0),s(Z,{key:1},re(N.value.histories,(n,h)=>(t(),s("tr",{key:h,class:"cursor-pointer hover:bg-gray-100",onClick:be=>ue(n.id),"aria-label":`查看上課記錄：${a(n.courseCode)} ${a(n.courseCategory)}`},[e("td",Gc,l(a(n.courseCode)),1),e("td",Qc,l(a(n.courseCategory)),1),e("td",Zc,l(a(n.schoolName)),1),e("td",Xc,l(a(n.startDate))+"~"+l(a(n.endDate)),1),e("td",ep,l(a(n.status)),1),e("td",tp,l(a(n.approvedCredits)),1),e("td",sp,l(a(n.requiredCredits)),1),e("td",ap,l(a(n.earnedCredits)),1),e("td",op,l(a(n.certificateNumber)),1),e("td",lp,l(a(n.grade)),1)],8,Yc))),128)):J("",!0)])]),i[54]||(i[54]=e("div",{class:"text-xl font-bold mt-10 mb-4 pb-2"},"學分認列",-1)),e("table",np,[i[52]||(i[52]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",scope:"col"},"課程代號"),e("th",{class:"border p-2",scope:"col"},"科目"),e("th",{class:"border p-2",scope:"col"},"訓練單位"),e("th",{class:"border p-2",scope:"col"},"訓練日期起訖"),e("th",{class:"border p-2",scope:"col"},"狀態"),e("th",{class:"border p-2",scope:"col"},"已認列學分"),e("th",{class:"border p-2",scope:"col"},"應取得學分"),e("th",{class:"border p-2",scope:"col"},"已取得學分"),e("th",{class:"border p-2",scope:"col"},"學分證書編號"),e("th",{class:"border p-2",scope:"col"},"成績")])],-1)),e("tbody",null,[N.value.creditCertifications&&N.value.creditCertifications.length===0?(t(),s("tr",rp,i[51]||(i[51]=[e("td",{colspan:"10",class:"border p-4 text-center"},"無學分認列紀錄",-1)]))):N.value.creditCertifications&&N.value.creditCertifications.length>0?(t(!0),s(Z,{key:1},re(N.value.creditCertifications,(n,h)=>(t(),s("tr",{key:h,class:"cursor-pointer hover:bg-gray-100",onClick:be=>ye(n.id),"aria-label":`查看學分認列：${a(n.courseCode)} ${a(n.courseCategory)}`},[e("td",dp,l(a(n.courseCode)),1),e("td",up,l(a(n.courseCategory)),1),e("td",cp,l(a(n.schoolName)),1),e("td",pp,l(a(n.startDate))+"~"+l(a(n.endDate)),1),e("td",vp,l(a(n.status)),1),e("td",mp,l(a(n.approvedCredits)),1),e("td",bp,l(a(n.requiredCredits)),1),e("td",fp,l(a(n.earnedCredits)),1),e("td",yp,l(a(n.certificateNumber)),1),e("td",gp,l(a(n.grade)),1)],8,ip))),128)):J("",!0)])])])]))}},hp=Le(xp,[["__scopeId","data-v-41e37bab"]]),wp={class:"flex flex-col items-center p-6"},_p={class:"w-full max-w-[1500px]"},kp={class:"w-full max-w-[1500px]"},$p={class:"flex items-center space-x-4 mb-4"},Cp={class:"relative w-40"},Ep={class:"flex items-center space-x-4"},Sp=["value"],Dp=["value"],Mp=["value"],Ap=["value"],Ip={class:"w-full max-w-[1500px]"},Rp={key:0,class:"flex justify-center items-center py-10"},Pp={key:1,class:"w-full border-collapse"},Up={class:"bg-[#EEEFE7]"},Np={class:"border p-2"},Tp={class:"flex items-center justify-center"},Vp={key:0},jp={key:1},Lp={key:2},Fp={class:"border p-2"},qp={class:"flex items-center justify-center"},Op={key:0},Bp={key:1},Hp={key:2},Wp={class:"border p-2"},zp={class:"flex items-center justify-center"},Kp={key:0},Jp={key:1},Yp={key:2},Gp={class:"border p-2"},Qp={class:"flex items-center justify-center"},Zp={key:0},Xp={key:1},ev={key:2},tv={class:"border p-2"},sv={class:"flex items-center justify-center"},av={key:0},ov={key:1},lv={key:2},nv={class:"border p-2"},rv={class:"flex items-center justify-center"},iv={key:0},dv={key:1},uv={key:2},cv={class:"border p-2"},pv={class:"flex items-center justify-center"},vv={key:0},mv={key:1},bv={key:2},fv={class:"border p-2"},yv={class:"flex items-center justify-center"},gv={key:0},xv={key:1},hv={key:2},wv=["onClick"],_v={class:"border p-2 text-center"},kv={class:"border p-2 text-center"},$v={class:"border p-2 text-center"},Cv={class:"border p-2 text-center"},Ev={class:"border p-2 text-center"},Sv={class:"border p-2 text-center"},Dv={class:"border p-2 text-center"},Mv={class:"border p-2 text-center"},Av={class:"border p-2 text-center"},Iv={key:0},Rv={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Pv=["disabled"],Uv=["onClick"],Nv={key:1,class:"px-2"},Tv=["disabled"],Vv={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},jv={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Lv={class:"mb-4"},Fv={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},qv={class:"mb-2"},Ov={key:0,class:"text-red-500 text-sm mt-2"},Bv={class:"flex justify-end space-x-2"},Hv=["disabled"],Wv=["disabled"],zv={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Kv={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Jv={class:"mb-4"},Yv={class:"space-y-3"},As=20,Gv={__name:"Information",setup(D){const x=We(),d=lt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),$=m(""),P=m(1),T=m(1),z=m(0),g=m(!1),a=m([]),A=m([]),G=m([]),k=m([]),c=m([]),b=m(""),r=m("asc"),f=Se(()=>{const ge=new Date().getFullYear()-1911,H=[];for(let i=ge;i>=113;i--)H.push(i);return H}),p=ge=>ge==="-1"||ge===-1?"缺":ge,w=ge=>{if(ge==="-1"||ge===-1)return"缺";if(!ge||typeof ge!="string"||ge.length<5)return ge;const H=ge.substring(0,2),i=ge.substring(ge.length-3),n="*".repeat(ge.length-5);return H+n+i},y=Se(()=>{const ge=[];if(T.value<=5)for(let i=1;i<=T.value;i++)ge.push(i);else{ge.push(1);let i=Math.max(2,P.value-1),n=Math.min(T.value-1,P.value+1);P.value<=3&&(n=Math.min(4,T.value-1)),P.value>=T.value-2&&(i=Math.max(2,T.value-3)),i>2&&ge.push("...");for(let h=i;h<=n;h++)ge.push(h);n<T.value-1&&ge.push("..."),ge.push(T.value)}return ge}),V=async()=>{let ge=!1;try{g.value=!0;const H={page:P.value,limit:As,keyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:$.value||void 0,sortBy:b.value,sortOrder:r.value};console.log("獲取學生列表參數:",H);const i=await Dt.getStudents(H);i.data.code===0?(a.value=i.data.data.list,z.value=i.data.data.totalCount,T.value=Math.ceil(z.value/As)):(console.error("獲取學生列表失敗:",i.data.message),a.value=[],z.value=0,T.value=0,v.showError("獲取資料失敗",i.data.message||"無法獲取學生列表，請稍後再試"))}catch(H){H.isLoginExpired?(console.log("登入已過期，跳過更新操作"),ge=!0):(console.error("獲取學生列表錯誤:",H),a.value=[],z.value=0,T.value=0,v.showError("獲取資料失敗","無法獲取學生列表，請稍後再試"))}finally{!ge&&localStorage.getItem("token")&&(g.value=!1)}},W=ge=>{ge!==P.value&&(P.value=ge)},O=()=>{P.value>1&&P.value--},_=()=>{P.value<T.value&&P.value++},E=async()=>{let ge=!1;try{g.value=!0,P.value=1;const H={page:P.value,limit:As,keyword:u.value.trim(),sortBy:b.value||void 0,sortOrder:r.value||void 0};console.log("關鍵字搜尋參數:",H),R();const i=await Dt.getStudents(H);i.data.code===0?(a.value=i.data.data.list,z.value=i.data.data.totalCount,T.value=Math.ceil(z.value/As)):(console.error("獲取學生列表失敗:",i.data.message),a.value=[],z.value=0,T.value=0,v.showError("搜尋失敗",i.data.message||"關鍵字搜尋失敗，請稍後再試"))}catch(H){H.isLoginExpired?(console.log("登入已過期，跳過更新操作"),ge=!0):(console.error("獲取學生列表錯誤:",H),a.value=[],z.value=0,T.value=0,v.showError("搜尋失敗","搜尋過程中發生錯誤，請稍後再試"))}finally{!ge&&localStorage.getItem("token")&&(g.value=!1)}},L=()=>{console.log("搜尋條件:",{year:C.value,school:o.value,course:N.value,agency:K.value,area:$.value}),console.log("搜尋條件類型:",{year:typeof C.value,school:typeof o.value,course:typeof N.value,agency:typeof K.value,area:typeof $.value}),P.value=1,R(),V()},j=ge=>{if(ge){const H={from:"information",page:P.value,searchKeyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:$.value||void 0,sortBy:b.value||void 0,sortOrder:r.value||void 0};x.push({name:"Single",params:{id:ge},query:H})}};Ee(P,()=>{R(),V()});const R=()=>{const ge={page:P.value,searchKeyword:u.value||void 0,year:C.value||void 0,school:o.value||void 0,course:N.value||void 0,agency:K.value||void 0,area:$.value||void 0,sortBy:b.value||void 0,sortOrder:r.value||void 0};Object.keys(ge).forEach(H=>{ge[H]===void 0&&delete ge[H]}),x.replace({query:ge})},U=async()=>{try{const ge=await ot.getAgencyOptions();ge.data.code===0&&ge.data.message==="success"?A.value=ge.data.data:console.error("獲取機關選項失敗:",ge.data.message)}catch(ge){console.error("獲取機關選項錯誤:",ge)}},te=async()=>{try{const ge=await ot.getSchoolOptions();ge.data.code===0&&ge.data.message==="success"?G.value=ge.data.data:console.error("獲取學校選項失敗:",ge.data.message)}catch(ge){console.error("獲取學校選項錯誤:",ge)}},ue=()=>{k.value=[]},ye=async()=>{var ge,H;try{const i=await ot.getAreaOptions();((ge=i==null?void 0:i.data)==null?void 0:ge.code)===0?c.value=i.data.data:(console.error("獲取區域選項失敗:",((H=i==null?void 0:i.data)==null?void 0:H.message)||"未知錯誤"),c.value=[])}catch(i){console.error("獲取區域選項錯誤:",i),c.value=[]}},ke=()=>{d.query.page&&(P.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.year&&(C.value=d.query.year),d.query.school&&(o.value=d.query.school),d.query.course&&(N.value=d.query.course),d.query.agency&&(K.value=d.query.agency),d.query.area&&($.value=d.query.area),d.query.sortBy&&(b.value=d.query.sortBy),d.query.sortOrder&&(r.value=d.query.sortOrder)};je(()=>{ke(),U(),te(),ue(),ye(),V(),He()});const De=()=>{pe.value=!0},$e=()=>{pe.value=!1},ve=async ge=>{if(ge)await oe(ge);else try{const H=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(H===null||H==="")return;if((await Dt.confirmPassword(H)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const n=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(n===null)return;await oe(ge,n)}catch(H){console.error("匯出過程中的密碼驗證發生錯誤:",H),H.response&&H.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}$e()},oe=async(ge,H="")=>{try{const i={year:C.value||null,school:o.value||null,course:N.value||null,agency:K.value||null,area:$.value||null,keyword:u.value||null,isHidden:ge,password:H};console.log("匯出 Excel 參數:",i);const n=await Dt.exportStudents(i),h=n.headers["content-type"];if(!h||!h.includes("spreadsheetml.sheet"))try{const ht=new Blob([n.data],{type:"application/json"}),qe=await new Response(ht).text(),gt=JSON.parse(qe);console.error("匯出學生資料失敗：伺服器返回錯誤：",gt),v.showError("匯出失敗",gt.message||"匯出過程中發生錯誤，請稍後再試");return}catch(ht){console.error("匯出學生資料失敗：無法解析回應內容",ht),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const be=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_e=document.createElement("a");_e.href=URL.createObjectURL(be);const Ve=new Date,ut=`學生資料_${`${Ve.getFullYear()}-${String(Ve.getMonth()+1).padStart(2,"0")}-${String(Ve.getDate()).padStart(2,"0")}`}_${ge?"隱蔽加密版":"無隱蔽版"}.xlsx`;_e.download=ut,_e.click(),URL.revokeObjectURL(_e.href),v.showSuccess("匯出成功","學生資料已成功匯出為 Excel 檔案")}catch(i){if(i.isLoginExpired){console.log("登入已過期，跳過匯出操作");return}if(console.error("匯出 Excel 錯誤:",i),i.response&&i.response.data){const n=i.response.data;v.showError("匯出失敗",n.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},q=()=>{u.value="",d.query.searchKeyword&&(P.value=1,R(),V())},S=()=>{x.push("/student/add")},Y=()=>{x.push("/agency")},fe=ge=>{b.value===ge?r.value=r.value==="asc"?"desc":"asc":(b.value=ge,r.value="asc"),P.value=1,R(),V()},le=m(!1),Q=m(null),se=m(""),ie=m(!1),de=m(null),ae=()=>{le.value=!0,se.value="",Q.value=null,gs(()=>{de.value&&(de.value.value=null)})},ce=()=>{le.value=!1,Q.value=null,se.value=""},Ie=()=>{de.value.click()},Be=ge=>{const H=ge.target.files[0];if(H){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/vnd.oasis.opendocument.spreadsheet"].includes(H.type)&&!H.name.endsWith(".xlsx")&&!H.name.endsWith(".xls")&&!H.name.endsWith(".csv")&&!H.name.endsWith(".ods")){se.value="請選擇 .xlsx 或.ods 檔案",Q.value=null,ge.target.value=null;return}Q.value=H,se.value=""}},me=async()=>{var ge,H,i;if(!Q.value){se.value="請選擇要匯入的檔案";return}try{ie.value=!0,se.value="";const n=new FormData;n.append("file",Q.value);const h=await Dt.importStudents(n);if(h.data&&h.data.code===0){const be=h.data.message?h.data.message.replace(/\r\n|\n|\r/g,"<br>"):"學生資料已成功匯入";v.showInfo("匯入成功",be);const _e=()=>{ce(),V(),document.removeEventListener("info_close",_e)};document.addEventListener("info_close",_e)}else se.value=((ge=h.data)==null?void 0:ge.message)||"匯入失敗，請確認檔案格式是否正確",v.showError("匯入失敗",se.value)}catch(n){console.error("匯入學生檔案錯誤:",n),se.value=((i=(H=n.response)==null?void 0:H.data)==null?void 0:i.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",se.value)}finally{ie.value=!1}},pe=m(!1),we=m({studentCreate:!1,studentImport:!1,studentExport:!1,agencyManagement:!1}),He=async()=>{try{const ge=await tt.getSidebarPermissions();ge.data.code===0&&ge.data.message==="success"?(we.value=ge.data.data,console.log("學員資料頁面權限:",we.value)):console.error("獲取權限失敗:",ge.data.message)}catch(ge){console.error("獲取權限錯誤:",ge)}};return(ge,H)=>(t(),s(Z,null,[e("div",wp,[e("div",_p,[Qe(pt,{breadcrumbs:[{name:"學員資料",path:"/student/information"}]})]),e("div",kp,[e("div",$p,[H[18]||(H[18]=e("span",null,"查詢學員:",-1)),e("div",Cp,[I(e("input",{type:"text","onUpdate:modelValue":H[0]||(H[0]=i=>u.value=i),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名/手機/身分證字號",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ne(E,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:q,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},H[17]||(H[17]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:E}," 搜尋 "),H[19]||(H[19]=e("div",{class:"flex-1"},null,-1)),we.value.studentImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:ae}," 匯入學員 ")):J("",!0),we.value.studentCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:S}," 新增學員 ")):J("",!0)]),e("div",Ep,[H[25]||(H[25]=e("span",null,"查詢班級:",-1)),I(e("select",{"onUpdate:modelValue":H[1]||(H[1]=i=>C.value=i),class:"p-2 border border-gray-300 outline-none w-40",onChange:H[2]||(H[2]=(...i)=>ge.handleYearOrSchoolChange&&ge.handleYearOrSchoolChange(...i)),onKeyup:Ne(L,["enter"])},[H[20]||(H[20]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(f.value,i=>(t(),s("option",{key:i,value:i},l(i)+"年 ",9,Sp))),128))],544),[[Pe,C.value]]),I(e("select",{"onUpdate:modelValue":H[3]||(H[3]=i=>o.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(L,["enter"])},[H[21]||(H[21]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(Z,null,re(G.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Dp))),128))],544),[[Pe,o.value]]),I(e("select",{"onUpdate:modelValue":H[4]||(H[4]=i=>N.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(L,["enter"])},H[22]||(H[22]=[e("option",{value:""},"請選擇課程類型",-1),e("option",{value:"1"},"資安職能課程",-1),e("option",{value:"2"},"學分課程",-1)]),544),[[Pe,N.value]]),I(e("select",{"onUpdate:modelValue":H[5]||(H[5]=i=>K.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(L,["enter"])},[H[23]||(H[23]=e("option",{value:""},"請選擇機關",-1)),(t(!0),s(Z,null,re(A.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Mp))),128))],544),[[Pe,K.value]]),I(e("select",{"onUpdate:modelValue":H[6]||(H[6]=i=>$.value=i),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(L,["enter"])},[H[24]||(H[24]=e("option",{value:""},"請選擇區域",-1)),(t(!0),s(Z,null,re(c.value,i=>(t(),s("option",{key:i.id,value:i.id},l(i.name),9,Ap))),128))],544),[[Pe,$.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:L}," 搜尋 "),H[26]||(H[26]=e("div",{class:"flex-1"},null,-1)),we.value.agencyRead?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28 mr-2",onClick:Y}," 機關管理 ")):J("",!0),we.value.studentExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:De}," 匯出 Excel ")):J("",!0)])]),H[38]||(H[38]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Ip,[g.value?(t(),s("div",Rp,H[27]||(H[27]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Pp,[e("thead",null,[e("tr",Up,[H[36]||(H[36]=e("th",{class:"border p-2"},"序",-1)),e("th",Np,[e("div",Tp,[H[28]||(H[28]=xe(" 上級機關 ")),e("button",{onClick:H[7]||(H[7]=i=>fe("parentAgencyName")),class:"ml-1 focus:outline-none"},[b.value==="parentAgencyName"&&r.value==="asc"?(t(),s("span",Vp,"▲")):b.value==="parentAgencyName"&&r.value==="desc"?(t(),s("span",jp,"▼")):(t(),s("span",Lp,"⇅"))])])]),e("th",Fp,[e("div",qp,[H[29]||(H[29]=xe(" 機關名稱 ")),e("button",{onClick:H[8]||(H[8]=i=>fe("subAgencyName")),class:"ml-1 focus:outline-none"},[b.value==="subAgencyName"&&r.value==="asc"?(t(),s("span",Op,"▲")):b.value==="subAgencyName"&&r.value==="desc"?(t(),s("span",Bp,"▼")):(t(),s("span",Hp,"⇅"))])])]),e("th",Wp,[e("div",zp,[H[30]||(H[30]=xe(" 姓名 ")),e("button",{onClick:H[9]||(H[9]=i=>fe("name")),class:"ml-1 focus:outline-none"},[b.value==="name"&&r.value==="asc"?(t(),s("span",Kp,"▲")):b.value==="name"&&r.value==="desc"?(t(),s("span",Jp,"▼")):(t(),s("span",Yp,"⇅"))])])]),e("th",Gp,[e("div",Qp,[H[31]||(H[31]=xe(" 身份證字號 ")),e("button",{onClick:H[10]||(H[10]=i=>fe("idNumber")),class:"ml-1 focus:outline-none"},[b.value==="idNumber"&&r.value==="asc"?(t(),s("span",Zp,"▲")):b.value==="idNumber"&&r.value==="desc"?(t(),s("span",Xp,"▼")):(t(),s("span",ev,"⇅"))])])]),e("th",tv,[e("div",sv,[H[32]||(H[32]=xe(" 行動電話 ")),e("button",{onClick:H[11]||(H[11]=i=>fe("phone")),class:"ml-1 focus:outline-none"},[b.value==="phone"&&r.value==="asc"?(t(),s("span",av,"▲")):b.value==="phone"&&r.value==="desc"?(t(),s("span",ov,"▼")):(t(),s("span",lv,"⇅"))])])]),e("th",nv,[e("div",rv,[H[33]||(H[33]=xe(" 狀態 ")),e("button",{onClick:H[12]||(H[12]=i=>fe("status")),class:"ml-1 focus:outline-none"},[b.value==="status"&&r.value==="asc"?(t(),s("span",iv,"▲")):b.value==="status"&&r.value==="desc"?(t(),s("span",dv,"▼")):(t(),s("span",uv,"⇅"))])])]),e("th",cv,[e("div",pv,[H[34]||(H[34]=xe(" 補助類別 ")),e("button",{onClick:H[13]||(H[13]=i=>fe("subsidyCategory")),class:"ml-1 focus:outline-none"},[b.value==="subsidyCategory"&&r.value==="asc"?(t(),s("span",vv,"▲")):b.value==="subsidyCategory"&&r.value==="desc"?(t(),s("span",mv,"▼")):(t(),s("span",bv,"⇅"))])])]),e("th",fv,[e("div",yv,[H[35]||(H[35]=xe(" 申請補助狀態 ")),e("button",{onClick:H[14]||(H[14]=i=>fe("subsidyStatus")),class:"ml-1 focus:outline-none"},[b.value==="subsidyStatus"&&r.value==="asc"?(t(),s("span",gv,"▲")):b.value==="subsidyStatus"&&r.value==="desc"?(t(),s("span",xv,"▼")):(t(),s("span",hv,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(a.value,(i,n)=>(t(),s("tr",{key:i.id,onClick:h=>j(i.id),class:"cursor-pointer hover:bg-gray-100"},[e("td",_v,l((P.value-1)*As+n+1),1),e("td",kv,l(p(i.parentAgencyName)),1),e("td",$v,l(p(i.subAgencyName)),1),e("td",Cv,l(p(i.name)),1),e("td",Ev,l(w(i.idNumber)),1),e("td",Sv,l(p(i.phone)),1),e("td",Dv,l(p(i.status)),1),e("td",Mv,l(p(i.subsidyCategory)),1),e("td",Av,l(p(i.subsidyStatus)),1)],8,wv))),128)),a.value.length===0?(t(),s("tr",Iv,H[37]||(H[37]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])),!g.value&&a.value.length>0?(t(),s("div",Rv,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:P.value===1,onClick:O}," 上一頁 ",8,Pv),(t(!0),s(Z,null,re(y.value,i=>(t(),s(Z,{key:i},[i!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":i===P.value}]),onClick:n=>W(i)},l(i),11,Uv)):(t(),s("span",Nv,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:P.value===T.value,onClick:_}," 下一頁 ",8,Tv)])):J("",!0)])]),le.value?(t(),s("div",Vv,[e("div",jv,[H[39]||(H[39]=e("h3",{class:"text-lg font-medium mb-4"},"匯入學生",-1)),e("div",Lv,[e("div",Fv,[e("input",{type:"file",ref_key:"fileInput",ref:de,class:"hidden",onChange:Be,accept:".xlsx,.xls,.csv"},null,544),e("p",qv,l(Q.value?Q.value.name:"請選擇 .xlsx 或.ods 檔案"),1),e("button",{onClick:Ie,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),se.value?(t(),s("p",Ov,l(se.value),1)):J("",!0)]),e("div",Bv,[e("button",{onClick:ce,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:ie.value}," 取消 ",8,Hv),e("button",{onClick:me,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!Q.value||ie.value},l(ie.value?"上傳中...":"上傳"),9,Wv)])])])):J("",!0),pe.value?(t(),s("div",zv,[e("div",Kv,[H[40]||(H[40]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",Jv,[e("div",Yv,[e("button",{onClick:H[15]||(H[15]=i=>ve(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:H[16]||(H[16]=i=>ve(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:$e,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):J("",!0)],64))}},Qv=Le(Gv,[["__scopeId","data-v-92d69826"]]),Zv={class:"flex flex-col items-center p-6"},Xv={class:"w-full max-w-[1500px]"},em={class:"w-full max-w-[1500px]"},tm={class:"flex items-center space-x-4"},sm={class:"relative w-40"},am=["disabled"],om={class:"w-full max-w-[1500px] overflow-auto"},lm={key:0,class:"flex justify-center items-center py-10"},nm={key:1},rm={class:"w-full border-collapse"},im={class:"bg-[#EEEFE7]"},dm={class:"border p-2 w-[120px]",scope:"col"},um={class:"flex items-center justify-center"},cm={key:0},pm={key:1},vm={key:2},mm={class:"border p-2",scope:"col"},bm={class:"flex items-center justify-center"},fm={key:0},ym={key:1},gm={key:2},xm={class:"border p-2",scope:"col"},hm={class:"flex items-center justify-center"},wm={key:0},_m={key:1},km={key:2},$m={class:"border p-2",scope:"col"},Cm={class:"flex items-center justify-center"},Em={key:0},Sm={key:1},Dm={key:2},Mm={class:"border p-2",scope:"col"},Am={class:"flex items-center justify-center"},Im={key:0},Rm={key:1},Pm={key:2},Um={class:"border p-2",scope:"col"},Nm={class:"flex items-center justify-center"},Tm={key:0},Vm={key:1},jm={key:2},Lm=["onClick"],Fm={class:"border p-2 text-center"},qm={class:"border p-2 text-center"},Om={class:"border p-2 text-center"},Bm={class:"border p-2 text-center"},Hm={class:"border p-2 text-center"},Wm={class:"border p-2 text-center"},zm={class:"border p-2 text-center"},Km={key:0},Jm={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Ym=["disabled"],Gm=["disabled","onClick"],Qm={key:1,class:"px-2"},Zm=["disabled"],Hs=20,Xm={__name:"History",setup(D){const x=We(),d=lt(),u=m(""),C=m(""),o=m("asc"),N=m(1),K=m(1),$=m(0),P=m(!1),T=m([]),z=m(!1),g=()=>{z.value=!z.value},a=j=>{if(j==null)return"";const R=Number(j);return isNaN(R)?j:z.value?R*18:R},A=j=>j,G=Se(()=>{const j=[];if(K.value<=5)for(let U=1;U<=K.value;U++)j.push(U);else{j.push(1);let U=Math.max(2,N.value-1),te=Math.min(K.value-1,N.value+1);N.value<=3&&(te=Math.min(4,K.value-1)),N.value>=K.value-2&&(U=Math.max(2,K.value-3)),U>2&&j.push("...");for(let ue=U;ue<=te;ue++)j.push(ue);te<K.value-1&&j.push("..."),j.push(K.value)}return j}),k=async()=>{try{P.value=!0;const j=c();console.log("搜尋參數:",j);const R=await Dt.getLearnHistory(j);console.log("API 回應:",R.data),b(R.data)}catch(j){f(j)}finally{P.value=!1}},c=()=>{const j={limit:Hs};return N.value&&(j.page=N.value),u.value&&u.value.trim()!==""&&(j.keyword=u.value.trim()),C.value&&(j.sortBy=C.value),o.value&&(j.sortOrder=o.value),j},b=j=>{j.code===0&&j.message==="success"?r(j.data):(v.showError("載入失敗","獲取學習歷程失敗: "+j.message),console.error("獲取學習歷程失敗:",j.message))},r=j=>{T.value=j.list||[],N.value=j.page||1,K.value=j.totalPage||1,$.value=j.totalCount||0},f=j=>{console.error("獲取學習歷程錯誤:",j),j.response&&j.response.data?p(j.response.data):v.showError("載入失敗","獲取學習歷程錯誤，請稍後再試")},p=j=>{j.message?v.showError("載入失敗",`獲取學習歷程錯誤: ${j.message}`):j.title?v.showError("載入失敗",`獲取學習歷程錯誤: ${j.title}`):v.showError("載入失敗","獲取學習歷程錯誤，請稍後再試"),console.error("錯誤響應數據:",j)},w=j=>{j!==N.value&&!P.value&&(N.value=j)},y=()=>{N.value>1&&!P.value&&N.value--},V=()=>{N.value<K.value&&!P.value&&N.value++},W=()=>{P.value||(N.value=1,k())};Ee(N,()=>{k()});const O=()=>{d.query.page&&(N.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.sortBy&&(C.value=d.query.sortBy),d.query.sortOrder&&(o.value=d.query.sortOrder)};je(()=>{O(),k()});const _=()=>{u.value=""},E=j=>{C.value===j?o.value=o.value==="asc"?"desc":"asc":(C.value=j,o.value="asc"),N.value=1,k()},L=j=>{if(j){const R={from:"history",page:N.value,searchKeyword:u.value||void 0,sortBy:C.value||void 0,sortOrder:o.value||void 0};x.push({name:"Single",params:{id:j},query:R})}};return(j,R)=>(t(),s("div",Zv,[e("div",Xv,[Qe(pt,{breadcrumbs:[{name:"學習歷程",path:"/history"}]})]),e("div",em,[e("div",tm,[R[8]||(R[8]=e("span",null,"查詢學員:",-1)),e("div",sm,[I(e("input",{type:"text","onUpdate:modelValue":R[0]||(R[0]=U=>u.value=U),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名、身份證、手機",onKeyup:Ne(W,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:_,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},R[7]||(R[7]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:P.value},l(P.value?"搜尋中...":"搜尋"),9,am),R[9]||(R[9]=e("div",{class:"flex-grow"},null,-1)),e("button",{class:"px-4 py-2 bg-[#4e9875] hover:bg-[#3e7a5c] text-white",onClick:g}," 切換為"+l(z.value?"學分":"時數"),1)])]),R[15]||(R[15]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",om,[P.value?(t(),s("div",lm,R[10]||(R[10]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",nm,[e("table",rm,[e("thead",null,[R[13]||(R[13]=e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2",colspan:"2",scope:"colgroup"}),e("th",{class:"border p-2 text-center",colspan:"2",scope:"colgroup"},"資訊課程學分數"),e("th",{class:"border p-2 text-center",colspan:"2",scope:"colgroup"},"資安職能學分數"),e("th",{class:"border p-2 text-center",scope:"colgroup"},"合計")],-1)),e("tr",im,[R[12]||(R[12]=e("th",{class:"border p-2 w-[60px]",scope:"col"},"序",-1)),e("th",dm,[e("div",um,[R[11]||(R[11]=xe(" 姓名 ")),e("button",{onClick:R[1]||(R[1]=U=>E("studentName")),class:"ml-1 focus:outline-none"},[C.value==="studentName"&&o.value==="asc"?(t(),s("span",cm,"▲")):C.value==="studentName"&&o.value==="desc"?(t(),s("span",pm,"▼")):(t(),s("span",vm,"⇅"))])])]),e("th",mm,[e("div",bm,[xe(" 已完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:R[2]||(R[2]=U=>E("classCreditsCompleted")),class:"ml-1 focus:outline-none"},[C.value==="classCreditsCompleted"&&o.value==="asc"?(t(),s("span",fm,"▲")):C.value==="classCreditsCompleted"&&o.value==="desc"?(t(),s("span",ym,"▼")):(t(),s("span",gm,"⇅"))])])]),e("th",xm,[e("div",hm,[xe(" 認列"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:R[3]||(R[3]=U=>E("classCertificatedCredits")),class:"ml-1 focus:outline-none"},[C.value==="classCertificatedCredits"&&o.value==="asc"?(t(),s("span",wm,"▲")):C.value==="classCertificatedCredits"&&o.value==="desc"?(t(),s("span",_m,"▼")):(t(),s("span",km,"⇅"))])])]),e("th",$m,[e("div",Cm,[xe(" 已完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:R[4]||(R[4]=U=>E("cyberSecCreditsCompleted")),class:"ml-1 focus:outline-none"},[C.value==="cyberSecCreditsCompleted"&&o.value==="asc"?(t(),s("span",Em,"▲")):C.value==="cyberSecCreditsCompleted"&&o.value==="desc"?(t(),s("span",Sm,"▼")):(t(),s("span",Dm,"⇅"))])])]),e("th",Mm,[e("div",Am,[xe(" 認列"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:R[5]||(R[5]=U=>E("cyberSecCertificatedCredits")),class:"ml-1 focus:outline-none"},[C.value==="cyberSecCertificatedCredits"&&o.value==="asc"?(t(),s("span",Im,"▲")):C.value==="cyberSecCertificatedCredits"&&o.value==="desc"?(t(),s("span",Rm,"▼")):(t(),s("span",Pm,"⇅"))])])]),e("th",Um,[e("div",Nm,[xe(" 總完成"+l(z.value?"時數":"學分")+" ",1),e("button",{onClick:R[6]||(R[6]=U=>E("earnedCredits")),class:"ml-1 focus:outline-none"},[C.value==="earnedCredits"&&o.value==="asc"?(t(),s("span",Tm,"▲")):C.value==="earnedCredits"&&o.value==="desc"?(t(),s("span",Vm,"▼")):(t(),s("span",jm,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(T.value,(U,te)=>(t(),s("tr",{key:U.id,class:"cursor-pointer hover:bg-gray-100",onClick:ue=>L(U.id)},[e("td",Fm,l((N.value-1)*Hs+te+1),1),e("td",qm,l(A(U.studentName)),1),e("td",Om,l(a(U.classCreditsCompleted)),1),e("td",Bm,l(a(U.classCertificatedCredits)),1),e("td",Hm,l(a(U.cyberSecCreditsCompleted)),1),e("td",Wm,l(a(U.cyberSecCertificatedCredits)),1),e("td",zm,l(a(U.earnedCredits)),1)],8,Lm))),128)),T.value.length===0?(t(),s("tr",Km,R[14]||(R[14]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])])),!P.value&&T.value.length>0?(t(),s("div",Jm,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===1||P.value,onClick:y}," 上一頁 ",8,Ym),(t(!0),s(Z,null,re(G.value,U=>(t(),s(Z,{key:U},[U!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":U===N.value}]),disabled:P.value,onClick:te=>w(U)},l(U),11,Gm)):(t(),s("span",Qm,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===K.value||P.value,onClick:V}," 下一頁 ",8,Zm)])):J("",!0)])]))}},eb=Le(Xm,[["__scopeId","data-v-2f5ce219"]]),tb={class:"flex flex-col items-center p-6"},sb={class:"w-full max-w-[1500px]"},ab={class:"w-full max-w-[1500px] space-y-4"},ob={class:"flex items-center"},lb={class:"flex items-center"},nb={class:"flex items-center"},rb={class:"flex items-center space-x-4"},ib={class:"flex items-center"},db={class:"flex items-center"},ub={class:"flex items-center"},cb=["label"],pb=["value"],vb={class:"flex items-center"},mb={class:"flex items-center"},bb={class:"flex items-center"},fb={class:"w-32",for:"train-year"},yb=["placeholder"],gb={class:"flex items-center"},xb={class:"flex items-center"},hb={class:"flex items-center"},wb={class:"flex items-center"},_b={class:"flex items-center"},kb={class:"flex justify-center mt-8"},$b=["disabled"],Cb={__name:"Credits",setup(D){const x=We(),d=m(1),u=m([]),C=m([]),o=m(null),N=Se(()=>d.value===1?"有效時間":"完訓時間"),K=Se(()=>d.value===1?"例：113/04/10":"例：113/04/30"),$=Se(()=>{const G=P.value.CompletionDate;if(!G)return!1;const k=G.split("/");if(k.length!==3)return!1;const c=parseInt(k[0])+1911,b=parseInt(k[1])-1,r=parseInt(k[2]),f=new Date(c,b,r),p=new Date;return f.setHours(0,0,0,0),p.setHours(0,0,0,0),f.getTime()<p.getTime()}),P=m({studentName:"",idNumber:"",subjectName:"",traingUnit:"",CompletionDate:"",credit:0,courseSubjectId:0,trainingPeriod:"",certificateNumber:"",referenceDate:"",grade:null}),T=m(!1),z=()=>!P.value.studentName||!P.value.studentName.trim()?(v.showError("表單驗證失敗","請填寫申請學員姓名"),!1):!P.value.idNumber||!P.value.idNumber.trim()?(v.showError("表單驗證失敗","請填寫身分證字號"),!1):o.value?!P.value.subjectName||!P.value.subjectName.trim()?(v.showError("表單驗證失敗","請填寫課程名稱"),!1):!P.value.traingUnit||!P.value.traingUnit.trim()?(v.showError("表單驗證失敗","請填寫完訓學校"),!1):!P.value.CompletionDate||!P.value.CompletionDate.trim()?(v.showError("表單驗證失敗","請填寫完訓時間"),!1):!P.value.trainingPeriod||!P.value.trainingPeriod.trim()?(v.showError("表單驗證失敗","請填寫訓練起訖時間"),!1):!P.value.credit||isNaN(parseFloat(P.value.credit))||parseFloat(P.value.credit)<=0?(v.showError("表單驗證失敗","請填寫有效的學分數"),!1):!0:(v.showError("表單驗證失敗","請選擇科目"),!1),g=async()=>{try{if(console.log("開始提交表單..."),T.value=!0,!z()){T.value=!1;return}const G={studentName:P.value.studentName,idNumber:P.value.idNumber,category:d.value,subjectName:P.value.subjectName,courseSubjectId:o.value?o.value.id:null,traingUnit:P.value.traingUnit,CompletionDate:P.value.CompletionDate,trainingPeriod:P.value.trainingPeriod,certificateNumber:P.value.certificateNumber,referenceDate:P.value.referenceDate,credit:parseFloat(P.value.credit),grade:P.value.grade};console.log("準備提交學分認證數據:",G);const k=await Dt.creditCertification(G);console.log("學分認證響應:",k.data),k.data.code===0&&k.data.message==="success"?(P.value={studentName:"",idNumber:"",subjectName:"",traingUnit:"",CompletionDate:"",credit:0,courseSubjectId:null,trainingPeriod:"",certificateNumber:"",referenceDate:"",grade:null},o.value=null,v.showSuccess("學分認證成功","學分認證申請已成功提交"),x.push("/credit-list")):(console.error("學分認證失敗:",k.data.message),v.showError("學分認證失敗",k.data.message||"學分認證申請失敗"))}catch(G){if(console.error("學分認證整體錯誤:",G),G.response){console.error("API錯誤響應:",G.response.status,G.response.data);const k=G.response.data.message||"學分認證申請失敗";v.showError("學分認證失敗",k)}else G.request?(console.error("未收到API響應:",G.request),v.showError("學分認證失敗","伺服器無響應，請稍後再試")):(console.error("API請求設置錯誤:",G.message),v.showError("學分認證失敗","請求發送失敗，請稍後再試"))}finally{T.value=!1,console.log("表單提交處理完成")}};je(async()=>{try{const G=await ot.getCourseSubjects();G.data.code===0&&G.data.data?(u.value=G.data.data,a(d.value)):v.showError("載入失敗",G.data.message||"獲取科目選項失敗")}catch(G){console.error("獲取科目選項錯誤:",G),v.showError("載入錯誤","獲取科目選項時發生錯誤")}});const a=G=>{C.value=u.value.map(c=>{const b=c.items.filter(r=>G===1&&r.isCyberSecClass||G===2&&!r.isCyberSecClass);return{...c,items:b}}).filter(c=>c.items.length>0);const k=C.value.flatMap(c=>c.items);o.value&&!k.some(c=>c.id===o.value.id)&&(o.value=null)};Ee(d,G=>{a(G)});const A=()=>{const G=P.value.trainingPeriod,k=d.value;if(!G){P.value.CompletionDate="";return}const c=G.split("-");let b="";c.length===2?b=c[1].trim():b=G.trim();const r=b.split("/");if(r.length!==3){P.value.CompletionDate="";return}const f=parseInt(r[0])+1911,p=parseInt(r[1])-1,w=parseInt(r[2]);let y=new Date(f,p,w);k===1?y.setFullYear(y.getFullYear()+5):k===2&&y.setFullYear(y.getFullYear()+10);const V=y.getFullYear()-1911,W=(y.getMonth()+1).toString().padStart(2,"0"),O=y.getDate().toString().padStart(2,"0");P.value.CompletionDate=`${V}/${W}/${O}`};return Ee([()=>P.value.trainingPeriod,d],()=>{A()}),(G,k)=>(t(),s("div",tb,[e("div",sb,[Qe(pt,{breadcrumbs:[{name:"認列清單",path:"/credit-list"},{name:"學分認列",path:"/credits"}]})]),e("div",ab,[e("div",ob,[k[13]||(k[13]=e("label",{class:"w-32",for:"student-name"},"申請學員:",-1)),I(e("input",{id:"student-name","onUpdate:modelValue":k[0]||(k[0]=c=>P.value.studentName=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.studentName]])]),e("div",lb,[k[14]||(k[14]=e("label",{class:"w-32",for:"id-number"},"身分證字號:",-1)),I(e("input",{id:"id-number","onUpdate:modelValue":k[1]||(k[1]=c=>P.value.idNumber=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.idNumber]])]),e("div",nb,[k[17]||(k[17]=e("label",{class:"w-32",for:"course-type-1"},"課程類別:",-1)),e("div",rb,[e("label",ib,[I(e("input",{id:"course-type-1",type:"radio","onUpdate:modelValue":k[2]||(k[2]=c=>d.value=c),value:1,class:"w-4 h-4 mr-1"},null,512),[[ct,d.value]]),k[15]||(k[15]=e("span",null,"資安職能認列學分數",-1))]),e("label",db,[I(e("input",{type:"radio","onUpdate:modelValue":k[3]||(k[3]=c=>d.value=c),value:2,class:"w-4 h-4 mr-1"},null,512),[[ct,d.value]]),k[16]||(k[16]=e("span",null,"資訊課程認列學分數",-1))])])]),e("div",ub,[k[19]||(k[19]=e("label",{class:"w-32",for:"course-subject"},"科目名稱:",-1)),I(e("select",{id:"course-subject","onUpdate:modelValue":k[4]||(k[4]=c=>o.value=c),class:"p-2 border border-gray-300 outline-none w-60"},[k[18]||(k[18]=e("option",{value:null},"請選擇科目",-1)),(t(!0),s(Z,null,re(C.value,c=>(t(),s("optgroup",{key:c.name,label:c.name},[(t(!0),s(Z,null,re(c.items,b=>(t(),s("option",{key:b.id,value:b},l(b.name),9,pb))),128))],8,cb))),128))],512),[[Pe,o.value]])]),e("div",vb,[k[20]||(k[20]=e("label",{class:"w-32",for:"course-name"},"課程名稱:",-1)),I(e("input",{id:"course-name","onUpdate:modelValue":k[5]||(k[5]=c=>P.value.subjectName=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.subjectName]]),k[21]||(k[21]=e("div",{class:"text-gray-500 text-sm ml-2"},"(學分班近10年或職能班近5年進修科目相同之訓練課程)",-1))]),e("div",mb,[k[22]||(k[22]=e("label",{class:"w-32",for:"train-school"},"完訓學校:",-1)),I(e("input",{id:"train-school","onUpdate:modelValue":k[6]||(k[6]=c=>P.value.traingUnit=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.traingUnit]])]),e("div",bb,[e("label",fb,l(N.value)+":",1),I(e("input",{id:"train-year","onUpdate:modelValue":k[7]||(k[7]=c=>P.value.CompletionDate=c),type:"text",class:X(["p-2 border border-gray-300 outline-none w-60",{"text-red-500":$.value}]),placeholder:K.value},null,10,yb),[[ee,P.value.CompletionDate]])]),e("div",gb,[k[23]||(k[23]=e("label",{class:"w-32",for:"training-period"},"訓練起訖時間:",-1)),I(e("input",{id:"training-period","onUpdate:modelValue":k[8]||(k[8]=c=>P.value.trainingPeriod=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60",placeholder:"例：112/03/01-112/03/31"},null,512),[[ee,P.value.trainingPeriod]])]),e("div",xb,[k[24]||(k[24]=e("label",{class:"w-32",for:"reference-date"},"參照日期起訖:",-1)),I(e("input",{id:"reference-date","onUpdate:modelValue":k[9]||(k[9]=c=>P.value.referenceDate=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60",placeholder:"例：113/04/01-113/04/30"},null,512),[[ee,P.value.referenceDate]]),k[25]||(k[25]=e("div",{class:"text-gray-500 text-sm ml-2"},"(評量效期)",-1))]),e("div",hb,[k[26]||(k[26]=e("label",{class:"w-32",for:"credit"},"學分數:",-1)),I(e("input",{id:"credit","onUpdate:modelValue":k[10]||(k[10]=c=>P.value.credit=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.credit]])]),e("div",wb,[k[27]||(k[27]=e("label",{class:"w-32",for:"grade"},"成績:",-1)),I(e("input",{id:"grade","onUpdate:modelValue":k[11]||(k[11]=c=>P.value.grade=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.grade]])]),e("div",_b,[k[28]||(k[28]=e("label",{class:"w-32",for:"certificate-number"},"證書編號:",-1)),I(e("input",{id:"certificate-number","onUpdate:modelValue":k[12]||(k[12]=c=>P.value.certificateNumber=c),type:"text",class:"p-2 border border-gray-300 outline-none w-60"},null,512),[[ee,P.value.certificateNumber]])]),e("div",kb,[e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#438264] disabled:opacity-50 disabled:cursor-not-allowed",onClick:g,disabled:T.value,"aria-label":"送出學分認列申請"},l(T.value?"處理中...":"送出"),9,$b)])])]))}},Eb=Le(Cb,[["__scopeId","data-v-23a59e52"]]),_t={getExpenseList:D=>he.get("/v1/verification",{params:D}),getExpenseById:D=>he.get(`/v1/verification/${D}`),getStudentInfo:(D,x)=>he.get("/v1/verification/studentInfo",{params:{studentId:D,tab:x}}),updateExpenseStatus:(D,x)=>he.put(`/v1/verification/${D}`,x),getApplicationInfo:D=>he.get(`/v1/verification/info/${D}`),updateApplication:D=>he.put(`/v1/verification/${D.orderId}`,D),createExpense:D=>he.post("/v1/verification",D),getRemittanceApplications:()=>he.get("/v1/verification/remittance"),createRemittance:D=>he.post("/v1/verification/remittance",D),getRemittanceDetail:D=>he.get(`/v1/verification/remittance/${D}`),updateRemittance:D=>he.put(`/v1/verification/remittance/${D.remittanceId}`,D),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),exportRemittanceList:D=>he.post("/v1/verification/remittance/exportList",D,{responseType:"blob"}),exportRemittanceDetail:D=>he.post("/v1/verification/remittance/export",D,{responseType:"blob"}),rejectApplication:D=>he.post("/v1/verification/reject",D),exportNoPassExcel:D=>he.post("/v1/verification/export/nopass",D,{responseType:"blob"}),exportPassExcel:D=>he.post("/v1/verification/export/pass",D,{responseType:"blob"})},Sb={class:"flex flex-col items-center p-6"},Db={class:"w-full max-w-[1500px]"},Mb={class:"w-full max-w-[1500px]"},Ab={class:"mb-4 flex items-center"},Ib={class:"text-xl font-bold"},Rb={class:"mr-4"},Pb={class:"mb-4 border-b"},Ub={class:"flex"},Nb={key:0,class:"overflow-x-auto"},Tb={class:"w-full border-collapse min-w-full max-w-[1500px]"},Vb={class:"border p-2 text-center"},jb={class:"border p-2 text-center"},Lb={class:"border p-2 text-center"},Fb={class:"border p-2 text-center whitespace-pre-line"},qb={class:"border p-2 text-center"},Ob={class:"border p-2 text-center"},Bb={class:"border p-2 text-center"},Hb={class:"border p-2 text-center"},Wb={class:"border p-2 text-center"},zb={class:"border p-2 text-center"},Kb={class:"border p-2 text-center"},Jb={class:"border p-2 text-center"},Yb={key:1},Gb={class:"flex justify-end mb-4"},Qb={class:"overflow-x-auto"},Zb={class:"w-full border-collapse min-w-full max-w-[1500px]"},Xb=["onClick"],ef={class:"border p-2 text-center"},tf={class:"border p-2 text-center"},sf={class:"border p-2 text-center"},af={class:"border p-2 text-center"},of={class:"border p-2 text-center"},lf={class:"border p-2 text-center"},nf={__name:"Expense",setup(D){const x=lt(),d=We(),u=m("history"),C=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:""}),o=m(""),N=m([]),K=m([]),$=m({verificationCreate:!1}),P=k=>k==null?"$------":`$${k.toLocaleString()}`,T=k=>{switch(parseInt(k)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";case 5:return"待補件，不合格";default:return"未知狀態"}},z=k=>{switch(typeof k=="string"?parseInt(k):k){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=()=>{d.push({path:"/grant-application",query:{studentId:C.value.id}})},a=k=>{d.push({path:"/grant-application-edit",query:{studentId:C.value.id,applicationId:k}})},A=async()=>{var k;try{const c=x.query.studentId,b=u.value==="history"?1:2;if(!c)return;const r=await _t.getStudentInfo(c,b);if(r.data&&r.data.code===0){const f=r.data.data;C.value={id:f.studentId,studentName:f.studentName,bankCode:f.bankCode,branchCode:f.branchCode,bankAccount:f.bankAccount,studentIdentity:f.studentIdentity},o.value=f.agencyName,b===1?N.value=f.histories.map(p=>({id:p.learningHistoryId,courseCode:p.courseCode,courseName:p.courseName,schoolName:p.schoolName,startDate:p.startDate,endDate:p.endDate,hours:p.hours,status:p.status,certificateNumber:p.certificateNumber,credits:p.credits,subsidyCount:p.subsidyCount,applied:p.applied,remark:p.remark||"",accumulatedSubsidy:p.approvedAmount||0})):K.value=f.verifications.map(p=>({id:p.orderId,applyDate:p.applicationTime,batchNumber:p.batchNumber||"--",orderNumber:p.caseNumber,applyAmount:p.subsidyAmount,receiptAmount:p.receiptAmount,status:p.status}))}else{const f=((k=r.data)==null?void 0:k.message)||"獲取資料失敗，請稍後再試";throw new Error(f)}}catch(c){console.error("獲取費用核撥詳情失敗:",c),v.showError("貼心提醒","獲取費用核撥詳情失敗，即將返回列表頁"),d.push("/expense-list")}},G=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?($.value=k.data.data,console.log("費用核撥頁面權限:",$.value)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}};return Ee(u,async k=>{d.replace({query:{...x.query,tab:k}}),await A()}),je(()=>{if(!x.query.studentId){x.path==="/expense"&&(v.showError("貼心提醒","缺少必要的參數，請先選擇學員"),d.push("/expense-list"));return}if(x.query.tab){const c=x.query.tab;["history","applications"].includes(c)&&(u.value=c)}else d.replace({query:{...x.query,tab:u.value}});A(),G()}),(k,c)=>(t(),s("div",Sb,[e("div",Db,[Qe(pt,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:"/expense"}]})]),e("div",Mb,[e("div",Ab,[e("div",Ib,[e("span",Rb,l(o.value),1),e("span",null,[xe(l(C.value.studentName)+" ",1),C.value.studentIdentity===1?(t(),s(Z,{key:0},[xe(" 全修班 ")],64)):C.value.studentIdentity===2?(t(),s(Z,{key:1},[xe(" 選修班 ")],64)):J("",!0)])])]),e("div",Pb,[e("div",Ub,[e("button",{class:X(["px-4 py-2 mr-10 font-medium",u.value==="history"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-[#4e9875]"]),onClick:c[0]||(c[0]=b=>u.value="history")}," 學習歷程 ",2),e("button",{class:X(["px-4 py-2 font-medium",u.value==="applications"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-[#4e9875]"]),onClick:c[1]||(c[1]=b=>u.value="applications")}," 申請表單 ",2)])]),u.value==="history"?(t(),s("div",Nb,[e("table",Tb,[c[2]||(c[2]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"課程代號"),e("th",{class:"border p-2"},"科目"),e("th",{class:"border p-2"},"訓練單位"),e("th",{class:"border p-2"},"訓練日期起訖"),e("th",{class:"border p-2"},"上課時數"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"學分證書編號"),e("th",{class:"border p-2"},"取得學分"),e("th",{class:"border p-2"},"累積核撥費用"),e("th",{class:"border p-2"},[xe("申請補助"),e("br"),xe("次數")]),e("th",{class:"border p-2"},[xe("已申請"),e("br"),xe("(%)")]),e("th",{class:"border p-2"},"備註")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(N.value,(b,r)=>(t(),s("tr",{key:b.id,class:X({"bg-[#F7F7F7]":r%2===1})},[e("td",Vb,l(b.courseCode),1),e("td",jb,l(b.courseName),1),e("td",Lb,l(b.schoolName),1),e("td",Fb,l(b.startDate)+"~"+l(b.endDate),1),e("td",qb,l(b.hours),1),e("td",Ob,l(b.status),1),e("td",Bb,l(b.certificateNumber||"--"),1),e("td",Hb,l(b.credits),1),e("td",Wb,l(P(b.accumulatedSubsidy)),1),e("td",zb,l(b.subsidyCount),1),e("td",Kb,l(b.applied),1),e("td",Jb,l(b.remark||"--"),1)],2))),128))])])])):J("",!0),u.value==="applications"?(t(),s("div",Yb,[e("div",Gb,[$.value.verificationCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] flex items-center",onClick:g},"新增申請單 ")):J("",!0)]),e("div",Qb,[e("table",Zb,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2"},"申請日期"),e("th",{class:"border p-2"},"批號"),e("th",{class:"border p-2"},"單號"),e("th",{class:"border p-2"},"申請金額"),e("th",{class:"border p-2"},"收據金額"),e("th",{class:"border p-2"},"申請單狀態")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(K.value,(b,r)=>(t(),s("tr",{key:r,class:X([{"bg-[#F7F7F7]":r%2===1},"hover:bg-gray-100 cursor-pointer"]),onClick:f=>a(b.id)},[e("td",ef,l(b.applyDate),1),e("td",tf,l(b.batchNumber),1),e("td",sf,l(b.orderNumber),1),e("td",af,l(P(b.applyAmount)),1),e("td",of,l(P(b.receiptAmount)),1),e("td",lf,[e("span",{class:X(["px-2 py-1 rounded text-sm",z(b.status)])},l(T(b.status)),3)])],10,Xb))),128))])])])])):J("",!0)])]))}},rf=Le(nf,[["__scopeId","data-v-05893bb8"]]),js={getEffectTracking:D=>he.get("/v1/effectTracking",{params:D}),updateEffectTracking:(D,x)=>he.put(`/v1/effectTracking/${D}`,x),getDeclaration:D=>he.get(`/v1/effectTracking/declaration/${D}`),updateDeclaration:(D,x)=>he.put(`/v1/effectTracking/declaration/${D}`,x)},df={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},uf={class:"bg-white rounded-md shadow-lg w-[800px] max-w-[90%] max-h-[90vh] overflow-auto"},cf={class:"p-4"},pf={class:"w-full border border-black"},vf={class:"w-full border-collapse"},mf={class:"border-t border-black"},bf={class:"p-4"},ff={class:"checkbox-item"},yf={class:"checkbox-item"},gf={class:"checkbox-item"},xf={class:"checkbox-item"},hf={class:"border-t border-black"},wf={class:"p-4"},_f={class:"checkbox-item"},kf={class:"checkbox-item"},$f={class:"checkbox-item"},Cf={class:"checkbox-item"},Ef={class:"checkbox-item"},Sf={class:"border-t border-black"},Df={class:"p-4"},Mf={class:"checkbox-item"},Af={class:"checkbox-item"},If={class:"checkbox-item"},Rf={class:"checkbox-item"},Pf={class:"border-t border-black"},Uf={class:"p-4"},Nf={class:"checkbox-item"},Tf={id:"otherRemarkGroup",class:"flex-1 leading-6"},Vf={class:"border-b border-black inline-block ml-2 w-[200px] align-text-bottom"},jf=["disabled"],Lf={class:"p-4 border-t flex justify-center space-x-4"},Ff=["disabled"],qf={__name:"Certificate",props:{studentId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},initialData:{type:Object,default:()=>({})}},emits:["close","save"],setup(D,{emit:x}){const d=D,u=x,C=m(d.show);Ee(()=>d.show,k=>{C.value=k,k&&d.studentId&&(P(),T())}),Ee(()=>d.studentId,(k,c)=>{k&&C.value&&(P(),T())});const o=m({strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}),N=m(!1),K=m({performanceTrackingEdit:!1}),$=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?(K.value=k.data.data,console.log("職務內容頁面權限:",K.value)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},P=()=>{d.initialData&&Object.keys(d.initialData).length>0?o.value={strategies:{...d.initialData.strategies},management:{...d.initialData.management},technical:{...d.initialData.technical},otherSelected:!!(d.initialData.remark&&String(d.initialData.remark).trim()),remark:d.initialData.remark||""}:o.value={strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}},T=async()=>{var k;if(d.studentId)try{const c=await js.getDeclaration(d.studentId);if(c&&c.data&&c.data.code===0){const b=c.data.data.options||[],r=c.data.data.remark||"";g(),b.forEach(f=>{z(f)}),o.value.remark=r}else console.error("API 返回錯誤:",((k=c==null?void 0:c.data)==null?void 0:k.message)||"未知錯誤")}catch(c){console.error("獲取資安工作項目數據失敗:",c),console.error("詳細錯誤信息:",c.response||c.message||c),v.showError("資料載入失敗","無法獲取職務內容資料")}},z=k=>{k>=1&&k<=4?o.value.strategies[`strategy${k}`]=!0:k>=5&&k<=9?o.value.management[`management${k-4}`]=!0:k>=10&&k<=13?o.value.technical[`technical${k-9}`]=!0:k===14&&(o.value.otherSelected=!0)},g=()=>{o.value={strategies:{strategy1:!1,strategy2:!1,strategy3:!1,strategy4:!1},management:{management1:!1,management2:!1,management3:!1,management4:!1,management5:!1},technical:{technical1:!1,technical2:!1,technical3:!1,technical4:!1},otherSelected:!1,remark:""}},a=()=>{const k=[];for(let c=1;c<=4;c++)o.value.strategies[`strategy${c}`]&&k.push(c);for(let c=1;c<=5;c++)o.value.management[`management${c}`]&&k.push(c+4);for(let c=1;c<=4;c++)o.value.technical[`technical${c}`]&&k.push(c+9);return o.value.otherSelected&&k.push(14),k},A=async()=>{u("close")},G=async()=>{var k;try{if(N.value=!0,!d.studentId){console.error("儲存失敗: 無學生ID"),v.showError("儲存失敗","無法識別學生資訊");return}const c=a();console.log("儲存前獲取的選項:",c);const b={studentId:d.studentId,options:c,remark:o.value.otherSelected?String(o.value.remark).trim():null};console.log("準備儲存資安工作項目數據:",b),console.log("API 請求路徑:",`/v1/effectTracking/declaration/${d.studentId}`);const r=await js.updateDeclaration(d.studentId,b);if(console.log("API 返回完整響應:",r),r&&r.data&&r.data.code===0)console.log("儲存成功:",r.data),v.showSuccess("儲存成功","資料已成功儲存"),u("save",b);else{const f=((k=r.data)==null?void 0:k.message)||"儲存失敗，請稍後再試";console.error("API 返回錯誤:",f),v.showError("儲存失敗",f)}}catch(c){console.error("儲存失敗:",c),console.error("詳細錯誤信息:",c.response||c.message||c),v.showError("儲存失敗",c.message||"儲存資料時發生錯誤")}finally{N.value=!1}};return je(()=>{console.log("Certificate 組件掛載，props.show =",d.show,"，studentId =",d.studentId),$(),P(),d.show&&d.studentId&&T()}),(k,c)=>C.value?(t(),s("div",df,[e("div",uf,[e("div",{class:"p-4 border-b flex justify-between items-center"},[c[16]||(c[16]=e("h2",{class:"text-xl font-bold"},"投入資安工作項目",-1)),e("button",{onClick:A,class:"text-gray-500 hover:text-gray-700"},c[15]||(c[15]=[e("span",{class:"text-2xl"},"×",-1)]))]),e("div",cf,[e("div",pf,[c[35]||(c[35]=e("div",{class:"p-4 bg-[#5ea989] text-white font-bold text-center"}," 資通安全專職人員之職務內容分策略面、管理面及技術面等三大面向（可複選） ",-1)),e("table",vf,[e("tbody",null,[e("tr",mf,[c[21]||(c[21]=e("th",{class:"w-[15%] border-r border-black p-4 font-bold text-center"},"策略面",-1)),e("td",bf,[e("div",ff,[I(e("input",{type:"checkbox",id:"strategy1","onUpdate:modelValue":c[0]||(c[0]=b=>o.value.strategies.strategy1=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy1]]),c[17]||(c[17]=e("label",{for:"strategy1"},"機關（及所屬）資安政策、資源分配及整體防護策略之規劃。",-1))]),e("div",yf,[I(e("input",{type:"checkbox",id:"strategy2","onUpdate:modelValue":c[1]||(c[1]=b=>o.value.strategies.strategy2=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy2]]),c[18]||(c[18]=e("label",{for:"strategy2"},"機關導入資安治理成熟度之協調與推動。",-1))]),e("div",gf,[I(e("input",{type:"checkbox",id:"strategy3","onUpdate:modelValue":c[2]||(c[2]=b=>o.value.strategies.strategy3=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy3]]),c[19]||(c[19]=e("label",{for:"strategy3"},"資通安全維護計畫實施情形之績效評估與檢討。",-1))]),e("div",xf,[I(e("input",{type:"checkbox",id:"strategy4","onUpdate:modelValue":c[3]||(c[3]=b=>o.value.strategies.strategy4=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.strategies.strategy4]]),c[20]||(c[20]=e("label",{for:"strategy4"},"（屬上級或監管機關者）稽核所屬（或監管）公務機關之資通安全維護計畫實施情形。",-1))])])]),e("tr",hf,[c[27]||(c[27]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"管理面",-1)),e("td",wf,[e("div",_f,[I(e("input",{type:"checkbox",id:"management1","onUpdate:modelValue":c[4]||(c[4]=b=>o.value.management.management1=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management1]]),c[22]||(c[22]=e("label",{for:"management1"},"訂定、修正及實施資通安全維護計畫並提出實施情形。",-1))]),e("div",kf,[I(e("input",{type:"checkbox",id:"management2","onUpdate:modelValue":c[5]||(c[5]=b=>o.value.management.management2=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management2]]),c[23]||(c[23]=e("label",{for:"management2"},"訂定及建立資通安全事件通報及應變機制。",-1))]),e("div",$f,[I(e("input",{type:"checkbox",id:"management3","onUpdate:modelValue":c[6]||(c[6]=b=>o.value.management.management3=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management3]]),c[24]||(c[24]=e("label",{for:"management3"},"辦理下列機關資通安全責任等級之應辦事項：資訊安全管理系統之導入及通過公正第三方之驗證、業務持續運作演練、辦理資通安全教育訓練等。",-1))]),e("div",Cf,[I(e("input",{type:"checkbox",id:"management4","onUpdate:modelValue":c[7]||(c[7]=b=>o.value.management.management4=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management4]]),c[25]||(c[25]=e("label",{for:"management4"},"（屬上級或監管機關者）針對所屬（或監管）公務機關，審查其資通安全維護計畫及實施情形、辦理其資通安全事件通報之審核、應變協處與改善報告之審核。",-1))]),e("div",Ef,[I(e("input",{type:"checkbox",id:"management5","onUpdate:modelValue":c[8]||(c[8]=b=>o.value.management.management5=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.management.management5]]),c[26]||(c[26]=e("label",{for:"management5"},"委外廠商管理與稽核。",-1))])])]),e("tr",Sf,[c[32]||(c[32]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"技術面",-1)),e("td",Df,[e("div",Mf,[I(e("input",{type:"checkbox",id:"technical1","onUpdate:modelValue":c[9]||(c[9]=b=>o.value.technical.technical1=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical1]]),c[28]||(c[28]=e("label",{for:"technical1"},"整合、分析與分享資通安全情資。",-1))]),e("div",Af,[I(e("input",{type:"checkbox",id:"technical2","onUpdate:modelValue":c[10]||(c[10]=b=>o.value.technical.technical2=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical2]]),c[29]||(c[29]=e("label",{for:"technical2"},"配合主管機關辦理機關資通安全演練作業。",-1))]),e("div",If,[I(e("input",{type:"checkbox",id:"technical3","onUpdate:modelValue":c[11]||(c[11]=b=>o.value.technical.technical3=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical3]]),c[30]||(c[30]=e("label",{for:"technical3"},"辦理下列機關資通安全責任等級之應辦事項：安全性檢測、資通安全健診、資通安全威脅偵測管理機制、政府組態基準、資通安全防護等。",-1))]),e("div",Rf,[I(e("input",{type:"checkbox",id:"technical4","onUpdate:modelValue":c[12]||(c[12]=b=>o.value.technical.technical4=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2"},null,512),[[Ce,o.value.technical.technical4]]),c[31]||(c[31]=e("label",{for:"technical4"},"（屬上級或監管機關者）針對所屬（或監管）公務機關，規劃及辦理資通安全演練作業。",-1))])])]),e("tr",Pf,[c[34]||(c[34]=e("th",{class:"border-r border-black p-4 font-bold text-center"},"其他",-1)),e("td",Uf,[e("div",Nf,[I(e("input",{type:"checkbox",id:"otherRemark","onUpdate:modelValue":c[13]||(c[13]=b=>o.value.otherSelected=b),class:"w-5 h-5 min-w-[20px] min-h-[20px] border border-black mr-2","aria-controls":"otherRemarkGroup"},null,512),[[Ce,o.value.otherSelected]]),e("div",Tf,[c[33]||(c[33]=e("label",{for:"otherRemark",class:"inline"}," 擔任機關資安專責人員，主要其他涉及（資通安全管理法）所定應辦事項或防護措施執行等資安工作，具體項目說明如右： ",-1)),e("div",Vf,[I(e("input",{type:"text","onUpdate:modelValue":c[14]||(c[14]=b=>o.value.remark=b),class:"w-full outline-none",disabled:!o.value.otherSelected,"aria-label":"具體項目說明如右"},null,8,jf),[[ee,o.value.remark]])])])])])])])])])]),e("div",Lf,[K.value.performanceTrackingEdit?(t(),s("button",{key:0,class:"px-8 py-2 rounded-md bg-[#4e9875] text-white hover:bg-[#4d8b6f]",onClick:G,disabled:N.value},l(N.value?"儲存中...":"確認"),9,Ff)):J("",!0),e("button",{class:"px-8 py-2 rounded-md bg-gray-400 text-white hover:bg-gray-500",onClick:A}," 取消 ")])])])):J("",!0)}},Bs=Le(qf,[["__scopeId","data-v-c4206363"]]),Of={class:"flex flex-col items-center p-6"},Bf={class:"w-full max-w-[1500px]"},Hf={class:"w-full max-w-[1500px] flex items-center space-x-4 mb-6"},Wf={class:"relative w-40"},zf=["value"],Kf=["value"],Jf={class:"w-full max-w-[1500px]"},Yf={key:0,class:"flex justify-center items-center py-10"},Gf={key:1,class:"w-full border-collapse"},Qf={class:"border p-2"},Zf={class:"flex items-center justify-center"},Xf={key:0},ey={key:1},ty={key:2},sy={class:"border p-2"},ay={class:"flex items-center justify-center"},oy={key:0},ly={key:1},ny={key:2},ry={class:"border p-2"},iy={class:"flex items-center justify-center"},dy={key:0},uy={key:1},cy={key:2},py={class:"border p-2"},vy={class:"flex items-center justify-center"},my={key:0},by={key:1},fy={key:2},yy={class:"border p-2"},gy={class:"flex items-center justify-center"},xy={key:0},hy={key:1},wy={key:2},_y={class:"border p-2"},ky={class:"flex items-center justify-center"},$y={key:0},Cy={key:1},Ey={key:2},Sy={class:"border p-2"},Dy={class:"flex items-center justify-center"},My={key:0},Ay={key:1},Iy={key:2},Ry={class:"border p-2 text-center"},Py={class:"border p-2 text-center"},Uy={class:"border p-2 text-center"},Ny={class:"border p-2 text-center"},Ty={class:"border p-2 text-center"},Vy={class:"border p-2 text-center"},jy={class:"border p-2 text-center"},Ly={class:"border p-2 text-center"},Fy={class:"border p-2 text-center space-x-2"},qy=["onClick"],Oy=["onClick"],By={key:0},Hy={key:2,class:"flex justify-center items-center space-x-2 mt-6"},Wy=["disabled"],zy=["onClick"],Ky={key:1,class:"px-2"},Jy=["disabled"],Yy={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Gy={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},Qy={class:"border border-gray-300 p-4 mb-4"},Zy={class:"mb-4"},Xy={class:"flex items-center mb-4"},e1={class:"flex items-center space-x-4"},t1={class:"flex items-center"},s1={class:"flex items-center"},a1={class:"flex items-center"},o1={class:"flex items-center mb-4"},l1={class:"flex items-center"},n1={class:"flex items-center mb-4"},r1={class:"flex items-center"},i1={class:"flex items-center mt-1 ml-32"},d1={class:"border-b border-black w-full"},u1={class:"mt-4 p-3 border border-gray-300 mb-4"},c1={class:"grid grid-cols-2 gap-4"},p1={class:"border-b border-black w-full"},v1={class:"border-b border-black w-full"},m1={class:"border-b border-black w-full"},b1={class:"border-b border-black w-full"},f1={key:0,class:"ml-7"},y1={class:"mt-2"},g1={class:"flex items-start mb-2"},x1={class:"flex items-start mb-2"},h1={class:"flex items-start"},w1={class:"border-b border-black w-64 ml-2"},_1=["disabled"],k1={class:"flex justify-center space-x-2"},$1=["disabled"],C1={__name:"Management",setup(D){const x=We(),d=lt(),u=m({performanceTrackingEdit:!1}),C=async()=>{try{const de=await tt.getSidebarPermissions();de.data.code===0&&de.data.message==="success"?(u.value=de.data.data,console.log("追蹤管理頁面權限:",u.value)):console.error("獲取權限失敗:",de.data.message)}catch(de){console.error("獲取權限錯誤:",de)}},o=m(""),N=m(""),K=m(""),$=m([]),P=m([]),T=m(1),z=m(20),g=m(1),a=m(0),A=m(!1),G=m([]),k=m(""),c=m("asc"),b=m(!1),r=m(null),f=m(0),p=m(""),w=m(""),y=m(""),V=m(""),W=m(0),O=m(""),_=m(0),E=m(""),L=m(!1),j=m(null),R=m({}),U=Se(()=>!(!_.value||!f.value||Number(f.value)===2&&(!W.value||Number(W.value)===3&&!O.value.trim()))),te=async()=>{var de;try{const ae=await ot.getAgencyOptions();ae.data&&ae.data.code===0?$.value=ae.data.data:console.error("獲取機關選項失敗:",((de=ae.data)==null?void 0:de.message)||"未知錯誤")}catch(ae){console.error("獲取機關選項錯誤:",ae)}},ue=async()=>{var de;try{const ae=await ot.getStudentStatusOptions();ae.data&&ae.data.code===0?P.value=ae.data.data:(console.error("獲取學員受訓狀態選項失敗:",((de=ae.data)==null?void 0:de.message)||"未知錯誤"),P.value=[])}catch(ae){console.error("獲取學員受訓狀態選項錯誤:",ae),P.value=[]}},ye=Se(()=>{const de=[];if(g.value<=5)for(let ce=1;ce<=g.value;ce++)de.push(ce);else{de.push(1);let ce=Math.max(2,T.value-1),Ie=Math.min(g.value-1,T.value+1);T.value<=3&&(Ie=Math.min(4,g.value-1)),T.value>=g.value-2&&(ce=Math.max(2,g.value-3)),ce>2&&de.push("...");for(let Be=ce;Be<=Ie;Be++)de.push(Be);Ie<g.value-1&&de.push("..."),de.push(g.value)}return de}),ke=async()=>{try{A.value=!0;const de={page:T.value,limit:z.value,agencyId:o.value||void 0,status:N.value||void 0,sortBy:k.value||void 0,sortOrder:c.value||void 0,keyword:K.value||void 0};console.log("獲取追蹤成效參數:",de);const ae=await js.getEffectTracking(de);ae.data.code===0?(G.value=ae.data.data.list.map(ce=>({id:ce.id,studentId:ce.id,name:ce.name,idNumber:ce.idNumber,certificatedHours:ce.certificatedHours||0,trainingHours:ce.trainingHours||0,totalHours:ce.totalHours||0,status:ce.status,subAgencyName:ce.subAgencyName,selectItem:ce.selectItem,originalPosition:ce.originalPosition||"",currentPosition:ce.currentPosition||"",originalAgency:ce.originalAgency||"",currentAgency:ce.currentAgency||"",fillMethod:ce.fillMethod,trackingReasonOption:ce.trackingReasonOption,trackingReasonDetail:ce.trackingReasonDetail||"",secWorkDetail:ce.secWorkDetail,jobDescription:ce.jobDescription,transferDate:ce.transferDate||""})),a.value=ae.data.data.totalCount||0,g.value=Math.ceil(a.value/z.value)):(console.error("獲取追蹤成效列表失敗:",ae.data.message),G.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗",ae.data.message||"無法獲取追蹤成效列表，請稍後再試"))}catch(de){console.error("獲取追蹤成效列表錯誤:",de),G.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗","無法獲取追蹤成效列表，請稍後再試")}finally{A.value=!1}},De=Se(()=>G.value),$e=de=>{T.value=de,ke()},ve=()=>{T.value>1&&(T.value--,ke())},oe=()=>{T.value<g.value&&(T.value++,ke())},q=de=>{k.value===de?c.value=c.value==="asc"?"desc":"asc":(k.value=de,c.value="asc"),ke()},S=de=>{r.value=de,f.value=de.selectItem||0,p.value=de.originalPosition||"",w.value=de.currentPosition||"",y.value=de.originalAgency||"",V.value=de.currentAgency||"",W.value=de.trackingReasonOption||0,O.value=de.trackingReasonDetail||"",_.value=de.fillMethod||0,E.value=de.transferDate||"",b.value=!0},Y=()=>{b.value=!1,r.value=null},fe=async()=>{var de;if(r.value)try{const ae={selectItem:f.value,originalPosition:p.value,currentPosition:w.value,originalAgency:y.value,currentAgency:V.value,trackingReasonOption:W.value,trackingReasonDetail:O.value,fillMethod:_.value,transferDate:E.value},ce=await js.updateEffectTracking(r.value.id,ae);if(ce.data&&ce.data.code===0){const Ie=G.value.findIndex(Be=>Be.id===r.value.id);Ie!==-1&&(G.value[Ie].selectItem=f.value,G.value[Ie].originalPosition=p.value,G.value[Ie].currentPosition=w.value,G.value[Ie].originalAgency=y.value,G.value[Ie].currentAgency=V.value,G.value[Ie].trackingReasonOption=W.value,G.value[Ie].trackingReasonDetail=O.value,G.value[Ie].fillMethod=_.value,G.value[Ie].transferDate=E.value),v.showSuccess("儲存成功","已成功儲存學員資料"),ke()}else{const Ie=((de=ce.data)==null?void 0:de.message)||"儲存失敗，請稍後再試";v.showError("儲存失敗",Ie)}}catch(ae){console.error("更新追蹤成效資料錯誤:",ae),v.showError("儲存失敗","更新資料時發生錯誤，請稍後再試")}finally{Y()}},le=()=>{console.log("搜尋條件:",{keyword:K.value,agency:o.value,status:N.value}),T.value=1,ke()},Q=de=>{console.log("openEvidenceModal 被調用，學生ID:",de.id),j.value=de.id,R.value={},L.value=!0,console.log("當前狀態: showEvidenceModal =",L.value,"，selectedStudentId =",j.value)},se=de=>{console.log("保存證書數據:",de),L.value=!1,ke(),v.showSuccess("儲存成功","職務內容已成功儲存")},ie=()=>{r.value?(console.log("打開職務內容彈窗，學生ID:",r.value.id),j.value=r.value.id,R.value={},L.value=!0):v.showError("錯誤","無法識別學生資訊")};return je(()=>{C(),te(),ue(),d.query.subAgencyName&&(o.value=d.query.subAgencyName),d.query.status&&(N.value=d.query.status),d.query.keyword&&(K.value=d.query.keyword),d.query.page&&(T.value=parseInt(d.query.page,10)||1),ke()}),Ee([o,N,K,T],()=>{x.replace({query:{...d.query,subAgencyName:o.value||void 0,status:N.value||void 0,keyword:K.value||void 0,page:T.value}})},{deep:!0}),(de,ae)=>(t(),s(Z,null,[e("div",Of,[e("div",Bf,[Qe(pt,{breadcrumbs:[{name:"追蹤管理",path:"/management"}]})]),e("div",Hf,[ae[29]||(ae[29]=e("span",null,"查詢:",-1)),e("div",Wf,[I(e("input",{type:"text","onUpdate:modelValue":ae[0]||(ae[0]=ce=>K.value=ce),class:"p-2 border border-gray-300 outline-none w-full",placeholder:"姓名/身分證字號",onKeyup:Ne(le,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[ee,K.value]]),K.value?(t(),s("button",{key:0,onClick:ae[1]||(ae[1]=ce=>K.value=""),class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},ae[26]||(ae[26]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),I(e("select",{"onUpdate:modelValue":ae[2]||(ae[2]=ce=>o.value=ce),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(le,["enter"])},[ae[27]||(ae[27]=e("option",{value:""},"薦派機關",-1)),(t(!0),s(Z,null,re($.value,ce=>(t(),s("option",{key:ce.id,value:ce.id},l(ce.name),9,zf))),128))],544),[[Pe,o.value]]),I(e("select",{"onUpdate:modelValue":ae[3]||(ae[3]=ce=>N.value=ce),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(le,["enter"])},[ae[28]||(ae[28]=e("option",{value:""},"學員受訓狀態",-1)),(t(!0),s(Z,null,re(P.value,ce=>(t(),s("option",{key:ce.id,value:ce.id},l(ce.name),9,Kf))),128))],544),[[Pe,N.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:le}," 搜尋 ")]),ae[41]||(ae[41]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",Jf,[A.value?(t(),s("div",Yf,ae[30]||(ae[30]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Gf,[e("thead",null,[e("tr",null,[ae[38]||(ae[38]=e("th",{class:"border p-2"}," 序 ",-1)),e("th",Qf,[e("div",Zf,[ae[31]||(ae[31]=xe(" 機關名稱 ")),e("button",{onClick:ae[4]||(ae[4]=ce=>q("subAgencyName")),class:"ml-1 focus:outline-none"},[k.value==="subAgencyName"&&c.value==="asc"?(t(),s("span",Xf,"▲")):k.value==="subAgencyName"&&c.value==="desc"?(t(),s("span",ey,"▼")):(t(),s("span",ty,"⇅"))])])]),e("th",sy,[e("div",ay,[ae[32]||(ae[32]=xe(" 姓名 ")),e("button",{onClick:ae[5]||(ae[5]=ce=>q("name")),class:"ml-1 focus:outline-none"},[k.value==="name"&&c.value==="asc"?(t(),s("span",oy,"▲")):k.value==="name"&&c.value==="desc"?(t(),s("span",ly,"▼")):(t(),s("span",ny,"⇅"))])])]),e("th",ry,[e("div",iy,[ae[33]||(ae[33]=xe(" 身份證字號 ")),e("button",{onClick:ae[6]||(ae[6]=ce=>q("idNumber")),class:"ml-1 focus:outline-none"},[k.value==="idNumber"&&c.value==="asc"?(t(),s("span",dy,"▲")):k.value==="idNumber"&&c.value==="desc"?(t(),s("span",uy,"▼")):(t(),s("span",cy,"⇅"))])])]),e("th",py,[e("div",vy,[ae[34]||(ae[34]=xe(" 認列時數 ")),e("button",{onClick:ae[7]||(ae[7]=ce=>q("certificatedHours")),class:"ml-1 focus:outline-none"},[k.value==="certificatedHours"&&c.value==="asc"?(t(),s("span",my,"▲")):k.value==="certificatedHours"&&c.value==="desc"?(t(),s("span",by,"▼")):(t(),s("span",fy,"⇅"))])])]),e("th",yy,[e("div",gy,[ae[35]||(ae[35]=xe(" 訓練時數 ")),e("button",{onClick:ae[8]||(ae[8]=ce=>q("trainingHours")),class:"ml-1 focus:outline-none"},[k.value==="trainingHours"&&c.value==="asc"?(t(),s("span",xy,"▲")):k.value==="trainingHours"&&c.value==="desc"?(t(),s("span",hy,"▼")):(t(),s("span",wy,"⇅"))])])]),e("th",_y,[e("div",ky,[ae[36]||(ae[36]=xe(" 總訓練時數 ")),e("button",{onClick:ae[9]||(ae[9]=ce=>q("totalHours")),class:"ml-1 focus:outline-none"},[k.value==="totalHours"&&c.value==="asc"?(t(),s("span",$y,"▲")):k.value==="totalHours"&&c.value==="desc"?(t(),s("span",Cy,"▼")):(t(),s("span",Ey,"⇅"))])])]),e("th",Sy,[e("div",Dy,[ae[37]||(ae[37]=xe(" 狀態 ")),e("button",{onClick:ae[10]||(ae[10]=ce=>q("status")),class:"ml-1 focus:outline-none"},[k.value==="status"&&c.value==="asc"?(t(),s("span",My,"▲")):k.value==="status"&&c.value==="desc"?(t(),s("span",Ay,"▼")):(t(),s("span",Iy,"⇅"))])])]),ae[39]||(ae[39]=e("th",{class:"border p-2"},"投入資安工作說明",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(De.value,(ce,Ie)=>(t(),s("tr",{key:ce.id},[e("td",Ry,l((T.value-1)*z.value+Ie+1),1),e("td",Py,l(ce.subAgencyName),1),e("td",Uy,l(ce.name),1),e("td",Ny,l(ce.idNumber),1),e("td",Ty,l(ce.certificatedHours),1),e("td",Vy,l(ce.trainingHours),1),e("td",jy,l(ce.totalHours),1),e("td",Ly,l(ce.status),1),e("td",Fy,[e("button",{class:X(["px-4 py-1 text-white hover:opacity-90",{"bg-[#4e9875]":ce.secWorkDetail===1,"bg-red-500":ce.secWorkDetail===2,"bg-[#3e4346]":ce.secWorkDetail===3||ce.secWorkDetail===void 0}]),onClick:Be=>S(ce)}," 工作明細 ",10,qy),e("button",{class:X(["px-4 py-1 text-white hover:opacity-90",{"bg-[#4e9875]":ce.jobDescription===1,"bg-[#3e4346]":ce.jobDescription===3||ce.jobDescription===void 0}]),onClick:Be=>Q(ce)}," 職務內容 ",10,Oy)])]))),128)),G.value.length===0?(t(),s("tr",By,ae[40]||(ae[40]=[e("td",{colspan:"9",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])),!A.value&&G.value.length>0?(t(),s("div",Hy,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:T.value===1,onClick:ve}," 上一頁 ",8,Wy),(t(!0),s(Z,null,re(ye.value,ce=>(t(),s(Z,{key:ce},[ce!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":ce===T.value}]),onClick:Ie=>$e(ce)},l(ce),11,zy)):(t(),s("span",Ky,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:T.value===g.value,onClick:oe}," 下一頁 ",8,Jy)])):J("",!0)])]),b.value?(t(),s("div",Yy,[e("div",Gy,[ae[60]||(ae[60]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",Qy,[e("div",Zy,[e("div",Xy,[ae[45]||(ae[45]=e("span",{class:"mr-4"},[xe("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",e1,[e("label",t1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[11]||(ae[11]=ce=>_.value=ce),value:1,class:"w-4 h-4 mr-1"},null,512),[[ct,_.value]]),ae[42]||(ae[42]=e("span",null,"核撥申請",-1))]),e("label",s1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[12]||(ae[12]=ce=>_.value=ce),value:2,class:"w-4 h-4 mr-1"},null,512),[[ct,_.value]]),ae[43]||(ae[43]=e("span",null,"電子郵件",-1))]),e("label",a1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[13]||(ae[13]=ce=>_.value=ce),value:3,class:"w-4 h-4 mr-1"},null,512),[[ct,_.value]]),ae[44]||(ae[44]=e("span",null,"電訪",-1))])])]),e("div",o1,[e("div",l1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[14]||(ae[14]=ce=>f.value=ce),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[ct,f.value]]),ae[46]||(ae[46]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:ie}," 回覆職務內容 "),ae[47]||(ae[47]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",n1,[e("div",r1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[15]||(ae[15]=ce=>f.value=ce),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[ct,f.value]]),ae[49]||(ae[49]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",i1,[ae[48]||(ae[48]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",d1,[I(e("input",{type:"text","onUpdate:modelValue":ae[16]||(ae[16]=ce=>E.value=ce),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[ee,E.value]])])])])]),e("div",u1,[e("div",c1,[e("div",null,[ae[50]||(ae[50]=e("div",{class:"mb-1"},"原機關",-1)),e("div",p1,[I(e("input",{type:"text","onUpdate:modelValue":ae[17]||(ae[17]=ce=>y.value=ce),class:"w-full outline-none"},null,512),[[ee,y.value]])])]),e("div",null,[ae[51]||(ae[51]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",v1,[I(e("input",{type:"text","onUpdate:modelValue":ae[18]||(ae[18]=ce=>V.value=ce),class:"w-full outline-none"},null,512),[[ee,V.value]])]),ae[52]||(ae[52]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[ae[53]||(ae[53]=e("div",{class:"mb-1"},"原職系",-1)),e("div",m1,[I(e("input",{type:"text","onUpdate:modelValue":ae[19]||(ae[19]=ce=>p.value=ce),class:"w-full outline-none"},null,512),[[ee,p.value]])])]),e("div",null,[ae[54]||(ae[54]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",b1,[I(e("input",{type:"text","onUpdate:modelValue":ae[20]||(ae[20]=ce=>w.value=ce),class:"w-full outline-none"},null,512),[[ee,w.value]])]),ae[55]||(ae[55]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(f.value)===2?(t(),s("div",f1,[ae[59]||(ae[59]=e("div",null,[xe("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",y1,[e("div",g1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[21]||(ae[21]=ce=>W.value=ce),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,W.value]]),ae[56]||(ae[56]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",x1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[22]||(ae[22]=ce=>W.value=ce),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,W.value]]),ae[57]||(ae[57]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",h1,[I(e("input",{type:"radio","onUpdate:modelValue":ae[23]||(ae[23]=ce=>W.value=ce),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,W.value]]),ae[58]||(ae[58]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",w1,[I(e("input",{type:"text","onUpdate:modelValue":ae[24]||(ae[24]=ce=>O.value=ce),class:"w-full outline-none",disabled:Number(W.value)!==3},null,8,_1),[[ee,O.value]])])])])])):J("",!0)])]),e("div",k1,[u.value.performanceTrackingEdit?(t(),s("button",{key:0,class:"px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",onClick:fe,disabled:!U.value}," 確認 ",8,$1)):J("",!0),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:Y}," 取消 ")])])])):J("",!0),L.value?(t(),ls(Bs,{key:1,show:L.value,studentId:j.value,initialData:R.value,onClose:ae[25]||(ae[25]=ce=>L.value=!1),onSave:se},null,8,["show","studentId","initialData"])):J("",!0)],64))}},E1=Le(C1,[["__scopeId","data-v-b69a9d01"]]),Xt={getConsultations:D=>he.get("/v1/consultation",{params:D}),createConsultation:D=>he.post("/v1/consultation",D),updateConsultation:(D,x)=>he.put(`/v1/consultation/${D}`,x),deleteConsultation:D=>he.delete(`/v1/consultation/${D}`),confirmPassword:D=>he.post("/v1/user/confirmPwd",{password:D}),importConsultations:D=>he.post("/v1/consultation/import",D,{headers:{"Content-Type":"multipart/form-data"}}),deleteConsultationCategory:D=>he.delete(`/v1/consultationCategory/${D}`),addConsultationCategory:D=>he.post("/v1/consultationCategory",{name:D}),updateConsultationCategory:(D,x)=>he.put(`/v1/consultationCategory/${D}`,{id:D,name:x})},S1={class:"flex flex-col items-center p-6"},D1={class:"w-full max-w-[1500px]"},M1={class:"w-full max-w-[1500px]"},A1={class:"flex items-center space-x-4"},I1={class:"relative w-40"},R1=["value"],P1=["value"],U1=["value"],N1={class:"w-full max-w-[1500px]"},T1={class:"overflow-x-auto"},V1={class:"w-full border-collapse"},j1={class:"border p-2 text-center w-[100px]"},L1={class:"border p-2 text-center w-[50px]"},F1={class:"border p-2 w-[350px]"},q1={class:"font-bold mb-1"},O1={class:"border p-2 w-[350px]"},B1={class:"border p-2 text-center w-[100px]"},H1={class:"border p-2 text-center w-[100px]"},W1={class:"border p-2 text-center w-[100px]"},z1={class:"border p-2 text-center w-[100px]"},K1={class:"border p-2 text-center w-[100px]"},J1={class:"border p-2 text-center w-[100px]"},Y1={class:"border p-2 text-center w-[100px]"},G1={class:"border p-2 text-center w-[100px]"},Q1={class:"border p-2 text-center w-[100px]"},Z1={class:"border p-2 text-center w-[100px]"},X1={class:"flex justify-center space-x-2"},eg=["onClick"],tg=["onClick"],sg={key:0},ag=["colspan"],og={key:0,class:"flex justify-center items-center space-x-2 mt-6"},lg=["disabled"],ng=["onClick"],rg={key:1,class:"px-2"},ig=["disabled"],dg={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ug={class:"bg-white p-6 rounded-lg w-[600px] max-h-[90vh] overflow-y-auto"},cg={class:"flex justify-between items-center mb-4"},pg={class:"text-xl font-bold"},vg={class:"space-y-4 flex flex-col items-center"},mg={class:"flex items-center w-full max-w-[440px]"},bg=["value"],fg={class:"flex items-center w-full max-w-[440px]"},yg={class:"flex-1"},gg={class:"flex w-full max-w-[440px]"},xg={class:"flex w-full max-w-[440px]"},hg={class:"flex items-center w-full max-w-[440px]"},wg={class:"flex items-center w-full max-w-[440px]"},_g={class:"flex items-center w-full max-w-[440px]"},kg={class:"flex items-center w-full max-w-[440px]"},$g={class:"flex items-center w-full max-w-[440px]"},Cg={class:"flex items-center w-full max-w-[440px]"},Eg={class:"flex w-full max-w-[440px]"},Sg={class:"flex justify-center mt-6"},Dg=["disabled"],Mg={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ag={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},Ig={class:"mb-4"},Rg={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},Pg={class:"mb-2"},Ug={key:0,class:"text-red-500 text-sm mt-2"},Ng={class:"flex justify-end space-x-2"},Tg=["disabled"],Vg=["disabled"],jg={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Lg={class:"bg-white p-6 rounded-lg w-[500px] max-h-[90vh] overflow-y-auto"},Fg={class:"pr-2"},qg={class:"mb-6"},Og={class:"border border-gray-300 rounded max-h-48 overflow-y-auto"},Bg=["onClick"],Hg=["onClick"],Wg={key:0,class:"p-2 text-gray-500 text-center"},zg={class:"space-y-4"},Kg={class:"font-semibold mb-2"},Jg={class:"flex items-center"},Yg={class:"flex justify-end space-x-2"},Gg=["disabled"],Ws=10,Qg={__name:"QuestionManagement",setup(D){const x=Se(()=>{const i=new Date().getFullYear(),n=[];for(let h=i;h>=2024;h--)n.push(h);return n}),d=m(Array.from({length:12},(i,n)=>({value:n+1,label:`${(n+1).toString().padStart(2,"0")}月`}))),u=m([]),C=m(""),o=m(""),N=m(""),K=m(""),$=m(!1),P=m([]),T=Se(()=>P.value),z=m(1),g=m(1),a=m(0);Se(()=>T.value);const A=i=>{z.value=i,V()},G=()=>{z.value>1&&(z.value--,V())},k=()=>{z.value<g.value&&(z.value++,V())},c=m(!1),b=m(!1),r=m({id:"",category:"",question:"",answer:"",updateTime:"",inquiryDate:"",type:"",asker:"",askerAgency:"",responder:"",status:"",remark:"",replyStatus:""}),f=m(null),p=m({consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationImport:!1,consultationReadDetail:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryEdit:!1,consultationCategoryDelete:!1}),w=async()=>{try{const i=await tt.getSidebarPermissions();i.data.code===0&&i.data.message==="success"?(p.value={...i.data.data,consultationCategoryRead:i.data.data.consultationCategoryRead||!1,consultationCategoryCreate:i.data.data.consultationCategoryCreate||!1,consultationCategoryEdit:i.data.data.consultationCategoryEdit||!1,consultationCategoryDelete:i.data.data.consultationCategoryDelete||!1},console.log("諮詢問題管理頁面權限:",p.value)):console.error("獲取權限失敗:",i.data.message)}catch(i){console.error("獲取權限錯誤:",i)}},y=async(i=!1)=>{if(!(!i&&u.value.length>0))try{const n=await ot.getConsultationCategoryOptions();n.data.code===0&&n.data.message==="success"?(u.value=n.data.data,Be.value=n.data.data):(console.error("獲取問題類別選項失敗:",n.data.message),v.showError("載入失敗","獲取問題類別選項失敗: "+n.data.message))}catch(n){console.error("獲取問題類別選項錯誤:",n),v.showError("載入失敗","獲取問題類別選項錯誤，請稍後再試")}},V=async()=>{try{$.value=!0;const i={page:z.value,limit:Ws,keyword:C.value||void 0,year:o.value||void 0,month:N.value||void 0,category:K.value||void 0};console.log("獲取問題列表參數:",i);const n=await Xt.getConsultations(i);n.data.code===0?(P.value=n.data.data.list.map(h=>({id:h.id,category:W(h.category),categoryId:h.category,question:h.question,answer:h.ans,updateTime:h.updateDate,questionDate:h.questionDate,inquiryDate:h.questionDate,type:h.type||0,asker:h.asker||"",askerAgency:h.askerAgency||"",responder:h.responder||"",status:h.status||0,remark:h.remark||"",replyStatus:h.replyStatus||0})),a.value=n.data.data.totalCount,g.value=n.data.data.totalPage):(console.error("獲取問題列表失敗:",n.data.message),P.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗",n.data.message||"無法獲取問題列表，請稍後再試"))}catch(i){console.error("獲取問題列表錯誤:",i),P.value=[],a.value=0,g.value=0,v.showError("獲取資料失敗","無法獲取問題列表，請稍後再試")}finally{$.value=!1}},W=i=>{if(!i)return"未知類別";const n=u.value.find(h=>h.id===i);return n?n.name:"未知類別"},O=i=>{switch(i){case 1:return"Email";case 2:return"電話";case 3:return"官方Line";default:return"未知"}},_=()=>{var h;const i=[{field:"category",message:"請選擇問題類別"},{field:"inquiryDate",message:"請選擇詢問時間"},{field:"question",message:"請填寫問題內容"},{field:"answer",message:"請填寫回覆內容"},{field:"type",message:"請選擇詢問方式"},{field:"askerAgency",message:"請填寫詢問機關"},{field:"asker",message:"請填寫詢問人員"},{field:"responder",message:"請填寫回答人員"},{field:"replyStatus",message:"請選擇回復狀況"}];if(r.value.status==="")return v.showError("提交失敗","請選擇處理狀況"),!1;for(const{field:be,message:_e}of i)if(!r.value[be])return v.showError("提交失敗",_e),!1;const n=(h=u.value.find(be=>be.name===r.value.category))==null?void 0:h.id;return n?{isValid:!0,categoryId:n}:(v.showError("提交失敗","請選擇有效的問題類別"),!1)},E=i=>{const n=new Date(r.value.inquiryDate),h=`${n.getFullYear()}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`;return{category:i,question:r.value.question,ans:r.value.answer,questionDate:h,type:r.value.type||void 0,asker:r.value.asker||void 0,askerAgency:r.value.askerAgency||void 0,responder:r.value.responder||void 0,status:r.value.status||void 0,remark:r.value.remark||void 0,replyStatus:r.value.replyStatus||void 0}},L=async i=>{let n;if(b.value?(i.id=r.value.id,n=await Xt.updateConsultation(r.value.id,i)):n=await Xt.createConsultation(i),n.data.code===0){const h=b.value?"更新":"新增";v.showSuccess(`${h}成功`,`問題已成功${h}`),c.value=!1,V()}else{const h=b.value?"更新":"新增";v.showError(`${h}失敗`,n.data.message||"操作失敗，請稍後再試")}},j=async()=>{try{$.value=!0;const i=_();if(!i.isValid){$.value=!1;return}const n=E(i.categoryId);await L(n)}catch(i){console.error("提交表單錯誤:",i);const n=b.value?"更新":"新增";v.showError(`${n}失敗`,"操作失敗，請稍後再試")}finally{$.value=!1}},R=i=>{b.value=!0;let n="";if(i.questionDate){const h=i.questionDate.split("/");h.length===3&&(n=`${h[0]}-${h[1]}-${h[2]}`)}r.value={id:i.id,category:i.category,question:i.question,answer:i.answer,updateTime:i.updateTime,inquiryDate:n,type:i.type,asker:i.asker,askerAgency:i.askerAgency,responder:i.responder,status:i.status,remark:i.remark,replyStatus:i.replyStatus},c.value=!0},U=async i=>{if(f.value=i.id,await v.confirmAsync("確認刪除",`確定要刪除問題「${i.question}」嗎？此操作無法復原。`)){const h=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(h===null||h===""){f.value=null;return}te(h)}else f.value=null},te=async i=>{try{if($.value=!0,console.log("刪除問題ID:",f.value),(await Xt.confirmPassword(i)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),$.value=!1,f.value=null;return}const h=await Xt.deleteConsultation(f.value);h.data.code===0?(v.showSuccess("刪除成功","問題已成功刪除"),V()):v.showError("刪除失敗",h.data.message||"刪除失敗，請稍後再試")}catch(n){console.error("刪除問題錯誤:",n),n.response&&n.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除問題時發生錯誤，請稍後再試")}finally{$.value=!1,f.value=null}},ue=()=>{C.value=""},ye=()=>{console.log("使用關鍵字搜尋:",C.value,"年度:",o.value,"月份:",N.value,"類別:",K.value),z.value=1,V()},ke=m(!1),De=m(null),$e=m(null),ve=m(!1),oe=m(""),q=()=>{ke.value=!0,$e.value=null,oe.value=""},S=()=>{ke.value=!1,$e.value=null,oe.value=""},Y=()=>{De.value.click()},fe=i=>{const n=i.target.files[0];if(n){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(n.type)&&!n.name.endsWith(".xlsx")&&!n.name.endsWith(".xls")&&!n.name.endsWith(".csv")){oe.value="請選擇 .xlsx 檔案",$e.value=null,i.target.value=null;return}$e.value=n,oe.value=""}},le=async()=>{var i,n,h;if(!$e.value){oe.value="請選擇要上傳的檔案";return}try{ve.value=!0,oe.value="";const be=new FormData;be.append("file",$e.value);const _e=await Xt.importConsultations(be);if(_e.data&&_e.data.code===0){const Ve=_e.data.message?_e.data.message.replace(/\r\n|\n|\r/g,"<br>"):"問題資料已成功匯入";S(),v.showSuccess("上傳成功",Ve),V()}else oe.value=((i=_e.data)==null?void 0:i.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",oe.value)}catch(be){console.error("匯入問題檔案錯誤:",be),oe.value=((h=(n=be.response)==null?void 0:n.data)==null?void 0:h.message)||"匯入過程中發生錯誤，請稍後再試",v.showError("匯入失敗",oe.value)}finally{ve.value=!1}};je(()=>{w(),y().then(()=>{V()})});const Q=i=>{switch(i){case 1:return"處理中";case 2:return"已處理";default:return"未知"}},se=i=>{switch(i){case 1:return"未回覆";case 2:return"已回覆";default:return"未知"}},ie=()=>{b.value=!1,r.value={id:"",category:"",question:"",answer:"",updateTime:"",inquiryDate:"",type:"",asker:"",askerAgency:"",responder:"",status:"",remark:"",replyStatus:""},c.value=!0},de=m(!1),ae=m(!1),ce=m({id:null,name:""}),Ie=m(!1),Be=m([]),me=async()=>{de.value=!0,ae.value=!1,ce.value={id:null,name:""},await y(!0)},pe=()=>{de.value=!1},we=i=>{ae.value=!0,ce.value={...i}},He=()=>{ae.value=!1,ce.value={id:null,name:""}},ge=async i=>{if(await v.confirmAsync("確認刪除",`確定要刪除分類「${i.name}」嗎？此操作無法復原。`)){const h=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(h===null||h==="")return;try{if(Ie.value=!0,(await Xt.confirmPassword(h)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}const _e=await Xt.deleteConsultationCategory(i.id);_e.data.code===0?(v.showSuccess("刪除成功","分類已成功刪除"),await y(!0)):v.showError("刪除失敗",_e.data.message||"刪除分類失敗，請稍後再試")}catch(be){console.error("刪除分類錯誤:",be),be.response&&be.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除分類時發生錯誤，請稍後再試")}finally{Ie.value=!1}}},H=async()=>{if(!ce.value.name.trim()){v.showError("操作失敗","分類名稱不能為空");return}Ie.value=!0;try{let i;ae.value?i=await Xt.updateConsultationCategory(ce.value.id,ce.value.name):i=await Xt.addConsultationCategory(ce.value.name),i.data.code===0?(v.showSuccess("操作成功",`分類已成功${ae.value?"更新":"新增"}`),await y(!0),He()):v.showError("操作失敗",i.data.message||"分類操作失敗，請稍後再試")}catch(i){console.error("分類操作錯誤:",i),v.showError("操作失敗","分類操作時發生錯誤，請稍後再試")}finally{Ie.value=!1}};return(i,n)=>(t(),s("div",S1,[e("div",D1,[Qe(pt,{breadcrumbs:[{name:"諮詢問題管理",path:"/question-management"}]})]),e("div",M1,[e("div",A1,[n[21]||(n[21]=e("span",null,"查詢問題:",-1)),e("div",I1,[I(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=h=>C.value=h),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"問題關鍵字",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ne(ye,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[ee,C.value]]),C.value?(t(),s("button",{key:0,onClick:ue,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},n[17]||(n[17]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),I(e("select",{"onUpdate:modelValue":n[1]||(n[1]=h=>o.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ye,["enter"])},[n[18]||(n[18]=e("option",{value:""},"請選擇年度",-1)),(t(!0),s(Z,null,re(x.value,h=>(t(),s("option",{key:h,value:h},l(h)+"年 ",9,R1))),128))],544),[[Pe,o.value]]),I(e("select",{"onUpdate:modelValue":n[2]||(n[2]=h=>N.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ye,["enter"])},[n[19]||(n[19]=e("option",{value:""},"請選擇月份",-1)),(t(!0),s(Z,null,re(d.value,h=>(t(),s("option",{key:h.value,value:h.value},l(h.label),9,P1))),128))],544),[[Pe,N.value]]),I(e("select",{"onUpdate:modelValue":n[3]||(n[3]=h=>K.value=h),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(ye,["enter"])},[n[20]||(n[20]=e("option",{value:""},"請選擇問題類別",-1)),(t(!0),s(Z,null,re(u.value,h=>(t(),s("option",{key:h.id,value:h.id},l(h.name),9,U1))),128))],544),[[Pe,K.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:ye}," 搜尋 "),n[22]||(n[22]=e("div",{class:"flex-grow"},null,-1)),p.value.consultationCategoryRead?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:me}," 分類管理 ")):J("",!0),p.value.consultationImport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:q}," 匯入問題 ")):J("",!0),p.value.consultationCreate?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:ie}," 新增問題 ")):J("",!0)])]),n[56]||(n[56]=e("div",{class:"w-full max-w-[1500px] my-8"},[e("div",{class:"w-full h-[1px] bg-gray-300"})],-1)),e("div",N1,[e("div",T1,[e("table",V1,[e("thead",null,[e("tr",null,[n[28]||(n[28]=e("th",{class:"border p-2 w-[100px]"},"問題種類",-1)),n[29]||(n[29]=e("th",{class:"border p-2 w-[50px]"},"序",-1)),n[30]||(n[30]=e("th",{class:"border p-2 w-[350px]"},"問題",-1)),n[31]||(n[31]=e("th",{class:"border p-2 w-[350px]"},"回復",-1)),n[32]||(n[32]=e("th",{class:"border p-2 w-[100px]"},"詢問時間",-1)),n[33]||(n[33]=e("th",{class:"border p-2 w-[100px]"},"詢問方式",-1)),n[34]||(n[34]=e("th",{class:"border p-2 w-[100px]"},"詢問機關",-1)),p.value.consultationReadDetail?(t(),s(Z,{key:0},[n[23]||(n[23]=e("th",{class:"border p-2 w-[100px]"},"詢問人員",-1)),n[24]||(n[24]=e("th",{class:"border p-2 w-[100px]"},"回答人員",-1)),n[25]||(n[25]=e("th",{class:"border p-2 w-[100px]"},"回復狀況",-1)),n[26]||(n[26]=e("th",{class:"border p-2 w-[100px]"},"處理狀況",-1)),n[27]||(n[27]=e("th",{class:"border p-2 w-[100px]"},"備註",-1))],64)):J("",!0),n[35]||(n[35]=e("th",{class:"border p-2 w-[100px]"},"更新時間",-1)),n[36]||(n[36]=e("th",{class:"border p-2 w-[100px]"},"操作",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(T.value,(h,be)=>(t(),s("tr",{key:h.id},[e("td",j1,l(h.category),1),e("td",L1,l((z.value-1)*Ws+be+1),1),e("td",F1,[e("div",q1,"Q. "+l(h.question),1)]),e("td",O1,"A."+l(h.answer),1),e("td",B1,l(h.questionDate),1),e("td",H1,l(O(h.type)),1),e("td",W1,l(h.askerAgency),1),p.value.consultationReadDetail?(t(),s(Z,{key:0},[e("td",z1,l(h.asker),1),e("td",K1,l(h.responder),1),e("td",J1,l(se(h.replyStatus)),1),e("td",Y1,l(Q(h.status)),1),e("td",G1,l(h.remark),1)],64)):J("",!0),e("td",Q1,l(h.updateTime),1),e("td",Z1,[e("div",X1,[p.value.consultationUpdate?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:_e=>R(h)}," 編輯 ",8,eg)):J("",!0),p.value.consultationDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:_e=>U(h)}," 刪除 ",8,tg)):J("",!0)])])]))),128)),T.value.length===0?(t(),s("tr",sg,[e("td",{colspan:p.value.consultationReadDetail?13:9,class:"border p-4 text-center"},"無符合條件的資料",8,ag)])):J("",!0)])])]),g.value>0?(t(),s("div",og,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:z.value===1,onClick:G}," 上一頁 ",8,lg),(t(!0),s(Z,null,re(g.value,h=>(t(),s(Z,{key:h},[h===1||h===g.value||h>=z.value-2&&h<=z.value+2?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":h===z.value}]),onClick:be=>A(h)},l(h),11,ng)):h===z.value-3||h===z.value+3?(t(),s("span",rg," ... ")):J("",!0)],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:z.value===g.value,onClick:k}," 下一頁 ",8,ig)])):J("",!0)]),c.value?(t(),s("div",dg,[e("div",ug,[e("div",cg,[e("h3",pg,l(b.value?"編輯問題":"新增問題"),1),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:n[4]||(n[4]=h=>c.value=!1)}," ✕ ")]),e("div",vg,[e("div",mg,[n[38]||(n[38]=e("span",{class:"w-24"},[xe("問題類別:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[5]||(n[5]=h=>r.value.category=h),required:""},[n[37]||(n[37]=e("option",{value:""},"請選擇問題類別",-1)),(t(!0),s(Z,null,re(u.value,h=>(t(),s("option",{key:h.id,value:h.name},l(h.name),9,bg))),128))],512),[[Pe,r.value.category]])]),e("div",fg,[n[39]||(n[39]=e("span",{class:"w-24"},[xe("詢問時間:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",yg,[I(e("input",{type:"date",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":n[6]||(n[6]=h=>r.value.inquiryDate=h),required:""},null,512),[[ee,r.value.inquiryDate]])])]),e("div",gg,[n[40]||(n[40]=e("span",{class:"w-24"},[xe("問題內容:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-32 resize-none","onUpdate:modelValue":n[7]||(n[7]=h=>r.value.question=h),required:""},null,512),[[ee,r.value.question]])]),e("div",xg,[n[41]||(n[41]=e("span",{class:"w-24"},[xe("回覆內容:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-32 resize-none","onUpdate:modelValue":n[8]||(n[8]=h=>r.value.answer=h),required:""},null,512),[[ee,r.value.answer]])]),e("div",hg,[n[43]||(n[43]=e("span",{class:"w-24"},[xe("詢問方式:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[9]||(n[9]=h=>r.value.type=h),required:""},n[42]||(n[42]=[e("option",{value:""},"請選擇詢問方式",-1),e("option",{value:"1"},"Email",-1),e("option",{value:"2"},"電話",-1),e("option",{value:"3"},"官方Line",-1)]),512),[[Pe,r.value.type]])]),e("div",wg,[n[44]||(n[44]=e("span",{class:"w-24"},[xe("詢問機關:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[10]||(n[10]=h=>r.value.askerAgency=h),placeholder:"請輸入詢問機關",required:""},null,512),[[ee,r.value.askerAgency]])]),e("div",_g,[n[45]||(n[45]=e("span",{class:"w-24"},[xe("詢問人員:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[11]||(n[11]=h=>r.value.asker=h),placeholder:"請輸入詢問人員",required:""},null,512),[[ee,r.value.asker]])]),e("div",kg,[n[46]||(n[46]=e("span",{class:"w-24"},[xe("回答人員:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[12]||(n[12]=h=>r.value.responder=h),placeholder:"請輸入回答人員",required:""},null,512),[[ee,r.value.responder]])]),e("div",$g,[n[48]||(n[48]=e("span",{class:"w-24"},[xe("回復狀況:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[13]||(n[13]=h=>r.value.replyStatus=h),required:""},n[47]||(n[47]=[e("option",{value:""},"請選擇回復狀況",-1),e("option",{value:"1"},"未回覆",-1),e("option",{value:"2"},"已回覆",-1)]),512),[[Pe,r.value.replyStatus]])]),e("div",Cg,[n[50]||(n[50]=e("span",{class:"w-24"},[xe("處理狀況:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{class:"p-2 border border-gray-300 outline-none flex-1","onUpdate:modelValue":n[14]||(n[14]=h=>r.value.status=h),required:""},n[49]||(n[49]=[e("option",{value:""},"請選擇處理狀況",-1),e("option",{value:"1"},"處理中",-1),e("option",{value:"2"},"已處理",-1)]),512),[[Pe,r.value.status]])]),e("div",Eg,[n[51]||(n[51]=e("span",{class:"w-24"},"備註:",-1)),I(e("textarea",{class:"p-2 border border-gray-300 outline-none flex-1 h-20 resize-none","onUpdate:modelValue":n[15]||(n[15]=h=>r.value.remark=h),placeholder:"請輸入備註"},null,512),[[ee,r.value.remark]])]),e("div",Sg,[e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:j,disabled:$.value},l($.value?"處理中...":"送出"),9,Dg)])])])])):J("",!0),ke.value?(t(),s("div",Mg,[e("div",Ag,[n[52]||(n[52]=e("h3",{class:"text-lg font-medium mb-4"},"匯入問題",-1)),e("div",Ig,[e("div",Rg,[e("input",{type:"file",ref_key:"fileInput",ref:De,class:"hidden",onChange:fe,accept:".xlsx,.xls,.csv"},null,544),e("p",Pg,l($e.value?$e.value.name:"請選擇 .xlsx 檔案"),1),e("button",{onClick:Y,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),oe.value?(t(),s("p",Ug,l(oe.value),1)):J("",!0)]),e("div",Ng,[e("button",{onClick:S,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:ve.value}," 取消 ",8,Tg),e("button",{onClick:le,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!$e.value||ve.value},l(ve.value?"上傳中...":"上傳"),9,Vg)])])])):J("",!0),de.value?(t(),s("div",jg,[e("div",Lg,[e("div",{class:"flex justify-between items-center mb-4"},[n[53]||(n[53]=e("h3",{class:"text-xl font-bold"},"分類管理",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:pe}," ✕ ")]),e("div",Fg,[e("div",qg,[n[54]||(n[54]=e("h4",{class:"font-semibold mb-2"},"現有問題類別:",-1)),e("ul",Og,[(t(!0),s(Z,null,re(Be.value,h=>(t(),s("li",{key:h.id,class:"flex justify-between items-center p-2 border-b last:border-b-0"},[e("span",null,l(h.name),1),e("div",null,[p.value.consultationCategoryEdit?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm mr-2",onClick:be=>we(h)}," 編輯 ",8,Bg)):J("",!0),p.value.consultationCategoryDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:be=>ge(h)}," 刪除 ",8,Hg)):J("",!0)])]))),128)),Be.value.length===0?(t(),s("li",Wg," 無任何問題類別 ")):J("",!0)])]),e("div",zg,[e("h4",Kg,l(ae.value?"編輯分類":"新增分類")+":",1),e("div",Jg,[n[55]||(n[55]=e("label",{class:"w-24",for:"category-name"},[xe("分類名稱:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{id:"category-name",type:"text","onUpdate:modelValue":n[16]||(n[16]=h=>ce.value.name=h),class:"p-2 border border-gray-300 outline-none flex-1",placeholder:"請輸入分類名稱",required:""},null,512),[[ee,ce.value.name]])]),e("div",Yg,[ae.value?(t(),s("button",{key:0,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:He}," 取消編輯 ")):J("",!0),e("button",{class:"px-8 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5d]",onClick:H,disabled:!ce.value.name.trim()||Ie.value||(ae.value?!p.value.consultationCategoryEdit:!p.value.consultationCategoryCreate)},l(Ie.value?"處理中...":"送出"),9,Gg)])])])])])):J("",!0)]))}},Zg=Le(Qg,[["__scopeId","data-v-247569c8"]]),Xg={class:"flex flex-col items-center p-6"},e0={class:"w-full max-w-[1500px]"},t0={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},s0={class:"flex items-center space-x-4"},a0={class:"w-full max-w-[1500px]"},o0={key:0,class:"flex justify-center items-center py-10"},l0={key:1,class:"w-full border-collapse"},n0={class:"border p-2 text-center"},r0={class:"border p-2 text-center"},i0={class:"border p-2 text-center"},d0={class:"border p-2 text-center"},u0={class:"border p-2 text-center"},c0={class:"border p-2 text-center"},p0={class:"border p-2 text-center"},v0={class:"flex justify-center space-x-2"},m0=["onClick","aria-label"],b0=["onClick","aria-label"],f0={key:0},y0={key:2,class:"flex justify-center items-center space-x-2 mt-6"},g0=["disabled"],x0=["onClick","aria-label","aria-current"],h0={key:1,class:"px-2"},w0=["disabled"],_0={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},k0={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},$0={class:"flex flex-col"},C0={class:"flex flex-col"},E0={class:"flex flex-col"},S0={class:"flex flex-col"},D0={class:"flex flex-col"},M0={class:"flex flex-col"},A0=["value"],I0={class:"flex justify-end space-x-2 mt-6"},R0=["disabled"],P0={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},U0={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},N0={class:"flex flex-col"},T0={class:"flex flex-col"},V0={class:"flex flex-col"},j0={class:"flex flex-col"},L0={class:"flex flex-col"},F0={class:"flex flex-col"},q0=["value"],O0={class:"flex flex-col"},B0={class:"border-0 p-0 m-0"},H0={class:"flex items-center space-x-2"},W0={class:"inline-flex items-center",for:"edit-enabled-true"},z0={class:"inline-flex items-center",for:"edit-enabled-false"},K0={class:"flex justify-end space-x-2 mt-6"},J0=["disabled"],qs=20,Y0={__name:"Roles",setup(D){const x=m(1),d=m(1),u=m(0),C=m(!1),o=m([]),N=m([]),K=m(!1),$=m(!1),P=m(!1),T=m({name:"",unit:"",title:"",account:"",password:"",role:""}),z=m(!1),g=m({id:"",name:"",unit:"",title:"",account:"",password:"",role:"",isEnabled:!0}),a=m(null),A=m({userCreate:!1,userUpdate:!1,userDelete:!1}),G=j=>j==="-1"||j===-1||j===null||j===void 0?"缺":j,k=Se(()=>{const j=[];if(d.value<=5)for(let U=1;U<=d.value;U++)j.push(U);else{j.push(1);let U=Math.max(2,x.value-1),te=Math.min(d.value-1,x.value+1);x.value<=3&&(te=Math.min(4,d.value-1)),x.value>=d.value-2&&(U=Math.max(2,d.value-3)),U>2&&j.push("...");for(let ue=U;ue<=te;ue++)j.push(ue);te<d.value-1&&j.push("..."),j.push(d.value)}return j}),c=async()=>{try{K.value=!0;const j=await es.getRoleOptions();j.data.code===0&&j.data.message==="success"?N.value=j.data.data:(console.error("獲取使用者選項失敗:",j.data.message),v.showError("載入失敗","獲取使用者選項失敗: "+j.data.message))}catch(j){console.error("獲取使用者選項錯誤:",j),v.showError("載入失敗","獲取使用者選項錯誤，請稍後再試")}finally{K.value=!1}},b=async()=>{try{const j=await tt.getSidebarPermissions();j.data.code===0&&j.data.message==="success"?(A.value=j.data.data,console.log("使用者管理頁面權限:",A.value)):console.error("獲取權限失敗:",j.data.message)}catch(j){console.error("獲取權限錯誤:",j)}},r=async()=>{try{C.value=!0;const j={page:x.value,limit:qs};console.log("獲取用戶列表參數:",j);const R=await es.getUserList(j);console.log("API 回應:",R.data),R.data.code===0&&R.data.message==="success"?(o.value=[...R.data.data.list],u.value=R.data.data.totalCount,d.value=R.data.data.totalPage||Math.ceil(u.value/qs)):(console.error("獲取使用者列表失敗:",R.data.message),o.value=[],u.value=0,d.value=0,v.showError("載入失敗","獲取使用者列表失敗: "+R.data.message))}catch(j){console.error("獲取使用者列表錯誤:",j),o.value=[],u.value=0,d.value=0;let R=null;j.response&&j.response.data&&(R=j.response.data),R?(R.message?v.showError("載入失敗",`獲取使用者列表錯誤: ${R.message}`):R.title?v.showError("載入失敗",`獲取使用者列表錯誤: ${R.title}`):v.showError("載入失敗","獲取使用者列表錯誤，請稍後再試"),console.error("錯誤響應數據:",R)):v.showError("載入失敗","獲取使用者列表錯誤，請稍後再試")}finally{C.value=!1}},f=j=>{j!==x.value&&!C.value&&(x.value=j,r())},p=()=>{x.value>1&&!C.value&&(x.value--,r())},w=()=>{x.value<d.value&&!C.value&&(x.value++,r())},y=()=>{$.value=!0},V=async()=>{try{P.value=!0;const j=await es.createUser(T.value);j.data.code===0&&j.data.message==="success"?(v.showSuccess("新增成功","使用者已成功新增"),$.value=!1,T.value={name:"",unit:"",title:"",account:"",password:"",role:""},r()):v.showError("新增失敗","新增使用者失敗: "+j.data.message)}catch(j){console.error("新增使用者錯誤:",j),v.showError("新增失敗","新增使用者失敗，請稍後再試")}finally{P.value=!1}},W=async j=>{g.value={id:j.id,name:j.name,unit:j.unit,title:j.title,account:j.account,password:"",role:j.role,isEnabled:j.isEnabled},z.value=!0},O=async()=>{try{P.value=!0;const j={id:g.value.id,name:g.value.name,unit:g.value.unit,title:g.value.title,account:g.value.account,role:g.value.role,isEnabled:g.value.isEnabled};g.value.password&&g.value.password.trim()!==""&&(j.password=g.value.password),console.log("提交編輯數據:",j);const R=await es.updateUser(j.id,j);R.data.code===0&&R.data.message==="success"?(v.showSuccess("更新成功","使用者已成功更新"),z.value=!1,g.value={id:"",name:"",unit:"",title:"",account:"",password:"",role:"",isEnabled:!0},setTimeout(()=>{r()},300)):v.showError("更新失敗","更新使用者失敗: "+R.data.message)}catch(j){console.error("更新使用者錯誤:",j),v.showError("更新失敗","更新使用者失敗，請稍後再試")}finally{P.value=!1}},_=async j=>{if(a.value=j.id,await v.confirmAsync("確認刪除","確定要刪除此使用者嗎？此操作無法復原。")){const U=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(U===null||U===""){a.value=null;return}E(U)}else a.value=null},E=async j=>{try{if(P.value=!0,console.log("刪除使用者ID:",a.value),(await es.confirmPassword(j)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),P.value=!1,a.value=null;return}const U=await es.deleteUser(a.value);console.log("刪除結果:",U.data),U.data.code===0&&U.data.message==="success"?(v.showSuccess("刪除成功","使用者已成功刪除"),r()):(console.error("刪除使用者失敗:",U.data.message),v.showError("刪除失敗","刪除使用者失敗: "+U.data.message))}catch(R){console.error("刪除使用者錯誤:",R),R.response&&R.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除使用者時發生錯誤，請稍後再試")}finally{P.value=!1,a.value=null}},L=j=>{const R=N.value.find(U=>U.id===j);return R?R.name:"缺"};return je(()=>{b(),c(),r()}),(j,R)=>(t(),s("div",Xg,[e("div",e0,[Qe(pt,{breadcrumbs:[{name:"使用者管理",path:"/roles"}]})]),e("div",t0,[e("div",s0,[A.value.userCreate?(t(),s("button",{key:0,onClick:y,class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white","aria-label":"新增使用者"}," 新增使用者 ")):J("",!0)])]),e("div",a0,[C.value?(t(),s("div",o0,R[16]||(R[16]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",l0,[R[18]||(R[18]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"序"),e("th",{class:"border p-2"},"單位"),e("th",{class:"border p-2"},"職稱"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"系統權限"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"操作")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(o.value,(U,te)=>(t(),s("tr",{key:U.id},[e("td",n0,l((x.value-1)*qs+te+1),1),e("td",r0,l(G(U.unit)),1),e("td",i0,l(G(U.title)),1),e("td",d0,l(G(U.name)),1),e("td",u0,l(L(U.role)),1),e("td",c0,[e("span",{class:X([U.isEnabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(U.isEnabled?"啟用":"停用"),3)]),e("td",p0,[e("div",v0,[A.value.userUpdate?(t(),s("button",{key:0,onClick:ue=>W(U),class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm","aria-label":`編輯${U.name}的資料`}," 編輯 ",8,m0)):J("",!0),A.value.userDelete?(t(),s("button",{key:1,onClick:ue=>_(U),class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm","aria-label":`刪除${U.name}的資料`}," 刪除 ",8,b0)):J("",!0)])])]))),128)),o.value.length===0?(t(),s("tr",f0,R[17]||(R[17]=[e("td",{colspan:"6",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])),!C.value&&o.value.length>0?(t(),s("div",y0,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:x.value===1,onClick:p,"aria-label":"前往上一頁"}," 上一頁 ",8,g0),(t(!0),s(Z,null,re(k.value,U=>(t(),s(Z,{key:U},[U!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":U===x.value}]),onClick:te=>f(U),"aria-label":`前往第${U}頁`,"aria-current":U===x.value?"page":void 0},l(U),11,x0)):(t(),s("span",h0,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:x.value===d.value,onClick:w,"aria-label":"前往下一頁"}," 下一頁 ",8,w0)])):J("",!0)]),$.value?(t(),s("div",_0,[e("div",k0,[R[26]||(R[26]=e("h3",{class:"text-xl font-bold mb-4"},"新增角色",-1)),e("form",{onSubmit:Ot(V,["prevent"]),class:"space-y-4"},[e("div",$0,[R[19]||(R[19]=e("label",{for:"add-name",class:"mb-1"},"姓名",-1)),I(e("input",{id:"add-name","onUpdate:modelValue":R[0]||(R[0]=U=>T.value.name=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,T.value.name]])]),e("div",C0,[R[20]||(R[20]=e("label",{for:"add-unit",class:"mb-1"},"單位",-1)),I(e("input",{id:"add-unit","onUpdate:modelValue":R[1]||(R[1]=U=>T.value.unit=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,T.value.unit]])]),e("div",E0,[R[21]||(R[21]=e("label",{for:"add-title",class:"mb-1"},"職稱",-1)),I(e("input",{id:"add-title","onUpdate:modelValue":R[2]||(R[2]=U=>T.value.title=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,T.value.title]])]),e("div",S0,[R[22]||(R[22]=e("label",{for:"add-account",class:"mb-1"},"帳號",-1)),I(e("input",{id:"add-account","onUpdate:modelValue":R[3]||(R[3]=U=>T.value.account=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,T.value.account]])]),e("div",D0,[R[23]||(R[23]=e("label",{for:"add-password",class:"mb-1"},"密碼",-1)),I(e("input",{id:"add-password","onUpdate:modelValue":R[4]||(R[4]=U=>T.value.password=U),type:"password",class:"border p-2 rounded",required:""},null,512),[[ee,T.value.password]])]),e("div",M0,[R[25]||(R[25]=e("label",{for:"add-role",class:"mb-1"},"系統權限",-1)),I(e("select",{id:"add-role","onUpdate:modelValue":R[5]||(R[5]=U=>T.value.role=U),class:"border p-2 rounded",required:""},[R[24]||(R[24]=e("option",{value:""},"請選擇權限",-1)),(t(!0),s(Z,null,re(N.value,U=>(t(),s("option",{key:U.id,value:U.id},l(U.name),9,A0))),128))],512),[[Pe,T.value.role]])]),e("div",I0,[e("button",{type:"button",onClick:R[6]||(R[6]=U=>$.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:P.value},l(P.value?"提交中...":"確認"),9,R0)])],32)])])):J("",!0),z.value?(t(),s("div",P0,[e("div",U0,[R[37]||(R[37]=e("h3",{class:"text-xl font-bold mb-4"},"編輯角色",-1)),e("form",{onSubmit:Ot(O,["prevent"]),class:"space-y-4"},[e("div",N0,[R[27]||(R[27]=e("label",{for:"edit-name",class:"mb-1"},"姓名",-1)),I(e("input",{id:"edit-name","onUpdate:modelValue":R[7]||(R[7]=U=>g.value.name=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,g.value.name]])]),e("div",T0,[R[28]||(R[28]=e("label",{for:"edit-unit",class:"mb-1"},"單位",-1)),I(e("input",{id:"edit-unit","onUpdate:modelValue":R[8]||(R[8]=U=>g.value.unit=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,g.value.unit]])]),e("div",V0,[R[29]||(R[29]=e("label",{for:"edit-title",class:"mb-1"},"職稱",-1)),I(e("input",{id:"edit-title","onUpdate:modelValue":R[9]||(R[9]=U=>g.value.title=U),type:"text",class:"border p-2 rounded",required:""},null,512),[[ee,g.value.title]])]),e("div",j0,[R[30]||(R[30]=e("label",{for:"edit-account",class:"mb-1"},"帳號",-1)),I(e("input",{id:"edit-account","onUpdate:modelValue":R[10]||(R[10]=U=>g.value.account=U),type:"text",class:"border p-2 rounded cursor-not-allowed bg-gray-100",readonly:""},null,512),[[ee,g.value.account]])]),e("div",L0,[R[31]||(R[31]=e("label",{for:"edit-password",class:"mb-1"},"密碼",-1)),I(e("input",{id:"edit-password","onUpdate:modelValue":R[11]||(R[11]=U=>g.value.password=U),type:"password",class:"border p-2 rounded",placeholder:"不修改請留空"},null,512),[[ee,g.value.password]])]),e("div",F0,[R[33]||(R[33]=e("label",{for:"edit-role",class:"mb-1"},"系統權限",-1)),I(e("select",{id:"edit-role","onUpdate:modelValue":R[12]||(R[12]=U=>g.value.role=U),class:"border p-2 rounded",required:""},[R[32]||(R[32]=e("option",{value:""},"請選擇權限",-1)),(t(!0),s(Z,null,re(N.value,U=>(t(),s("option",{key:U.id,value:U.id},l(U.name),9,q0))),128))],512),[[Pe,g.value.role]])]),e("div",O0,[e("fieldset",B0,[R[36]||(R[36]=e("legend",{class:"mb-1",id:"account-status-label"},"帳號狀態",-1)),e("div",H0,[e("label",W0,[I(e("input",{id:"edit-enabled-true",type:"radio","onUpdate:modelValue":R[13]||(R[13]=U=>g.value.isEnabled=U),value:!0,class:"form-radio text-[#4e9875]",name:"account-status"},null,512),[[ct,g.value.isEnabled]]),R[34]||(R[34]=e("span",{class:"ml-2"},"啟用",-1))]),e("label",z0,[I(e("input",{id:"edit-enabled-false",type:"radio","onUpdate:modelValue":R[14]||(R[14]=U=>g.value.isEnabled=U),value:!1,class:"form-radio text-[#4e9875]",name:"account-status"},null,512),[[ct,g.value.isEnabled]]),R[35]||(R[35]=e("span",{class:"ml-2"},"停用",-1))])])])]),e("div",K0,[e("button",{type:"button",onClick:R[15]||(R[15]=U=>z.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:P.value},l(P.value?"提交中...":"確認"),9,J0)])],32)])])):J("",!0)]))}},G0=Le(Y0,[["__scopeId","data-v-a30593f0"]]),Q0={class:"flex flex-col items-center justify-center min-h-screen bg-gray-100"},Z0={__name:"Unauthorized",setup(D){We();const x=async()=>{try{const u=await Ls.logout();u.data.code===0&&u.data.message==="success"?(d(),v.showSuccess("登出成功","您已成功登出系統"),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1e3)):(console.error("登出失敗:",u.data.message),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"))}catch(u){console.error("登出錯誤:",u),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"),d(),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1500)}},d=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(u=>{u.startsWith("app_")&&localStorage.removeItem(u)}),sessionStorage.clear()};return(u,C)=>(t(),s("div",Q0,[e("div",{class:"p-8 bg-white rounded-lg shadow-md text-center max-w-md"},[C[0]||(C[0]=e("h1",{class:"text-3xl font-bold text-red-600 mb-4"},"未授權訪問",-1)),C[1]||(C[1]=e("div",{class:"text-gray-700 mb-6"},[e("p",{class:"mb-2"},"您沒有權限訪問此頁面。"),e("p",null,"請聯繫系統管理員獲取適當的權限，或返回您有權限的頁面。")],-1)),e("div",{class:"flex justify-center space-x-4"},[e("button",{onClick:x,class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," 登出系統 ")])])]))}},X0={class:"flex flex-col items-center"},ex={class:"w-full max-w-[1500px]"},tx={class:"flex items-center"},sx={class:"w-full max-w-[1500px] h-[1300px]"},ax=["src"],ox={__name:"Survey",props:{courseId:{type:[String,Number],required:!1,default:""}},setup(D){const x=D,d=m({satisfactionSurveyImport:!1}),u=async()=>{try{const N=await tt.getSidebarPermissions();N.data.code===0&&N.data.message==="success"?(d.value=N.data.data,console.log("滿意度調查頁面權限:",d.value)):console.error("獲取權限失敗:",N.data.message)}catch(N){console.error("獲取權限錯誤:",N)}};je(()=>{u()});const C=Se(()=>`https://dev-moda.mosji.co/dashboard/review?id=${x.courseId}`),o=async()=>{try{const N=document.createElement("input");N.type="file",N.accept=".xlsx,.xls",N.onchange=async K=>{var T,z,g;const $=K.target.files[0];if(!$)return;const P=new FormData;P.append("file",$),x.courseId&&P.append("courseId",x.courseId);try{const a=await jt.importSurvey(P);if(a.data&&a.data.code===0){const A=a.data.message?a.data.message.replace(/\r\n|\n|\r/g,"<br>"):"問卷調查資料已成功匯入";v.showSuccess("匯入成功",A)}else{const A=((T=a.data)==null?void 0:T.message)||"匯入失敗，請確認檔案格式是否正確";v.showError("匯入失敗",A)}}catch(a){console.error("問卷調查資料匯入失敗:",a);const A=((g=(z=a.response)==null?void 0:z.data)==null?void 0:g.message)||"匯入過程中發生錯誤，請稍後再試";v.showError("匯入失敗",A)}},N.click()}catch(N){console.error("Excel 檔案上傳錯誤:",N),v.showError("匯入錯誤","匯入過程中發生錯誤，請稍後再試")}};return(N,K)=>(t(),s("div",X0,[e("div",ex,[e("div",tx,[K[0]||(K[0]=e("div",{class:"flex-grow"},null,-1)),d.value.satisfactionSurveyImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] disabled:opacity-50 disabled:cursor-not-allowed",onClick:o}," 匯入滿意度調查 ")):J("",!0)])]),K[1]||(K[1]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",sx,[e("iframe",{src:C.value,class:"w-full h-full border-0",allowfullscreen:"",title:"問卷調查"},null,8,ax)]),K[2]||(K[2]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"space-y-2 text-sm text-gray-600"},[e("div",null,"備註："),e("div",null,"1. 問卷計算結果以班級／課程為一筆統計資料。"),e("div",null,"2. 分數指標為：非常滿意 100分、滿意 80分、普通 60分、不滿意 40分、非常不滿意 20分。")])],-1))]))}},lx=Le(ox,[["__scopeId","data-v-f30b6fb9"]]),nx={class:"flex flex-col items-center p-6"},rx={class:"w-full max-w-[1500px] flex justify-between items-center"},ix={class:"w-full max-w-[1500px] flex justify-end mb-6"},dx={class:"space-x-4"},ux={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},cx={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},px={class:"space-y-6"},vx={class:"flex items-center"},mx=["disabled"],bx=["value"],fx={class:"flex items-center"},yx=["readonly"],gx={class:"flex items-center"},xx=["readonly"],hx={class:"flex items-center"},wx=["readonly"],_x={class:"flex items-center"},kx=["readonly"],$x={class:"flex flex-col"},Cx={class:"ml-28"},Ex={class:"border border-gray-200 p-3 rounded","aria-labelledby":"timeSlotLabel"},Sx={key:0,class:"p-2"},Dx={class:"flex justify-between mb-2"},Mx={class:"font-medium"},Ax=["onClick"],Ix={class:"flex flex-wrap items-center"},Rx={class:"w-[31%]"},Px=["id","disabled","onUpdate:modelValue","aria-label"],Ux=["value"],Nx={class:"w-[31%]"},Tx=["id","onUpdate:modelValue","readonly","aria-label"],Vx={class:"w-[31%]"},jx=["id","onUpdate:modelValue","readonly","aria-label"],Lx={class:"space-y-6"},Fx={class:"flex items-center"},qx=["readonly"],Ox={class:"flex items-center"},Bx=["readonly"],Hx={class:"flex items-center"},Wx=["readonly"],zx={class:"flex items-center"},Kx=["readonly"],Jx={class:"flex items-center"},Yx=["disabled"],Gx={class:"flex items-center"},Qx=["readonly"],Zx={class:"flex items-center"},Xx=["readonly"],e2={class:"flex items-center"},t2=["readonly"],s2={class:"w-full max-w-[1500px]"},a2={class:"flex border-b border-gray-300"},o2={key:2,class:"w-full max-w-[1500px] mt-4"},l2={key:0,class:"flex justify-center items-center py-10"},n2={key:1,class:"w-full border"},r2=["onClick"],i2={class:"border p-2 text-center"},d2={class:"border p-2 text-center"},u2={class:"border p-2 text-center"},c2={class:"border p-2 text-center"},p2={class:"border p-2 text-center"},v2={class:"border p-2 text-center"},m2={class:"border p-2 text-center"},b2={class:"border p-2 text-center"},f2={class:"border p-2 text-center"},y2={class:"border p-2 text-center"},g2={key:2,class:"text-center py-10 text-gray-500"},x2={key:3,class:"flex justify-center items-center space-x-2 mt-6"},h2=["disabled"],w2=["onClick"],_2={key:1,class:"px-2"},k2=["disabled"],$2={key:3,class:"w-full max-w-[1500px] mt-4"},C2=10,E2={__name:"CourseEdit",setup(D){const x=We(),d=lt(),u=m(!1),C=m(!0),o=m("attendance"),N=[{label:"週一",value:"週一"},{label:"週二",value:"週二"},{label:"週三",value:"週三"},{label:"週四",value:"週四"},{label:"週五",value:"週五"},{label:"週六",value:"週六"},{label:"週日",value:"週日"}],K=m([{day:"",startTime:"",endTime:""}]),$=m([]),P=m({id:"",schoolId:"",courseCode:"",courseName:"",startDate:"",endDate:"",classTime:"",hours:"",contactName:"",contactPhone:"",teacher:"",courseMode:"",classSize:"",graduates:"",respondents:""}),T=m({}),z=m([]),g=m(!1),a=()=>{K.value.push({day:"",startTime:"",endTime:""})},A=me=>{K.value.splice(me,1)},G=me=>{if(!me||me.length===0)return[{day:"",startTime:"",endTime:""}];try{return me.map(pe=>pe.weekday===-1?{day:"",startTime:"",endTime:""}:{day:{1:"週一",2:"週二",3:"週三",4:"週四",5:"週五",6:"週六",7:"週日"}[pe.weekday]||"",startTime:pe.classStartTime||"",endTime:pe.classEndTime||""})}catch(pe){return console.error("解析上課時段錯誤:",pe),[{day:"",startTime:"",endTime:""}]}},k=()=>{if(g.value&&!u.value)return[{weekday:-1,classStartTime:"",classEndTime:""}];const me=K.value.filter(pe=>pe.day);return me.length===0?[{weekday:-1,classStartTime:"",classEndTime:""}]:me.map(pe=>({weekday:{週一:1,週二:2,週三:3,週四:4,週五:5,週六:6,週日:7}[pe.day]||0,classStartTime:pe.startTime||"",classEndTime:pe.endTime||""}))},c=async()=>{try{C.value=!0,g.value=!1;const me=d.params.id;if(console.log("正在獲取課程資料, ID:",me),!b(me))return;const pe=await jt.getCourseById(me);console.log("API回應資料:",pe.data),r(pe.data)}catch(me){y(me)}finally{C.value=!1}},b=me=>me?(console.log("發送API請求獲取課程詳細資料，ID:",me),!0):(console.error("沒有課程ID，無法獲取課程資料"),v.showError("錯誤","沒有課程ID，無法獲取課程資料"),C.value=!1,!1),r=me=>{if(me.code!==0||me.message!=="success"){console.error("獲取課程資料失敗:",me.message),v.showError("錯誤",me.message||"獲取課程資料失敗");return}const pe=me.data.result;if(!pe){console.error("找不到課程資料"),v.showError("錯誤","找不到課程資料");return}f(pe)},f=me=>{console.log("要處理的課程資料:",me),p(me),w(me),T.value=JSON.parse(JSON.stringify(P.value)),z.value=JSON.parse(JSON.stringify(K.value))},p=me=>{P.value={id:me.id,schoolId:me.school,courseName:me.courseName,startDate:_(me.startDate),endDate:_(me.endDate),hours:me.hours===-1?"缺":me.hours,contactName:me.contactName==="-1"?"缺":me.contactName,contactPhone:me.contactPhone==="-1"?"缺":me.contactPhone,teacher:me.teacher==="-1"?"缺":me.teacher,courseCode:me.courseCode,courseMode:me.courseMode||"",classSize:me.classSize===-1?"缺":me.classSize,graduates:me.graduates===-1?"缺":me.graduates,respondents:me.respondents===-1?"缺":me.respondents},console.log("處理後的課程資料:",P.value)},w=me=>{me.timeSlots&&me.timeSlots.length>0&&(g.value=me.timeSlots.some(pe=>pe.weekday===-1),localStorage.setItem("courseHasTimeSlotWithNegativeOne",g.value)),console.log("原始 timeSlots:",me.timeSlots),K.value=G(me.timeSlots),console.log("處理後的 timeSlots:",K.value)},y=me=>{console.error("獲取課程資料錯誤:",me),v.showError("錯誤","獲取課程資料時發生錯誤")},V=async()=>{try{const me=await ot.getSchoolOptions();me.data.code===0&&me.data.message==="success"?$.value=me.data.data:console.error("獲取訓練單位選項失敗:",me.data.message)}catch(me){console.error("獲取訓練單位選項錯誤:",me)}},W=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&U():(T.value=JSON.parse(JSON.stringify(P.value)),z.value=JSON.parse(JSON.stringify(K.value)),g.value&&(K.value=[{day:"",startTime:"",endTime:""}]),u.value=!0)},O=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&te()},_=me=>!me||me==="-1"?(console.log("日期為空或-1:",me),""):(console.log("使用原始日期格式:",me),me),E=me=>{if(!me)return!0;const pe=/^(\d{1,3})[/-]([0-1]?\d)[/-]([0-3]?\d)$/;if(!pe.test(me))return!1;const we=me.indexOf("/")>0?"/":"-";if(we==="/"&&me.indexOf("-")>0||we==="-"&&me.indexOf("/")>0)return!1;const He=me.match(pe),ge=parseInt(He[2]),H=parseInt(He[3]);return ge>=1&&ge<=12&&H>=1&&H<=31&&!((ge===4||ge===6||ge===9||ge===11)&&H>30)&&!(ge===2&&H>29)},L=()=>P.value.id?P.value.schoolId?P.value.courseName?!0:(v.showError("錯誤","請輸入課程名稱"),!1):(v.showError("錯誤","請選擇訓練單位"),!1):(v.showError("錯誤","課程 ID 不存在，無法更新課程"),!1),j=()=>P.value.startDate&&!E(P.value.startDate)?(v.showError("錯誤","開課日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1):P.value.endDate&&!E(P.value.endDate)?(v.showError("錯誤","結業日期格式不正確，請輸入民國年格式(如：113/01/01或113-01-01)"),!1):!0,R=()=>{const me=k();return{id:P.value.id,courseName:P.value.courseName,school:parseInt(P.value.schoolId),startDate:P.value.startDate,endDate:P.value.endDate,timeSlots:me,hours:P.value.hours==="缺"?-1:parseInt(P.value.hours)||0,contactName:P.value.contactName==="缺"?"-1":P.value.contactName||"-1",contactPhone:P.value.contactPhone==="缺"?"-1":P.value.contactPhone||"-1",teacher:P.value.teacher==="缺"?"-1":P.value.teacher||"-1",courseCode:P.value.courseCode,courseMode:P.value.courseMode||"",classSize:P.value.classSize==="缺"?-1:parseInt(P.value.classSize)||0,graduates:P.value.graduates==="缺"?-1:parseInt(P.value.graduates)||0,respondents:P.value.respondents==="缺"?-1:parseInt(P.value.respondents)||0}},U=async()=>{try{if(C.value=!0,!L()){C.value=!1;return}if(!j()){C.value=!1;return}const me=R(),pe=await jt.updateCourse(P.value.id,me);pe.data.code===0?(u.value=!1,await c(),await le(),v.showSuccess("儲存成功","課程資料已成功更新")):v.showError("儲存失敗",pe.data.message||"儲存課程資料失敗")}catch(me){console.error("儲存課程資料錯誤:",me),v.showError("儲存失敗","儲存課程資料時發生錯誤")}finally{C.value=!1}},te=()=>{P.value=JSON.parse(JSON.stringify(T.value)),K.value=JSON.parse(JSON.stringify(z.value)),localStorage.getItem("courseHasTimeSlotWithNegativeOne")==="true"&&(g.value=!0),u.value=!1},ue=()=>{if(d.query.from==="course"){console.log("從課程頁面來，返回到課程頁面，保留頁碼:",d.query.page),console.log("完整路由參數:",d.query);const me={page:d.query.page||"",year:d.query.year||"",school:d.query.school||"",course:d.query.course||"",month:d.query.month||"",searchKeyword:d.query.searchKeyword||"",sortBy:d.query.sortBy||"",sortOrder:d.query.sortOrder||""};Object.keys(me).forEach(pe=>{me[pe]===""&&delete me[pe]}),console.log("返回課程頁面的最終參數:",me),x.push({path:"/course",query:me})}else console.log("不是從課程頁面來，使用 router.back()"),x.back()};Ee(()=>d.params.id,me=>{me?c():(console.error("沒有課程ID，無法獲取課程資料"),v.showError("錯誤","沒有課程ID，無法獲取課程資料"))}),je(()=>{localStorage.removeItem("courseHasTimeSlotWithNegativeOne"),V(),c(),Be()});const ye=m(1),ke=m(0),De=m(0),$e=m([]),ve=m(!1),oe=Se(()=>ke.value<=5?q(ke.value):S(ye.value,ke.value,5)),q=me=>{const pe=[];for(let we=1;we<=me;we++)pe.push(we);return pe},S=(me,pe,we)=>{const He=[],ge=Math.floor(we/2);let H=me-ge,i=me+ge;H<1?(H=1,i=we):i>pe&&(i=pe,H=pe-we+1),Y(He,H);for(let n=H;n<=i;n++)He.push(n);return fe(He,i,pe),He},Y=(me,pe)=>{pe<=1||(me.push(1),pe>2&&me.push("..."))},fe=(me,pe,we)=>{pe>=we||(pe<we-1&&me.push("..."),me.push(we))},le=async()=>{var me,pe;try{ve.value=!0;const we=d.params.id;if(!we){console.error("沒有課程ID，無法獲取出缺勤資料"),v.showError("錯誤","沒有課程ID，無法獲取出缺勤資料"),ve.value=!1;return}const He={page:ye.value,limit:C2,id:we},ge=await jt.getAbsenceHistory(He);if(((me=ge==null?void 0:ge.data)==null?void 0:me.code)===0){const{list:H}=ge.data.data.result;De.value=ge.data.data.totalCount,ke.value=ge.data.data.totalPage,$e.value=H.map(i=>({id:i.id,studentId:i.studentId===-1||i.studentId==="-1"?"缺":i.studentId,name:i.name,subsidyCategory:i.subsidyCategory===-1||i.subsidyCategory==="-1"?"缺":i.subsidyCategory,status:i.status===-1||i.status==="-1"?"缺":i.status,classHours:i.classHours===-1||i.classHours==="-1"?"缺":i.classHours,absenceHours:i.absenceHours===-1||i.absenceHours==="-1"?"缺":i.absenceHours,attendanceHours:i.attendanceHours===-1||i.attendanceHours==="-1"?"缺":i.attendanceHours,earnedCredits:i.earnedCredits===-1||i.earnedCredits==="-1"?"缺":i.earnedCredits,grade:i.grade===-1||i.grade==="-1"?"缺":i.grade,certificateNumber:i.certificateNumber===-1||i.certificateNumber==="-1"?"缺":i.certificateNumber}))}else console.error("獲取出缺勤資料失敗:",((pe=ge==null?void 0:ge.data)==null?void 0:pe.message)||"未知錯誤"),$e.value=[],De.value=0,ke.value=0}catch(we){console.error("獲取出缺勤資料錯誤:",we),$e.value=[],De.value=0,ke.value=0}finally{ve.value=!1}};Ee(()=>P.value.id,me=>{me&&le()}),Ee(ye,()=>{le()});const Q=me=>{ye.value=me},se=()=>{ye.value>1&&ye.value--},ie=()=>{ye.value<ke.value&&ye.value++},de=me=>{if(me){const pe={from:"courseEdit",courseId:d.params.id,page:ye.value,originalCoursePage:d.query.page||"1"};console.log("CourseEdit.vue goToSingle parameters:",{studentId:me,courseId:d.params.id,finalQueryParams:pe}),x.push({name:"Single",params:{id:me},query:pe})}},ae=(me,pe)=>{if(!u.value)return;const we=me.target.value,ge=we.replace(/[^0-9/-]/g,"").slice(0,10);we!==ge&&(P.value[pe]=ge)},ce=async()=>{if(await v.confirmAsync("確認刪除",`確定要刪除課程「${P.value.courseName}」嗎？刪除後資料將無法恢復。`)){const pe=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(pe===null||pe==="")return;try{if(C.value=!0,(await jt.confirmPassword(pe)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),C.value=!1;return}const He=await jt.deleteCourse(P.value.id);He.data.code===0?(v.showSuccess("刪除成功","課程已成功刪除"),x.push({path:"/course",query:{page:d.query.page||"1",year:d.query.year||"",school:d.query.school||"",course:d.query.course||"",month:d.query.month||"",searchKeyword:d.query.searchKeyword||"",sortBy:d.query.sortBy||"",sortOrder:d.query.sortOrder||""}})):v.showError("刪除失敗",He.data.message||"刪除課程失敗")}catch(we){console.error("操作錯誤:",we),we.response&&we.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除課程時發生錯誤，請稍後再試")}finally{C.value=!1}}},Ie=m({courseDataUpdate:!1,courseDataDelete:!1,satisfactionRead:!1}),Be=async()=>{try{const me=await tt.getSidebarPermissions();me.data.code===0&&me.data.message==="success"?(Ie.value=me.data.data,console.log("課程編輯頁面權限:",Ie.value)):console.error("獲取權限失敗:",me.data.message)}catch(me){console.error("獲取權限錯誤:",me)}};return(me,pe)=>(t(),s("div",nx,[e("div",rx,[Qe(pt,{breadcrumbs:[{name:"課程內容",path:"/course"},{name:"課程編輯",path:"/course-edit"}]}),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:ue},pe[17]||(pe[17]=[e("span",{class:"mr-2"},"←",-1),xe(" 回課程資訊頁面 ")]))]),pe[40]||(pe[40]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",ix,[e("div",dx,[u.value&&Ie.value.courseDataDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white",onClick:ce}," 刪除課程 ")):J("",!0),u.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:O}," 取消 ")):J("",!0),Ie.value.courseDataUpdate?(t(),s("button",{key:2,class:X(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:W},l(u.value?"儲存":"內容編輯"),3)):J("",!0)])]),C.value?(t(),s("div",ux,pe[18]||(pe[18]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",cx,[e("div",px,[e("div",vx,[pe[20]||(pe[20]=e("label",{class:"w-28",for:"schoolId"},"訓練單位:",-1)),I(e("select",{id:"schoolId",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":pe[0]||(pe[0]=we=>P.value.schoolId=we)},[pe[19]||(pe[19]=e("option",{value:""},"請選擇訓練單位",-1)),(t(!0),s(Z,null,re($.value,we=>(t(),s("option",{key:we.id,value:we.id},l(we.name),9,bx))),128))],10,mx),[[Pe,P.value.schoolId]])]),e("div",fx,[pe[21]||(pe[21]=e("label",{class:"w-28",for:"courseCode"},"課程編號:",-1)),I(e("input",{id:"courseCode",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[1]||(pe[1]=we=>P.value.courseCode=we),readonly:!u.value},null,10,yx),[[ee,P.value.courseCode]])]),e("div",gx,[pe[22]||(pe[22]=e("label",{class:"w-28",for:"courseName"},"課程名稱:",-1)),I(e("input",{id:"courseName",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[2]||(pe[2]=we=>P.value.courseName=we),readonly:!u.value},null,10,xx),[[ee,P.value.courseName]])]),e("div",hx,[pe[23]||(pe[23]=e("label",{class:"w-28",for:"startDate"},"開課日期:",-1)),I(e("input",{id:"startDate",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[3]||(pe[3]=we=>P.value.startDate=we),readonly:!u.value,placeholder:"請輸入民國年格式，例如：113/01/05",onInput:pe[4]||(pe[4]=we=>ae(we,"startDate"))},null,42,wx),[[ee,P.value.startDate]])]),e("div",_x,[pe[24]||(pe[24]=e("label",{class:"w-28",for:"endDate"},"結業日期:",-1)),I(e("input",{id:"endDate",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[5]||(pe[5]=we=>P.value.endDate=we),readonly:!u.value,placeholder:"請輸入民國年格式，例如：113/05/05",onInput:pe[6]||(pe[6]=we=>ae(we,"endDate"))},null,42,kx),[[ee,P.value.endDate]])]),e("div",$x,[pe[28]||(pe[28]=e("div",{class:"flex items-center"},[e("span",{class:"w-28",id:"timeSlotLabel"},"上課時段:")],-1)),e("div",Cx,[e("div",Ex,[!u.value&&g.value?(t(),s("div",Sx,"缺")):(t(),s(Z,{key:1},[(t(!0),s(Z,null,re(K.value,(we,He)=>(t(),s("div",{key:He},[e("div",Dx,[e("span",Mx,"時段 "+l(He+1),1),u.value&&K.value.length>1?(t(),s("button",{key:0,onClick:ge=>A(He),class:"text-red-500 text-sm"}," 刪除此時段 ",8,Ax)):J("",!0)]),e("div",Ix,[e("div",Rx,[I(e("select",{id:`timeSlotDay-${He}`,class:X(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":ge=>we.day=ge,"aria-label":`選擇星期 時段${He+1}`},[pe[25]||(pe[25]=e("option",{value:""},"請選擇星期",-1)),(t(),s(Z,null,re(N,ge=>e("option",{key:ge.value,value:ge.value},l(ge.label),9,Ux)),64))],10,Px),[[Pe,we.day]])]),pe[26]||(pe[26]=e("div",{class:"w-[3.5%] flex justify-center items-center"},[e("span",{class:"text-center"},"從")],-1)),e("div",Nx,[I(e("input",{id:`timeSlotStart-${He}`,type:"time",class:X(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ge=>we.startTime=ge,readonly:!u.value,"aria-label":`開始時間 時段${He+1}`},null,10,Tx),[[ee,we.startTime]])]),pe[27]||(pe[27]=e("div",{class:"w-[3.5%] flex justify-center items-center"},[e("span",{class:"text-center"},"至")],-1)),e("div",Vx,[I(e("input",{id:`timeSlotEnd-${He}`,type:"time",class:X(["p-2 outline-none focus:outline-none w-full h-[38px]",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":ge=>we.endTime=ge,readonly:!u.value,"aria-label":`結束時間 時段${He+1}`},null,10,jx),[[ee,we.endTime]])])])]))),128)),u.value?(t(),s("button",{key:0,onClick:a,class:"mt-2 px-3 py-1 bg-[#f3f4ec] hover:bg-[#e6e7df] text-[#4e9875] rounded border border-[#4e9875]"}," + 新增上課時段 ")):J("",!0)],64))])])])]),e("div",Lx,[e("div",Fx,[pe[29]||(pe[29]=e("label",{class:"w-28",for:"hours"},"上課時數:",-1)),I(e("input",{id:"hours",type:"number",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[7]||(pe[7]=we=>P.value.hours=we),readonly:!u.value},null,10,qx),[[ee,P.value.hours]])]),e("div",Ox,[pe[30]||(pe[30]=e("label",{class:"w-28",for:"contactName"},"負責人員:",-1)),I(e("input",{id:"contactName",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[8]||(pe[8]=we=>P.value.contactName=we),readonly:!u.value},null,10,Bx),[[ee,P.value.contactName]])]),e("div",Hx,[pe[31]||(pe[31]=e("label",{class:"w-28",for:"contactPhone"},"聯絡方式:",-1)),I(e("input",{id:"contactPhone",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[9]||(pe[9]=we=>P.value.contactPhone=we),readonly:!u.value},null,10,Wx),[[ee,P.value.contactPhone]])]),e("div",zx,[pe[32]||(pe[32]=e("label",{class:"w-28",for:"teacher"},"授課老師:",-1)),I(e("input",{id:"teacher",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[10]||(pe[10]=we=>P.value.teacher=we),readonly:!u.value},null,10,Kx),[[ee,P.value.teacher]])]),e("div",Jx,[pe[34]||(pe[34]=e("label",{class:"w-28",for:"courseMode"},"訓練方式:",-1)),I(e("select",{id:"courseMode",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),disabled:!u.value,"onUpdate:modelValue":pe[11]||(pe[11]=we=>P.value.courseMode=we)},pe[33]||(pe[33]=[e("option",{value:""},"請選擇訓練方式",-1),e("option",{value:"1"},"線上",-1),e("option",{value:"2"},"實體",-1),e("option",{value:"3"},"線上/實體",-1)]),10,Yx),[[Pe,P.value.courseMode]])]),e("div",Gx,[pe[35]||(pe[35]=e("label",{class:"w-28",for:"classSize"},"開課人數:",-1)),I(e("input",{id:"classSize",type:"number",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[12]||(pe[12]=we=>P.value.classSize=we),readonly:!u.value},null,10,Qx),[[ee,P.value.classSize]])]),e("div",Zx,[pe[36]||(pe[36]=e("label",{class:"w-28",for:"graduates"},"結訓人數:",-1)),I(e("input",{id:"graduates",type:"number",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[13]||(pe[13]=we=>P.value.graduates=we),readonly:!u.value},null,10,Xx),[[ee,P.value.graduates]])]),e("div",e2,[pe[37]||(pe[37]=e("label",{class:"w-28",for:"respondents"},"問卷人數:",-1)),I(e("input",{id:"respondents",type:"number",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":pe[14]||(pe[14]=we=>P.value.respondents=we),readonly:!u.value},null,10,t2),[[ee,P.value.respondents]])])])])),pe[41]||(pe[41]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",s2,[e("div",a2,[e("button",{class:X(["px-6 py-3 font-medium",o.value==="attendance"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-gray-800"]),onClick:pe[15]||(pe[15]=we=>o.value="attendance")}," 出缺勤資訊 ",2),Ie.value.satisfactionRead?(t(),s("button",{key:0,class:X(["px-6 py-3 font-medium",o.value==="survey"?"text-[#4e9875] border-b-2 border-[#4e9875]":"text-gray-600 hover:text-gray-800"]),onClick:pe[16]||(pe[16]=we=>o.value="survey")}," 滿意度調查 ",2)):J("",!0)])]),o.value==="attendance"?(t(),s("div",o2,[ve.value?(t(),s("div",l2,pe[38]||(pe[38]=[e("div",{class:"text-lg"},"出缺勤資料載入中...",-1)]))):$e.value.length>0?(t(),s("table",n2,[pe[39]||(pe[39]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"序"),e("th",{class:"border p-2"},"姓名"),e("th",{class:"border p-2"},"補助類別"),e("th",{class:"border p-2"},"狀態"),e("th",{class:"border p-2"},"訓練時數"),e("th",{class:"border p-2"},"缺席時數"),e("th",{class:"border p-2"},"出席時數"),e("th",{class:"border p-2"},"取得學分數"),e("th",{class:"border p-2"},"成績"),e("th",{class:"border p-2"},"證書編號")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re($e.value,(we,He)=>(t(),s("tr",{key:we.id,class:"hover:bg-gray-100 cursor-pointer",onClick:ge=>de(we.id)},[e("td",i2,l(He+1),1),e("td",d2,l(we.name),1),e("td",u2,l(we.subsidyCategory),1),e("td",c2,l(we.status),1),e("td",p2,l(we.classHours),1),e("td",v2,l(we.absenceHours),1),e("td",m2,l(we.attendanceHours),1),e("td",b2,l(we.earnedCredits),1),e("td",f2,l(we.grade),1),e("td",y2,l(we.certificateNumber),1)],8,r2))),128))])])):(t(),s("div",g2," 尚無出缺勤資料 ")),ke.value>0?(t(),s("div",x2,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:ye.value===1,onClick:se}," 上一頁 ",8,h2),(t(!0),s(Z,null,re(oe.value,we=>(t(),s(Z,{key:we},[we!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":we===ye.value}]),onClick:He=>Q(we)},l(we),11,w2)):(t(),s("span",_2,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:ye.value===ke.value,onClick:ie}," 下一頁 ",8,k2)])):J("",!0)])):J("",!0),o.value==="survey"&&Ie.value.satisfactionRead?(t(),s("div",$2,[Qe(lx,{courseId:xt(d).params.id},null,8,["courseId"])])):J("",!0)]))}},S2=Le(E2,[["__scopeId","data-v-255a7604"]]),D2={class:"flex flex-col items-center p-6"},M2={class:"w-full max-w-[1500px]"},A2={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},I2={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},R2={key:1,class:"w-full max-w-[1500px] grid grid-cols-3 gap-6"},P2={class:"space-y-6"},U2={class:"flex items-center"},N2={class:"flex items-center"},T2={class:"flex items-center"},V2={class:"space-y-6"},j2={class:"flex items-center"},L2=["value"],F2={class:"flex items-center"},q2={class:"flex items-center"},O2={class:"flex items-center"},B2={class:"flex items-center"},H2={class:"space-y-6"},W2={class:"flex items-center"},z2={class:"flex items-center"},K2={class:"flex items-center"},J2={class:"flex items-center"},Y2={__name:"Add",setup(D){const x=We(),d=m(!1),u=_=>/^[A-Z]\d{9}$/.test(_),C=_=>/^09\d{8}$/.test(_),o=_=>{if(!_)return!0;const E=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;return _.length>254?!1:E.test(_)},N=_=>/^[\u4e00-\u9fa5a-zA-Z\s]+$/.test(_),K=_=>_?/^\d{3,7}$/.test(_):!0,$=_=>_?/^\d{3,4}$/.test(_):!0,P=_=>_?/^[0-9-]{8,16}$/.test(_):!0,z=m({...{name:"",gender:"1",idNumber:"",agencyId:"",phone:"",officePhone:"",officeEmail:"",email:"",subsidyCategory:"1",bankCode:"",branchCode:"",bankAccount:""}}),g=m([]),a=m(""),A=m("1"),G=m("1"),k=async()=>{try{const _=await ot.getAgencyOptions();_.data.code===0&&_.data.message==="success"?g.value=_.data.data:v.showError("載入失敗","獲取機關選項失敗: "+_.data.message)}catch(_){v.showError("載入失敗","獲取機關選項錯誤"),console.error("獲取機關選項錯誤:",_)}},c=async()=>{await v.confirmAsync("確認離開","確定要離開嗎？所有未儲存的資料將會遺失。")&&x.back()},b=async()=>{if(r())try{d.value=!0;const _=y(),E=await V(_);W(E)}catch(_){O(_)}finally{d.value=!1}},r=()=>f()&&p()&&w(),f=()=>z.value.name?N(z.value.name)?z.value.idNumber?u(z.value.idNumber)?a.value?!0:(v.showError("貼心提醒","請選擇機關"),!1):(v.showError("貼心提醒","身分證字號格式不正確，請輸入第一個為大寫英文加上9碼數字"),!1):(v.showError("貼心提醒","請輸入身分證字號"),!1):(v.showError("貼心提醒","姓名格式不正確，只能包含中文、英文字母和空格"),!1):(v.showError("貼心提醒","請輸入姓名"),!1),p=()=>z.value.phone&&!C(z.value.phone)?(v.showError("貼心提醒","行動電話格式不正確，請輸入09開頭的10位數字"),!1):z.value.email&&!o(z.value.email)?(v.showError("貼心提醒","私人郵件格式不正確，請輸入有效的電子郵件地址"),!1):z.value.officeEmail&&!o(z.value.officeEmail)?(v.showError("貼心提醒","公務郵件格式不正確，請輸入有效的電子郵件地址"),!1):!0,w=()=>z.value.bankCode&&!K(z.value.bankCode)?(v.showError("貼心提醒","銀行代碼格式不正確，請輸入3-7位數字"),!1):z.value.branchCode&&!$(z.value.branchCode)?(v.showError("貼心提醒","分行代碼格式不正確，請輸入3-4位數字"),!1):z.value.bankAccount&&!P(z.value.bankAccount)?(v.showError("貼心提醒","銀行帳號格式不正確，請輸入8-16位數字，可包含連字符號"),!1):!0,y=()=>{const _={...z.value,gender:Number(A.value),agencyId:Number(a.value),subsidyCategory:Number(G.value)};return Object.keys(_).forEach(E=>{(_[E]===""||_[E]===null||_[E]===void 0)&&(_[E]="")}),console.log("提交數據:",_),_},V=async _=>await Dt.addStudent(_),W=_=>{_.data.code===0?(v.showSuccess("貼心提醒","新增學員成功"),setTimeout(()=>{x.back()},1500)):v.showError("貼心提醒",_.data.message||"新增學員失敗")},O=_=>{console.error("新增學員錯誤:",_),v.showError("貼心提醒","新增學員失敗，請稍後再試")};return je(()=>{k()}),(_,E)=>(t(),s("div",D2,[e("div",M2,[Qe(pt,{breadcrumbs:[{name:"學員資料",path:"/student/information"},{name:"新增學員",path:"/student/add"}]})]),e("div",A2,[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:E[0]||(E[0]=L=>xt(x).back()),"aria-label":"回學員資料頁面"},E[14]||(E[14]=[e("span",{class:"mr-2"},"←",-1),xe(" 回學員資料頁面 ")]))]),E[32]||(E[32]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",{class:"w-full max-w-[1500px] flex justify-between items-center mb-6"},[E[15]||(E[15]=e("div",{class:"text-sm text-gray-600"},[e("span",{class:"text-red-500"},"*"),xe(" 代表必填欄位 ")],-1)),e("div",{class:"space-x-4"},[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:c,"aria-label":"取消新增學員"}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:b,"aria-label":"儲存學員資料"}," 儲存 ")])]),d.value?(t(),s("div",I2,E[16]||(E[16]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",R2,[e("div",P2,[e("div",U2,[E[17]||(E[17]=e("label",{class:"w-24",for:"student-name"},[xe("姓名:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{id:"student-name",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[1]||(E[1]=L=>z.value.name=L),placeholder:"請輸入姓名，只能填寫中英文"},null,512),[[ee,z.value.name]])]),e("div",N2,[E[19]||(E[19]=e("label",{class:"w-24",for:"student-gender"},[xe("性別:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"student-gender",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":E[2]||(E[2]=L=>A.value=L)},E[18]||(E[18]=[e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512),[[Pe,A.value]])]),e("div",T2,[E[20]||(E[20]=e("label",{class:"w-24",for:"student-id-number"},[xe("身分證字號:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{id:"student-id-number",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[3]||(E[3]=L=>z.value.idNumber=L),placeholder:"大寫英文+9碼數字，例：A123456789",onInput:E[4]||(E[4]=L=>z.value.idNumber=z.value.idNumber.toUpperCase()),maxlength:"10"},null,544),[[ee,z.value.idNumber]])])]),e("div",V2,[e("div",j2,[E[22]||(E[22]=e("label",{class:"w-24",for:"student-agency"},[xe("機關名稱:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"student-agency",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":E[5]||(E[5]=L=>a.value=L)},[E[21]||(E[21]=e("option",{value:""},"請選擇機關",-1)),(t(!0),s(Z,null,re(g.value,L=>(t(),s("option",{key:L.id,value:L.id},l(L.name),9,L2))),128))],512),[[Pe,a.value]])]),e("div",F2,[E[23]||(E[23]=e("label",{class:"w-24",for:"student-phone"},"行動電話:",-1)),I(e("input",{id:"student-phone",type:"tel",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[6]||(E[6]=L=>z.value.phone=L),placeholder:"09開頭的10位數字，例：0912345678",maxlength:"10"},null,512),[[ee,z.value.phone]])]),e("div",q2,[E[24]||(E[24]=e("label",{class:"w-24",for:"student-office-phone"},"公務電話:",-1)),I(e("input",{id:"student-office-phone",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[7]||(E[7]=L=>z.value.officePhone=L),placeholder:"可填寫手機、市話(含區碼)或內線"},null,512),[[ee,z.value.officePhone]])]),e("div",O2,[E[25]||(E[25]=e("label",{class:"w-24",for:"student-office-email"},"公務郵件:",-1)),I(e("input",{id:"student-office-email",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[8]||(E[8]=L=>z.value.officeEmail=L),placeholder:"例：example@gov.tw"},null,512),[[ee,z.value.officeEmail]])]),e("div",B2,[E[26]||(E[26]=e("label",{class:"w-24",for:"student-email"},"私人郵件:",-1)),I(e("input",{id:"student-email",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[9]||(E[9]=L=>z.value.email=L),placeholder:"例：example@example.com"},null,512),[[ee,z.value.email]])])]),e("div",H2,[e("div",W2,[E[28]||(E[28]=e("label",{class:"w-24",for:"subsidy-category"},[xe("補助類別:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"subsidy-category",class:"flex-1 p-2 outline-none focus:outline-none border border-[#4e9875]","onUpdate:modelValue":E[10]||(E[10]=L=>G.value=L)},E[27]||(E[27]=[e("option",{value:"1"},"機關薦派",-1),e("option",{value:"2"},"自行報名",-1),e("option",{value:"3"},"非本計畫",-1)]),512),[[Pe,G.value]])]),e("div",z2,[E[29]||(E[29]=e("label",{class:"w-24",for:"bank-code"},"銀行代碼:",-1)),I(e("input",{id:"bank-code",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[11]||(E[11]=L=>z.value.bankCode=L),placeholder:"請輸入3-7位數字的銀行代碼",maxlength:"7"},null,512),[[ee,z.value.bankCode]])]),e("div",K2,[E[30]||(E[30]=e("label",{class:"w-24",for:"branch-code"},"分行代碼:",-1)),I(e("input",{id:"branch-code",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[12]||(E[12]=L=>z.value.branchCode=L),placeholder:"請輸入3-4位數字的分行代碼",maxlength:"4"},null,512),[[ee,z.value.branchCode]])]),e("div",J2,[E[31]||(E[31]=e("label",{class:"w-24",for:"bank-account"},"銀行帳號:",-1)),I(e("input",{id:"bank-account",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":E[13]||(E[13]=L=>z.value.bankAccount=L),placeholder:"請輸入8-16位數字的銀行帳號，可包含連字符號",maxlength:"16"},null,512),[[ee,z.value.bankAccount]])])])]))]))}},G2=Le(Y2,[["__scopeId","data-v-9637f4f2"]]),Q2={class:"flex flex-col items-center p-6"},Z2={class:"w-full max-w-[1500px] flex justify-between items-center"},X2={class:"w-full max-w-[1500px] flex justify-end mb-6"},eh={class:"space-x-4"},th=["aria-label"],sh={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},ah={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},oh={class:"space-y-6"},lh={class:"flex items-center"},nh=["readonly"],rh={class:"flex items-center"},ih=["readonly"],dh={class:"flex items-center"},uh={class:"flex-1 flex items-center"},ch=["readonly"],ph=["readonly"],vh={__name:"SingleEdit",setup(D){const x=We(),d=lt(),u=m(!1),C=m(!1),o=m({id:0,certificateNumber:"",grade:-1,certificateStartDate:"",certificateEndDate:""}),N=m({}),K=Se(()=>{const G=d.query.studentId;let k=[];if(G)switch(d.query.originalFrom){case"information":k=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:`/student/single/${G}`},{name:"學分編輯",path:""}];break;case"history":k=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${G}`},{name:"學分編輯",path:""}];break;case"courseEdit":k=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${G}`},{name:"學分編輯",path:""}];break;default:k=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${G}`},{name:"學分編輯",path:""}]}else k=[{name:"學員管理",path:"/student/information"},{name:"學分編輯",path:""}];return k}),$=()=>{if(d.query.studentId){const G=d.query.originalFrom;console.log("SingleEdit 返回 Single 頁面，原始來源:",G),d.query.courseId,d.query.page,["year","school","course","agency","area","searchKeyword","month","sortBy","sortOrder"].forEach(k=>{d.query[k]&&d.query[k]}),x.back()}else x.back()},P=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&z():(N.value=JSON.parse(JSON.stringify(o.value)),u.value=!0)},T=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&g()},z=()=>{u.value=!1,a(o.value)},g=()=>{o.value=JSON.parse(JSON.stringify(N.value)),u.value=!1},a=async G=>{try{C.value=!0,console.log("保存學分資料:",G);const k={grade:Number(G.grade),certificateNumber:G.certificateNumber,certificateStartDate:G.certificateStartDate,certificateEndDate:G.certificateEndDate},c=await Dt.updateLearnHistory(G.id,k);c.data.code===0?v.showSuccess("儲存成功","學分資料已成功儲存"):v.showError("儲存失敗",c.data.message||"儲存學分資料時發生錯誤")}catch(k){console.error("儲存學分資料錯誤:",k),v.showError("儲存失敗","儲存學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},A=async()=>{try{C.value=!0;const G=d.params.id;if(!G){console.error("未提供學習歷史ID");return}const k=await Dt.getLearnHistoryById(G);if(console.log("API 回應:",k.data),!k.data.data||!k.data.data.result){console.error("API 回應格式錯誤:",k.data),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試");return}o.value={id:G,certificateNumber:k.data.data.result.certificateNumber||"",grade:k.data.data.result.grade!==void 0?Number(k.data.data.result.grade):-1,certificateStartDate:k.data.data.result.certificateStartDate||"",certificateEndDate:k.data.data.result.certificateEndDate||""},N.value=JSON.parse(JSON.stringify(o.value))}catch(G){console.error("獲取學分資料錯誤:",G),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}};return je(()=>{A()}),(G,k)=>(t(),s("div",Q2,[e("div",Z2,[Qe(pt,{breadcrumbs:K.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:$,"aria-label":"返回上一頁"},k[4]||(k[4]=[e("span",{class:"mr-2"},"←",-1),xe(" 回上一頁 ")]))]),k[10]||(k[10]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",X2,[e("div",eh,[u.value?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:T,"aria-label":"取消編輯"}," 取消 ")):J("",!0),e("button",{class:X(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:P,"aria-label":u.value?"儲存編輯內容":"開始編輯內容"},l(u.value?"儲存":"內容編輯"),11,th)])]),C.value?(t(),s("div",sh,k[5]||(k[5]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",ah,[e("div",oh,[e("div",lh,[k[6]||(k[6]=e("label",{class:"w-36",for:"certificateNumber"},"學分證書編號:",-1)),I(e("input",{id:"certificateNumber",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":k[0]||(k[0]=c=>o.value.certificateNumber=c),readonly:!u.value},null,10,nh),[[ee,o.value.certificateNumber]])]),e("div",rh,[k[7]||(k[7]=e("label",{class:"w-36",for:"creditGrade"},"成績:",-1)),I(e("input",{id:"creditGrade",type:"number",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":k[1]||(k[1]=c=>o.value.grade=c),readonly:!u.value},null,10,ih),[[ee,o.value.grade]])]),e("div",dh,[k[9]||(k[9]=e("label",{class:"w-36",for:"certificateDates"},"證書參照日期起迄:",-1)),e("div",uh,[I(e("input",{id:"certificateStartDate",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":k[2]||(k[2]=c=>o.value.certificateStartDate=c),readonly:!u.value,placeholder:"例：113/02/01"},null,10,ch),[[ee,o.value.certificateStartDate]]),k[8]||(k[8]=e("span",{class:"mx-2"},"~",-1)),I(e("input",{id:"certificateEndDate",type:"text",class:X(["flex-1 p-2 outline-none focus:outline-none",u.value?"border border-[#4e9875]":"border border-gray-300"]),"onUpdate:modelValue":k[3]||(k[3]=c=>o.value.certificateEndDate=c),readonly:!u.value,placeholder:"例：116/02/01"},null,10,ph),[[ee,o.value.certificateEndDate]])])])])]))]))}},mh=Le(vh,[["__scopeId","data-v-a78d0233"]]),bh={class:"w-full h-full"},fh=["src"],yh={__name:"Dashboard",setup(D){const x=m("https://dev-moda.mosji.co/dashboard/");return je(()=>{const d=document.querySelector("iframe");d&&(d.style.height=`${window.innerHeight}px`)}),(d,u)=>(t(),s("div",bh,[e("iframe",{src:x.value,class:"w-full h-full border-0",title:"數據儀表板",allowfullscreen:""},null,8,fh)]))}},gh=Le(yh,[["__scopeId","data-v-f531c2f3"]]),xh={class:"flex flex-col items-center p-6"},hh={class:"w-full max-w-[1500px]"},wh={class:"w-full max-w-[1500px] flex justify-end mb-2"},_h={class:"space-x-4"},kh=["disabled"],$h=["disabled"],Ch={class:"w-full max-w-[1500px] border-2 border-black"},Eh={class:"w-full border-collapse"},Sh={class:"border-r border-black p-4 w-1/4"},Dh=["disabled"],Mh={value:""},Ah=["value"],Ih={class:"p-4 w-1/4"},Rh=["disabled"],Ph={value:""},Uh=["value"],Nh={class:"border-t-2 border-black p-4",colspan:"3"},Th={class:"border-r border-t-2 border-black p-4",colspan:"1"},Vh={class:"flex flex-col items-center"},jh={class:"flex items-center mb-3"},Lh={class:"flex items-center"},Fh={class:"border-t-2 border-black p-4"},qh={class:"flex flex-col items-start"},Oh={class:"flex items-center mb-2"},Bh=["checked"],Hh={class:"flex items-center flex-wrap"},Wh={class:"flex items-center mr-2"},zh=["checked"],Kh={class:"flex-1 min-w-[120px]"},Jh={class:"border-r border-t-2 border-black p-4",colspan:"1"},Yh={class:"border-t-2 border-black p-4",colspan:"1"},Gh={class:"w-full max-w-[1500px] border-2 border-black"},Qh={class:"w-full border-collapse"},Zh={class:"border-r border-black p-4 pl-8"},Xh={class:"flex items-center"},ew={class:"border-r border-black p-4"},tw={class:"flex justify-around"},sw={class:"flex items-center"},aw=["checked","onChange"],ow={class:"flex items-center"},lw=["checked","onChange"],nw={class:"border-black p-4"},rw=["onUpdate:modelValue"],iw={class:"border-r border-black p-4 pl-8"},dw={class:"flex items-center"},uw={class:"border-r border-black p-4"},cw={class:"flex justify-around"},pw={class:"flex items-center"},vw=["checked","onChange"],mw={class:"flex items-center"},bw=["checked","onChange"],fw={class:"border-black p-4"},yw=["onUpdate:modelValue"],gw={class:"border-r border-black p-4 pl-8"},xw={class:"flex items-center"},hw={class:"border-r border-black p-4"},ww={class:"flex justify-around"},_w={class:"flex items-center"},kw=["checked","onChange"],$w={class:"flex items-center"},Cw=["checked","onChange"],Ew={class:"border-black p-4"},Sw={key:0,class:"flex items-center mb-2"},Dw=["onUpdate:modelValue"],Mw={class:"border-r border-black p-4 pl-8"},Aw={class:"flex items-center"},Iw={class:"border-r border-black p-4"},Rw={class:"flex justify-around"},Pw={class:"flex items-center"},Uw=["checked","onChange"],Nw={class:"flex items-center"},Tw=["checked","onChange"],Vw={class:"border-black p-4"},jw={key:0,class:"flex items-center mb-2"},Lw=["onUpdate:modelValue"],Fw={class:"border-t-2 border-black p-4",colspan:"3"},qw={class:"flex items-center mt-2"},Ow={class:"flex items-center mt-4"},Bw={class:"flex items-center mr-6"},Hw=["checked"],Ww={class:"flex items-center"},zw=["checked"],Kw={class:"w-full max-w-[1500px] border-2 border-black mt-6"},Jw={class:"w-full border-collapse"},Yw={class:"p-4 w-3/4"},Gw={class:"w-full max-w-[1500px] mt-6"},Qw={class:"flex flex-wrap items-center"},Zw={class:"flex items-center ml-4"},Xw=["checked"],e_={class:"flex items-center flex-wrap ml-6"},t_={class:"flex items-center mr-2"},s_=["checked"],a_=["disabled"],o_={__name:"Checklist",setup(D){const x=We();lt();const d=m([]),u=m([]),C=m(!1),o=m(!1),N=m(!1),K=m(!1),$=m({school:"",courseName:"",courseDate:"",year:"",month:"",day:"",startHour:"",startMinute:"",endHour:"",endMinute:"",inspectionType:"",inspectors:"",interviewee:"",onlineRemark:"",isOnline:!1,isOffline:!1,passCount:0,failCount:0,totalScore:"",improvement:"",needFollowUp:null,recheckRemark:"",questions:{"1-1":"(1) 授課師資與計畫相符","1-2":"(2) 課程內容依課程表授課","2-1":"(1) 陪課人員協助課堂服務","2-2":"(2) 製作教學日誌","2-3":"(3) 進行問卷調查","3-1":"(1) 場地符合授課需求","3-2":"(2) 有相應軟硬體設備進行授課，確保授課內容清楚傳達於學員。","3-3":"(3) 有提供穩定的網路連線功能進行授課，且提供穩定音訊、麥克風、即時訊息功能服務。(限查核線上課程)","4-1":"(1) 學員依規定簽到退","4-2":"(2) 備註遲到、請假及曠課人員","4-3":"(3) 提供授課課程教材","4-4":"(4) 確實填寫教學日誌","4-5":"(5) 投保公共意外責任險(限查核實體課程)"},checkResults:{"1-1":null,"1-2":null,"2-1":null,"2-2":null,"2-3":null,"3-1":null,"3-2":null,"3-3":null,"4-1":null,"4-2":null,"4-3":null,"4-4":null,"4-5":null},evidence:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""},hasPass:null,percentages:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""}}),P=async()=>{await v.confirmAsync("確認離開","確定要離開嗎？所有未儲存的資料將會遺失。")&&x.back()},T=()=>$.value.school?$.value.courseName?$.value.inspectionType?!0:(v.showError("貼心提醒","請選擇訪查方式"),!1):(v.showError("貼心提醒","請選擇課程名稱"),!1):(v.showError("貼心提醒","請選擇訪查學校"),!1),z=()=>$.value.inspectors?$.value.interviewee?!0:(v.showError("貼心提醒","請輸入聯絡人"),!1):(v.showError("貼心提醒","請輸入訪查人員"),!1),g=()=>{const R=$.value.year||"",U=$.value.month?String($.value.month).padStart(2,"0"):"",te=$.value.day?String($.value.day).padStart(2,"0"):"";if(!(R&&U&&te?`${R}/${U}/${te}`:""))return v.showError("貼心提醒","請填寫完整的訪查日期"),!1;const ye=/^\d+$/,ke={"開始時間(時)":$.value.startHour,"開始時間(分)":$.value.startMinute,"結束時間(時)":$.value.endHour,"結束時間(分)":$.value.endMinute};for(const[De,$e]of Object.entries(ke)){if(!$e)return v.showError("貼心提醒",`請填寫${De}`),!1;if(!ye.test($e))return v.showError("貼心提醒",`${De}只能填寫數字`),!1}return!0},a=()=>$.value.inspectionType==="online"&&!$.value.onlineRemark?(v.showError("貼心提醒","請填寫線上訪查備註"),!1):!0,A=()=>{const R=$.value.year||"",U=$.value.month?String($.value.month).padStart(2,"0"):"",te=$.value.day?String($.value.day).padStart(2,"0"):"",ue=`${R}/${U}/${te}`,ye=String($.value.startHour).padStart(2,"0"),ke=String($.value.startMinute).padStart(2,"0"),De=String($.value.endHour).padStart(2,"0"),$e=String($.value.endMinute).padStart(2,"0");return{school:parseInt($.value.school),course:parseInt($.value.courseName),visitor:$.value.inspectors,visitDate:ue,visitStartTime:`${ye}:${ke}`,visitEndTime:`${De}:${$e}`,visitMethod:$.value.inspectionType==="online"?1:2,interviewee:$.value.interviewee||null,onlineRemark:$.value.onlineRemark||null,isOnline:$.value.isOnline||null,isOffline:$.value.isOffline||null,totalScore:$.value.totalScore?parseInt($.value.totalScore):null,passCount:$.value.passCount?parseInt($.value.passCount):null,failCount:$.value.failCount?parseInt($.value.failCount):null,improveRemark:$.value.improvement||null,needFollowUp:$.value.needFollowUp,recheckRemark:$.value.needFollowUp===!0&&$.value.recheckRemark||null,content:[{categoryName:"課程師資實施狀況",details:b(1).map(ve=>({question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null}))},{categoryName:"人力安排情形",details:b(2).map(ve=>({question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null}))},{categoryName:"環境設備實施狀況",details:b(3).map(ve=>ve==="3-3"?{question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null,isRemarkChecked:$.value.isOffline||!1}:{question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null})},{categoryName:"課程實施情形",details:b(4).map(ve=>ve==="4-5"?{question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null,isRemarkChecked:$.value.isOnline||!1}:{question:$.value.questions[ve],ans:$.value.checkResults[ve]===null?null:$.value.checkResults[ve]===!0,remark:$.value.evidence[ve]||null})}]}},G=async()=>{var R;if(T()&&z()&&g()&&a())try{N.value=!0;const U=A(),te=await Ps.createVisitHistory(U);if(te.data&&te.data.code===0){v.showSuccess("儲存成功","訪視記錄已成功儲存"),x.push("/supervision");return}v.showError("儲存失敗",((R=te.data)==null?void 0:R.message)||"儲存訪視記錄時發生錯誤")}catch(U){console.error("儲存訪視記錄錯誤:",U),v.showError("儲存失敗","儲存訪視記錄時發生錯誤，請稍後再試")}finally{N.value=!1}},k=async()=>{try{C.value=!0;const R=await ot.getSchoolOptions();R.data&&R.data.code===0&&Array.isArray(R.data.data)?d.value=R.data.data.map(U=>({value:U.id,label:U.name})):(console.error("學校資料格式不正確:",R.data),d.value=[])}catch(R){console.error("獲取學校列表失敗:",R),d.value=[]}finally{C.value=!1}},c=async R=>{if(!R){u.value=[],$.value.courseName="",$.value.courseDate="";return}try{o.value=!0;const U=await ot.getCourseData({school:R});U.data&&U.data.code===0&&Array.isArray(U.data.data)?(u.value=U.data.data.map(te=>({value:te.id,label:te.name,date:te.date||""})),u.value.length===1&&($.value.courseName=u.value[0].value,$.value.courseDate=u.value[0].date||"")):(console.error("課程資料格式不正確:",U.data),u.value=[])}catch(U){console.error("獲取課程列表失敗:",U),$.value.courseName="",$.value.courseDate="",u.value=[]}finally{o.value=!1}};Ee(()=>$.value.school,R=>{R?c(R):(u.value=[],$.value.courseName="",$.value.courseDate="")}),Ee(()=>$.value.courseName,R=>{if(R){const U=u.value.find(te=>te.value===R);U&&($.value.courseDate=U.date||"")}else $.value.courseDate=""}),je(()=>{k(),_()});const b=R=>{const U=`${R}-`;return Object.keys($.value.questions).filter(ue=>ue.startsWith(U)).sort((ue,ye)=>{const ke=parseInt(ue.split("-")[1]),De=parseInt(ye.split("-")[1]);return ke-De})},r=()=>{const R=document.createElement("div");return R.style.width="100%",R.style.padding="20px",R},f=R=>{const U=document.createElement("h2");U.textContent="教學查核紀錄表",U.style.textAlign="center",U.style.marginBottom="20px",U.style.fontFamily="Arial, sans-serif",R.appendChild(U);const te=document.createElement("h2");te.textContent="113-116年推動政府資安人力職能轉換訓練服務",te.style.textAlign="center",te.style.marginBottom="20px",te.style.fontFamily="Arial, sans-serif",te.style.fontWeight="bold",R.insertBefore(te,U)},p=()=>{const R=document.createElement("div");R.style.marginBottom="20px";const U=document.createElement("h3");return U.textContent="一、訪查學校、時間及參與人員",U.style.fontWeight="bold",U.style.marginBottom="10px",R.appendChild(U),R},w=()=>{const R=document.createElement("table");return R.style.width="100%",R.style.borderCollapse="collapse",R.style.marginBottom="20px",R.style.border="1px solid #000",R},y=()=>{const R=d.value.find(ye=>ye.value===$.value.school),U=R?R.label:"",te=u.value.find(ye=>ye.value===$.value.courseName),ue=te?te.label:"";return{schoolName:U,courseName:ue}},V=(R,U)=>[{label1:"訪查學校",value1:R,label2:"課程名稱",value2:U},{label1:"授課時間",value1:$.value.courseDate,label2:"",value2:"",colspan:!0},{label1:"訪查時間(24 時制)",value1:"",label2:"訪查方式",value2:"",needCustom:!0},{label1:"聯絡人",value1:$.value.interviewee,label2:"訪查人員",value2:$.value.inspectors}],W=(R,U)=>{setTimeout(()=>{try{const te=window.open("","_blank");if(!te)throw new Error("無法開啟列印視窗，請檢查是否被瀏覽器阻擋");let ue="<html><head><title>教學查核紀錄表</title>";ue+="<style>",ue+="body { font-family: Arial, sans-serif; padding: 20px; margin:  ; }",ue+="h2 { text-align: center; margin-bottom: 20px; }",ue+="h3 { margin-top: 20px; margin-bottom: 10px; }",ue+="table { width: 100%; border-collapse: collapse; margin-bottom: 20px; page-break-inside: auto; }",ue+="tr { page-break-inside: avoid; page-break-after: auto; }",ue+="thead { display: table-header-group; }",ue+="tfoot { display: table-footer-group; }",ue+="th, td { border: 1px solid #000; padding: 6px; }",ue+="th { background-color: #f2f2f2; text-align: center; }",ue+="@media print {",ue+="  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",ue+="  th, td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",ue+="  @page { margin: 0; size: auto; }",ue+="  html { margin: 0; padding: 0.5cm; }",ue+="  body { margin: 0; padding: 0; }",ue+="  .signature-section { display: flex; justify-content: space-between; margin-top: 20px; }",ue+="  .signature-box { margin-bottom: 10px; }",ue+="}",ue+="</style></head><body>",ue+=R.innerHTML,ue+="<script>",ue+="window.onload = function() {",ue+="  setTimeout(function() {",ue+='    var style = document.createElement("style");',ue+='    style.innerHTML = "@page { margin: 1cm; }";',ue+="    document.head.appendChild(style);",ue+="    window.print();",ue+="  }, 300);",ue+="};",ue+="<\/script>",ue+="</body></html>",te.document.open(),te.document.write(ue),te.document.close(),te.addEventListener("afterprint",()=>{document.body.removeChild(R),v.showSuccess("貼心提醒","查核紀錄表已成功匯出為PDF"),U(!1)}),setTimeout(()=>{U(!1)},5e3)}catch(te){console.error("列印過程發生錯誤:",te),v.showError("匯出失敗",te.message||"列印過程發生錯誤"),U(!1)}},100)},O=async()=>{try{K.value=!0;const R=r();f(R);const U=p(),te=w(),{schoolName:ue,courseName:ye}=y();V(ue,ye).forEach(Ke=>{const Ze=document.createElement("tr");Ze.style.border="1px solid #000";const Je=document.createElement("td");if(Je.textContent=Ke.label1,Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.fontWeight="bold",Je.style.width="20%",Je.style.textAlign="center",Ze.appendChild(Je),Ke.colspan){const Ye=document.createElement("td");Ye.setAttribute("colspan","3"),Ye.textContent=Ke.value1,Ye.style.border="1px solid #000",Ye.style.padding="8px",Ze.appendChild(Ye)}else if(Ke.needCustom&&Ke.label1==="訪查時間(24 時制)"){const Ye=document.createElement("td");Ye.style.border="1px solid #000",Ye.style.padding="8px";const Xe=document.createElement("div");Xe.style.display="flex",Xe.style.flexDirection="column",Xe.style.alignItems="center";const Ge=document.createElement("div");Ge.style.display="flex",Ge.style.alignItems="center",Ge.style.marginBottom="8px";const dt=document.createElement("div");dt.style.display="inline-block",dt.style.position="relative",dt.style.marginRight="5px";const Zt=document.createElement("span");Zt.textContent=$.value.year||"",Zt.style.display="inline-block",Zt.style.minWidth="30px",Zt.style.textAlign="center",dt.appendChild(Zt);const Ft=document.createElement("div");Ft.style.position="absolute",Ft.style.bottom="-2px",Ft.style.left="0",Ft.style.width="100%",Ft.style.height="1px",Ft.style.backgroundColor="#000",dt.appendChild(Ft),Ge.appendChild(dt),Ge.appendChild(document.createTextNode(" 年 "));const Bt=document.createElement("div");Bt.style.display="inline-block",Bt.style.position="relative",Bt.style.marginRight="5px";const Jt=document.createElement("span");Jt.textContent=$.value.month||"",Jt.style.display="inline-block",Jt.style.minWidth="25px",Jt.style.textAlign="center",Bt.appendChild(Jt);const $t=document.createElement("div");$t.style.position="absolute",$t.style.bottom="-2px",$t.style.left="0",$t.style.width="100%",$t.style.height="1px",$t.style.backgroundColor="#000",Bt.appendChild($t),Ge.appendChild(Bt),Ge.appendChild(document.createTextNode(" 月 "));const St=document.createElement("div");St.style.display="inline-block",St.style.position="relative";const At=document.createElement("span");At.textContent=$.value.day||"",At.style.display="inline-block",At.style.minWidth="25px",At.style.textAlign="center",St.appendChild(At);const Ht=document.createElement("div");Ht.style.position="absolute",Ht.style.bottom="-2px",Ht.style.left="0",Ht.style.width="100%",Ht.style.height="1px",Ht.style.backgroundColor="#000",St.appendChild(Ht),Ge.appendChild(St),Ge.appendChild(document.createTextNode(" 日")),Xe.appendChild(Ge);const Wt=document.createElement("div");Wt.style.display="flex",Wt.style.alignItems="center";const ns=document.createElement("div");ns.style.display="inline-block",ns.style.position="relative";const rs=document.createElement("span");rs.textContent=$.value.startHour||"",rs.style.display="inline-block",rs.style.minWidth="25px",rs.style.textAlign="center",ns.appendChild(rs);const Ue=document.createElement("div");Ue.style.position="absolute",Ue.style.bottom="-2px",Ue.style.left="0",Ue.style.width="100%",Ue.style.height="1px",Ue.style.backgroundColor="#000",ns.appendChild(Ue),Wt.appendChild(ns),Wt.appendChild(document.createTextNode(" : "));const Re=document.createElement("div");Re.style.display="inline-block",Re.style.position="relative",Re.style.marginRight="10px";const Me=document.createElement("span");Me.textContent=$.value.startMinute||"",Me.style.display="inline-block",Me.style.minWidth="25px",Me.style.textAlign="center",Re.appendChild(Me);const ze=document.createElement("div");ze.style.position="absolute",ze.style.bottom="-2px",ze.style.left="0",ze.style.width="100%",ze.style.height="1px",ze.style.backgroundColor="#000",Re.appendChild(ze),Wt.appendChild(Re),Wt.appendChild(document.createTextNode(" ~ "));const at=document.createElement("div");at.style.display="inline-block",at.style.position="relative";const et=document.createElement("span");et.textContent=$.value.endHour||"",et.style.display="inline-block",et.style.minWidth="25px",et.style.textAlign="center",at.appendChild(et);const rt=document.createElement("div");rt.style.position="absolute",rt.style.bottom="-2px",rt.style.left="0",rt.style.width="100%",rt.style.height="1px",rt.style.backgroundColor="#000",at.appendChild(rt),Wt.appendChild(at),Wt.appendChild(document.createTextNode(" : "));const bt=document.createElement("div");bt.style.display="inline-block",bt.style.position="relative";const Nt=document.createElement("span");Nt.textContent=$.value.endMinute||"",Nt.style.display="inline-block",Nt.style.minWidth="25px",Nt.style.textAlign="center",bt.appendChild(Nt);const qt=document.createElement("div");qt.style.position="absolute",qt.style.bottom="-2px",qt.style.left="0",qt.style.width="100%",qt.style.height="1px",qt.style.backgroundColor="#000",bt.appendChild(qt),Wt.appendChild(bt),Xe.appendChild(Wt),Ye.appendChild(Xe),Ze.appendChild(Ye);const zt=document.createElement("td");zt.textContent=Ke.label2,zt.style.border="1px solid #000",zt.style.padding="8px",zt.style.fontWeight="bold",zt.style.width="20%",zt.style.textAlign="center",Ze.appendChild(zt);const Yt=document.createElement("td");Yt.style.border="1px solid #000",Yt.style.padding="8px",Yt.style.width="30%",Ze.appendChild(Yt)}else{const Ye=document.createElement("td");if(Ye.textContent=Ke.value1,Ye.style.border="1px solid #000",Ye.style.padding="8px",Ye.style.width="30%",Ze.appendChild(Ye),Ke.label2){const Xe=document.createElement("td");Xe.textContent=Ke.label2,Xe.style.border="1px solid #000",Xe.style.padding="8px",Xe.style.fontWeight="bold",Xe.style.width="20%",Xe.style.textAlign="center",Ze.appendChild(Xe);const Ge=document.createElement("td");Ge.textContent=Ke.value2,Ge.style.border="1px solid #000",Ge.style.padding="8px",Ge.style.width="30%",Ze.appendChild(Ge)}}te.appendChild(Ze)});const De=document.createElement("tr");De.style.border="1px solid #000";const $e=document.createElement("td");$e.setAttribute("colspan","4"),$e.style.border="1px solid #000",$e.style.padding="30px";const ve=document.createElement("div");ve.style.display="flex",ve.style.justifyContent="space-between",ve.style.width="100%",ve.style.marginTop="10px",ve.style.marginBottom="10px",ve.className="signature-section",["承辦","科長","高級分析師","組長"].forEach(Ke=>{const Ze=document.createElement("div");Ze.style.fontSize="14px",Ze.style.flex="1",Ze.style.padding="10px 5px",Ze.style.display="flex",Ze.style.alignItems="center",Ze.className="signature-box";const Je=document.createElement("span");Je.textContent=Ke+"：",Je.style.marginRight="5px",Ze.appendChild(Je);const Ye=document.createElement("span");Ye.innerHTML="&nbsp;",Ye.style.flexGrow="1",Ye.style.borderBottom="1px solid #000",Ye.style.marginLeft="5px",Ye.style.marginRight="5px",Ye.style.height="20px",Ze.appendChild(Ye),ve.appendChild(Ze)}),$e.appendChild(ve),De.appendChild($e),te.appendChild(De),U.appendChild(te),R.appendChild(U);const q=document.createElement("div");q.style.marginBottom="20px";const S=document.createElement("h3");S.textContent="二、查核內容",S.style.fontWeight="bold",S.style.marginBottom="10px",q.appendChild(S);const Y=document.createElement("table");Y.style.width="100%",Y.style.borderCollapse="collapse",Y.style.border="1px solid #000";const fe=document.createElement("thead"),le=document.createElement("tr");le.style.border="1px solid #000";const Q=["查核項目","查核結果","佐證資料或說明原因"],se=["50%","30%","20%"];Q.forEach((Ke,Ze)=>{const Je=document.createElement("th");Je.textContent=Ke,Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.textAlign="center",Je.style.backgroundColor="#f2f2f2",Je.style.width=se[Ze],le.appendChild(Je)}),fe.appendChild(le),Y.appendChild(fe);const ie=document.createElement("tbody");[{id:1,title:"1、課程師資實施狀況（實地40%/線上20%）"},{id:2,title:"2、人力安排情形（實地15%/線上30%）"},{id:3,title:"3、環境設備實施狀況（實地20%/線上30%）"},{id:4,title:"4、課程實施情形（實地25%/線上20%）"}].forEach(Ke=>{const Ze=document.createElement("tr");Ze.style.border="1px solid #000";const Je=document.createElement("td");Je.setAttribute("colspan","3"),Je.textContent=Ke.title,Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.fontWeight="bold",Ze.appendChild(Je),ie.appendChild(Ze),b(Ke.id).forEach(Xe=>{const Ge=document.createElement("tr");Ge.style.border="1px solid #000";const dt=document.createElement("td");dt.textContent=$.value.questions[Xe],dt.style.border="1px solid #000",dt.style.padding="8px",dt.style.paddingLeft="25px",Ge.appendChild(dt);const Zt=L(Xe);Ge.appendChild(Zt);const Ft=j(Xe);Ge.appendChild(Ft),ie.appendChild(Ge)})});const ae=document.createElement("tr");ae.style.border="1px solid #000";const ce=document.createElement("td");ce.setAttribute("colspan","3");const Ie=document.createElement("div");Ie.style.marginBottom="5px",Ie.style.padding="8px",Ie.style.fontWeight="bold",Ie.style.display="flex",Ie.style.alignItems="center",Ie.style.flexWrap="wrap";const Be=document.createElement("span");Be.textContent="5、",Ie.appendChild(Be);const me=document.createElement("span");me.style.position="relative",me.style.display="inline-block",me.style.minWidth="25px",me.style.textAlign="center",me.style.margin="0 5px";const pe=document.createElement("span");pe.textContent=$.value.passCount!==null&&$.value.passCount!==void 0?$.value.passCount:"",me.appendChild(pe);const we=document.createElement("div");we.style.position="absolute",we.style.bottom="-2px",we.style.left="0",we.style.width="100%",we.style.height="1px",we.style.backgroundColor="#000",me.appendChild(we),Ie.appendChild(me);const He=document.createElement("span");He.textContent=" 個項目符合、",Ie.appendChild(He);const ge=document.createElement("span");ge.style.position="relative",ge.style.display="inline-block",ge.style.minWidth="25px",ge.style.textAlign="center",ge.style.margin="0 5px";const H=document.createElement("span");H.textContent=$.value.failCount!==null&&$.value.failCount!==void 0?$.value.failCount:"",ge.appendChild(H);const i=document.createElement("div");i.style.position="absolute",i.style.bottom="-2px",i.style.left="0",i.style.width="100%",i.style.height="1px",i.style.backgroundColor="#000",ge.appendChild(i),Ie.appendChild(ge);const n=document.createElement("span");n.textContent=" 個項目不符合。",Ie.appendChild(n),ce.appendChild(Ie);const h=document.createElement("div");h.style.display="flex",h.style.alignItems="center",h.style.padding="0 8px 8px 8px";const be=document.createElement("div");be.style.display="flex",be.style.alignItems="center";const _e=document.createElement("span");_e.textContent="得分：",_e.style.marginRight="5px",_e.style.fontWeight="bold",be.appendChild(_e);const Ve=document.createElement("div");Ve.style.display="inline-block",Ve.style.position="relative",Ve.style.minWidth="40px";const st=document.createElement("span");st.textContent=$.value.totalScore||"",st.style.display="inline-block",st.style.minWidth="40px",st.style.textAlign="center",Ve.appendChild(st);const it=document.createElement("div");it.style.position="absolute",it.style.bottom="-2px",it.style.left="0",it.style.width="100%",it.style.height="1px",it.style.backgroundColor="#000",Ve.appendChild(it),be.appendChild(Ve),h.appendChild(be);const ut=document.createElement("div");ut.style.display="flex",ut.style.marginLeft="40px",ut.style.alignItems="center";const ht=document.createElement("div");ht.style.display="flex",ht.style.alignItems="center",ht.style.marginRight="20px";const qe=document.createElement("div");qe.style.width="16px",qe.style.height="16px",qe.style.border="2px solid #000",qe.style.marginRight="5px",qe.style.display="inline-block",$.value.hasPass===!0&&(qe.style.backgroundColor="#000",qe.style.color="#fff",qe.innerHTML="&#10003;",qe.style.lineHeight="15px",qe.style.textAlign="center",qe.style.fontWeight="bold"),ht.appendChild(qe),ht.appendChild(document.createTextNode("通過"));const gt=document.createElement("div");gt.style.display="flex",gt.style.alignItems="center";const vt=document.createElement("div");vt.style.width="16px",vt.style.height="16px",vt.style.border="2px solid #000",vt.style.marginRight="5px",vt.style.display="inline-block",$.value.hasPass===!1&&(vt.style.backgroundColor="#000",vt.style.color="#fff",vt.innerHTML="&#10003;",vt.style.lineHeight="15px",vt.style.textAlign="center",vt.style.fontWeight="bold"),gt.appendChild(vt),gt.appendChild(document.createTextNode("不通過")),ut.appendChild(ht),ut.appendChild(gt),h.appendChild(ut),ce.appendChild(h),ae.appendChild(ce),ie.appendChild(ae),Y.appendChild(ie),q.appendChild(Y),R.appendChild(q);const Pt=document.createElement("div");Pt.textContent="備註：說明原因應清楚描述，避免不確定的文字：如可能...。",Pt.style.padding="2px 0px",Pt.style.color="black",Pt.style.fontSize="16px",Pt.style.lineHeight="1",Pt.style.fontFamily="Arial, sans-serif",R.appendChild(Pt);const wt=document.createElement("table");wt.style.width="100%",wt.style.border="none",wt.style.borderCollapse="collapse",wt.style.margin="0",wt.style.padding="0";const It=document.createElement("tr"),Ct=document.createElement("td");Ct.style.height="0px",Ct.style.border="none",Ct.innerHTML="&nbsp;",It.appendChild(Ct),wt.appendChild(It),R.appendChild(wt);const ts=document.createElement("div");ts.style.marginBottom="10px";const Mt=document.createElement("table");Mt.style.width="100%",Mt.style.borderCollapse="collapse",Mt.style.border="1px solid #000";const Et=document.createElement("tr");Et.style.border="1px solid #000";const Rt=document.createElement("td");Rt.setAttribute("colspan","2"),Rt.textContent="6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。",Rt.style.border="1px solid #000",Rt.style.padding="8px",Rt.style.fontWeight="bold",Rt.style.fontSize="15px",Rt.style.lineHeight="1.5",Et.appendChild(Rt),Mt.appendChild(Et);const Ut=document.createElement("tr");Ut.style.border="1px solid #000";const B=document.createElement("td");B.textContent=`改善方法
(學校承辦人員)`,B.style.border="1px solid #000",B.style.padding="8px",B.style.width="25%",B.style.textAlign="center",B.style.verticalAlign="middle",Ut.appendChild(B);const M=document.createElement("td");M.textContent=$.value.improvement||"",M.style.border="1px solid #000",M.style.padding="8px",M.style.width="75%",M.style.minHeight="200px",M.style.height="200px",Ut.appendChild(M),Mt.appendChild(Ut),ts.appendChild(Mt),R.appendChild(ts);const F=document.createElement("div");F.style.marginTop="20px";const ne=document.createElement("div");ne.style.display="flex",ne.style.alignItems="center",ne.style.marginBottom="10px";const Ae=document.createElement("h3");Ae.textContent="三、追蹤調查",Ae.style.fontWeight="bold",Ae.style.margin="0",Ae.style.padding="0",Ae.style.marginRight="20px",ne.appendChild(Ae);const Fe=document.createElement("div");Fe.style.display="flex",Fe.style.alignItems="center",Fe.style.marginRight="20px";const Te=document.createElement("div");Te.style.width="16px",Te.style.height="16px",Te.style.border="2px solid #000",Te.style.marginRight="5px",Te.style.display="inline-block",$.value.needFollowUp===!1&&(Te.style.backgroundColor="#000",Te.style.color="#fff",Te.innerHTML="&#10003;",Te.style.lineHeight="15px",Te.style.textAlign="center",Te.style.fontWeight="bold"),Fe.appendChild(Te),Fe.appendChild(document.createTextNode("不須追蹤")),ne.appendChild(Fe);const nt=document.createElement("div");nt.style.display="flex",nt.style.alignItems="center";const Oe=document.createElement("div");if(Oe.style.width="16px",Oe.style.height="16px",Oe.style.border="2px solid #000",Oe.style.marginRight="5px",Oe.style.display="inline-block",$.value.needFollowUp===!0&&(Oe.style.backgroundColor="#000",Oe.style.color="#fff",Oe.innerHTML="&#10003;",Oe.style.lineHeight="15px",Oe.style.textAlign="center",Oe.style.fontWeight="bold"),nt.appendChild(Oe),nt.appendChild(document.createTextNode("需複查：")),$.value.needFollowUp===!0&&$.value.recheckRemark){nt.style.display="flex",nt.style.flexWrap="wrap",nt.style.alignItems="center";const Ke=document.createElement("span");Ke.textContent=$.value.recheckRemark,Ke.style.marginLeft="5px",Ke.style.borderBottom="1px solid #000",Ke.style.display="inline-block",Ke.style.maxWidth="150px",Ke.style.wordBreak="break-all",Ke.style.whiteSpace="normal",nt.appendChild(Ke)}else{nt.style.display="flex",nt.style.flexWrap="wrap",nt.style.alignItems="center";const Ke=document.createElement("span");Ke.textContent="          ",Ke.style.marginLeft="5px",Ke.style.borderBottom="1px solid #000",Ke.style.display="inline-block",Ke.style.maxWidth="150px",nt.appendChild(Ke)}ne.appendChild(nt),F.appendChild(ne);const kt=document.createElement("div");kt.style.marginTop="10px";const yt=document.createElement("p");yt.textContent="備註：考量改善方法實施完成的時間點，後續計畫做以下安排。",kt.appendChild(yt);const mt=document.createElement("p");mt.textContent="1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。",kt.appendChild(mt);const Lt=document.createElement("p");Lt.textContent="2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。",kt.appendChild(Lt),F.appendChild(kt),R.appendChild(F),R.style.position="absolute",R.style.left="-9999px",document.body.appendChild(R),setTimeout(()=>{if(te.rows&&te.rows.length>=3&&te.rows[2].cells.length>=4){const Ke=te.rows[2].cells[3];Ke.innerHTML="";const Ze=document.createElement("div");Ze.style.display="flex",Ze.style.flexDirection="column";const Je=document.createElement("div");Je.style.display="flex",Je.style.alignItems="center",Je.style.marginBottom="5px";const Ye=document.createElement("div");Ye.style.width="16px",Ye.style.height="16px",Ye.style.border="2px solid #000",Ye.style.marginRight="5px",Ye.style.display="inline-block",$.value.inspectionType==="onsite"&&(Ye.style.backgroundColor="#000",Ye.style.color="#fff",Ye.innerHTML="&#10003;",Ye.style.lineHeight="15px",Ye.style.textAlign="center",Ye.style.fontWeight="bold"),Je.appendChild(Ye),Je.appendChild(document.createTextNode("實地訪查"));const Xe=document.createElement("div");Xe.style.display="flex",Xe.style.alignItems="center";const Ge=document.createElement("div");if(Ge.style.width="16px",Ge.style.height="16px",Ge.style.border="2px solid #000",Ge.style.marginRight="5px",Ge.style.display="inline-block",$.value.inspectionType==="online"&&(Ge.style.backgroundColor="#000",Ge.style.color="#fff",Ge.innerHTML="&#10003;",Ge.style.lineHeight="15px",Ge.style.textAlign="center",Ge.style.fontWeight="bold"),Xe.appendChild(Ge),Xe.appendChild(document.createTextNode("線上訪查：")),$.value.inspectionType==="online"&&$.value.onlineRemark){Xe.style.display="flex",Xe.style.flexWrap="wrap",Xe.style.alignItems="center";const dt=document.createElement("span");dt.textContent=$.value.onlineRemark,dt.style.marginLeft="5px",dt.style.borderBottom="1px solid #000",dt.style.display="inline-block",dt.style.maxWidth="150px",dt.style.wordBreak="break-all",dt.style.whiteSpace="normal",Xe.appendChild(dt)}else{Xe.style.display="flex",Xe.style.flexWrap="wrap",Xe.style.alignItems="center";const dt=document.createElement("span");dt.textContent="          ",dt.style.marginLeft="5px",dt.style.borderBottom="1px solid #000",dt.style.display="inline-block",dt.style.maxWidth="150px",Xe.appendChild(dt)}Ze.appendChild(Je),Ze.appendChild(Xe),Ke.appendChild(Ze)}W(R,Ke=>{K.value=Ke})},100)}catch(R){console.error("匯出查核紀錄表失敗:",R),v.showError("匯出失敗",R.message||"匯出查核紀錄表失敗，請稍後再試"),K.value=!1;const U=document.querySelector('div[style*="-9999px"]');U&&U.parentNode&&U.parentNode.removeChild(U)}};Ee(()=>$.value.needFollowUp,R=>{R===!1&&($.value.recheckRemark="")}),Ee(()=>$.value.checkResults,R=>{_()},{deep:!0}),Ee(()=>$.value.inspectionType,(R,U)=>{_(),R==="onsite"?($.value.isOffline=!0,$.value.isOnline=!1):R==="online"?($.value.isOnline=!0,$.value.isOffline=!1):(R===""||R===null)&&($.value.isOffline=!1,$.value.isOnline=!1)}),Ee(()=>$.value.isOffline,R=>{R===!0?($.value.inspectionType="onsite",$.value.isOnline=!1):R===!1&&$.value.inspectionType==="onsite"&&($.value.inspectionType="")}),Ee(()=>$.value.isOnline,R=>{R===!0?($.value.inspectionType="online",$.value.isOffline=!1):R===!1&&$.value.inspectionType==="online"&&($.value.inspectionType="")});const _=()=>{let R=0,U=0,te=0;const ue=$.value.inspectionType==="onsite"?"3-3":"4-5",ye={1:{onsite:40,online:20},2:{onsite:15,online:30},3:{onsite:20,online:30},4:{onsite:25,online:20}};for(const ke of[1,2,3,4]){const $e=b(ke).filter(fe=>fe!==ue),ve=$e.length;if(ve===0)continue;const q=ye[ke][$.value.inspectionType==="onsite"?"onsite":"online"]/ve;let S=0;for(const fe of $e)$.value.checkResults[fe]===!0?(R++,S++):$.value.checkResults[fe]===!1&&U++;const Y=S*q;te+=Y}$.value.passCount=R,$.value.failCount=U,$.value.totalScore=Math.round(te),te>=70?$.value.hasPass=!0:te<70&&(R>0||U>0)&&($.value.hasPass=!1)},E=(R,U)=>{$.value.checkResults[R]===U?$.value.checkResults[R]=null:$.value.checkResults[R]=U,_()},L=R=>{const U=document.createElement("td");U.style.border="1px solid #000",U.style.padding="8px";const te=document.createElement("table");te.style.width="100%",te.style.border="none",te.style.borderCollapse="collapse",te.style.margin="0 auto";const ue=document.createElement("tr"),ye=($e,ve)=>{const oe=document.createElement("td");oe.style.border="none",oe.style.width="50%",oe.style.textAlign="center",oe.style.verticalAlign="middle";const q=document.createElement("div");q.style.display="inline-flex",q.style.alignItems="center",q.style.justifyContent="center";const S=document.createElement("div");return S.style.width="16px",S.style.height="16px",S.style.border="2px solid #000",S.style.marginRight="5px",S.style.display="inline-block",$e&&(S.style.backgroundColor="#000",S.style.color="#fff",S.innerHTML="&#10003;",S.style.lineHeight="15px",S.style.textAlign="center",S.style.fontWeight="bold"),q.appendChild(S),q.appendChild(document.createTextNode(ve)),oe.appendChild(q),oe},ke=ye($.value.checkResults[R]===!0,"符合");ue.appendChild(ke);const De=ye($.value.checkResults[R]===!1,"不符合");return ue.appendChild(De),te.appendChild(ue),U.appendChild(te),U},j=R=>{const U=document.createElement("td");U.style.border="1px solid #000",U.style.padding="8px";const te=(ue,ye,ke)=>{const De=document.createElement("div");De.style.display="flex",De.style.alignItems="center",De.style.marginBottom=ke?"5px":"0";const $e=document.createElement("div");if($e.style.width="16px",$e.style.height="16px",$e.style.border="2px solid #000",$e.style.marginRight="5px",$e.style.display="inline-block",ue&&($e.style.backgroundColor="#000",$e.style.color="#fff",$e.innerHTML="&#10003;",$e.style.lineHeight="15px",$e.style.textAlign="center",$e.style.fontWeight="bold"),De.appendChild($e),De.appendChild(document.createTextNode(ye)),U.appendChild(De),ke){const ve=document.createElement("span");ve.textContent=ke,U.appendChild(ve)}};return R==="3-3"?te($.value.isOffline,"實體課程",$.value.evidence[R]):R==="4-5"?te($.value.isOnline,"線上課程",$.value.evidence[R]):U.textContent=$.value.evidence[R]||"",U};return(R,U)=>(t(),s("div",xh,[e("div",hh,[Qe(pt,{breadcrumbs:[{name:"訪視督課",path:"/supervision"},{name:"新增查核紀錄表",path:"/checklist"}]})]),U[68]||(U[68]=e("div",{class:"w-full max-w-[1500px] flex justify-center mt-6 mb-2"},[e("h1",{class:"text-2xl font-bold text-center"},"教學查核紀錄表")],-1)),e("div",wh,[e("div",_h,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:O,disabled:K.value},l(K.value?"匯出中...":"匯出 PDF"),9,kh),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:P}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:G,disabled:N.value},l(N.value?"儲存中...":"儲存"),9,$h)])]),U[69]||(U[69]=e("div",{class:"w-full max-w-[1500px] mb-2"},[e("h2",{class:"text-lg font-bold"},"一、訪查學校、時間及參與人員")],-1)),e("div",Ch,[e("div",null,[e("table",Eh,[e("thead",null,[e("tr",null,[U[26]||(U[26]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 訪查學校 ",-1)),e("td",Sh,[I(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":U[0]||(U[0]=te=>$.value.school=te),disabled:C.value},[e("option",Mh,l(C.value?"載入中...":"請選擇學校"),1),(t(!0),s(Z,null,re(d.value,te=>(t(),s("option",{key:te.value,value:te.value},l(te.label),9,Ah))),128))],8,Dh),[[Pe,$.value.school]])]),U[27]||(U[27]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 課程名稱 ",-1)),e("td",Ih,[I(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":U[1]||(U[1]=te=>$.value.courseName=te),disabled:!$.value.school||o.value},[e("option",Ph,l($.value.school?o.value?"載入中...":"請選擇課程":"請先選擇學校"),1),(t(!0),s(Z,null,re(u.value,te=>(t(),s("option",{key:te.value,value:te.value},l(te.label),9,Uh))),128))],8,Rh),[[Pe,$.value.courseName]])])])]),e("tbody",null,[e("tr",null,[U[28]||(U[28]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 授課時間 ",-1)),e("td",Nh,[I(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":U[2]||(U[2]=te=>$.value.courseDate=te),placeholder:"尚未選擇課程",disabled:""},null,512),[[ee,$.value.courseDate]])])]),e("tr",null,[U[37]||(U[37]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"},[xe(" 訪查時間"),e("br"),xe("(24 時制) ")],-1)),e("td",Th,[e("div",Vh,[e("div",jh,[I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[3]||(U[3]=te=>$.value.year=te)},null,512),[[ee,$.value.year]]),U[29]||(U[29]=e("span",{class:"mx-1"},"年",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[4]||(U[4]=te=>$.value.month=te)},null,512),[[ee,$.value.month]]),U[30]||(U[30]=e("span",{class:"mx-1"},"月",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[5]||(U[5]=te=>$.value.day=te)},null,512),[[ee,$.value.day]]),U[31]||(U[31]=e("span",{class:"mx-1"},"日",-1))]),e("div",Lh,[I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[6]||(U[6]=te=>$.value.startHour=te)},null,512),[[ee,$.value.startHour]]),U[32]||(U[32]=e("span",{class:"mx-1"},":",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[7]||(U[7]=te=>$.value.startMinute=te)},null,512),[[ee,$.value.startMinute]]),U[33]||(U[33]=e("span",{class:"mx-2"},"~",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[8]||(U[8]=te=>$.value.endHour=te)},null,512),[[ee,$.value.endHour]]),U[34]||(U[34]=e("span",{class:"mx-1"},":",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":U[9]||(U[9]=te=>$.value.endMinute=te)},null,512),[[ee,$.value.endMinute]])])])]),U[38]||(U[38]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查方式 ",-1)),e("td",Fh,[e("div",qh,[e("div",Oh,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:$.value.inspectionType==="onsite",onChange:U[10]||(U[10]=te=>$.value.inspectionType=$.value.inspectionType==="onsite"?"":"onsite")},null,40,Bh),U[35]||(U[35]=e("span",null,"實地訪查",-1))]),e("div",Hh,[e("div",Wh,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:$.value.inspectionType==="online",onChange:U[11]||(U[11]=te=>$.value.inspectionType=$.value.inspectionType==="online"?"":"online")},null,40,zh),U[36]||(U[36]=e("span",null,"線上訪查：",-1))]),e("div",Kh,[I(e("input",{type:"text",class:"border-b border-black p-1 w-full","onUpdate:modelValue":U[12]||(U[12]=te=>$.value.onlineRemark=te),placeholder:"請輸入...",style:{"max-width":"150px","word-break":"break-all","white-space":"normal","vertical-align":"bottom"}},null,512),[[ee,$.value.onlineRemark]])])])])])]),e("tr",null,[U[39]||(U[39]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 聯絡人 ",-1)),e("td",Jh,[I(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":U[13]||(U[13]=te=>$.value.interviewee=te),placeholder:"請輸入聯絡人姓名..."},null,512),[[ee,$.value.interviewee]])]),U[40]||(U[40]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查人員 ",-1)),e("td",Yh,[I(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":U[14]||(U[14]=te=>$.value.inspectors=te),placeholder:"請輸入訪查人員姓名..."},null,512),[[ee,$.value.inspectors]])])])])])])]),U[70]||(U[70]=e("div",{class:"w-full max-w-[1500px] mt-6 mb-2"},[e("h2",{class:"text-lg font-bold"},"二、查核內容")],-1)),e("div",Gh,[e("table",Qh,[U[61]||(U[61]=e("thead",null,[e("tr",null,[e("th",{class:"border-r border-b-2 border-black p-4 w-[55%] font-bold text-center"},"查核項目"),e("th",{class:"border-r border-b-2 border-black p-4 w-[25%] font-bold text-center"},"查核結果"),e("th",{class:"border-b-2 border-black p-4 w-[20%] font-bold text-center"},[xe("佐證資料或"),e("br"),xe("說明原因")])])],-1)),e("tbody",null,[U[51]||(U[51]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"1、課程師資實施狀況（實地40%/線上20%）")])])],-1)),(t(!0),s(Z,null,re(b(1),te=>(t(),s("tr",{key:te,class:"border-b-2 border-black"},[e("td",Zh,[e("div",Xh,[e("span",null,l($.value.questions[te]),1)])]),e("td",ew,[e("div",tw,[e("div",sw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!0,onChange:ue=>E(te,!0)},null,40,aw),U[41]||(U[41]=e("span",null,"符合",-1))]),e("div",ow,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!1,onChange:ue=>E(te,!1)},null,40,lw),U[42]||(U[42]=e("span",null,"不符合",-1))])])]),e("td",nw,[I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ue=>$.value.evidence[te]=ue,placeholder:"請輸入佐證資料..."},null,8,rw),[[ee,$.value.evidence[te]]])])]))),128)),U[52]||(U[52]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"2、人力安排情形（實地15%/線上30%）")])])],-1)),(t(!0),s(Z,null,re(b(2),te=>(t(),s("tr",{key:te,class:"border-b-2 border-black"},[e("td",iw,[e("div",dw,[e("span",null,l($.value.questions[te]),1)])]),e("td",uw,[e("div",cw,[e("div",pw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!0,onChange:ue=>E(te,!0)},null,40,vw),U[43]||(U[43]=e("span",null,"符合",-1))]),e("div",mw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!1,onChange:ue=>E(te,!1)},null,40,bw),U[44]||(U[44]=e("span",null,"不符合",-1))])])]),e("td",fw,[I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ue=>$.value.evidence[te]=ue,placeholder:"請輸入佐證資料..."},null,8,yw),[[ee,$.value.evidence[te]]])])]))),128)),U[53]||(U[53]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"3、環境設備實施狀況（實地20%/線上30%）")])])],-1)),(t(!0),s(Z,null,re(b(3),te=>(t(),s("tr",{key:te,class:"border-b-2 border-black"},[e("td",gw,[e("div",xw,[e("span",null,l($.value.questions[te]),1)])]),e("td",hw,[e("div",ww,[e("div",_w,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!0,onChange:ue=>E(te,!0)},null,40,kw),U[45]||(U[45]=e("span",null,"符合",-1))]),e("div",$w,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!1,onChange:ue=>E(te,!1)},null,40,Cw),U[46]||(U[46]=e("span",null,"不符合",-1))])])]),e("td",Ew,[te==="3-3"?(t(),s("div",Sw,[I(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":U[15]||(U[15]=ue=>$.value.isOffline=ue),id:"isOffline"},null,512),[[Ce,$.value.isOffline]]),U[47]||(U[47]=e("label",{for:"isOffline",class:"cursor-pointer"},"實體課程",-1))])):J("",!0),I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ue=>$.value.evidence[te]=ue,placeholder:"請輸入佐證資料..."},null,8,Dw),[[ee,$.value.evidence[te]]])])]))),128)),U[54]||(U[54]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"4、課程實施情形（實地25%/線上20%）")])])],-1)),(t(!0),s(Z,null,re(b(4),te=>(t(),s("tr",{key:te,class:"border-b-2 border-black"},[e("td",Mw,[e("div",Aw,[e("span",null,l($.value.questions[te]),1)])]),e("td",Iw,[e("div",Rw,[e("div",Pw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!0,onChange:ue=>E(te,!0)},null,40,Uw),U[48]||(U[48]=e("span",null,"符合",-1))]),e("div",Nw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.checkResults[te]===!1,onChange:ue=>E(te,!1)},null,40,Tw),U[49]||(U[49]=e("span",null,"不符合",-1))])])]),e("td",Vw,[te==="4-5"?(t(),s("div",jw,[I(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":U[16]||(U[16]=ue=>$.value.isOnline=ue),id:"isOnline"},null,512),[[Ce,$.value.isOnline]]),U[50]||(U[50]=e("label",{for:"isOnline",class:"cursor-pointer"},"線上課程",-1))])):J("",!0),I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ue=>$.value.evidence[te]=ue,placeholder:"請輸入佐證資料..."},null,8,Lw),[[ee,$.value.evidence[te]]])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Fw,[U[60]||(U[60]=e("div",{class:"flex items-center font-bold"},"5、查核結果摘要：",-1)),e("div",qw,[I(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":U[17]||(U[17]=te=>$.value.passCount=te)},null,512),[[ee,$.value.passCount]]),U[55]||(U[55]=e("span",{class:"mr-2"},"個項目符合、",-1)),I(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":U[18]||(U[18]=te=>$.value.failCount=te)},null,512),[[ee,$.value.failCount]]),U[56]||(U[56]=e("span",null,"個項目不符合。",-1))]),e("div",Ow,[U[59]||(U[59]=e("span",{class:"font-bold mr-2"},"得分：",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center mr-6","onUpdate:modelValue":U[19]||(U[19]=te=>$.value.totalScore=te)},null,512),[[ee,$.value.totalScore]]),e("div",Bw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.hasPass===!0,onChange:U[20]||(U[20]=te=>$.value.hasPass=$.value.hasPass===!0?null:!0)},null,40,Hw),U[57]||(U[57]=e("span",null,"通過",-1))]),e("div",Ww,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.hasPass===!1,onChange:U[21]||(U[21]=te=>$.value.hasPass=$.value.hasPass===!1?null:!1)},null,40,zw),U[58]||(U[58]=e("span",null,"不通過",-1))])])])])])])]),U[71]||(U[71]=e("div",{class:"w-full max-w-[1500px] mt-6"},[e("p",{class:"text-gray-700 mb-2"},"備註：說明原因應清楚描述，避免不確定的文字：如可能...。")],-1)),e("div",Kw,[e("table",Jw,[U[63]||(U[63]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"border-b-2 border-black p-4 text-left font-bold",colspan:"2"}," 6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。 ")])],-1)),e("tbody",null,[e("tr",null,[U[62]||(U[62]=e("th",{scope:"row",class:"border-r-2 border-black p-4 w-1/4"},[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"text-center font-bold"},"改善方法"),e("div",{class:"text-center"},"(學校承辦人員)")])],-1)),e("td",Yw,[I(e("textarea",{class:"w-full h-64 border border-gray-300 p-2 outline-none resize-none","onUpdate:modelValue":U[22]||(U[22]=te=>$.value.improvement=te),placeholder:"請輸入改善方法..."},null,512),[[ee,$.value.improvement]])])])])])]),e("div",Gw,[e("div",Qw,[U[66]||(U[66]=e("span",{class:"font-bold mr-2"},"三、追蹤調查",-1)),e("div",Zw,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.needFollowUp===!1,onChange:U[23]||(U[23]=te=>$.value.needFollowUp=$.value.needFollowUp===!1?null:!1),id:"needFollowUp"},null,40,Xw),U[64]||(U[64]=e("label",{for:"needFollowUp",class:"cursor-pointer"},"不須追蹤",-1))]),e("div",e_,[e("div",t_,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:$.value.needFollowUp===!0,onChange:U[24]||(U[24]=te=>$.value.needFollowUp=$.value.needFollowUp===!0?null:!0),id:"needRecheck"},null,40,s_),U[65]||(U[65]=e("label",{for:"needRecheck",class:"cursor-pointer"},"需複查：",-1))]),I(e("input",{type:"text",class:"border-b border-black ml-2 p-1","onUpdate:modelValue":U[25]||(U[25]=te=>$.value.recheckRemark=te),placeholder:"請輸入複查備註...",style:{"min-width":"120px","max-width":"150px",flex:"1","word-break":"break-all","white-space":"normal"},disabled:$.value.needFollowUp!==!0},null,8,a_),[[ee,$.value.recheckRemark]])])]),U[67]||(U[67]=e("div",{class:"mt-2"},[e("p",null,"備註：考量改善方法實施完成的時間點，後續計畫做以下安排。"),e("p",{class:"mt-2"},"1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。"),e("p",{class:"mt-2"},"2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。")],-1))])]))}},l_=Le(o_,[["__scopeId","data-v-aea238c2"]]),n_={class:"flex flex-col items-center p-6"},r_={class:"w-full max-w-[1500px]"},i_={class:"w-full max-w-[1500px] flex justify-end mb-2"},d_={class:"space-x-4"},u_=["disabled"],c_=["disabled"],p_={class:"w-full max-w-[1500px] border-2 border-black"},v_={class:"w-full border-collapse"},m_={class:"border-r border-black p-4 w-1/4"},b_=["disabled"],f_={value:""},y_=["value"],g_={class:"p-4 w-1/4"},x_=["disabled"],h_={value:""},w_=["value"],__={class:"border-t-2 border-black p-4",colspan:"3"},k_={class:"w-full p-2 bg-gray-100 rounded border border-gray-300"},$_={class:"border-r border-t-2 border-black p-4",colspan:"1"},C_={class:"flex flex-col items-center"},E_={class:"flex items-center mb-3"},S_=["readonly"],D_=["readonly"],M_=["readonly"],A_={class:"flex items-center"},I_=["readonly"],R_=["readonly"],P_=["readonly"],U_=["readonly"],N_={class:"border-t-2 border-black p-4"},T_={class:"flex flex-col items-start"},V_={class:"flex items-center mb-2"},j_=["checked","disabled"],L_={class:"flex items-center flex-wrap"},F_={class:"flex items-center mr-2"},q_=["checked","disabled"],O_={class:"flex-1 min-w-[120px]"},B_=["readonly"],H_={class:"border-t-2 border-r border-black p-4",colspan:"1"},W_=["readonly"],z_={class:"border-t-2 border-black p-4",colspan:"1"},K_=["readonly"],J_={class:"w-full max-w-[1500px] border-2 border-black"},Y_={class:"w-full border-collapse"},G_={class:"border-r border-black p-4 pl-8"},Q_={class:"flex items-center"},Z_={class:"border-r border-black p-4"},X_={class:"flex justify-around"},ek={class:"flex items-center"},tk=["checked","onChange","disabled"],sk={class:"flex items-center"},ak=["checked","onChange","disabled"],ok={class:"border-black p-4"},lk=["onUpdate:modelValue","readonly"],nk={class:"border-r border-black p-4 pl-8"},rk={class:"flex items-center"},ik={class:"border-r border-black p-4"},dk={class:"flex justify-around"},uk={class:"flex items-center"},ck=["checked","onChange","disabled"],pk={class:"flex items-center"},vk=["checked","onChange","disabled"],mk={class:"border-black p-4"},bk=["onUpdate:modelValue","readonly"],fk={class:"border-r border-black p-4 pl-8"},yk={class:"flex items-center"},gk={class:"border-r border-black p-4"},xk={class:"flex justify-around"},hk={class:"flex items-center"},wk=["checked","onChange","disabled"],_k={class:"flex items-center"},kk=["checked","onChange","disabled"],$k={class:"border-black p-4"},Ck={key:0,class:"flex items-center mb-2"},Ek=["disabled"],Sk=["onUpdate:modelValue","readonly"],Dk={class:"border-r border-black p-4 pl-8"},Mk={class:"flex items-center"},Ak={class:"border-r border-black p-4"},Ik={class:"flex justify-around"},Rk={class:"flex items-center"},Pk=["checked","onChange","disabled"],Uk={class:"flex items-center"},Nk=["checked","onChange","disabled"],Tk={class:"border-black p-4"},Vk={key:0,class:"flex items-center mb-2"},jk=["disabled"],Lk=["onUpdate:modelValue","readonly"],Fk={class:"border-t-2 border-black p-4",colspan:"3"},qk={class:"flex items-center mt-2"},Ok={class:"flex items-center mt-4"},Bk={class:"flex items-center mr-6"},Hk=["checked","disabled"],Wk={class:"flex items-center"},zk=["checked","disabled"],Kk={class:"w-full max-w-[1500px] border-2 border-black mt-6"},Jk={class:"w-full border-collapse"},Yk={class:"p-4 w-3/4"},Gk=["readonly"],Qk={class:"w-full max-w-[1500px] mt-6"},Zk={class:"flex flex-wrap items-center"},Xk={class:"flex items-center ml-4"},e4=["checked","disabled"],t4={class:"flex items-center flex-wrap ml-6"},s4={class:"flex items-center mr-2"},a4=["checked","disabled"],o4=["readonly"],l4={__name:"ChecklistEdit",setup(D){const x=lt(),d=We(),u=m([]),C=m([]),o=m(!1),N=m(!1),K=m(!1),$=m(!1),P=m(x.query.id),T=m(!1),z=m({}),g=m(!1),a=m({school:"",courseName:"",courseDate:"",interviewee:"",year:"",month:"",day:"",startHour:"",startMinute:"",endHour:"",endMinute:"",inspectionType:"",inspectors:"",onlineRemark:"",passCount:0,failCount:0,totalScore:0,checkResults:{"1-1":null,"1-2":null,"2-1":null,"2-2":null,"2-3":null,"3-1":null,"3-2":null,"3-3":null,"4-1":null,"4-2":null,"4-3":null,"4-4":null,"4-5":null},evidence:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""},questions:{"1-1":"(1) 授課師資與計畫相符","1-2":"(2) 課程內容依課程表授課","2-1":"(1) 陪課人員協助課堂服務","2-2":"(2) 製作教學日誌","2-3":"(3) 進行問卷調查","3-1":"(1) 場地符合授課需求","3-2":"(2) 有相應軟硬體設備進行授課，確保授課內容清楚傳達於學員。","3-3":"(3) 有提供穩定的網路連線功能進行授課，且提供穩定音訊、麥克風、即時訊息功能服務。(限查核線上課程)","4-1":"(1) 學員依規定簽到退","4-2":"(2) 備註遲到、請假及曠課人員","4-3":"(3) 提供授課課程教材","4-4":"(4) 確實填寫教學日誌","4-5":"(5) 投保公共意外責任險(限查核實體課程)"},isOnline:null,isOffline:null,hasPass:null,improvement:"",needFollowUp:null,recheckRemark:"",percentages:{"1-1":"","1-2":"","2-1":"","2-2":"","2-3":"","3-1":"","3-2":"","3-3":"","4-1":"","4-2":"","4-3":"","4-4":"","4-5":""}}),A=le=>{a.value.school=le.school.toString(),a.value.courseName=le.course.toString(),a.value.inspectors=le.visitor,a.value.interviewee=le.interviewee||"",a.value.onlineRemark=le.onlineRemark||"",le.schoolName&&(a.value.schoolName=le.schoolName),le.courseName&&(a.value.courseNameText=le.courseName),a.value.courseDate=le.date||"",console.log("設置課程日期:",a.value.courseDate)},G=le=>{le.needFollowUp===!1?a.value.needFollowUp=!1:le.needFollowUp===!0?a.value.needFollowUp=!0:a.value.needFollowUp=null,a.value.recheckRemark=le.recheckRemark||"",a.value.passCount=le.totalMatchedItems||0,a.value.failCount=le.totalUnmatchedItems||0,a.value.inspectionType=le.visitMethod===1?"online":"onsite",a.value.totalScore=le.grade||0,a.value.hasPass=le.isPass!==void 0?le.isPass:null,a.value.improvement=le.improveRemark||""},k=le=>{if(le.visitDate){const Q=le.visitDate.split("/");Q.length===3&&(a.value.year=Q[0],a.value.month=Q[1],a.value.day=Q[2])}if(le.visitStartTime){const Q=le.visitStartTime.split(":");Q.length===2&&(a.value.startHour=Q[0],a.value.startMinute=Q[1])}if(le.visitEndTime){const Q=le.visitEndTime.split(":");Q.length===2&&(a.value.endHour=Q[0],a.value.endMinute=Q[1])}},c=(le,Q)=>{const se=Q.question.match(/^\((\d+)\)/);if(!se||!se[1])return;const ie=se[1],de=`${le}-${ie}`;Q.score!==void 0&&(a.value.percentages[de]=Q.score),Q.ans!==void 0&&(a.value.checkResults[de]=Q.ans),Q.remark!==void 0&&(de==="4-5"&&Q.remark==="線上課程"?a.value.isOnline=!0:de==="3-3"&&Q.remark==="實體課程"?a.value.isOffline=!0:a.value.evidence[de]=Q.remark),Q.question&&(a.value.questions[de]=Q.question)},b=le=>{!le.content||!Array.isArray(le.content)||le.content.forEach(Q=>{if(!Q.details||!Array.isArray(Q.details))return;const se=Q.categoryId.toString();Q.details.forEach(ie=>{c(se,ie)})})},r=async()=>{var le;if(!P.value){T.value=!0;return}try{$.value=!0;const Q=await Ps.getVisitHistoryById(P.value);if(Q.data&&Q.data.code===0){const se=Q.data.data;A(se),G(se),k(se),b(se),z.value=JSON.parse(JSON.stringify(a.value))}else v.showError("載入失敗",((le=Q.data)==null?void 0:le.message)||"無法獲取訪視記錄")}catch(Q){console.error("獲取訪視記錄錯誤:",Q),v.showError("載入失敗","獲取訪視記錄時發生錯誤")}finally{$.value=!1}},f=()=>{const le={school:parseInt(a.value.school),course:parseInt(a.value.courseName),visitor:a.value.inspectors,visitDate:`${a.value.year}/${String(a.value.month).padStart(2,"0")}/${String(a.value.day).padStart(2,"0")}`,visitStartTime:`${String(a.value.startHour).padStart(2,"0")}:${String(a.value.startMinute).padStart(2,"0")}`,visitEndTime:`${String(a.value.endHour).padStart(2,"0")}:${String(a.value.endMinute).padStart(2,"0")}`,visitMethod:a.value.inspectionType==="online"?1:2,grade:a.value.totalScore?parseInt(a.value.totalScore):null,improveRemark:a.value.improvement||null,interviewee:a.value.interviewee||null,onlineRemark:a.value.inspectionType==="online"&&a.value.onlineRemark||null,needFollowUp:a.value.needFollowUp,recheckRemark:a.value.needFollowUp===!0&&a.value.recheckRemark||null,totalMatchedItems:a.value.passCount?parseInt(a.value.passCount):null,totalUnmatchedItems:a.value.failCount?parseInt(a.value.failCount):null,isOnline:a.value.isOnline||null,isOffline:a.value.isOffline||null,isPass:a.value.hasPass,content:[]};return[{id:1,name:"課程師資實施狀況"},{id:2,name:"人力安排情形"},{id:3,name:"環境設備實施狀況"},{id:4,name:"課程實施情形"}].forEach(Q=>{const se=R(Q.id);se.length>0&&le.content.push({categoryId:Q.id,categoryName:Q.name,details:se.map(ie=>ie==="3-3"?{question:a.value.questions[ie],score:a.value.percentages[ie]?parseInt(a.value.percentages[ie]):null,ans:a.value.checkResults[ie]===null?null:a.value.checkResults[ie]===!0,remark:a.value.evidence[ie]||null,isRemarkChecked:a.value.isOffline||!1}:ie==="4-5"?{question:a.value.questions[ie],score:a.value.percentages[ie]?parseInt(a.value.percentages[ie]):null,ans:a.value.checkResults[ie]===null?null:a.value.checkResults[ie]===!0,remark:a.value.evidence[ie]||null,isRemarkChecked:a.value.isOnline||!1}:{question:a.value.questions[ie],score:a.value.percentages[ie]?parseInt(a.value.percentages[ie]):null,ans:a.value.checkResults[ie]===null?null:a.value.checkResults[ie]===!0,remark:a.value.evidence[ie]||null})})}),P.value&&(le.id=parseInt(P.value)),le},p=()=>a.value.school?a.value.courseName?a.value.inspectionType?a.value.inspectionType==="online"&&!a.value.onlineRemark?(v.showError("儲存失敗","請填寫線上訪查備註"),!1):!0:(v.showError("儲存失敗","請選擇訪查方式"),!1):(v.showError("儲存失敗","請選擇課程名稱"),!1):(v.showError("儲存失敗","請選擇訪查學校"),!1),w=()=>a.value.inspectors?a.value.interviewee?!0:(v.showError("儲存失敗","請輸入聯絡人"),!1):(v.showError("儲存失敗","請輸入訪查人員"),!1),y=()=>{if(!a.value.year||!a.value.month||!a.value.day)return v.showError("儲存失敗","請填寫完整的訪查日期"),!1;const le=/^\d+$/,Q={"開始時間(時)":a.value.startHour,"開始時間(分)":a.value.startMinute,"結束時間(時)":a.value.endHour,"結束時間(分)":a.value.endMinute};for(const[se,ie]of Object.entries(Q)){if(!ie)return v.showError("儲存失敗",`請填寫${se}`),!1;if(!le.test(ie))return v.showError("儲存失敗",`${se}只能填寫數字`),!1}return!0},V=async le=>{let Q;return P.value?Q=await Ps.updateVisitHistory(P.value,le):Q=await Ps.createVisitHistory(le),Q},W=le=>{var Q;return le.data&&le.data.code===0?(v.showSuccess("儲存成功","訪視記錄已成功儲存"),T.value=!1,d.push("/supervision"),!0):(v.showError("儲存失敗",((Q=le.data)==null?void 0:Q.message)||"儲存訪視記錄時發生錯誤"),!1)},O=async()=>{if(!p()||!w()||!y())return;const le=f();console.log("準備提交訪視記錄:",le);try{K.value=!0;const Q=await V(le);W(Q)}catch(Q){console.error("儲存訪視記錄錯誤:",Q),v.showError("儲存失敗","儲存訪視記錄時發生錯誤，請稍後再試")}finally{K.value=!1}},_=async()=>{o.value=!0;try{const le=await ot.getSchoolOptions();le.data&&le.data.code===0&&Array.isArray(le.data.data)?u.value=le.data.data.map(Q=>({value:Q.id,label:Q.name})):(console.error("學校資料格式不正確:",le.data),u.value=[])}catch(le){console.error("獲取學校列表失敗:",le),u.value=[]}finally{o.value=!1}},E=async le=>{if(!le){C.value=[],a.value.courseName="",a.value.courseDate="";return}N.value=!0;try{const Q=await ot.getCourseData({school:le});Q.data&&Q.data.code===0&&Array.isArray(Q.data.data)?C.value=Q.data.data.map(se=>({value:se.id,label:se.name,date:se.date||""})):(console.error("課程資料格式不正確:",Q.data),C.value=[])}catch(Q){console.error("獲取課程列表失敗:",Q),a.value.courseName="",a.value.courseDate="",C.value=[]}finally{N.value=!1}};Ee(()=>a.value.school,le=>{le?E(le):C.value=[]}),Ee(()=>a.value.courseName,le=>{if(le){const Q=C.value.find(se=>se.value===le);Q&&(a.value.courseDate=Q.date||"")}else a.value.courseDate=""}),Ee(()=>a.value.needFollowUp,le=>{le===!1&&(a.value.recheckRemark="")});const L=async()=>{T.value?await v.confirmAsync("確認儲存","確定要儲存修改嗎？")&&O():(z.value=JSON.parse(JSON.stringify(a.value)),T.value=!0)},j=async()=>{await v.confirmAsync("確認離開","確定要離開頁面嗎？所有未儲存的修改將會遺失。")&&d.back()},R=le=>{const Q=`${le}-`;return Object.keys(a.value.questions).filter(ie=>ie.startsWith(Q)).sort((ie,de)=>{const ae=parseInt(ie.split("-")[1]),ce=parseInt(de.split("-")[1]);return ae-ce})},U=()=>{const le=document.createElement("div");return le.style.width="100%",le.style.padding="20px",le},te=le=>{const Q=u.value.find(se=>se.value===le);return Q?Q.label:""},ue=le=>{const Q=C.value.find(se=>se.value===le);return Q?Q.label:""},ye=le=>{if(a.value.schoolName)return a.value.schoolName;for(const Q of u.value)if(Q.value.toString()===le.toString())return Q.label;return"請選擇學校"},ke=le=>{if(a.value.courseNameText)return a.value.courseNameText;for(const Q of C.value)if(Q.value.toString()===le.toString())return Q.label;return"請選擇課程"},De=()=>{let le=te(a.value.school);le||(le=ye(a.value.school));let Q=ue(a.value.courseName);return Q||(Q=ke(a.value.courseName)),{schoolName:le,courseName:Q}},$e=async()=>{try{g.value=!0;const le=U();(Ue=>{const Re=document.createElement("h2");Re.textContent="教學查核紀錄表",Re.style.textAlign="center",Re.style.marginBottom="20px",Re.style.fontFamily="Arial, sans-serif",Ue.appendChild(Re);const Me=document.createElement("h2");Me.textContent="113-116年推動政府資安人力職能轉換訓練服務",Me.style.textAlign="center",Me.style.marginBottom="20px",Me.style.fontFamily="Arial, sans-serif",Me.style.fontWeight="bold",Ue.insertBefore(Me,Re)})(le);const se=Ue=>{const Re=document.createElement("div");Re.style.marginBottom="20px";const Me=document.createElement("h3");return Me.textContent=Ue,Me.style.fontWeight="bold",Me.style.marginBottom="10px",Re.appendChild(Me),Re},ie=()=>{const Ue=document.createElement("table");return Ue.style.width="100%",Ue.style.borderCollapse="collapse",Ue.style.marginBottom="20px",Ue.style.border="1px solid #000",Ue},de=se("一、訪查學校、時間及參與人員"),ae=ie(),{schoolName:ce,courseName:Ie}=De();console.log("匯出PDF - 學校選項:",u.value),console.log("匯出PDF - 選中的學校ID:",a.value.school),console.log("匯出PDF - 選中的學校名稱:",ce),console.log("匯出PDF - 課程選項:",C.value),console.log("匯出PDF - 選中的課程ID:",a.value.courseName),console.log("匯出PDF - 選中的課程名稱:",Ie),console.log("匯出PDF - 最終使用的學校名稱:",ce),console.log("匯出PDF - 最終使用的課程名稱:",Ie),((Ue,Re)=>[{label1:"訪查學校",value1:Ue,label2:"課程名稱",value2:Re},{label1:"授課時間",value1:a.value.courseDate,label2:"",value2:"",colspan:!0},{label1:"訪查時間(24 時制)",value1:"",label2:"訪查方式",value2:"",needCustom:!0},{label1:"聯絡人",value1:a.value.interviewee,label2:"訪查人員",value2:a.value.inspectors}])(ce,Ie).forEach(Ue=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");if(Me.textContent=Ue.label1,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.fontWeight="bold",Me.style.width="20%",Me.style.textAlign="center",Re.appendChild(Me),Ue.colspan){const ze=document.createElement("td");ze.setAttribute("colspan","3"),ze.textContent=Ue.value1,ze.style.border="1px solid #000",ze.style.padding="8px",Re.appendChild(ze)}else if(Ue.needCustom&&Ue.label1==="訪查時間(24 時制)"){const ze=document.createElement("td");ze.style.border="1px solid #000",ze.style.padding="8px";const at=document.createElement("div");at.style.display="flex",at.style.flexDirection="column",at.style.alignItems="center";const et=document.createElement("div");et.style.display="flex",et.style.alignItems="center",et.style.marginBottom="8px";const rt=document.createElement("div");rt.style.display="inline-block",rt.style.position="relative",rt.style.marginRight="5px";const bt=document.createElement("span");bt.textContent=a.value.year||"",bt.style.display="inline-block",bt.style.minWidth="30px",bt.style.textAlign="center",rt.appendChild(bt);const Nt=document.createElement("div");Nt.style.position="absolute",Nt.style.bottom="-2px",Nt.style.left="0",Nt.style.width="100%",Nt.style.height="1px",Nt.style.backgroundColor="#000",rt.appendChild(Nt),et.appendChild(rt),et.appendChild(document.createTextNode(" 年 "));const qt=document.createElement("div");qt.style.display="inline-block",qt.style.position="relative",qt.style.marginRight="5px";const zt=document.createElement("span");zt.textContent=a.value.month||"",zt.style.display="inline-block",zt.style.minWidth="25px",zt.style.textAlign="center",qt.appendChild(zt);const Yt=document.createElement("div");Yt.style.position="absolute",Yt.style.bottom="-2px",Yt.style.left="0",Yt.style.width="100%",Yt.style.height="1px",Yt.style.backgroundColor="#000",qt.appendChild(Yt),et.appendChild(qt),et.appendChild(document.createTextNode(" 月 "));const xs=document.createElement("div");xs.style.display="inline-block",xs.style.position="relative";const hs=document.createElement("span");hs.textContent=a.value.day||"",hs.style.display="inline-block",hs.style.minWidth="25px",hs.style.textAlign="center",xs.appendChild(hs);const ds=document.createElement("div");ds.style.position="absolute",ds.style.bottom="-2px",ds.style.left="0",ds.style.width="100%",ds.style.height="1px",ds.style.backgroundColor="#000",xs.appendChild(ds),et.appendChild(xs),et.appendChild(document.createTextNode(" 日")),at.appendChild(et);const ss=document.createElement("div");ss.style.display="flex",ss.style.alignItems="center";const ws=document.createElement("div");ws.style.display="inline-block",ws.style.position="relative";const _s=document.createElement("span");_s.textContent=a.value.startHour||"",_s.style.display="inline-block",_s.style.minWidth="25px",_s.style.textAlign="center",ws.appendChild(_s);const us=document.createElement("div");us.style.position="absolute",us.style.bottom="-2px",us.style.left="0",us.style.width="100%",us.style.height="1px",us.style.backgroundColor="#000",ws.appendChild(us),ss.appendChild(ws),ss.appendChild(document.createTextNode(" : "));const bs=document.createElement("div");bs.style.display="inline-block",bs.style.position="relative",bs.style.marginRight="10px";const ks=document.createElement("span");ks.textContent=a.value.startMinute||"",ks.style.display="inline-block",ks.style.minWidth="25px",ks.style.textAlign="center",bs.appendChild(ks);const cs=document.createElement("div");cs.style.position="absolute",cs.style.bottom="-2px",cs.style.left="0",cs.style.width="100%",cs.style.height="1px",cs.style.backgroundColor="#000",bs.appendChild(cs),ss.appendChild(bs),ss.appendChild(document.createTextNode(" ~ "));const $s=document.createElement("div");$s.style.display="inline-block",$s.style.position="relative";const Cs=document.createElement("span");Cs.textContent=a.value.endHour||"",Cs.style.display="inline-block",Cs.style.minWidth="25px",Cs.style.textAlign="center",$s.appendChild(Cs);const ps=document.createElement("div");ps.style.position="absolute",ps.style.bottom="-2px",ps.style.left="0",ps.style.width="100%",ps.style.height="1px",ps.style.backgroundColor="#000",$s.appendChild(ps),ss.appendChild($s),ss.appendChild(document.createTextNode(" : "));const Es=document.createElement("div");Es.style.display="inline-block",Es.style.position="relative";const Ss=document.createElement("span");Ss.textContent=a.value.endMinute||"",Ss.style.display="inline-block",Ss.style.minWidth="25px",Ss.style.textAlign="center",Es.appendChild(Ss);const vs=document.createElement("div");vs.style.position="absolute",vs.style.bottom="-2px",vs.style.left="0",vs.style.width="100%",vs.style.height="1px",vs.style.backgroundColor="#000",Es.appendChild(vs),ss.appendChild(Es),at.appendChild(ss),ze.appendChild(at),Re.appendChild(ze);const ms=document.createElement("td");ms.textContent=Ue.label2,ms.style.border="1px solid #000",ms.style.padding="8px",ms.style.fontWeight="bold",ms.style.width="20%",ms.style.textAlign="center",Re.appendChild(ms);const Ds=document.createElement("td");Ds.style.border="1px solid #000",Ds.style.padding="8px",Ds.style.width="30%";const Ms=document.createElement("div");Ms.style.display="flex",Ms.style.flexDirection="column";const fs=document.createElement("div");fs.style.display="flex",fs.style.alignItems="center",fs.style.marginBottom="8px";const Gt=document.createElement("div");Gt.style.width="16px",Gt.style.height="16px",Gt.style.border="2px solid #000",Gt.style.marginRight="5px",Gt.style.display="inline-block",a.value.inspectionType==="onsite"&&(Gt.style.backgroundColor="#000",Gt.style.color="#fff",Gt.innerHTML="&#10003;",Gt.style.lineHeight="15px",Gt.style.textAlign="center",Gt.style.fontWeight="bold"),fs.appendChild(Gt),fs.appendChild(document.createTextNode("實地訪查"));const Kt=document.createElement("div");Kt.style.display="flex",Kt.style.alignItems="center";const Qt=document.createElement("div");if(Qt.style.width="16px",Qt.style.height="16px",Qt.style.border="2px solid #000",Qt.style.marginRight="5px",Qt.style.display="inline-block",a.value.inspectionType==="online"&&(Qt.style.backgroundColor="#000",Qt.style.color="#fff",Qt.innerHTML="&#10003;",Qt.style.lineHeight="15px",Qt.style.textAlign="center",Qt.style.fontWeight="bold"),Kt.appendChild(Qt),Kt.appendChild(document.createTextNode("線上訪查：")),a.value.inspectionType==="online"&&a.value.onlineRemark){Kt.style.display="flex",Kt.style.flexWrap="wrap",Kt.style.alignItems="center";const Tt=document.createElement("span");Tt.textContent=a.value.onlineRemark,Tt.style.marginLeft="5px",Tt.style.borderBottom="1px solid #000",Tt.style.display="inline-block",Tt.style.maxWidth="150px",Tt.style.wordBreak="break-all",Tt.style.whiteSpace="normal",Kt.appendChild(Tt)}else{Kt.style.display="flex",Kt.style.flexWrap="wrap",Kt.style.alignItems="center";const Tt=document.createElement("span");Tt.textContent="          ",Tt.style.marginLeft="5px",Tt.style.borderBottom="1px solid #000",Tt.style.display="inline-block",Tt.style.maxWidth="150px",Kt.appendChild(Tt)}Ms.appendChild(fs),Ms.appendChild(Kt),Ds.appendChild(Ms),Re.appendChild(Ds)}else{const ze=document.createElement("td");if(ze.textContent=Ue.value1,ze.style.border="1px solid #000",ze.style.padding="8px",ze.style.width="30%",Re.appendChild(ze),Ue.label2){const at=document.createElement("td");at.textContent=Ue.label2,at.style.border="1px solid #000",at.style.padding="8px",at.style.fontWeight="bold",at.style.width="20%",at.style.textAlign="center",Re.appendChild(at);const et=document.createElement("td");et.textContent=Ue.value2,et.style.border="1px solid #000",et.style.padding="8px",et.style.width="30%",Re.appendChild(et)}}ae.appendChild(Re)});const pe=Ue=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");Me.setAttribute("colspan","4"),Me.style.border="1px solid #000",Me.style.padding="30px";const ze=document.createElement("div");ze.style.display="flex",ze.style.justifyContent="space-between",ze.style.width="100%",ze.style.marginTop="10px",ze.style.marginBottom="10px",ze.className="signature-section",["承辦","科長","高級分析師","組長"].forEach(et=>{const rt=we(et);ze.appendChild(rt)}),Me.appendChild(ze),Re.appendChild(Me),Ue.appendChild(Re)},we=Ue=>{const Re=document.createElement("div");Re.style.fontSize="14px",Re.style.flex="1",Re.style.padding="10px 5px",Re.style.display="flex",Re.style.alignItems="center",Re.className="signature-box";const Me=document.createElement("span");Me.textContent=Ue+"：",Me.style.marginRight="5px",Re.appendChild(Me);const ze=document.createElement("span");return ze.innerHTML="&nbsp;",ze.style.flexGrow="1",ze.style.borderBottom="1px solid #000",ze.style.marginLeft="5px",ze.style.marginRight="5px",ze.style.height="20px",Re.appendChild(ze),Re};pe(ae),de.appendChild(ae),le.appendChild(de);const He=se("二、查核內容"),H=(()=>{const Ue=document.createElement("table");return Ue.style.width="100%",Ue.style.borderCollapse="collapse",Ue.style.border="1px solid #000",Ue})(),i=document.createElement("thead"),n=document.createElement("tr");n.style.border="1px solid #000";const h=["查核項目","查核結果","佐證資料或說明原因"],be=["50%","30%","20%"];h.forEach((Ue,Re)=>{const Me=document.createElement("th");Me.textContent=Ue,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.textAlign="center",Me.style.backgroundColor="#f2f2f2",Me.style.width=be[Re],n.appendChild(Me)}),i.appendChild(n),H.appendChild(i);const _e=document.createElement("tbody");[{id:1,title:"1、課程師資實施狀況（實地40%/線上20%）"},{id:2,title:"2、人力安排情形（實地15%/線上30%）"},{id:3,title:"3、環境設備實施狀況（實地20%/線上30%）"},{id:4,title:"4、課程實施情形（實地25%/線上20%）"}].forEach(Ue=>{const Re=document.createElement("tr");Re.style.border="1px solid #000";const Me=document.createElement("td");Me.setAttribute("colspan","3"),Me.textContent=Ue.title,Me.style.border="1px solid #000",Me.style.padding="8px",Me.style.fontWeight="bold",Re.appendChild(Me),_e.appendChild(Re),R(Ue.id).forEach(at=>{const et=document.createElement("tr");et.style.border="1px solid #000";const rt=document.createElement("td");rt.textContent=a.value.questions[at],rt.style.border="1px solid #000",rt.style.padding="8px",rt.style.paddingLeft="25px",et.appendChild(rt);const bt=Y(at);et.appendChild(bt);const Nt=fe(at);et.appendChild(Nt),_e.appendChild(et)})});const st=document.createElement("tr");st.style.border="1px solid #000";const it=document.createElement("td");it.setAttribute("colspan","3");const ut=document.createElement("div");ut.style.marginBottom="5px",ut.style.padding="8px",ut.style.fontWeight="bold",ut.style.display="flex",ut.style.alignItems="center",ut.style.flexWrap="wrap";const ht=document.createElement("span");ht.textContent="5、",ut.appendChild(ht);const qe=document.createElement("span");qe.style.position="relative",qe.style.display="inline-block",qe.style.minWidth="25px",qe.style.textAlign="center",qe.style.margin="0 5px";const gt=document.createElement("span");gt.textContent=a.value.passCount!==null&&a.value.passCount!==void 0?a.value.passCount:"",qe.appendChild(gt);const vt=document.createElement("div");vt.style.position="absolute",vt.style.bottom="-2px",vt.style.left="0",vt.style.width="100%",vt.style.height="1px",vt.style.backgroundColor="#000",qe.appendChild(vt),ut.appendChild(qe);const Pt=document.createElement("span");Pt.textContent=" 個項目符合、",ut.appendChild(Pt);const wt=document.createElement("span");wt.style.position="relative",wt.style.display="inline-block",wt.style.minWidth="25px",wt.style.textAlign="center",wt.style.margin="0 5px";const It=document.createElement("span");It.textContent=a.value.failCount!==null&&a.value.failCount!==void 0?a.value.failCount:"",wt.appendChild(It);const Ct=document.createElement("div");Ct.style.position="absolute",Ct.style.bottom="-2px",Ct.style.left="0",Ct.style.width="100%",Ct.style.height="1px",Ct.style.backgroundColor="#000",wt.appendChild(Ct),ut.appendChild(wt);const ts=document.createElement("span");ts.textContent=" 個項目不符合。",ut.appendChild(ts),it.appendChild(ut);const Mt=document.createElement("div");Mt.style.display="flex",Mt.style.alignItems="center",Mt.style.padding="0 8px 8px 8px";const Et=document.createElement("div");Et.style.display="flex",Et.style.alignItems="center";const Rt=document.createElement("span");Rt.textContent="得分：",Rt.style.marginRight="5px",Rt.style.fontWeight="bold",Et.appendChild(Rt);const Ut=document.createElement("div");Ut.style.display="inline-block",Ut.style.position="relative",Ut.style.minWidth="40px";const B=document.createElement("span");B.textContent=a.value.totalScore||"",B.style.display="inline-block",B.style.minWidth="40px",B.style.textAlign="center",Ut.appendChild(B);const M=document.createElement("div");M.style.position="absolute",M.style.bottom="-2px",M.style.left="0",M.style.width="100%",M.style.height="1px",M.style.backgroundColor="#000",Ut.appendChild(M),Et.appendChild(Ut),Mt.appendChild(Et);const F=document.createElement("div");F.style.display="flex",F.style.marginLeft="40px",F.style.alignItems="center";const ne=document.createElement("div");ne.style.display="flex",ne.style.alignItems="center",ne.style.marginRight="20px";const Ae=document.createElement("div");Ae.style.width="16px",Ae.style.height="16px",Ae.style.border="2px solid #000",Ae.style.marginRight="5px",Ae.style.display="inline-block",a.value.hasPass===!0&&(Ae.style.backgroundColor="#000",Ae.style.color="#fff",Ae.innerHTML="&#10003;",Ae.style.lineHeight="15px",Ae.style.textAlign="center",Ae.style.fontWeight="bold"),ne.appendChild(Ae),ne.appendChild(document.createTextNode("通過"));const Fe=document.createElement("div");Fe.style.display="flex",Fe.style.alignItems="center";const Te=document.createElement("div");Te.style.width="16px",Te.style.height="16px",Te.style.border="2px solid #000",Te.style.marginRight="5px",Te.style.display="inline-block",a.value.hasPass===!1&&(Te.style.backgroundColor="#000",Te.style.color="#fff",Te.innerHTML="&#10003;",Te.style.lineHeight="15px",Te.style.textAlign="center",Te.style.fontWeight="bold"),Fe.appendChild(Te),Fe.appendChild(document.createTextNode("不通過")),F.appendChild(ne),F.appendChild(Fe),Mt.appendChild(F),it.appendChild(Mt),st.appendChild(it),_e.appendChild(st),H.appendChild(_e),He.appendChild(H),le.appendChild(He),((Ue,Re)=>{const Me=document.createElement("div");Me.textContent=Re,Me.style.padding="2px 0px",Me.style.color="black",Me.style.fontSize="16px",Me.style.lineHeight="1",Me.style.fontFamily="Arial, sans-serif",Ue.appendChild(Me)})(le,"備註：說明原因應清楚描述，避免不確定的文字：如可能...。");const Oe=document.createElement("table");Oe.style.width="100%",Oe.style.border="none",Oe.style.borderCollapse="collapse",Oe.style.margin="0",Oe.style.padding="0";const kt=document.createElement("tr"),yt=document.createElement("td");yt.style.height="0px",yt.style.border="none",yt.innerHTML="&nbsp;",kt.appendChild(yt),Oe.appendChild(kt),le.appendChild(Oe);const mt=()=>{const Ue=document.createElement("div");Ue.style.marginBottom="10px";const Re=document.createElement("table");return Re.style.width="100%",Re.style.borderCollapse="collapse",Re.style.border="1px solid #000",{section:Ue,table:Re}},{section:Lt,table:Ke}=mt(),Ze=document.createElement("tr");Ze.style.border="1px solid #000";const Je=document.createElement("td");Je.setAttribute("colspan","2"),Je.textContent="6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。",Je.style.border="1px solid #000",Je.style.padding="8px",Je.style.fontWeight="bold",Je.style.fontSize="15px",Je.style.lineHeight="1.5",Ze.appendChild(Je),Ke.appendChild(Ze);const Ye=document.createElement("tr");Ye.style.border="1px solid #000";const Xe=document.createElement("td");Xe.textContent=`改善方法
(學校承辦人員)`,Xe.style.border="1px solid #000",Xe.style.padding="8px",Xe.style.width="25%",Xe.style.textAlign="center",Xe.style.verticalAlign="middle",Ye.appendChild(Xe);const Ge=document.createElement("td");Ge.textContent=a.value.improvement||"",Ge.style.border="1px solid #000",Ge.style.padding="8px",Ge.style.width="75%",Ge.style.minHeight="200px",Ge.style.height="200px",Ye.appendChild(Ge),Ke.appendChild(Ye),Lt.appendChild(Ke),le.appendChild(Lt);const dt=()=>{const Ue=document.createElement("div");Ue.style.marginTop="20px";const Re=document.createElement("div");return Re.style.display="flex",Re.style.alignItems="center",Re.style.marginBottom="10px",{section:Ue,header:Re}},{section:Zt,header:Ft}=dt(),Bt=document.createElement("h3");Bt.textContent="三、追蹤調查",Bt.style.fontWeight="bold",Bt.style.margin="0",Bt.style.padding="0",Bt.style.marginRight="20px",Ft.appendChild(Bt);const Jt=document.createElement("div");Jt.style.display="flex",Jt.style.alignItems="center",Jt.style.marginRight="20px";const $t=document.createElement("div");$t.style.width="16px",$t.style.height="16px",$t.style.border="2px solid #000",$t.style.marginRight="5px",$t.style.display="inline-block",a.value.needFollowUp===!1&&($t.style.backgroundColor="#000",$t.style.color="#fff",$t.innerHTML="&#10003;",$t.style.lineHeight="15px",$t.style.textAlign="center",$t.style.fontWeight="bold"),Jt.appendChild($t),Jt.appendChild(document.createTextNode("不須追蹤")),Ft.appendChild(Jt);const St=document.createElement("div");St.style.display="flex",St.style.alignItems="center";const At=document.createElement("div");if(At.style.width="16px",At.style.height="16px",At.style.border="2px solid #000",At.style.marginRight="5px",At.style.display="inline-block",a.value.needFollowUp===!0&&(At.style.backgroundColor="#000",At.style.color="#fff",At.innerHTML="&#10003;",At.style.lineHeight="15px",At.style.textAlign="center",At.style.fontWeight="bold"),St.appendChild(At),St.appendChild(document.createTextNode("需複查：")),a.value.needFollowUp===!0&&a.value.recheckRemark){St.style.display="flex",St.style.flexWrap="wrap",St.style.alignItems="center";const Ue=document.createElement("span");Ue.textContent=a.value.recheckRemark,Ue.style.marginLeft="5px",Ue.style.borderBottom="1px solid #000",Ue.style.display="inline-block",Ue.style.maxWidth="150px",Ue.style.wordBreak="break-all",Ue.style.whiteSpace="normal",St.appendChild(Ue)}else{St.style.display="flex",St.style.flexWrap="wrap",St.style.alignItems="center";const Ue=document.createElement("span");Ue.textContent="          ",Ue.style.marginLeft="5px",Ue.style.borderBottom="1px solid #000",Ue.style.display="inline-block",Ue.style.maxWidth="150px",St.appendChild(Ue)}Ft.appendChild(St),Zt.appendChild(Ft);const Ht=document.createElement("div");Ht.style.marginTop="10px";const Wt=document.createElement("p");Wt.textContent="備註：考量改善方法實施完成的時間點，後續計畫做以下安排。",Ht.appendChild(Wt);const ns=document.createElement("p");ns.textContent="1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。",Ht.appendChild(ns);const rs=document.createElement("p");rs.textContent="2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。",Ht.appendChild(rs),Zt.appendChild(Ht),le.appendChild(Zt),le.style.position="absolute",le.style.left="-9999px",document.body.appendChild(le),setTimeout(()=>{if(ae.rows&&ae.rows.length>=3&&ae.rows[2].cells.length>=4){const Re=ae.rows[2].cells[3];Re.innerHTML="";const Me=document.createElement("div");Me.style.display="flex",Me.style.flexDirection="column";const ze=document.createElement("div");ze.style.display="flex",ze.style.alignItems="center",ze.style.marginBottom="5px";const at=document.createElement("div");at.style.width="16px",at.style.height="16px",at.style.border="2px solid #000",at.style.marginRight="5px",at.style.display="inline-block",a.value.inspectionType==="onsite"&&(at.style.backgroundColor="#000",at.style.color="#fff",at.innerHTML="&#10003;",at.style.lineHeight="15px",at.style.textAlign="center",at.style.fontWeight="bold"),ze.appendChild(at),ze.appendChild(document.createTextNode("實地訪查"));const et=document.createElement("div");et.style.display="flex",et.style.alignItems="center";const rt=document.createElement("div");if(rt.style.width="16px",rt.style.height="16px",rt.style.border="2px solid #000",rt.style.marginRight="5px",rt.style.display="inline-block",a.value.inspectionType==="online"&&(rt.style.backgroundColor="#000",rt.style.color="#fff",rt.innerHTML="&#10003;",rt.style.lineHeight="15px",rt.style.textAlign="center",rt.style.fontWeight="bold"),et.appendChild(rt),et.appendChild(document.createTextNode("線上訪查：")),a.value.inspectionType==="online"&&a.value.onlineRemark){et.style.display="flex",et.style.flexWrap="wrap",et.style.alignItems="center";const bt=document.createElement("span");bt.textContent=a.value.onlineRemark,bt.style.marginLeft="5px",bt.style.borderBottom="1px solid #000",bt.style.display="inline-block",bt.style.maxWidth="150px",bt.style.wordBreak="break-all",bt.style.whiteSpace="normal",et.appendChild(bt)}else{et.style.display="flex",et.style.flexWrap="wrap",et.style.alignItems="center";const bt=document.createElement("span");bt.textContent="          ",bt.style.marginLeft="5px",bt.style.borderBottom="1px solid #000",bt.style.display="inline-block",bt.style.maxWidth="150px",et.appendChild(bt)}Me.appendChild(ze),Me.appendChild(et),Re.appendChild(Me)}const Ue=Re=>{let Me="<html><head><title>教學查核紀錄表</title>";return Me+="<style>",Me+="body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }",Me+="h2 { text-align: center; margin-bottom: 20px; }",Me+="h3 { margin-top: 20px; margin-bottom: 10px; }",Me+="table { width: 100%; border-collapse: collapse; margin-bottom: 20px; page-break-inside: auto; }",Me+="tr { page-break-inside: avoid; page-break-after: auto; }",Me+="thead { display: table-header-group; }",Me+="tfoot { display: table-footer-group; }",Me+="th, td { border: 1px solid #000; padding: 6px; }",Me+="th { background-color: #f2f2f2; text-align: center; }",Me+="@media print {",Me+="  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",Me+="  th, td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }",Me+="  @page { margin: 0; size: auto; }",Me+="  html { margin: 0; padding: 0.5cm; }",Me+="  body { margin: 0; padding: 0; }",Me+="  .signature-section { display: flex; justify-content: space-between; margin-top: 20px; }",Me+="  .signature-box { margin-bottom: 10px; }",Me+="}",Me+="</style></head><body>",Me+=Re,Me+="<script>",Me+="window.onload = function() {",Me+="  setTimeout(function() {",Me+='    var style = document.createElement("style");',Me+='    style.innerHTML = "@page { margin: 1cm; }";',Me+="    document.head.appendChild(style);",Me+="    window.print();",Me+="  }, 300);",Me+="};",Me+="<\/script>",Me+="</body></html>",Me};try{const Re=window.open("","_blank");if(!Re)throw new Error("無法開啟列印視窗，請檢查是否被瀏覽器阻擋");const Me=Ue(le.innerHTML);Re.document.open(),Re.document.write(Me),Re.document.close(),Re.addEventListener("afterprint",()=>{document.body.removeChild(le),v.showSuccess("貼心提醒","查核紀錄表已成功匯出為PDF"),g.value=!1}),setTimeout(()=>{g.value=!1},5e3)}catch(Re){console.error("列印過程發生錯誤:",Re),v.showError("匯出失敗",Re.message||"列印過程發生錯誤"),g.value=!1}},100)}catch(le){console.error("匯出查核紀錄表失敗:",le),v.showError("匯出失敗",le.message||"匯出查核紀錄表失敗，請稍後再試"),g.value=!1;const Q=document.querySelector('div[style*="-9999px"]');Q&&Q.parentNode&&Q.parentNode.removeChild(Q)}};je(()=>{oe(),_(),P.value?r():T.value=!0,q()});const ve=m({visitUpdate:!1,visitExport:!1}),oe=async()=>{try{const le=await tt.getSidebarPermissions();le.data.code===0&&le.data.message==="success"?(ve.value=le.data.data,console.log("訪視督課頁面權限:",ve.value)):console.error("獲取權限失敗:",le.data.message)}catch(le){console.error("獲取權限錯誤:",le)}};Ee(()=>a.value.checkResults,le=>{q()},{deep:!0}),Ee(()=>a.value.inspectionType,(le,Q)=>{q(),le==="onsite"?(a.value.isOffline=!0,a.value.isOnline=!1):le==="online"?(a.value.isOnline=!0,a.value.isOffline=!1):(le===""||le===null)&&(a.value.isOffline=!1,a.value.isOnline=!1)}),Ee(()=>a.value.isOffline,le=>{le===!0?(a.value.inspectionType="onsite",a.value.isOnline=!1):le===!1&&a.value.inspectionType==="onsite"&&(a.value.inspectionType="")}),Ee(()=>a.value.isOnline,le=>{le===!0?(a.value.inspectionType="online",a.value.isOffline=!1):le===!1&&a.value.inspectionType==="online"&&(a.value.inspectionType="")});const q=()=>{let le=0,Q=0,se=0;const ie=a.value.inspectionType==="onsite"?"3-3":"4-5",de={1:{onsite:40,online:20},2:{onsite:15,online:30},3:{onsite:20,online:30},4:{onsite:25,online:20}};for(const ae of[1,2,3,4]){const Ie=R(ae).filter(ge=>ge!==ie),Be=Ie.length;if(Be===0)continue;const pe=(de[ae][a.value.inspectionType==="onsite"?"onsite":"online"]||0)/Be;let we=0;for(const ge of Ie)a.value.checkResults[ge]===!0?(le++,we++):a.value.checkResults[ge]===!1&&Q++;const He=we*pe;se+=He}a.value.passCount=le,a.value.failCount=Q,a.value.totalScore=Math.round(se),se>=70?a.value.hasPass=!0:se<70&&(le>0||Q>0)&&(a.value.hasPass=!1)},S=(le,Q)=>{a.value.checkResults[le]===Q?a.value.checkResults[le]=null:a.value.checkResults[le]=Q,q()},Y=le=>{const Q=document.createElement("td");Q.style.border="1px solid #000",Q.style.padding="8px";const se=document.createElement("table");se.style.width="100%",se.style.border="none",se.style.borderCollapse="collapse",se.style.margin="0 auto";const ie=document.createElement("tr"),de=(Ie,Be)=>{const me=document.createElement("td");me.style.border="none",me.style.width="50%",me.style.textAlign="center",me.style.verticalAlign="middle";const pe=document.createElement("div");pe.style.display="inline-flex",pe.style.alignItems="center",pe.style.justifyContent="center";const we=document.createElement("div");return we.style.width="16px",we.style.height="16px",we.style.border="2px solid #000",we.style.marginRight="5px",we.style.display="inline-block",Ie&&(we.style.backgroundColor="#000",we.style.color="#fff",we.innerHTML="&#10003;",we.style.lineHeight="15px",we.style.textAlign="center",we.style.fontWeight="bold"),pe.appendChild(we),pe.appendChild(document.createTextNode(Be)),me.appendChild(pe),me},ae=de(a.value.checkResults[le]===!0,"符合");ie.appendChild(ae);const ce=de(a.value.checkResults[le]===!1,"不符合");return ie.appendChild(ce),se.appendChild(ie),Q.appendChild(se),Q},fe=le=>{const Q=document.createElement("td");Q.style.border="1px solid #000",Q.style.padding="8px";const se=(ie,de,ae)=>{const ce=document.createElement("div");ce.style.display="flex",ce.style.alignItems="center",ce.style.marginBottom=ae?"5px":"0";const Ie=document.createElement("div");if(Ie.style.width="16px",Ie.style.height="16px",Ie.style.border="2px solid #000",Ie.style.marginRight="5px",Ie.style.display="inline-block",ie&&(Ie.style.backgroundColor="#000",Ie.style.color="#fff",Ie.innerHTML="&#10003;",Ie.style.lineHeight="15px",Ie.style.textAlign="center",Ie.style.fontWeight="bold"),ce.appendChild(Ie),ce.appendChild(document.createTextNode(de)),Q.appendChild(ce),ae){const Be=document.createElement("span");Be.textContent=ae,Q.appendChild(Be)}};return le==="3-3"?se(a.value.isOffline,"實體課程",a.value.evidence[le]):le==="4-5"?se(a.value.isOnline,"線上課程",a.value.evidence[le]):Q.textContent=a.value.evidence[le]||"",Q};return(le,Q)=>(t(),s("div",n_,[e("div",r_,[Qe(pt,{breadcrumbs:[{name:"訪視督課",path:"/supervision"},{name:"編輯查核紀錄表",path:"/checklist"}]})]),Q[67]||(Q[67]=e("div",{class:"w-full max-w-[1500px] flex justify-between mt-6 mb-2"},[e("h1",{class:"text-2xl font-bold text-center w-full"},"教學查核紀錄表")],-1)),e("div",i_,[e("div",d_,[ve.value.visitExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:$e,disabled:g.value},l(g.value?"匯出中...":"匯出 PDF"),9,u_)):J("",!0),T.value?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:j}," 取消 ")):J("",!0),ve.value.visitUpdate?(t(),s("button",{key:2,class:X(["px-4 py-2",T.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:L,disabled:K.value},l(T.value?"儲存":"內容編輯"),11,c_)):J("",!0)])]),Q[68]||(Q[68]=e("div",{class:"w-full max-w-[1500px] mb-2"},[e("h2",{class:"text-lg font-bold"},"一、訪查學校、時間及參與人員")],-1)),e("div",p_,[e("div",null,[e("table",v_,[e("thead",null,[e("tr",null,[Q[25]||(Q[25]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 訪查學校 ",-1)),e("td",m_,[I(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Q[0]||(Q[0]=se=>a.value.school=se),disabled:o.value||!T.value},[e("option",f_,l(o.value?"載入中...":"請選擇學校"),1),(t(!0),s(Z,null,re(u.value,se=>(t(),s("option",{key:se.value,value:se.value},l(se.label),9,y_))),128))],8,b_),[[Pe,a.value.school]])]),Q[26]||(Q[26]=e("th",{scope:"col",class:"border-r border-black p-4 w-1/4 font-bold text-center"}," 課程名稱 ",-1)),e("td",g_,[I(e("select",{class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Q[1]||(Q[1]=se=>a.value.courseName=se),disabled:!a.value.school||N.value||!T.value},[e("option",h_,l(a.value.school?N.value?"載入中...":"請選擇課程":"請先選擇學校"),1),(t(!0),s(Z,null,re(C.value,se=>(t(),s("option",{key:se.value,value:se.value},l(se.label),9,w_))),128))],8,x_),[[Pe,a.value.courseName]])])])]),e("tbody",null,[e("tr",null,[Q[27]||(Q[27]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 授課時間 ",-1)),e("td",__,[e("div",k_,l(a.value.courseDate||"尚未選擇課程"),1)])]),e("tr",null,[Q[36]||(Q[36]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"},[xe(" 訪查時間"),e("br"),xe("(24 時制) ")],-1)),e("td",$_,[e("div",C_,[e("div",E_,[I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[2]||(Q[2]=se=>a.value.year=se),readonly:!T.value},null,8,S_),[[ee,a.value.year]]),Q[28]||(Q[28]=e("span",{class:"mx-1"},"年",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[3]||(Q[3]=se=>a.value.month=se),readonly:!T.value},null,8,D_),[[ee,a.value.month]]),Q[29]||(Q[29]=e("span",{class:"mx-1"},"月",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[4]||(Q[4]=se=>a.value.day=se),readonly:!T.value},null,8,M_),[[ee,a.value.day]]),Q[30]||(Q[30]=e("span",{class:"mx-1"},"日",-1))]),e("div",A_,[I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[5]||(Q[5]=se=>a.value.startHour=se),readonly:!T.value},null,8,I_),[[ee,a.value.startHour]]),Q[31]||(Q[31]=e("span",{class:"mx-1"},":",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[6]||(Q[6]=se=>a.value.startMinute=se),readonly:!T.value},null,8,R_),[[ee,a.value.startMinute]]),Q[32]||(Q[32]=e("span",{class:"mx-2"},"~",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[7]||(Q[7]=se=>a.value.endHour=se),readonly:!T.value},null,8,P_),[[ee,a.value.endHour]]),Q[33]||(Q[33]=e("span",{class:"mx-1"},":",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center","onUpdate:modelValue":Q[8]||(Q[8]=se=>a.value.endMinute=se),readonly:!T.value},null,8,U_),[[ee,a.value.endMinute]])])])]),Q[37]||(Q[37]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查方式 ",-1)),e("td",N_,[e("div",T_,[e("div",V_,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:a.value.inspectionType==="onsite",onChange:Q[9]||(Q[9]=se=>a.value.inspectionType="onsite"),disabled:!T.value},null,40,j_),Q[34]||(Q[34]=e("span",null,"實地訪查",-1))]),e("div",L_,[e("div",F_,[e("input",{type:"checkbox",class:"w-6 h-6 min-w-[24px] min-h-[24px] border border-black mr-2",checked:a.value.inspectionType==="online",onChange:Q[10]||(Q[10]=se=>a.value.inspectionType="online"),disabled:!T.value},null,40,q_),Q[35]||(Q[35]=e("span",null,"線上訪查：",-1))]),e("div",O_,[I(e("input",{type:"text",class:"border-b border-black p-1 w-full","onUpdate:modelValue":Q[11]||(Q[11]=se=>a.value.onlineRemark=se),placeholder:"請輸入...",readonly:!T.value,style:{"max-width":"150px","word-break":"break-all","white-space":"normal","vertical-align":"bottom"}},null,8,B_),[[ee,a.value.onlineRemark]])])])])])]),e("tr",null,[Q[38]||(Q[38]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 聯絡人 ",-1)),e("td",H_,[I(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":Q[12]||(Q[12]=se=>a.value.interviewee=se),placeholder:"請輸入聯絡人姓名...",readonly:!T.value},null,8,W_),[[ee,a.value.interviewee]])]),Q[39]||(Q[39]=e("th",{scope:"row",class:"border-r border-t-2 border-black p-4 font-bold text-center"}," 訪查人員 ",-1)),e("td",z_,[I(e("input",{type:"text",class:"w-full border border-gray-300 p-2 outline-none","onUpdate:modelValue":Q[13]||(Q[13]=se=>a.value.inspectors=se),placeholder:"請輸入訪查人員姓名...",readonly:!T.value},null,8,K_),[[ee,a.value.inspectors]])])])])])])]),Q[69]||(Q[69]=e("div",{class:"w-full max-w-[1500px] mt-6 mb-2"},[e("h2",{class:"text-lg font-bold"},"二、查核內容")],-1)),e("div",J_,[e("table",Y_,[Q[60]||(Q[60]=e("thead",null,[e("tr",null,[e("th",{class:"border-r border-b-2 border-black p-4 w-[55%] font-bold text-center"},"查核項目"),e("th",{class:"border-r border-b-2 border-black p-4 w-[25%] font-bold text-center"},"查核結果"),e("th",{class:"border-b-2 border-black p-4 w-[20%] font-bold text-center"},[xe("佐證資料或"),e("br"),xe("說明原因")])])],-1)),e("tbody",null,[Q[50]||(Q[50]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"1、課程師資實施狀況（實地40%/線上20%）")])])],-1)),(t(!0),s(Z,null,re(R(1),se=>(t(),s("tr",{key:se,class:"border-b-2 border-black"},[e("td",G_,[e("div",Q_,[e("span",null,l(a.value.questions[se]),1)])]),e("td",Z_,[e("div",X_,[e("div",ek,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!0,onChange:ie=>S(se,!0),disabled:!T.value},null,40,tk),Q[40]||(Q[40]=e("span",null,"符合",-1))]),e("div",sk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!1,onChange:ie=>S(se,!1),disabled:!T.value},null,40,ak),Q[41]||(Q[41]=e("span",null,"不符合",-1))])])]),e("td",ok,[I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ie=>a.value.evidence[se]=ie,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,lk),[[ee,a.value.evidence[se]]])])]))),128)),Q[51]||(Q[51]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"2、人力安排情形（實地15%/線上30%）")])])],-1)),(t(!0),s(Z,null,re(R(2),se=>(t(),s("tr",{key:se,class:"border-b-2 border-black"},[e("td",nk,[e("div",rk,[e("span",null,l(a.value.questions[se]),1)])]),e("td",ik,[e("div",dk,[e("div",uk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!0,onChange:ie=>S(se,!0),disabled:!T.value},null,40,ck),Q[42]||(Q[42]=e("span",null,"符合",-1))]),e("div",pk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!1,onChange:ie=>S(se,!1),disabled:!T.value},null,40,vk),Q[43]||(Q[43]=e("span",null,"不符合",-1))])])]),e("td",mk,[I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ie=>a.value.evidence[se]=ie,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,bk),[[ee,a.value.evidence[se]]])])]))),128)),Q[52]||(Q[52]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"3、環境設備實施狀況（實地20%/線上30%）")])])],-1)),(t(!0),s(Z,null,re(R(3),se=>(t(),s("tr",{key:se,class:"border-b-2 border-black"},[e("td",fk,[e("div",yk,[e("span",null,l(a.value.questions[se]),1)])]),e("td",gk,[e("div",xk,[e("div",hk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!0,onChange:ie=>S(se,!0),disabled:!T.value},null,40,wk),Q[44]||(Q[44]=e("span",null,"符合",-1))]),e("div",_k,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!1,onChange:ie=>S(se,!1),disabled:!T.value},null,40,kk),Q[45]||(Q[45]=e("span",null,"不符合",-1))])])]),e("td",$k,[se==="3-3"?(t(),s("div",Ck,[I(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":Q[14]||(Q[14]=ie=>a.value.isOffline=ie),id:"isOffline",disabled:!T.value},null,8,Ek),[[Ce,a.value.isOffline]]),Q[46]||(Q[46]=e("label",{for:"isOffline",class:"cursor-pointer"},"實體課程",-1))])):J("",!0),I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ie=>a.value.evidence[se]=ie,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,Sk),[[ee,a.value.evidence[se]]])])]))),128)),Q[53]||(Q[53]=e("tr",null,[e("td",{class:"border-b-2 border-black p-4 font-bold",colspan:"3"},[e("div",{class:"flex justify-between items-center"},[e("span",null,"4、課程實施情形（實地25%/線上20%）")])])],-1)),(t(!0),s(Z,null,re(R(4),se=>(t(),s("tr",{key:se,class:"border-b-2 border-black"},[e("td",Dk,[e("div",Mk,[e("span",null,l(a.value.questions[se]),1)])]),e("td",Ak,[e("div",Ik,[e("div",Rk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!0,onChange:ie=>S(se,!0),disabled:!T.value},null,40,Pk),Q[47]||(Q[47]=e("span",null,"符合",-1))]),e("div",Uk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.checkResults[se]===!1,onChange:ie=>S(se,!1),disabled:!T.value},null,40,Nk),Q[48]||(Q[48]=e("span",null,"不符合",-1))])])]),e("td",Tk,[se==="4-5"?(t(),s("div",Vk,[I(e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2","onUpdate:modelValue":Q[15]||(Q[15]=ie=>a.value.isOnline=ie),id:"isOnline",disabled:!T.value},null,8,jk),[[Ce,a.value.isOnline]]),Q[49]||(Q[49]=e("label",{for:"isOnline",class:"cursor-pointer"},"線上課程",-1))])):J("",!0),I(e("textarea",{class:"w-full h-full border border-gray-300 p-1 outline-none resize-none min-h-[60px]","onUpdate:modelValue":ie=>a.value.evidence[se]=ie,placeholder:"請輸入佐證資料...",readonly:!T.value},null,8,Lk),[[ee,a.value.evidence[se]]])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Fk,[Q[59]||(Q[59]=e("div",{class:"flex items-center font-bold"},"5、查核結果摘要：",-1)),e("div",qk,[I(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":Q[16]||(Q[16]=se=>a.value.passCount=se),readonly:""},null,512),[[ee,a.value.passCount]]),Q[54]||(Q[54]=e("span",{class:"mr-2"},"個項目符合、",-1)),I(e("input",{type:"text",class:"w-12 border-b border-black text-center mx-2","onUpdate:modelValue":Q[17]||(Q[17]=se=>a.value.failCount=se),readonly:""},null,512),[[ee,a.value.failCount]]),Q[55]||(Q[55]=e("span",null,"個項目不符合。",-1))]),e("div",Ok,[Q[58]||(Q[58]=e("span",{class:"font-bold mr-2"},"得分：",-1)),I(e("input",{type:"text",class:"w-16 border-b border-black text-center mr-6","onUpdate:modelValue":Q[18]||(Q[18]=se=>a.value.totalScore=se),readonly:""},null,512),[[ee,a.value.totalScore]]),e("div",Bk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.hasPass===!0,onChange:Q[19]||(Q[19]=se=>a.value.hasPass=a.value.hasPass===!0?null:!0),disabled:!T.value},null,40,Hk),Q[56]||(Q[56]=e("span",null,"通過",-1))]),e("div",Wk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.hasPass===!1,onChange:Q[20]||(Q[20]=se=>a.value.hasPass=a.value.hasPass===!1?null:!1),disabled:!T.value},null,40,zk),Q[57]||(Q[57]=e("span",null,"不通過",-1))])])])])])])]),Q[70]||(Q[70]=e("div",{class:"w-full max-w-[1500px] mt-6"},[e("p",{class:"text-gray-700 mb-2"},"備註：說明原因應清楚描述，避免不確定的文字：如可能...。")],-1)),e("div",Kk,[e("table",Jk,[Q[62]||(Q[62]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"border-b-2 border-black p-4 text-left font-bold",colspan:"2"}," 6、得分未達 70 分，查核結果不通過者，請在 7 個工作日內以 mail 來信提交改善方法，由查核人員紀錄，並於改善方法實施完成後，配合辦理複查。 ")])],-1)),e("tbody",null,[e("tr",null,[Q[61]||(Q[61]=e("th",{scope:"row",class:"border-r-2 border-black p-4 w-1/4"},[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"text-center font-bold"},"改善方法"),e("div",{class:"text-center"},"(學校承辦人員)")])],-1)),e("td",Yk,[I(e("textarea",{class:"w-full h-64 border border-gray-300 p-2 outline-none resize-none","onUpdate:modelValue":Q[21]||(Q[21]=se=>a.value.improvement=se),placeholder:"請輸入改善方法...",readonly:!T.value},null,8,Gk),[[ee,a.value.improvement]])])])])])]),e("div",Qk,[e("div",Zk,[Q[65]||(Q[65]=e("span",{class:"font-bold mr-2"},"三、追蹤調查",-1)),e("div",Xk,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.needFollowUp===!1,onChange:Q[22]||(Q[22]=se=>a.value.needFollowUp=a.value.needFollowUp===!1?null:!1),id:"needFollowUp",disabled:!T.value},null,40,e4),Q[63]||(Q[63]=e("label",{for:"needFollowUp",class:"cursor-pointer"},"不須追蹤",-1))]),e("div",t4,[e("div",s4,[e("input",{type:"checkbox",class:"w-6 h-6 border border-black mr-2",checked:a.value.needFollowUp===!0,onChange:Q[23]||(Q[23]=se=>a.value.needFollowUp=a.value.needFollowUp===!0?null:!0),id:"needRecheck",disabled:!T.value},null,40,a4),Q[64]||(Q[64]=e("label",{for:"needRecheck",class:"cursor-pointer"},"需複查：",-1))]),I(e("input",{type:"text",class:"border-b border-black ml-2 p-1","onUpdate:modelValue":Q[24]||(Q[24]=se=>a.value.recheckRemark=se),placeholder:"請輸入複查備註...",style:{"min-width":"120px","max-width":"150px",flex:"1","word-break":"break-all","white-space":"normal"},readonly:!T.value||a.value.needFollowUp!==!0},null,8,o4),[[ee,a.value.recheckRemark]])])]),Q[66]||(Q[66]=e("div",{class:"mt-2"},[e("p",null,"備註：考量改善方法實施完成的時間點，後續計畫做以下安排。"),e("p",{class:"mt-2"},"1、辦理複查計畫時，仍在原查核課程時間內：複查同一課程，僅針對未符合的部分進行查核。"),e("p",{class:"mt-2"},"2、辦理複查計畫時，原查核課程已結束，重新複查學校的其他課程。")],-1))])]))}},n4=Le(l4,[["__scopeId","data-v-7b18f703"]]),r4={class:"flex flex-col items-center p-6"},i4={class:"w-full max-w-[1500px]"},d4={class:"w-full max-w-[1500px]"},u4={class:"flex items-center"},c4={class:"relative w-40 mx-4"},p4=["disabled"],v4={class:"w-full max-w-[1500px] overflow-auto"},m4={key:0,class:"flex justify-center items-center py-10"},b4={key:1},f4={class:"overflow-x-auto"},y4={class:"border-collapse",style:{"min-width":"10000px"}},g4={class:"bg-[#EEEFE7]"},x4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},h4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},w4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},_4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},k4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},$4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},C4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},E4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},S4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},D4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},M4={class:"border p-2 text-red-500 border-r-2 border-r-black",scope:"col"},A4=["onClick"],I4={class:"border p-2 text-center sticky-col left-0 bg-white",style:{"min-width":"60px"}},R4={class:"border p-2 text-center"},P4={class:"border p-2 text-center"},U4={class:"border p-2 text-center"},N4={class:"border p-2 text-center"},T4={class:"border p-2 text-center"},V4={class:"border p-2 text-center"},j4={class:"border p-2 text-center"},L4={class:"border p-2 text-center"},F4={class:"border p-2 text-center"},q4={class:"border p-2 text-center"},O4={class:"border p-2 text-center"},B4={class:"border p-2 text-center border-l-2 border-l-black"},H4={class:"bg-[#E6D7E2]"},W4={class:"border p-2 text-center border-l-2 border-l-black"},z4={class:"border p-2 text-center"},K4={class:"border p-2 text-center"},J4={class:"border p-2 text-center"},Y4={class:"border p-2 text-center border-l-2 border-l-black"},G4={class:"border p-2 text-center"},Q4={class:"border p-2 text-center"},Z4={class:"border p-2 text-center"},X4={class:"border p-2 text-center"},e$={class:"border p-2 text-center border-l-2 border-l-black"},t$={class:"border p-2 text-center"},s$={class:"border p-2 text-center"},a$={class:"border p-2 text-center"},o$={class:"border p-2 text-center border-l-2 border-l-black"},l$={class:"border p-2 text-center"},n$={class:"border p-2 text-center"},r$={class:"border p-2 text-center"},i$={class:"border p-2 text-center"},d$={class:"border p-2 text-center"},u$={class:"border p-2 text-center"},c$={class:"border p-2 text-center"},p$={class:"border p-2 text-center"},v$={class:"border p-2 text-center"},m$={class:"border p-2 text-center"},b$={class:"border p-2 text-center border-l-2 border-l-black"},f$={class:"border p-2 text-center"},y$={class:"border p-2 text-center"},g$={class:"border p-2 text-center"},x$={class:"border p-2 text-center border-l-2 border-l-black"},h$={class:"border p-2 text-center"},w$={class:"border p-2 text-center"},_$={class:"border p-2 text-center"},k$={class:"border p-2 text-center"},$$={class:"border p-2 text-center border-l-2 border-l-black"},C$={class:"border p-2 text-center"},E$={class:"border p-2 text-center"},S$={class:"border p-2 text-center"},D$={class:"border p-2 text-center border-l-2 border-l-black"},M$={class:"border p-2 text-center"},A$={class:"border p-2 text-center"},I$={class:"border p-2 text-center"},R$={class:"border p-2 text-center border-l-2 border-l-black"},P$={class:"border p-2 text-center"},U$={class:"border p-2 text-center"},N$={class:"border p-2 text-center"},T$={class:"border p-2 text-center"},V$={class:"border p-2 text-center"},j$={class:"border p-2 text-center"},L$={class:"border p-2 text-center border-l-2 border-l-black"},F$={class:"border p-2 text-center"},q$={class:"border p-2 text-center"},O$={class:"border p-2 text-center border-l-2 border-l-black"},B$={class:"border p-2 text-center"},H$={class:"border p-2 text-center"},W$={class:"border p-2 text-center"},z$={class:"border p-2 text-center"},K$={class:"border p-2 text-center"},J$={class:"border p-2 text-center"},Y$={class:"border p-2 text-center"},G$={class:"bg-[#F7F7F7]"},Q$={class:"border p-2 text-center border-l-2 border-l-black"},Z$={class:"border p-2 text-center"},X$={class:"border p-2 text-center"},e5={class:"border p-2 text-center"},t5={class:"border p-2 text-center border-l-2 border-l-black"},s5={class:"border p-2 text-center"},a5={class:"border p-2 text-center"},o5={class:"border p-2 text-center"},l5={class:"border p-2 text-center"},n5={class:"border p-2 text-center border-l-2 border-l-black"},r5={class:"border p-2 text-center"},i5={class:"border p-2 text-center"},d5={class:"border p-2 text-center"},u5={class:"border p-2 text-center border-l-2 border-l-black"},c5={class:"border p-2 text-center"},p5={class:"border p-2 text-center"},v5={class:"border p-2 text-center"},m5={class:"border p-2 text-center"},b5={class:"border p-2 text-center"},f5={class:"border p-2 text-center"},y5={class:"border p-2 text-center"},g5={class:"border p-2 text-center"},x5={class:"border p-2 text-center"},h5={class:"border p-2 text-center"},w5={class:"border p-2 text-center border-l-2 border-l-black"},_5={class:"border p-2 text-center"},k5={class:"border p-2 text-center"},$5={class:"border p-2 text-center"},C5={class:"border p-2 text-center border-l-2 border-l-black"},E5={class:"border p-2 text-center"},S5={class:"border p-2 text-center"},D5={class:"border p-2 text-center"},M5={class:"border p-2 text-center"},A5={class:"border p-2 text-center border-l-2 border-l-black"},I5={class:"border p-2 text-center"},R5={class:"border p-2 text-center"},P5={class:"border p-2 text-center"},U5={class:"border p-2 text-center border-l-2 border-l-black"},N5={class:"border p-2 text-center"},T5={class:"border p-2 text-center"},V5={class:"border p-2 text-center"},j5={class:"border p-2 text-center border-l-2 border-l-black"},L5={class:"border p-2 text-center"},F5={class:"border p-2 text-center"},q5={class:"border p-2 text-center"},O5={class:"border p-2 text-center"},B5={class:"border p-2 text-center"},H5={class:"border p-2 text-center"},W5={class:"border p-2 text-center border-l-2 border-l-black"},z5={class:"border p-2 text-center"},K5={class:"border p-2 text-center"},J5={class:"border p-2 text-center border-l-2 border-l-black"},Y5={class:"border p-2 text-center"},G5={class:"border p-2 text-center"},Q5={class:"border p-2 text-center"},Z5={class:"border p-2 text-center"},X5={class:"border p-2 text-center"},e3={class:"border p-2 text-center"},t3={class:"border p-2 text-center"},s3={class:"bg-[#E6D7E2]"},a3={class:"border p-2 text-center border-l-2 border-l-black"},o3={class:"border p-2 text-center"},l3={class:"border p-2 text-center"},n3={class:"border p-2 text-center"},r3={class:"border p-2 text-center border-l-2 border-l-black"},i3={class:"border p-2 text-center"},d3={class:"border p-2 text-center"},u3={class:"border p-2 text-center"},c3={class:"border p-2 text-center"},p3={class:"border p-2 text-center border-l-2 border-l-black"},v3={class:"border p-2 text-center"},m3={class:"border p-2 text-center"},b3={class:"border p-2 text-center"},f3={class:"border p-2 text-center border-l-2 border-l-black"},y3={class:"border p-2 text-center"},g3={class:"border p-2 text-center"},x3={class:"border p-2 text-center"},h3={class:"border p-2 text-center"},w3={class:"border p-2 text-center"},_3={class:"border p-2 text-center"},k3={class:"border p-2 text-center"},$3={class:"border p-2 text-center"},C3={class:"border p-2 text-center"},E3={class:"border p-2 text-center"},S3={class:"border p-2 text-center border-l-2 border-l-black"},D3={class:"border p-2 text-center"},M3={class:"border p-2 text-center"},A3={class:"border p-2 text-center"},I3={class:"border p-2 text-center border-l-2 border-l-black"},R3={class:"border p-2 text-center"},P3={class:"border p-2 text-center"},U3={class:"border p-2 text-center"},N3={class:"border p-2 text-center"},T3={class:"border p-2 text-center border-l-2 border-l-black"},V3={class:"border p-2 text-center"},j3={class:"border p-2 text-center"},L3={class:"border p-2 text-center"},F3={class:"border p-2 text-center border-l-2 border-l-black"},q3={class:"border p-2 text-center"},O3={class:"border p-2 text-center"},B3={class:"border p-2 text-center"},H3={class:"border p-2 text-center border-l-2 border-l-black"},W3={class:"border p-2 text-center"},z3={class:"border p-2 text-center"},K3={class:"border p-2 text-center"},J3={class:"border p-2 text-center"},Y3={class:"border p-2 text-center"},G3={class:"border p-2 text-center"},Q3={class:"border p-2 text-center border-l-2 border-l-black"},Z3={class:"border p-2 text-center"},X3={class:"border p-2 text-center"},eC={class:"border p-2 text-center border-l-2 border-l-black"},tC={class:"border p-2 text-center"},sC={class:"border p-2 text-center"},aC={class:"border p-2 text-center"},oC={class:"border p-2 text-center"},lC={class:"border p-2 text-center"},nC={class:"border p-2 text-center"},rC={class:"border p-2 text-center"},iC={key:2,class:"flex justify-center items-center space-x-2 mt-6"},dC=["disabled"],uC=["disabled","onClick"],cC={key:1,class:"px-2"},pC=["disabled"],vC={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},mC={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},bC={class:"mb-4"},fC={class:"border-dashed border-2 border-gray-300 p-6 rounded-md text-center"},yC={class:"mb-2"},gC={key:0,class:"text-red-500 text-sm mt-2"},xC={class:"flex justify-end space-x-2"},hC=["disabled"],wC=["disabled"],zs=20,_C={__name:"CreditList",setup(D){const x=We(),d=lt(),u=m(""),C=m(""),o=m("asc"),N=m(1),K=m(1),$=m(0),P=m(!1),T=m([]),z=m({}),g=m({}),a=m({}),A=m({creditCertificationImport:!1,creditCertificationCreate:!1}),G=q=>q==="-1"||q===-1||q===null?"缺":q,k=m(!1),c=()=>{k.value=!k.value},b=q=>q==="-1"||q===-1||q===null?"缺":k.value?q:Math.round(q/18*10)/10,r=q=>G(q),f=Se(()=>{const q=[];if(K.value<=5)for(let Y=1;Y<=K.value;Y++)q.push(Y);else{q.push(1);let Y=Math.max(2,N.value-1),fe=Math.min(K.value-1,N.value+1);N.value<=3&&(fe=Math.min(4,K.value-1)),N.value>=K.value-2&&(Y=Math.max(2,K.value-3)),Y>2&&q.push("...");for(let le=Y;le<=fe;le++)q.push(le);fe<K.value-1&&q.push("..."),q.push(K.value)}return q}),p=async()=>{try{P.value=!0;const q={page:N.value,limit:zs,keyword:u.value.trim()||void 0};console.log("獲取學分申請列表參數:",q);const S=await Dt.getCreditList(q);S.data&&S.data.code===0?(T.value=S.data.data.list,$.value=S.data.data.totalCount,K.value=S.data.data.totalPage||Math.ceil($.value/zs),z.value=S.data.data.totalCreditHours||{},g.value=S.data.data.totalCourseHours||{},a.value=S.data.data.totalCombinedHours||{}):(console.error("獲取學分申請列表失敗:",S.data.message),v.showError("載入失敗",S.data.message||"獲取學分申請列表失敗"),T.value=[],$.value=0,K.value=1)}catch(q){console.error("獲取學分申請列表錯誤:",q),v.showError("載入失敗","獲取學分申請列表錯誤，請稍後再試"),T.value=[],$.value=0,K.value=1}finally{P.value=!1}},w=q=>{q!==N.value&&!P.value&&(N.value=q)},y=()=>{N.value>1&&!P.value&&N.value--},V=()=>{N.value<K.value&&!P.value&&N.value++},W=()=>{P.value||(N.value=1,p())};Ee(N,()=>{p()});const O=()=>{d.query.page&&(N.value=parseInt(d.query.page,10)||1),d.query.searchKeyword&&(u.value=d.query.searchKeyword),d.query.sortBy&&(C.value=d.query.sortBy),d.query.sortOrder&&(o.value=d.query.sortOrder)};je(()=>{O(),p(),oe()});const _=()=>{u.value=""},E=()=>{x.push({name:"Credits"})},L=q=>{if(q){const S={from:"credit-list",page:N.value,searchKeyword:u.value||void 0};x.push({name:"Single",params:{id:q},query:S})}},j=m(!1),R=m(null),U=m(""),te=m(!1),ue=m(null),ye=()=>{j.value=!0,U.value="",R.value=null,gs(()=>{ue.value&&(ue.value.value=null)})},ke=()=>{j.value=!1,R.value=null,U.value=""},De=()=>{ue.value.click()},$e=q=>{const S=q.target.files[0];if(S){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(S.type)&&!S.name.endsWith(".xlsx")&&!S.name.endsWith(".xls")&&!S.name.endsWith(".csv")){U.value="請選擇 Excel 或 CSV 檔案",R.value=null,q.target.value=null;return}if(S.size>10*1024*1024){U.value="檔案大小不能超過 10MB",R.value=null,q.target.value=null;return}R.value=S,U.value=""}},ve=async()=>{var q,S,Y;if(!R.value){U.value="請選擇要上傳的檔案";return}try{te.value=!0,U.value="";const fe=new FormData;fe.append("file",R.value);const le=await Dt.importCreditCertification(fe);le.data&&le.data.code===0?(v.showSuccess("上傳成功","學分認列資料已成功匯入"),ke(),p()):(U.value=((q=le.data)==null?void 0:q.message)||"上傳失敗，請確認檔案格式是否正確",v.showError("上傳失敗",U.value))}catch(fe){console.error("上傳學分認列檔案錯誤:",fe),U.value=((Y=(S=fe.response)==null?void 0:S.data)==null?void 0:Y.message)||"上傳過程中發生錯誤，請稍後再試",v.showError("上傳失敗",U.value)}finally{te.value=!1}},oe=async()=>{try{const q=await tt.getSidebarPermissions();q.data.code===0&&q.data.message==="success"?(A.value=q.data.data,console.log("學分認列頁面權限:",A.value)):console.error("獲取權限失敗:",q.data.message)}catch(q){console.error("獲取權限錯誤:",q)}};return(q,S)=>(t(),s("div",r4,[e("div",i4,[Qe(pt,{breadcrumbs:[{name:"認列清單",path:"/credit-list"}]})]),e("div",d4,[e("div",u4,[S[2]||(S[2]=e("span",null,"查詢學員:",-1)),e("div",c4,[I(e("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=Y=>u.value=Y),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"姓名、身分證字號",onKeyup:Ne(W,["enter"]),"aria-label":"搜尋學員關鍵字輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:_,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},S[1]||(S[1]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:P.value},l(P.value?"搜尋中...":"搜尋"),9,p4),S[3]||(S[3]=e("div",{class:"flex-grow"},null,-1)),e("button",{class:"px-4 py-2 bg-[#4e9875] hover:bg-[#3e7a5c] text-white mr-2",onClick:c}," 切換為"+l(k.value?"學分":"時數"),1),A.value.creditCertificationImport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d] mr-2",onClick:ye}," 匯入學分認列 ")):J("",!0),A.value.creditCertificationCreate?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:E}," 新增學分認列 ")):J("",!0)])]),S[111]||(S[111]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",v4,[P.value?(t(),s("div",m4,S[4]||(S[4]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",b4,[e("div",f4,[e("table",y4,[e("thead",null,[S[67]||(S[67]=e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 sticky-col left-0 bg-[#EEEFE7]",colspan:"2",scope:"colgroup"},"學員資料"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資通安全概論"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"6",scope:"colgroup"},"資料庫應用"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資料結構"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"12",scope:"colgroup"},"資訊管理"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"資通網路與安全"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"6",scope:"colgroup"},"資通網路與安全概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"計算機概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"5",scope:"colgroup"},"程式設計概要"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"8",scope:"colgroup"},"資通安全管理"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"4",scope:"colgroup"},"資通安全法令與規範"),e("th",{class:"border p-2 border-l-2 border-r-2 border-l-black border-r-black",colspan:"9",scope:"colgroup"},"資通安全防護技術"),e("th",{class:"border p-2",colspan:"2",scope:"colgroup"},"備註")],-1)),e("tr",g4,[S[5]||(S[5]=e("th",{class:"sticky-col left-0 border p-2 bg-[#EEEFE7]",scope:"col"},"序號",-1)),S[6]||(S[6]=e("th",{class:"sticky-col left-60 border p-2 bg-[#EEEFE7]",scope:"col"},"姓名",-1)),S[7]||(S[7]=e("th",{class:"border p-2 border-l-2 border-l-black text-blue-500",scope:"col"},"資通安全概論",-1)),S[8]||(S[8]=e("th",{class:"border p-2",scope:"col"},"資料加密與保全",-1)),S[9]||(S[9]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"網路安全監控與分析",-1)),S[10]||(S[10]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"通訊與網路安全",-1)),e("th",x4,"小計"+l(k.value?"時數":"學分"),1),S[11]||(S[11]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資料庫應用",-1)),S[12]||(S[12]=e("th",{class:"border p-2",scope:"col"},"資料庫架構規劃",-1)),S[13]||(S[13]=e("th",{class:"border p-2",scope:"col"},"資料庫管理",-1)),S[14]||(S[14]=e("th",{class:"border p-2",scope:"col"},"資料庫系統",-1)),S[15]||(S[15]=e("th",{class:"border p-2",scope:"col"},"資料庫與資料管理",-1)),e("th",h4,"小計"+l(k.value?"時數":"學分"),1),S[16]||(S[16]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資料結構",-1)),S[17]||(S[17]=e("th",{class:"border p-2",scope:"col"},"編譯器設計",-1)),S[18]||(S[18]=e("th",{class:"border p-2",scope:"col"},"人工智慧理論與應用",-1)),S[19]||(S[19]=e("th",{class:"border p-2",scope:"col"},"人工智慧",-1)),e("th",w4,"小計"+l(k.value?"時數":"學分"),1),S[20]||(S[20]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資訊管理",-1)),S[21]||(S[21]=e("th",{class:"border p-2",scope:"col"},"決策分析支援",-1)),S[22]||(S[22]=e("th",{class:"border p-2",scope:"col"},"資訊職能培力",-1)),S[23]||(S[23]=e("th",{class:"border p-2",scope:"col"},"系統分析",-1)),S[24]||(S[24]=e("th",{class:"border p-2",scope:"col"},"多媒體互動界面設計",-1)),S[25]||(S[25]=e("th",{class:"border p-2",scope:"col"},"服務介面設計",-1)),S[26]||(S[26]=e("th",{class:"border p-2",scope:"col"},"系統設計",-1)),S[27]||(S[27]=e("th",{class:"border p-2",scope:"col"},"軟體工程",-1)),S[28]||(S[28]=e("th",{class:"border p-2",scope:"col"},"人機介面",-1)),S[29]||(S[29]=e("th",{class:"border p-2",scope:"col"},"系統分析與設計",-1)),S[30]||(S[30]=e("th",{class:"border p-2",scope:"col"},"資訊應用概論",-1)),e("th",_4,"小計"+l(k.value?"時數":"學分"),1),S[31]||(S[31]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通網路與安全",-1)),S[32]||(S[32]=e("th",{class:"border p-2",scope:"col"},"網路安全",-1)),S[33]||(S[33]=e("th",{class:"border p-2",scope:"col"},"電腦網路規劃與管理",-1)),S[34]||(S[34]=e("th",{class:"border p-2",scope:"col"},"資訊與網路應用政策",-1)),e("th",k4,"小計"+l(k.value?"時數":"學分"),1),S[35]||(S[35]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通網路與安全概要",-1)),S[36]||(S[36]=e("th",{class:"border p-2",scope:"col"},"資訊與網路之技術標準與規範",-1)),S[37]||(S[37]=e("th",{class:"border p-2",scope:"col"},"通信與網路架構",-1)),S[38]||(S[38]=e("th",{class:"border p-2",scope:"col"},"資訊安全防護技術",-1)),S[39]||(S[39]=e("th",{class:"border p-2",scope:"col"},"資訊安全理論與實務",-1)),e("th",$4,"小計"+l(k.value?"時數":"學分"),1),S[40]||(S[40]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"計算機概要",-1)),S[41]||(S[41]=e("th",{class:"border p-2",scope:"col"},"多媒體系統",-1)),S[42]||(S[42]=e("th",{class:"border p-2",scope:"col"},"作業系統",-1)),S[43]||(S[43]=e("th",{class:"border p-2",scope:"col"},"電子計算機概論",-1)),e("th",C4,"小計"+l(k.value?"時數":"學分"),1),S[44]||(S[44]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"程式設計概要",-1)),S[45]||(S[45]=e("th",{class:"border p-2",scope:"col"},"程式語言",-1)),S[46]||(S[46]=e("th",{class:"border p-2",scope:"col"},"程式設計",-1)),S[47]||(S[47]=e("th",{class:"border p-2",scope:"col"},"機器學習",-1)),e("th",E4,"小計"+l(k.value?"時數":"學分"),1),S[48]||(S[48]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全管理",-1)),S[49]||(S[49]=e("th",{class:"border p-2",scope:"col"},"資通安全政策",-1)),S[50]||(S[50]=e("th",{class:"border p-2",scope:"col"},"安全系統開發",-1)),S[51]||(S[51]=e("th",{class:"border p-2",scope:"col"},"資通安全風險與事故管理",-1)),S[52]||(S[52]=e("th",{class:"border p-2",scope:"col"},"資通系統稽核",-1)),S[53]||(S[53]=e("th",{class:"border p-2",scope:"col"},"效率查核",-1)),S[54]||(S[54]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"業務持續運作管理",-1)),e("th",S4,"小計"+l(k.value?"時數":"學分"),1),S[55]||(S[55]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全法令與規範",-1)),S[56]||(S[56]=e("th",{class:"border p-2",scope:"col"},"情資分析與分享",-1)),S[57]||(S[57]=e("th",{class:"border p-2",scope:"col"},"資安事件通報應變",-1)),e("th",D4,"小計"+l(k.value?"時數":"學分"),1),S[58]||(S[58]=e("th",{class:"border p-2 border-l-2 border-l-black",scope:"col"},"資通安全防護技術",-1)),S[59]||(S[59]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"惡意程式檢測",-1)),S[60]||(S[60]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"數位鑑識與處理",-1)),S[61]||(S[61]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"Web應用程式安全",-1)),S[62]||(S[62]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"系統及網站滲透測試",-1)),S[63]||(S[63]=e("th",{class:"border p-2",scope:"col"},"安全性檢測",-1)),S[64]||(S[64]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"網路架構與部署安全",-1)),S[65]||(S[65]=e("th",{class:"border p-2 text-blue-500",scope:"col"},"弱點掃描與入侵偵測",-1)),e("th",M4,"小計"+l(k.value?"時數":"學分"),1),S[66]||(S[66]=e("th",{class:"border p-2",scope:"col"},"不符合認列標準的科目",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(T.value,(Y,fe)=>(t(),s("tr",{key:Y.id,onClick:le=>L(Y.id),class:"cursor-pointer"},[e("td",I4,l(fe+1),1),e("td",{class:X(["border p-2 text-center sticky-col left-60 bg-white",{"warning-bg":Y.isWarning}]),style:{"min-width":"100px"}},l(Y.studentName),3),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isCyberSecurityOverviewWarning}])},l(b(Y.cyberSecurityOverview)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDataEncryptionWarning}])},l(b(Y.dataEncryption)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityMonitoringWarning}])},l(b(Y.securityMonitoring)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isNetworkCommunicationSecurityWarning}])},l(b(Y.networkCommunicationSecurity)),3),e("td",R4,l(b(Y.cyberSecurityOverviewTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isDatabaseApplicationWarning}])},l(b(Y.databaseApplication)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDatabaseStructurePlanningWarning}])},l(b(Y.databaseStructurePlanning)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDatabaseManagementWarning}])},l(b(Y.databaseManagement)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDatabaseSystemsWarning}])},l(b(Y.databaseSystems)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDatabaseAndDataManagementWarning}])},l(b(Y.databaseAndDataManagement)),3),e("td",P4,l(b(Y.dbApplicationTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isDataStructureWarning}])},l(b(Y.dataStructure)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isCompilerDesignWarning}])},l(b(Y.compilerDesign)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isAITheoryAndApplicationWarning}])},l(b(Y.aiTheoryAndApplication)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isArtificialIntelligenceWarning}])},l(b(Y.artificialIntelligence)),3),e("td",U4,l(b(Y.dataStructTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isInformationManagementWarning}])},l(b(Y.informationManagement)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDecisionSupportWarning}])},l(b(Y.decisionSupport)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isITCompetencyDevelopmentWarning}])},l(b(Y.itCompetencyDevelopment)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSystemAnalysisWarning}])},l(b(Y.systemAnalysis)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isMultimediaInterfaceDesignWarning}])},l(b(Y.multimediaInterfaceDesign)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isServiceInterfaceDesignWarning}])},l(b(Y.serviceInterfaceDesign)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSystemDesignWarning}])},l(b(Y.systemDesign)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSoftwareEngineeringWarning}])},l(b(Y.softwareEngineering)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isHumanComputerInterfaceWarning}])},l(b(Y.humanComputerInterface)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSystemAnalysisAndDesignWarning}])},l(b(Y.systemAnalysisAndDesign)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isIntroToITApplicationsWarning}])},l(b(Y.introToITApplications)),3),e("td",N4,l(b(Y.infoManageTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isICTAndSecurityWarning}])},l(b(Y.ictAndSecurity)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isNetworkSecurityWarning}])},l(b(Y.networkSecurity)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isNetworkPlanningAndManagementWarning}])},l(b(Y.networkPlanningAndManagement)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isITPolicyWarning}])},l(b(Y.itPolicy)),3),e("td",T4,l(b(Y.ictAndSecurityTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isICTOverviewWarning}])},l(b(Y.ictOverview)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isTechnicalStandardsWarning}])},l(b(Y.technicalStandards)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isNetworkArchitectureWarning}])},l(b(Y.networkArchitecture)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityProtectionTechnologyWarning}])},l(b(Y.securityProtectionTechnology)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityTheoryAndPracticeWarning}])},l(b(Y.securityTheoryAndPractice)),3),e("td",V4,l(b(Y.ictSecurityOverviewTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isComputerOverviewWarning}])},l(b(Y.computerOverview)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isMultimediaSystemsWarning}])},l(b(Y.multimediaSystems)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isOperatingSystemsWarning}])},l(b(Y.operatingSystems)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isIntroToComputersWarning}])},l(b(Y.introToComputers)),3),e("td",j4,l(b(Y.computerOverviewTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isProgrammingOverviewWarning}])},l(b(Y.programmingOverview)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isProgrammingLanguageWarning}])},l(b(Y.programmingLanguage)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isProgrammingWarning}])},l(b(Y.programming)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isMachineLearningWarning}])},l(b(Y.machineLearning)),3),e("td",L4,l(b(Y.programmingTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isSecurityManagementWarning}])},l(b(Y.securityManagement)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityPolicyWarning}])},l(b(Y.securityPolicy)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecureSystemDevelopmentWarning}])},l(b(Y.secureSystemDevelopment)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityRiskManagementWarning}])},l(b(Y.securityRiskManagement)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSystemAuditWarning}])},l(b(Y.systemAudit)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isEfficiencyAuditWarning}])},l(b(Y.efficiencyAudit)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isBusinessContinuityWarning}])},l(b(Y.businessContinuity)),3),e("td",F4,l(b(Y.securityManagementTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isSecurityLawsWarning}])},l(b(Y.securityLaws)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isIntelligenceSharingWarning}])},l(b(Y.intelligenceSharing)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isIncidentResponseWarning}])},l(b(Y.incidentResponse)),3),e("td",q4,l(b(Y.securityLawsAndRegulationsTotalHours)),1),e("td",{class:X(["border p-2 text-center border-l-2 border-l-black",{"warning-bg":Y.isSecurityProtectionWarning}])},l(b(Y.securityProtection)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isMalwareDetectionWarning}])},l(b(Y.malwareDetection)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isDigitalForensicsWarning}])},l(b(Y.digitalForensics)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isWebSecurityWarning}])},l(b(Y.webSecurity)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isPenetrationTestingWarning}])},l(b(Y.penetrationTesting)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isSecurityTestingWarning}])},l(b(Y.securityTesting)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isNetworkDeploymentSecurityWarning}])},l(b(Y.networkDeploymentSecurity)),3),e("td",{class:X(["border p-2 text-center",{"warning-bg":Y.isVulnerabilityDetectionWarning}])},l(b(Y.vulnerabilityDetection)),3),e("td",O4,l(b(Y.securityProtectionTechnologyTotalHours)),1),e("td",B4,l(Y.remark||"-"),1)],8,A4))),128))]),e("tfoot",null,[e("tr",H4,[S[68]||(S[68]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#E6D7E2]"},"認列",-1)),S[69]||(S[69]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#E6D7E2]"},null,-1)),e("td",W4,l(r(z.value.cyberSecurityOverview)),1),e("td",z4,l(r(z.value.dataEncryption)),1),e("td",K4,l(r(z.value.securityMonitoring)),1),e("td",J4,l(r(z.value.networkCommunicationSecurity)),1),S[70]||(S[70]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",Y4,l(r(z.value.databaseApplication)),1),e("td",G4,l(r(z.value.databaseStructurePlanning)),1),e("td",Q4,l(r(z.value.databaseManagement)),1),e("td",Z4,l(r(z.value.databaseSystems)),1),e("td",X4,l(r(z.value.databaseAndDataManagement)),1),S[71]||(S[71]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",e$,l(r(z.value.dataStructure)),1),e("td",t$,l(r(z.value.compilerDesign)),1),e("td",s$,l(r(z.value.aiTheoryAndApplication)),1),e("td",a$,l(r(z.value.artificialIntelligence)),1),S[72]||(S[72]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",o$,l(r(z.value.informationManagement)),1),e("td",l$,l(r(z.value.decisionSupport)),1),e("td",n$,l(r(z.value.itCompetencyDevelopment)),1),e("td",r$,l(r(z.value.systemAnalysis)),1),e("td",i$,l(r(z.value.multimediaInterfaceDesign)),1),e("td",d$,l(r(z.value.serviceInterfaceDesign)),1),e("td",u$,l(r(z.value.systemDesign)),1),e("td",c$,l(r(z.value.softwareEngineering)),1),e("td",p$,l(r(z.value.humanComputerInterface)),1),e("td",v$,l(r(z.value.systemAnalysisAndDesign)),1),e("td",m$,l(r(z.value.introToITApplications)),1),S[73]||(S[73]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",b$,l(r(z.value.ictAndSecurity)),1),e("td",f$,l(r(z.value.networkSecurity)),1),e("td",y$,l(r(z.value.networkPlanningAndManagement)),1),e("td",g$,l(r(z.value.itPolicy)),1),S[74]||(S[74]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",x$,l(r(z.value.ictOverview)),1),e("td",h$,l(r(z.value.technicalStandards)),1),e("td",w$,l(r(z.value.networkArchitecture)),1),e("td",_$,l(r(z.value.securityProtectionTechnology)),1),e("td",k$,l(r(z.value.securityTheoryAndPractice)),1),S[75]||(S[75]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",$$,l(r(z.value.computerOverview)),1),e("td",C$,l(r(z.value.multimediaSystems)),1),e("td",E$,l(r(z.value.operatingSystems)),1),e("td",S$,l(r(z.value.introToComputers)),1),S[76]||(S[76]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",D$,l(r(z.value.programmingOverview)),1),e("td",M$,l(r(z.value.programmingLanguage)),1),e("td",A$,l(r(z.value.programming)),1),e("td",I$,l(r(z.value.machineLearning)),1),S[77]||(S[77]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",R$,l(r(z.value.securityManagement)),1),e("td",P$,l(r(z.value.securityPolicy)),1),e("td",U$,l(r(z.value.secureSystemDevelopment)),1),e("td",N$,l(r(z.value.securityRiskManagement)),1),e("td",T$,l(r(z.value.systemAudit)),1),e("td",V$,l(r(z.value.efficiencyAudit)),1),e("td",j$,l(r(z.value.businessContinuity)),1),S[78]||(S[78]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",L$,l(r(z.value.securityLaws)),1),e("td",F$,l(r(z.value.intelligenceSharing)),1),e("td",q$,l(r(z.value.incidentResponse)),1),S[79]||(S[79]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",O$,l(r(z.value.securityProtection)),1),e("td",B$,l(r(z.value.malwareDetection)),1),e("td",H$,l(r(z.value.digitalForensics)),1),e("td",W$,l(r(z.value.webSecurity)),1),e("td",z$,l(r(z.value.penetrationTesting)),1),e("td",K$,l(r(z.value.securityTesting)),1),e("td",J$,l(r(z.value.networkDeploymentSecurity)),1),e("td",Y$,l(r(z.value.vulnerabilityDetection)),1),S[80]||(S[80]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),S[81]||(S[81]=e("td",{class:"border p-2 text-center"},null,-1))]),e("tr",G$,[S[82]||(S[82]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#F7F7F7]"},"修課",-1)),S[83]||(S[83]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#F7F7F7]"},null,-1)),e("td",Q$,l(r(g.value.cyberSecurityOverview)),1),e("td",Z$,l(r(g.value.dataEncryption)),1),e("td",X$,l(r(g.value.securityMonitoring)),1),e("td",e5,l(r(g.value.networkCommunicationSecurity)),1),S[84]||(S[84]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",t5,l(r(g.value.databaseApplication)),1),e("td",s5,l(r(g.value.databaseStructurePlanning)),1),e("td",a5,l(r(g.value.databaseManagement)),1),e("td",o5,l(r(g.value.databaseSystems)),1),e("td",l5,l(r(g.value.databaseAndDataManagement)),1),S[85]||(S[85]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",n5,l(r(g.value.dataStructure)),1),e("td",r5,l(r(g.value.compilerDesign)),1),e("td",i5,l(r(g.value.aiTheoryAndApplication)),1),e("td",d5,l(r(g.value.artificialIntelligence)),1),S[86]||(S[86]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",u5,l(r(g.value.informationManagement)),1),e("td",c5,l(r(g.value.decisionSupport)),1),e("td",p5,l(r(g.value.itCompetencyDevelopment)),1),e("td",v5,l(r(g.value.systemAnalysis)),1),e("td",m5,l(r(g.value.multimediaInterfaceDesign)),1),e("td",b5,l(r(g.value.serviceInterfaceDesign)),1),e("td",f5,l(r(g.value.systemDesign)),1),e("td",y5,l(r(g.value.softwareEngineering)),1),e("td",g5,l(r(g.value.humanComputerInterface)),1),e("td",x5,l(r(g.value.systemAnalysisAndDesign)),1),e("td",h5,l(r(g.value.introToITApplications)),1),S[87]||(S[87]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",w5,l(r(g.value.ictAndSecurity)),1),e("td",_5,l(r(g.value.networkSecurity)),1),e("td",k5,l(r(g.value.networkPlanningAndManagement)),1),e("td",$5,l(r(g.value.itPolicy)),1),S[88]||(S[88]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",C5,l(r(g.value.ictOverview)),1),e("td",E5,l(r(g.value.technicalStandards)),1),e("td",S5,l(r(g.value.networkArchitecture)),1),e("td",D5,l(r(g.value.securityProtectionTechnology)),1),e("td",M5,l(r(g.value.securityTheoryAndPractice)),1),S[89]||(S[89]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",A5,l(r(g.value.computerOverview)),1),e("td",I5,l(r(g.value.multimediaSystems)),1),e("td",R5,l(r(g.value.operatingSystems)),1),e("td",P5,l(r(g.value.introToComputers)),1),S[90]||(S[90]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",U5,l(r(g.value.programmingOverview)),1),e("td",N5,l(r(g.value.programmingLanguage)),1),e("td",T5,l(r(g.value.programming)),1),e("td",V5,l(r(g.value.machineLearning)),1),S[91]||(S[91]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",j5,l(r(g.value.securityManagement)),1),e("td",L5,l(r(g.value.securityPolicy)),1),e("td",F5,l(r(g.value.secureSystemDevelopment)),1),e("td",q5,l(r(g.value.securityRiskManagement)),1),e("td",O5,l(r(g.value.systemAudit)),1),e("td",B5,l(r(g.value.efficiencyAudit)),1),e("td",H5,l(r(g.value.businessContinuity)),1),S[92]||(S[92]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",W5,l(r(g.value.securityLaws)),1),e("td",z5,l(r(g.value.intelligenceSharing)),1),e("td",K5,l(r(g.value.incidentResponse)),1),S[93]||(S[93]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",J5,l(r(g.value.securityProtection)),1),e("td",Y5,l(r(g.value.malwareDetection)),1),e("td",G5,l(r(g.value.digitalForensics)),1),e("td",Q5,l(r(g.value.webSecurity)),1),e("td",Z5,l(r(g.value.penetrationTesting)),1),e("td",X5,l(r(g.value.securityTesting)),1),e("td",e3,l(r(g.value.networkDeploymentSecurity)),1),e("td",t3,l(r(g.value.vulnerabilityDetection)),1),S[94]||(S[94]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),S[95]||(S[95]=e("td",{class:"border p-2 text-center"},null,-1))]),e("tr",s3,[S[96]||(S[96]=e("td",{class:"border p-2 text-center sticky-col left-0 bg-[#E6D7E2]"},"加總",-1)),S[97]||(S[97]=e("td",{class:"border p-2 text-center sticky-col left-60 bg-[#E6D7E2]"},null,-1)),e("td",a3,l(r(a.value.cyberSecurityOverview)),1),e("td",o3,l(r(a.value.dataEncryption)),1),e("td",l3,l(r(a.value.securityMonitoring)),1),e("td",n3,l(r(a.value.networkCommunicationSecurity)),1),S[98]||(S[98]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",r3,l(r(a.value.databaseApplication)),1),e("td",i3,l(r(a.value.databaseStructurePlanning)),1),e("td",d3,l(r(a.value.databaseManagement)),1),e("td",u3,l(r(a.value.databaseSystems)),1),e("td",c3,l(r(a.value.databaseAndDataManagement)),1),S[99]||(S[99]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",p3,l(r(a.value.dataStructure)),1),e("td",v3,l(r(a.value.compilerDesign)),1),e("td",m3,l(r(a.value.aiTheoryAndApplication)),1),e("td",b3,l(r(a.value.artificialIntelligence)),1),S[100]||(S[100]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",f3,l(r(a.value.informationManagement)),1),e("td",y3,l(r(a.value.decisionSupport)),1),e("td",g3,l(r(a.value.itCompetencyDevelopment)),1),e("td",x3,l(r(a.value.systemAnalysis)),1),e("td",h3,l(r(a.value.multimediaInterfaceDesign)),1),e("td",w3,l(r(a.value.serviceInterfaceDesign)),1),e("td",_3,l(r(a.value.systemDesign)),1),e("td",k3,l(r(a.value.softwareEngineering)),1),e("td",$3,l(r(a.value.humanComputerInterface)),1),e("td",C3,l(r(a.value.systemAnalysisAndDesign)),1),e("td",E3,l(r(a.value.introToITApplications)),1),S[101]||(S[101]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",S3,l(r(a.value.ictAndSecurity)),1),e("td",D3,l(r(a.value.networkSecurity)),1),e("td",M3,l(r(a.value.networkPlanningAndManagement)),1),e("td",A3,l(r(a.value.itPolicy)),1),S[102]||(S[102]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",I3,l(r(a.value.ictOverview)),1),e("td",R3,l(r(a.value.technicalStandards)),1),e("td",P3,l(r(a.value.networkArchitecture)),1),e("td",U3,l(r(a.value.securityProtectionTechnology)),1),e("td",N3,l(r(a.value.securityTheoryAndPractice)),1),S[103]||(S[103]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",T3,l(r(a.value.computerOverview)),1),e("td",V3,l(r(a.value.multimediaSystems)),1),e("td",j3,l(r(a.value.operatingSystems)),1),e("td",L3,l(r(a.value.introToComputers)),1),S[104]||(S[104]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",F3,l(r(a.value.programmingOverview)),1),e("td",q3,l(r(a.value.programmingLanguage)),1),e("td",O3,l(r(a.value.programming)),1),e("td",B3,l(r(a.value.machineLearning)),1),S[105]||(S[105]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",H3,l(r(a.value.securityManagement)),1),e("td",W3,l(r(a.value.securityPolicy)),1),e("td",z3,l(r(a.value.secureSystemDevelopment)),1),e("td",K3,l(r(a.value.securityRiskManagement)),1),e("td",J3,l(r(a.value.systemAudit)),1),e("td",Y3,l(r(a.value.efficiencyAudit)),1),e("td",G3,l(r(a.value.businessContinuity)),1),S[106]||(S[106]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",Q3,l(r(a.value.securityLaws)),1),e("td",Z3,l(r(a.value.intelligenceSharing)),1),e("td",X3,l(r(a.value.incidentResponse)),1),S[107]||(S[107]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),e("td",eC,l(r(a.value.securityProtection)),1),e("td",tC,l(r(a.value.malwareDetection)),1),e("td",sC,l(r(a.value.digitalForensics)),1),e("td",aC,l(r(a.value.webSecurity)),1),e("td",oC,l(r(a.value.penetrationTesting)),1),e("td",lC,l(r(a.value.securityTesting)),1),e("td",nC,l(r(a.value.networkDeploymentSecurity)),1),e("td",rC,l(r(a.value.vulnerabilityDetection)),1),S[108]||(S[108]=e("td",{class:"border p-2 text-center border-r-2 border-r-black"},"-",-1)),S[109]||(S[109]=e("td",{class:"border p-2 text-center"},null,-1))])])])])])),!P.value&&T.value.length>0?(t(),s("div",iC,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===1||P.value,onClick:y}," 上一頁 ",8,dC),(t(!0),s(Z,null,re(f.value,Y=>(t(),s(Z,{key:Y},[Y!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":Y===N.value}]),disabled:P.value,onClick:fe=>w(Y)},l(Y),11,uC)):(t(),s("span",cC,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:N.value===K.value||P.value,onClick:V}," 下一頁 ",8,pC)])):J("",!0)]),j.value?(t(),s("div",vC,[e("div",mC,[S[110]||(S[110]=e("h3",{class:"text-lg font-medium mb-4"},"匯入學分認列資料",-1)),e("div",bC,[e("div",fC,[e("input",{type:"file",ref_key:"fileInput",ref:ue,class:"hidden",onChange:$e,accept:".xlsx,.xls,.csv"},null,544),e("p",yC,l(R.value?R.value.name:"請選擇 Excel 檔案"),1),e("button",{onClick:De,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]"}," 選擇檔案 ")]),U.value?(t(),s("p",gC,l(U.value),1)):J("",!0)]),e("div",xC,[e("button",{onClick:ke,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:te.value}," 取消 ",8,hC),e("button",{onClick:ve,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:!R.value||te.value},l(te.value?"上傳中...":"上傳"),9,wC)])])])):J("",!0)]))}},kC=Le(_C,[["__scopeId","data-v-a246cbd1"]]),$C={class:"w-full"},CC={class:"mb-6"},EC={class:"flex items-center space-x-4"},SC=["value"],DC={class:"relative w-60"},MC=["disabled"],AC={class:"overflow-auto"},IC={class:"w-full border-collapse"},RC={class:"bg-[#EEEFE7]"},PC={class:"border p-2"},UC={class:"flex items-center justify-center"},NC={key:0},TC={key:1},VC={key:2},jC={class:"border p-2"},LC={class:"flex items-center justify-center"},FC={key:0},qC={key:1},OC={key:2},BC={class:"border p-2"},HC={class:"flex items-center justify-center"},WC={key:0},zC={key:1},KC={key:2},JC={class:"border p-2"},YC={class:"flex items-center justify-center"},GC={key:0},QC={key:1},ZC={key:2},XC={class:"border p-2"},e8={class:"flex items-center justify-center"},t8={key:0},s8={key:1},a8={key:2},o8=["onClick"],l8={class:"border p-2 text-center"},n8={class:"border p-2 text-center"},r8={class:"border p-2 text-center"},i8={class:"border p-2 text-center"},d8={key:0},u8={colspan:"5",class:"border p-4 text-center"},c8={key:0,class:"flex justify-center items-center space-x-2 mt-6"},p8=["disabled"],v8=["onClick"],m8={key:1,class:"px-2"},b8=["disabled"],f8={__name:"NotApplied",props:{},emits:[],setup(D,{emit:x}){const d=We(),u=m([]),C=m(!1),o=m(""),N=m(""),K=m([{value:1,label:"機關薦派"},{value:2,label:"自行報名"}]),$=m(1),P=m(20),T=m(1),z=m(0),g=m(""),a=m("asc"),A=O=>{const _=K.value.find(E=>E.value===O);return _?_.label:"未知類別"},G=O=>{if(O==="-1"||O===-1||O===null)return"缺";if(!O||typeof O!="string"||O.length<5)return O;const _=O.substring(0,2),E=O.substring(O.length-3),L="*".repeat(O.length-5);return _+L+E},k=Se(()=>{const O=[];if(T.value<=5)for(let E=1;E<=T.value;E++)O.push(E);else{O.push(1);let E=Math.max(2,$.value-1),L=Math.min(T.value-1,$.value+1);$.value<=3&&(L=Math.min(4,T.value-1)),$.value>=T.value-2&&(E=Math.max(2,T.value-3)),E>2&&O.push("...");for(let j=E;j<=L;j++)O.push(j);L<T.value-1&&O.push("..."),O.push(T.value)}return O}),c=async()=>{var O;try{C.value=!0;const _=await _t.getExpenseList({page:$.value,limit:P.value,tab:1,status:N.value||void 0,keyword:o.value||void 0,sortBy:g.value||void 0,sortOrder:a.value||void 0});if(_.data&&_.data.code===0)u.value=_.data.data.list.map(E=>({studentId:E.studentId,studentCode:E.studentCode,studentName:E.studentName,idNumber:E.idNumber,agencyName:E.agencyName,category:b(E.subsidyCategory),credits:E.earnedCredits||0,studentIdentity:E.studentIdentity})),z.value=_.data.data.totalCount,T.value=_.data.data.totalPage,$.value=_.data.data.page;else throw new Error(((O=_.data)==null?void 0:O.message)||"獲取資料失敗")}catch(_){console.error("獲取未申請補助列表失敗:",_),v.showError("載入失敗",_.message||"獲取未申請補助列表失敗"),u.value=[],z.value=0,T.value=1}finally{C.value=!1}},b=O=>{const _=K.value.find(E=>E.label===O);return _?_.value:null},r=O=>{g.value===O?a.value=a.value==="asc"?"desc":"asc":(g.value=O,a.value="asc"),$.value=1,c()},f=O=>{O!==$.value&&($.value=O)},p=()=>{$.value>1&&$.value--},w=()=>{$.value<T.value&&$.value++};Ee($,()=>{c()}),je(()=>{c()});const y=O=>{d.push({path:"/expense",query:{studentId:O.studentId,studentName:O.studentName,idNumber:O.idNumber,studentCode:O.studentCode}}).catch(_=>{console.error("導航失敗:",_),v.showError("載入失敗","無法前往補助詳情頁面")}),console.log(`導航到學生 ${O.studentName} 的補助詳情頁面`)},V=()=>{o.value=""},W=()=>{$.value=1,c()};return(O,_)=>(t(),s("div",$C,[e("div",CC,[e("div",EC,[_[9]||(_[9]=e("span",null,"查詢條件:",-1)),I(e("select",{"onUpdate:modelValue":_[0]||(_[0]=E=>N.value=E),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(W,["enter"])},[_[7]||(_[7]=e("option",{value:""},"請選擇補助類別",-1)),(t(!0),s(Z,null,re(K.value,E=>(t(),s("option",{key:E.value,value:E.value},l(E.label),9,SC))),128))],544),[[Pe,N.value]]),e("div",DC,[I(e("input",{"onUpdate:modelValue":_[1]||(_[1]=E=>o.value=E),type:"text",placeholder:"請輸入姓名或身分證字號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ne(W,["enter"])},null,544),[[ee,o.value]]),o.value?(t(),s("button",{key:0,onClick:V,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},_[8]||(_[8]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:W,disabled:C.value}," 搜尋 ",8,MC)])]),_[15]||(_[15]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",null,[e("div",AC,[e("table",IC,[e("thead",null,[e("tr",RC,[e("th",PC,[e("div",UC,[_[10]||(_[10]=xe(" 機關名稱 ")),e("button",{onClick:_[2]||(_[2]=E=>r("agencyName")),class:"ml-1 focus:outline-none"},[g.value==="agencyName"&&a.value==="asc"?(t(),s("span",NC,"▲")):g.value==="agencyName"&&a.value==="desc"?(t(),s("span",TC,"▼")):(t(),s("span",VC,"⇅"))])])]),e("th",jC,[e("div",LC,[_[11]||(_[11]=xe(" 姓名 ")),e("button",{onClick:_[3]||(_[3]=E=>r("studentName")),class:"ml-1 focus:outline-none"},[g.value==="studentName"&&a.value==="asc"?(t(),s("span",FC,"▲")):g.value==="studentName"&&a.value==="desc"?(t(),s("span",qC,"▼")):(t(),s("span",OC,"⇅"))])])]),e("th",BC,[e("div",HC,[_[12]||(_[12]=xe(" 身分證字號 ")),e("button",{onClick:_[4]||(_[4]=E=>r("idNumber")),class:"ml-1 focus:outline-none"},[g.value==="idNumber"&&a.value==="asc"?(t(),s("span",WC,"▲")):g.value==="idNumber"&&a.value==="desc"?(t(),s("span",zC,"▼")):(t(),s("span",KC,"⇅"))])])]),e("th",JC,[e("div",YC,[_[13]||(_[13]=xe(" 補助類別 ")),e("button",{onClick:_[5]||(_[5]=E=>r("subsidyCategory")),class:"ml-1 focus:outline-none"},[g.value==="subsidyCategory"&&a.value==="asc"?(t(),s("span",GC,"▲")):g.value==="subsidyCategory"&&a.value==="desc"?(t(),s("span",QC,"▼")):(t(),s("span",ZC,"⇅"))])])]),e("th",XC,[e("div",e8,[_[14]||(_[14]=xe(" 已取得學分數 ")),e("button",{onClick:_[6]||(_[6]=E=>r("earnedCredits")),class:"ml-1 focus:outline-none"},[g.value==="earnedCredits"&&a.value==="asc"?(t(),s("span",t8,"▲")):g.value==="earnedCredits"&&a.value==="desc"?(t(),s("span",s8,"▼")):(t(),s("span",a8,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(u.value,E=>(t(),s("tr",{key:E.id,class:"hover:bg-gray-100 cursor-pointer",onClick:L=>y(E)},[e("td",l8,l(E.agencyName),1),e("td",{class:X(["border p-2 text-center",{"text-black":E.studentIdentity===1,"text-blue-500":E.studentIdentity===2}])},l(E.studentName),3),e("td",n8,l(G(E.idNumber)),1),e("td",r8,l(A(E.category)),1),e("td",i8,l(E.credits),1)],8,o8))),128)),u.value.length===0?(t(),s("tr",d8,[e("td",u8,l(C.value?"載入中...":"無符合條件的資料"),1)])):J("",!0)])])]),!C.value&&u.value.length>0?(t(),s("div",c8,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===1,onClick:p}," 上一頁 ",8,p8),(t(!0),s(Z,null,re(k.value,E=>(t(),s(Z,{key:E},[E!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":E===$.value}]),onClick:L=>f(E)},l(E),11,v8)):(t(),s("span",m8,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===T.value,onClick:w}," 下一頁 ",8,b8)])):J("",!0)])]))}},y8=Le(f8,[["__scopeId","data-v-c013f18d"]]),g8={class:"w-full"},x8={class:"mb-6"},h8={class:"flex items-center space-x-4"},w8=["value"],_8={class:"relative w-60"},k8=["disabled"],$8={class:"overflow-auto"},C8={class:"w-full border-collapse"},E8={class:"bg-[#EEEFE7]"},S8={class:"border p-2"},D8={class:"flex items-center justify-center"},M8={key:0},A8={key:1},I8={key:2},R8={class:"border p-2"},P8={class:"flex items-center justify-center"},U8={key:0},N8={key:1},T8={key:2},V8={class:"border p-2"},j8={class:"flex items-center justify-center"},L8={key:0},F8={key:1},q8={key:2},O8={class:"border p-2"},B8={class:"flex items-center justify-center"},H8={key:0},W8={key:1},z8={key:2},K8=["onClick"],J8={class:"border p-2 text-center"},Y8={class:"border p-2 text-center"},G8={class:"border p-2 text-center"},Q8={class:"border p-2 text-center"},Z8={key:0},X8={colspan:"5",class:"border p-4 text-center"},eE={key:0,class:"flex justify-center items-center space-x-2 mt-6"},tE=["disabled"],sE=["onClick"],aE={key:1,class:"px-2"},oE=["disabled"],lE={__name:"AlreadyApplied",props:{},emits:[],setup(D,{emit:x}){const d=We(),u=m([]),C=m(!1),o=m(""),N=m(""),K=m([{value:1,label:"待申請"},{value:2,label:"審核中"},{value:3,label:"已完成"},{value:4,label:"已撥款"},{value:5,label:"待補件，不合格"}]),$=m(1),P=m(20),T=m(1),z=m(0),g=m(""),a=m("asc"),A=W=>{const O=K.value.find(_=>_.value===W);return O?O.label:"未知狀態"},G=W=>{switch(parseInt(W)){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return""}},k=Se(()=>{const W=[];if(T.value<=5)for(let _=1;_<=T.value;_++)W.push(_);else{W.push(1);let _=Math.max(2,$.value-1),E=Math.min(T.value-1,$.value+1);$.value<=3&&(E=Math.min(4,T.value-1)),$.value>=T.value-2&&(_=Math.max(2,T.value-3)),_>2&&W.push("...");for(let L=_;L<=E;L++)W.push(L);E<T.value-1&&W.push("..."),W.push(T.value)}return W}),c=async()=>{var W;try{C.value=!0;const O=await _t.getExpenseList({page:$.value,limit:P.value,tab:2,status:N.value||void 0,keyword:o.value||void 0,sortBy:g.value||void 0,sortOrder:a.value||void 0});if(O.data&&O.data.code===0)u.value=O.data.data.list.map(_=>({id:_.id,studentId:_.studentId,serialNumber:_.number,studentName:_.studentName,idNumber:_.idNumber,applyDate:_.applicationTime,status:_.status})),z.value=O.data.data.totalCount,T.value=O.data.data.totalPage,$.value=O.data.data.page;else throw new Error(((W=O.data)==null?void 0:W.message)||"獲取資料失敗")}catch(O){console.error("獲取已申請補助列表失敗:",O),v.showError("載入失敗",O.message||"獲取已申請補助列表失敗"),u.value=[],z.value=0,T.value=1}finally{C.value=!1}},b=W=>{g.value===W?a.value=a.value==="asc"?"desc":"asc":(g.value=W,a.value="asc"),$.value=1,c()},r=W=>{W!==$.value&&($.value=W)},f=()=>{$.value>1&&$.value--},p=()=>{$.value<T.value&&$.value++};Ee($,()=>{c()}),je(()=>{c()});const w=W=>{d.push({path:"/expense",query:{verificationId:W.id,studentId:W.studentId,serialNumber:W.serialNumber,studentName:W.studentName,status:W.status,totalAmount:W.totalAmount,tab:"applications"}}).catch(O=>{console.error("導航失敗:",O),v.showError("導航失敗","無法前往補助詳情頁面")}),console.log(`導航到申請 ${W.serialNumber} (驗證ID: ${W.id}, 學生ID: ${W.studentId}) 的補助詳情頁面，顯示申請表單標籤`)},y=()=>{o.value=""},V=()=>{$.value=1,c()};return(W,O)=>(t(),s("div",g8,[e("div",x8,[e("div",h8,[O[8]||(O[8]=e("span",null,"查詢條件:",-1)),I(e("select",{"onUpdate:modelValue":O[0]||(O[0]=_=>N.value=_),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(V,["enter"])},[O[6]||(O[6]=e("option",{value:""},"請選擇申請狀態",-1)),(t(!0),s(Z,null,re(K.value,_=>(t(),s("option",{key:_.value,value:_.value},l(_.label),9,w8))),128))],544),[[Pe,N.value]]),e("div",_8,[I(e("input",{"onUpdate:modelValue":O[1]||(O[1]=_=>o.value=_),type:"text",placeholder:"請輸入姓名或單號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ne(V,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[ee,o.value]]),o.value?(t(),s("button",{key:0,onClick:y,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},O[7]||(O[7]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:V,disabled:C.value}," 搜尋 ",8,k8)])]),O[13]||(O[13]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",null,[e("div",$8,[e("table",C8,[e("thead",null,[e("tr",E8,[e("th",S8,[e("div",D8,[O[9]||(O[9]=xe(" 單號 ")),e("button",{onClick:O[2]||(O[2]=_=>b("number")),class:"ml-1 focus:outline-none"},[g.value==="number"&&a.value==="asc"?(t(),s("span",M8,"▲")):g.value==="number"&&a.value==="desc"?(t(),s("span",A8,"▼")):(t(),s("span",I8,"⇅"))])])]),e("th",R8,[e("div",P8,[O[10]||(O[10]=xe(" 姓名 ")),e("button",{onClick:O[3]||(O[3]=_=>b("studentName")),class:"ml-1 focus:outline-none"},[g.value==="studentName"&&a.value==="asc"?(t(),s("span",U8,"▲")):g.value==="studentName"&&a.value==="desc"?(t(),s("span",N8,"▼")):(t(),s("span",T8,"⇅"))])])]),e("th",V8,[e("div",j8,[O[11]||(O[11]=xe(" 申請日期 ")),e("button",{onClick:O[4]||(O[4]=_=>b("applicationTime")),class:"ml-1 focus:outline-none"},[g.value==="applicationTime"&&a.value==="asc"?(t(),s("span",L8,"▲")):g.value==="applicationTime"&&a.value==="desc"?(t(),s("span",F8,"▼")):(t(),s("span",q8,"⇅"))])])]),e("th",O8,[e("div",B8,[O[12]||(O[12]=xe(" 申請狀態 ")),e("button",{onClick:O[5]||(O[5]=_=>b("status")),class:"ml-1 focus:outline-none"},[g.value==="status"&&a.value==="asc"?(t(),s("span",H8,"▲")):g.value==="status"&&a.value==="desc"?(t(),s("span",W8,"▼")):(t(),s("span",z8,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(u.value,_=>(t(),s("tr",{key:_.id,class:"hover:bg-gray-100 cursor-pointer",onClick:E=>w(_)},[e("td",J8,l(_.serialNumber),1),e("td",Y8,l(_.studentName),1),e("td",G8,l(_.applyDate),1),e("td",Q8,[e("span",{class:X(["px-2 py-1 rounded text-sm",G(parseInt(_.status))])},l(A(parseInt(_.status))),3)])],8,K8))),128)),u.value.length===0?(t(),s("tr",Z8,[e("td",X8,l(C.value?"載入中...":"無符合條件的資料"),1)])):J("",!0)])])]),!C.value&&u.value.length>0?(t(),s("div",eE,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===1,onClick:f}," 上一頁 ",8,tE),(t(!0),s(Z,null,re(k.value,_=>(t(),s(Z,{key:_},[_!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":_===$.value}]),onClick:E=>r(_)},l(_),11,sE)):(t(),s("span",aE,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:$.value===T.value,onClick:p}," 下一頁 ",8,oE)])):J("",!0)])]))}},nE=Le(lE,[["__scopeId","data-v-3670cbbf"]]),rE={class:"w-full"},iE={class:"mb-6"},dE={class:"flex items-center space-x-4"},uE=["value"],cE={class:"relative w-60"},pE=["disabled"],vE={class:"overflow-x-auto"},mE={class:"w-full border-collapse"},bE={class:"border p-2"},fE={class:"flex items-center justify-center"},yE={key:0},gE={key:1},xE={key:2},hE={class:"border p-2"},wE={class:"flex items-center justify-center"},_E={key:0},kE={key:1},$E={key:2},CE={class:"border p-2"},EE={class:"flex items-center justify-center"},SE={key:0},DE={key:1},ME={key:2},AE={class:"border p-2"},IE={class:"flex items-center justify-center"},RE={key:0},PE={key:1},UE={key:2},NE=["onClick"],TE={class:"border p-2 text-center"},VE={class:"border p-2 text-center"},jE={class:"border p-2 text-center"},LE={class:"border p-2 text-center"},FE={key:0},qE={colspan:"4",class:"border p-4 text-center"},OE={key:0,class:"flex justify-center items-center space-x-2 mt-6"},BE=["disabled"],HE=["onClick"],WE={key:1,class:"px-2"},zE=["disabled"],KE={__name:"RemittanceList",setup(D){const x=We(),d=m(""),u=m(""),C=m(!1),o=m([]),N=m([{value:1,label:"彙整中"},{value:2,label:"審核中"},{value:3,label:"已完成"},{value:4,label:"已撥款"}]),K=m(1),$=m(20),P=m(5),T=m(1),z=m(""),g=m("asc"),a=m({verificationCreate:!1}),A=E=>E==null?"$------":`$${E.toLocaleString()}`,G=E=>{switch(parseInt(E)){case 1:return"彙整中";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";default:return"未知狀態"}},k=E=>{switch(typeof E=="string"?parseInt(E):E){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};Se(()=>o.value.length>0&&o.value.every(E=>E.selected));const c=Se(()=>{const E=[];if(T.value<=5)for(let j=1;j<=T.value;j++)E.push(j);else{E.push(1);let j=Math.max(2,K.value-1),R=Math.min(T.value-1,K.value+1);K.value<=3&&(R=Math.min(4,T.value-1)),K.value>=T.value-2&&(j=Math.max(2,T.value-3)),j>2&&E.push("...");for(let U=j;U<=R;U++)E.push(U);R<T.value-1&&E.push("..."),E.push(T.value)}return E}),b=E=>{z.value===E?g.value=g.value==="asc"?"desc":"asc":(z.value=E,g.value="asc"),K.value=1,w()},r=E=>{E!==K.value&&(K.value=E,w())},f=()=>{K.value>1&&(K.value--,w())},p=()=>{K.value<T.value&&(K.value++,w())},w=async()=>{var E;try{C.value=!0;const L={page:K.value,limit:$.value,tab:3,status:d.value||void 0,keyword:u.value||void 0,sortBy:z.value||void 0,sortOrder:g.value||void 0},j=await _t.getExpenseList(L);if(j.data&&j.data.code===0){const R=j.data.data;if(o.value=R.list.map(U=>({id:U.remittanceId,applicationDate:U.applicationDate,batchNumber:U.batchNumber,applicationAmount:U.applicationAmount,status:U.status,selected:!1})),P.value=R.totalCount,T.value=R.totalPage,K.value>T.value&&T.value>0&&(K.value=T.value,R.page!==K.value)){w();return}}else{const R=((E=j.data)==null?void 0:E.message)||"獲取匯款清單失敗，請稍後再試";throw new Error(R)}}catch(L){console.error("獲取匯款清單失敗:",L),v.showError("載入失敗",L.message||"獲取匯款清單失敗"),o.value=[],P.value=0,T.value=1}finally{C.value=!1}},y=()=>{x.push("/remittance")},V=E=>{x.push({path:"/remittance-edit",query:{id:E}})},W=async()=>{try{const E=await tt.getSidebarPermissions();E.data.code===0&&E.data.message==="success"?(a.value=E.data.data,console.log("匯款清單頁面權限:",a.value)):console.error("獲取權限失敗:",E.data.message)}catch(E){console.error("獲取權限錯誤:",E)}};je(()=>{w(),W()});const O=()=>{u.value=""},_=()=>{K.value=1,w()};return(E,L)=>(t(),s("div",rE,[e("div",iE,[e("div",dE,[L[8]||(L[8]=e("span",null,"查詢條件:",-1)),I(e("select",{"onUpdate:modelValue":L[0]||(L[0]=j=>d.value=j),class:"p-2 border border-gray-300 outline-none w-40",onKeyup:Ne(_,["enter"])},[L[6]||(L[6]=e("option",{value:""},"請選擇匯款狀態",-1)),(t(!0),s(Z,null,re(N.value,j=>(t(),s("option",{key:j.value,value:j.value},l(j.label),9,uE))),128))],544),[[Pe,d.value]]),e("div",cE,[I(e("input",{"onUpdate:modelValue":L[1]||(L[1]=j=>u.value=j),type:"text",placeholder:"請輸入批號",class:"p-2 border border-gray-300 outline-none w-full",onKeyup:Ne(_,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:O,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},L[7]||(L[7]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:_,disabled:C.value}," 搜尋 ",8,pE),L[9]||(L[9]=e("div",{class:"flex-1"},null,-1)),a.value.verificationCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:y}," 新增匯款清單 ")):J("",!0)])]),L[14]||(L[14]=e("div",{class:"h-[1px] bg-gray-300 my-6"},null,-1)),e("div",vE,[e("table",mE,[e("thead",null,[e("tr",null,[e("th",bE,[e("div",fE,[L[10]||(L[10]=xe(" 申請日期 ")),e("button",{onClick:L[2]||(L[2]=j=>b("applicationDate")),class:"ml-1 focus:outline-none"},[z.value==="applicationDate"&&g.value==="asc"?(t(),s("span",yE,"▲")):z.value==="applicationDate"&&g.value==="desc"?(t(),s("span",gE,"▼")):(t(),s("span",xE,"⇅"))])])]),e("th",hE,[e("div",wE,[L[11]||(L[11]=xe(" 批號 ")),e("button",{onClick:L[3]||(L[3]=j=>b("batchNumber")),class:"ml-1 focus:outline-none"},[z.value==="batchNumber"&&g.value==="asc"?(t(),s("span",_E,"▲")):z.value==="batchNumber"&&g.value==="desc"?(t(),s("span",kE,"▼")):(t(),s("span",$E,"⇅"))])])]),e("th",CE,[e("div",EE,[L[12]||(L[12]=xe(" 申請金額 ")),e("button",{onClick:L[4]||(L[4]=j=>b("applicationAmount")),class:"ml-1 focus:outline-none"},[z.value==="applicationAmount"&&g.value==="asc"?(t(),s("span",SE,"▲")):z.value==="applicationAmount"&&g.value==="desc"?(t(),s("span",DE,"▼")):(t(),s("span",ME,"⇅"))])])]),e("th",AE,[e("div",IE,[L[13]||(L[13]=xe(" 匯款清單狀態 ")),e("button",{onClick:L[5]||(L[5]=j=>b("status")),class:"ml-1 focus:outline-none"},[z.value==="status"&&g.value==="asc"?(t(),s("span",RE,"▲")):z.value==="status"&&g.value==="desc"?(t(),s("span",PE,"▼")):(t(),s("span",UE,"⇅"))])])])])]),e("tbody",null,[(t(!0),s(Z,null,re(o.value,(j,R)=>(t(),s("tr",{key:j.id,class:X([{"bg-[#F7F7F7]":R%2===1},"hover:bg-gray-100 cursor-pointer"]),onClick:U=>V(j.id)},[e("td",TE,l(j.applicationDate),1),e("td",VE,l(j.batchNumber),1),e("td",jE,l(A(j.applicationAmount)),1),e("td",LE,[e("span",{class:X(["px-2 py-1 rounded text-sm",k(j.status)])},l(G(j.status)),3)])],10,NE))),128)),o.value.length===0?(t(),s("tr",FE,[e("td",qE,l(C.value?"載入中...":"無符合條件的資料"),1)])):J("",!0)])])]),!C.value&&o.value.length>0?(t(),s("div",OE,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:K.value===1,onClick:f}," 上一頁 ",8,BE),(t(!0),s(Z,null,re(c.value,j=>(t(),s(Z,{key:j},[j!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":j===K.value}]),onClick:R=>r(j)},l(j),11,HE)):(t(),s("span",WE,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:K.value===T.value,onClick:p}," 下一頁 ",8,zE)])):J("",!0)]))}},JE=Le(KE,[["__scopeId","data-v-a064cab5"]]),YE={class:"flex flex-col items-center p-6"},GE={class:"w-full max-w-[1500px]"},QE={class:"w-full max-w-[1500px]"},ZE={class:"flex border-b border-gray-300"},XE={class:"w-full max-w-[1500px] mt-6"},e6={key:0},t6={key:1},s6={key:2},a6={__name:"ExpenseList",setup(D){const x=lt(),d=We(),u=m("notApplied");return Ee(()=>u.value,C=>{d.replace({query:{...x.query,tab:C}})}),je(()=>{if(x.query.tab){const C=x.query.tab;["notApplied","alreadyApplied","remittance"].includes(C)&&(u.value=C)}else d.replace({query:{...x.query,tab:u.value}})}),(C,o)=>(t(),s("div",YE,[e("div",GE,[Qe(pt,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"}]})]),e("div",QE,[e("div",ZE,[e("button",{class:X(["py-2 px-4 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="notApplied","text-gray-600 hover:text-gray-800":u.value!=="notApplied"}]),onClick:o[0]||(o[0]=N=>u.value="notApplied")}," 學員名單 ",2),e("button",{class:X(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="alreadyApplied","text-gray-600 hover:text-gray-800":u.value!=="alreadyApplied"}]),onClick:o[1]||(o[1]=N=>u.value="alreadyApplied")}," 申請表單 ",2),e("button",{class:X(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":u.value==="remittance","text-gray-600 hover:text-gray-800":u.value!=="remittance"}]),onClick:o[2]||(o[2]=N=>u.value="remittance")}," 匯款清單 ",2)])]),e("div",XE,[u.value==="notApplied"?(t(),s("div",e6,[Qe(y8)])):J("",!0),u.value==="alreadyApplied"?(t(),s("div",t6,[Qe(nE)])):J("",!0),u.value==="remittance"?(t(),s("div",s6,[Qe(JE)])):J("",!0)])]))}},o6=Le(a6,[["__scopeId","data-v-e6d1bc2c"]]),l6={class:"flex flex-col items-center p-6"},n6={class:"w-full max-w-[1500px]"},r6={class:"w-full max-w-[1500px]"},i6={class:"mb-4 flex justify-between"},d6={class:"text-xl font-bold mr-4"},u6={class:"text-xl font-bold"},c6={class:"flex flex-wrap items-center space-x-4 mb-4"},p6={class:"flex items-center mr-4"},v6={class:"flex items-center mr-4"},m6={class:"flex flex-wrap items-center space-x-4 mb-4"},b6={class:"flex items-center mr-4"},f6={class:"flex items-center"},y6={class:"flex items-center"},g6={class:"flex items-center"},x6={class:"flex items-center"},h6={class:"flex items-center"},w6={class:"flex items-center"},_6={class:"flex items-center ml-auto"},k6={class:"overflow-x-auto"},$6={class:"w-full border-collapse min-w-full max-w-[1500px]"},C6={class:"border p-2 sticky left-0 bg-[#EEEFE7] z-10"},E6=["checked"],S6=["id","onUpdate:modelValue","aria-label"],D6={class:"border p-2 text-center"},M6={class:"border p-2 text-center"},A6={class:"border p-2 text-center"},I6={class:"border p-2 text-center whitespace-pre-line"},R6={class:"border p-2 text-center"},P6={class:"border p-2 text-center"},U6={class:"border p-2 text-center"},N6={class:"border p-2 text-center"},T6={class:"border p-2 text-center"},V6={class:"border p-2 text-center"},j6={class:"border p-2 text-center"},L6={class:"border p-2 text-center"},F6=["id","onUpdate:modelValue","aria-label"],q6={class:"border p-2 text-center"},O6=["id","onUpdate:modelValue","aria-label"],B6={class:"border p-2 text-center"},H6={class:"flex flex-col items-center space-y-2"},W6=["for"],z6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},K6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],J6=["for"],Y6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},G6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],Q6=["for"],Z6={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},X6=["id","onUpdate:modelValue","disabled","aria-label","onChange"],e7=["for"],t7={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},s7=["id","onUpdate:modelValue","disabled","aria-label","onChange"],a7={class:"mt-4 mb-4 text-base"},o7={class:"font-bold"},l7={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},n7={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},r7={class:"border border-gray-300 p-4 mb-4"},i7={class:"mb-4"},d7={class:"flex items-center mb-4"},u7={class:"flex items-center space-x-4"},c7={class:"flex items-center"},p7={class:"flex items-center"},v7={class:"flex items-center"},m7={class:"flex items-center mb-4"},b7={class:"flex items-center"},f7={class:"flex items-center mb-4"},y7={class:"flex items-center"},g7={class:"flex items-center mt-1 ml-32"},x7={class:"border-b border-black w-full"},h7={class:"mt-4 p-3 border border-gray-300 mb-4"},w7={class:"grid grid-cols-2 gap-4"},_7={class:"border-b border-black w-full"},k7={class:"border-b border-black w-full"},$7={class:"border-b border-black w-full"},C7={class:"border-b border-black w-full"},E7={key:0,class:"ml-7"},S7={class:"mt-2"},D7={class:"flex items-start mb-2"},M7={class:"flex items-start mb-2"},A7={class:"flex items-start"},I7={class:"border-b border-black w-64 ml-2"},R7=["disabled"],P7={class:"flex justify-center space-x-2"},U7=["disabled"],N7={__name:"GrantApplication",setup(D){const x=lt(),d=We(),u=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:"",applicationNumber:"",applicationDate:""}),C=m(""),o=m("bank"),N=m(!1),K=m(null);m("");const $=m(""),P=m(""),T=m(""),z=m(""),g=m(0),a=m(0),A=m(0),G=m(""),k=m(""),c=Se(()=>!(!a.value||!g.value||Number(g.value)===2&&(!A.value||Number(A.value)===3&&!G.value.trim())));Ee(()=>o.value,i=>{console.log(`watch: 帳戶類型從舊值變更為新值: ${i}`),i==="post"&&(u.value.bankCode="700")});const b=m(""),r=m([]),f=m(!1),p=Se(()=>[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:u.value.id?`/expense?studentId=${u.value.id}`:"/expense-list"},{name:"申請單",path:"/expense-application"}]),w=Se(()=>r.value.filter(i=>i.selected).length),y=Se(()=>r.value.length>0&&r.value.every(i=>i.selected)),V=i=>i==null?"$------":`$${i.toLocaleString()}`,W=i=>{if(!i)return!0;const n=/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/;if(!n.test(i))return!1;const h=i.match(n),be=parseInt(h[1])+1911,_e=parseInt(h[2])-1,Ve=parseInt(h[3]);let st=new Date(be,_e,Ve);return st.getFullYear()===be&&st.getMonth()===_e&&st.getDate()===Ve},O=(i,n)=>{const h=i.target.value,_e=h.replace(/[^\d/-]/g,"").slice(0,10);h!==_e&&(u.value[n]=_e)},_=i=>{console.log("toggleSelectAll: 觸發全選/取消全選功能。",i.target.checked);const n=i.target.checked;r.value.forEach(h=>{h.selected=n})},E=()=>{const i=r.value.filter(n=>n.selected||n.isSelected===!0);return i.length===0?(v.showError("貼心提醒","請至少選擇一門課程進行申請"),null):i},L=i=>i.some(h=>h.is80===2||h.is80===3||h.is15===2||h.is15===3||h.is5===2||h.is5===3||h.is0===2||h.is0===3?!1:!h.selected80&&!h.selected15&&!h.selected5&&!h.selected0)?(v.showError("貼心提醒","請為每個選中的課程選擇申請比例"),!1):!0,j=()=>!b.value||b.value<=0?(v.showError("貼心提醒","請輸入有效的收據金額"),!1):!0,R=i=>i.some(h=>!h.creditFee||h.creditFee<=0)?(v.showError("貼心提醒","請為所有選中的課程輸入有效的學分費"),!1):!0,U=i=>i.some(h=>(h.selected5||h.is5===2)&&(!h.securityWorkDetail||h.securityWorkDetail.trim()===""))?(v.showError("貼心提醒","請為所有選擇5%補助比例的課程填寫投入資安工作明細"),!1):!0,te=()=>{const i=u.value.applicationNumber.trim(),n=u.value.applicationDate.trim();if(!i||!n)return!0;const h=n.match(/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/);if(!h)return!1;const be=h[1],_e=h[2].padStart(2,"0"),Ve=`${be}${_e}`;return new RegExp(`^${Ve}.{4}$`).test(i)?!0:(v.showError("貼心提醒",`申請單號格式不正確。應為 "${Ve}xxxx" (xxxx為任意4碼字元)`),!1)},ue=i=>{const n=i.filter(h=>(h.selected5||h.is5===2)&&h.selectItem===1&&(!h.jobDescription||h.jobDescription!==1));if(n.length>0){v.showError("貼心提醒","請為所有選擇5%補助比例且已投入資安工作的課程填寫職務內容");const h=r.value.findIndex(be=>be.id===n[0].id);return h!==-1&&(K.value=h,setTimeout(()=>{Be()},500)),!1}return!0},ye=i=>{const n=i.some(_e=>_e.selected5||_e.is5===2||_e.is5===3),h=n?i.find(_e=>_e.selected5||_e.is5===2||_e.is5===3):null,be=(_e,Ve)=>_e===3?3:Ve||_e===2?2:1;return{studentId:u.value.id,bankCode:u.value.bankCode,branchCode:u.value.branchCode,bankAccount:u.value.bankAccount,accountType:o.value,receiptAmount:parseFloat(b.value)||0,number:u.value.applicationNumber||null,applicationDate:u.value.applicationDate||null,selectItem:n&&(h==null?void 0:h.selectItem)||0,originalPosition:n&&(h==null?void 0:h.originalPosition)||"",currentPosition:n&&(h==null?void 0:h.currentPosition)||"",originalAgency:n&&(h==null?void 0:h.originalAgency)||"",currentAgency:n&&(h==null?void 0:h.currentAgency)||"",transferDate:n&&(h==null?void 0:h.transferDate)||"",fillMethod:n?h==null?void 0:h.fillMethod:void 0,trackingReasonOption:n&&(h==null?void 0:h.selectItem)===2&&(h==null?void 0:h.trackingReasonOption)||0,trackingReasonDetail:n&&(h==null?void 0:h.selectItem)===2&&(h==null?void 0:h.trackingReasonDetail)||"",details:i.map(_e=>{const Ve=be(_e.is80,_e.selected80),st=be(_e.is15,_e.selected15),it=be(_e.is5,_e.selected5);return{learningHistoryId:_e.id,remark:_e.remark||null,is80:Ve,is15:st,is5:it,is0:be(_e.is0,_e.selected0),creditFee:parseFloat(_e.creditFee)||0,isSelected:_e.selected||_e.isSelected===!0}})}},ke=async()=>{var i;console.log("saveApplication: 開始儲存申請單。");try{const n=E();if(!n){console.log("saveApplication: 未選擇任何課程，停止儲存。");return}if(f.value=!0,!L(n)){console.log("saveApplication: 申請比例驗證失敗。"),f.value=!1;return}if(!j()){console.log("saveApplication: 收據金額驗證失敗。"),f.value=!1;return}if(!R(n)){console.log("saveApplication: 學分費驗證失敗。"),f.value=!1;return}if(!U(n)){console.log("saveApplication: 資安工作明細驗證失敗。"),f.value=!1;return}if(!ue(n)){console.log("saveApplication: 職務內容驗證失敗。"),f.value=!1;return}if(!u.value.applicationNumber||u.value.applicationNumber.trim()===""){v.showError("貼心提醒","申請單號為必填欄位"),f.value=!1;return}if(!te()){f.value=!1;return}if(!u.value.applicationDate||u.value.applicationDate.trim()===""){v.showError("貼心提醒","申請日期為必填欄位"),f.value=!1;return}if(!W(u.value.applicationDate)){v.showError("貼心提醒","申請日期格式不正確，請輸入民國年格式(如：113/01/01)"),f.value=!1;return}const h=ye(n);console.log("saveApplication: 準備提交的數據：",h);const be=await _t.createExpense(h);if(console.log("saveApplication: API 回傳：",be.data),be.data&&be.data.code===0)console.log("saveApplication: 申請單儲存成功。"),v.showSuccess("貼心提醒","申請單已成功儲存"),d.push({path:"/expense",query:{studentId:u.value.id,tab:"applications"}});else{const _e=((i=be.data)==null?void 0:i.message)||"儲存失敗，請確認資料後再試";throw console.log("saveApplication: API 回傳失敗，錯誤訊息：",_e),new Error(_e)}}catch(n){console.error("儲存申請單失敗:",n),v.showError("貼心提醒",n.message||"儲存申請單失敗，請稍後再試")}finally{console.log("saveApplication: 儲存申請單流程結束。"),f.value=!1}},De=i=>{u.value={id:i.studentId,studentName:i.studentName,bankCode:i.bankCode||"",branchCode:i.branchCode||"",bankAccount:i.bankAccount||"",studentIdentity:i.studentIdentity,applicationNumber:i.applicationNumber||"",applicationDate:i.applicationDate||""},C.value=i.agencyName},$e=i=>{i.accountType?o.value=i.accountType:i.bankType?o.value=i.bankType===1?"bank":"post":o.value=i.bankCode==="700"?"post":"bank",o.value==="post"&&(u.value.bankCode="700")},ve=i=>{const n=i.selectItem||0,h=i.originalPosition||"",be=i.currentPosition||"",_e=i.originalAgency||"",Ve=i.currentAgency||"",st=i.fillMethod||0,it=i.trackingReasonOption||0,ut=i.trackingReasonDetail||"",ht=i.transferDate||"";r.value=i.histories.map(qe=>({id:qe.learningHistoryId,courseCode:qe.courseCode,courseName:qe.courseName,schoolName:qe.schoolName,startDate:qe.startDate,endDate:qe.endDate,hours:qe.hours,status:qe.status,certificateNumber:qe.certificateNumber,credits:qe.credits,subsidyCount:qe.subsidyCount,applied:qe.applied,remark:qe.remark||"",accumulatedSubsidy:qe.approvedAmount||0,selected:qe.isSelected||!1,selected80:!1,selected15:!1,selected5:!1,selected0:!1,is80:qe.is80||1,is15:qe.is15||1,is5:qe.is5||1,is0:qe.is0||1,creditFee:qe.creditFee||0,securityWorkDetail:qe.securityWorkDetail||"",isSecurityWorkConfirmed:!1,selectItem:n,originalPosition:h,currentPosition:be,originalAgency:_e,currentAgency:Ve,fillMethod:st,trackingReasonOption:it,trackingReasonDetail:ut,transferDate:ht}))},oe=async()=>{var i;console.log("fetchExpenseDetails: 開始獲取費用核撥詳情。");try{const n=x.query.studentId;if(console.log("fetchExpenseDetails: 獲取學生ID：",n),!n){console.log("fetchExpenseDetails: 缺少學生ID，即將返回列表頁。"),v.showError("貼心提醒","缺少必要的參數，即將返回列表頁"),d.push("/expense-list");return}const h=await _t.getStudentInfo(n,1);if(console.log("fetchExpenseDetails: API 回傳：",h.data),h.data&&h.data.code===0){console.log("fetchExpenseDetails: 成功獲取資料。");const be=h.data.data;De(be),$e(be),ve(be)}else{const be=((i=h.data)==null?void 0:i.message)||"獲取資料失敗，請稍後再試";throw console.log("fetchExpenseDetails: API 回傳失敗，錯誤訊息：",be),new Error(be)}}catch(n){console.error("獲取費用核撥詳情失敗:",n),v.showError("貼心提醒","獲取費用核撥詳情失敗，即將返回列表頁"),d.push("/expense-list")}};Ee(()=>r.value.map(i=>i.selected),i=>{console.log("watch: 課程選中狀態已更新。",i),r.value.forEach((n,h)=>{n.selected})},{deep:!0}),je(()=>{console.log("onMounted: 元件已掛載，開始獲取費用核撥詳情。"),oe()});const q=i=>{console.log("openSecurityWorkModal: 打開安全工作明細彈窗，索引：",i),K.value=i;const n=r.value[i];g.value=n.selectItem||0,a.value=n.fillMethod||0,$.value=n.originalPosition||"",P.value=n.currentPosition||"",T.value=n.originalAgency||"",z.value=n.currentAgency||"",A.value=n.trackingReasonOption||0,G.value=n.trackingReasonDetail||"",k.value=n.transferDate||"",N.value=!0},S=i=>{r.value[i].selectItem=g.value,r.value[i].originalPosition=$.value,r.value[i].currentPosition=P.value,r.value[i].originalAgency=T.value,r.value[i].currentAgency=z.value,r.value[i].fillMethod=a.value,r.value[i].trackingReasonOption=A.value,r.value[i].trackingReasonDetail=G.value,r.value[i].transferDate=k.value},Y=()=>{let i="是，已投入資安工作。";return T.value&&z.value&&T.value!==z.value&&(i+=`
原機關：${T.value}，調任機關：${z.value}。`),$.value&&P.value&&$.value!==P.value&&(i+=`
原職系：${$.value}，調任職系：${P.value}。`),k.value&&(i+=`
調任日期：${k.value}。`),i},fe=()=>{let i="否，尚未投入資安工作。";return A.value===1?i+=`
原因：職涯規劃改變`:A.value===2?i+=`
原因：積極尋求機會中`:A.value===3&&G.value&&(i+=`
原因：其他 - ${G.value}`),k.value&&(i+=`
調任日期：${k.value}。`),i},le=()=>{if(console.log("confirmSecurityWork: 確認安全工作明細。"),K.value===null)return;S(K.value);let i="";g.value===1?(i=Y(),v.showInfo("貼心提醒",'您選擇了"已投入資安工作"，請記得點擊"回覆職務內容"按鈕填寫詳細資訊！')):g.value===2&&(i=fe()),r.value[K.value].securityWorkDetail=i,r.value[K.value].selected5=!0,N.value=!1,ae.value=!0,r.value[K.value].isSecurityWorkConfirmed=!0,g.value===1&&Be()},Q=()=>{console.log("cancelSecurityWork: 取消安全工作明細。"),K.value!==null&&(r.value[K.value].selected5=!1,r.value[K.value].securityWorkDetail="",r.value[K.value].selectItem=0,r.value[K.value].jobDescription=0,r.value[K.value].jobContent={},r.value[K.value].isSecurityWorkConfirmed=!1,r.value.some(n=>n.isSecurityWorkConfirmed)||(ae.value=!1)),N.value=!1},se=m(!1),ie=m(null),de=m(null),ae=m(!1),ce=(i,n)=>{r.value[n].selectItem=i.selectItem,r.value[n].originalPosition=i.originalPosition,r.value[n].currentPosition=i.currentPosition,r.value[n].originalAgency=i.originalAgency,r.value[n].currentAgency=i.currentAgency,r.value[n].fillMethod=i.fillMethod,r.value[n].trackingReasonOption=i.trackingReasonOption,r.value[n].trackingReasonDetail=i.trackingReasonDetail,r.value[n].transferDate=i.transferDate,r.value[n].securityWorkDetail=i.securityWorkDetail,i.jobDescription&&(r.value[n].jobDescription=i.jobDescription),i.jobContent&&(r.value[n].jobContent=i.jobContent)},Ie=(i,n)=>{console.log(`toggleRatio: 切換補助比例，索引：${i}，比例：${n}`);const h=r.value[i];n==="0"?pe(h):(n==="80"||n==="15"||n==="5")&&we(h),n==="5"?h.selected5?He(h,i):ge(h):n==="0"&&h.selected0&&H()},Be=()=>{if(console.log("openJobContentModal: 打開職務內容彈窗。"),K.value!==null){const i=u.value.id;if(i){ie.value=i;const n=r.value[K.value];de.value=n.jobContent||{},se.value=!0}else v.showError("貼心提醒","無法獲取學生資訊")}else v.showError("貼心提醒","請先選擇課程")},me=i=>{console.log("handleSaveJobContent: 處理保存職務內容，數據：",i),de.value=i,K.value!==null&&(r.value[K.value].jobDescription=1,r.value[K.value].jobContent=i),v.showSuccess("貼心提醒","職務內容已成功儲存"),se.value=!1},pe=i=>{i.selected0&&(i.selected80=!1,i.selected15=!1,i.selected5=!1,i.securityWorkDetail="",i.selectItem=0,i.jobDescription=0,i.jobContent={})},we=i=>{(i.selected80||i.selected15||i.selected5)&&(i.selected0=!1)},He=(i,n)=>{const h=()=>r.value.find(be=>be.isSecurityWorkConfirmed)||r.value.find(be=>(be.is5===2||be.is5===3)&&be.securityWorkDetail);if(!i.isSecurityWorkConfirmed&&!ae.value)q(n);else{const be=h();be?ce(be,n):q(n)}},ge=i=>{i.securityWorkDetail="",i.selectItem=0,i.jobDescription=0,i.jobContent={},i.isSecurityWorkConfirmed=!1,r.value.some(h=>h.isSecurityWorkConfirmed)||(ae.value=!1)},H=i=>{r.value.some(h=>h.selected5||h.is5===2||h.is5===3)||(ae.value=!1)};return(i,n)=>(t(),s(Z,null,[e("div",l6,[e("div",n6,[Qe(pt,{breadcrumbs:p.value},null,8,["breadcrumbs"])]),e("div",r6,[e("div",i6,[e("div",null,[e("span",d6,l(C.value),1),e("span",u6,[xe(l(u.value.studentName)+" ",1),u.value.studentIdentity===1?(t(),s(Z,{key:0},[xe(" 全修班 ")],64)):u.value.studentIdentity===2?(t(),s(Z,{key:1},[xe(" 選修班 ")],64)):J("",!0)])]),e("div",null,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:ke}," 儲存 ")])]),e("div",c6,[e("div",p6,[n[26]||(n[26]=e("label",{for:"applicationNumber",class:"mr-2"},"申請單號:",-1)),I(e("input",{id:"applicationNumber",type:"text","onUpdate:modelValue":n[0]||(n[0]=h=>u.value.applicationNumber=h),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"請輸入申請單號"},null,512),[[ee,u.value.applicationNumber]])]),e("div",v6,[n[27]||(n[27]=e("label",{for:"applicationDate",class:"mr-2"},"申請日期:",-1)),I(e("input",{id:"applicationDate",type:"text","onUpdate:modelValue":n[1]||(n[1]=h=>u.value.applicationDate=h),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入民國年格式，例如：113/01/05",onInput:n[2]||(n[2]=h=>O(h,"applicationDate"))},null,544),[[ee,u.value.applicationDate]])])]),e("div",m6,[e("div",b6,[n[29]||(n[29]=e("label",{for:"accountType",class:"mr-2"},"帳戶類型:",-1)),I(e("select",{id:"accountType","onUpdate:modelValue":n[3]||(n[3]=h=>o.value=h),class:"border border-gray-300 p-1 w-24 outline-none"},n[28]||(n[28]=[e("option",{value:"bank"},"銀行",-1),e("option",{value:"post"},"郵局",-1)]),512),[[Pe,o.value]])]),o.value==="bank"?(t(),s(Z,{key:0},[e("div",f6,[n[30]||(n[30]=e("label",{for:"bankCode",class:"mr-2"},"銀行代碼:",-1)),I(e("input",{id:"bankCode",type:"text","onUpdate:modelValue":n[4]||(n[4]=h=>u.value.bankCode=h),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"銀行代碼"},null,512),[[ee,u.value.bankCode]])]),e("div",y6,[n[31]||(n[31]=e("label",{for:"branchCode",class:"mr-2"},"分行代碼:",-1)),I(e("input",{id:"branchCode",type:"text","onUpdate:modelValue":n[5]||(n[5]=h=>u.value.branchCode=h),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼"},null,512),[[ee,u.value.branchCode]])]),e("div",g6,[n[32]||(n[32]=e("label",{for:"bankAccount",class:"mr-2"},"銀行帳號:",-1)),I(e("input",{id:"bankAccount",type:"text","onUpdate:modelValue":n[6]||(n[6]=h=>u.value.bankAccount=h),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"銀行帳號"},null,512),[[ee,u.value.bankAccount]])])],64)):(t(),s(Z,{key:1},[e("div",x6,[n[33]||(n[33]=e("label",{for:"postCode",class:"mr-2"},"郵局代碼:",-1)),I(e("input",{id:"postCode",type:"text","onUpdate:modelValue":n[7]||(n[7]=h=>u.value.bankCode=h),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"郵局代碼",disabled:""},null,512),[[ee,u.value.bankCode]])]),e("div",h6,[n[34]||(n[34]=e("label",{for:"postBranchCode",class:"mr-2"},"分行代碼:",-1)),I(e("input",{id:"postBranchCode",type:"text","onUpdate:modelValue":n[8]||(n[8]=h=>u.value.branchCode=h),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼"},null,512),[[ee,u.value.branchCode]])]),e("div",w6,[n[35]||(n[35]=e("label",{for:"postAccount",class:"mr-2"},"郵局帳號:",-1)),I(e("input",{id:"postAccount",type:"text","onUpdate:modelValue":n[9]||(n[9]=h=>u.value.bankAccount=h),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"郵局帳號"},null,512),[[ee,u.value.bankAccount]])])],64)),n[37]||(n[37]=e("div",{class:"flex-grow"},null,-1)),e("div",_6,[n[36]||(n[36]=e("label",{for:"receiptAmount",class:"mr-2"},"收據金額:",-1)),I(e("input",{id:"receiptAmount",type:"text","onUpdate:modelValue":n[10]||(n[10]=h=>b.value=h),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入收據金額"},null,512),[[ee,b.value]])])]),e("div",k6,[e("table",$6,[e("thead",null,[e("tr",null,[e("th",C6,[e("input",{id:"selectAll",type:"checkbox",onChange:_,checked:y.value,class:"w-4 h-4 cursor-pointer","aria-label":"全選"},null,40,E6)]),n[38]||(n[38]=e("th",{class:"border p-2"},"課程代號",-1)),n[39]||(n[39]=e("th",{class:"border p-2"},"科目",-1)),n[40]||(n[40]=e("th",{class:"border p-2"},"訓練單位",-1)),n[41]||(n[41]=e("th",{class:"border p-2"},"訓練日期起訖",-1)),n[42]||(n[42]=e("th",{class:"border p-2"},"上課時數",-1)),n[43]||(n[43]=e("th",{class:"border p-2"},"狀態",-1)),n[44]||(n[44]=e("th",{class:"border p-2"},"證書編號",-1)),n[45]||(n[45]=e("th",{class:"border p-2"},"取得學分",-1)),n[46]||(n[46]=e("th",{class:"border p-2"},"累積核撥費用",-1)),n[47]||(n[47]=e("th",{class:"border p-2"},[xe("申請補助"),e("br"),xe("次數")],-1)),n[48]||(n[48]=e("th",{class:"border p-2"},[xe("已申請"),e("br"),xe("(%)")],-1)),n[49]||(n[49]=e("th",{class:"border p-2"},"學分費",-1)),n[50]||(n[50]=e("th",{class:"border p-2"},"備註",-1)),n[51]||(n[51]=e("th",{class:"border p-2"},"申請比例",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(r.value,(h,be)=>(t(),s("tr",{key:h.id,class:X({"bg-[#F7F7F7]":be%2===1})},[e("td",{class:X(["border p-2 text-center sticky left-0 z-10",{"bg-white":be%2===0,"bg-[#F7F7F7]":be%2===1}])},[I(e("input",{id:`record-select-${be}`,type:"checkbox","onUpdate:modelValue":_e=>h.selected=_e,class:"w-4 h-4 cursor-pointer","aria-label":`選擇課程：${h.courseName}`},null,8,S6),[[Ce,h.selected]])],2),e("td",D6,l(h.courseCode),1),e("td",M6,l(h.courseName),1),e("td",A6,l(h.schoolName),1),e("td",I6,l(h.startDate)+"~"+l(h.endDate),1),e("td",R6,l(h.hours),1),e("td",P6,l(h.status),1),e("td",U6,l(h.certificateNumber||"--"),1),e("td",N6,l(h.credits),1),e("td",T6,l(V(h.accumulatedSubsidy)),1),e("td",V6,l(h.subsidyCount),1),e("td",j6,l(h.applied),1),e("td",L6,[h.selected?I((t(),s("input",{key:0,id:`credit-fee-${be}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":_e=>h.creditFee=_e,placeholder:"請輸入學分費","aria-label":`${h.courseName}的學分費`},null,8,F6)),[[ee,h.creditFee]]):(t(),s(Z,{key:1},[xe(l(h.creditFee||"--"),1)],64))]),e("td",q6,[h.selected?I((t(),s("input",{key:0,id:`remark-${be}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":_e=>h.remark=_e,placeholder:"請輸入備註","aria-label":`${h.courseName}的備註`},null,8,O6)),[[ee,h.remark]]):(t(),s(Z,{key:1},[xe(l(h.remark||"--"),1)],64))]),e("td",B6,[e("div",H6,[e("label",{for:`rate80-${be}`,class:"flex items-center cursor-pointer"},[h.is80===3||h.is80===2?(t(),s("div",z6,n[52]||(n[52]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate80-${be}`,type:"checkbox","onUpdate:modelValue":_e=>h.selected80=_e,disabled:!h.selected||h.is80!==1||h.selected0||h.is0===2||h.is0===3,class:"mr-1","aria-label":`選擇${h.courseName}的80%補助比例`,onChange:_e=>Ie(be,"80")},null,40,K6)),[[Ce,h.selected80]]),e("span",{class:X(["text-sm",{"text-gray-400":h.is80===3||h.is80===2}])},"80%",2)],8,W6),e("label",{for:`rate15-${be}`,class:"flex items-center cursor-pointer"},[h.is15===3||h.is15===2?(t(),s("div",Y6,n[53]||(n[53]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate15-${be}`,type:"checkbox","onUpdate:modelValue":_e=>h.selected15=_e,disabled:!h.selected||h.is15!==1||h.selected0||h.is0===2||h.is0===3,class:"mr-1","aria-label":`選擇${h.courseName}的15%補助比例`,onChange:_e=>Ie(be,"15")},null,40,G6)),[[Ce,h.selected15]]),e("span",{class:X(["text-sm",{"text-gray-400":h.is15===3||h.is15===2}])},"15%",2)],8,J6),e("label",{for:`rate5-${be}`,class:"flex items-center cursor-pointer"},[h.is5===3||h.is5===2?(t(),s("div",Z6,n[54]||(n[54]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate5-${be}`,type:"checkbox","onUpdate:modelValue":_e=>h.selected5=_e,disabled:!h.selected||h.is5!==1||h.selected0||h.is0===2||h.is0===3,class:"mr-1","aria-label":`選擇${h.courseName}的5%補助比例`,onChange:_e=>Ie(be,"5")},null,40,X6)),[[Ce,h.selected5]]),e("span",{class:X(["text-sm",{"text-gray-400":h.is5===3||h.is5===2}])},"5%",2)],8,Q6),e("label",{for:`rate0-${be}`,class:"flex items-center cursor-pointer"},[h.is0===3||h.is0===2?(t(),s("div",t7,n[55]||(n[55]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate0-${be}`,type:"checkbox","onUpdate:modelValue":_e=>h.selected0=_e,disabled:!h.selected||h.is0!==1||h.selected80||h.is80===2||h.is80===3||h.selected15||h.is15===2||h.is15===3||h.selected5||h.is5===2||h.is5===3,class:"mr-1","aria-label":`選擇${h.courseName}的0%補助比例`,onChange:_e=>Ie(be,"0")},null,40,s7)),[[Ce,h.selected0]]),e("span",{class:X(["text-sm",{"text-gray-400":h.is0===3||h.is0===2}])},"0%",2)],8,e7)])])],2))),128))])])]),e("div",a7,[n[56]||(n[56]=xe(" 本次申請共計 ")),e("span",o7,l(w.value),1),n[57]||(n[57]=xe(" 門課程 "))])])]),N.value?(t(),s("div",l7,[e("div",n7,[n[76]||(n[76]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",r7,[e("div",i7,[e("div",d7,[n[61]||(n[61]=e("span",{class:"mr-4"},[xe("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",u7,[e("label",c7,[I(e("input",{type:"radio","onUpdate:modelValue":n[11]||(n[11]=h=>a.value=h),value:1,class:"w-4 h-4 mr-1"},null,512),[[ct,a.value]]),n[58]||(n[58]=e("span",null,"核撥申請",-1))]),e("label",p7,[I(e("input",{type:"radio","onUpdate:modelValue":n[12]||(n[12]=h=>a.value=h),value:2,class:"w-4 h-4 mr-1"},null,512),[[ct,a.value]]),n[59]||(n[59]=e("span",null,"電子郵件",-1))]),e("label",v7,[I(e("input",{type:"radio","onUpdate:modelValue":n[13]||(n[13]=h=>a.value=h),value:3,class:"w-4 h-4 mr-1"},null,512),[[ct,a.value]]),n[60]||(n[60]=e("span",null,"電訪",-1))])])]),e("div",m7,[e("div",b7,[I(e("input",{type:"radio","onUpdate:modelValue":n[14]||(n[14]=h=>g.value=h),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[ct,g.value]]),n[62]||(n[62]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:Be}," 回覆職務內容 "),n[63]||(n[63]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",f7,[e("div",y7,[I(e("input",{type:"radio","onUpdate:modelValue":n[15]||(n[15]=h=>g.value=h),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[ct,g.value]]),n[65]||(n[65]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",g7,[n[64]||(n[64]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",x7,[I(e("input",{type:"text","onUpdate:modelValue":n[16]||(n[16]=h=>k.value=h),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[ee,k.value]])])])])]),e("div",h7,[e("div",w7,[e("div",null,[n[66]||(n[66]=e("div",{class:"mb-1"},"原機關",-1)),e("div",_7,[I(e("input",{type:"text","onUpdate:modelValue":n[17]||(n[17]=h=>T.value=h),class:"w-full outline-none"},null,512),[[ee,T.value]])])]),e("div",null,[n[67]||(n[67]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",k7,[I(e("input",{type:"text","onUpdate:modelValue":n[18]||(n[18]=h=>z.value=h),class:"w-full outline-none"},null,512),[[ee,z.value]])]),n[68]||(n[68]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[n[69]||(n[69]=e("div",{class:"mb-1"},"原職系",-1)),e("div",$7,[I(e("input",{type:"text","onUpdate:modelValue":n[19]||(n[19]=h=>$.value=h),class:"w-full outline-none"},null,512),[[ee,$.value]])])]),e("div",null,[n[70]||(n[70]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",C7,[I(e("input",{type:"text","onUpdate:modelValue":n[20]||(n[20]=h=>P.value=h),class:"w-full outline-none"},null,512),[[ee,P.value]])]),n[71]||(n[71]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(g.value)===2?(t(),s("div",E7,[n[75]||(n[75]=e("div",null,[xe("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",S7,[e("div",D7,[I(e("input",{type:"radio","onUpdate:modelValue":n[21]||(n[21]=h=>A.value=h),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,A.value]]),n[72]||(n[72]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",M7,[I(e("input",{type:"radio","onUpdate:modelValue":n[22]||(n[22]=h=>A.value=h),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,A.value]]),n[73]||(n[73]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",A7,[I(e("input",{type:"radio","onUpdate:modelValue":n[23]||(n[23]=h=>A.value=h),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,A.value]]),n[74]||(n[74]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",I7,[I(e("input",{type:"text","onUpdate:modelValue":n[24]||(n[24]=h=>G.value=h),class:"w-full outline-none",disabled:Number(A.value)!==3},null,8,R7),[[ee,G.value]])])])])])):J("",!0)])]),e("div",P7,[e("button",{class:X(["px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",{"cursor-not-allowed":!c.value}]),onClick:le,disabled:!c.value}," 確認 ",10,U7),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:Q}," 取消 ")])])])):J("",!0),se.value?(t(),ls(Bs,{key:1,show:se.value,studentId:ie.value,initialData:de.value,onClose:n[25]||(n[25]=h=>se.value=!1),onSave:me},null,8,["show","studentId","initialData"])):J("",!0)],64))}},T7=Le(N7,[["__scopeId","data-v-979169b8"]]),V7={class:"flex flex-col items-center p-6"},j7={class:"w-full max-w-[1500px]"},L7={class:"w-full max-w-[1500px]"},F7={class:"flex justify-start mb-2"},q7={class:"text-xl font-bold mr-4"},O7={class:"text-xl font-bold"},B7={class:"flex flex-wrap items-center space-x-4 mb-4"},H7={class:"flex items-center"},W7=["disabled"],z7={class:"flex items-center"},K7=["disabled"],J7={class:"flex items-center"},Y7={class:"flex flex-wrap items-center space-x-4 mb-4"},G7={class:"flex items-center mr-4"},Q7=["disabled"],Z7={class:"flex items-center"},X7=["disabled"],eS={class:"flex items-center"},tS=["disabled"],sS={class:"flex items-center"},aS=["disabled"],oS={class:"flex items-center"},lS={class:"flex items-center"},nS=["disabled"],rS={class:"flex items-center"},iS=["disabled"],dS={class:"flex items-center ml-auto"},uS=["disabled"],cS={class:"overflow-x-auto"},pS={class:"w-full border-collapse min-w-full max-w-[1500px]"},vS={class:"border p-2 sticky left-0 bg-[#EEEFE7] z-10"},mS=["checked","disabled"],bS=["id","onUpdate:modelValue","disabled","aria-label"],fS={class:"border p-2 text-center"},yS={class:"border p-2 text-center"},gS={class:"border p-2 text-center"},xS={class:"border p-2 text-center whitespace-pre-line"},hS={class:"border p-2 text-center"},wS={class:"border p-2 text-center"},_S={class:"border p-2 text-center"},kS={class:"border p-2 text-center"},$S={class:"border p-2 text-center"},CS={class:"border p-2 text-center"},ES={class:"border p-2 text-center"},SS={class:"border p-2 text-center"},DS=["id","onUpdate:modelValue","aria-label"],MS={class:"border p-2 text-center"},AS=["id","onUpdate:modelValue","aria-label"],IS={class:"border p-2 text-center"},RS={class:"flex flex-col items-center space-y-2"},PS=["for"],US={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},NS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],TS=["for"],VS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},jS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],LS=["for"],FS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},qS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],OS=["for"],BS={key:0,class:"w-[14px] h-[14px] border border-gray-300 bg-gray-200 flex items-center justify-center mr-1 rounded"},HS=["id","onUpdate:modelValue","disabled","aria-label","onChange"],WS={class:"flex justify-between"},zS={class:"mt-4 mb-4 text-base"},KS={class:"font-bold"},JS={class:"mt-4 mb-4 text-base"},YS={class:"font-bold"},GS={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},QS={class:"bg-white rounded-lg shadow-lg p-6 w-[700px] max-h-[90vh] overflow-y-auto"},ZS={class:"border border-gray-300 p-4 mb-4"},XS={class:"mb-4"},e9={class:"flex items-center mb-4"},t9={class:"flex items-center space-x-4"},s9={class:"flex items-center"},a9={class:"flex items-center"},o9={class:"flex items-center"},l9={class:"flex items-center mb-4"},n9={class:"flex items-center"},r9={class:"flex items-center mb-4"},i9={class:"flex items-center"},d9={class:"flex items-center mt-1 ml-32"},u9={class:"border-b border-black w-full"},c9={class:"mt-4 p-3 border border-gray-300 mb-4"},p9={class:"grid grid-cols-2 gap-4"},v9={class:"border-b border-black w-full"},m9={class:"border-b border-black w-full"},b9={class:"border-b border-black w-full"},f9={class:"border-b border-black w-full"},y9={key:0,class:"ml-7"},g9={class:"mt-2"},x9={class:"flex items-start mb-2"},h9={class:"flex items-start mb-2"},w9={class:"flex items-start"},_9={class:"border-b border-black w-64 ml-2"},k9=["disabled"],$9={class:"flex justify-center space-x-2"},C9=["disabled"],E9={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},S9={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},D9={class:"mb-4"},M9={class:"space-y-3"},A9={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},I9={class:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto"},R9={class:"text-gray-700"},P9={class:"ml-6 mt-2 space-y-2 text-gray-600"},U9=["onUpdate:modelValue"],N9={class:"mb-4"},T9={class:"text-gray-700"},V9={class:"mb-6"},j9={class:"text-gray-700 mb-2"},L9=["disabled"],F9={__name:"GrantApplicationEdit",setup(D){const x=lt(),d=We(),u=m({id:null,studentName:"",bankCode:"",branchCode:"",bankAccount:"",studentIdentity:"",applicationNumber:"",applicationDate:""}),C=m("bank"),o=m(""),N=m("1"),K=m("1"),$=m(""),P=m(0),T=m([]),z=m(!1),g=m(!1),a=m(null);m("");const A=m(""),G=m(""),k=m(""),c=m(""),b=m(0),r=m(0),f=m(0),p=m(""),w=m(""),y=m(!1),V=m(null),W=m(null),O=m(!1),_=m(!1),E=Se(()=>!(!r.value||!b.value||Number(b.value)===2&&(!f.value||Number(f.value)===3&&!p.value.trim()))),L=B=>{if(!B)return!0;const M=/^(\d{1,3})\/(\d{1,2})\/(\d{1,2})$/;if(!M.test(B))return!1;const F=B.match(M),ne=parseInt(F[1])+1911,Ae=parseInt(F[2])-1,Fe=parseInt(F[3]);let Te=new Date(ne,Ae,Fe);return Te.getFullYear()===ne&&Te.getMonth()===Ae&&Te.getDate()===Fe},j=(B,M)=>{const F=B.target.value,Ae=F.replace(/[^\d/-]/g,"").slice(0,10);F!==Ae&&(u.value[M]=Ae)},R=Se(()=>T.value.filter(B=>B.selected).length),U=Se(()=>T.value.length>0&&T.value.every(B=>B.selected)),te=B=>B==null?"$------":`$${B.toLocaleString()}`,ue=B=>{switch(parseInt(B)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";case 5:return"待補件，不合格";default:return B}},ye=B=>{switch(typeof B=="string"?parseInt(B):B){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";case 5:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ke=B=>{console.log("toggleSelectAll: 觸發全選/取消全選功能。",B.target.checked);const M=B.target.checked;T.value.forEach(F=>{F.selected=M})},De=Se(()=>K.value==="1"),$e=m({verificationUpdate:!1,verificationExport:!1}),ve=async()=>{console.log("fetchPermissions: 開始獲取用戶權限。");try{const B=await tt.getSidebarPermissions();console.log("fetchPermissions: API 回傳：",B.data),B.data.code===0&&B.data.message==="success"&&($e.value=B.data.data,console.log("fetchPermissions: 成功獲取權限：",$e.value))}catch(B){console.error("獲取權限失敗:",B)}},oe=Se(()=>De.value&&$e.value.verificationUpdate);Ee(()=>C.value,B=>{console.log(`watch: 帳戶類型從舊值變更為新值: ${B}`),B==="post"&&(u.value.bankCode="700")}),Ee(()=>T.value.map(B=>B.selected5),B=>{console.log("watch: 5%補助比例選中狀態已更新。",B),!T.value.some(F=>F.selected5||F.is5===2||F.is5===3)&&(_.value=!1)},{deep:!0});const q=(B,M)=>B===3?3:M||B===2?2:1,S=()=>{const B=T.value.filter(M=>M.selected);return B.length===0?(v.showError("貼心提醒","請至少選擇一門課程進行申請"),null):B},Y=B=>B.some(F=>F.is80===2||F.is80===3||F.is15===2||F.is15===3||F.is5===2||F.is5===3||F.is0===2||F.is0===3?!1:!F.selected80&&!F.selected15&&!F.selected5&&!F.selected0)?(v.showError("貼心提醒","請為每個選中的課程選擇申請比例"),!1):!0,fe=B=>!$.value||$.value<=0?(v.showError("貼心提醒","請輸入有效的收據金額"),!1):B.some(F=>!F.creditFee||F.creditFee<=0)?(v.showError("貼心提醒","請為所有選中的課程輸入有效的學分費"),!1):!0,le=B=>B.some(F=>(F.selected5||F.is5===2||F.is5===3)&&(!F.securityWorkDetail||F.securityWorkDetail.trim()===""))?(v.showError("貼心提醒","請為所有選擇5%補助比例的課程填寫投入資安工作明細"),!1):!0,Q=()=>{const B=x.query.applicationId;if(!B)return v.showError("貼心提醒","缺少必要的申請單ID參數"),{valid:!1};const M=T.value.filter(Oe=>{const kt=Oe.isSelected,yt=Oe.selected,mt=Oe.originalRemark!==Oe.remark,Lt=Oe.originalCreditFee!==Oe.creditFee,Ke=Oe.originalIs80!==q(Oe.is80,Oe.selected80),Ze=Oe.originalIs15!==q(Oe.is15,Oe.selected15),Je=Oe.originalIs5!==q(Oe.is5,Oe.selected5),Ye=Oe.originalIs0!==q(Oe.is0,Oe.selected0),Xe=(Oe.is5===2||Oe.is5===3)&&Oe.originalSecurityWorkDetail!==Oe.securityWorkDetail;return kt||yt&&!kt||mt||Lt||Ke||Ze||Je||Ye||Xe}),F=x.query.bankCode||"",ne=x.query.branchCode||"",Ae=x.query.bankAccount||"",Fe=x.query.receiptAmount||"",Te=u.value.bankCode!==F||u.value.branchCode!==ne||u.value.bankAccount!==Ae,nt=$.value!==Fe;return M.length===0&&!Te&&!nt?(v.showInfo("貼心提醒","沒有修改任何資料，無需儲存"),{valid:!1}):{valid:!0,modifiedRecords:M,applicationId:Number(B)}},se=(B,M)=>{const F=T.value.some(Fe=>Fe.selected5||Fe.is5===2||Fe.is5===3),ne=F?T.value.find(Fe=>Fe.selected5||Fe.is5===2||Fe.is5===3):null,Ae=F&&(ne==null?void 0:ne.selectItem)===2;return{orderId:M,studentId:Number(u.value.id),bankCode:u.value.bankCode,branchCode:u.value.branchCode,bankAccount:u.value.bankAccount,accountType:C.value,receiptAmount:parseFloat($.value)||0,number:u.value.applicationNumber,applicationDate:u.value.applicationDate||null,selectItem:F&&(ne==null?void 0:ne.selectItem)||0,originalPosition:F&&(ne==null?void 0:ne.originalPosition)||"",currentPosition:F&&(ne==null?void 0:ne.currentPosition)||"",originalAgency:F&&(ne==null?void 0:ne.originalAgency)||"",currentAgency:F&&(ne==null?void 0:ne.currentAgency)||"",transferDate:F&&(ne==null?void 0:ne.transferDate)||"",fillMethod:F?ne==null?void 0:ne.fillMethod:void 0,trackingReasonOption:Ae&&(ne==null?void 0:ne.trackingReasonOption)||0,trackingReasonDetail:Ae&&(ne==null?void 0:ne.trackingReasonDetail)||"",details:B.map(Fe=>{const Te=q(Fe.is80,Fe.selected80),nt=q(Fe.is15,Fe.selected15),Oe=q(Fe.is5,Fe.selected5);return{learningHistoryId:Number(Fe.id),remark:Fe.remark||null,is80:Te,is15:nt,is5:Oe,is0:q(Fe.is0,Fe.selected0),creditFee:parseFloat(Fe.creditFee)||0,isSelected:Fe.selected}})}},ie=async()=>{var B;if(console.log("saveApplication: 開始儲存申請單。"),!De.value){console.log("saveApplication: 申請單不可編輯，停止儲存。");return}try{const M=S();if(!M){console.log("saveApplication: 未選擇任何課程，停止儲存。");return}if(z.value=!0,!Y(M)){console.log("saveApplication: 申請比例驗證失敗。"),z.value=!1;return}if(!fe(M)){console.log("saveApplication: 收據金額或學分費驗證失敗。"),z.value=!1;return}if(!le(M)){console.log("saveApplication: 資安工作明細驗證失敗。"),z.value=!1;return}if(!u.value.applicationNumber||u.value.applicationNumber.trim()===""){v.showError("貼心提醒","申請單號為必填欄位"),z.value=!1;return}if(!u.value.applicationDate||!L(u.value.applicationDate)){v.showError("貼心提醒","申請日期格式不正確，請輸入民國年格式(如：113/01/01)"),z.value=!1;return}const{valid:F,modifiedRecords:ne,applicationId:Ae}=Q();if(console.log("saveApplication: 檢查修改結果：",{valid:F,modifiedRecords:ne,applicationId:Ae}),!F){console.log("saveApplication: 沒有檢測到修改，停止儲存。"),z.value=!1;return}const Fe=se(ne,Ae);console.log("saveApplication: 準備提交的數據：",Fe);const Te=await _t.updateApplication(Fe);if(console.log("saveApplication: API 回傳：",Te.data),Te.data&&Te.data.code===0)console.log("saveApplication: 申請單更新成功。"),v.showSuccess("貼心提醒","申請單已成功更新"),d.push({path:"/expense",query:{studentId:u.value.id,tab:"applications"}});else{const nt=((B=Te.data)==null?void 0:B.message)||"儲存失敗，請確認資料後再試";throw console.log("saveApplication: API 回傳失敗，錯誤訊息：",nt),new Error(nt)}}catch(M){console.error("儲存申請單失敗:",M),v.showError("貼心提醒",M.message||"儲存申請單失敗，請稍後再試")}finally{console.log("saveApplication: 儲存申請單流程結束。"),z.value=!1}},de=B=>{console.log("openSecurityWorkModal: 打開安全工作明細彈窗，索引：",B);const F=T.value.find(Ae=>(Ae.selected5||Ae.is5===2||Ae.is5===3)&&(Ae.selectItem===2||Ae.selectItem===1&&Ae.jobDescription===1));if(F&&_.value){T.value[B].selectItem=F.selectItem,T.value[B].originalPosition=F.originalPosition,T.value[B].currentPosition=F.currentPosition,T.value[B].originalAgency=F.originalAgency,T.value[B].currentAgency=F.currentAgency,T.value[B].fillMethod=F.fillMethod,T.value[B].trackingReasonOption=F.trackingReasonOption,T.value[B].trackingReasonDetail=F.trackingReasonDetail,T.value[B].transferDate=F.transferDate,T.value[B].securityWorkDetail=F.securityWorkDetail,T.value[B].jobDescription=F.jobDescription,T.value[B].jobContent=F.jobContent,F.selectItem===1&&(!F.jobDescription||F.jobDescription!==1)&&v.showInfo("貼心提醒","您已選擇「已投入資安工作」，請記得點擊「回覆職務內容」按鈕填寫詳細資訊！");return}a.value=B;const ne=T.value[B];b.value=ne.selectItem||0,r.value=ne.fillMethod||0,A.value=ne.originalPosition||"",G.value=ne.currentPosition||"",k.value=ne.originalAgency||"",c.value=ne.currentAgency||"",f.value=ne.trackingReasonOption||0,p.value=ne.trackingReasonDetail||"",w.value=ne.transferDate||"",g.value=!0},ae=B=>{T.value[B].selectItem=b.value,T.value[B].originalPosition=A.value,T.value[B].currentPosition=G.value,T.value[B].originalAgency=k.value,T.value[B].currentAgency=c.value,T.value[B].fillMethod=r.value,T.value[B].trackingReasonOption=f.value,T.value[B].trackingReasonDetail=p.value,T.value[B].transferDate=w.value},ce=()=>{let B="是，已投入資安工作。";return k.value&&c.value&&k.value!==c.value&&(B+=`
原機關：${k.value}，調任機關：${c.value}。`),A.value&&G.value&&A.value!==G.value&&(B+=`
原職系：${A.value}，調任職系：${G.value}。`),w.value&&(B+=`
調任日期：${w.value}。`),B},Ie=()=>{let B="否，尚未投入資安工作。";return f.value===1?B+=`
原因：職涯規劃改變`:f.value===2?B+=`
原因：積極尋求機會中`:f.value===3&&p.value&&(B+=`
原因：其他 - ${p.value}`),w.value&&(B+=`
調任日期：${w.value}。`),B},Be=()=>{if(console.log("confirmSecurityWork: 確認安全工作明細。"),a.value===null)return;ae(a.value);let B="";b.value===1?(B=ce(),v.showInfo("貼心提醒",'您選擇了"已投入資安工作"，請記得點擊"回覆職務內容"按鈕填寫詳細資訊！')):b.value===2&&(B=Ie()),T.value[a.value].securityWorkDetail=B,T.value[a.value].selected5=!0,g.value=!1,_.value=!0,b.value===1&&pe()},me=()=>{console.log("cancelSecurityWork: 取消安全工作明細。"),a.value!==null&&(T.value[a.value].selected5=!1,T.value[a.value].securityWorkDetail="",T.value[a.value].selectItem=0,T.value[a.value].jobDescription=0,T.value[a.value].jobContent={},T.value.some((M,F)=>F!==a.value&&M.selected5&&M.securityWorkDetail&&M.selectItem)||(_.value=!1)),g.value=!1},pe=()=>{if(console.log("openJobContentModal: 打開職務內容彈窗。"),a.value!==null){const B=u.value.id;if(B){V.value=B;const M=T.value[a.value];W.value=M.jobContent||{},y.value=!0}else v.showError("貼心提醒","無法獲取學生資訊")}else v.showError("貼心提醒","請先選擇課程")},we=B=>{console.log("handleSaveJobContent: 處理保存職務內容，數據：",B),W.value=B,a.value!==null&&(T.value[a.value].jobDescription=1,T.value[a.value].jobContent=B),v.showSuccess("貼心提醒","職務內容已成功儲存"),y.value=!1},He=(B,M)=>{T.value[M].selectItem=B.selectItem,T.value[M].originalPosition=B.originalPosition,T.value[M].currentPosition=B.currentPosition,T.value[M].originalAgency=B.originalAgency,T.value[M].currentAgency=B.currentAgency,T.value[M].fillMethod=B.fillMethod,T.value[M].trackingReasonOption=B.trackingReasonOption,T.value[M].trackingReasonDetail=B.trackingReasonDetail,T.value[M].securityWorkDetail=B.securityWorkDetail,B.jobDescription&&(T.value[M].jobDescription=B.jobDescription),B.jobContent&&(T.value[M].jobContent=B.jobContent)},ge=B=>{u.value.id=B.studentId,u.value.studentName=B.studentName,u.value.bankCode=B.bankCode||"",u.value.branchCode=B.branchCode||"",u.value.bankAccount=B.bankAccount||"",u.value.studentIdentity=B.studentIdentity,u.value.applicationNumber=B.number,u.value.applicationDate=B.applicationDate||"",x.query.bankCode=B.bankCode||"",x.query.branchCode=B.branchCode||"",x.query.bankAccount=B.bankAccount||"",x.query.receiptAmount=B.receiptAmount||"",o.value=B.agencyName,N.value=String(B.status),K.value=String(B.status),$.value=B.receiptAmount,P.value=B.subsidyAmount},H=B=>{B.accountType?C.value=B.accountType:B.bankType?C.value=B.bankType===1?"bank":"post":C.value=B.bankCode==="700"?"post":"bank"},i=B=>{const M=B.selectItem||0,F=B.originalPosition||"",ne=B.currentPosition||"",Ae=B.originalAgency||"",Fe=B.currentAgency||"",Te=B.fillMethod||0,nt=B.trackingReasonOption||0,Oe=B.trackingReasonDetail||"",kt=B.transferDate||"";let yt="";switch(M){case 1:yt=`是，已調任職系，且轉至其他機關。
原職系為${F}，目前職系為${ne}。
原機關為${Ae}，目前機關為${Fe}。`;break;case 2:yt=`是，已調任職系，尚未轉至其他機關。
原職系為${F}，目前職系為${ne}。`;break;case 3:yt="否，尚在原單位，僅轉調工作任務/職稱/職級。";break;case 4:yt="否，尚在原單位，持續進行工作任務。";break}kt&&(yt+=`
調任日期：${kt}。`),T.value=B.details.map(mt=>{const Lt=mt.is80||1,Ke=mt.is15||1,Ze=mt.is5||1,Je=mt.is0||1,Ye=mt.creditFee||0,Xe=mt.remark||"",Ge=Ze===2||Ze===3?yt:"",dt=mt.isSelected!==void 0?mt.isSelected:!1;return{id:mt.learningHistoryId,courseCode:mt.courseCode,courseName:mt.courseName,schoolName:mt.schoolName,startDate:mt.startDate,endDate:mt.endDate,hours:mt.hours,status:mt.status,certificateNumber:mt.certificateNumber,credits:mt.credits,subsidyCount:mt.subsidyCount,applied:mt.applied,remark:Xe,accumulatedSubsidy:mt.approvedAmount||0,selected:dt,selected80:Lt===2,selected15:Ke===2,selected5:Ze===2,selected0:Je===2,is80:Lt,is15:Ke,is5:Ze,is0:Je,creditFee:Ye,originalIs80:Lt,originalIs15:Ke,originalIs5:Ze,originalIs0:Je,originalCreditFee:Ye,originalRemark:Xe,originalSecurityWorkDetail:Ge,isSelected:dt,securityWorkDetail:Ge,isSecurityWorkConfirmed:(Ze===2||Ze===3)&&Ge!=="",selectItem:M,originalPosition:F,currentPosition:ne,originalAgency:Ae,currentAgency:Fe,fillMethod:Te,trackingReasonOption:nt,trackingReasonDetail:Oe,transferDate:kt}})},n=async()=>{var B;console.log("fetchExpenseDetails: 開始獲取申請單詳情。");try{const M=x.query.applicationId;if(console.log("fetchExpenseDetails: 獲取申請單ID：",M),!M){console.log("fetchExpenseDetails: 缺少申請單ID，即將返回列表頁。"),v.showError("貼心提醒","缺少必要的參數，即將返回列表頁"),d.push("/expense-list");return}const F=await _t.getApplicationInfo(M);if(console.log("fetchExpenseDetails: API 回傳：",F.data),F.data&&F.data.code===0){console.log("fetchExpenseDetails: 成功獲取資料。");const ne=F.data.data;ge(ne),H(ne),i(ne)}else{const ne=((B=F.data)==null?void 0:B.message)||"獲取資料失敗，請稍後再試";throw console.log("fetchExpenseDetails: API 回傳失敗，錯誤訊息：",ne),new Error(ne)}}catch(M){console.error("獲取申請單詳情失敗:",M),v.showError("貼心提醒","獲取申請單詳情失敗，即將返回列表頁"),d.push("/expense-list")}},h=Se(()=>[{name:"費用核撥",path:"/expense-list"},{name:"核撥作業",path:u.value.id?`/expense?studentId=${u.value.id}`:"/expense-list"},{name:"編輯申請單",path:"/expense-application-edit"}]),be=()=>{O.value=!0},_e=()=>{O.value=!1},Ve=async B=>{if(B)await st(!0);else try{const M=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(M===null||M===""){_e();return}const F=await _t.confirmPassword(M);if(F.data.code!==0){v.showError("密碼錯誤",F.data.message||"管理員密碼驗證失敗"),_e();return}const ne=await v.promptAsync("請輸入檔案密碼","請為匯出的檔案設置密碼","password");if(ne===null||ne===""){_e();return}await st(!1,ne)}catch(M){console.error("密碼驗證或檔案匯出過程錯誤:",M),v.showError("匯出失敗","驗證過程中發生錯誤，請稍後再試"),_e();return}_e()},st=async(B,M="")=>{try{const F={id:Number(x.query.applicationId),password:M,isHidden:B},ne=await _t.exportPassExcel(F),Ae=ne.headers["content-type"];if(!Ae||!Ae.includes("spreadsheetml.sheet"))try{const yt=new Blob([ne.data],{type:"application/json"}),mt=await new Response(yt).text(),Lt=JSON.parse(mt);console.error("匯出申請單失敗：伺服器返回錯誤：",Lt),v.showError("匯出失敗",Lt.message||"匯出過程中發生錯誤，請稍後再試");return}catch(yt){console.error("匯出申請單失敗：無法解析回應內容",yt),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const Fe=new Blob([ne.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Te=window.URL.createObjectURL(Fe),nt=document.createElement("a");nt.href=Te;const Oe=B?"隱蔽加密版":"無隱蔽版",kt=`申請單資料_${u.value.applicationNumber}_${Oe}.xlsx`;nt.setAttribute("download",kt),document.body.appendChild(nt),nt.click(),document.body.removeChild(nt),window.URL.revokeObjectURL(Te),v.showSuccess("匯出成功","申請單資料已成功匯出為 Excel 檔案")}catch(F){if(console.error("匯出申請單失敗:",F),F.response&&F.response.data){const ne=F.response.data;v.showError("匯出失敗",ne.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};je(()=>{console.log("onMounted: 元件已掛載，開始獲取申請單詳情與權限。"),n(),ve()});const it=B=>{B.selected0&&(B.selected80=!1,B.selected15=!1,B.selected5=!1,B.securityWorkDetail="",B.selectItem=0,B.jobDescription=0,B.jobContent={})},ut=B=>{(B.selected80||B.selected15||B.selected5)&&(B.selected0=!1)},ht=(B,M)=>{const F=()=>T.value.find(ne=>ne.isSecurityWorkConfirmed)||T.value.find(ne=>(ne.is5===2||ne.is5===3)&&ne.securityWorkDetail);if(!B.isSecurityWorkConfirmed&&!_.value)de(M);else{const ne=F();ne?He(ne,M):de(M)}},qe=B=>{B.securityWorkDetail="",B.selectItem=0,B.jobDescription=0,B.jobContent={},B.isSecurityWorkConfirmed=!1,T.value.some(F=>F.isSecurityWorkConfirmed)||(_.value=!1)},gt=B=>{T.value.some(F=>F.selected5||F.is5===2||F.is5===3)||(_.value=!1)},vt=(B,M)=>{console.log(`toggleRatio: 處理比例勾選變化，索引：${B}，比例類型：${M}`);const F=T.value[B];M==="0"?it(F):(M==="80"||M==="15"||M==="5")&&ut(F),M==="5"?F.selected5?ht(F,B):qe(F):M==="0"&&F.selected0&&gt()},Pt=m(!1),wt=m([{category:"一、文件未齊",modelGroup:"documentsMissingItems",items:[{modelKey:"form1",text:"1. 表單1:補助學分費/訓練費用申請書(雙面列印)。"},{modelKey:"form2",text:"2. 表單2:查詢個人資料同意書。"},{modelKey:"form3",text:"3. 表單3:撥款同意書(含帳戶存摺影本)。"},{modelKey:"form4",text:"4. 表單4:投入資安工作證明書。"},{modelKey:"form5",text:"5. 學分費/訓練費用繳納證明(收據正本)。"},{modelKey:"form6",text:"6. 學分證明、職能研習時數證明。"},{modelKey:"form7",text:"7. 資安職能訓練證書。"}]},{category:"二、文件缺漏",modelGroup:"documentsIncompleteItems",items:[{modelKey:"form1NotDoubleSided",text:"1. 表單1:未雙面列印。"},{modelKey:"missingSignature",text:"2. 漏簽名。"},{modelKey:"missingIDOrBankbook",text:"3. 未黏貼國民身分證或帳戶存摺影本。"},{modelKey:"alterationWithoutSeal",text:"4. 塗改處未蓋私章。"},{modelKey:"applicantInfoError",text:"5. 申請人個人資料填寫有誤。"}]}]),It=m({documentsMissingItems:{form1:!1,form2:!1,form3:!1,form4:!1,form5:!1,form6:!1,form7:!1},documentsIncompleteItems:{form1NotDoubleSided:!1,missingSignature:!1,missingIDOrBankbook:!1,alterationWithoutSeal:!1,applicantInfoError:!1},notProjectStudent:!1,other:!1}),Ct=m(""),ts=()=>{Pt.value=!0},Mt=()=>{Pt.value=!1,It.value={documentsMissingItems:{form1:!1,form2:!1,form3:!1,form4:!1,form5:!1,form6:!1,form7:!1},documentsIncompleteItems:{form1NotDoubleSided:!1,missingSignature:!1,missingIDOrBankbook:!1,alterationWithoutSeal:!1,applicantInfoError:!1},notProjectStudent:!1,other:!1},Ct.value=""},Et=async()=>{try{const B=Number(x.query.applicationId),M=Ut();if(!B||M.length===0){v.showError("請勾選至少一項不通過原因");return}await _t.rejectApplication({orderId:B,details:M}),await Rt(B),Mt()}catch(B){v.showError("操作失敗",B.message||"匯出不通過名單失敗")}},Rt=async B=>{try{const M=await _t.exportNoPassExcel({id:B,password:""},{responseType:"blob"}),F=M.headers["content-type"];if(F&&F.includes("application/json")){const Te=await M.data.text(),nt=JSON.parse(Te);v.showError("匯出失敗",nt.message||"未知錯誤");return}const ne=new Blob([M.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Ae=window.URL.createObjectURL(ne),Fe=document.createElement("a");Fe.href=Ae,Fe.setAttribute("download",`不通過名單_${u.value.applicationNumber}.xlsx`),document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe),window.URL.revokeObjectURL(Ae),v.showSuccess("匯出成功","不通過名單已匯出"),n()}catch(M){v.showError("匯出失敗",M.message||"匯出不通過Excel失敗")}},Ut=()=>{const B=[],M=It.value;return wt.value.forEach(F=>{F.items.forEach(ne=>{B.push({ans:M[F.modelGroup][ne.modelKey],question:ne.text})})}),B.push({ans:M.notProjectStudent,question:"非本計畫學員。"}),B.push({ans:M.other,question:"其他: "+(M.other?Ct.value:"")}),B};return(B,M)=>(t(),s(Z,null,[e("div",V7,[e("div",j7,[Qe(pt,{breadcrumbs:h.value},null,8,["breadcrumbs"])]),e("div",L7,[e("div",F7,[e("span",q7,l(o.value),1),e("span",O7,[xe(l(u.value.studentName)+" ",1),u.value.studentIdentity===1?(t(),s(Z,{key:0},[xe(" 全修班 ")],64)):u.value.studentIdentity===2?(t(),s(Z,{key:1},[xe(" 選修班 ")],64)):J("",!0)]),M[31]||(M[31]=e("div",{class:"flex-grow"},null,-1)),$e.value.verificationExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:ts}," 匯出不通過Excel ")):J("",!0),$e.value.verificationExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:be}," 匯出通過Excel ")):J("",!0),oe.value?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:ie}," 儲存 ")):J("",!0)]),e("div",B7,[e("div",H7,[M[32]||(M[32]=e("span",{class:"mr-2",id:"applicationNumberLabel"},"申請單號:",-1)),I(e("input",{id:"applicationNumber",type:"text","onUpdate:modelValue":M[0]||(M[0]=F=>u.value.applicationNumber=F),class:"border border-gray-300 p-1 w-48 outline-none",disabled:!De.value,placeholder:"請輸入申請單號","aria-labelledby":"applicationNumberLabel"},null,8,W7),[[ee,u.value.applicationNumber]])]),e("div",z7,[M[33]||(M[33]=e("span",{class:"mr-2",id:"applicationDateLabel"},"申請日期:",-1)),I(e("input",{id:"applicationDate",type:"text","onUpdate:modelValue":M[1]||(M[1]=F=>u.value.applicationDate=F),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"例如：114/01/05",onInput:M[2]||(M[2]=F=>j(F,"applicationDate")),disabled:!De.value,"aria-labelledby":"applicationDateLabel"},null,40,K7),[[ee,u.value.applicationDate]])]),M[35]||(M[35]=e("div",{class:"flex-grow"},null,-1)),e("div",J7,[M[34]||(M[34]=e("span",{class:"mr-2",id:"orderStatusLabel"},"申請單狀態:",-1)),e("span",{class:X(["px-3 py-1 rounded text-sm",ye(N.value)]),"aria-labelledby":"orderStatusLabel"},l(ue(N.value)),3)])]),e("div",Y7,[e("div",G7,[M[37]||(M[37]=e("label",{class:"mr-2",for:"accountType"},"帳戶類型:",-1)),I(e("select",{id:"accountType","onUpdate:modelValue":M[3]||(M[3]=F=>C.value=F),class:"border border-gray-300 p-1 w-24 outline-none",disabled:!De.value},M[36]||(M[36]=[e("option",{value:"bank"},"銀行",-1),e("option",{value:"post"},"郵局",-1)]),8,Q7),[[Pe,C.value]])]),C.value==="bank"?(t(),s(Z,{key:0},[e("div",Z7,[M[38]||(M[38]=e("label",{class:"mr-2",for:"bankCode"},"銀行代碼:",-1)),I(e("input",{id:"bankCode",type:"text","onUpdate:modelValue":M[4]||(M[4]=F=>u.value.bankCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"銀行代碼",disabled:!De.value},null,8,X7),[[ee,u.value.bankCode]])]),e("div",eS,[M[39]||(M[39]=e("label",{class:"mr-2",for:"branchCode"},"分行代碼:",-1)),I(e("input",{id:"branchCode",type:"text","onUpdate:modelValue":M[5]||(M[5]=F=>u.value.branchCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼",disabled:!De.value},null,8,tS),[[ee,u.value.branchCode]])]),e("div",sS,[M[40]||(M[40]=e("label",{class:"mr-2",for:"bankAccount"},"銀行帳號:",-1)),I(e("input",{id:"bankAccount",type:"text","onUpdate:modelValue":M[6]||(M[6]=F=>u.value.bankAccount=F),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"銀行帳號",disabled:!De.value},null,8,aS),[[ee,u.value.bankAccount]])])],64)):(t(),s(Z,{key:1},[e("div",oS,[M[41]||(M[41]=e("label",{class:"mr-2",for:"postCode"},"郵局代碼:",-1)),I(e("input",{id:"postCode",type:"text","onUpdate:modelValue":M[7]||(M[7]=F=>u.value.bankCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"郵局代碼",disabled:""},null,512),[[ee,u.value.bankCode]])]),e("div",lS,[M[42]||(M[42]=e("label",{class:"mr-2",for:"postBranchCode"},"分行代碼:",-1)),I(e("input",{id:"postBranchCode",type:"text","onUpdate:modelValue":M[8]||(M[8]=F=>u.value.branchCode=F),class:"border border-gray-300 p-1 w-24 outline-none",placeholder:"分行代碼",disabled:!De.value},null,8,nS),[[ee,u.value.branchCode]])]),e("div",rS,[M[43]||(M[43]=e("label",{class:"mr-2",for:"postAccount"},"郵局帳號:",-1)),I(e("input",{id:"postAccount",type:"text","onUpdate:modelValue":M[9]||(M[9]=F=>u.value.bankAccount=F),class:"border border-gray-300 p-1 w-48 outline-none",placeholder:"郵局帳號",disabled:!De.value},null,8,iS),[[ee,u.value.bankAccount]])])],64)),M[45]||(M[45]=e("div",{class:"flex-grow"},null,-1)),e("div",dS,[M[44]||(M[44]=e("label",{class:"mr-2",for:"receiptAmount"},"收據金額:",-1)),I(e("input",{id:"receiptAmount",type:"text","onUpdate:modelValue":M[10]||(M[10]=F=>$.value=F),class:"border border-gray-300 p-1 w-36 outline-none",placeholder:"請輸入收據金額",disabled:!De.value},null,8,uS),[[ee,$.value]])])]),e("div",cS,[e("table",pS,[e("thead",null,[e("tr",null,[e("th",vS,[e("input",{id:"selectAll",type:"checkbox",onChange:ke,checked:U.value,class:"w-4 h-4 cursor-pointer",disabled:!De.value,"aria-label":"全選"},null,40,mS)]),M[46]||(M[46]=e("th",{class:"border p-2"},"課程代號",-1)),M[47]||(M[47]=e("th",{class:"border p-2"},"科目",-1)),M[48]||(M[48]=e("th",{class:"border p-2"},"訓練單位",-1)),M[49]||(M[49]=e("th",{class:"border p-2"},"訓練日期起訖",-1)),M[50]||(M[50]=e("th",{class:"border p-2"},"上課時數",-1)),M[51]||(M[51]=e("th",{class:"border p-2"},"狀態",-1)),M[52]||(M[52]=e("th",{class:"border p-2"},"證書編號",-1)),M[53]||(M[53]=e("th",{class:"border p-2"},"取得學分",-1)),M[54]||(M[54]=e("th",{class:"border p-2"},"累積核撥費用",-1)),M[55]||(M[55]=e("th",{class:"border p-2"},[xe("申請補助"),e("br"),xe("次數")],-1)),M[56]||(M[56]=e("th",{class:"border p-2"},[xe("已申請"),e("br"),xe("(%)")],-1)),M[57]||(M[57]=e("th",{class:"border p-2"},"學分費",-1)),M[58]||(M[58]=e("th",{class:"border p-2"},"備註",-1)),M[59]||(M[59]=e("th",{class:"border p-2"},"申請比例",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(T.value,(F,ne)=>(t(),s("tr",{key:F.id,class:X({"bg-[#F7F7F7]":ne%2===1})},[e("td",{class:X(["border p-2 text-center sticky left-0 z-10",{"bg-white":ne%2===0,"bg-[#F7F7F7]":ne%2===1}])},[I(e("input",{id:`record-select-${ne}`,type:"checkbox","onUpdate:modelValue":Ae=>F.selected=Ae,class:"w-4 h-4 cursor-pointer",disabled:!De.value,"aria-label":`選擇課程：${F.courseName}`},null,8,bS),[[Ce,F.selected]])],2),e("td",fS,l(F.courseCode),1),e("td",yS,l(F.courseName),1),e("td",gS,l(F.schoolName),1),e("td",xS,l(F.startDate)+"~"+l(F.endDate),1),e("td",hS,l(F.hours),1),e("td",wS,l(ue(F.status)),1),e("td",_S,l(F.certificateNumber||"--"),1),e("td",kS,l(F.credits),1),e("td",$S,l(te(F.accumulatedSubsidy)),1),e("td",CS,l(F.subsidyCount),1),e("td",ES,l(F.applied),1),e("td",SS,[F.selected&&De.value?I((t(),s("input",{key:0,id:`credit-fee-${ne}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Ae=>F.creditFee=Ae,placeholder:"請輸入學分費","aria-label":`${F.courseName}的學分費`},null,8,DS)),[[ee,F.creditFee]]):(t(),s(Z,{key:1},[xe(l(F.creditFee||"--"),1)],64))]),e("td",MS,[F.selected&&De.value?I((t(),s("input",{key:0,id:`remark-${ne}`,type:"text",class:"w-full border border-gray-300 p-1 outline-none","onUpdate:modelValue":Ae=>F.remark=Ae,placeholder:"請輸入備註","aria-label":`${F.courseName}的備註`},null,8,AS)),[[ee,F.remark]]):(t(),s(Z,{key:1},[xe(l(F.remark||"--"),1)],64))]),e("td",IS,[e("div",RS,[e("label",{for:`rate80-${ne}`,class:X(["flex items-center",{"cursor-pointer":De.value}])},[F.is80===3||F.is80===2?(t(),s("div",US,M[60]||(M[60]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate80-${ne}`,type:"checkbox","onUpdate:modelValue":Ae=>F.selected80=Ae,disabled:!F.selected||F.is80!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的80%補助比例`,onChange:Ae=>vt(ne,"80")},null,40,NS)),[[Ce,F.selected80]]),e("span",{class:X(["text-sm",{"text-gray-400":F.is80===3||F.is80===2}])},"80%",2)],10,PS),e("label",{for:`rate15-${ne}`,class:X(["flex items-center",{"cursor-pointer":De.value}])},[F.is15===3||F.is15===2?(t(),s("div",VS,M[61]||(M[61]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate15-${ne}`,type:"checkbox","onUpdate:modelValue":Ae=>F.selected15=Ae,disabled:!F.selected||F.is15!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的15%補助比例`,onChange:Ae=>vt(ne,"15")},null,40,jS)),[[Ce,F.selected15]]),e("span",{class:X(["text-sm",{"text-gray-400":F.is15===3||F.is15===2}])},"15%",2)],10,TS),e("label",{for:`rate5-${ne}`,class:X(["flex items-center",{"cursor-pointer":De.value}])},[F.is5===3||F.is5===2?(t(),s("div",FS,M[62]||(M[62]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate5-${ne}`,type:"checkbox","onUpdate:modelValue":Ae=>F.selected5=Ae,disabled:!F.selected||F.is5!==1||!De.value||F.selected0||F.is0===2||F.is0===3,class:"mr-1","aria-label":`選擇${F.courseName}的5%補助比例`,onChange:Ae=>vt(ne,"5")},null,40,qS)),[[Ce,F.selected5]]),e("span",{class:X(["text-sm",{"text-gray-400":F.is5===3||F.is5===2}])},"5%",2)],10,LS),e("label",{for:`rate0-${ne}`,class:X(["flex items-center",{"cursor-pointer":De.value}])},[F.is0===3||F.is0===2?(t(),s("div",BS,M[63]||(M[63]=[e("span",{class:"text-gray-600"},"✓",-1)]))):I((t(),s("input",{key:1,id:`rate0-${ne}`,type:"checkbox","onUpdate:modelValue":Ae=>F.selected0=Ae,disabled:!F.selected||F.is0!==1||!De.value||F.selected80||F.is80===2||F.is80===3||F.selected15||F.is15===2||F.is15===3||F.selected5||F.is5===2||F.is5===3,class:"mr-1","aria-label":`選擇${F.courseName}的0%補助比例`,onChange:Ae=>vt(ne,"0")},null,40,HS)),[[Ce,F.selected0]]),e("span",{class:X(["text-sm",{"text-gray-400":F.is0===3||F.is0===2}])},"0%",2)],10,OS)])])],2))),128))])])]),e("div",WS,[e("div",zS,[M[64]||(M[64]=xe(" 本次申請共計 ")),e("span",KS,l(R.value),1),M[65]||(M[65]=xe(" 門課程 "))]),e("div",JS,[M[66]||(M[66]=xe(" 申請金額 ")),e("span",YS,l(te(P.value)),1)])])])]),g.value?(t(),s("div",GS,[e("div",QS,[M[85]||(M[85]=e("h2",{class:"text-xl font-bold mb-4"},"投入資安工作明細",-1)),e("div",ZS,[e("div",XS,[e("div",e9,[M[70]||(M[70]=e("span",{class:"mr-4"},[xe("回覆方式"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",t9,[e("label",s9,[I(e("input",{type:"radio","onUpdate:modelValue":M[11]||(M[11]=F=>r.value=F),value:1,class:"w-4 h-4 mr-1"},null,512),[[ct,r.value]]),M[67]||(M[67]=e("span",null,"核撥申請",-1))]),e("label",a9,[I(e("input",{type:"radio","onUpdate:modelValue":M[12]||(M[12]=F=>r.value=F),value:2,class:"w-4 h-4 mr-1"},null,512),[[ct,r.value]]),M[68]||(M[68]=e("span",null,"電子郵件",-1))]),e("label",o9,[I(e("input",{type:"radio","onUpdate:modelValue":M[13]||(M[13]=F=>r.value=F),value:3,class:"w-4 h-4 mr-1"},null,512),[[ct,r.value]]),M[69]||(M[69]=e("span",null,"電訪",-1))])])]),e("div",l9,[e("div",n9,[I(e("input",{type:"radio","onUpdate:modelValue":M[14]||(M[14]=F=>b.value=F),value:1,id:"workType1",class:"w-5 h-5 mr-2"},null,512),[[ct,b.value]]),M[71]||(M[71]=e("label",{for:"workType1"},"是，已投入資安工作。",-1))]),e("button",{class:"ml-4 px-3 py-1 bg-[#4e9875] text-white text-sm rounded",onClick:pe}," 回覆職務內容 "),M[72]||(M[72]=e("span",{class:"ml-2 text-red-500"},"（已投入資安工作者必填）",-1))]),e("div",r9,[e("div",i9,[I(e("input",{type:"radio","onUpdate:modelValue":M[15]||(M[15]=F=>b.value=F),value:2,id:"workType2",class:"w-5 h-5 mr-2"},null,512),[[ct,b.value]]),M[74]||(M[74]=e("label",{for:"workType2"},"否，尚未投入資安工作",-1)),e("div",d9,[M[73]||(M[73]=e("div",{class:"mb-1 mr-4 whitespace-nowrap"},"調任日期",-1)),e("div",u9,[I(e("input",{type:"text","onUpdate:modelValue":M[16]||(M[16]=F=>w.value=F),class:"w-full outline-none",placeholder:"例如:114/01/05"},null,512),[[ee,w.value]])])])])]),e("div",c9,[e("div",p9,[e("div",null,[M[75]||(M[75]=e("div",{class:"mb-1"},"原機關",-1)),e("div",v9,[I(e("input",{type:"text","onUpdate:modelValue":M[17]||(M[17]=F=>k.value=F),class:"w-full outline-none"},null,512),[[ee,k.value]])])]),e("div",null,[M[76]||(M[76]=e("div",{class:"mb-1"},"調任機關",-1)),e("div",m9,[I(e("input",{type:"text","onUpdate:modelValue":M[18]||(M[18]=F=>c.value=F),class:"w-full outline-none"},null,512),[[ee,c.value]])]),M[77]||(M[77]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))]),e("div",null,[M[78]||(M[78]=e("div",{class:"mb-1"},"原職系",-1)),e("div",b9,[I(e("input",{type:"text","onUpdate:modelValue":M[19]||(M[19]=F=>A.value=F),class:"w-full outline-none"},null,512),[[ee,A.value]])])]),e("div",null,[M[79]||(M[79]=e("div",{class:"mb-1"},"調任職系",-1)),e("div",f9,[I(e("input",{type:"text","onUpdate:modelValue":M[20]||(M[20]=F=>G.value=F),class:"w-full outline-none"},null,512),[[ee,G.value]])]),M[80]||(M[80]=e("div",{class:"text-red-500 text-sm mt-1"},"機關與職系未變動者免填",-1))])])]),Number(b.value)===2?(t(),s("div",y9,[M[84]||(M[84]=e("div",null,[xe("原因"),e("span",{class:"text-red-500"},"（必填）")],-1)),e("div",g9,[e("div",x9,[I(e("input",{type:"radio","onUpdate:modelValue":M[21]||(M[21]=F=>f.value=F),value:1,id:"reason1",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,f.value]]),M[81]||(M[81]=e("label",{for:"reason1"},"職涯規劃改變",-1))]),e("div",h9,[I(e("input",{type:"radio","onUpdate:modelValue":M[22]||(M[22]=F=>f.value=F),value:2,id:"reason2",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,f.value]]),M[82]||(M[82]=e("label",{for:"reason2"},"積極尋求機會中",-1))]),e("div",w9,[I(e("input",{type:"radio","onUpdate:modelValue":M[23]||(M[23]=F=>f.value=F),value:3,id:"reason3",class:"w-5 h-5 mt-0.5 mr-2"},null,512),[[ct,f.value]]),M[83]||(M[83]=e("label",{for:"reason3"},"其他，請描述：",-1)),e("div",_9,[I(e("input",{type:"text","onUpdate:modelValue":M[24]||(M[24]=F=>p.value=F),class:"w-full outline-none",disabled:Number(f.value)!==3},null,8,k9),[[ee,p.value]])])])])])):J("",!0)])]),e("div",$9,[e("button",{class:X(["px-8 py-2 bg-[#4e9875] text-white rounded hover:bg-[#4d8b6f]",{"cursor-not-allowed":!E.value}]),onClick:Be,disabled:!E.value}," 確認 ",10,C9),e("button",{class:"px-8 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",onClick:me}," 取消 ")])])])):J("",!0),y.value?(t(),ls(Bs,{key:1,show:y.value,studentId:V.value,initialData:W.value,onClose:M[25]||(M[25]=F=>y.value=!1),onSave:we},null,8,["show","studentId","initialData"])):J("",!0),O.value?(t(),s("div",E9,[e("div",S9,[M[86]||(M[86]=e("h3",{class:"text-lg font-medium mb-4"},"選擇匯出版本",-1)),e("div",D9,[e("div",M9,[e("button",{onClick:M[26]||(M[26]=F=>Ve(!0)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 隱蔽加密版 "),e("button",{onClick:M[27]||(M[27]=F=>Ve(!1)),class:"w-full px-4 py-3 border border-gray-300 rounded hover:bg-gray-100 text-left"}," 無隱蔽版 ")])]),e("div",{class:"flex justify-end"},[e("button",{onClick:_e,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 ")])])])):J("",!0),Pt.value?(t(),s("div",A9,[e("div",I9,[M[91]||(M[91]=e("h3",{class:"text-lg font-bold mb-4"},"申請不通過原因",-1)),(t(!0),s(Z,null,re(wt.value,F=>(t(),s("div",{key:F.category,class:"mb-4"},[e("span",R9,l(F.category),1),e("div",P9,[(t(!0),s(Z,null,re(F.items,ne=>(t(),s("label",{key:ne.modelKey,class:"flex items-center text-sm"},[I(e("input",{type:"checkbox","onUpdate:modelValue":Ae=>It.value[F.modelGroup][ne.modelKey]=Ae,class:"mr-2"},null,8,U9),[[Ce,It.value[F.modelGroup][ne.modelKey]]]),xe(" "+l(ne.text),1)]))),128))])]))),128)),e("div",N9,[e("label",T9,[M[87]||(M[87]=xe(" 三、")),I(e("input",{type:"checkbox","onUpdate:modelValue":M[28]||(M[28]=F=>It.value.notProjectStudent=F),class:"mr-2"},null,512),[[Ce,It.value.notProjectStudent]]),M[88]||(M[88]=xe("非本計畫學員。 "))])]),e("div",V9,[e("label",j9,[M[89]||(M[89]=xe(" 四、")),I(e("input",{type:"checkbox","onUpdate:modelValue":M[29]||(M[29]=F=>It.value.other=F),class:"mr-2"},null,512),[[Ce,It.value.other]]),M[90]||(M[90]=xe("其他: "))]),I(e("textarea",{"onUpdate:modelValue":M[30]||(M[30]=F=>Ct.value=F),disabled:!It.value.other,class:"w-full p-2 border border-gray-300 rounded-md resize-none",rows:"3",placeholder:"請輸入其他不通過原因"},null,8,L9),[[ee,Ct.value]])]),e("div",{class:"flex justify-end space-x-4"},[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] rounded-md",onClick:Et},"確定 "),e("button",{class:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400",onClick:Mt},"取消 ")])])])):J("",!0)],64))}},q9=Le(F9,[["__scopeId","data-v-8f280725"]]),O9={class:"flex flex-col items-center p-6"},B9={class:"w-full max-w-[1500px]"},H9={class:"w-full max-w-[1500px] flex justify-end items-center mt-6 mb-6"},W9=["disabled"],z9={class:"w-full max-w-[1500px]"},K9={class:"overflow-x-auto"},J9={class:"w-full border-collapse"},Y9={class:"border p-2"},G9=["checked"],Q9={class:"border p-2 text-center"},Z9=["onUpdate:modelValue"],X9={class:"border p-2 text-center"},eD={class:"border p-2 text-center"},tD={class:"border p-2 text-center"},sD={class:"border p-2 text-center"},aD={class:"border p-2 text-center"},oD={class:"border p-2 text-center"},lD={class:"border p-2 text-center"},nD={key:0},rD={colspan:"8",class:"border p-4 text-center"},iD={__name:"Remittance",setup(D){const x=We(),d=m(!1),u=m(!1),C=m([]),o=g=>g==null?"$------":`$${g.toLocaleString()}`,N=g=>{switch(parseInt(g)){case 1:return"待申請";case 2:return"審核中";case 3:return"已完成";case 4:return"已撥款";default:return"未知狀態"}},K=g=>{switch(typeof g=="string"?parseInt(g):g){case 1:return"bg-yellow-100 text-yellow-800";case 2:return"bg-orange-100 text-orange-800";case 3:return"bg-blue-100 text-blue-800";case 4:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},$=Se(()=>C.value.length>0&&C.value.every(g=>g.selected)),P=g=>{const a=g.target.checked;C.value.forEach(A=>{A.selected=a})},T=async()=>{var g;try{d.value=!0;const a=await _t.getRemittanceApplications();if(a.data&&a.data.code===0)C.value=a.data.data.map(A=>({id:A.orderId,applyDate:A.applicationDate,orgName:A.agencyName,studentName:A.name,idNumber:A.idNumber,email:A.email,orderNumber:A.caseNumber,bankAccount:A.bankCode==="700"?`${A.bankCode}-${A.branchAccount}`:`${A.bankCode}-${A.branchCode}-${A.branchAccount}`,amount:A.subsidyAmount,status:A.status,selected:!1}));else{const A=((g=a.data)==null?void 0:g.message)||"獲取匯款申請列表失敗，請稍後再試";throw new Error(A)}}catch(a){console.error("獲取匯款申請列表失敗:",a),v.showError("載入失敗",a.message||"獲取匯款申請列表失敗"),C.value=[]}finally{d.value=!1}},z=async()=>{var g;try{const a=C.value.filter(k=>k.selected);if(a.length===0){v.showError("貼心提醒","請至少選擇一個匯款申請");return}u.value=!0;const A=a.map(k=>({orderId:k.id})),G=await _t.createRemittance(A);if(G.data&&G.data.code===0)v.showSuccess("貼心提醒","匯款清單已成功儲存"),x.push("/expense-list?tab=remittance");else{const k=((g=G.data)==null?void 0:g.message)||"儲存匯款清單失敗，請稍後再試";throw new Error(k)}}catch(a){console.error("儲存匯款清單失敗:",a),v.showError("儲存失敗",a.message||"儲存匯款清單失敗")}finally{u.value=!1}};return je(()=>{T()}),(g,a)=>(t(),s("div",O9,[e("div",B9,[Qe(pt,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"新增匯款清單",path:"/remittance"}]})]),e("div",H9,[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:z,disabled:u.value},l(u.value?"儲存中...":"儲存"),9,W9)]),e("div",z9,[e("div",K9,[e("table",J9,[e("thead",null,[e("tr",null,[e("th",Y9,[e("input",{type:"checkbox",onChange:P,checked:$.value,class:"w-4 h-4 cursor-pointer"},null,40,G9)]),a[0]||(a[0]=e("th",{class:"border p-2"},"申請日期",-1)),a[1]||(a[1]=e("th",{class:"border p-2"},"機關名稱",-1)),a[2]||(a[2]=e("th",{class:"border p-2"},"姓名",-1)),a[3]||(a[3]=e("th",{class:"border p-2"},"單號",-1)),a[4]||(a[4]=e("th",{class:"border p-2"},"匯款帳號",-1)),a[5]||(a[5]=e("th",{class:"border p-2"},"申請金額",-1)),a[6]||(a[6]=e("th",{class:"border p-2"},"申請單狀態",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(C.value,(A,G)=>(t(),s("tr",{key:A.id,class:X({"bg-[#F7F7F7]":G%2===1})},[e("td",Q9,[I(e("input",{type:"checkbox","onUpdate:modelValue":k=>A.selected=k,class:"w-4 h-4 cursor-pointer"},null,8,Z9),[[Ce,A.selected]])]),e("td",X9,l(A.applyDate),1),e("td",eD,l(A.orgName),1),e("td",tD,l(A.studentName),1),e("td",sD,l(A.orderNumber),1),e("td",aD,l(A.bankAccount),1),e("td",oD,l(o(A.amount)),1),e("td",lD,[e("span",{class:X(["px-2 py-1 rounded text-sm",K(A.status)])},l(N(A.status)),3)])],2))),128)),C.value.length===0?(t(),s("tr",nD,[e("td",rD,l(d.value?"載入中...":"無符合條件的資料"),1)])):J("",!0)])])])])]))}},dD=Le(iD,[["__scopeId","data-v-2c35235a"]]),uD={class:"flex flex-col items-center p-6"},cD={class:"w-full max-w-[1500px]"},pD={class:"w-full max-w-[1500px] flex justify-end items-center mb-2"},vD=["disabled"],mD=["disabled"],bD=["disabled"],fD={class:"w-full max-w-[1500px] flex justify-between items-center mb-2"},yD={class:"font-medium"},gD={class:"flex items-center"},xD=["value"],hD={class:"w-full max-w-[1500px]"},wD={class:"overflow-x-auto"},_D={class:"w-full border-collapse"},kD={class:"border p-2"},$D=["checked"],CD={class:"border p-2 text-center"},ED=["onUpdate:modelValue"],SD={class:"border p-2 text-center"},DD={class:"border p-2 text-center"},MD={class:"border p-2 text-center"},AD={class:"border p-2 text-center"},ID={class:"border p-2 text-center"},RD={class:"border p-2 text-center"},PD={class:"border p-2 text-center"},UD={class:"border p-2 text-center"},ND={class:"border p-2 text-center"},TD={class:"border p-2 text-center"},VD={class:"border p-2 text-center"},jD={class:"border p-2 text-center"},LD={class:"border p-2 text-center"},FD={key:0},qD={colspan:"14",class:"border p-4 text-center text-gray-500"},OD={class:"flex justify-end mt-4"},BD={class:"text-lg font-medium"},HD={key:0,class:"mt-4 w-full border p-4 bg-gray-50"},WD={class:"whitespace-pre-wrap"},zD={__name:"RemittanceEdit",setup(D){const x=We(),d=lt(),u=m(!1),C=m(!1),o=m(!1),N=m(null),K=m(""),$=m(0),P=m(""),T=m(!0),z=m([]),g=m("1"),a=m([{value:"1",label:"彙整中"},{value:"2",label:"審核中"},{value:"3",label:"已完成"},{value:"4",label:"已撥款"}]),A=m({verificationUpdate:!1,verificationExport:!1}),G=m(!1),k=m(""),c=async()=>{try{const _=await tt.getSidebarPermissions();_.data.code===0&&_.data.message==="success"?(A.value=_.data.data,console.log("匯款清單編輯頁面權限:",A.value)):console.error("獲取權限失敗:",_.data.message)}catch(_){console.error("獲取權限錯誤:",_)}},b=_=>{if(!_)return"114年5月";try{const E=_.match(/\d+/);if(E&&E[0]){const L=E[0];if(L.length>=5){const j=L.substring(0,3);let R=L.substring(3,5);return R.startsWith("0")&&(R=R.substring(1)),`${j}年${R}月`}}}catch(E){console.error("提取年月時出錯:",E)}return"114年5月"},r=_=>_==null?"$------":`$${_.toLocaleString()}`,f=Se(()=>z.value.length>0&&z.value.every(_=>_.selected)),p=_=>{const E=_.target.checked;z.value.forEach(L=>{L.selected=E})},w=async()=>{var _;try{u.value=!0,T.value=!0;const E=d.query.id;if(!E)throw new Error("未提供匯款清單ID");N.value=E;const L=await _t.getRemittanceDetail(E);if(L.data&&L.data.code===0){const j=L.data.data;K.value=j.batchNumber,g.value=String(j.status),$.value=j.totalAmount||0,P.value=j.remark||"",z.value=j.details.map(R=>({id:R.orderId,applyDate:R.applicationDate,orgName:R.agencyName,studentName:R.name,idNumber:R.idNumber,email:R.email,orderNumber:R.caseNumber,schoolName:R.schoolName,trainingStartDate:R.trainingStartDate,trainingEndDate:R.trainingEndDate,courseName:R.courseName,credit:R.credit,singleCreditFee:R.singleCreditFee,creditFee:R.creditFee,subsidyPercent:R.subsidyPercent,subsidyAmount:R.subsidyAmount,status:R.status,selected:!0}))}else{const j=((_=L.data)==null?void 0:_.message)||"獲取匯款清單詳情失敗，請稍後再試";throw new Error(j)}}catch(E){console.error("獲取匯款清單詳情失敗:",E),v.showError("載入失敗",E.message||"獲取匯款清單詳情失敗"),z.value=[]}finally{u.value=!1,setTimeout(()=>{T.value=!1},200)}},y=async()=>{var _;try{const E=z.value.filter(te=>te.selected);if(E.length===0){v.showError("貼心提醒","請至少選擇一個匯款申請");return}const L=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(L===null||L==="")return;if(C.value=!0,(await _t.confirmPassword(L)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),C.value=!1;return}const R={remittanceId:N.value,status:parseInt(g.value),remark:g.value==="4"?P.value:"",details:E.map(te=>({orderId:te.id}))};console.log("更新匯款清單項目:",R);const U=await _t.updateRemittance(R);if(U.data&&U.data.code===0)v.showSuccess("貼心提醒","匯款清單已成功儲存"),x.push({path:"/expense-list",query:{tab:"remittance"}});else{const te=((_=U.data)==null?void 0:_.message)||"儲存匯款清單失敗，請稍後再試";throw new Error(te)}}catch(E){console.error("儲存匯款清單失敗:",E),E.response&&E.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("儲存失敗",E.message||"儲存匯款清單失敗")}finally{C.value=!1}},V=async()=>{const _=await v.promptAsync("編輯撥款備註","請修改撥款備註資訊","text",P.value);_!==null&&(P.value=_)};Ee(()=>g.value,async(_,E)=>{if(T.value){k.value=_;return}if(!T.value&&_==="4"&&E!=="4"&&!G.value){const L=await v.promptAsync("撥款備註","請輸入撥款備註資訊","text",P.value);if(L===null){G.value=!0,g.value=E,setTimeout(()=>{G.value=!1},100);return}P.value=L}if(!T.value&&E==="4"&&_!=="4"&&!G.value&&k.value==="4"&&!await v.confirmAsync("警示","此申請單狀態為已撥款，請確認正確申請單狀態")){G.value=!0,g.value=E,setTimeout(()=>{G.value=!1},100);return}}),je(()=>{w(),c()});const W=async()=>{try{if(z.value.length===0){v.showError("貼心提醒","無匯款申請資料可供匯出");return}o.value=!0;const _=await v.promptAsync("請輸入管理員密碼 (提供資安署主計室)","請輸入您的密碼以驗證身份","password");if(_===null||_===""){o.value=!1;return}if((await _t.confirmPassword(_)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),o.value=!1;return}const L=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(L===null){o.value=!1;return}try{const j={id:N.value,password:L},R=await _t.exportRemittanceList(j),U=R.headers["content-type"];if(!U||!U.includes("spreadsheetml.sheet")){try{const De=await new Response(R.data).text(),$e=JSON.parse(De);console.error("匯出匯款清單失敗：伺服器返回錯誤：",$e),v.showError("匯出失敗",$e.message||"匯出過程中發生錯誤，請稍後再試")}catch(De){console.error("匯出匯款清單失敗：無法解析回應內容",De),v.showError("匯出失敗","回應格式不正確，請稍後再試")}o.value=!1;return}const te=new Blob([R.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ue=new Date,ye=`${ue.getFullYear()}-${String(ue.getMonth()+1).padStart(2,"0")}-${String(ue.getDate()).padStart(2,"0")}`,ke=document.createElement("a");ke.href=URL.createObjectURL(te),ke.download=`${b(K.value)}補助學員訓練課程費用清單_${ye}.xlsx`,document.body.appendChild(ke),ke.click(),setTimeout(()=>{URL.revokeObjectURL(ke.href),document.body.removeChild(ke),v.showSuccess("貼心提醒","匯款清單已成功下載"),o.value=!1},100)}catch(j){console.error("匯出過程中發生錯誤:",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤"),o.value=!1}}catch(_){console.error("匯出匯款清單失敗:",_),v.showError("匯出失敗",_.message||"匯出匯款清單失敗，請稍後再試"),o.value=!1}},O=async()=>{try{if(z.value.length===0){v.showError("貼心提醒","無匯款申請資料可供匯出");return}o.value=!0;const _=await v.promptAsync("請輸入管理員密碼 (提供健行科大主計室)","請輸入您的密碼以驗證身份","password");if(_===null||_===""){o.value=!1;return}if((await _t.confirmPassword(_)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),o.value=!1;return}const L=await v.promptAsync("請設定檔案密碼","請為匯出的檔案設定一個密碼","password");if(L===null){o.value=!1;return}const j={id:N.value,password:L},R=await _t.exportRemittanceDetail(j),U=R.headers["content-type"];if(!U||!U.includes("spreadsheetml.sheet"))try{const $e=await new Response(R.data).text(),ve=JSON.parse($e);console.error("匯出匯款詳細清單失敗：伺服器返回錯誤：",ve),v.showError("匯出失敗",ve.message||"匯出過程中發生錯誤，請稍後再試"),o.value=!1;return}catch($e){console.error("匯出匯款詳細清單失敗：無法解析回應內容",$e),v.showError("匯出失敗","回應格式不正確，請稍後再試"),o.value=!1;return}const te=new Blob([R.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ue=document.createElement("a");ue.href=URL.createObjectURL(te);const ye=new Date,ke=`${ye.getFullYear()}-${String(ye.getMonth()+1).padStart(2,"0")}-${String(ye.getDate()).padStart(2,"0")}`,De=`匯款詳細清單_${K.value}_${ke}.xlsx`;ue.download=De,ue.click(),URL.revokeObjectURL(ue.href),v.showSuccess("匯出成功","匯款詳細清單已成功匯出")}catch(_){console.error("匯出匯款詳細清單失敗:",_),_.response&&_.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("匯出失敗",_.message||"匯出匯款詳細清單失敗，請稍後再試")}finally{o.value=!1}};return(_,E)=>(t(),s("div",uD,[e("div",cD,[Qe(pt,{breadcrumbs:[{name:"費用核撥",path:"/expense-list"},{name:"匯款清單編輯",path:"/remittance-edit"}]})]),e("div",pD,[A.value.verificationUpdate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-4",onClick:y,disabled:C.value},l(C.value?"儲存中...":"儲存"),9,vD)):J("",!0),A.value.verificationExport?(t(),s("button",{key:1,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c] mr-2",onClick:W,disabled:o.value},l(o.value?"匯出中...":"列印匯款清單"),9,mD)):J("",!0),A.value.verificationExport?(t(),s("button",{key:2,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3e7a5c]",onClick:O,disabled:o.value},l(o.value?"匯出中...":"匯款資料明細"),9,bD)):J("",!0)]),e("div",fD,[e("div",null,[E[1]||(E[1]=xe("批號：")),e("span",yD,l(K.value),1)]),e("div",gD,[E[2]||(E[2]=xe(" 匯款清單狀態： ")),I(e("select",{"onUpdate:modelValue":E[0]||(E[0]=L=>g.value=L),class:"ml-2 border border-gray-300 p-1 outline-none"},[(t(!0),s(Z,null,re(a.value,L=>(t(),s("option",{key:L.value,value:L.value},l(L.label),9,xD))),128))],512),[[Pe,g.value]])])]),e("div",hD,[e("div",wD,[e("table",_D,[e("thead",null,[e("tr",null,[e("th",kD,[e("input",{type:"checkbox",onChange:p,checked:f.value,class:"w-4 h-4 cursor-pointer"},null,40,$D)]),E[3]||(E[3]=e("th",{class:"border p-2"},"序號",-1)),E[4]||(E[4]=e("th",{class:"border p-2"},"申請日期",-1)),E[5]||(E[5]=e("th",{class:"border p-2"},"姓名",-1)),E[6]||(E[6]=e("th",{class:"border p-2"},"機關名稱",-1)),E[7]||(E[7]=e("th",{class:"border p-2"},"申請表編號",-1)),E[8]||(E[8]=e("th",{class:"border p-2"},"訓練單位",-1)),E[9]||(E[9]=e("th",{class:"border p-2"},"課程起訖",-1)),E[10]||(E[10]=e("th",{class:"border p-2"},"課程名稱",-1)),E[11]||(E[11]=e("th",{class:"border p-2"},"學分數/職能科數",-1)),E[12]||(E[12]=e("th",{class:"border p-2"},"每學分費/每科費用",-1)),E[13]||(E[13]=e("th",{class:"border p-2"},"合計學分(職能)費用",-1)),E[14]||(E[14]=e("th",{class:"border p-2"},"核撥比例",-1)),E[15]||(E[15]=e("th",{class:"border p-2"},"核撥金額",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(z.value,(L,j)=>(t(),s("tr",{key:L.id,class:X({"bg-[#F7F7F7]":j%2===1})},[e("td",CD,[I(e("input",{type:"checkbox","onUpdate:modelValue":R=>L.selected=R,class:"w-4 h-4 cursor-pointer"},null,8,ED),[[Ce,L.selected]])]),e("td",SD,l(j+1),1),e("td",DD,l(L.applyDate),1),e("td",MD,l(L.studentName),1),e("td",AD,l(L.orgName),1),e("td",ID,l(L.orderNumber),1),e("td",RD,l(L.schoolName),1),e("td",PD,l(L.trainingStartDate)+" ~ "+l(L.trainingEndDate),1),e("td",UD,l(L.courseName),1),e("td",ND,l(L.credit),1),e("td",TD,l(r(L.singleCreditFee)),1),e("td",VD,l(r(L.creditFee)),1),e("td",jD,l(L.subsidyPercent)+"%",1),e("td",LD,l(r(L.subsidyAmount)),1)],2))),128)),z.value.length===0?(t(),s("tr",FD,[e("td",qD,l(u.value?"載入中...":"無匯款申請資料"),1)])):J("",!0)])])]),e("div",OD,[e("div",BD,[E[16]||(E[16]=xe(" 合計申請金額：")),e("span",null,l(r($.value)),1)])]),g.value==="4"&&P.value?(t(),s("div",HD,[e("div",{class:"flex justify-between items-center mb-2"},[E[17]||(E[17]=e("div",{class:"font-medium"},"撥款備註：",-1)),e("button",{onClick:V,class:"px-2 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded"}," 編輯備註 ")]),e("div",WD,l(P.value),1)])):J("",!0)])]))}},KD=Le(zD,[["__scopeId","data-v-8f80f8d9"]]),as={getRoleList:(D={})=>(D.page&&(D.page=Number(D.page)),D.limit?D.limit=Number(D.limit):D.limit=20,he.get("/v1/role",{params:D})),createRole:D=>he.post("/v1/role",D),updateRole:(D,x)=>he.put(`/v1/role/${D}`,x),deleteRole:D=>he.delete(`/v1/role/${D}`),getRolePermissions:D=>he.get(`/v1/role/${D}`),updateRolePermissions:(D,x)=>he.put(`/v1/role/permission/${D}`,x),getLogs:(D={})=>{if(D.page&&(D.page=Number(D.page)),D.limit?D.limit=Number(D.limit):D.limit=20,D.startTime&&D.endTime&&(D.dateRange=[D.startTime,D.endTime],delete D.startTime,delete D.endTime),D.logLevel){let x;switch(D.logLevel){case"DEBUG":x=1;break;case"INFO":x=2;break;case"WARNING":x=3;break;case"ERROR":x=4;break;default:x=null}x&&(D.level=x),delete D.logLevel}return he.get("/v1/logs",{params:D})},exportLogs:(D={})=>he.get("/v1/logs/export",{params:D,responseType:"blob"}),exportDatabase:D=>he.post("/v1/export",D,{responseType:"blob"}),exportDump:()=>he.get("/v1/export/dump",{responseType:"blob"})},JD={class:"flex flex-col items-center p-6"},YD={class:"w-full max-w-[1500px]"},GD={class:"w-full max-w-[1500px] mb-6 flex justify-end items-center"},QD={class:"w-full max-w-[1500px] overflow-auto"},ZD={key:0,class:"flex justify-center items-center py-10"},XD={key:1,class:"w-full border-collapse"},eM={class:"border p-2 text-center"},tM={class:"border p-2 text-center"},sM=["aria-label"],aM={class:"border p-2 text-center"},oM={class:"border p-2 text-center"},lM={class:"border p-2 text-center"},nM={class:"border p-2 text-center"},rM={class:"border p-2 text-center"},iM=["onClick","aria-label"],dM=["onClick","aria-label"],uM=["onClick","aria-label"],cM={key:0},pM={key:2,class:"flex justify-center items-center space-x-2 mt-6"},vM=["disabled"],mM=["onClick","aria-label","aria-current"],bM={key:1,class:"px-2"},fM=["disabled"],yM={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},gM={class:"bg-white p-6 rounded-lg shadow-lg w-[400px]"},xM={class:"text-lg font-bold mb-4"},hM={class:"mb-4"},wM={class:"mb-4"},_M={for:"roleEnabled",class:"flex items-center cursor-pointer"},kM={class:"switch"},Ks=20,$M={__name:"RolePermissions",setup(D){const x=m(!1),d=We(),u=m([]),C=m(1),o=m(1),N=m(0),K=Se(()=>{const L=[];if(o.value<=5)for(let R=1;R<=o.value;R++)L.push(R);else{L.push(1);let R=Math.max(2,C.value-1),U=Math.min(o.value-1,C.value+1);C.value<=3&&(U=Math.min(4,o.value-1)),C.value>=o.value-2&&(R=Math.max(2,o.value-3)),R>2&&L.push("...");for(let te=R;te<=U;te++)L.push(te);U<o.value-1&&L.push("..."),L.push(o.value)}return L}),$=m(!1),P=m("新增角色"),T=m({id:null,name:"",isEnabled:!0,createdBy:"admin",createdAt:"",updatedBy:"admin",updatedAt:""}),z=m(!1),g=m({roleCreate:!1,roleUpdate:!1,roleDelete:!1}),a=async()=>{try{const L=await tt.getSidebarPermissions();L.data.code===0&&L.data.message==="success"?(g.value=L.data.data,console.log("角色權限管理頁面權限:",g.value)):console.error("獲取權限失敗:",L.data.message)}catch(L){console.error("獲取權限錯誤:",L)}},A=()=>{z.value=!1,P.value="新增角色",T.value={id:null,name:"",isEnabled:!0,createdBy:"admin",createdAt:"",updatedBy:"admin",updatedAt:""},$.value=!0},G=()=>{$.value=!1},k=L=>{G();const j=L?"角色已成功更新":"角色已成功新增";v.showSuccess(L?"更新成功":"新增成功",j),setTimeout(async()=>{await E()},300)},c=(L,j)=>{var U;const R=((U=L.data)==null?void 0:U.message)||(j?"角色更新失敗":"角色新增失敗");v.showError(j?"更新失敗":"新增失敗",R)},b=async()=>{if(!T.value.name){v.showError("儲存失敗","請輸入角色名稱");return}try{let L;z.value?L=await as.updateRole(T.value.id,T.value):L=await as.createRole(T.value),L.data&&L.data.code===0?k(z.value):c(L,z.value)}catch(L){console.error(z.value?"更新角色錯誤:":"新增角色錯誤:",L),v.showError(z.value?"更新失敗":"新增失敗","操作時發生錯誤，請稍後再試")}},r=L=>{z.value=!0,P.value="編輯角色",T.value={...L},$.value=!0},f=async()=>{const L=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");return L===null||L===""?null:(await es.confirmPassword(L)).data.code!==0?(v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),null):!0},p=async L=>{var U;const j=await as.deleteRole(L);if(j.data&&j.data.code===0)return v.showSuccess("刪除成功","角色已成功刪除"),setTimeout(async()=>{await E()},300),!0;const R=((U=j.data)==null?void 0:U.message)||"角色刪除失敗";return v.showError("刪除失敗",R),!1},w=L=>{console.error("刪除角色錯誤:",L),L.response&&L.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除角色時發生錯誤，請稍後再試")},y=async L=>{if(await v.confirmAsync("確認刪除",`確定要刪除角色「${L.name}」嗎？`))try{if(await f()===null)return;await p(L.id)}catch(R){w(R)}},V=L=>{d.push({name:"PermissionSettings",query:{roleId:L.id,roleName:L.name}})},W=L=>{L!==C.value&&!x.value&&(C.value=L,E())},O=()=>{C.value>1&&!x.value&&(C.value--,E())},_=()=>{C.value<o.value&&!x.value&&(C.value++,E())},E=async()=>{var L,j;try{x.value=!0;const R={page:C.value,limit:Ks},U=await as.getRoleList(R);if(U.data&&U.data.code===0)u.value=U.data.data.result||[],N.value=U.data.data.totalCount||0,o.value=U.data.data.totalPage||Math.ceil(N.value/Ks)||1,C.value>o.value&&o.value>0&&(C.value=1,await E());else if(console.error("獲取角色列表失敗:",(L=U.data)==null?void 0:L.message),u.value=[],N.value=0,o.value=0,!z.value){const te=((j=U.data)==null?void 0:j.message)||"獲取角色列表失敗";v.showError("載入失敗",te)}}catch(R){console.error("獲取角色列表錯誤:",R),u.value=[],N.value=0,o.value=0,z.value||v.showError("載入失敗","獲取角色列表錯誤，請稍後再試")}finally{x.value=!1}};return je(()=>{E(),a()}),(L,j)=>(t(),s("div",JD,[e("div",YD,[Qe(pt,{breadcrumbs:[{name:"角色管理",path:"/role-permissions"}]})]),e("div",GD,[g.value.roleCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d]",onClick:A,"aria-label":"新增角色"}," 新增角色 ")):J("",!0)]),e("div",QD,[x.value?(t(),s("div",ZD,j[2]||(j[2]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",XD,[j[4]||(j[4]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2"},"角色名稱"),e("th",{class:"border p-2"},"啟用"),e("th",{class:"border p-2"},"建立人"),e("th",{class:"border p-2"},"建立日期"),e("th",{class:"border p-2"},"修改人"),e("th",{class:"border p-2"},"修改日期"),e("th",{class:"border p-2"},"功能")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(u.value,(R,U)=>(t(),s("tr",{key:U,class:"hover:bg-gray-100"},[e("td",eM,l(R.name),1),e("td",tM,[e("span",{class:X({"text-[#4e9875] font-medium":R.isEnabled,"text-gray-500":!R.isEnabled}),"aria-label":`角色 ${R.name} ${R.isEnabled?"已啟用":"未啟用"}`},l(R.isEnabled?"啟用":"不啟用"),11,sM)]),e("td",aM,l(R.createdBy||"-"),1),e("td",oM,l(R.createdAt||"-"),1),e("td",lM,l(R.updatedBy||"-"),1),e("td",nM,l(R.updatedAt||"-"),1),e("td",rM,[g.value.roleUpdate?(t(),s("button",{key:0,class:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded mr-1",onClick:te=>r(R),"aria-label":`編輯角色 ${R.name}`}," 編輯 ",8,iM)):J("",!0),g.value.roleDelete?(t(),s("button",{key:1,class:"px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded mr-1",onClick:te=>y(R),"aria-label":`刪除角色 ${R.name}`}," 刪除 ",8,dM)):J("",!0),g.value.roleUpdate?(t(),s("button",{key:2,class:"px-2 py-1 bg-[#4e9875] hover:bg-[#3d7a5d] text-white rounded",onClick:te=>V(R),"aria-label":`設定角色 ${R.name} 的權限`}," 權限設定 ",8,uM)):J("",!0)])]))),128)),u.value.length===0?(t(),s("tr",cM,j[3]||(j[3]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無資料",-1)]))):J("",!0)])])),!x.value&&u.value.length>0?(t(),s("div",pM,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:C.value===1,onClick:O,"aria-label":"前往上一頁"}," 上一頁 ",8,vM),(t(!0),s(Z,null,re(K.value,R=>(t(),s(Z,{key:R},[R!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":R===C.value}]),onClick:U=>W(R),"aria-label":`前往第${R}頁`,"aria-current":R===C.value?"page":void 0},l(R),11,mM)):(t(),s("span",bM,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:C.value===o.value,onClick:_,"aria-label":"前往下一頁"}," 下一頁 ",8,fM)])):J("",!0)]),$.value?(t(),s("div",yM,[e("div",gM,[e("h2",xM,l(P.value),1),e("div",hM,[j[5]||(j[5]=e("label",{class:"block text-gray-700 mb-2",for:"roleName"},"角色名稱",-1)),I(e("input",{id:"roleName",type:"text","onUpdate:modelValue":j[0]||(j[0]=R=>T.value.name=R),class:"w-full border border-gray-300 p-2 rounded",placeholder:"請輸入角色名稱"},null,512),[[ee,T.value.name]])]),e("div",wM,[e("label",_M,[j[7]||(j[7]=e("span",{class:"text-gray-700 mr-4"},"啟用狀態",-1)),e("span",kM,[I(e("input",{id:"roleEnabled",type:"checkbox","onUpdate:modelValue":j[1]||(j[1]=R=>T.value.isEnabled=R)},null,512),[[Ce,T.value.isEnabled]]),j[6]||(j[6]=e("span",{class:"slider round"},null,-1))])])]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded mr-2",onClick:G,"aria-label":"取消操作"}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded",onClick:b,"aria-label":"儲存角色設定"}," 確定 ")])])])):J("",!0)]))}},CM=Le($M,[["__scopeId","data-v-e7dd6600"]]),EM={class:"flex flex-col items-center p-6"},SM={class:"w-full max-w-[1500px]"},DM={class:"w-full max-w-[1500px] bg-white rounded shadow-sm"},MM={class:"border-b border-gray-200 p-4"},AM={class:"flex items-center mb-4"},IM={class:"switch ml-2",for:"review-management-toggle"},RM={class:"ml-32 border rounded p-4 mb-2"},PM={class:"flex items-center mb-4"},UM={class:"switch ml-2",for:"review-list-toggle"},NM={class:"ml-32"},TM={class:"flex flex-wrap"},VM={class:"flex items-center mx-4 my-2"},jM={class:"flex items-center mx-4 my-2"},LM={class:"flex items-center mx-4 my-2"},FM={class:"flex items-center mx-4 my-2"},qM={class:"border-b border-gray-200 p-4"},OM={class:"flex items-center mb-4"},BM={class:"switch ml-2",for:"course-management-toggle"},HM={class:"ml-32 border rounded p-4 mb-2"},WM={class:"flex items-center mb-4"},zM={class:"switch ml-2",for:"course-content-toggle"},KM={class:"ml-32"},JM={class:"flex flex-wrap"},YM={class:"flex items-center mx-4 my-2"},GM={class:"flex items-center mx-4 my-2"},QM={class:"flex items-center mx-4 my-2"},ZM={class:"flex items-center mx-4 my-2"},XM={class:"flex items-center mx-4 my-2"},eA={class:"flex items-center mb-4"},tA={class:"switch ml-2",for:"supervision-visits-toggle"},sA={class:"ml-32"},aA={class:"flex flex-wrap"},oA={class:"flex items-center mx-4 my-2"},lA={class:"flex items-center mx-4 my-2"},nA={class:"flex items-center mx-4 my-2"},rA={class:"flex items-center mb-4"},iA={class:"switch ml-2",for:"satisfaction-survey-toggle"},dA={class:"ml-32"},uA={class:"flex flex-wrap"},cA={class:"flex items-center mx-4 my-2"},pA={class:"border-b border-gray-200 p-4"},vA={class:"flex items-center mb-4"},mA={class:"switch ml-2",for:"student-management-toggle"},bA={class:"ml-32 border rounded p-4 mb-2"},fA={class:"flex items-center mb-4"},yA={class:"switch ml-2",for:"student-info-toggle"},gA={class:"ml-32"},xA={class:"flex flex-wrap"},hA={class:"flex items-center mx-4 my-2"},wA={class:"flex items-center mx-4 my-2"},_A={class:"flex items-center mx-4 my-2"},kA={class:"flex items-center mx-4 my-2"},$A={class:"flex items-center mx-4 my-2"},CA={class:"flex items-center mx-4 my-2"},EA={class:"flex items-center mb-4"},SA={class:"switch ml-2",for:"learning-history-toggle"},DA={class:"flex items-center mb-4"},MA={class:"switch ml-2",for:"credit-recognition-toggle"},AA={class:"ml-32"},IA={class:"flex flex-wrap"},RA={class:"flex items-center mx-4 my-2"},PA={class:"flex items-center mx-4 my-2"},UA={class:"flex items-center mb-4"},NA={class:"switch ml-2",for:"agency-management-toggle"},TA={class:"ml-32"},VA={class:"flex flex-wrap"},jA={class:"flex items-center mx-4 my-2"},LA={class:"flex items-center mx-4 my-2"},FA={class:"flex items-center mx-4 my-2"},qA={class:"flex items-center mb-4"},OA={class:"switch ml-2",for:"student-is-non-project-toggle"},BA={class:"border-b border-gray-200 p-4"},HA={class:"flex items-center mb-4"},WA={class:"switch ml-2",for:"verification-management-toggle"},zA={class:"ml-32 border rounded p-4 mb-2"},KA={class:"flex items-center mb-4"},JA={class:"switch ml-2",for:"expense-toggle"},YA={class:"ml-32"},GA={class:"flex flex-wrap"},QA={class:"flex items-center mx-4 my-2"},ZA={class:"flex items-center mx-4 my-2"},XA={class:"flex items-center mx-4 my-2"},eI={class:"border-b border-gray-200 p-4"},tI={class:"flex items-center mb-4"},sI={class:"switch ml-2",for:"performance-tracking-toggle"},aI={class:"ml-32 border rounded p-4 mb-2"},oI={class:"flex items-center mb-4"},lI={class:"switch ml-2",for:"tracking-management-toggle"},nI={class:"ml-32"},rI={class:"flex flex-wrap"},iI={class:"flex items-center mx-4 my-2"},dI={class:"border-b border-gray-200 p-4"},uI={class:"flex items-center mb-4"},cI={class:"switch ml-2",for:"consultation-service-toggle"},pI={class:"ml-32 border rounded p-4 mb-2"},vI={class:"flex items-center mb-4"},mI={class:"switch ml-2",for:"question-management-toggle"},bI={class:"ml-32"},fI={class:"flex flex-wrap"},yI={class:"flex items-center mx-4 my-2"},gI={class:"flex items-center mx-4 my-2"},xI={class:"flex items-center mx-4 my-2"},hI={class:"flex items-center mx-4 my-2"},wI={class:"flex items-center mx-4 my-2"},_I={class:"flex items-center mb-4"},kI={class:"switch ml-2",for:"category-management-toggle"},$I={class:"ml-32"},CI={class:"flex flex-wrap"},EI={class:"flex items-center mx-4 my-2"},SI={class:"flex items-center mx-4 my-2"},DI={class:"flex items-center mx-4 my-2"},MI={class:"border-b border-gray-200 p-4"},AI={class:"flex items-center mb-4"},II={class:"switch ml-2",for:"statistical-reports-toggle"},RI={class:"border-b border-gray-200 p-4"},PI={class:"flex items-center mb-4"},UI={class:"switch ml-2",for:"dashboard-toggle"},NI={class:"border-b border-gray-200 p-4"},TI={class:"flex items-center mb-4"},VI={class:"switch ml-2",for:"tool-management-toggle"},jI={class:"ml-32 border rounded p-4 mb-2"},LI={class:"flex items-center mb-4"},FI={class:"switch ml-2",for:"file-manager-toggle"},qI={class:"ml-32"},OI={class:"flex flex-wrap"},BI={class:"flex items-center mx-4 my-2"},HI={class:"flex items-center mx-4 my-2"},WI={class:"flex items-center mx-4 my-2"},zI={class:"border-b border-gray-200 p-4"},KI={class:"flex items-center mb-4"},JI={class:"switch ml-2",for:"system-management-toggle"},YI={class:"ml-32 border rounded p-4 mb-2"},GI={class:"flex items-center mb-4"},QI={class:"switch ml-2",for:"role-management-toggle"},ZI={class:"ml-32"},XI={class:"flex flex-wrap"},eR={class:"flex items-center mx-4 my-2"},tR={class:"flex items-center mx-4 my-2"},sR={class:"flex items-center mx-4 my-2"},aR={class:"flex items-center mb-4"},oR={class:"switch ml-2",for:"role-permission-toggle"},lR={class:"ml-32"},nR={class:"flex flex-wrap"},rR={class:"flex items-center mx-4 my-2"},iR={class:"flex items-center mx-4 my-2"},dR={class:"flex items-center mx-4 my-2"},uR={class:"flex items-center mb-4"},cR={class:"switch ml-2",for:"system-log-toggle"},pR={class:"ml-32"},vR={class:"flex flex-wrap"},mR={class:"flex items-center mx-4 my-2"},bR={class:"flex items-center mb-4"},fR={class:"switch ml-2",for:"database-management-toggle"},yR={class:"ml-32"},gR={class:"flex flex-wrap"},xR={class:"flex items-center mx-4 my-2"},hR={__name:"PermissionSettings",setup(D){const x=lt(),d=We(),u=m(x.query.roleId||null),C=m(x.query.roleName||""),o=Qs({reviewManagement:{enabled:!0,edit:!0,approve:!0,import:!0,export:!0,reviewList:{enabled:!0}},courseManagement:{enabled:!0,courseContent:{enabled:!0,create:!0,edit:!0,delete:!0,import:!0,export:!0},supervisionVisits:{enabled:!0,create:!0,edit:!0,export:!0},satisfactionSurvey:{enabled:!0,import:!0}},studentManagement:{enabled:!0,studentInfo:{enabled:!0,create:!0,edit:!0,delete:!0,import:!0,export:!0,studentExportWord:!0},learningHistory:{enabled:!0},creditRecognition:{enabled:!0,create:!0,export:!0},agency:{enabled:!0,create:!0,edit:!0,delete:!0},isNonProject:!0},verificationManagement:{enabled:!0,expense:{enabled:!0,create:!0,edit:!0,export:!0}},performanceTracking:{enabled:!0,management:{enabled:!0,edit:!0}},consultationService:{enabled:!0,questionManagement:{enabled:!0,create:!0,edit:!0,delete:!0,readDetail:!0,import:!0},categoryManagement:{enabled:!0,create:!0,edit:!0,delete:!0}},dashboard:{enabled:!0},toolManagement:{enabled:!0,fileManager:{enabled:!0,create:!0,upload:!0,delete:!0}},systemManagement:{enabled:!0,roleManagement:{enabled:!0,create:!0,edit:!0,delete:!0},rolePermission:{enabled:!0,create:!0,edit:!0,delete:!0},log:{enabled:!0,export:!0},databaseManagement:{enabled:!0,export:!0}},reportAllRead:{enabled:!0}}),N=m(!1),K=async g=>{if(g)try{N.value=!0;const a=await as.getRolePermissions(g);a.data.code===0?($(a.data.data),console.log("角色權限已載入",o)):(console.error("獲取角色權限設定錯誤:",a.data.message),v.showError("載入失敗","獲取權限設定發生錯誤，請稍後再試"))}catch(a){console.error("獲取角色權限設定錯誤:",a),v.showError("載入失敗","獲取權限設定發生錯誤，請稍後再試")}finally{N.value=!1}},$=g=>{o.reviewManagement.enabled=g.reviewManagement||!1,o.reviewManagement.edit=g.reviewManagementEdit||!1,o.reviewManagement.approve=g.reviewManagementApprove||!1,o.reviewManagement.import=g.reviewManagementImport||!1,o.reviewManagement.reviewList.enabled=g.reviewManagementRead||!1,o.reviewManagement.export=g.reviewManagementExport||!1,o.courseManagement.enabled=g.courseManagement||!1,o.courseManagement.courseContent.enabled=g.courseDataRead||!1,o.courseManagement.courseContent.create=g.courseDataCreate||!1,o.courseManagement.courseContent.edit=g.courseDataUpdate||!1,o.courseManagement.courseContent.delete=g.courseDataDelete||!1,o.courseManagement.courseContent.import=g.courseDataImport||!1,o.courseManagement.courseContent.export=g.courseDataExport||!1,o.courseManagement.supervisionVisits.enabled=g.visitRead||!1,o.courseManagement.supervisionVisits.create=g.visitCreate||!1,o.courseManagement.supervisionVisits.edit=g.visitUpdate||!1,o.courseManagement.supervisionVisits.export=g.visitExport||!1,o.courseManagement.satisfactionSurvey.enabled=g.satisfactionRead||!1,o.courseManagement.satisfactionSurvey.import=g.satisfactionSurveyImport||!1,o.studentManagement.enabled=g.studentManagement||!1,o.studentManagement.studentInfo.enabled=g.studentRead||!1,o.studentManagement.studentInfo.create=g.studentCreate||!1,o.studentManagement.studentInfo.edit=g.studentUpdate||!1,o.studentManagement.studentInfo.delete=g.studentDelete||!1,o.studentManagement.studentInfo.import=g.studentImport||!1,o.studentManagement.studentInfo.export=g.studentExport||!1,o.studentManagement.studentInfo.studentExportWord=g.studentExportWord||!1,o.studentManagement.learningHistory.enabled=g.learningHistory||!1,o.studentManagement.creditRecognition.enabled=g.creditCertificationRead||!1,o.studentManagement.creditRecognition.create=g.creditCertificationCreate||!1,o.studentManagement.creditRecognition.export=g.creditCertificationImport||!1,o.studentManagement.agency.enabled=g.agencyRead||!1,o.studentManagement.agency.create=g.agencyCreate||!1,o.studentManagement.agency.edit=g.agencyUpdate||!1,o.studentManagement.agency.delete=g.agencyDelete||!1,o.studentManagement.isNonProject=g.studentIsNonProject||!1,o.verificationManagement.enabled=g.verificationManagement||!1,o.verificationManagement.expense.enabled=g.verificationRead||!1,o.verificationManagement.expense.create=g.verificationCreate||!1,o.verificationManagement.expense.edit=g.verificationUpdate||!1,o.verificationManagement.expense.export=g.verificationExport||!1,o.performanceTracking.enabled=g.performanceTracking||!1,o.performanceTracking.management.enabled=g.performanceTrackingRead||!1,o.performanceTracking.management.edit=g.performanceTrackingEdit||!1,o.consultationService.enabled=g.consultationService||!1,o.consultationService.questionManagement.enabled=g.consultationRead||!1,o.consultationService.questionManagement.create=g.consultationCreate||!1,o.consultationService.questionManagement.edit=g.consultationUpdate||!1,o.consultationService.questionManagement.delete=g.consultationDelete||!1,o.consultationService.questionManagement.readDetail=g.consultationReadDetail||!1,o.consultationService.questionManagement.import=g.consultationImport||!1,o.consultationService.categoryManagement.enabled=g.consultationCategoryRead||!1,o.consultationService.categoryManagement.create=g.consultationCategoryCreate||!1,o.consultationService.categoryManagement.edit=g.consultationCategoryEdit||!1,o.consultationService.categoryManagement.delete=g.consultationCategoryDelete||!1,o.dashboard.enabled=g.dashboard||!1,o.toolManagement.enabled=g.tool||!1,o.toolManagement.fileManager.enabled=g.fileManager||!1,o.toolManagement.fileManager.create=g.fileManagerCreate||!1,o.toolManagement.fileManager.upload=g.fileManagerUpload||!1,o.toolManagement.fileManager.delete=g.fileManagerDelete||!1,o.systemManagement.enabled=g.systemManagement||!1,o.systemManagement.roleManagement.enabled=g.userRead||!1,o.systemManagement.roleManagement.create=g.userCreate||!1,o.systemManagement.roleManagement.edit=g.userUpdate||!1,o.systemManagement.roleManagement.delete=g.userDelete||!1,o.systemManagement.rolePermission.enabled=g.roleRead||!1,o.systemManagement.rolePermission.create=g.roleCreate||!1,o.systemManagement.rolePermission.edit=g.roleUpdate||!1,o.systemManagement.rolePermission.delete=g.roleDelete||!1,o.systemManagement.log.enabled=g.systemLogRead||!1,o.systemManagement.log.export=g.systemLogExport||!1,o.systemManagement.databaseManagement.enabled=g.dataBaseRead||!1,o.systemManagement.databaseManagement.export=g.dataBaseExport||!1,o.reportAllRead.enabled=g.reportAllRead||!1},P=()=>({reviewManagement:o.reviewManagement.enabled,reviewManagementRead:o.reviewManagement.reviewList.enabled,reviewManagementEdit:o.reviewManagement.edit,reviewManagementApprove:o.reviewManagement.approve,reviewManagementImport:o.reviewManagement.import,reviewManagementExport:o.reviewManagement.export,courseManagement:o.courseManagement.enabled,courseDataCreate:o.courseManagement.courseContent.create,courseDataUpdate:o.courseManagement.courseContent.edit,courseDataDelete:o.courseManagement.courseContent.delete,courseDataImport:o.courseManagement.courseContent.import,courseDataExport:o.courseManagement.courseContent.export,courseDataRead:o.courseManagement.courseContent.enabled,visitCreate:o.courseManagement.supervisionVisits.create,visitUpdate:o.courseManagement.supervisionVisits.edit,visitExport:o.courseManagement.supervisionVisits.export,visitRead:o.courseManagement.supervisionVisits.enabled,satisfactionSurveyImport:o.courseManagement.satisfactionSurvey.import,satisfactionRead:o.courseManagement.satisfactionSurvey.enabled,studentManagement:o.studentManagement.enabled,studentCreate:o.studentManagement.studentInfo.create,studentUpdate:o.studentManagement.studentInfo.edit,studentDelete:o.studentManagement.studentInfo.delete,studentImport:o.studentManagement.studentInfo.import,studentExport:o.studentManagement.studentInfo.export,studentExportWord:o.studentManagement.studentInfo.studentExportWord,studentRead:o.studentManagement.studentInfo.enabled,learningHistory:o.studentManagement.learningHistory.enabled,creditCertificationImport:o.studentManagement.creditRecognition.export,creditCertificationCreate:o.studentManagement.creditRecognition.create,creditCertificationRead:o.studentManagement.creditRecognition.enabled,agencyRead:o.studentManagement.agency.enabled,agencyCreate:o.studentManagement.agency.create,agencyUpdate:o.studentManagement.agency.edit,agencyDelete:o.studentManagement.agency.delete,studentIsNonProject:o.studentManagement.isNonProject,verificationManagement:o.verificationManagement.enabled,verificationCreate:o.verificationManagement.expense.create,verificationUpdate:o.verificationManagement.expense.edit,verificationExport:o.verificationManagement.expense.export,verificationRead:o.verificationManagement.expense.enabled,performanceTracking:o.performanceTracking.enabled,performanceTrackingRead:o.performanceTracking.management.enabled,performanceTrackingEdit:o.performanceTracking.management.edit,consultationService:o.consultationService.enabled,consultationCreate:o.consultationService.questionManagement.create,consultationUpdate:o.consultationService.questionManagement.edit,consultationDelete:o.consultationService.questionManagement.delete,consultationRead:o.consultationService.questionManagement.enabled,consultationReadDetail:o.consultationService.questionManagement.readDetail,consultationImport:o.consultationService.questionManagement.import,consultationCategoryRead:o.consultationService.categoryManagement.enabled,consultationCategoryCreate:o.consultationService.categoryManagement.create,consultationCategoryEdit:o.consultationService.categoryManagement.edit,consultationCategoryDelete:o.consultationService.categoryManagement.delete,dashboard:o.dashboard.enabled,tool:o.toolManagement.enabled,fileManager:o.toolManagement.fileManager.enabled,fileManagerCreate:o.toolManagement.fileManager.create,fileManagerUpload:o.toolManagement.fileManager.upload,fileManagerDelete:o.toolManagement.fileManager.delete,systemManagement:o.systemManagement.enabled,userCreate:o.systemManagement.roleManagement.create,userUpdate:o.systemManagement.roleManagement.edit,userDelete:o.systemManagement.roleManagement.delete,userRead:o.systemManagement.roleManagement.enabled,roleCreate:o.systemManagement.rolePermission.create,roleUpdate:o.systemManagement.rolePermission.edit,roleDelete:o.systemManagement.rolePermission.delete,roleRead:o.systemManagement.rolePermission.enabled,systemLogRead:o.systemManagement.log.enabled,systemLogExport:o.systemManagement.log.export,dataBaseRead:o.systemManagement.databaseManagement.enabled,dataBaseExport:o.systemManagement.databaseManagement.export,reportAllRead:o.reportAllRead.enabled}),T=async()=>{try{if(!u.value){v.showError("儲存失敗","無法識別角色ID，請返回角色列表重新選擇");return}N.value=!0;const g=P(),a=await as.updateRolePermissions(u.value,g);a.data.code===0?(v.showSuccess("儲存成功","權限設定已成功儲存"),d.push("/role-permissions"),NH()):(console.error("儲存權限設定錯誤:",a.data.message),v.showError("儲存失敗",a.data.message||"儲存權限設定發生錯誤，請稍後再試"))}catch(g){console.error("儲存權限設定錯誤:",g),v.showError("儲存失敗","儲存權限設定發生錯誤，請稍後再試")}finally{N.value=!1}},z=()=>{v.confirmAsync("確認取消","確定要取消編輯嗎？所有未儲存的修改將會丟失。").then(g=>{g&&(K(u.value),d.push("/role-permissions"))})};return Ee(()=>o.toolManagement.enabled,g=>{g||(o.toolManagement.fileManager.enabled=!1)}),Ee(()=>o.toolManagement.fileManager.enabled,g=>{g?o.toolManagement.enabled=!0:(o.toolManagement.fileManager.create=!1,o.toolManagement.fileManager.upload=!1,o.toolManagement.fileManager.delete=!1)}),Ee([()=>o.toolManagement.fileManager.create,()=>o.toolManagement.fileManager.upload,()=>o.toolManagement.fileManager.delete],g=>{g.some(a=>a)&&(o.toolManagement.enabled=!0,o.toolManagement.fileManager.enabled=!0)}),Ee(()=>o.reviewManagement.enabled,g=>{g||(o.reviewManagement.reviewList.enabled=!1,o.reviewManagement.edit=!1,o.reviewManagement.approve=!1,o.reviewManagement.import=!1,o.reviewManagement.export=!1)}),Ee(()=>o.reviewManagement.reviewList.enabled,g=>{g?o.reviewManagement.enabled=!0:(o.reviewManagement.edit=!1,o.reviewManagement.approve=!1,o.reviewManagement.import=!1,o.reviewManagement.export=!1)}),Ee([()=>o.reviewManagement.edit,()=>o.reviewManagement.approve,()=>o.reviewManagement.import,()=>o.reviewManagement.export],g=>{g.some(a=>a)&&(o.reviewManagement.enabled=!0,o.reviewManagement.reviewList.enabled=!0)}),Ee(()=>o.courseManagement.enabled,g=>{g||(o.courseManagement.courseContent.enabled=!1,o.courseManagement.supervisionVisits.enabled=!1,o.courseManagement.satisfactionSurvey.enabled=!1)}),Ee(()=>o.courseManagement.courseContent.enabled,g=>{g?o.courseManagement.enabled=!0:(o.courseManagement.courseContent.create=!1,o.courseManagement.courseContent.edit=!1,o.courseManagement.courseContent.delete=!1,o.courseManagement.courseContent.import=!1,o.courseManagement.courseContent.export=!1)}),Ee([()=>o.courseManagement.courseContent.create,()=>o.courseManagement.courseContent.edit,()=>o.courseManagement.courseContent.delete,()=>o.courseManagement.courseContent.import,()=>o.courseManagement.courseContent.export],g=>{g.some(a=>a)&&(o.courseManagement.enabled=!0,o.courseManagement.courseContent.enabled=!0)}),Ee(()=>o.courseManagement.supervisionVisits.enabled,g=>{g?o.courseManagement.enabled=!0:(o.courseManagement.supervisionVisits.create=!1,o.courseManagement.supervisionVisits.edit=!1,o.courseManagement.supervisionVisits.export=!1)}),Ee([()=>o.courseManagement.supervisionVisits.create,()=>o.courseManagement.supervisionVisits.edit,()=>o.courseManagement.supervisionVisits.export],g=>{g.some(a=>a)&&(o.courseManagement.enabled=!0,o.courseManagement.supervisionVisits.enabled=!0)}),Ee(()=>o.courseManagement.satisfactionSurvey.enabled,g=>{g?o.courseManagement.enabled=!0:o.courseManagement.satisfactionSurvey.import=!1}),Ee(()=>o.courseManagement.satisfactionSurvey.import,g=>{g&&(o.courseManagement.enabled=!0,o.courseManagement.satisfactionSurvey.enabled=!0)}),Ee(()=>o.studentManagement.enabled,g=>{g||(o.studentManagement.studentInfo.enabled=!1,o.studentManagement.learningHistory.enabled=!1,o.studentManagement.creditRecognition.enabled=!1,o.studentManagement.agency.enabled=!1,o.studentManagement.studentInfo.studentExportWord=!1)}),Ee(()=>o.studentManagement.studentInfo.enabled,g=>{g?o.studentManagement.enabled=!0:(o.studentManagement.studentInfo.create=!1,o.studentManagement.studentInfo.edit=!1,o.studentManagement.studentInfo.delete=!1,o.studentManagement.studentInfo.import=!1,o.studentManagement.studentInfo.export=!1,o.studentManagement.studentInfo.studentExportWord=!1,o.studentManagement.agency.enabled=!1,o.studentManagement.agency.create=!1,o.studentManagement.agency.edit=!1,o.studentManagement.agency.delete=!1)}),Ee([()=>o.studentManagement.studentInfo.create,()=>o.studentManagement.studentInfo.edit,()=>o.studentManagement.studentInfo.delete,()=>o.studentManagement.studentInfo.import,()=>o.studentManagement.studentInfo.export,()=>o.studentManagement.studentInfo.studentExportWord],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.studentInfo.enabled=!0)}),Ee(()=>o.studentManagement.learningHistory.enabled,g=>{g&&(o.studentManagement.enabled=!0)}),Ee(()=>o.studentManagement.creditRecognition.enabled,g=>{g?o.studentManagement.enabled=!0:(o.studentManagement.creditRecognition.create=!1,o.studentManagement.creditRecognition.export=!1)}),Ee([()=>o.studentManagement.creditRecognition.create,()=>o.studentManagement.creditRecognition.export],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.creditRecognition.enabled=!0)}),Ee(()=>o.verificationManagement.enabled,g=>{g||(o.verificationManagement.expense.enabled=!1)}),Ee(()=>o.verificationManagement.expense.enabled,g=>{g?o.verificationManagement.enabled=!0:(o.verificationManagement.expense.create=!1,o.verificationManagement.expense.edit=!1,o.verificationManagement.expense.export=!1)}),Ee([()=>o.verificationManagement.expense.create,()=>o.verificationManagement.expense.edit,()=>o.verificationManagement.expense.export],g=>{g.some(a=>a)&&(o.verificationManagement.enabled=!0,o.verificationManagement.expense.enabled=!0)}),Ee(()=>o.performanceTracking.enabled,g=>{g||(o.performanceTracking.management.enabled=!1)}),Ee(()=>o.performanceTracking.management.enabled,g=>{g||(o.performanceTracking.management.edit=!1)}),Ee(()=>o.performanceTracking.management.edit,g=>{g&&(o.performanceTracking.enabled=!0,o.performanceTracking.management.enabled=!0)}),Ee(()=>o.consultationService.enabled,g=>{g||(o.consultationService.questionManagement.enabled=!1,o.consultationService.questionManagement.create=!1,o.consultationService.questionManagement.edit=!1,o.consultationService.questionManagement.delete=!1,o.consultationService.questionManagement.readDetail=!1,o.consultationService.questionManagement.import=!1,o.consultationService.categoryManagement.enabled=!1,o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee(()=>o.consultationService.questionManagement.enabled,g=>{g?o.consultationService.enabled=!0:(o.consultationService.questionManagement.create=!1,o.consultationService.questionManagement.edit=!1,o.consultationService.questionManagement.delete=!1,o.consultationService.questionManagement.readDetail=!1,o.consultationService.questionManagement.import=!1,o.consultationService.categoryManagement.enabled=!1,o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee([()=>o.consultationService.questionManagement.create,()=>o.consultationService.questionManagement.edit,()=>o.consultationService.questionManagement.delete,()=>o.consultationService.questionManagement.readDetail,()=>o.consultationService.questionManagement.import],g=>{g.some(a=>a)&&(o.consultationService.enabled=!0,o.consultationService.questionManagement.enabled=!0)}),Ee(()=>o.consultationService.categoryManagement.enabled,g=>{g?(o.consultationService.enabled=!0,o.consultationService.questionManagement.enabled=!0):(o.consultationService.categoryManagement.create=!1,o.consultationService.categoryManagement.edit=!1,o.consultationService.categoryManagement.delete=!1)}),Ee([()=>o.consultationService.categoryManagement.create,()=>o.consultationService.categoryManagement.edit,()=>o.consultationService.categoryManagement.delete],g=>{g.some(a=>a)&&(o.consultationService.enabled=!0,o.consultationService.categoryManagement.enabled=!0)}),Ee(()=>o.systemManagement.enabled,g=>{g||(o.systemManagement.roleManagement.enabled=!1,o.systemManagement.rolePermission.enabled=!1,o.systemManagement.log.enabled=!1,o.systemManagement.databaseManagement.enabled=!1)}),Ee(()=>o.systemManagement.roleManagement.enabled,g=>{g?o.systemManagement.enabled=!0:(o.systemManagement.roleManagement.create=!1,o.systemManagement.roleManagement.edit=!1,o.systemManagement.roleManagement.delete=!1)}),Ee([()=>o.systemManagement.roleManagement.create,()=>o.systemManagement.roleManagement.edit,()=>o.systemManagement.roleManagement.delete],g=>{g.some(a=>a)&&(o.systemManagement.enabled=!0,o.systemManagement.roleManagement.enabled=!0)}),Ee(()=>o.systemManagement.rolePermission.enabled,g=>{g?o.systemManagement.enabled=!0:(o.systemManagement.rolePermission.create=!1,o.systemManagement.rolePermission.edit=!1,o.systemManagement.rolePermission.delete=!1)}),Ee([()=>o.systemManagement.rolePermission.create,()=>o.systemManagement.rolePermission.edit,()=>o.systemManagement.rolePermission.delete],g=>{g.some(a=>a)&&(o.systemManagement.enabled=!0,o.systemManagement.rolePermission.enabled=!0)}),Ee(()=>o.systemManagement.log.enabled,g=>{g?o.systemManagement.enabled=!0:o.systemManagement.log.export=!1}),Ee(()=>o.systemManagement.log.export,g=>{g&&(o.systemManagement.enabled=!0,o.systemManagement.log.enabled=!0)}),Ee(()=>o.systemManagement.databaseManagement.enabled,g=>{g?o.systemManagement.enabled=!0:o.systemManagement.databaseManagement.export=!1}),Ee(()=>o.systemManagement.databaseManagement.export,g=>{g&&(o.systemManagement.enabled=!0,o.systemManagement.databaseManagement.enabled=!0)}),Ee(()=>o.studentManagement.agency.enabled,g=>{g?(o.studentManagement.enabled=!0,o.studentManagement.studentInfo.enabled=!0):(o.studentManagement.agency.create=!1,o.studentManagement.agency.edit=!1,o.studentManagement.agency.delete=!1)}),Ee([()=>o.studentManagement.agency.create,()=>o.studentManagement.agency.edit,()=>o.studentManagement.agency.delete],g=>{g.some(a=>a)&&(o.studentManagement.enabled=!0,o.studentManagement.agency.enabled=!0)}),je(()=>{K(u.value)}),(g,a)=>(t(),s("div",EM,[e("div",SM,[Qe(pt,{breadcrumbs:[{name:"角色管理",path:"/role-permissions"},{name:C.value?`${C.value}權限設定`:"權限設定",path:""}]},null,8,["breadcrumbs"])]),e("div",{class:"w-full max-w-[1500px] flex justify-end mb-4"},[e("button",{class:"px-4 py-2 mr-2 bg-gray-200 text-gray-800 hover:bg-gray-300 focus:outline-none",onClick:z}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#3d7a5d] focus:outline-none",onClick:T}," 儲存 ")]),e("div",DM,[e("div",MM,[e("div",AM,[a[76]||(a[76]=e("div",{class:"w-32 font-bold",id:"review-management-label"},"資格審核管理",-1)),e("label",IM,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=A=>o.reviewManagement.enabled=A),id:"review-management-toggle","aria-labelledby":"review-management-label"},null,512),[[Ce,o.reviewManagement.enabled]]),a[75]||(a[75]=e("span",{class:"slider round"},null,-1))])]),e("div",RM,[e("div",PM,[a[78]||(a[78]=e("div",{class:"w-32",id:"review-list-label"},"審核名單",-1)),e("label",UM,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=A=>o.reviewManagement.reviewList.enabled=A),id:"review-list-toggle","aria-labelledby":"review-list-label"},null,512),[[Ce,o.reviewManagement.reviewList.enabled]]),a[77]||(a[77]=e("span",{class:"slider round"},null,-1))])]),e("div",NM,[e("div",TM,[e("div",VM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[2]||(a[2]=A=>o.reviewManagement.edit=A),id:"review-edit-toggle"},null,512),[[Ce,o.reviewManagement.edit]]),a[79]||(a[79]=e("label",{for:"review-edit-toggle"},"編輯",-1))]),e("div",jM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[3]||(a[3]=A=>o.reviewManagement.approve=A),id:"review-approve-toggle"},null,512),[[Ce,o.reviewManagement.approve]]),a[80]||(a[80]=e("label",{for:"review-approve-toggle"},"通過",-1))]),e("div",LM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[4]||(a[4]=A=>o.reviewManagement.import=A),id:"review-import-toggle"},null,512),[[Ce,o.reviewManagement.import]]),a[81]||(a[81]=e("label",{for:"review-import-toggle"},"匯入",-1))]),e("div",FM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[5]||(a[5]=A=>o.reviewManagement.export=A),id:"review-export-toggle"},null,512),[[Ce,o.reviewManagement.export]]),a[82]||(a[82]=e("label",{for:"review-export-toggle"},"匯出",-1))])])])])]),e("div",qM,[e("div",OM,[a[84]||(a[84]=e("div",{class:"w-32 font-bold",id:"course-management-label"},"課程管理",-1)),e("label",BM,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[6]||(a[6]=A=>o.courseManagement.enabled=A),id:"course-management-toggle","aria-labelledby":"course-management-label"},null,512),[[Ce,o.courseManagement.enabled]]),a[83]||(a[83]=e("span",{class:"slider round"},null,-1))])]),e("div",HM,[e("div",WM,[a[86]||(a[86]=e("div",{class:"w-32",id:"course-content-label"},"課程內容",-1)),e("label",zM,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=A=>o.courseManagement.courseContent.enabled=A),id:"course-content-toggle","aria-labelledby":"course-content-label"},null,512),[[Ce,o.courseManagement.courseContent.enabled]]),a[85]||(a[85]=e("span",{class:"slider round"},null,-1))])]),e("div",KM,[e("div",JM,[e("div",YM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[8]||(a[8]=A=>o.courseManagement.courseContent.create=A),id:"course-content-create"},null,512),[[Ce,o.courseManagement.courseContent.create]]),a[87]||(a[87]=e("label",{for:"course-content-create"},"新增",-1))]),e("div",GM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[9]||(a[9]=A=>o.courseManagement.courseContent.edit=A),id:"course-content-edit"},null,512),[[Ce,o.courseManagement.courseContent.edit]]),a[88]||(a[88]=e("label",{for:"course-content-edit"},"編輯",-1))]),e("div",QM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[10]||(a[10]=A=>o.courseManagement.courseContent.delete=A),id:"course-content-delete"},null,512),[[Ce,o.courseManagement.courseContent.delete]]),a[89]||(a[89]=e("label",{for:"course-content-delete"},"刪除",-1))]),e("div",ZM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[11]||(a[11]=A=>o.courseManagement.courseContent.import=A),id:"course-content-import"},null,512),[[Ce,o.courseManagement.courseContent.import]]),a[90]||(a[90]=e("label",{for:"course-content-import"},"匯入",-1))]),e("div",XM,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[12]||(a[12]=A=>o.courseManagement.courseContent.export=A),id:"course-content-export"},null,512),[[Ce,o.courseManagement.courseContent.export]]),a[91]||(a[91]=e("label",{for:"course-content-export"},"匯出",-1))])])]),e("div",eA,[a[93]||(a[93]=e("div",{class:"w-32",id:"supervision-visits-label"},"訪視督課",-1)),e("label",tA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[13]||(a[13]=A=>o.courseManagement.supervisionVisits.enabled=A),id:"supervision-visits-toggle","aria-labelledby":"supervision-visits-label"},null,512),[[Ce,o.courseManagement.supervisionVisits.enabled]]),a[92]||(a[92]=e("span",{class:"slider round"},null,-1))])]),e("div",sA,[e("div",aA,[e("div",oA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[14]||(a[14]=A=>o.courseManagement.supervisionVisits.create=A),id:"supervision-visits-create"},null,512),[[Ce,o.courseManagement.supervisionVisits.create]]),a[94]||(a[94]=e("label",{for:"supervision-visits-create"},"新增",-1))]),e("div",lA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[15]||(a[15]=A=>o.courseManagement.supervisionVisits.edit=A),id:"supervision-visits-edit"},null,512),[[Ce,o.courseManagement.supervisionVisits.edit]]),a[95]||(a[95]=e("label",{for:"supervision-visits-edit"},"編輯",-1))]),e("div",nA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[16]||(a[16]=A=>o.courseManagement.supervisionVisits.export=A),id:"supervision-visits-export"},null,512),[[Ce,o.courseManagement.supervisionVisits.export]]),a[96]||(a[96]=e("label",{for:"supervision-visits-export"},"匯出",-1))])])]),e("div",rA,[a[98]||(a[98]=e("div",{class:"w-32",id:"satisfaction-survey-label"},"滿意度調查",-1)),e("label",iA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[17]||(a[17]=A=>o.courseManagement.satisfactionSurvey.enabled=A),id:"satisfaction-survey-toggle","aria-labelledby":"satisfaction-survey-label"},null,512),[[Ce,o.courseManagement.satisfactionSurvey.enabled]]),a[97]||(a[97]=e("span",{class:"slider round"},null,-1))])]),e("div",dA,[e("div",uA,[e("div",cA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[18]||(a[18]=A=>o.courseManagement.satisfactionSurvey.import=A),id:"satisfaction-survey-import"},null,512),[[Ce,o.courseManagement.satisfactionSurvey.import]]),a[99]||(a[99]=e("label",{for:"satisfaction-survey-import"},"匯入",-1))])])])])]),e("div",pA,[e("div",vA,[a[101]||(a[101]=e("div",{class:"w-32 font-bold",id:"student-management-label"},"學員管理",-1)),e("label",mA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[19]||(a[19]=A=>o.studentManagement.enabled=A),id:"student-management-toggle","aria-labelledby":"student-management-label"},null,512),[[Ce,o.studentManagement.enabled]]),a[100]||(a[100]=e("span",{class:"slider round"},null,-1))])]),e("div",bA,[e("div",fA,[a[103]||(a[103]=e("div",{class:"w-32",id:"student-info-label"},"學員資料",-1)),e("label",yA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[20]||(a[20]=A=>o.studentManagement.studentInfo.enabled=A),id:"student-info-toggle","aria-labelledby":"student-info-label"},null,512),[[Ce,o.studentManagement.studentInfo.enabled]]),a[102]||(a[102]=e("span",{class:"slider round"},null,-1))])]),e("div",gA,[e("div",xA,[e("div",hA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[21]||(a[21]=A=>o.studentManagement.studentInfo.create=A),id:"student-info-create"},null,512),[[Ce,o.studentManagement.studentInfo.create]]),a[104]||(a[104]=e("label",{for:"student-info-create"},"新增",-1))]),e("div",wA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[22]||(a[22]=A=>o.studentManagement.studentInfo.edit=A),id:"student-info-edit"},null,512),[[Ce,o.studentManagement.studentInfo.edit]]),a[105]||(a[105]=e("label",{for:"student-info-edit"},"編輯",-1))]),e("div",_A,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[23]||(a[23]=A=>o.studentManagement.studentInfo.delete=A),id:"student-info-delete"},null,512),[[Ce,o.studentManagement.studentInfo.delete]]),a[106]||(a[106]=e("label",{for:"student-info-delete"},"刪除",-1))]),e("div",kA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[24]||(a[24]=A=>o.studentManagement.studentInfo.import=A),id:"student-info-import"},null,512),[[Ce,o.studentManagement.studentInfo.import]]),a[107]||(a[107]=e("label",{for:"student-info-import"},"匯入",-1))]),e("div",$A,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[25]||(a[25]=A=>o.studentManagement.studentInfo.export=A),id:"student-info-export"},null,512),[[Ce,o.studentManagement.studentInfo.export]]),a[108]||(a[108]=e("label",{for:"student-info-export"},"匯出",-1))]),e("div",CA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[26]||(a[26]=A=>o.studentManagement.studentInfo.studentExportWord=A),id:"student-info-student-export-word"},null,512),[[Ce,o.studentManagement.studentInfo.studentExportWord]]),a[109]||(a[109]=e("label",{for:"student-info-student-export-word"},"證書匯出",-1))])])]),e("div",EA,[a[111]||(a[111]=e("div",{class:"w-32",id:"learning-history-label"},"學習歷程",-1)),e("label",SA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[27]||(a[27]=A=>o.studentManagement.learningHistory.enabled=A),id:"learning-history-toggle","aria-labelledby":"learning-history-label"},null,512),[[Ce,o.studentManagement.learningHistory.enabled]]),a[110]||(a[110]=e("span",{class:"slider round"},null,-1))])]),a[123]||(a[123]=e("div",{class:"ml-32"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1)),e("div",DA,[a[113]||(a[113]=e("div",{class:"w-32",id:"credit-recognition-label"},"學分認列",-1)),e("label",MA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[28]||(a[28]=A=>o.studentManagement.creditRecognition.enabled=A),id:"credit-recognition-toggle","aria-labelledby":"credit-recognition-label"},null,512),[[Ce,o.studentManagement.creditRecognition.enabled]]),a[112]||(a[112]=e("span",{class:"slider round"},null,-1))])]),e("div",AA,[e("div",IA,[e("div",RA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[29]||(a[29]=A=>o.studentManagement.creditRecognition.create=A),id:"credit-recognition-create"},null,512),[[Ce,o.studentManagement.creditRecognition.create]]),a[114]||(a[114]=e("label",{for:"credit-recognition-create"},"新增",-1))]),e("div",PA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[30]||(a[30]=A=>o.studentManagement.creditRecognition.export=A),id:"credit-recognition-export"},null,512),[[Ce,o.studentManagement.creditRecognition.export]]),a[115]||(a[115]=e("label",{for:"credit-recognition-export"},"匯入",-1))])])]),e("div",UA,[a[117]||(a[117]=e("div",{class:"w-32",id:"agency-management-label"},"機關",-1)),e("label",NA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[31]||(a[31]=A=>o.studentManagement.agency.enabled=A),id:"agency-management-toggle","aria-labelledby":"agency-management-label"},null,512),[[Ce,o.studentManagement.agency.enabled]]),a[116]||(a[116]=e("span",{class:"slider round"},null,-1))])]),e("div",TA,[e("div",VA,[e("div",jA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[32]||(a[32]=A=>o.studentManagement.agency.create=A),id:"agency-create"},null,512),[[Ce,o.studentManagement.agency.create]]),a[118]||(a[118]=e("label",{for:"agency-create"},"新增",-1))]),e("div",LA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[33]||(a[33]=A=>o.studentManagement.agency.edit=A),id:"agency-edit"},null,512),[[Ce,o.studentManagement.agency.edit]]),a[119]||(a[119]=e("label",{for:"agency-edit"},"編輯",-1))]),e("div",FA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[34]||(a[34]=A=>o.studentManagement.agency.delete=A),id:"agency-delete"},null,512),[[Ce,o.studentManagement.agency.delete]]),a[120]||(a[120]=e("label",{for:"agency-delete"},"刪除",-1))])])]),e("div",qA,[a[122]||(a[122]=e("div",{class:"w-32",id:"student-is-non-project-label"},"非本計畫",-1)),e("label",OA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[35]||(a[35]=A=>o.studentManagement.isNonProject=A),id:"student-is-non-project-toggle","aria-labelledby":"student-is-non-project-label"},null,512),[[Ce,o.studentManagement.isNonProject]]),a[121]||(a[121]=e("span",{class:"slider round"},null,-1))])])])]),e("div",BA,[e("div",HA,[a[125]||(a[125]=e("div",{class:"w-32 font-bold",id:"verification-management-label"},"核撥作業",-1)),e("label",WA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[36]||(a[36]=A=>o.verificationManagement.enabled=A),id:"verification-management-toggle","aria-labelledby":"verification-management-label"},null,512),[[Ce,o.verificationManagement.enabled]]),a[124]||(a[124]=e("span",{class:"slider round"},null,-1))])]),e("div",zA,[e("div",KA,[a[127]||(a[127]=e("div",{class:"w-32",id:"expense-label"},"費用核撥",-1)),e("label",JA,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[37]||(a[37]=A=>o.verificationManagement.expense.enabled=A),id:"expense-toggle","aria-labelledby":"expense-label"},null,512),[[Ce,o.verificationManagement.expense.enabled]]),a[126]||(a[126]=e("span",{class:"slider round"},null,-1))])]),e("div",YA,[e("div",GA,[e("div",QA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[38]||(a[38]=A=>o.verificationManagement.expense.create=A),id:"expense-create"},null,512),[[Ce,o.verificationManagement.expense.create]]),a[128]||(a[128]=e("label",{for:"expense-create"},"新增",-1))]),e("div",ZA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[39]||(a[39]=A=>o.verificationManagement.expense.edit=A),id:"expense-edit"},null,512),[[Ce,o.verificationManagement.expense.edit]]),a[129]||(a[129]=e("label",{for:"expense-edit"},"編輯",-1))]),e("div",XA,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[40]||(a[40]=A=>o.verificationManagement.expense.export=A),id:"expense-export"},null,512),[[Ce,o.verificationManagement.expense.export]]),a[130]||(a[130]=e("label",{for:"expense-export"},"匯出",-1))])])])])]),e("div",eI,[e("div",tI,[a[132]||(a[132]=e("div",{class:"w-32 font-bold",id:"performance-tracking-label"},"追蹤成效",-1)),e("label",sI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[41]||(a[41]=A=>o.performanceTracking.enabled=A),id:"performance-tracking-toggle","aria-labelledby":"performance-tracking-label"},null,512),[[Ce,o.performanceTracking.enabled]]),a[131]||(a[131]=e("span",{class:"slider round"},null,-1))])]),e("div",aI,[e("div",oI,[a[134]||(a[134]=e("div",{class:"w-32",id:"tracking-management-label"},"追蹤管理",-1)),e("label",lI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[42]||(a[42]=A=>o.performanceTracking.management.enabled=A),id:"tracking-management-toggle","aria-labelledby":"tracking-management-label"},null,512),[[Ce,o.performanceTracking.management.enabled]]),a[133]||(a[133]=e("span",{class:"slider round"},null,-1))])]),e("div",nI,[e("div",rI,[e("div",iI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[43]||(a[43]=A=>o.performanceTracking.management.edit=A),id:"tracking-management-edit"},null,512),[[Ce,o.performanceTracking.management.edit]]),a[135]||(a[135]=e("label",{for:"tracking-management-edit"},"編輯",-1))])])])])]),e("div",dI,[e("div",uI,[a[137]||(a[137]=e("div",{class:"w-32 font-bold",id:"consultation-service-label"},"諮詢服務",-1)),e("label",cI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[44]||(a[44]=A=>o.consultationService.enabled=A),id:"consultation-service-toggle","aria-labelledby":"consultation-service-label"},null,512),[[Ce,o.consultationService.enabled]]),a[136]||(a[136]=e("span",{class:"slider round"},null,-1))])]),e("div",pI,[e("div",vI,[a[139]||(a[139]=e("div",{class:"w-32",id:"question-management-label"},"諮詢問題管理",-1)),e("label",mI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[45]||(a[45]=A=>o.consultationService.questionManagement.enabled=A),id:"question-management-toggle","aria-labelledby":"question-management-label"},null,512),[[Ce,o.consultationService.questionManagement.enabled]]),a[138]||(a[138]=e("span",{class:"slider round"},null,-1))])]),e("div",bI,[e("div",fI,[e("div",yI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[46]||(a[46]=A=>o.consultationService.questionManagement.create=A),id:"question-management-create"},null,512),[[Ce,o.consultationService.questionManagement.create]]),a[140]||(a[140]=e("label",{for:"question-management-create"},"新增",-1))]),e("div",gI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[47]||(a[47]=A=>o.consultationService.questionManagement.edit=A),id:"question-management-edit"},null,512),[[Ce,o.consultationService.questionManagement.edit]]),a[141]||(a[141]=e("label",{for:"question-management-edit"},"編輯",-1))]),e("div",xI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[48]||(a[48]=A=>o.consultationService.questionManagement.delete=A),id:"question-management-delete"},null,512),[[Ce,o.consultationService.questionManagement.delete]]),a[142]||(a[142]=e("label",{for:"question-management-delete"},"刪除",-1))]),e("div",hI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[49]||(a[49]=A=>o.consultationService.questionManagement.import=A),id:"question-management-import"},null,512),[[Ce,o.consultationService.questionManagement.import]]),a[143]||(a[143]=e("label",{for:"question-management-import"},"匯入",-1))]),e("div",wI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[50]||(a[50]=A=>o.consultationService.questionManagement.readDetail=A),id:"question-management-read-detail"},null,512),[[Ce,o.consultationService.questionManagement.readDetail]]),a[144]||(a[144]=e("label",{for:"question-management-read-detail"},"查看詳情",-1))])])]),e("div",_I,[a[146]||(a[146]=e("div",{class:"w-32",id:"category-management-label"},"問題分類管理",-1)),e("label",kI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[51]||(a[51]=A=>o.consultationService.categoryManagement.enabled=A),id:"category-management-toggle","aria-labelledby":"category-management-label"},null,512),[[Ce,o.consultationService.categoryManagement.enabled]]),a[145]||(a[145]=e("span",{class:"slider round"},null,-1))])]),e("div",$I,[e("div",CI,[e("div",EI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[52]||(a[52]=A=>o.consultationService.categoryManagement.create=A),id:"category-management-create"},null,512),[[Ce,o.consultationService.categoryManagement.create]]),a[147]||(a[147]=e("label",{for:"category-management-create"},"新增分類",-1))]),e("div",SI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[53]||(a[53]=A=>o.consultationService.categoryManagement.edit=A),id:"category-management-edit"},null,512),[[Ce,o.consultationService.categoryManagement.edit]]),a[148]||(a[148]=e("label",{for:"category-management-edit"},"編輯分類",-1))]),e("div",DI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[54]||(a[54]=A=>o.consultationService.categoryManagement.delete=A),id:"category-management-delete"},null,512),[[Ce,o.consultationService.categoryManagement.delete]]),a[149]||(a[149]=e("label",{for:"category-management-delete"},"刪除分類",-1))])])])])]),e("div",MI,[e("div",AI,[a[151]||(a[151]=e("div",{class:"w-32 font-bold",id:"statistical-reports-label"},"統計報表",-1)),e("label",II,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[55]||(a[55]=A=>o.reportAllRead.enabled=A),id:"statistical-reports-toggle","aria-labelledby":"statistical-reports-label"},null,512),[[Ce,o.reportAllRead.enabled]]),a[150]||(a[150]=e("span",{class:"slider round"},null,-1))])]),a[152]||(a[152]=e("div",{class:"ml-32 border rounded p-4 mb-2"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1))]),e("div",RI,[e("div",PI,[a[154]||(a[154]=e("div",{class:"w-32 font-bold",id:"dashboard-label"},"儀表板",-1)),e("label",UI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[56]||(a[56]=A=>o.dashboard.enabled=A),id:"dashboard-toggle","aria-labelledby":"dashboard-label"},null,512),[[Ce,o.dashboard.enabled]]),a[153]||(a[153]=e("span",{class:"slider round"},null,-1))])]),a[155]||(a[155]=e("div",{class:"ml-32 border rounded p-4 mb-2"},[e("div",{class:"flex flex-wrap"},[e("div",{class:"text-gray-500 italic px-4 py-2"}," 無額外權限設定 ")])],-1))]),e("div",NI,[e("div",TI,[a[157]||(a[157]=e("div",{class:"w-32 font-bold",id:"tool-management-label"},"工具",-1)),e("label",VI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[57]||(a[57]=A=>o.toolManagement.enabled=A),id:"tool-management-toggle","aria-labelledby":"tool-management-label"},null,512),[[Ce,o.toolManagement.enabled]]),a[156]||(a[156]=e("span",{class:"slider round"},null,-1))])]),e("div",jI,[e("div",LI,[a[159]||(a[159]=e("div",{class:"w-32",id:"file-manager-label"},"檔案管理",-1)),e("label",FI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[58]||(a[58]=A=>o.toolManagement.fileManager.enabled=A),id:"file-manager-toggle","aria-labelledby":"file-manager-label"},null,512),[[Ce,o.toolManagement.fileManager.enabled]]),a[158]||(a[158]=e("span",{class:"slider round"},null,-1))])]),e("div",qI,[e("div",OI,[e("div",BI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[59]||(a[59]=A=>o.toolManagement.fileManager.create=A),id:"file-manager-create"},null,512),[[Ce,o.toolManagement.fileManager.create]]),a[160]||(a[160]=e("label",{for:"file-manager-create"},"新增",-1))]),e("div",HI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[60]||(a[60]=A=>o.toolManagement.fileManager.upload=A),id:"file-manager-upload"},null,512),[[Ce,o.toolManagement.fileManager.upload]]),a[161]||(a[161]=e("label",{for:"file-manager-upload"},"上傳",-1))]),e("div",WI,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[61]||(a[61]=A=>o.toolManagement.fileManager.delete=A),id:"file-manager-delete"},null,512),[[Ce,o.toolManagement.fileManager.delete]]),a[162]||(a[162]=e("label",{for:"file-manager-delete"},"刪除",-1))])])])])]),e("div",zI,[e("div",KI,[a[164]||(a[164]=e("div",{class:"w-32 font-bold",id:"system-management-label"},"系統管理",-1)),e("label",JI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[62]||(a[62]=A=>o.systemManagement.enabled=A),id:"system-management-toggle","aria-labelledby":"system-management-label"},null,512),[[Ce,o.systemManagement.enabled]]),a[163]||(a[163]=e("span",{class:"slider round"},null,-1))])]),e("div",YI,[e("div",GI,[a[166]||(a[166]=e("div",{class:"w-32",id:"role-management-label"},"角色管理",-1)),e("label",QI,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[63]||(a[63]=A=>o.systemManagement.roleManagement.enabled=A),id:"role-management-toggle","aria-labelledby":"role-management-label"},null,512),[[Ce,o.systemManagement.roleManagement.enabled]]),a[165]||(a[165]=e("span",{class:"slider round"},null,-1))])]),e("div",ZI,[e("div",XI,[e("div",eR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[64]||(a[64]=A=>o.systemManagement.roleManagement.create=A),id:"role-management-create"},null,512),[[Ce,o.systemManagement.roleManagement.create]]),a[167]||(a[167]=e("label",{for:"role-management-create"},"新增",-1))]),e("div",tR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[65]||(a[65]=A=>o.systemManagement.roleManagement.edit=A),id:"role-management-edit"},null,512),[[Ce,o.systemManagement.roleManagement.edit]]),a[168]||(a[168]=e("label",{for:"role-management-edit"},"編輯",-1))]),e("div",sR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[66]||(a[66]=A=>o.systemManagement.roleManagement.delete=A),id:"role-management-delete"},null,512),[[Ce,o.systemManagement.roleManagement.delete]]),a[169]||(a[169]=e("label",{for:"role-management-delete"},"刪除",-1))])])]),e("div",aR,[a[171]||(a[171]=e("div",{class:"w-32",id:"role-permission-label"},"角色權限",-1)),e("label",oR,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[67]||(a[67]=A=>o.systemManagement.rolePermission.enabled=A),id:"role-permission-toggle","aria-labelledby":"role-permission-label"},null,512),[[Ce,o.systemManagement.rolePermission.enabled]]),a[170]||(a[170]=e("span",{class:"slider round"},null,-1))])]),e("div",lR,[e("div",nR,[e("div",rR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[68]||(a[68]=A=>o.systemManagement.rolePermission.create=A),id:"role-permission-create"},null,512),[[Ce,o.systemManagement.rolePermission.create]]),a[172]||(a[172]=e("label",{for:"role-permission-create"},"新增",-1))]),e("div",iR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[69]||(a[69]=A=>o.systemManagement.rolePermission.edit=A),id:"role-permission-edit"},null,512),[[Ce,o.systemManagement.rolePermission.edit]]),a[173]||(a[173]=e("label",{for:"role-permission-edit"},"編輯",-1))]),e("div",dR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[70]||(a[70]=A=>o.systemManagement.rolePermission.delete=A),id:"role-permission-delete"},null,512),[[Ce,o.systemManagement.rolePermission.delete]]),a[174]||(a[174]=e("label",{for:"role-permission-delete"},"刪除",-1))])])]),e("div",uR,[a[176]||(a[176]=e("div",{class:"w-32",id:"system-log-label"},"系統日誌",-1)),e("label",cR,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[71]||(a[71]=A=>o.systemManagement.log.enabled=A),id:"system-log-toggle","aria-labelledby":"system-log-label"},null,512),[[Ce,o.systemManagement.log.enabled]]),a[175]||(a[175]=e("span",{class:"slider round"},null,-1))])]),e("div",pR,[e("div",vR,[e("div",mR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[72]||(a[72]=A=>o.systemManagement.log.export=A),id:"system-log-export"},null,512),[[Ce,o.systemManagement.log.export]]),a[177]||(a[177]=e("label",{for:"system-log-export"},"匯出",-1))])])]),e("div",bR,[a[179]||(a[179]=e("div",{class:"w-32",id:"database-management-label"},"資料庫管理",-1)),e("label",fR,[I(e("input",{type:"checkbox","onUpdate:modelValue":a[73]||(a[73]=A=>o.systemManagement.databaseManagement.enabled=A),id:"database-management-toggle","aria-labelledby":"database-management-label"},null,512),[[Ce,o.systemManagement.databaseManagement.enabled]]),a[178]||(a[178]=e("span",{class:"slider round"},null,-1))])]),e("div",yR,[e("div",gR,[e("div",xR,[I(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a[74]||(a[74]=A=>o.systemManagement.databaseManagement.export=A),id:"database-management-export"},null,512),[[Ce,o.systemManagement.databaseManagement.export]]),a[180]||(a[180]=e("label",{for:"database-management-export"},"匯出",-1))])])])])])])]))}},wR=Le(hR,[["__scopeId","data-v-39d99fb3"]]),_R={class:"flex flex-col items-center p-6"},kR={class:"w-full max-w-[1500px]"},$R={class:"w-full max-w-[1500px] bg-white p-4 rounded shadow-sm mt-4"},CR={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"},ER={class:"flex flex-col"},SR={class:"relative"},DR={class:"flex flex-col"},MR=["value"],AR={class:"flex flex-col"},IR={class:"text-sm font-medium mb-1 block",for:"startTime"},RR={key:0,class:"text-red-500 ml-1"},PR={class:"flex flex-col"},UR={class:"text-sm font-medium mb-1 block",for:"endTime"},NR={key:0,class:"text-red-500 ml-1"},TR={class:"flex flex-col"},VR={class:"flex justify-end mt-4"},jR=["disabled"],LR=["disabled"],FR={class:"w-full max-w-[1500px] mt-6"},qR={key:0,class:"flex justify-center items-center py-10"},OR={key:1},BR={class:"w-full border-collapse"},HR={class:"bg-[#EEEFE7]"},WR={class:"border p-2"},zR={class:"flex items-center justify-center"},KR={key:0},JR={key:1},YR={key:2},GR={class:"border p-2"},QR={class:"flex items-center justify-center"},ZR={key:0},XR={key:1},eP={key:2},tP={class:"border p-2"},sP={class:"flex items-center justify-center"},aP={key:0},oP={key:1},lP={key:2},nP={class:"border p-2"},rP={class:"flex items-center justify-center"},iP={key:0},dP={key:1},uP={key:2},cP={class:"border p-2"},pP={class:"flex items-center justify-center"},vP={key:0},mP={key:1},bP={key:2},fP={class:"border p-2"},yP={class:"flex items-center justify-center"},gP={key:0},xP={key:1},hP={key:2},wP={class:"border p-2 text-center"},_P={class:"border p-2 text-center"},kP={class:"border p-2 text-center"},$P={class:"border p-2 text-center"},CP={class:"border p-2 text-center"},EP={class:"border p-2"},SP={class:"border p-2 text-center"},DP=["onClick"],MP={key:0},AP={key:0,class:"flex justify-center items-center space-x-2 mt-6"},IP=["disabled"],RP=["disabled","onClick","aria-label","aria-current"],PP={key:1,class:"px-2"},UP=["disabled"],NP={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},TP={class:"bg-white p-6 rounded-lg shadow-lg w-[600px] max-h-[90vh] overflow-y-auto"},VP={class:"mb-4"},jP={class:"border p-2 mt-1 bg-gray-50 rounded-sm max-h-[200px] overflow-y-auto"},LP={class:"whitespace-pre-wrap break-words text-sm"},FP={key:0,class:"mt-4"},qP={class:"border p-2 mt-1 bg-gray-50 rounded-sm max-h-[200px] overflow-y-auto"},OP={class:"whitespace-pre-wrap break-words text-sm"},Js=20,BP={__name:"LogList",setup(D){const x=We(),d=lt(),u=m(""),C=m(""),o=m(""),N=m(""),K=m(""),$=m(""),P=m(""),T=m(""),z=m(""),g=m(""),a=m(!1),A=m(1),G=m(1),k=m(0),c=m([]),b=m(!1),r=m({}),f=m(""),p=m("asc"),w=m([]),y=m({systemLogExport:!1}),V=q=>{switch(q){case"DEBUG":return 1;case"INFO":return 2;case"WARNING":return 3;case"ERROR":return 4;default:return}},W=async()=>{var q;if(C.value&&!o.value||!C.value&&o.value){v.showError("請注意","起始時間和結束時間需同時填寫或同時留空");return}a.value=!0;try{const S=N.value?V(N.value):void 0,Y={page:A.value,limit:Js,keyword:u.value||void 0,startTime:C.value||void 0,endTime:o.value||void 0,level:S,action:K.value||void 0,account:T.value||void 0,ip:z.value||void 0,message:g.value||void 0,sortBy:f.value||void 0,sortOrder:p.value||void 0};console.log("查詢條件:",Y);const fe=await as.getLogs(Y);fe.data&&fe.data.code===0?(c.value=fe.data.data.list.map(le=>({id:le.id,time:le.date||"-",level:O(le.level),module:le.action||"-",user:le.account||"-",ip:le.ip||"-",message:le.message||"-",stackTrace:le.detail||null})),k.value=fe.data.data.totalCount||0,G.value=fe.data.data.totalPage||Math.ceil(k.value/Js)||1,A.value>G.value&&G.value>0&&(A.value=1,await W())):(c.value=[],k.value=0,G.value=1,v.showError("載入失敗",((q=fe.data)==null?void 0:q.message)||"獲取日誌列表失敗"))}catch(S){console.error("獲取日誌列表錯誤:",S),c.value=[],k.value=0,G.value=1,v.showError("載入失敗","獲取日誌列表時發生錯誤")}finally{a.value=!1}},O=q=>{switch(q){case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARNING";case 4:return"ERROR";default:return"未知"}},_=()=>{u.value="",C.value="",o.value="",N.value="",K.value="",$.value="",P.value="",T.value="",z.value="",g.value="",f.value="",p.value="asc",A.value=1,De(),W()},E=()=>{u.value=""},L=q=>{r.value=q,b.value=!0},j=()=>{b.value=!1},R=q=>{switch(q){case"INFO":return"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium";case"WARNING":return"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium";case"ERROR":return"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium";case"DEBUG":return"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium";default:return""}},U=Se(()=>{const q=[];if(G.value<=5)for(let Y=1;Y<=G.value;Y++)q.push(Y);else{q.push(1);let Y=Math.max(2,A.value-1),fe=Math.min(G.value-1,A.value+1);A.value<=3&&(fe=Math.min(4,G.value-1)),A.value>=G.value-2&&(Y=Math.max(2,G.value-3)),Y>2&&q.push("...");for(let le=Y;le<=fe;le++)q.push(le);fe<G.value-1&&q.push("..."),q.push(G.value)}return q}),te=q=>{q!==A.value&&!a.value&&(A.value=q,De(),W())},ue=()=>{A.value>1&&!a.value&&(A.value--,De(),W())},ye=()=>{A.value<G.value&&!a.value&&(A.value++,De(),W())},ke=q=>{f.value===q?p.value=p.value==="asc"?"desc":"asc":(f.value=q,p.value="asc"),A.value=1,De(),W()},De=()=>{const q={page:A.value,keyword:u.value||void 0,startTime:C.value||void 0,endTime:o.value||void 0,level:N.value||void 0,action:K.value||void 0,account:T.value||void 0,ip:z.value||void 0,message:g.value||void 0,sortBy:f.value||void 0,sortOrder:p.value||void 0};Object.keys(q).forEach(S=>{q[S]===void 0&&delete q[S]}),x.replace({query:q})},$e=async()=>{var q,S;try{const Y=await ot.getLogFunctionOptions();Y.data&&Y.data.code===0?w.value=Y.data.data:(console.error("獲取功能選項失敗:",(q=Y.data)==null?void 0:q.message),v.showError("載入失敗",((S=Y.data)==null?void 0:S.message)||"獲取功能選項失敗"))}catch(Y){console.error("獲取功能選項錯誤:",Y),v.showError("載入失敗","獲取功能選項時發生錯誤")}},ve=async()=>{if(C.value&&!o.value||!C.value&&o.value){v.showError("請注意","起始時間和結束時間需同時填寫或同時留空");return}try{const q=N.value?V(N.value):void 0,S={keyword:u.value||void 0,action:K.value||void 0,dateRange:C.value&&o.value?[C.value,o.value]:void 0,level:q,sortBy:f.value||void 0,sortOrder:p.value||void 0};console.log("匯出日誌參數:",S);const Y=await as.exportLogs(S),fe=Y.headers["content-type"];if(!fe||!fe.includes("spreadsheetml.sheet"))try{const ae=new Blob([Y.data],{type:"application/json"}),ce=await new Response(ae).text(),Ie=JSON.parse(ce);console.error("匯出日誌失敗：伺服器返回錯誤：",Ie),v.showError("匯出失敗",Ie.message||"匯出過程中發生錯誤，請稍後再試");return}catch(ae){console.error("匯出日誌失敗：無法解析回應內容",ae),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const le=new Blob([Y.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Q=document.createElement("a");Q.href=URL.createObjectURL(le);const se=new Date,de=`系統日誌_${`${se.getFullYear()}-${String(se.getMonth()+1).padStart(2,"0")}-${String(se.getDate()).padStart(2,"0")}`}.xlsx`;Q.download=de,Q.click(),URL.revokeObjectURL(Q.href),v.showSuccess("匯出成功","系統日誌已成功匯出為 Excel 檔案")}catch(q){if(console.error("匯出日誌錯誤:",q),q.response&&q.response.data){const S=q.response.data;v.showError("匯出失敗",S.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}},oe=async()=>{try{const q=await tt.getSidebarPermissions();q.data.code===0&&q.data.message==="success"?(y.value=q.data.data,console.log("系統日誌頁面權限:",y.value)):console.error("獲取權限失敗:",q.data.message)}catch(q){console.error("獲取權限錯誤:",q)}};return je(()=>{const q=d.query.page?parseInt(d.query.page):null,S=d.query.keyword||null,Y=d.query.startTime||null,fe=d.query.endTime||null,le=d.query.level||null,Q=d.query.action||null,se=d.query.account||null,ie=d.query.ip||null,de=d.query.message||null,ae=d.query.sortBy||null,ce=d.query.sortOrder||null;q&&(A.value=q),S&&(u.value=S),Y&&(C.value=Y),fe&&(o.value=fe),le&&(N.value=le),Q&&(K.value=Q),se&&(T.value=se),ie&&(z.value=ie),de&&(g.value=de),ae&&(f.value=ae),ce&&(p.value=ce),$e(),W(),oe()}),(q,S)=>(t(),s("div",_R,[e("div",kR,[Qe(pt,{breadcrumbs:[{name:"系統日誌",path:"/log-list"}]})]),e("div",$R,[e("div",CR,[e("div",ER,[S[12]||(S[12]=e("label",{class:"mb-1 text-sm",for:"searchKeyword"},"關鍵字查詢",-1)),e("div",SR,[I(e("input",{id:"searchKeyword",type:"text","onUpdate:modelValue":S[0]||(S[0]=Y=>u.value=Y),class:"p-2 border border-gray-300 rounded outline-none w-full",placeholder:"請輸入關鍵字",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ne(W,["enter"]),"aria-label":"搜尋關鍵字輸入欄位"},null,544),[[ee,u.value]]),u.value?(t(),s("button",{key:0,onClick:E,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},S[11]||(S[11]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)])]),e("div",DR,[S[14]||(S[14]=e("label",{class:"mb-1 text-sm",for:"selectedFunction"},"功能選擇",-1)),I(e("select",{id:"selectedFunction","onUpdate:modelValue":S[1]||(S[1]=Y=>K.value=Y),class:"p-2 border border-gray-300 rounded outline-none",onKeyup:Ne(W,["enter"])},[S[13]||(S[13]=e("option",{value:""},"全部功能",-1)),(t(!0),s(Z,null,re(w.value,Y=>(t(),s("option",{key:Y.id,value:Y.id},l(Y.name),9,MR))),128))],544),[[Pe,K.value]])]),e("div",AR,[e("label",IR,[S[15]||(S[15]=xe(" 起始時間 ")),o.value&&!C.value?(t(),s("span",RR,"*")):J("",!0),S[16]||(S[16]=e("span",{class:"text-xs text-gray-500"},"(兩個時間必須同時填寫)",-1))]),I(e("input",{id:"startTime",type:"datetime-local","onUpdate:modelValue":S[2]||(S[2]=Y=>C.value=Y),class:X(["p-2 border border-gray-300 rounded outline-none",{"border-red-500":o.value&&!C.value}]),onKeyup:Ne(W,["enter"])},null,34),[[ee,C.value]])]),e("div",PR,[e("label",UR,[S[17]||(S[17]=xe(" 結束時間 ")),C.value&&!o.value?(t(),s("span",NR,"*")):J("",!0)]),I(e("input",{id:"endTime",type:"datetime-local","onUpdate:modelValue":S[3]||(S[3]=Y=>o.value=Y),class:X(["p-2 border border-gray-300 rounded outline-none",{"border-red-500":C.value&&!o.value}]),onKeyup:Ne(W,["enter"])},null,34),[[ee,o.value]])]),e("div",TR,[S[19]||(S[19]=e("label",{class:"mb-1 text-sm",for:"logLevel"},"Log等級",-1)),I(e("select",{id:"logLevel","onUpdate:modelValue":S[4]||(S[4]=Y=>N.value=Y),class:"p-2 border border-gray-300 rounded outline-none",onKeyup:Ne(W,["enter"])},S[18]||(S[18]=[Zs('<option value="" data-v-07e717fe>全部</option><option value="INFO" data-v-07e717fe>INFO</option><option value="WARNING" data-v-07e717fe>WARNING</option><option value="ERROR" data-v-07e717fe>ERROR</option><option value="DEBUG" data-v-07e717fe>DEBUG</option>',5)]),544),[[Pe,N.value]])])]),e("div",VR,[y.value.systemLogExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded mr-2 hover:bg-[#3d7a5d]",onClick:ve,disabled:a.value,"aria-label":"匯出日誌記錄"}," 匯出日誌 ",8,jR)):J("",!0),e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded mr-2 hover:bg-gray-300",onClick:_,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:W,disabled:a.value,"aria-label":"查詢日誌記錄"},l(a.value?"查詢中...":"查詢"),9,LR)])]),e("div",FR,[a.value?(t(),s("div",qR,S[20]||(S[20]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",OR,[e("table",BR,[e("thead",null,[e("tr",HR,[e("th",WR,[e("div",zR,[S[21]||(S[21]=xe(" 時間 ")),e("button",{onClick:S[5]||(S[5]=Y=>ke("date")),class:"ml-1 focus:outline-none","aria-label":"依時間排序"},[f.value==="date"&&p.value==="asc"?(t(),s("span",KR,"▲")):f.value==="date"&&p.value==="desc"?(t(),s("span",JR,"▼")):(t(),s("span",YR,"⇅"))])])]),e("th",GR,[e("div",QR,[S[22]||(S[22]=xe(" 等級 ")),e("button",{onClick:S[6]||(S[6]=Y=>ke("level")),class:"ml-1 focus:outline-none","aria-label":"依等級排序"},[f.value==="level"&&p.value==="asc"?(t(),s("span",ZR,"▲")):f.value==="level"&&p.value==="desc"?(t(),s("span",XR,"▼")):(t(),s("span",eP,"⇅"))])])]),e("th",tP,[e("div",sP,[S[23]||(S[23]=xe(" 功能 ")),e("button",{onClick:S[7]||(S[7]=Y=>ke("action")),class:"ml-1 focus:outline-none","aria-label":"依功能排序"},[f.value==="action"&&p.value==="asc"?(t(),s("span",aP,"▲")):f.value==="action"&&p.value==="desc"?(t(),s("span",oP,"▼")):(t(),s("span",lP,"⇅"))])])]),e("th",nP,[e("div",rP,[S[24]||(S[24]=xe(" 使用者 ")),e("button",{onClick:S[8]||(S[8]=Y=>ke("account")),class:"ml-1 focus:outline-none","aria-label":"依使用者排序"},[f.value==="account"&&p.value==="asc"?(t(),s("span",iP,"▲")):f.value==="account"&&p.value==="desc"?(t(),s("span",dP,"▼")):(t(),s("span",uP,"⇅"))])])]),e("th",cP,[e("div",pP,[S[25]||(S[25]=xe(" IP ")),e("button",{onClick:S[9]||(S[9]=Y=>ke("ip")),class:"ml-1 focus:outline-none","aria-label":"依IP位址排序"},[f.value==="ip"&&p.value==="asc"?(t(),s("span",vP,"▲")):f.value==="ip"&&p.value==="desc"?(t(),s("span",mP,"▼")):(t(),s("span",bP,"⇅"))])])]),e("th",fP,[e("div",yP,[S[26]||(S[26]=xe(" 訊息內容 ")),e("button",{onClick:S[10]||(S[10]=Y=>ke("message")),class:"ml-1 focus:outline-none","aria-label":"依訊息內容排序"},[f.value==="message"&&p.value==="asc"?(t(),s("span",gP,"▲")):f.value==="message"&&p.value==="desc"?(t(),s("span",xP,"▼")):(t(),s("span",hP,"⇅"))])])]),S[27]||(S[27]=e("th",{class:"border p-2"},"操作",-1))])]),e("tbody",null,[(t(!0),s(Z,null,re(c.value,(Y,fe)=>(t(),s("tr",{key:fe,class:"hover:bg-gray-100"},[e("td",wP,l(Y.time),1),e("td",_P,[e("span",{class:X(R(Y.level))},l(Y.level),3)]),e("td",kP,l(Y.module),1),e("td",$P,l(Y.user),1),e("td",CP,l(Y.ip),1),e("td",EP,l(Y.message),1),e("td",SP,[e("button",{class:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:le=>L(Y),"aria-label":"查看日誌詳情"}," 詳情 ",8,DP)])]))),128)),c.value.length===0?(t(),s("tr",MP,S[28]||(S[28]=[e("td",{colspan:"7",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])]),c.value.length>0?(t(),s("div",AP,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:A.value===1||a.value,onClick:ue,"aria-label":"前往上一頁"}," 上一頁 ",8,IP),(t(!0),s(Z,null,re(U.value,Y=>(t(),s(Z,{key:Y},[Y!=="..."?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":Y===A.value}]),disabled:a.value,onClick:fe=>te(Y),"aria-label":`前往第 ${Y} 頁`,"aria-current":Y===A.value?"page":null},l(Y),11,RP)):(t(),s("span",PP,"..."))],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:A.value===G.value||a.value,onClick:ye,"aria-label":"前往下一頁"}," 下一頁 ",8,UP)])):J("",!0)]))]),b.value?(t(),s("div",NP,[e("div",TP,[S[29]||(S[29]=e("h2",{class:"text-lg font-bold mb-4"},"日誌詳情",-1)),e("div",VP,[e("div",jP,[e("pre",LP,l(r.value.message),1)]),r.value.stackTrace?(t(),s("div",FP,[e("div",qP,[e("pre",OP,l(r.value.stackTrace),1)])])):J("",!0)]),e("div",{class:"flex justify-end mt-6"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:j,"aria-label":"關閉日誌詳情"}," 關閉 ")])])])):J("",!0)]))}},HP=Le(BP,[["__scopeId","data-v-07e717fe"]]),WP={class:"flex flex-col items-center p-6"},zP={class:"w-full max-w-[1500px]"},KP={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},JP={key:1,class:"w-full max-w-[1500px]"},YP={class:"grid grid-cols-3 gap-4 mb-8"},GP={class:"flex items-center"},QP=["disabled"],ZP={value:""},XP=["value"],eU={class:"flex items-center"},tU=["disabled"],sU={value:""},aU=["value"],oU={class:"flex items-center"},lU={class:"flex items-center col-span-2"},nU={class:"flex items-center"},rU={class:"grid grid-cols-3 gap-4 mb-8"},iU={class:"flex items-center"},dU={class:"flex items-center"},uU={class:"flex items-center"},cU={class:"flex items-center"},pU=["disabled"],vU={value:""},mU=["value"],bU={class:"flex items-center"},fU={class:"flex items-center"},yU={class:"flex items-center"},gU={class:"flex items-center"},xU={class:"flex items-center"},hU={class:"flex items-center"},wU={class:"grid grid-cols-3 gap-4 mb-8"},_U={class:"flex items-center"},kU={class:"flex items-center"},$U={class:"grid grid-cols-3 gap-4 mb-8"},CU={class:"flex items-center"},EU={class:"flex items-center"},SU={class:"flex items-center"},DU={class:"grid grid-cols-3 gap-4 mb-8"},MU={class:"flex items-center"},AU={class:"flex items-center"},IU={class:"flex items-center"},RU={class:"w-full mb-8"},PU={__name:"AddCourseStudent",setup(D){const x=We();lt();const d=m(!1),u=m(!1),C=m(!1),o=m(!1),N=m([]),K=m([]),$=m([]),P=m({agency:"",courseName:"",courseMode:"",courseDate:"",location:"",name:"",gender:"",idNumber:"",organization:"",unit:"",department:"",title:"",phoneNumber:"",officePhone:"",officialEmail:"",courseFee:null,receiptNumber:"",totalHours:null,absentHours:null,attendanceHours:null,grade:null,isCertified:"",certificateNumber:"",remark:""}),T=async()=>{await v.confirmAsync("確認取消","是否要取消新增學員？已填寫的資料將不會被儲存。")&&x.back()},z=()=>P.value.agency?P.value.courseName?P.value.name?P.value.gender?P.value.idNumber?!0:(v.showError("儲存失敗","請填寫身分證字號"),!1):(v.showError("儲存失敗","請填寫性別"),!1):(v.showError("儲存失敗","請填寫學員姓名"),!1):(v.showError("儲存失敗","請選擇課程名稱"),!1):(v.showError("儲存失敗","請選擇訓練機構"),!1),g=async()=>{var r;if(!P.value.agency){$.value=[],P.value.courseName="",P.value.courseMode="",P.value.courseDate="",P.value.location="";return}try{o.value=!0;const f=await ot.getCourseData({school:P.value.agency});f.data&&f.data.code===0?($.value=f.data.data.map(p=>({id:p.id,name:p.name,courseMode:a(p.courseMode),date:p.date||"",location:p.location||""})),$.value.length===1?(P.value.courseName=$.value[0].id,A()):P.value.courseName=""):(console.error("獲取課程選項失敗:",(r=f.data)==null?void 0:r.message),v.showError("載入失敗","獲取課程選項失敗"),$.value=[])}catch(f){console.error("獲取課程選項錯誤:",f),v.showError("載入失敗","獲取課程選項時發生錯誤"),$.value=[]}finally{o.value=!1}},a=r=>{switch(r){case 1:return"線上";case 2:return"實體";case 3:return"線上/實體";default:return"未指定"}},A=()=>{if(!P.value.courseName){P.value.courseMode="",P.value.courseDate="",P.value.location="";return}const r=$.value.find(f=>f.id===parseInt(P.value.courseName));r&&(P.value.courseMode=r.courseMode||"",P.value.courseDate=r.date||"",P.value.location=r.location||"")},G=()=>({courseId:parseInt(P.value.courseName),studentName:P.value.name,gender:parseInt(P.value.gender),studentIdNumber:P.value.idNumber,agencyId:P.value.organization?parseInt(P.value.organization):void 0,unit:P.value.unit||"",department:P.value.department||"",jobTitle:P.value.title||"",phone:P.value.phoneNumber||"",officePhone:P.value.officePhone||"",officeEmail:P.value.officialEmail||"",receiptAmount:P.value.courseFee?parseInt(P.value.courseFee):0,receiptNumber:P.value.receiptNumber||"",classHours:P.value.totalHours?parseInt(P.value.totalHours):0,attendanceHours:P.value.attendanceHours?Number(P.value.attendanceHours):0,missedHours:P.value.absentHours?Number(P.value.absentHours):0,grade:P.value.grade?Number(P.value.grade):0,cerificationNumber:P.value.certificateNumber||"",remark:P.value.remark||""}),k=async()=>{var r;if(z())try{d.value=!0;const f=G();console.log("提交的課程學員數據:",f);const p=await jt.addCourseStudent(f);if(p.data&&p.data.code===0){v.showSuccess("新增成功","學員已成功新增到課程"),setTimeout(()=>{x.push("/course")},300);return}v.showError("新增失敗",((r=p.data)==null?void 0:r.message)||"新增學員時發生錯誤")}catch(f){console.error("新增學員錯誤:",f),v.showError("新增失敗","新增學員時發生錯誤，請稍後再試")}finally{d.value=!1}},c=async()=>{var r;try{u.value=!0;const f=await ot.getSchoolOptions();f.data&&f.data.code===0?N.value=f.data.data:(console.error("獲取訓練機構選項失敗:",(r=f.data)==null?void 0:r.message),v.showError("載入失敗","獲取訓練機構選項失敗"))}catch(f){console.error("獲取訓練機構選項錯誤:",f),v.showError("載入失敗","獲取訓練機構選項失敗")}finally{u.value=!1}},b=async()=>{var r;try{C.value=!0;const f=await ot.getAgencyOptions();f.data&&f.data.code===0?K.value=f.data.data:(console.error("獲取機關選項失敗:",(r=f.data)==null?void 0:r.message),v.showError("載入失敗","獲取機關選項失敗"))}catch(f){console.error("獲取機關選項錯誤:",f),v.showError("載入失敗","獲取機關選項失敗")}finally{C.value=!1}};return je(()=>{c(),b()}),(r,f)=>(t(),s("div",WP,[e("div",zP,[Qe(pt,{breadcrumbs:[{name:"課程內容",path:"/course"},{name:"新增課程學員",path:""}]})]),e("div",{class:"w-full max-w-[1500px] flex justify-between items-center mb-4"},[f[24]||(f[24]=e("div",{class:"text-sm text-gray-600"},[e("span",{class:"text-red-500"},"*"),xe(" 代表必填欄位 ")],-1)),e("div",{class:"space-x-4"},[e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:T}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:k}," 儲存 ")])]),d.value?(t(),s("div",KP,f[25]||(f[25]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",JP,[f[52]||(f[52]=e("h2",{class:"text-xl font-bold mb-6"},"班級資訊",-1)),e("div",YP,[e("div",GP,[f[26]||(f[26]=e("label",{class:"w-28",for:"agency"},[xe("訓練機構:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"agency",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[0]||(f[0]=p=>P.value.agency=p),disabled:u.value,onChange:g},[e("option",ZP,l(u.value?"載入中...":"請選擇訓練機構"),1),(t(!0),s(Z,null,re(N.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,XP))),128))],40,QP),[[Pe,P.value.agency]])]),e("div",eU,[f[27]||(f[27]=e("label",{class:"w-28",for:"courseName"},[xe("課程名稱:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"courseName",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[1]||(f[1]=p=>P.value.courseName=p),disabled:!P.value.agency||o.value,onChange:A},[e("option",sU,l(P.value.agency?o.value?"載入中...":"請選擇課程":"請先選擇訓練機構"),1),(t(!0),s(Z,null,re($.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,aU))),128))],40,tU),[[Pe,P.value.courseName]])]),e("div",oU,[f[28]||(f[28]=e("label",{class:"w-28",for:"courseMode"},"訓練方式:",-1)),I(e("input",{id:"courseMode",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":f[2]||(f[2]=p=>P.value.courseMode=p),placeholder:"",readonly:""},null,512),[[ee,P.value.courseMode]])]),e("div",lU,[f[29]||(f[29]=e("label",{class:"w-28",for:"courseDate"},"訓練日期:",-1)),I(e("input",{id:"courseDate",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":f[3]||(f[3]=p=>P.value.courseDate=p),placeholder:"",readonly:""},null,512),[[ee,P.value.courseDate]])]),e("div",nU,[f[30]||(f[30]=e("label",{class:"w-28",for:"location"},"訓練地點:",-1)),I(e("input",{id:"location",type:"text",class:"flex-1 p-2 border border-gray-300 outline-none focus:outline-none bg-gray-100","onUpdate:modelValue":f[4]||(f[4]=p=>P.value.location=p),placeholder:"",readonly:""},null,512),[[ee,P.value.location]])])]),f[53]||(f[53]=e("h2",{class:"text-xl font-bold mb-6"},"學員基本資料",-1)),e("div",rU,[e("div",iU,[f[31]||(f[31]=e("label",{class:"w-28",for:"name"},[xe("姓名:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{id:"name",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[5]||(f[5]=p=>P.value.name=p),placeholder:"姓名"},null,512),[[ee,P.value.name]])]),e("div",dU,[f[33]||(f[33]=e("label",{class:"w-28",for:"gender"},[xe("性別:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("select",{id:"gender",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[6]||(f[6]=p=>P.value.gender=p)},f[32]||(f[32]=[e("option",{value:""},"請選擇",-1),e("option",{value:"1"},"男",-1),e("option",{value:"2"},"女",-1),e("option",{value:"3"},"其他",-1)]),512),[[Pe,P.value.gender]])]),e("div",uU,[f[34]||(f[34]=e("label",{class:"w-28",for:"idNumber"},[xe("身分證字號:"),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{id:"idNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[7]||(f[7]=p=>P.value.idNumber=p),placeholder:"身分證字號"},null,512),[[ee,P.value.idNumber]])]),e("div",cU,[f[35]||(f[35]=e("label",{class:"w-28",for:"organization"},"機關名稱:",-1)),I(e("select",{id:"organization",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[8]||(f[8]=p=>P.value.organization=p),disabled:C.value},[e("option",vU,l(C.value?"載入中...":"請選擇機關"),1),(t(!0),s(Z,null,re(K.value,p=>(t(),s("option",{key:p.id,value:p.id},l(p.name),9,mU))),128))],8,pU),[[Pe,P.value.organization]])]),e("div",bU,[f[36]||(f[36]=e("label",{class:"w-28",for:"unit"},"單位:",-1)),I(e("input",{id:"unit",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[9]||(f[9]=p=>P.value.unit=p),placeholder:"單位"},null,512),[[ee,P.value.unit]])]),e("div",fU,[f[37]||(f[37]=e("label",{class:"w-28",for:"department"},"部門:",-1)),I(e("input",{id:"department",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[10]||(f[10]=p=>P.value.department=p),placeholder:"部門"},null,512),[[ee,P.value.department]])]),e("div",yU,[f[38]||(f[38]=e("label",{class:"w-28",for:"title"},"職稱:",-1)),I(e("input",{id:"title",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[11]||(f[11]=p=>P.value.title=p),placeholder:"職稱"},null,512),[[ee,P.value.title]])]),e("div",gU,[f[39]||(f[39]=e("label",{class:"w-28",for:"phoneNumber"},"手機號碼:",-1)),I(e("input",{id:"phoneNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[12]||(f[12]=p=>P.value.phoneNumber=p),placeholder:"手機號碼"},null,512),[[ee,P.value.phoneNumber]])]),e("div",xU,[f[40]||(f[40]=e("label",{class:"w-28",for:"officePhone"},"公務電話:",-1)),I(e("input",{id:"officePhone",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[13]||(f[13]=p=>P.value.officePhone=p),placeholder:"公務電話"},null,512),[[ee,P.value.officePhone]])]),e("div",hU,[f[41]||(f[41]=e("label",{class:"w-28",for:"officialEmail"},"公務信箱:",-1)),I(e("input",{id:"officialEmail",type:"email",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[14]||(f[14]=p=>P.value.officialEmail=p),placeholder:"公務電子郵件"},null,512),[[ee,P.value.officialEmail]])])]),f[54]||(f[54]=e("h2",{class:"text-xl font-bold mb-6"},"費用及收據",-1)),e("div",wU,[e("div",_U,[f[42]||(f[42]=e("label",{class:"w-28",for:"courseFee"},"學分費:",-1)),I(e("input",{id:"courseFee",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[15]||(f[15]=p=>P.value.courseFee=p),placeholder:"學分費"},null,512),[[ee,P.value.courseFee]])]),e("div",kU,[f[43]||(f[43]=e("label",{class:"w-28",for:"receiptNumber"},"收據編號:",-1)),I(e("input",{id:"receiptNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[16]||(f[16]=p=>P.value.receiptNumber=p),placeholder:"收據編號"},null,512),[[ee,P.value.receiptNumber]])])]),f[55]||(f[55]=e("h2",{class:"text-xl font-bold mb-6"},"出缺勤統計",-1)),e("div",$U,[e("div",CU,[f[44]||(f[44]=e("label",{class:"w-28",for:"totalHours"},"訓練時數:",-1)),I(e("input",{id:"totalHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[17]||(f[17]=p=>P.value.totalHours=p),placeholder:"訓練時數"},null,512),[[ee,P.value.totalHours]])]),e("div",EU,[f[45]||(f[45]=e("label",{class:"w-28",for:"absentHours"},"缺席時數:",-1)),I(e("input",{id:"absentHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[18]||(f[18]=p=>P.value.absentHours=p),placeholder:"缺席時數"},null,512),[[ee,P.value.absentHours]])]),e("div",SU,[f[46]||(f[46]=e("label",{class:"w-28",for:"attendanceHours"},"出席時數:",-1)),I(e("input",{id:"attendanceHours",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[19]||(f[19]=p=>P.value.attendanceHours=p),placeholder:"出席時數"},null,512),[[ee,P.value.attendanceHours]])])]),f[56]||(f[56]=e("h2",{class:"text-xl font-bold mb-6"},"成績及證書",-1)),e("div",DU,[e("div",MU,[f[47]||(f[47]=e("label",{class:"w-28",for:"grade"},"成績:",-1)),I(e("input",{id:"grade",type:"number",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[20]||(f[20]=p=>P.value.grade=p),placeholder:"成績"},null,512),[[ee,P.value.grade]])]),e("div",AU,[f[49]||(f[49]=e("label",{class:"w-28",for:"isCertified"},"是否發證:",-1)),I(e("select",{id:"isCertified",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[21]||(f[21]=p=>P.value.isCertified=p)},f[48]||(f[48]=[e("option",{value:""},"請選擇",-1),e("option",{value:"是"},"是",-1),e("option",{value:"否"},"否",-1)]),512),[[Pe,P.value.isCertified]])]),e("div",IU,[f[50]||(f[50]=e("label",{class:"w-28",for:"certificateNumber"},"證書編號:",-1)),I(e("input",{id:"certificateNumber",type:"text",class:"flex-1 p-2 border border-[#4e9875] outline-none focus:outline-none","onUpdate:modelValue":f[22]||(f[22]=p=>P.value.certificateNumber=p),placeholder:"證書編號"},null,512),[[ee,P.value.certificateNumber]])])]),f[57]||(f[57]=e("h2",{class:"text-xl font-bold mb-6"},"其他",-1)),e("div",RU,[f[51]||(f[51]=e("label",{class:"block mb-2",for:"remark"},"備註:",-1)),I(e("textarea",{id:"remark",class:"w-full p-2 border border-[#4e9875] outline-none focus:outline-none min-h-[100px]","onUpdate:modelValue":f[23]||(f[23]=p=>P.value.remark=p),placeholder:"備註"},null,512),[[ee,P.value.remark]])])]))]))}},UU=Le(PU,[["__scopeId","data-v-ac1ba15c"]]),Vt={getFolderContents:(D=[])=>{const x={};return D&&D.length>0&&(x.path=D),console.log("API 調用路徑陣列:",D),he.get("/v1/fileManage",{params:x,paramsSerializer:d=>{const u=new URLSearchParams;return Object.keys(d).forEach(C=>{const o=d[C];Array.isArray(o)?o.forEach(N=>{u.append(C,N)}):u.append(C,o)}),u.toString()}})},createFolder:(D,x=[])=>{const d={folderName:D.trim(),path:Array.isArray(x)?[...x]:[]};return console.log("API 創建資料夾:",d),he.post("/v1/fileManage/create",d)},_getPrefixedFormDataEntries:(D,x)=>{const d=[];for(const u of D.keys())u.startsWith(x)&&d.push(D.get(u));return d},uploadFiles:(D,x)=>he.post("/v1/fileManage/upload",D,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:x}),searchFiles:(D,x=[])=>{const d={keyword:D.trim()};return x&&x.length>0&&(d.path=x),console.log("API 搜尋關鍵字:",D),console.log("API 搜尋路徑陣列:",x),he.get("/v1/fileManage",{params:d,paramsSerializer:u=>{const C=new URLSearchParams;return Object.keys(u).forEach(o=>{const N=u[o];Array.isArray(N)?N.forEach(K=>{C.append(o,K)}):C.append(o,N)}),C.toString()}})},deleteItems:D=>{const d={items:D.map(u=>{const C={...u};return!C.path||!Array.isArray(C.path)?C.path=[]:C.path=[...C.path],C})};return console.log("API 批次刪除請求:",d),he.delete("/v1/fileManage",{data:d})},getFileUrl:(D,x=null,d=[])=>{const u=localStorage.getItem("fileBaseUrl")||"";let C="";if(d&&d.length>0){const o=d.join("/");C=`${u}${o}/${D}`}else x?C=`${u}${x}/${D}`:D.includes("/")?C=`${u}${D}`:C=`${u}${D}`;return console.log("獲取檔案 URL:",{fileName:D,folderPath:x,pathArray:d,fileUrl:C}),Promise.resolve({data:{code:0,message:"success",data:{url:C}}})}},NU={class:"flex flex-col items-center p-6"},TU={class:"w-full max-w-[1500px]"},VU={class:"w-full max-w-[1500px] mt-4"},jU={class:"bg-white p-4 rounded shadow-sm flex flex-wrap items-center gap-4"},LU={class:"flex-1 min-w-[300px]"},FU={class:"flex items-center gap-1 text-sm"},qU={class:"flex items-center flex-wrap"},OU=["onClick"],BU={class:"flex-1 min-w-[300px]"},HU={class:"relative"},WU={class:"mt-4 bg-white rounded shadow-sm p-4 min-h-[400px]"},zU={key:0,class:"mb-4 bg-gray-100 p-3 rounded flex flex-wrap items-center justify-between"},KU={class:"flex items-center gap-3"},JU={class:"text-sm text-gray-700"},YU={class:"font-bold text-blue-700"},GU={key:1,class:"flex justify-center items-center py-10"},QU={key:2},ZU={class:"mb-4 flex justify-between items-center"},XU={class:"text-sm text-gray-600"},eN={key:0,class:"text-center py-10 text-gray-500"},tN={key:1},sN={class:"text-lg font-bold mb-2"},aN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},oN=["onClick"],lN={class:"flex items-center"},nN=["id","value"],rN={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},iN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},dN={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},uN=["title"],cN={key:0,class:"mt-1 text-xs text-gray-500"},pN={key:3,class:"text-center py-10 text-gray-500"},vN={key:4},mN={key:0,class:"mb-6"},bN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},fN=["onClick"],yN={class:"flex items-center"},gN=["id","value"],xN=["title"],hN={class:"mt-1 text-xs text-gray-500"},wN={key:0,class:"mt-2 border-t pt-2"},_N=["onClick"],kN=["id","value"],$N={class:"text-blue-500 mr-1"},CN={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},EN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},SN=["title"],DN={key:1},MN={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},AN=["onClick"],IN={class:"flex items-center"},RN=["id","value"],PN={class:"text-blue-500 mr-2"},UN={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},NN={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},TN=["title"],VN={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},jN={class:"bg-white p-6 rounded-md shadow-lg w-96 max-w-[90%]"},LN={class:"mb-4"},FN={key:0,class:"text-red-500 text-sm mt-1"},qN={class:"flex justify-end space-x-2"},ON=["disabled"],BN={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},HN={class:"bg-white p-6 rounded-md shadow-lg w-[500px] max-w-[90%]"},WN={class:"mb-4"},zN={id:"uploadPath",class:"p-2 bg-gray-100 rounded text-sm"},KN={class:"mb-4"},JN=["disabled"],YN={class:"mb-4"},GN={key:0},QN={key:1,class:"text-left"},ZN={class:"mb-2 font-medium"},XN={class:"max-h-[150px] overflow-y-auto"},eT={class:"truncate"},tT={class:"flex justify-end space-x-2"},sT=["disabled"],aT=["disabled"],oT={key:0,class:"mt-4"},lT={class:"flex justify-between mb-1"},nT={class:"text-sm"},rT={class:"w-full bg-gray-200 rounded-full h-2"},iT={key:2,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},dT={class:"relative bg-white p-4 rounded-md shadow-lg max-w-4xl max-h-[90vh] w-[90vw] flex flex-col"},uT={class:"flex-1 overflow-auto flex items-center justify-center bg-gray-100 p-2 rounded"},cT={key:0,class:"text-center py-10"},pT={key:1,class:"text-center py-10 text-red-500"},vT=["src","alt"],mT={class:"mt-3 text-sm text-gray-600"},bT={key:0},fT={key:3,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},yT={class:"relative bg-white p-4 rounded-md shadow-lg max-w-4xl max-h-[90vh] w-[90vw] flex flex-col"},gT={class:"flex-1 overflow-auto bg-gray-100 p-4 rounded"},xT={key:0,class:"text-center py-10"},hT={key:1,class:"text-center py-10 text-red-500"},wT={key:2,class:"h-full"},_T=["src"],kT={key:1,class:"whitespace-pre-wrap text-sm font-mono p-4 bg-white rounded border text-preview-content"},$T={class:"mt-3 text-sm text-gray-600"},CT={key:0},ET={class:"mt-2 flex space-x-2"},ST=["href"],DT={__name:"FileManagement",setup(D){const x=We(),d=lt(),u=m({fileManagerCreate:!1,fileManagerUpload:!1,fileManagerDelete:!1}),C=async()=>{try{const B=await tt.getSidebarPermissions();B.data.code===0&&B.data.message==="success"?(u.value=B.data.data,console.log("檔案管理頁面權限:",u.value)):console.error("獲取權限失敗:",B.data.message)}catch(B){console.error("獲取權限錯誤:",B)}},o=m(!1),N=m(""),K=m("根目錄"),$=m([]),P=m([]),T=m([]),z=m(!1),g=m([]),a=m(!1),A=m(null),G=m(!1),k=m(""),c=m(""),b=m(!1),r=m(!1),f=m(null),p=m([]),w=m(!1),y=m(0),V=m(!1),W=m(""),O=m(""),_=m(!1),E=m(""),L=m(!1),j=m({name:""}),R=m(""),U=m(!1),te=m(!1),ue=m(!1),ye=m({name:""}),ke=m(""),De=m(!1),$e=m(!1),ve=m(""),oe=Se(()=>{var M;return(M=j.value)!=null&&M.name?j.value.name.replace(/image|圖片|照片|預覽|preview/gi,"").trim()||j.value.name:""});Ee(O,B=>{!B.trim()&&_.value&&ge()});const q=Se(()=>{if(!_.value||!E.value.trim())return[];const B=E.value,M=[],F=(Ae,Fe)=>{Ae.forEach(Te=>{const nt=[...Fe],Oe=nt.join("/");if(Te.name.includes(B)&&M.push({name:Te.name,isFolder:Te.isFolder,id:Te.isFolder?`folder_${Oe}/${Te.name}`:`file_${Oe}/${Te.name}`,folderPath:Oe,...Te.isFolder?{folders:Te.folders,files:Te.files}:{},actualPathArray:nt}),Te.isFolder){const kt=[...nt,Te.name];Te.folders&&Te.folders.length>0&&F(Te.folders.map(yt=>({...yt,isFolder:!0})),kt),Te.files&&Te.files.length>0&&F(Te.files.map(yt=>({...yt,isFolder:!1})),kt)}})},ne=T.value||[];return F($.value.map(Ae=>({...Ae,isFolder:!0})),ne),F(P.value.map(Ae=>({...Ae,isFolder:!1})),ne),M}),S=async B=>{if(console.log("點擊搜尋結果項目:",B),B.isFolder){const F=(B.actualPathArray?[...B.actualPathArray,B.name]:[B.name]).join("/");Y(F)}else{const M=B.actualPathArray||[];if(H(B.name))n({name:B.name,size:B.size,folderPath:M.join("/"),actualPathArray:M});else if(i(B.name))gt({name:B.name,size:B.size,folderPath:M.join("/"),actualPathArray:M});else{console.log("點擊了非預覽類型檔案:",B.name);try{const F=await Vt.getFileUrl(B.name,null,M);if(F.data.code===0){const ne=document.createElement("a");ne.href=F.data.data.url,ne.target="_blank",ne.download=B.name,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)}else v.showError("下載失敗","無法獲取檔案下載連結")}catch(F){console.error("下載檔案錯誤:",F),v.showError("下載失敗","下載檔案時發生錯誤")}}}},Y=async(B="")=>{try{o.value=!0,console.log("嘗試載入路徑:",B||"(根目錄)"),_.value=!1,z.value&&Et(),$.value=[],P.value=[];let M=[];if(B){const ne=B.replace(/\/+/g,"/").replace(/(^\/|\/$)/g,"");ne&&(M=ne.split("/"))}T.value=M,console.log("API 請求路徑陣列:",T.value);const F=await Vt.getFolderContents(T.value);if(F.data.code===0&&F.data.message==="success"){const ne=F.data.data;if(console.log("API返回的完整資料:",ne),A.value=ne,ne.pathUrl&&localStorage.setItem("fileBaseUrl",ne.pathUrl),$.value=(ne.folders||[]).map(Ae=>({name:Ae.name,files:Ae.files||[],folders:Ae.folders||[]})),P.value=ne.files||[],N.value=B,K.value=ne.name||"根目錄",B)x.replace({query:{path:B}});else{const Ae=window.location.pathname;window.history.pushState({},document.title,Ae)}}else console.error("獲取資料夾內容失敗:",F.data.message),v.showError("載入失敗","獲取資料夾內容失敗: "+F.data.message)}catch(M){console.error("獲取資料夾內容錯誤:",M),v.showError("載入失敗","無法獲取資料夾內容，請稍後再試")}finally{o.value=!1}},fe=B=>{_.value=!1,O.value="",z.value&&Et();{const M=window.location.pathname;window.history.pushState({},document.title,M),N.value="",T.value=[]}Y(B)},le=B=>{if(B<0||B>=T.value.length)return;z.value&&Et();const F=T.value.slice(0,B+1).join("/");Y(F)},Q=B=>{if(console.log("開啟資料夾:",B),_.value){_.value=!1,O.value="",Y(B);return}let M=N.value?`${N.value}/${B}`:B;Y(M)},se=B=>{if(B===0)return"0 Bytes";const M=1024,F=["Bytes","KB","MB","GB","TB"],ne=Math.floor(Math.log(B)/Math.log(M));return parseFloat((B/Math.pow(M,ne)).toFixed(2))+" "+F[ne]},ie=()=>{G.value=!0,k.value="",c.value=""},de=()=>{G.value=!1,k.value="",c.value=""},ae=async()=>{if(!k.value.trim()){c.value="請輸入資料夾名稱";return}if(/[/\\:*?"<>|]/.test(k.value)){c.value='資料夾名稱不能包含以下字符: / \\ : * ? " < > |';return}if($.value.some(F=>F.name===k.value)){c.value="資料夾已存在";return}try{b.value=!0;const F=k.value,ne=await Vt.createFolder(F,T.value);ne.data.code===0&&ne.data.message==="success"?(de(),await Y(N.value),v.showSuccess("建立成功",`資料夾 "${F}" 已成功建立`)):(console.error("建立資料夾失敗:",ne.data.message),v.showError("建立失敗","建立資料夾失敗: "+ne.data.message))}catch(F){console.error("建立資料夾錯誤:",F),v.showError("建立失敗","無法建立資料夾，請稍後再試")}finally{b.value=!1}},ce=()=>{r.value=!0,p.value=[],y.value=0,W.value=""},Ie=()=>{r.value=!1,p.value=[],y.value=0,W.value=""},Be=()=>{f.value.click()},me=B=>{const M=Array.from(B.target.files);M.length!==0&&(p.value=[...p.value,...M],B.target.value="")},pe=B=>{V.value=!1;const M=Array.from(B.dataTransfer.files);M.length!==0&&(p.value=[...p.value,...M])},we=async()=>{if(p.value.length===0){v.showError("上傳錯誤","請選擇要上傳的檔案");return}try{w.value=!0,y.value=0;const B=new FormData;T.value.length>0&&(T.value.forEach((ne,Ae)=>{B.append(`path[${Ae}]`,ne)}),console.log("上傳檔案路徑陣列:",T.value)),p.value.forEach(ne=>{B.append("files",ne)}),p.value.length===1&&W.value.trim()&&B.append("fileName",W.value.trim()),console.log("FormData 內容預覽:");for(const ne of B.entries())console.log(ne[0],ne[1]);const M=p.value.length,F=await Vt.uploadFiles(B,ne=>{ne.lengthComputable&&(y.value=ne.loaded/ne.total*100)});F.data.code===0&&F.data.message==="success"?(Ie(),await Y(N.value),v.showSuccess("上傳成功",`已成功上傳 ${M} 個檔案`)):(console.error("上傳檔案失敗:",F.data.message),v.showError("上傳失敗",F.data.message||"上傳檔案時出現錯誤"))}catch(B){console.error("上傳檔案錯誤:",B),v.showError("上傳失敗","上傳檔案時發生錯誤，請稍後再試")}finally{w.value=!1}};je(()=>{C();const B=d.query.path||"";console.log("初始路徑:",B),Y(B)});const He=async()=>{if(!O.value.trim()){v.showInfo("提示","請輸入搜尋關鍵字");return}z.value&&Et();try{o.value=!0,_.value=!0,E.value=O.value,$.value=[],P.value=[],console.log("搜尋關鍵字:",O.value);const B=await Vt.searchFiles(O.value,T.value);if(B.data.code===0&&B.data.message==="success"){const M=B.data.data;if(console.log("搜尋結果:",M),$.value=M.folders||[],P.value=M.files||[],q.value.length===0)v.showInfo("搜尋結果",`沒有找到與 "${O.value}" 相關的檔案或資料夾`);else{let F=q.value.length;v.showSuccess("搜尋結果",`找到 ${F} 個符合 "${O.value}" 的檔案`)}}else console.error("搜尋失敗:",B.data.message),v.showError("搜尋失敗","搜尋檔案和資料夾失敗: "+B.data.message),_.value=!1}catch(B){console.error("搜尋錯誤:",B),v.showError("搜尋失敗","搜尋時發生錯誤，請稍後再試"),_.value=!1}finally{o.value=!1}},ge=()=>{_.value=!1,O.value="",E.value="",z.value&&Et(),N.value="";const B=window.location.pathname;window.history.pushState({},document.title,B),Y("")},H=B=>{const M=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"],F=B.toLowerCase().substring(B.lastIndexOf("."));return M.includes(F)},i=B=>{const M=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".csv",".log"],F=B.toLowerCase().substring(B.lastIndexOf("."));return M.includes(F)},n=async B=>{j.value=B,U.value=!0,te.value=!1,L.value=!0;try{let M;if(B.actualPathArray&&B.actualPathArray.length>0?M=await Vt.getFileUrl(B.name,null,B.actualPathArray):B.folderPath?M=await Vt.getFileUrl(B.name,B.folderPath):M=await Vt.getFileUrl(B.name,null,T.value),M.data.code===0&&M.data.message==="success"){const F=M.data.data.url;R.value=F,console.log("設置圖片預覽URL:",F),h(F)}else be("獲取圖片URL失敗: "+M.data.message)}catch(M){be("獲取圖片預覽錯誤: "+M)}},h=B=>{const M=new Image;M.onload=()=>{U.value=!1,te.value=!1},M.onerror=()=>{U.value=!1,te.value=!0,console.error("圖片載入失敗:",B)},M.src=B},be=B=>{U.value=!1,te.value=!0,console.error(B)},_e=()=>{L.value=!1,j.value={name:""},R.value="",U.value=!1,te.value=!1},Ve=B=>{H(B.name)?n(B):i(B.name)?gt(B):(console.log("點擊了非預覽類型檔案:",B.name),Vt.getFileUrl(B.name,null,T.value).then(M=>{if(M.data.code===0){const F=document.createElement("a");F.href=M.data.data.url,F.target="_blank",F.download=B.name,document.body.appendChild(F),F.click(),document.body.removeChild(F)}else v.showError("下載失敗","無法獲取檔案下載連結")}).catch(M=>{console.error("下載檔案錯誤:",M),v.showError("下載失敗","下載檔案時發生錯誤")}))},st=(B,M)=>{const F={...B,folderPath:M};console.log("點擊搜尋結果中的資料夾檔案:",B.name,"在資料夾:",M),H(B.name)?it(F):i(B.name)?gt(F):(console.log("點擊了搜尋結果中非預覽類型檔案:",B.name,"在資料夾:",M),Vt.getFileUrl(B.name,M).then(ne=>{if(ne.data.code===0){const Ae=document.createElement("a");Ae.href=ne.data.data.url,Ae.target="_blank",Ae.download=B.name,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae)}else v.showError("下載失敗","無法獲取檔案下載連結")}).catch(ne=>{console.error("下載搜尋結果檔案錯誤:",ne),v.showError("下載失敗","下載檔案時發生錯誤")}))},it=async B=>{j.value=B,U.value=!0,te.value=!1,L.value=!0;try{const M=B.name,F=B.folderPath;console.log("資料夾內圖片預覽:",M,"在資料夾:",F);const ne=await Vt.getFileUrl(M,F);if(ne.data.code===0&&ne.data.message==="success"){const Ae=ne.data.data.url;R.value=Ae,console.log("設置資料夾內圖片預覽URL:",Ae),h(Ae)}else be("獲取資料夾內圖片URL失敗: "+ne.data.message)}catch(M){be("獲取資料夾內圖片預覽錯誤: "+M)}},ut=()=>{U.value=!1,te.value=!1},ht=()=>{U.value=!1,te.value=!0,console.error("圖片載入失敗:",R.value)},qe=async()=>{U.value=!0,te.value=!1,j.value.actualPathArray&&j.value.actualPathArray.length>0?await n({name:j.value.name,size:j.value.size,actualPathArray:j.value.actualPathArray}):j.value.folderPath?await n({name:j.value.name,size:j.value.size,folderPath:j.value.folderPath}):await n(j.value)},gt=async B=>{ye.value=B,De.value=!0,$e.value=!1,ue.value=!0,ke.value="",ve.value="";try{let M;if(B.actualPathArray&&B.actualPathArray.length>0?M=await Vt.getFileUrl(B.name,null,B.actualPathArray):B.folderPath?M=await Vt.getFileUrl(B.name,B.folderPath):M=await Vt.getFileUrl(B.name,null,T.value),M.data.code===0&&M.data.message==="success"){const F=M.data.data.url;console.log("文本檔案預覽URL:",F),ve.value=F,ke.value=`正在嘗試載入文本內容...

如果無法正常顯示，您可以點擊下方的「在新視窗中開啟」按鈕查看檔案內容。`,De.value=!1}else De.value=!1,$e.value=!0,console.error("獲取文本檔案URL失敗:",M.data.message)}catch(M){De.value=!1,$e.value=!0,console.error("獲取文本檔案預覽錯誤:",M)}},vt=()=>{ue.value=!1,ye.value={name:""},ke.value="",De.value=!1,$e.value=!1},Pt=async()=>{De.value=!0,$e.value=!1,ye.value.actualPathArray&&ye.value.actualPathArray.length>0?await gt({name:ye.value.name,size:ye.value.size,actualPathArray:ye.value.actualPathArray}):ye.value.folderPath?await gt({name:ye.value.name,size:ye.value.size,folderPath:ye.value.folderPath}):await gt(ye.value)},wt=async()=>{if(!z.value){z.value=!0,g.value=[];return}await It()},It=async()=>{if(g.value.length===0){v.showInfo("提示","請選擇要刪除的項目");return}await v.confirmAsync("確認刪除",`確定要刪除選中的 ${g.value.length} 個項目嗎？刪除後資料將無法恢復。`)&&await Ct()},Ct=async()=>{const B=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(!(B===null||B===""))try{if(a.value=!0,(await jt.confirmPassword(B)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試");return}await Mt(),Et()}catch(M){console.error("操作錯誤:",M),ts(M)}finally{a.value=!1}},ts=B=>{B.response&&B.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","批次刪除時發生錯誤，請稍後再試")},Mt=async()=>{if(g.value.length===0)return;const B=g.value.map(ne=>({name:ne.name,isFolder:ne.isFolder,path:ne.path||[]}));console.log("處理後的刪除項目:",B);const M=B.length,F=await Vt.deleteItems(B);return F.data.code===0?(await Y(N.value),v.showSuccess("刪除成功",`成功刪除 ${M} 個項目`),!0):(console.error("批次刪除失敗:",F.data.message),v.showError("刪除失敗","批次刪除項目失敗: "+F.data.message),!1)},Et=()=>{z.value=!1,g.value=[]},Rt=()=>{if(z.value)if(_.value)g.value=q.value.map(B=>({name:B.name,isFolder:B.isFolder,path:B.actualPathArray||[]}));else{const B=[];$.value.forEach(M=>{B.push({name:M.name,isFolder:!0,path:T.value})}),P.value.forEach(M=>{B.push({name:M.name,isFolder:!1,path:T.value})}),g.value=B}},Ut=B=>{const M=B.folders?B.folders.length:0,F=B.files?B.files.length:0,ne=[];return M>0&&ne.push(`${M} 個資料夾`),F>0&&ne.push(`${F} 個檔案`),ne.length>0?ne.join(", "):"空資料夾"};return(B,M)=>(t(),s(Z,null,[e("div",NU,[e("div",TU,[Qe(pt,{breadcrumbs:[{name:"檔案管理",path:"/"}]})]),e("div",VU,[e("div",jU,[e("div",LU,[e("div",FU,[M[17]||(M[17]=e("span",{class:"font-bold"},"目前位置：",-1)),e("div",qU,[e("span",{class:"cursor-pointer text-blue-600 hover:underline",onClick:M[0]||(M[0]=F=>fe(""))}," 根目錄 "),T.value.length>0?(t(!0),s(Z,{key:0},re(T.value,(F,ne)=>(t(),s(Z,{key:ne},[M[16]||(M[16]=e("span",{class:"mx-1"},"/",-1)),e("span",{class:"cursor-pointer text-blue-600 hover:underline",onClick:Ae=>le(ne)},l(F),9,OU)],64))),128)):J("",!0)])])]),e("div",BU,[e("div",HU,[I(e("input",{type:"text","onUpdate:modelValue":M[1]||(M[1]=F=>O.value=F),placeholder:"搜尋檔案或資料夾...",class:"w-full px-4 py-2 border border-gray-300 rounded-md pr-10 outline-none",onKeyup:Ne(He,["enter"])},null,544),[[ee,O.value]]),e("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:He},M[18]||(M[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)]))])]),e("div",null,[u.value.fileManagerCreate?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:ie}," 新增資料夾 ")):J("",!0)]),e("div",null,[u.value.fileManagerUpload?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:ce}," 上傳檔案 ")):J("",!0)]),e("div",null,[u.value.fileManagerDelete?(t(),s("button",{key:0,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",onClick:wt},l(z.value?"確定刪除":"批次刪除"),1)):J("",!0)])]),e("div",WU,[z.value?(t(),s("div",zU,[e("div",KU,[e("button",{onClick:Rt,class:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600"}," 全選 "),e("button",{onClick:M[2]||(M[2]=F=>g.value=[]),class:"px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400"}," 取消選擇 "),e("button",{onClick:Et,class:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600"}," 退出刪除模式 ")]),e("div",JU,[M[19]||(M[19]=xe(" 已選擇 ")),e("span",YU,l(g.value.length),1),M[20]||(M[20]=xe(" 個項目 "))])])):J("",!0),o.value?(t(),s("div",GU,M[21]||(M[21]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):_.value?(t(),s("div",QU,[e("div",ZU,[e("div",XU,' 搜尋 "'+l(O.value)+'" 的結果： ',1),e("button",{onClick:ge,class:"text-sm text-blue-600 hover:underline"}," 返回檔案列表 ")]),q.value.length===0?(t(),s("div",eN," 沒有找到符合的檔案或資料夾 ")):(t(),s("div",tN,[e("h3",sN,"搜尋結果 ("+l(q.value.length)+" 個項目)",1),e("div",aN,[(t(!0),s(Z,null,re(q.value,F=>(t(),s("div",{key:F.id,class:"border rounded-md p-3 hover:bg-gray-50 cursor-pointer",onClick:ne=>z.value?null:S(F)},[e("div",lN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:M[4]||(M[4]=Ot(()=>{},["stop"]))},[I(e("input",{type:"checkbox",id:`search-item-${F.id}`,"onUpdate:modelValue":M[3]||(M[3]=ne=>g.value=ne),value:{name:F.name,isFolder:F.isFolder,path:F.actualPathArray,folder:F.folderPath},class:"w-4 h-4 cursor-pointer"},null,8,nN),[[Ce,g.value]])])):J("",!0),e("div",{class:X(["mr-2",{"text-yellow-500":F.isFolder,"text-blue-500":!F.isFolder}])},[F.isFolder?(t(),s("svg",rN,M[22]||(M[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"},null,-1)]))):H(F.name)?(t(),s("svg",iN,M[23]||(M[23]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",dN,M[24]||(M[24]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))],2),e("div",{class:"truncate",title:F.name},l(F.name),9,uN)]),F.folderPath?(t(),s("div",cN," 在資料夾: "+l(F.folderPath),1)):J("",!0)],8,oN))),128))])]))])):$.value.length===0&&P.value.length===0?(t(),s("div",pN," 此資料夾為空 ")):(t(),s("div",vN,[$.value.length>0?(t(),s("div",mN,[M[29]||(M[29]=e("h3",{class:"text-lg font-bold mb-2"},"資料夾",-1)),e("div",bN,[(t(!0),s(Z,null,re($.value,F=>(t(),s("div",{key:F.name,class:"border rounded-md p-3 cursor-pointer hover:bg-gray-50",onClick:ne=>z.value?null:Q(F.name)},[e("div",yN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:M[6]||(M[6]=Ot(()=>{},["stop"]))},[I(e("input",{type:"checkbox",id:`folder-${F.name}`,"onUpdate:modelValue":M[5]||(M[5]=ne=>g.value=ne),value:{name:F.name,isFolder:!0,path:T.value},class:"w-4 h-4 cursor-pointer"},null,8,gN),[[Ce,g.value]])])):J("",!0),M[25]||(M[25]=e("div",{class:"text-yellow-500 mr-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})])],-1)),e("div",{class:"truncate",title:F.name},l(F.name),9,xN)]),e("div",hN,l(Ut(F)),1),_.value&&F.files&&F.files.length?(t(),s("div",wN,[M[28]||(M[28]=e("div",{class:"text-xs font-medium text-gray-700 mb-1"},"符合條件的檔案:",-1)),(t(!0),s(Z,null,re(F.files,ne=>(t(),s("div",{key:ne.name,class:"flex items-center py-1 px-2 hover:bg-gray-100 rounded text-xs cursor-pointer",onClick:Ot(Ae=>st(ne,F.name),["stop"])},[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:M[8]||(M[8]=Ot(()=>{},["stop"]))},[I(e("input",{type:"checkbox",id:`folder-file-${F.name}-${ne.name}`,"onUpdate:modelValue":M[7]||(M[7]=Ae=>g.value=Ae),value:{name:ne.name,isFolder:!1,folder:F.name},class:"w-4 h-4 cursor-pointer"},null,8,kN),[[Ce,g.value]])])):J("",!0),e("div",$N,[H(ne.name)?(t(),s("svg",CN,M[26]||(M[26]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",EN,M[27]||(M[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),e("div",{class:"truncate",title:ne.name},l(ne.name),9,SN)],8,_N))),128))])):J("",!0)],8,fN))),128))])])):J("",!0),P.value.length>0?(t(),s("div",DN,[M[32]||(M[32]=e("h3",{class:"text-lg font-bold mb-2"},"檔案",-1)),e("div",MN,[(t(!0),s(Z,null,re(P.value,F=>(t(),s("div",{key:F.name,class:"border rounded-md p-3 hover:bg-gray-50 cursor-pointer",onClick:ne=>z.value?null:Ve(F)},[e("div",IN,[z.value?(t(),s("div",{key:0,class:"mr-2",onClick:M[10]||(M[10]=Ot(()=>{},["stop"]))},[I(e("input",{type:"checkbox",id:`file-${F.name}`,"onUpdate:modelValue":M[9]||(M[9]=ne=>g.value=ne),value:{name:F.name,isFolder:!1,path:T.value},class:"w-4 h-4 cursor-pointer"},null,8,RN),[[Ce,g.value]])])):J("",!0),e("div",PN,[H(F.name)?(t(),s("svg",UN,M[30]||(M[30]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):(t(),s("svg",NN,M[31]||(M[31]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),e("div",{class:"truncate",title:F.name},l(F.name),9,TN)])],8,AN))),128))])])):J("",!0)]))])])]),G.value?(t(),s("div",VN,[e("div",jN,[M[34]||(M[34]=e("h3",{class:"text-lg font-medium mb-4"},"新增資料夾",-1)),e("div",LN,[M[33]||(M[33]=e("label",{for:"newFolderName",class:"block text-sm font-medium text-gray-700 mb-1"},"資料夾名稱",-1)),I(e("input",{id:"newFolderName",type:"text","onUpdate:modelValue":M[11]||(M[11]=F=>k.value=F),class:"w-full p-2 border border-gray-300 rounded outline-none",placeholder:"請輸入資料夾名稱",onKeyup:Ne(ae,["enter"])},null,544),[[ee,k.value]]),c.value?(t(),s("p",FN,l(c.value),1)):J("",!0)]),e("div",qN,[e("button",{onClick:de,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"}," 取消 "),e("button",{onClick:ae,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:b.value},l(b.value?"建立中...":"建立"),9,ON)])])])):J("",!0),r.value?(t(),s("div",BN,[e("div",HN,[M[41]||(M[41]=e("h3",{class:"text-lg font-medium mb-4"},"上傳檔案",-1)),e("div",WN,[M[35]||(M[35]=e("label",{for:"uploadPath",class:"block text-sm font-medium text-gray-700 mb-1"},"上傳至路徑",-1)),e("div",zN,l(N.value||"根目錄"),1)]),e("div",KN,[M[36]||(M[36]=e("label",{for:"uploadFileName",class:"text-sm font-medium text-gray-700 mb-1 flex justify-between"},[e("span",null,"指定檔案名稱（可選）"),e("span",{class:"text-xs text-gray-500"},"僅在上傳單一檔案時有效")],-1)),I(e("input",{id:"uploadFileName",type:"text","onUpdate:modelValue":M[12]||(M[12]=F=>W.value=F),class:"w-full p-2 border border-gray-300 rounded outline-none",disabled:p.value.length!==1,placeholder:"輸入檔案名稱"},null,8,JN),[[ee,W.value]])]),e("div",YN,[M[39]||(M[39]=e("label",{for:"fileInput",class:"text-sm font-medium text-gray-700 mb-1"},"選擇檔案",-1)),e("div",{class:X(["border-dashed border-2 border-gray-300 p-6 rounded-md text-center",{"bg-blue-50 border-blue-300":V.value}]),onDragover:M[14]||(M[14]=Ot(F=>V.value=!0,["prevent"])),onDragleave:M[15]||(M[15]=Ot(F=>V.value=!1,["prevent"])),onDrop:Ot(pe,["prevent"])},[e("input",{id:"fileInput",type:"file",ref_key:"fileInput",ref:f,class:"hidden",onChange:me,multiple:""},null,544),p.value.length===0?(t(),s("div",GN,[M[37]||(M[37]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),M[38]||(M[38]=e("p",{class:"mt-1"},"拖曳檔案至此處，或",-1)),e("button",{onClick:Be,class:"mt-2 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," 選擇檔案 ")])):(t(),s("div",QN,[e("p",ZN,"已選擇 "+l(p.value.length)+" 個檔案:",1),e("ul",XN,[(t(!0),s(Z,null,re(p.value,(F,ne)=>(t(),s("li",{key:ne,class:"flex justify-between items-center py-1"},[e("div",eT,l(F.name),1)]))),128))]),e("button",{onClick:M[13]||(M[13]=F=>p.value=[]),class:"mt-2 text-red-600 text-sm hover:text-red-800"}," 清除全部 ")]))],34)]),e("div",tT,[e("button",{onClick:Ie,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",disabled:w.value}," 取消 ",8,sT),e("button",{onClick:we,class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",disabled:w.value||p.value.length===0},l(w.value?"上傳中...":"上傳"),9,aT)]),w.value?(t(),s("div",oT,[e("div",lT,[M[40]||(M[40]=e("span",{class:"text-sm"},"上傳進度",-1)),e("span",nT,l(Math.round(y.value))+"%",1)]),e("div",rT,[e("div",{class:"bg-[#4e9875] h-2 rounded-full",style:Xs({width:y.value+"%"})},null,4)])])):J("",!0)])])):J("",!0),L.value?(t(),s("div",iT,[e("div",dT,[e("div",{class:"flex justify-between items-center mb-3"},[M[43]||(M[43]=e("h3",{class:"text-lg font-medium"},"圖片預覽",-1)),e("button",{onClick:_e,class:"text-gray-500 hover:text-gray-700"},M[42]||(M[42]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",uT,[U.value?(t(),s("div",cT,M[44]||(M[44]=[e("svg",{class:"animate-spin h-10 w-10 text-gray-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("div",null,"圖片載入中...",-1)]))):te.value?(t(),s("div",pT,[M[45]||(M[45]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),M[46]||(M[46]=e("div",null,"圖片載入失敗",-1)),M[47]||(M[47]=e("div",{class:"mt-2 text-sm"}," 可能是因為檔案路徑錯誤或者檔案不存在 ",-1)),e("div",{class:"mt-4"},[e("button",{onClick:qe,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," 重試 ")])])):(t(),s("img",{key:2,src:R.value,alt:oe.value,class:"max-w-full max-h-[calc(90vh-120px)] object-contain",onLoad:ut,onError:ht},null,40,vT))]),e("div",mT,[e("div",null,"檔案名稱: "+l(j.value.name),1),j.value.size?(t(),s("div",bT,"檔案大小: "+l(se(j.value.size)),1)):J("",!0)])])])):J("",!0),ue.value?(t(),s("div",fT,[e("div",yT,[e("div",{class:"flex justify-between items-center mb-3"},[M[49]||(M[49]=e("h3",{class:"text-lg font-medium"},"文本檔案預覽",-1)),e("button",{onClick:vt,class:"text-gray-500 hover:text-gray-700"},M[48]||(M[48]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",gT,[De.value?(t(),s("div",xT,M[50]||(M[50]=[e("svg",{class:"animate-spin h-10 w-10 text-gray-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("div",null,"文本載入中...",-1)]))):$e.value?(t(),s("div",hT,[M[51]||(M[51]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),M[52]||(M[52]=e("div",null,"文本載入失敗",-1)),M[53]||(M[53]=e("div",{class:"mt-2 text-sm"}," 可能是因為檔案路徑錯誤或者檔案不存在 ",-1)),e("div",{class:"mt-4"},[e("button",{onClick:Pt,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," 重試 ")])])):(t(),s("div",wT,[ve.value?(t(),s("iframe",{key:0,src:ve.value,class:"w-full h-[calc(90vh-200px)] border-0 rounded",title:"文本檔案內容預覽"},null,8,_T)):(t(),s("pre",kT,l(ke.value),1))]))]),e("div",$T,[e("div",null,"檔案名稱: "+l(ye.value.name),1),ye.value.size?(t(),s("div",CT,"檔案大小: "+l(se(ye.value.size)),1)):J("",!0),e("div",ET,[ve.value?(t(),s("a",{key:0,href:ve.value,target:"_blank",class:"inline-block px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"}," 在新視窗中開啟 ",8,ST)):J("",!0)])])])])):J("",!0)],64))}},MT=Le(DT,[["__scopeId","data-v-e0c17a53"]]),AT={class:"flex flex-col items-center p-6"},IT={class:"w-full max-w-[600px] mb-6"},RT={key:0,class:"mt-2 text-red-500"},PT={class:"w-full max-w-[600px] bg-white p-6 shadow-md rounded"},UT={class:"mb-4"},NT={class:"mb-4"},TT={class:"mb-6"},VT={key:0,class:"mb-4 p-2 bg-red-100 text-red-700 rounded"},jT={class:"flex justify-end space-x-4"},LT=["disabled"],FT=["disabled"],qT={__name:"Password",setup(D){const x=We(),d=m(!1),u=m(!1),C=Qs({oldPassword:"",newPassword:"",confirmPassword:""}),o=m(""),N=m(!1),K=async()=>{try{const A=await tt.getSidebarPermissions();if(A.data.code===0&&A.data.message==="success"){const G=A.data.data;d.value=G.isNeedChangePwd===!0,d.value||G.systemManagement&&G.userRead?u.value=!0:(v.showError("無權限訪問","您沒有權限訪問此頁面"),setTimeout(()=>{x.push("/")},1500))}else v.showError("獲取權限失敗","請重新登入"),setTimeout(()=>{$()},1500)}catch(A){console.error("獲取權限錯誤:",A),v.showError("獲取權限錯誤","請重新登入"),setTimeout(()=>{$()},1500)}},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(A=>{A.startsWith("app_")&&localStorage.removeItem(A)}),sessionStorage.clear(),window.location.href="/login?t="+new Date().getTime()},P=A=>A.length>=12&&/[A-Z]/.test(A)&&/[a-z]/.test(A)&&/\d/.test(A),T=()=>C.newPassword===C.confirmPassword,z=()=>C.newPassword!==C.oldPassword,g=async()=>{var A,G,k;if(o.value="",!P(C.newPassword)){o.value="新密碼必須至少包含12個字符，並包含大小寫字母和數字";return}if(!T()){o.value="新密碼與確認密碼不一致";return}if(!z()){o.value="新密碼不能與舊密碼相同";return}try{N.value=!0;const c=await es.updatePassword({oldPassword:C.oldPassword,newPassword:C.newPassword});if(c.data&&c.data.code===0)v.showSuccess("密碼修改成功","您的密碼已成功更新，請使用新密碼登入"),setTimeout(()=>{$()},1500);else{const b=((A=c.data)==null?void 0:A.message)||"密碼更新失敗，請稍後再試";o.value=b,v.showError("密碼更新失敗",b)}}catch(c){console.error("密碼更新錯誤:",c);const b=((k=(G=c.response)==null?void 0:G.data)==null?void 0:k.message)||"密碼更新失敗，請稍後再試";o.value=b,v.showError("密碼更新失敗",b)}finally{N.value=!1}},a=async()=>{if(d.value){v.showError("無法取消","您必須修改密碼才能繼續使用系統");return}await v.confirmAsync("確認離開","確定要離開嗎？所有未保存的更改將會丟失。")&&x.back()};return je(()=>{K()}),(A,G)=>(t(),s("div",AT,[e("div",IT,[G[3]||(G[3]=e("h1",{class:"text-2xl font-bold"},"重設密碼",-1)),d.value?(t(),s("p",RT,"您的帳號需要修改密碼才能繼續使用系統")):J("",!0)]),e("div",PT,[e("form",{onSubmit:Ot(g,["prevent"])},[e("div",UT,[G[4]||(G[4]=e("label",{for:"old-password",class:"block mb-2 font-medium"},"舊密碼",-1)),I(e("input",{type:"password",id:"old-password","onUpdate:modelValue":G[0]||(G[0]=k=>C.oldPassword=k),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請輸入舊密碼",required:""},null,512),[[ee,C.oldPassword]])]),e("div",NT,[G[5]||(G[5]=e("label",{for:"new-password",class:"block mb-2 font-medium"},"新密碼",-1)),I(e("input",{type:"password",id:"new-password","onUpdate:modelValue":G[1]||(G[1]=k=>C.newPassword=k),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請輸入新密碼",required:""},null,512),[[ee,C.newPassword]]),G[6]||(G[6]=e("p",{class:"mt-1 text-sm text-gray-500"}," 密碼必須至少包含12個字符，並包含大小寫字母和數字。 ",-1))]),e("div",TT,[G[7]||(G[7]=e("label",{for:"confirm-password",class:"block mb-2 font-medium"},"確認新密碼",-1)),I(e("input",{type:"password",id:"confirm-password","onUpdate:modelValue":G[2]||(G[2]=k=>C.confirmPassword=k),class:"w-full p-2 border border-[#4e9875] outline-none focus:border-[#438264]",placeholder:"請再次輸入新密碼",required:""},null,512),[[ee,C.confirmPassword]])]),o.value?(t(),s("div",VT,l(o.value),1)):J("",!0),e("div",jT,[e("button",{type:"button",class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:a,disabled:N.value||d.value,"aria-label":"取消修改密碼"}," 取消 ",8,LT),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",disabled:N.value,"aria-label":"提交修改密碼"},l(N.value?"提交中...":"提交"),9,FT)])],32)])]))}},OT=Le(qT,[["__scopeId","data-v-622703ef"]]),BT={class:"flex flex-col items-center p-6"},HT={class:"w-full max-w-[1500px]"},WT={class:"w-full max-w-[1500px] mt-2"},zT={class:"flex border-b border-gray-200"},KT={class:"mt-6"},JT={key:0,class:"bg-white p-6 rounded-lg shadow-sm"},YT={class:"mb-6 bg-gray-50 p-4 rounded-md"},GT={class:"space-y-4"},QT={class:"flex items-center space-x-4"},ZT={for:"export-scope-all",class:"inline-flex items-center"},XT={for:"export-scope-selected",class:"inline-flex items-center"},eV={key:0,class:"pl-4 border-l-2 border-gray-200"},tV={class:"grid grid-cols-3 gap-2"},sV=["for"],aV=["id","value"],oV={class:"ml-2"},lV={class:"flex items-center"},nV={class:"flex flex-col space-y-4"},rV={class:"flex items-center space-x-4"},iV=["disabled"],dV={key:0},uV={key:1},cV={key:1,class:"text-blue-600"},pV={key:2,class:"text-green-600"},vV={key:3,class:"text-red-600"},mV={key:0,class:"w-full max-w-lg"},bV={class:"relative pt-1"},fV={class:"flex items-center justify-between mb-2"},yV={class:"text-right"},gV={class:"text-xs font-semibold inline-block text-blue-600"},xV={class:"overflow-hidden h-2 text-xs flex rounded bg-blue-200"},hV={key:1,class:"bg-white p-6 rounded-lg shadow-sm"},wV={class:"flex flex-col space-y-4"},_V={class:"flex items-center space-x-4"},kV=["disabled"],$V={key:0},CV={key:1},EV={key:1,class:"text-blue-600"},SV={key:2,class:"text-green-600"},DV={key:3,class:"text-red-600"},MV={__name:"Database",setup(D){const x=m("export"),d=m({dataBaseExport:!1}),u=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?d.value=k.data.data:console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},C=m({scope:"all",selectedTables:[],fileName:`database_export_${new Date().toISOString().split("T")[0]}`}),o=m([]),N=async()=>{try{const k=await ot.getTables();k.data.code===0&&k.data.message==="success"?o.value=k.data.data:(console.error("獲取資料表列表失敗:",k.data.message),v.showError("載入失敗","獲取資料表列表時發生錯誤"))}catch(k){console.error("獲取資料表列表錯誤:",k),v.showError("載入失敗","獲取資料表列表時發生錯誤")}},K=m(!1),$=m(0),P=m(!1),T=m(null),z=async()=>{var k,c;if(C.value.scope==="selected"&&C.value.selectedTables.length===0){v.showError("選擇錯誤","請至少選擇一個要匯出的資料表");return}P.value=!1,T.value=null,K.value=!0,$.value=0;try{const b=setInterval(()=>{$.value<90&&($.value+=1)},200),r={selectItem:C.value.scope==="all"?1:2,tables:C.value.scope==="selected"?C.value.selectedTables:[],name:C.value.fileName||`database_export_${new Date().toISOString().split("T")[0]}`},f=await as.exportDatabase(r);clearInterval(b),$.value=100;const p=window.URL.createObjectURL(new Blob([f.data])),w=document.createElement("a");w.href=p;const y=`${r.name}.json`;w.setAttribute("download",y),document.body.appendChild(w),w.click(),w.parentNode.removeChild(w),window.URL.revokeObjectURL(p),setTimeout(()=>{K.value=!1,P.value=!0,v.showSuccess("匯出成功",`資料庫已成功匯出為 ${y}`)},500)}catch(b){console.error("匯出過程中發生錯誤:",b),T.value=((c=(k=b.response)==null?void 0:k.data)==null?void 0:c.message)||b.message||"匯出過程中發生未知錯誤",K.value=!1,$.value=0,v.showError("匯出失敗",T.value)}};je(()=>{u(),N()});const g=m(!1),a=m(!1),A=m(null),G=async()=>{var k,c;g.value=!0,a.value=!1,A.value=null;try{const b=await as.exportDump(),r=`database-backup_${new Date().toISOString().split("T")[0]}.sql`,f=window.URL.createObjectURL(new Blob([b.data])),p=document.createElement("a");p.href=f,p.setAttribute("download",r),document.body.appendChild(p),p.click(),p.parentNode.removeChild(p),window.URL.revokeObjectURL(f),a.value=!0,v.showSuccess("備份成功","資料庫備份檔案已開始下載。")}catch(b){console.error("備份過程中發生錯誤:",b),A.value=((c=(k=b.response)==null?void 0:k.data)==null?void 0:c.message)||b.message||"備份過程中發生未知錯誤",v.showError("備份失敗",A.value)}finally{g.value=!1}};return(k,c)=>(t(),s("div",BT,[e("div",HT,[Qe(pt,{breadcrumbs:[{name:"資料庫管理",path:"/database"}]})]),e("div",WT,[e("div",zT,[e("button",{onClick:c[0]||(c[0]=b=>x.value="export"),class:X(["py-2 px-4 text-base font-medium",x.value==="export"?"border-b-2 border-[#4e9875] text-[#4e9875]":"text-gray-500 hover:text-gray-700"])}," 資料庫匯出 ",2),e("button",{onClick:c[1]||(c[1]=b=>x.value="backup"),class:X(["py-2 px-4 text-base font-medium",x.value==="backup"?"border-b-2 border-[#4e9875] text-[#4e9875]":"text-gray-500 hover:text-gray-700"])}," 資料庫備份 ",2)]),e("div",KT,[x.value==="export"?(t(),s("div",JT,[c[14]||(c[14]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold mb-2"},"資料庫匯出"),e("p",{class:"text-gray-600"},"您可以匯出整個資料庫的資料為 JSON 格式檔案，便於備份或資料遷移。")],-1)),e("div",YT,[c[12]||(c[12]=e("h4",{class:"font-medium mb-4"},"匯出設定",-1)),e("div",GT,[e("fieldset",null,[c[8]||(c[8]=e("legend",{class:"block mb-2"},"匯出範圍：",-1)),e("div",QT,[e("label",ZT,[I(e("input",{id:"export-scope-all",type:"radio","onUpdate:modelValue":c[2]||(c[2]=b=>C.value.scope=b),value:"all",name:"exportScope",class:"form-radio"},null,512),[[ct,C.value.scope]]),c[6]||(c[6]=e("span",{class:"ml-2"},"全部資料",-1))]),e("label",XT,[I(e("input",{id:"export-scope-selected",type:"radio","onUpdate:modelValue":c[3]||(c[3]=b=>C.value.scope=b),value:"selected",name:"exportScope",class:"form-radio"},null,512),[[ct,C.value.scope]]),c[7]||(c[7]=e("span",{class:"ml-2"},"選擇特定資料表",-1))])])]),C.value.scope==="selected"?(t(),s("fieldset",eV,[c[9]||(c[9]=e("legend",{class:"block mb-2"},"選擇資料表：",-1)),e("div",tV,[(t(!0),s(Z,null,re(o.value,b=>(t(),s("label",{key:b.id,for:`table-${b.id}`,class:"inline-flex items-center"},[I(e("input",{id:`table-${b.id}`,type:"checkbox","onUpdate:modelValue":c[4]||(c[4]=r=>C.value.selectedTables=r),value:b.id,class:"form-checkbox"},null,8,aV),[[Ce,C.value.selectedTables]]),e("span",oV,l(b.name),1)],8,sV))),128))])])):J("",!0),e("div",null,[c[11]||(c[11]=e("label",{for:"file-name",class:"block mb-2"},"檔案名稱：",-1)),e("div",lV,[I(e("input",{id:"file-name",type:"text","onUpdate:modelValue":c[5]||(c[5]=b=>C.value.fileName=b),class:"p-2 border border-gray-300 rounded w-full max-w-md outline-none",placeholder:"輸入檔案名稱（不含副檔名）"},null,512),[[ee,C.value.fileName]]),c[10]||(c[10]=e("span",{class:"ml-2"},".json",-1))])])])]),e("div",nV,[e("div",rV,[d.value.dataBaseExport?(t(),s("button",{key:0,onClick:z,class:"px-6 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",disabled:K.value,"aria-label":"匯出資料庫"},[K.value?(t(),s("span",uV,"匯出中...")):(t(),s("span",dV,"開始匯出"))],8,iV)):J("",!0),K.value?(t(),s("span",cV,"正在匯出資料，請勿關閉視窗...")):J("",!0),P.value?(t(),s("span",pV,"匯出成功！")):J("",!0),T.value?(t(),s("span",vV,"匯出失敗："+l(T.value),1)):J("",!0)]),K.value?(t(),s("div",mV,[e("div",bV,[e("div",fV,[c[13]||(c[13]=e("div",null,[e("span",{class:"text-xs font-semibold inline-block text-blue-600"}," 匯出進度 ")],-1)),e("div",yV,[e("span",gV,l($.value)+"% ",1)])]),e("div",xV,[e("div",{style:Xs({width:$.value+"%"}),class:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"},null,4)])])])):J("",!0)])])):J("",!0),x.value==="backup"?(t(),s("div",hV,[c[15]||(c[15]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold mb-2"},"資料庫備份"),e("p",{class:"text-gray-600"},"您可以點擊下方按鈕來備份整個資料庫，系統將會下載一個 SQL dump 檔案。")],-1)),e("div",wV,[e("div",_V,[d.value.dataBaseExport?(t(),s("button",{key:0,onClick:G,class:"px-6 py-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded",disabled:g.value,"aria-label":"備份資料庫"},[g.value?(t(),s("span",CV,"備份中...")):(t(),s("span",$V,"開始備份"))],8,kV)):J("",!0),g.value?(t(),s("span",EV,"正在處理備份，請稍候...")):J("",!0),a.value?(t(),s("span",SV,"備份檔案已開始下載！")):J("",!0),A.value?(t(),s("span",DV,"備份失敗："+l(A.value),1)):J("",!0)])])])):J("",!0)])])]))}},AV=Le(MV,[["__scopeId","data-v-79b50d50"]]),IV={class:"flex flex-col items-center p-6"},RV={class:"w-full max-w-[1500px]"},PV={class:"w-full max-w-[1500px]"},UV={class:"flex items-center space-x-4"},NV={class:"relative w-40"},TV={class:"w-full max-w-[1500px]"},VV={class:"overflow-x-auto"},jV={class:"w-full border-collapse"},LV={class:"border p-2 text-center"},FV={class:"border p-2 text-center"},qV={class:"border p-2 text-center"},OV={class:"border p-2 text-center"},BV={class:"flex justify-center space-x-2"},HV=["onClick"],WV=["onClick"],zV={key:0},KV={key:0,class:"flex justify-center items-center space-x-2 mt-6"},JV=["disabled"],YV=["onClick"],GV={key:1,class:"px-2"},QV=["disabled"],ZV={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},XV={class:"bg-white p-6 rounded-lg w-[500px] max-h-[90vh] overflow-y-auto"},ej={class:"flex justify-between items-center mb-4"},tj={class:"text-xl font-bold"},sj={class:"space-y-4 flex flex-col items-center"},aj={class:"flex items-center w-full max-w-[440px]"},oj={class:"flex-1"},lj=["value"],nj={class:"flex items-center w-full max-w-[440px]"},rj={class:"flex-1"},ij={class:"flex items-center w-full max-w-[440px]"},dj={class:"flex-1"},uj={class:"flex justify-end space-x-2 w-full max-w-[440px] mt-4"},cj=["disabled"],Ys=20,pj={__name:"Agency",setup(D){const x=m(""),d=m([]),u=m(1),C=m(1),o=m(0),N=m(!1),K=m(!1),$=m(!1),P=m({id:"",code:"",name:"",parentAgencyId:""}),T=m(null),z=m(""),g=m(!1),a=m({agencyCreate:!1,agencyUpdate:!1,agencyDelete:!1}),A=m([]),G=()=>{x.value=""},k=()=>{u.value=1,c()},c=async()=>{try{const _={page:u.value,limit:Ys,keyword:x.value||void 0},E=await ot.getAgencies(_);E.data.code===0?(d.value=E.data.data.list,o.value=E.data.data.totalCount,C.value=E.data.data.totalPage):(console.error("獲取機關列表失敗:",E.data.message),d.value=[],o.value=0,C.value=0,v.showError("獲取資料失敗",E.data.message||"無法獲取機關列表，請稍後再試"))}catch(_){console.error("獲取機關列表錯誤:",_),v.showError("獲取資料失敗","連接伺服器時發生錯誤，請稍後再試"),d.value=[],o.value=0,C.value=0}},b=_=>{u.value=_,c()},r=()=>{u.value>1&&(u.value--,c())},f=()=>{u.value<C.value&&(u.value++,c())},p=async()=>{K.value=!1,P.value={id:"",code:"",name:"",parentAgencyId:""};const _=await ot.getAgencies({limit:1e3});_.data.code===0&&(A.value=_.data.data.list.filter(E=>E.id!==P.value.id)),N.value=!0},w=async _=>{K.value=!0,P.value={id:_.id,code:_.code,name:_.name,parentAgencyId:_.parentAgencyId||""};const E=await ot.getAgencies({limit:1e3});E.data.code===0&&(A.value=E.data.data.list.filter(L=>L.id!==P.value.id)),N.value=!0},y=async _=>{if(T.value=_.id,z.value=_.name,await v.confirmAsync("確認刪除",`確定要刪除「${_.name}」嗎？此操作無法復原。`)){const L=await v.promptAsync("請輸入管理員密碼","請輸入您的密碼以驗證身份","password");if(L===null||L===""){T.value=null,z.value="";return}V(L)}else T.value=null,z.value=""},V=async _=>{if(T.value)try{if(g.value=!0,(await Xt.confirmPassword(_)).data.code!==0){v.showError("密碼錯誤","您輸入的密碼不正確，請重試"),g.value=!1,showDeleteConfirm.value=!1,T.value=null,z.value="";return}const L=await ot.deleteAgency(T.value);L.data.code===0?(v.showSuccess("刪除成功","機關已成功刪除"),c()):v.showError("刪除失敗",L.data.message||"刪除機關失敗，請稍後再試")}catch(E){console.error("刪除機關錯誤:",E),E.response&&E.response.config.url.includes("/confirmPwd")?v.showError("密碼驗證失敗","身份驗證過程中發生錯誤，請稍後再試"):v.showError("刪除失敗","刪除機關時發生錯誤，請稍後再試")}finally{g.value=!1,showDeleteConfirm.value=!1,T.value=null,z.value=""}},W=async()=>{if(!P.value.code||!P.value.name){v.showError("儲存失敗","請填寫所有必填欄位");return}try{$.value=!0;let _;K.value?_=await ot.updateAgency({id:P.value.id,code:P.value.code,name:P.value.name,parentAgencyId:P.value.parentAgencyId||null}):_=await ot.createAgency({code:P.value.code,name:P.value.name,parentAgencyId:P.value.parentAgencyId||null}),_.data.code===0?(v.showSuccess("儲存成功",`機關已成功${K.value?"更新":"新增"}`),N.value=!1,c()):v.showError("儲存失敗",_.data.message||`${K.value?"更新":"新增"}機關失敗，請稍後再試`)}catch(_){console.error(`${K.value?"更新":"新增"}機關錯誤:`,_),v.showError("儲存失敗","連接伺服器時發生錯誤，請稍後再試")}finally{$.value=!1}},O=async()=>{try{const _=await tt.getSidebarPermissions();_.data.code===0&&_.data.message==="success"?(a.value=_.data.data,console.log("機關管理頁面權限:",a.value)):console.error("獲取權限失敗:",_.data.message)}catch(_){console.error("獲取權限錯誤:",_)}};return je(()=>{O(),c()}),(_,E)=>(t(),s("div",IV,[e("div",RV,[Qe(pt,{breadcrumbs:[{name:"學員管理",path:"student/information"},{name:"機關管理",path:"/agency"}]})]),e("div",PV,[e("div",UV,[E[7]||(E[7]=e("span",null,"關鍵字搜尋:",-1)),e("div",NV,[I(e("input",{type:"text","onUpdate:modelValue":E[0]||(E[0]=L=>x.value=L),class:"p-2 border border-gray-300 outline-none focus:outline-none focus:border-gray-300 w-full",placeholder:"機關名稱/編號",readonly:"",onfocus:"this.removeAttribute('readonly');",onKeyup:Ne(k,["enter"])},null,544),[[ee,x.value]]),x.value?(t(),s("button",{key:0,onClick:G,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"},E[6]||(E[6]=[e("span",{class:"text-lg"},"×",-1)]))):J("",!0)]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:k}," 查詢 "),E[8]||(E[8]=e("div",{class:"flex-1"},null,-1)),a.value.agencyCreate?(t(),s("button",{key:0,class:"ml-auto px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264]",onClick:p}," 新增機關 ")):J("",!0)])]),E[15]||(E[15]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-300 my-6"})],-1)),e("div",TV,[e("div",VV,[e("table",jV,[E[10]||(E[10]=e("thead",null,[e("tr",null,[e("th",{class:"border p-2 w-[80px]"},"序"),e("th",{class:"border p-2 w-[150px]"},"機關編號"),e("th",{class:"border p-2"},"機關名稱"),e("th",{class:"border p-2 w-[150px]"},"操作")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(d.value,(L,j)=>(t(),s("tr",{key:L.id},[e("td",LV,l((u.value-1)*Ys+j+1),1),e("td",FV,l(L.code),1),e("td",qV,l(L.name),1),e("td",OV,[e("div",BV,[a.value.agencyUpdate?(t(),s("button",{key:0,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",onClick:R=>w(L)}," 編輯 ",8,HV)):J("",!0),a.value.agencyDelete?(t(),s("button",{key:1,class:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm",onClick:R=>y(L)}," 刪除 ",8,WV)):J("",!0)])])]))),128)),d.value.length===0?(t(),s("tr",zV,E[9]||(E[9]=[e("td",{colspan:"4",class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])])]),C.value>0?(t(),s("div",KV,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===1,onClick:r}," 上一頁 ",8,JV),(t(!0),s(Z,null,re(C.value,L=>(t(),s(Z,{key:L},[L===1||L===C.value||L>=u.value-2&&L<=u.value+2?(t(),s("button",{key:0,class:X(["px-3 py-1 border rounded",{"bg-[#4e9875] text-white":L===u.value}]),onClick:j=>b(L)},l(L),11,YV)):L===u.value-3||L===u.value+3?(t(),s("span",GV," ... ")):J("",!0)],64))),128)),e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:u.value===C.value,onClick:f}," 下一頁 ",8,QV)])):J("",!0)]),N.value?(t(),s("div",ZV,[e("div",XV,[e("div",ej,[e("h3",tj,l(K.value?"編輯機關":"新增機關"),1),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:E[1]||(E[1]=L=>N.value=!1)}," ✕ ")]),e("div",sj,[e("div",aj,[E[12]||(E[12]=e("span",{class:"w-24"},"上級機關:",-1)),e("div",oj,[I(e("select",{class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":E[2]||(E[2]=L=>P.value.parentAgencyId=L)},[E[11]||(E[11]=e("option",{value:""},"無上級機關",-1)),(t(!0),s(Z,null,re(A.value,L=>(t(),s("option",{key:L.id,value:L.id},l(L.name),9,lj))),128))],512),[[Pe,P.value.parentAgencyId]])])]),e("div",nj,[E[13]||(E[13]=e("span",{class:"w-24"},[xe("機關編號:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",rj,[I(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":E[3]||(E[3]=L=>P.value.code=L),required:"",placeholder:"請輸入機關編號"},null,512),[[ee,P.value.code]])])]),e("div",ij,[E[14]||(E[14]=e("span",{class:"w-24"},[xe("機關名稱:"),e("span",{class:"text-red-500"},"*")],-1)),e("div",dj,[I(e("input",{type:"text",class:"p-2 border border-gray-300 outline-none w-full","onUpdate:modelValue":E[4]||(E[4]=L=>P.value.name=L),required:"",placeholder:"請輸入機關名稱"},null,512),[[ee,P.value.name]])])]),e("div",uj,[e("button",{class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:E[5]||(E[5]=L=>N.value=!1)}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:W,disabled:$.value},l($.value?"儲存中...":"儲存"),9,cj)])])])])):J("",!0)]))}},vj=Le(pj,[["__scopeId","data-v-b85370a7"]]),ft={getConsultCount:D=>he.get("/v1/reportCollection/other/consultCount",{params:D}),getGovDetail:D=>he.get("/v1/reportCollection/student/govDetail",{params:D}),exportGovDetail:D=>he.get("/v1/reportCollection/course/student/govDetail/export",{params:D,responseType:"blob"}),getVocationalCourseParticipants:D=>he.get("/v1/reportCollection/course/studentTotal/career",{params:D}),exportVocationalCourseParticipants:D=>he.get("/v1/reportCollection/course/studentTotal/career/export",{params:D,responseType:"blob"}),getCreditCourseParticipants:D=>he.get("/v1/reportCollection/course/studentTotal/credit",{params:D}),exportCreditCourseParticipants:D=>he.get("/v1/reportCollection/course/studentTotal/credit/export",{params:D,responseType:"blob"}),getVocationalCourseCount:D=>he.get("/v1/reportCollection/course/courseTotal/career",{params:D}),exportVocationalCourseCount:D=>he.get("/v1/reportCollection/course/courseTotal/career/export",{params:D,responseType:"blob"}),getCreditCourseCount:D=>he.get("/v1/reportCollection/course/courseTotal/credit",{params:D}),getCreditWeekdayClassCount:D=>he.get("/v1/reportCollection/course/workdayTypeCount",{params:D}),exportCreditWeekdayClassCount:D=>he.get("/v1/reportCollection/course/workdayTypeCount/export",{params:D,responseType:"blob"}),getCreditWeekendClassCount:D=>he.get("/v1/reportCollection/course/holidayTypeCount",{params:D}),exportCreditWeekendClassCount:D=>he.get("/v1/reportCollection/course/holidayTypeCount/export",{params:D,responseType:"blob"}),getVocationalClassCount:D=>he.get("/v1/reportCollection/course/careerTypeCount",{params:D}),exportVocationalClassCount:D=>he.get("/v1/reportCollection/course/careerTypeCount/export",{params:D,responseType:"blob"}),getStudentCertificateCount:D=>he.get("/v1/reportCollection/student/certificateCount",{params:D}),exportStudentCertificateCount:D=>he.get("/v1/reportCollection/student/certificateCount/export",{params:D,responseType:"blob"}),getStudentProgressTracking:D=>he.get("/v1/reportCollection/student/progressTracking",{params:D}),exportStudentProgressTracking:D=>he.get("/v1/reportCollection/student/progressTracking/export",{params:D,responseType:"blob"}),getConsultType:D=>he.get("/v1/reportCollection/other/consultType",{params:D}),exportConsultCount:()=>he.get("/v1/reportCollection/other/consultCount/export",{responseType:"blob"}),exportMonthlyConsultationMethodStats:D=>he.get("/v1/reportCollection/other/consultType/export",{params:D,responseType:"blob"}),getStudentCourseCompletedStatus:D=>he.get("/v1/reportCollection/student/courseCompletdStatus",{params:D}),exportStudentCourseCompletedStatus:D=>he.get("/v1/reportCollection/student/courseCompletedStatus/export",{params:D,responseType:"blob"}),exportCreditCourseCount:D=>he.get("/v1/reportCollection/course/courseTotal/credit/export",{params:D,responseType:"blob"}),getFinanceAppropriationDetail:D=>he.get("/v1/reportCollection/finance/appropriationDetail",{params:D}),exportFinanceAppropriationDetail:D=>he.get("/v1/reportCollection/finance/appropriationDetail/export",{params:D,responseType:"blob"})},mj={class:"w-full max-w-[1500px] mb-6"},bj={class:"flex items-center space-x-4"},fj=["value"],yj=["value"],gj=["disabled"],xj={class:"w-full max-w-[1500px] mt-6"},hj={key:0,class:"flex justify-center items-center py-10"},wj={key:1,class:"w-full border-collapse table-fixed"},_j={class:"bg-[#EEEFE7]"},kj=["colspan","rowspan"],$j={key:0,class:"bg-[#EEEFE7]"},Cj=["rowspan"],Ej={key:0},Sj=["colspan"],Dj={__name:"CreditCourseCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]),N=We(),K=Se(()=>u.value||d.value!==""&&x.value===""),$=Se(()=>{const w=[];for(let y=1;y<=12;y++)w.push(y);return w}),P=Se(()=>{const w=[];for(let y=1;y<=31;y++)w.push(y);return w}),T=Se(()=>{const w=[];return C.value.forEach(y=>{y.children?w.push(...y.children):["area","schoolName"].includes(y.key)||w.push(y)}),w}),z=Se(()=>C.value.some(w=>w.children&&w.children.length>0)),g=m({reportAllExport:!1}),a=async()=>{try{const w=await tt.getSidebarPermissions();w.data.code===0&&w.data.message==="success"?(g.value=w.data.data,console.log("學分班開課數量統計頁面權限:",g.value)):console.error("獲取權限失敗:",w.data.message)}catch(w){console.error("獲取權限錯誤:",w)}},A=Se(()=>{const w=[];let y=null,V=0,W=-1;return!Array.isArray(o.value)||o.value.length===0?[]:(o.value.forEach((O,_)=>{const E={...O};E.type==="total"||E.type==="subtotal"?(E._display_area=!0,E._area_rowspan=1,y!==null&&W!==-1&&(w[W]._area_rowspan=V),y=null,V=0,W=-1):E.area&&E.area!==y?(y!==null&&W!==-1&&(w[W]._area_rowspan=V),y=E.area,V=1,W=w.length,E._display_area=!0):(V++,E._display_area=!1),w.push(E),_===o.value.length-1&&y!==null&&W!==-1&&(w[W]._area_rowspan=V)}),w)}),G=(w,y)=>{const V={border:!0,"p-2":!0,"text-center":!0};return w.type==="subtotal"?(V["bg-gray-200"]=!0,V["font-bold"]=!0):w.type==="total"&&(V["bg-orange-100"]=!0,V["font-bold"]=!0),V},k=(w,y,V)=>{let W=0;V.forEach(O=>{(O.xAxis||[]).forEach(_=>{const E=`${O.name}_${_}`;w[E]=y[W]??0,W++})}),w.total_courses=y[y.length-1]??0};Ee([x,d],()=>{r()});const c=()=>{if(K.value){d.value!==""&&x.value===""&&v.showError("錯誤","不能單獨搜尋日期，請選擇月份。");return}b()},b=async()=>{var w;u.value=!0;try{const y={};x.value!==""&&(y.month=parseInt(x.value)),d.value!==""&&(y.day=parseInt(d.value));const V=await ft.getCreditCourseCount(y);if(V.data.code===0&&V.data.data){const W=V.data.data,O=[],_=[];if(Array.isArray(W.xList)&&W.xList.forEach(L=>{if(Array.isArray(L.xAxis)){const j=[];let R=0;L.xAxis.forEach(U=>{j.push({label:U,key:`${L.name}_${U}`})}),R=j.length,O.push({label:L.name,key:`${L.name}_group`,colspan:R,children:j})}}),C.value=[{label:"區域",key:"area",rowspan:2},{label:"學校名稱",key:"schoolName",rowspan:2},...O,{label:"合計開課數量",key:"total_courses",rowspan:2,type:"total"}],Array.isArray(W.yList)&&Array.isArray(W.xData)){let L=0;W.yList.forEach((j,R)=>{if(j.name.includes("小計")){const U={area:j.name,schoolName:"",type:"subtotal",total_courses:0};Array.isArray(W.xData[L])&&k(U,W.xData[L],W.xList),_.push(U),L++}else Array.isArray(j.yAxis)&&j.yAxis.forEach((U,te)=>{const ue={area:te===0?j.name:"",schoolName:U,type:"data",total_courses:0};Array.isArray(W.xData[L])&&k(ue,W.xData[L],W.xList),_.push(ue),L++})})}const E={area:"總計",schoolName:"",type:"total",total_courses:Array.isArray(W.xAxisSums)?W.xAxisSums[W.xAxisSums.length-1]??0:0};Array.isArray(W.xAxisSums)&&k(E,W.xAxisSums,W.xList),_.push(E),o.value=_}else C.value=[],o.value=[],v.showError("查詢失敗",((w=V.data)==null?void 0:w.message)||"API 回傳異常")}catch(y){console.error("獲取報表數據錯誤:",y),C.value=[],o.value=[],v.showError("查詢失敗",(y==null?void 0:y.message)||"API 請求失敗")}finally{u.value=!1}},r=()=>{const w={month:x.value!==""?x.value:void 0,day:d.value!==""?d.value:void 0};Object.keys(w).forEach(y=>{w[y]===void 0&&delete w[y]}),N.replace({query:w})};je(()=>{const w=new URLSearchParams(window.location.search),y=w.get("month"),V=w.get("day");x.value=y?parseInt(y):"",d.value=V?parseInt(V):"",b(),Ee(()=>window.location.search,()=>{const W=new URLSearchParams(window.location.search),O=W.get("month"),_=W.get("day"),E=O?parseInt(O):"",L=_?parseInt(_):"";E!==x.value&&(x.value=E),L!==d.value&&(d.value=L)}),a()});const f=()=>{p()},p=async()=>{try{const w={month:x.value!==""?parseInt(x.value):void 0,day:d.value!==""?parseInt(d.value):void 0},y=await ft.exportCreditCourseCount(w),V=y.headers["content-type"];if(!V||!V.includes("spreadsheetml.sheet"))try{const L=new Blob([y.data],{type:"application/json"}),j=await new Response(L).text(),R=JSON.parse(j);console.error("匯出學分班開課數量統計失敗：伺服器返回錯誤：",R),v.showError("匯出失敗",R.message||"匯出過程中發生錯誤，請稍後再試");return}catch(L){console.error("匯出學分班開課數量統計失敗：無法解析回應內容",L),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const W=new Blob([y.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),O=window.URL.createObjectURL(W),_=document.createElement("a");_.href=O;const E=`學分班開課數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;_.setAttribute("download",E),document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(O),v.showSuccess("匯出成功","學分班開課數量統計已成功匯出為 Excel 檔案")}catch(w){if(console.error("匯出學分班開課數量統計失敗:",w),w.response&&w.response.data){const y=w.response.data;v.showError("匯出失敗",y.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(w,y)=>(t(),s("div",null,[y[7]||(y[7]=e("h3",{class:"text-xl font-bold mb-4"},"開課數量統計表(學分班)",-1)),e("div",mj,[e("div",bj,[y[4]||(y[4]=e("span",null,"查詢日期:",-1)),I(e("select",{id:"searchMonth","onUpdate:modelValue":y[0]||(y[0]=V=>x.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(c,["enter"])},[y[2]||(y[2]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(Z,null,re($.value,V=>(t(),s("option",{key:V,value:V},l(V)+"月 ",9,fj))),128))],544),[[Pe,x.value]]),I(e("select",{id:"searchDay","onUpdate:modelValue":y[1]||(y[1]=V=>d.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(c,["enter"])},[y[3]||(y[3]=e("option",{value:""},"請選擇日",-1)),(t(!0),s(Z,null,re(P.value,V=>(t(),s("option",{key:V,value:V},l(V)+"日 ",9,yj))),128))],544),[[Pe,d.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:c,disabled:K.value,"aria-label":"查詢開課數量"}," 搜尋 ",8,gj),y[5]||(y[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:f}," 匯出 Excel ")):J("",!0)])]),e("div",xj,[u.value?(t(),s("div",hj,y[6]||(y[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",wj,[e("thead",null,[e("tr",_j,[(t(!0),s(Z,null,re(C.value,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":V.type==="subtotal"||V.type==="total"}])},l(V.label),11,kj))),128))]),z.value?(t(),s("tr",$j,[(t(!0),s(Z,null,re(C.value,V=>(t(),s(Z,{key:V.key},[V.children?(t(!0),s(Z,{key:0},re(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(A.value,(V,W)=>(t(),s("tr",{key:W,class:X(G(V))},[V._display_area?(t(),s("td",{key:0,rowspan:V._area_rowspan,class:X(G(V))},l(V.area),11,Cj)):J("",!0),e("td",{class:X(G(V))},l(V.schoolName),3),(t(!0),s(Z,null,re(T.value,O=>(t(),s("td",{key:O.key,class:X(G(V))},l(V[O.key]),3))),128))],2))),128)),o.value.length===0?(t(),s("tr",Ej,[e("td",{colspan:T.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,Sj)])):J("",!0)])]))])]))}},Mj=Le(Dj,[["__scopeId","data-v-488e6fca"]]),Aj={class:"w-full max-w-[1500px] mb-6"},Ij={class:"flex items-center space-x-4"},Rj=["value"],Pj=["value"],Uj=["disabled"],Nj={class:"w-full max-w-[1500px] mt-6"},Tj={key:0,class:"flex justify-center items-center py-10"},Vj={key:1,class:"w-full border-collapse table-fixed"},jj={class:"bg-[#EEEFE7]"},Lj=["colspan","rowspan"],Fj={key:0,class:"bg-[#EEEFE7]"},qj=["rowspan"],Oj={key:0},Bj=["colspan"],Hj={__name:"VocationalCourseCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]),N=We(),K=Se(()=>u.value||d.value!==""&&x.value===""),$=Se(()=>{const w=[];for(let y=1;y<=12;y++)w.push(y);return w}),P=Se(()=>{const w=[];if(x.value!==""){const y=new Date().getFullYear()-1911,V=x.value,W=new Date(y,V,0).getDate();for(let O=1;O<=W;O++)w.push(O)}else for(let y=1;y<=31;y++)w.push(y);return w}),T=Se(()=>{const w=[];return C.value.forEach(y=>{y.children?w.push(...y.children):["area","schoolName"].includes(y.key)||w.push(y)}),w}),z=Se(()=>C.value.some(w=>w.children&&w.children.length>0)),g=m({reportAllExport:!1}),a=async()=>{try{const w=await tt.getSidebarPermissions();w.data.code===0&&w.data.message==="success"?(g.value=w.data.data,console.log("職能班開課數量統計頁面權限:",g.value.reportAllExport)):console.error("獲取權限失敗:",w.data.message)}catch(w){console.error("獲取權限錯誤:",w)}},A=Se(()=>{const w=[];let y=null,V=0,W=-1;return!Array.isArray(o.value)||o.value.length===0?[]:(o.value.forEach((O,_)=>{const E={...O};E.type==="total"||E.type==="subtotal"?(E._display_area=!0,E._area_rowspan=1,y!==null&&W!==-1&&(w[W]._area_rowspan=V),y=null,V=0,W=-1):E.area&&E.area!==y?(y!==null&&W!==-1&&(w[W]._area_rowspan=V),y=E.area,V=1,W=w.length,E._display_area=!0):(V++,E._display_area=!1),w.push(E),_===o.value.length-1&&y!==null&&W!==-1&&(w[W]._area_rowspan=V)}),w)}),G=(w,y)=>{const V={border:!0,"p-2":!0,"text-center":!0};return w.type==="subtotal"?(V["bg-gray-200"]=!0,V["font-bold"]=!0):w.type==="total"&&(V["bg-orange-100"]=!0,V["font-bold"]=!0),V};Ee([x,d],()=>{b()});const k=(w,y,V)=>{let W=0;V.forEach(O=>{(O.xAxis||[]).forEach(_=>{const E=`${O.name}_${_}`;w[E]=y[W]??0,W++})}),w.total_courses=y[y.length-1]??0},c=async()=>{var w;u.value=!0;try{const y={};x.value!==""&&(y.month=parseInt(x.value)),d.value!==""&&(y.day=parseInt(d.value));const V=await ft.getVocationalCourseCount(y);if(V.data.code===0&&V.data.data){const W=V.data.data,O=[],_=[];if(Array.isArray(W.xList)&&W.xList.forEach(L=>{if(Array.isArray(L.xAxis)){const j=L.xAxis.map(R=>({label:R,key:`${L.name}_${R}`}));O.push({label:L.name,key:`${L.name}_group`,colspan:j.length,children:j})}}),C.value=[{label:"區域",key:"area",rowspan:2},{label:"學校名稱",key:"schoolName",rowspan:2},...O,{label:"合計開課數量",key:"total_courses",rowspan:2,type:"total"}],Array.isArray(W.yList)&&Array.isArray(W.xData)){let L=0;W.yList.forEach((j,R)=>{if(j.name.includes("小計")){const U={area:j.name,schoolName:"",type:"subtotal",total_courses:0};Array.isArray(W.xData[L])&&k(U,W.xData[L],W.xList),_.push(U),L++}else Array.isArray(j.yAxis)&&j.yAxis.forEach((U,te)=>{const ue={area:te===0?j.name:"",schoolName:U,type:"data",total_courses:0};Array.isArray(W.xData[L])&&k(ue,W.xData[L],W.xList),_.push(ue),L++})})}const E={area:"總計",schoolName:"",type:"total",total_courses:Array.isArray(W.xAxisSums)?W.xAxisSums[W.xAxisSums.length-1]??0:0};Array.isArray(W.xAxisSums)&&k(E,W.xAxisSums,W.xList),_.push(E),o.value=_}else C.value=[],o.value=[],v.showError("查詢失敗",((w=V.data)==null?void 0:w.message)||"API 回傳異常")}catch(y){console.error("獲取報表數據錯誤:",y),C.value=[],o.value=[],v.showError("查詢失敗",(y==null?void 0:y.message)||"API 請求失敗")}finally{u.value=!1}},b=()=>{const w={month:x.value!==""?x.value:void 0,day:d.value!==""?d.value:void 0};Object.keys(w).forEach(y=>{w[y]===void 0&&delete w[y]}),N.replace({query:w})},r=()=>{if(K.value){v.showError("請選擇月份和日期");return}b(),c()};je(()=>{const w=new URLSearchParams(window.location.search),y=w.get("month"),V=w.get("day");x.value=y?parseInt(y):"",d.value=V?parseInt(V):"",c(),Ee(()=>window.location.search,()=>{const W=new URLSearchParams(window.location.search),O=W.get("month"),_=W.get("day"),E=O?parseInt(O):"",L=_?parseInt(_):"";E!==x.value&&(x.value=E),L!==d.value&&(d.value=L)}),a()});const f=()=>{p()},p=async()=>{try{const w={month:x.value!==""?parseInt(x.value):void 0,day:d.value!==""?parseInt(d.value):void 0},y=await ft.exportVocationalCourseCount(w),V=y.headers["content-type"];if(!V||!V.includes("spreadsheetml.sheet"))try{const L=new Blob([y.data],{type:"application/json"}),j=await new Response(L).text(),R=JSON.parse(j);console.error("匯出職能班開課數量統計失敗：伺服器返回錯誤：",R),v.showError("匯出失敗",R.message||"匯出過程中發生錯誤，請稍後再試");return}catch(L){console.error("匯出職能班開課數量統計失敗：無法解析回應內容",L),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const W=new Blob([y.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),O=window.URL.createObjectURL(W),_=document.createElement("a");_.href=O;const E=`職能班開課數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;_.setAttribute("download",E),document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(O),v.showSuccess("匯出成功","職能班開課數量統計已成功匯出為 Excel 檔案")}catch(w){if(console.error("匯出職能班開課數量統計失敗:",w),w.response&&w.response.data){const y=w.response.data;v.showError("匯出失敗",y.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(w,y)=>(t(),s("div",null,[y[7]||(y[7]=e("h3",{class:"text-xl font-bold mb-4"},"開課數量統計表(職能班)",-1)),e("div",Aj,[e("div",Ij,[y[4]||(y[4]=e("span",null,"查詢日期:",-1)),I(e("select",{"onUpdate:modelValue":y[0]||(y[0]=V=>x.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(r,["enter"])},[y[2]||(y[2]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(Z,null,re($.value,V=>(t(),s("option",{key:V,value:V},l(V)+"月 ",9,Rj))),128))],544),[[Pe,x.value]]),I(e("select",{"onUpdate:modelValue":y[1]||(y[1]=V=>d.value=V),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(r,["enter"])},[y[3]||(y[3]=e("option",{value:""},"請選擇日",-1)),(t(!0),s(Z,null,re(P.value,V=>(t(),s("option",{key:V,value:V},l(V)+"日 ",9,Pj))),128))],544),[[Pe,d.value]]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:r,disabled:K.value,"aria-label":"查詢開課數量"}," 搜尋 ",8,Uj),y[5]||(y[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:f}," 匯出 Excel ")):J("",!0)])]),e("div",Nj,[u.value?(t(),s("div",Tj,y[6]||(y[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Vj,[e("thead",null,[e("tr",jj,[(t(!0),s(Z,null,re(C.value,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":V.type==="subtotal"||V.type==="total"}])},l(V.label),11,Lj))),128))]),z.value?(t(),s("tr",Fj,[(t(!0),s(Z,null,re(C.value,V=>(t(),s(Z,{key:V.key},[V.children?(t(!0),s(Z,{key:0},re(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(A.value,(V,W)=>(t(),s("tr",{key:W,class:X(G(V))},[V._display_area?(t(),s("td",{key:0,rowspan:V._area_rowspan,class:X(G(V))},l(V.area),11,qj)):J("",!0),e("td",{class:X(G(V))},l(V.schoolName),3),(t(!0),s(Z,null,re(T.value,O=>(t(),s("td",{key:O.key,class:X(G(V))},l(V[O.key]),3))),128))],2))),128)),o.value.length===0?(t(),s("tr",Oj,[e("td",{colspan:T.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,Bj)])):J("",!0)])]))])]))}},Wj=Le(Hj,[["__scopeId","data-v-957d8093"]]),zj={class:"w-full max-w-[1500px] mt-4"},Kj={class:"flex items-center space-x-4"},Jj={class:"flex items-center space-x-2"},Yj={class:"flex items-center space-x-2"},Gj=["disabled"],Qj={class:"w-full max-w-[1500px] mt-6"},Zj={key:0,class:"flex justify-center items-center py-10"},Xj={key:1,class:"w-full border-collapse table-fixed"},eL={class:"bg-[#EEEFE7]"},tL=["colspan","rowspan"],sL={key:0,class:"bg-[#EEEFE7]"},aL=["colspan","rowspan"],oL={key:1,class:"bg-[#EEEFE7]"},lL=["rowspan"],nL=["rowspan"],rL={key:0},iL=["colspan"],dL={__name:"CreditCourseParticipants",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const f=[];return C.value.forEach(p=>{p.children?p.children.forEach(w=>{w.children?f.push(...w.children):f.push(w)}):["item_no","region_type","university_name","total","region_total_col"].includes(p.key)||f.push(p)}),f}),$=Se(()=>C.value.some(f=>f.children&&f.children.length>0)),P=Se(()=>C.value.some(f=>f.children&&f.children.some(p=>p.children&&p.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const f=await tt.getSidebarPermissions();f.data.code===0&&f.data.message==="success"?(T.value=f.data.data,console.log("學分班課程參訓人數統計頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",f.data.message)}catch(f){console.error("獲取權限錯誤:",f)}},g=Se(()=>{const f=[];let p=null,w=0,y=-1;return o.value.forEach((V,W)=>{const O={...V};O.type==="total"?(O._display_region=!1,O._display_item_no=!1,O._region_rowspan=1,p!==null&&y!==-1&&(f[y]._region_rowspan=w),p=null,w=0,y=-1):O.region_type!==""&&O.region_type!==p?(p!==null&&y!==-1&&(f[y]._region_rowspan=w),p=O.region_type,w=1,y=f.length,O._display_region=!0,O._display_item_no=!0):(w++,O._display_region=!1,O._display_item_no=!0),f.push(O),W===o.value.length-1&&p!==null&&y!==-1&&(f[y]._region_rowspan=w)}),f}),a=(f,p)=>{const w={border:!0,"p-2":!0,"text-center":!0};return f.type==="total"&&(w["bg-orange-100"]=!0,w["font-bold"]=!0),w},A=()=>{x.value="",d.value="",c(),k()},G=()=>{k()},k=async()=>{var f;u.value=!0;try{const p={};x.value&&d.value&&(p.dateRange=[x.value,d.value]);const w=await ft.getCreditCourseParticipants(p);if(w.data.code===0&&w.data.data){const y=w.data.data,V=Array.isArray(y.xAxis)?y.xAxis.map((j,R)=>({label:j,key:`course_${R+1}`})):[],W=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/參訓人數",key:"course_participants_main",colspan:V.length,children:V},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=W;const O=[];let _=1,E=0;Array.isArray(y.yList)&&Array.isArray(y.xData)&&y.yList.forEach((j,R)=>{Array.isArray(j.yAxis)&&j.yAxis.forEach((U,te)=>{const ue={item_no:_++,region_type:te===0?j.name:"",university_name:U},ye=Array.isArray(y.xData[E])?y.xData[E]:[];(y.xAxis||[]).forEach((De,$e)=>{ue[`course_${$e+1}`]=ye[$e]??0}),ue.total=Array.isArray(y.yAxisSums)?y.yAxisSums[E]??0:0;let ke="";te===0&&(ke=Array.isArray(y.groupByTotal)?y.groupByTotal[R]??0:0),ue.region_total_col=ke,O.push(ue),E++})});const L={type:"total"};L.item_no="",L.region_type="",L.university_name="",(y.xAxis||[]).forEach((j,R)=>{L[`course_${R+1}`]=Array.isArray(y.xAxisSums)?y.xAxisSums[R]??0:0}),L.total=y.total??0,L.region_total_col="",O.push(L),o.value=O}else C.value=[],o.value=[],v.showError("查詢失敗",((f=w.data)==null?void 0:f.message)||"API 回傳異常")}catch(p){C.value=[],o.value=[],v.showError("查詢失敗",(p==null?void 0:p.message)||"API 請求失敗")}finally{u.value=!1}},c=()=>{const f={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(f).forEach(p=>{f[p]===void 0&&delete f[p]}),N.replace({query:f})};je(()=>{const f=new URLSearchParams(window.location.search),p=f.get("startDate"),w=f.get("endDate");p&&(x.value=p),w&&(d.value=w),k(),Ee(()=>window.location.search,()=>{const y=new URLSearchParams(window.location.search),V=y.get("startDate"),W=y.get("endDate");V!==x.value&&(x.value=V||""),W!==d.value&&(d.value=W||""),k()}),z()});const b=()=>{r()},r=async()=>{try{const f={dateRange:x.value&&d.value?[x.value,d.value]:void 0},p=await ft.exportCreditCourseParticipants(f),w=p.headers["content-type"];if(!w||!w.includes("spreadsheetml.sheet"))try{const _=new Blob([p.data],{type:"application/json"}),E=await new Response(_).text(),L=JSON.parse(E);console.error("匯出學分班課程參訓人數統計失敗：伺服器返回錯誤：",L),v.showError("匯出失敗",L.message||"匯出過程中發生錯誤，請稍後再試");return}catch(_){console.error("匯出學分班課程參訓人數統計失敗：無法解析回應內容",_),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const y=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL(y),W=document.createElement("a");W.href=V;const O=`學分班課程參訓人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;W.setAttribute("download",O),document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(V),v.showSuccess("匯出成功","學分班課程參訓人數統計已成功匯出為 Excel 檔案")}catch(f){if(console.error("匯出學分班課程參訓人數統計失敗:",f),f.response&&f.response.data){const p=f.response.data;v.showError("匯出失敗",p.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(f,p)=>(t(),s("div",null,[p[7]||(p[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程參訓人數統計表",-1)),e("div",zj,[e("div",Kj,[p[4]||(p[4]=e("span",null,"查詢日期:",-1)),e("div",Jj,[p[2]||(p[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":p[0]||(p[0]=w=>x.value=w),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(G,["enter"])},null,34),[[ee,x.value]])]),e("div",Yj,[p[3]||(p[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":p[1]||(p[1]=w=>d.value=w),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(G,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:A,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:G,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,Gj),p[5]||(p[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:b}," 匯出 Excel ")):J("",!0)])]),e("div",Qj,[u.value?(t(),s("div",Zj,p[6]||(p[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Xj,[e("thead",null,[e("tr",eL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s("th",{key:w.key,colspan:w.colspan||1,rowspan:w.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":w.type==="subtotal"||w.type==="total"}])},l(w.label),11,tL))),128))]),$.value?(t(),s("tr",sL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s(Z,{key:w.key},[w.children?(t(!0),s(Z,{key:0},re(w.children,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:"border p-2 text-center"},l(y.label),9,aL))),128)):J("",!0)],64))),128))])):J("",!0),P.value?(t(),s("tr",oL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s(Z,{key:w.key},[w.children?(t(!0),s(Z,{key:0},re(w.children,y=>(t(),s(Z,{key:y.key},[(t(!0),s(Z,null,re(y.children,V=>(t(),s("th",{key:V.key,class:"border p-2 text-center"},l(V.label),1))),128))],64))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(g.value,(w,y)=>(t(),s(Z,{key:y},[w.type==="total"?(t(),s("tr",{key:0,class:X(a(w))},[e("td",{colspan:"3",class:X(a(w))},"總計",2),(t(!0),s(Z,null,re(K.value,V=>(t(),s("td",{key:V.key,class:X(a(w))},l(w[V.key]),3))),128)),e("td",{class:X(a(w))},l(w.total),3),e("td",{class:X(a(w))},l(w.region_total_col),3)],2)):(t(),s("tr",{key:1,class:X(a(w))},[w._display_item_no?(t(),s("td",{key:0,class:X(a(w))},l(w.item_no),3)):J("",!0),w._display_region?(t(),s("td",{key:1,rowspan:w._region_rowspan,class:X(a(w))},l(w.region_type),11,lL)):J("",!0),e("td",{class:X(a(w))},l(w.university_name),3),(t(!0),s(Z,null,re(K.value,V=>(t(),s(Z,{key:V.key},[V.key.startsWith("course_")?(t(),s("td",{key:0,class:X(a(w))},l(w[V.key]),3)):J("",!0)],64))),128)),e("td",{class:X(a(w))},l(w.total),3),w._display_region?(t(),s("td",{key:2,rowspan:w._region_rowspan,class:X(a(w))},l(w.region_total_col),11,nL)):J("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",rL,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,iL)])):J("",!0)])]))])]))}},uL=Le(dL,[["__scopeId","data-v-e9149593"]]),cL={class:"w-full max-w-[1500px] mt-4"},pL={class:"flex items-center space-x-4"},vL={class:"flex items-center space-x-2"},mL={class:"flex items-center space-x-2"},bL=["disabled"],fL={class:"w-full max-w-[1500px] mt-6"},yL={key:0,class:"flex justify-center items-center py-10"},gL={key:1,class:"w-full border-collapse table-fixed"},xL={class:"bg-[#EEEFE7]"},hL=["colspan","rowspan"],wL={key:0,class:"bg-[#EEEFE7]"},_L=["colspan","rowspan"],kL={key:1,class:"bg-[#EEEFE7]"},$L=["rowspan"],CL=["rowspan"],EL={key:0},SL=["colspan"],DL={__name:"VocationalCourseParticipants",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const f=[];return C.value.forEach(p=>{p.children?p.children.forEach(w=>{w.children?f.push(...w.children):f.push(w)}):["item_no","region_type","university_name","total","region_total_col"].includes(p.key)||f.push(p)}),f}),$=Se(()=>C.value.some(f=>f.children&&f.children.length>0)),P=Se(()=>C.value.some(f=>f.children&&f.children.some(p=>p.children&&p.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const f=await tt.getSidebarPermissions();f.data.code===0&&f.data.message==="success"?(T.value=f.data.data,console.log("職能班課程參訓人數統計頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",f.data.message)}catch(f){console.error("獲取權限錯誤:",f)}},g=Se(()=>{const f=[];let p=null,w=0,y=-1;return o.value.forEach((V,W)=>{const O={...V};O.type==="total"?(O._display_region=!1,O._display_item_no=!1,O._region_rowspan=1,p!==null&&y!==-1&&(f[y]._region_rowspan=w),p=null,w=0,y=-1):O.region_type!==""&&O.region_type!==p?(p!==null&&y!==-1&&(f[y]._region_rowspan=w),p=O.region_type,w=1,y=f.length,O._display_region=!0,O._display_item_no=!0):(w++,O._display_region=!1,O._display_item_no=!0),f.push(O),W===o.value.length-1&&p!==null&&y!==-1&&(f[y]._region_rowspan=w)}),f}),a=(f,p)=>{const w={border:!0,"p-2":!0,"text-center":!0};return f.type==="total"&&(w["bg-orange-100"]=!0,w["font-bold"]=!0),w},A=()=>{x.value="",d.value="",c(),k()},G=()=>{k()},k=async()=>{var f;u.value=!0;try{const p={};x.value&&d.value&&(p.dateRange=[x.value,d.value]);const w=await ft.getVocationalCourseParticipants(p);if(w.data.code===0&&w.data.data){const y=w.data.data,V=Array.isArray(y.xAxis)?y.xAxis.map((j,R)=>({label:j,key:`course_${R+1}`})):[],W=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/參訓人數",key:"course_participants_main",colspan:V.length,children:V},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=W;const O=[];let _=1,E=0;Array.isArray(y.yList)&&Array.isArray(y.xData)&&y.yList.forEach((j,R)=>{Array.isArray(j.yAxis)&&j.yAxis.forEach((U,te)=>{const ue={item_no:_++,region_type:te===0?j.name:"",university_name:U},ye=Array.isArray(y.xData[E])?y.xData[E]:[];(y.xAxis||[]).forEach((De,$e)=>{ue[`course_${$e+1}`]=ye[$e]??0}),ue.total=Array.isArray(y.yAxisSums)?y.yAxisSums[E]??0:0;let ke="";te===0&&(ke=Array.isArray(y.groupByTotal)?y.groupByTotal[R]??0:0),ue.region_total_col=ke,O.push(ue),E++})});const L={type:"total"};L.item_no="",L.region_type="",L.university_name="",(y.xAxis||[]).forEach((j,R)=>{L[`course_${R+1}`]=Array.isArray(y.xAxisSums)?y.xAxisSums[R]??0:0}),L.total=y.total??0,L.region_total_col="",O.push(L),o.value=O}else C.value=[],o.value=[],v.showError("查詢失敗",((f=w.data)==null?void 0:f.message)||"API 回傳異常")}catch(p){C.value=[],o.value=[],v.showError("查詢失敗",(p==null?void 0:p.message)||"API 請求失敗")}finally{u.value=!1}},c=()=>{const f={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(f).forEach(p=>{f[p]===void 0&&delete f[p]}),N.replace({query:f})};je(()=>{const f=new URLSearchParams(window.location.search),p=f.get("startDate"),w=f.get("endDate");p&&(x.value=p),w&&(d.value=w),k(),Ee(()=>window.location.search,()=>{const y=new URLSearchParams(window.location.search),V=y.get("startDate"),W=y.get("endDate");V!==x.value&&(x.value=V||""),W!==d.value&&(d.value=W||""),k()}),z()});const b=()=>{r()},r=async()=>{try{const f={dateRange:x.value&&d.value?[x.value,d.value]:void 0},p=await ft.exportVocationalCourseParticipants(f),w=p.headers["content-type"];if(!w||!w.includes("spreadsheetml.sheet"))try{const _=new Blob([p.data],{type:"application/json"}),E=await new Response(_).text(),L=JSON.parse(E);console.error("匯出職能班課程參訓人數統計失敗：伺服器返回錯誤：",L),v.showError("匯出失敗",L.message||"匯出過程中發生錯誤，請稍後再試");return}catch(_){console.error("匯出職能班課程參訓人數統計失敗：無法解析回應內容",_),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const y=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL(y),W=document.createElement("a");W.href=V;const O=`職能班課程參訓人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;W.setAttribute("download",O),document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(V),v.showSuccess("匯出成功","職能班課程參訓人數統計已成功匯出為 Excel 檔案")}catch(f){if(console.error("匯出職能班課程參訓人數統計失敗:",f),f.response&&f.response.data){const p=f.response.data;v.showError("匯出失敗",p.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(f,p)=>(t(),s("div",null,[p[7]||(p[7]=e("h3",{class:"text-xl font-bold mb-4"},"職能班課程參訓人數統計表",-1)),e("div",cL,[e("div",pL,[p[4]||(p[4]=e("span",null,"查詢日期:",-1)),e("div",vL,[p[2]||(p[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":p[0]||(p[0]=w=>x.value=w),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(G,["enter"])},null,34),[[ee,x.value]])]),e("div",mL,[p[3]||(p[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":p[1]||(p[1]=w=>d.value=w),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(G,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:A,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:G,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,bL),p[5]||(p[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:b}," 匯出 Excel ")):J("",!0)])]),e("div",fL,[u.value?(t(),s("div",yL,p[6]||(p[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",gL,[e("thead",null,[e("tr",xL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s("th",{key:w.key,colspan:w.colspan||1,rowspan:w.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":w.type==="subtotal"||w.type==="total"}])},l(w.label),11,hL))),128))]),$.value?(t(),s("tr",wL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s(Z,{key:w.key},[w.children?(t(!0),s(Z,{key:0},re(w.children,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:"border p-2 text-center"},l(y.label),9,_L))),128)):J("",!0)],64))),128))])):J("",!0),P.value?(t(),s("tr",kL,[(t(!0),s(Z,null,re(C.value,w=>(t(),s(Z,{key:w.key},[w.children?(t(!0),s(Z,{key:0},re(w.children,y=>(t(),s(Z,{key:y.key},[(t(!0),s(Z,null,re(y.children,V=>(t(),s("th",{key:V.key,class:"border p-2 text-center"},l(V.label),1))),128))],64))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(g.value,(w,y)=>(t(),s(Z,{key:y},[w.type==="total"?(t(),s("tr",{key:0,class:X(a(w))},[e("td",{colspan:"3",class:X(a(w))},"總計",2),(t(!0),s(Z,null,re(K.value,V=>(t(),s("td",{key:V.key,class:X(a(w))},l(w[V.key]),3))),128)),e("td",{class:X(a(w))},l(w.total),3),e("td",{class:X(a(w))},l(w.region_total_col),3)],2)):(t(),s("tr",{key:1,class:X(a(w))},[w._display_item_no?(t(),s("td",{key:0,class:X(a(w))},l(w.item_no),3)):J("",!0),w._display_region?(t(),s("td",{key:1,rowspan:w._region_rowspan,class:X(a(w))},l(w.region_type),11,$L)):J("",!0),e("td",{class:X(a(w))},l(w.university_name),3),(t(!0),s(Z,null,re(K.value,V=>(t(),s(Z,{key:V.key},[V.key.startsWith("course_")?(t(),s("td",{key:0,class:X(a(w))},l(w[V.key]),3)):J("",!0)],64))),128)),e("td",{class:X(a(w))},l(w.total),3),w._display_region?(t(),s("td",{key:2,rowspan:w._region_rowspan,class:X(a(w))},l(w.region_total_col),11,CL)):J("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",EL,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,SL)])):J("",!0)])]))])]))}},ML=Le(DL,[["__scopeId","data-v-d7f373d0"]]),AL={class:"w-full max-w-[1500px] mt-4"},IL={class:"flex items-center space-x-4"},RL={class:"flex items-center space-x-2"},PL={class:"flex items-center space-x-2"},UL=["disabled"],NL={class:"w-full max-w-[1500px] mt-6"},TL={key:0,class:"flex justify-center items-center py-10"},VL={key:1,class:"w-full border-collapse table-fixed"},jL={class:"bg-[#EEEFE7]"},LL=["colspan","rowspan"],FL={class:"bg-[#EEEFE7]"},qL={class:"border p-2 text-center"},OL={class:"border p-2 text-center"},BL={class:"border p-2 text-center"},HL={class:"border p-2 text-center"},WL={class:"border p-2 text-center"},zL={class:"border p-2 text-center"},KL={class:"border p-2 text-center"},JL={class:"border p-2 text-center"},YL={key:0},GL=["colspan"],QL={__name:"AgencyParticipants",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const k=[];return C.value.forEach(c=>{c.children?k.push(...c.children):k.push(c)}),k}),$=m({reportAllExport:!1}),P=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?($.value=k.data.data,console.log("機關參訓人數統計表頁面權限:",$.value.reportAllExport)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},T=()=>{x.value="",d.value="",a(),g()},z=()=>{g()},g=async()=>{var k;u.value=!0;try{const c={};x.value&&d.value&&(c.dateRange=[x.value,d.value]);const b=await ft.getGovDetail(c);if(b.data.code===0&&b.data.data&&Array.isArray(b.data.data.list)){const r=[{label:"序號",key:"item_no",rowspan:2},{label:"機關名稱",key:"agency_name",rowspan:2},{label:"機關薦派",key:"recommended",colspan:2,children:[{label:"參訓人數",key:"recommended_participants"},{label:"取消人數",key:"recommended_cancelled"}]},{label:"自行報名",key:"self_report",colspan:2,children:[{label:"參訓人數",key:"self_report_participants"},{label:"取消人數",key:"self_report_cancelled"}]},{label:"合計",key:"total",colspan:2,children:[{label:"參訓人數",key:"total_participants"},{label:"取消人數",key:"total_cancelled"}]}];C.value=r,o.value=b.data.data.list.map((f,p,w)=>({item_no:p===w.length-1?"":p+1,agency_name:f.name,recommended_participants:f.assigned??0,recommended_cancelled:f.assignedCancelled??0,self_report_participants:f.self??0,self_report_cancelled:f.selfCancelled??0,total_participants:f.total??0,total_cancelled:f.totalCancelled??0}))}else C.value=[],o.value=[],v.showError("查詢失敗",((k=b.data)==null?void 0:k.message)||"API 回傳異常")}catch(c){C.value=[],o.value=[],v.showError("查詢失敗",(c==null?void 0:c.message)||"API 請求失敗")}finally{u.value=!1}},a=()=>{const k={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(k).forEach(c=>{k[c]===void 0&&delete k[c]}),N.replace({query:k})};je(()=>{const k=new URLSearchParams(window.location.search),c=k.get("startDate"),b=k.get("endDate");c&&(x.value=c),b&&(d.value=b),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),f=r.get("startDate"),p=r.get("endDate");f!==x.value&&(x.value=f||""),p!==d.value&&(d.value=p||""),g()}),P()});const A=()=>{G()},G=async()=>{try{const k={dateRange:x.value&&d.value?[x.value,d.value]:void 0},c=await ft.exportGovDetail(k),b=c.headers["content-type"];if(!b||!b.includes("spreadsheetml.sheet"))try{const y=new Blob([c.data],{type:"application/json"}),V=await new Response(y).text(),W=JSON.parse(V);console.error("匯出機關參訓人數統計表失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(y){console.error("匯出機關參訓人數統計表失敗：無法解析回應內容",y),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(r),p=document.createElement("a");p.href=f;const w=`機關參訓人數統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",w),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(f),v.showSuccess("匯出成功","機關參訓人數統計表已成功匯出為 Excel 檔案")}catch(k){if(console.error("匯出機關參訓人數統計表失敗:",k),k.response&&k.response.data){const c=k.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(k,c)=>(t(),s("div",null,[c[7]||(c[7]=e("h3",{class:"text-xl font-bold mb-4"},"機關參訓人數統計表",-1)),e("div",AL,[e("div",IL,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",RL,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=b=>x.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(z,["enter"])},null,34),[[ee,x.value]])]),e("div",PL,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=b=>d.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(z,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:T,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:z,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,UL),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),$.value&&$.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:A}," 匯出 Excel ")):J("",!0)])]),e("div",NL,[u.value?(t(),s("div",TL,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",VL,[e("thead",null,[e("tr",jL,[(t(!0),s(Z,null,re(C.value,b=>(t(),s("th",{key:b.key,colspan:b.colspan||1,rowspan:b.rowspan||1,class:"border p-2 text-center"},l(b.label),9,LL))),128))]),e("tr",FL,[(t(!0),s(Z,null,re(C.value,b=>(t(),s(Z,{key:b.key},[b.children?(t(!0),s(Z,{key:0},re(b.children,r=>(t(),s("th",{key:r.key,class:"border p-2 text-center"},l(r.label),1))),128)):J("",!0)],64))),128))])]),e("tbody",null,[(t(!0),s(Z,null,re(o.value,(b,r)=>(t(),s("tr",{key:r},[e("td",qL,l(b.item_no),1),e("td",OL,l(b.agency_name),1),e("td",BL,l(b.recommended_participants),1),e("td",HL,l(b.recommended_cancelled),1),e("td",WL,l(b.self_report_participants),1),e("td",zL,l(b.self_report_cancelled),1),e("td",KL,l(b.total_participants),1),e("td",JL,l(b.total_cancelled),1)]))),128)),o.value.length===0?(t(),s("tr",YL,[e("td",{colspan:K.value.length,class:"border p-4 text-center"},"無符合條件的資料",8,GL)])):J("",!0)])]))])]))}},ZL=Le(QL,[["__scopeId","data-v-f93c269b"]]),XL={class:"w-full max-w-[1500px] mb-6 flex justify-end"},eF={class:"w-full max-w-[1500px] mt-6"},tF={key:0,class:"flex justify-center items-center py-10"},sF={key:1,class:"w-full border-collapse table-fixed"},aF={class:"bg-[#EEEFE7]"},oF=["colspan","rowspan"],lF={class:"bg-[#EEEFE7]"},nF={class:"border p-2 text-center"},rF={key:0,class:"border p-2 text-center"},iF={class:"border p-2 text-center"},dF={key:0},uF=["colspan"],cF={__name:"ConsultationTypeStats",setup(D){const x=m(!1),d=m([]),u=m([]),C=m({reportAllExport:!1}),o=async()=>{try{const T=await tt.getSidebarPermissions();T.data.code===0&&T.data.message==="success"?(C.value=T.data.data,console.log("諮詢問題類型及服務人數統計表頁面權限:",C.value.reportAllExport)):console.error("獲取權限失敗:",T.data.message)}catch(T){console.error("獲取權限錯誤:",T)}},N=()=>{P()},K=Se(()=>{const T=[];return d.value.forEach(z=>{z.key==="question_type_service_count"&&z.children?T.push(...z.children):["year_month","total"].includes(z.key)||T.push(z)}),T}),$=async()=>{var T;x.value=!0;try{const z=await ft.getConsultCount();if(z.data.code===0&&z.data.data){const g=z.data.data,a=g.xAxis.map(c=>({label:c,key:c})),A=[{label:"年度/月份",key:"year_month",rowspan:2},{label:"問題類型/服務人數",key:"question_type_service_count",colspan:a.length,children:a},{label:"合計",key:"total",rowspan:2}];d.value=A;const G=[];g.yAxis.forEach((c,b)=>{const r={year_month:c};a.forEach((f,p)=>{r[f.key]=g.xData[b]?g.xData[b][p]:""}),r.total=g.yAxisSums[b]??0,G.push(r)});const k={year_month:"合計",type:"total"};a.forEach((c,b)=>{k[c.key]=g.xAxisSums[b]??0}),k.total=g.total??0,G.push(k),u.value=G}else console.error("獲取諮詢統計數據失敗:",((T=z.data)==null?void 0:T.message)||"未知錯誤"),d.value=[],u.value=[]}catch(z){console.error("獲取諮詢統計數據錯誤:",z),d.value=[],u.value=[]}finally{x.value=!1}};je(()=>{$(),o()});const P=async()=>{try{const T=await ft.exportConsultCount(),z=T.headers["content-type"];if(!z||!z.includes("spreadsheetml.sheet"))try{const k=new Blob([T.data],{type:"application/json"}),c=await new Response(k).text(),b=JSON.parse(c);console.error("匯出諮詢問題類型及服務人數統計失敗：伺服器返回錯誤：",b),v.showError("匯出失敗",b.message||"匯出過程中發生錯誤，請稍後再試");return}catch(k){console.error("匯出諮詢問題類型及服務人數統計失敗：無法解析回應內容",k),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const g=new Blob([T.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(g),A=document.createElement("a");A.href=a;const G=`諮詢問題類型及服務人數統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;A.setAttribute("download",G),document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(a),v.showSuccess("匯出成功","諮詢問題類型及服務人數統計已成功匯出為 Excel 檔案")}catch(T){if(console.error("匯出諮詢問題類型及服務人數統計失敗:",T),T.response&&T.response.data){const z=T.response.data;v.showError("匯出失敗",z.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(T,z)=>(t(),s("div",null,[z[1]||(z[1]=e("h3",{class:"text-xl font-bold mb-4"},"諮詢問題類型及服務人數統計表",-1)),e("div",XL,[C.value&&C.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:N,"aria-label":"匯出 Excel"}," 匯出 Excel ")):J("",!0)]),e("div",eF,[x.value?(t(),s("div",tF,z[0]||(z[0]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",sF,[e("thead",null,[e("tr",aF,[(t(!0),s(Z,null,re(d.value,g=>(t(),s("th",{key:g.key,colspan:g.colspan||1,rowspan:g.rowspan||1,class:"border p-2 text-center"},l(g.label),9,oF))),128))]),e("tr",lF,[(t(!0),s(Z,null,re(d.value,g=>(t(),s(Z,{key:g.key},[g.children?(t(!0),s(Z,{key:0},re(g.children,a=>(t(),s("th",{key:a.key,class:"border p-2 text-center"},l(a.label),1))),128)):J("",!0)],64))),128))])]),e("tbody",null,[(t(!0),s(Z,null,re(u.value,(g,a)=>(t(),s("tr",{key:a},[e("td",nF,l(g.year_month),1),(t(!0),s(Z,null,re(K.value,A=>(t(),s(Z,{key:A.key},[["year_month","total"].includes(A.key)?J("",!0):(t(),s("td",rF,l(g[A.key]),1))],64))),128)),e("td",iF,l(g.total),1)]))),128)),u.value.length===0?(t(),s("tr",dF,[e("td",{colspan:K.value.length+2,class:"border p-4 text-center"},"無符合條件的資料",8,uF)])):J("",!0)])]))])]))}},pF=Le(cF,[["__scopeId","data-v-3039d3ef"]]),vF={class:"w-full max-w-[1500px] mt-4"},mF={class:"flex items-center space-x-4"},bF={class:"flex items-center space-x-2"},fF={class:"flex items-center space-x-2"},yF=["disabled"],gF={class:"w-full max-w-[1500px] mt-6"},xF={key:0,class:"flex justify-center items-center py-10"},hF={key:1,class:"w-full border-collapse table-fixed"},wF={class:"bg-[#EEEFE7]"},_F=["colspan","rowspan"],kF={key:0,class:"bg-[#EEEFE7]"},$F=["colspan","rowspan"],CF={key:1,class:"bg-[#EEEFE7]"},EF=["rowspan"],SF=["rowspan"],DF={key:0},MF=["colspan"],AF={__name:"CreditWeekdayClassCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(w=>{w.children?w.children.forEach(y=>{y.children?p.push(...y.children):p.push(y)}):["item_no","region_type","university_name","total","region_total_col"].includes(w.key)||p.push(w)}),p}),$=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),P=Se(()=>C.value.some(p=>p.children&&p.children.some(w=>w.children&&w.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await tt.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("學分班課程開班數量（平日班）頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,w,y)=>y===0?Array.isArray(p.groupByTotal)?p.groupByTotal[w]??0:0:"",a=Se(()=>{const p=[];let w=null,y=0,V=-1;return o.value.forEach((W,O)=>{const _={...W};_.type==="total"?(_._display_region=!1,_._display_item_no=!1,_._region_rowspan=1,w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=null,y=0,V=-1):_.region_type!==""&&_.region_type!==w?(w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=_.region_type,y=1,V=p.length,_._display_region=!0,_._display_item_no=!0):(y++,_._display_region=!1,_._display_item_no=!0),p.push(_),O===o.value.length-1&&w!==null&&V!==-1&&(p[V]._region_rowspan=y)}),p}),A=(p,w)=>{const y={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(y["bg-orange-100"]=!0,y["font-bold"]=!0),y},G=()=>{x.value="",d.value="",b(),c()},k=()=>{c()},c=async()=>{var p;u.value=!0;try{const w={};x.value&&d.value&&(w.dateRange=[x.value,d.value]);const y=await ft.getCreditWeekdayClassCount(w);if(y.data.code===0&&y.data.data){const V=y.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((R,U)=>({label:R,key:`course_${U+1}`})):[],O=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=O;const _=[];let E=1,L=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((R,U)=>{Array.isArray(R.yAxis)&&R.yAxis.forEach((te,ue)=>{const ye={item_no:E++,region_type:ue===0?R.name:"",university_name:te},ke=Array.isArray(V.xData[L])?V.xData[L]:[];(V.xAxis||[]).forEach((De,$e)=>{ye[`course_${$e+1}`]=ke[$e]??0}),ye.total=Array.isArray(V.yAxisSums)?V.yAxisSums[L]??0:0,ye.region_total_col=g(V,U,ue),_.push(ye),L++})});const j={type:"total"};j.item_no="",j.region_type="",j.university_name="",(V.xAxis||[]).forEach((R,U)=>{j[`course_${U+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[U]??0:0}),j.total=V.total??0,j.region_total_col="",_.push(j),o.value=_}else C.value=[],o.value=[],v.showError("查詢失敗",((p=y.data)==null?void 0:p.message)||"API 回傳異常")}catch(w){C.value=[],o.value=[],v.showError("查詢失敗",(w==null?void 0:w.message)||"API 請求失敗")}finally{u.value=!1}},b=()=>{const p={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(w=>{p[w]===void 0&&delete p[w]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),w=p.get("startDate"),y=p.get("endDate");w&&(x.value=w),y&&(d.value=y),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),O=V.get("endDate");W!==x.value&&(x.value=W||""),O!==d.value&&(d.value=O||""),c()}),z()});const r=()=>{f()},f=async()=>{try{const p={dateRange:x.value&&d.value?[x.value,d.value]:void 0},w=await ft.exportCreditWeekdayClassCount(p),y=w.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const E=new Blob([w.data],{type:"application/json"}),L=await new Response(E).text(),j=JSON.parse(L);console.error("匯出學分班課程開班數量統計（平日班）失敗：伺服器返回錯誤：",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤，請稍後再試");return}catch(E){console.error("匯出學分班課程開班數量統計（平日班）失敗：無法解析回應內容",E),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([w.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),O=document.createElement("a");O.href=W;const _=`學分班課程開班數量（平日班）_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;O.setAttribute("download",_),document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","學分班課程開班數量統計（平日班）已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出學分班課程開班數量統計（平日班）失敗:",p),p.response&&p.response.data){const w=p.response.data;v.showError("匯出失敗",w.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,w)=>(t(),s("div",null,[w[7]||(w[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程開班數量(平日班)統計表",-1)),e("div",vF,[e("div",mF,[w[4]||(w[4]=e("span",null,"查詢日期:",-1)),e("div",bF,[w[2]||(w[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":w[0]||(w[0]=y=>x.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,x.value]])]),e("div",fF,[w[3]||(w[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":w[1]||(w[1]=y=>d.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:G,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:k,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,yF),w[5]||(w[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):J("",!0)])]),e("div",gF,[u.value?(t(),s("div",xF,w[6]||(w[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",hF,[e("thead",null,[e("tr",wF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":y.type==="subtotal"||y.type==="total"}])},l(y.label),11,_F))),128))]),$.value?(t(),s("tr",kF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,$F))),128)):J("",!0)],64))),128))])):J("",!0),P.value?(t(),s("tr",CF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s(Z,{key:V.key},[(t(!0),s(Z,null,re(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(a.value,(y,V)=>(t(),s(Z,{key:V},[y.type==="total"?(t(),s("tr",{key:0,class:X(A(y))},[e("td",{colspan:"3",class:X(A(y))},"總計",2),(t(!0),s(Z,null,re(K.value,W=>(t(),s("td",{key:W.key,class:X(A(y))},l(y[W.key]),3))),128)),e("td",{class:X(A(y))},l(y.total),3),e("td",{class:X(A(y))},l(y.region_total_col),3)],2)):(t(),s("tr",{key:1,class:X(A(y))},[y._display_item_no?(t(),s("td",{key:0,class:X(A(y))},l(y.item_no),3)):J("",!0),y._display_region?(t(),s("td",{key:1,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_type),11,EF)):J("",!0),e("td",{class:X(A(y))},l(y.university_name),3),(t(!0),s(Z,null,re(K.value,W=>(t(),s(Z,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:X(A(y))},l(y[W.key]),3)):J("",!0)],64))),128)),e("td",{class:X(A(y))},l(y.total),3),y._display_region?(t(),s("td",{key:2,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_total_col),11,SF)):J("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",DF,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,MF)])):J("",!0)])]))])]))}},IF=Le(AF,[["__scopeId","data-v-bfb9d94b"]]),RF={class:"w-full max-w-[1500px] mt-4"},PF={class:"flex items-center space-x-4"},UF={class:"flex items-center space-x-2"},NF={class:"flex items-center space-x-2"},TF=["disabled"],VF={class:"w-full max-w-[1500px] mt-6"},jF={key:0,class:"flex justify-center items-center py-10"},LF={key:1,class:"w-full border-collapse table-fixed"},FF={class:"bg-[#EEEFE7]"},qF=["colspan","rowspan"],OF={key:0,class:"bg-[#EEEFE7]"},BF=["colspan","rowspan"],HF={key:1,class:"bg-[#EEEFE7]"},WF=["rowspan"],zF=["rowspan"],KF={key:0},JF=["colspan"],YF={__name:"CreditWeekendClassCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(w=>{w.children?w.children.forEach(y=>{y.children?p.push(...y.children):p.push(y)}):["item_no","region_type","university_name","total","region_total_col"].includes(w.key)||p.push(w)}),p}),$=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),P=Se(()=>C.value.some(p=>p.children&&p.children.some(w=>w.children&&w.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await tt.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("學分班課程開班數量（假日班）頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,w,y)=>y===0?Array.isArray(p.groupByTotal)?p.groupByTotal[w]??0:0:"",a=Se(()=>{const p=[];let w=null,y=0,V=-1;return o.value.forEach((W,O)=>{const _={...W};_.type==="total"?(_._display_region=!1,_._display_item_no=!1,_._region_rowspan=1,w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=null,y=0,V=-1):_.region_type!==""&&_.region_type!==w?(w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=_.region_type,y=1,V=p.length,_._display_region=!0,_._display_item_no=!0):(y++,_._display_region=!1,_._display_item_no=!0),p.push(_),O===o.value.length-1&&w!==null&&V!==-1&&(p[V]._region_rowspan=y)}),p}),A=(p,w)=>{const y={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(y["bg-orange-100"]=!0,y["font-bold"]=!0),y},G=()=>{x.value="",d.value="",b(),c()},k=()=>{c()},c=async()=>{var p;u.value=!0;try{const w={};x.value&&d.value&&(w.dateRange=[x.value,d.value]);const y=await ft.getCreditWeekendClassCount(w);if(y.data.code===0&&y.data.data){const V=y.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((R,U)=>({label:R,key:`course_${U+1}`})):[],O=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=O;const _=[];let E=1,L=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((R,U)=>{Array.isArray(R.yAxis)&&R.yAxis.forEach((te,ue)=>{const ye={item_no:E++,region_type:ue===0?R.name:"",university_name:te},ke=Array.isArray(V.xData[L])?V.xData[L]:[];(V.xAxis||[]).forEach((De,$e)=>{ye[`course_${$e+1}`]=ke[$e]??0}),ye.total=Array.isArray(V.yAxisSums)?V.yAxisSums[L]??0:0,ye.region_total_col=g(V,U,ue),_.push(ye),L++})});const j={type:"total"};j.item_no="",j.region_type="",j.university_name="",(V.xAxis||[]).forEach((R,U)=>{j[`course_${U+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[U]??0:0}),j.total=V.total??0,j.region_total_col="",_.push(j),o.value=_}else C.value=[],o.value=[],v.showError("查詢失敗",((p=y.data)==null?void 0:p.message)||"API 回傳異常")}catch(w){C.value=[],o.value=[],v.showError("查詢失敗",(w==null?void 0:w.message)||"API 請求失敗")}finally{u.value=!1}},b=()=>{const p={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(w=>{p[w]===void 0&&delete p[w]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),w=p.get("startDate"),y=p.get("endDate");w&&(x.value=w),y&&(d.value=y),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),O=V.get("endDate");W!==x.value&&(x.value=W||""),O!==d.value&&(d.value=O||""),c()}),z()});const r=()=>{f()},f=async()=>{try{const p={dateRange:x.value&&d.value?[x.value,d.value]:void 0},w=await ft.exportCreditWeekendClassCount(p),y=w.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const E=new Blob([w.data],{type:"application/json"}),L=await new Response(E).text(),j=JSON.parse(L);console.error("匯出學分班課程開班數量統計（假日班）失敗：伺服器返回錯誤：",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤，請稍後再試");return}catch(E){console.error("匯出學分班課程開班數量統計（假日班）失敗：無法解析回應內容",E),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([w.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),O=document.createElement("a");O.href=W;const _=`學分班課程開班數量（假日班）_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;O.setAttribute("download",_),document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","學分班課程開班數量統計（假日班）已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出學分班課程開班數量統計（假日班）失敗:",p),p.response&&p.response.data){const w=p.response.data;v.showError("匯出失敗",w.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,w)=>(t(),s("div",null,[w[7]||(w[7]=e("h3",{class:"text-xl font-bold mb-4"},"學分班課程開班數量(假日班)統計表",-1)),e("div",RF,[e("div",PF,[w[4]||(w[4]=e("span",null,"查詢日期:",-1)),e("div",UF,[w[2]||(w[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":w[0]||(w[0]=y=>x.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,x.value]])]),e("div",NF,[w[3]||(w[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":w[1]||(w[1]=y=>d.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:G,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:k,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,TF),w[5]||(w[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):J("",!0)])]),e("div",VF,[u.value?(t(),s("div",jF,w[6]||(w[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",LF,[e("thead",null,[e("tr",FF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":y.type==="subtotal"||y.type==="total"}])},l(y.label),11,qF))),128))]),$.value?(t(),s("tr",OF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,BF))),128)):J("",!0)],64))),128))])):J("",!0),P.value?(t(),s("tr",HF,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s(Z,{key:V.key},[(t(!0),s(Z,null,re(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(a.value,(y,V)=>(t(),s(Z,{key:V},[y.type==="total"?(t(),s("tr",{key:0,class:X(A(y))},[e("td",{colspan:"3",class:X(A(y))},"總計",2),(t(!0),s(Z,null,re(K.value,W=>(t(),s("td",{key:W.key,class:X(A(y))},l(y[W.key]),3))),128)),e("td",{class:X(A(y))},l(y.total),3),e("td",{class:X(A(y))},l(y.region_total_col),3)],2)):(t(),s("tr",{key:1,class:X(A(y))},[y._display_item_no?(t(),s("td",{key:0,class:X(A(y))},l(y.item_no),3)):J("",!0),y._display_region?(t(),s("td",{key:1,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_type),11,WF)):J("",!0),e("td",{class:X(A(y))},l(y.university_name),3),(t(!0),s(Z,null,re(K.value,W=>(t(),s(Z,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:X(A(y))},l(y[W.key]),3)):J("",!0)],64))),128)),e("td",{class:X(A(y))},l(y.total),3),y._display_region?(t(),s("td",{key:2,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_total_col),11,zF)):J("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",KF,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,JF)])):J("",!0)])]))])]))}},GF=Le(YF,[["__scopeId","data-v-4aaac724"]]),QF={class:"w-full max-w-[1500px] mt-4"},ZF={class:"flex items-center space-x-4"},XF={class:"flex items-center space-x-2"},eq={class:"flex items-center space-x-2"},tq=["disabled"],sq={class:"w-full max-w-[1500px] mt-6"},aq={key:0,class:"flex justify-center items-center py-10"},oq={key:1,class:"w-full border-collapse table-fixed"},lq={class:"bg-[#EEEFE7]"},nq=["colspan","rowspan"],rq={key:0,class:"bg-[#EEEFE7]"},iq=["colspan","rowspan"],dq={key:1,class:"bg-[#EEEFE7]"},uq=["rowspan"],cq=["rowspan"],pq={key:0},vq=["colspan"],mq={__name:"VocationalClassCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const p=[];return C.value.forEach(w=>{w.children?w.children.forEach(y=>{y.children?p.push(...y.children):p.push(y)}):["item_no","region_type","university_name","total","region_total_col"].includes(w.key)||p.push(w)}),p}),$=Se(()=>C.value.some(p=>p.children&&p.children.length>0)),P=Se(()=>C.value.some(p=>p.children&&p.children.some(w=>w.children&&w.children.length>0))),T=m({reportAllExport:!1}),z=async()=>{try{const p=await tt.getSidebarPermissions();p.data.code===0&&p.data.message==="success"?(T.value=p.data.data,console.log("職能班課程開班數量頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",p.data.message)}catch(p){console.error("獲取權限錯誤:",p)}},g=(p,w,y)=>y===0?Array.isArray(p.groupByTotal)?p.groupByTotal[w]??0:0:"",a=Se(()=>{const p=[];let w=null,y=0,V=-1;return o.value.forEach((W,O)=>{const _={...W};_.type==="total"?(_._display_region=!1,_._display_item_no=!1,_._region_rowspan=1,w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=null,y=0,V=-1):_.region_type!==""&&_.region_type!==w?(w!==null&&V!==-1&&(p[V]._region_rowspan=y),w=_.region_type,y=1,V=p.length,_._display_region=!0,_._display_item_no=!0):(y++,_._display_region=!1,_._display_item_no=!0),p.push(_),O===o.value.length-1&&w!==null&&V!==-1&&(p[V]._region_rowspan=y)}),p}),A=(p,w)=>{const y={border:!0,"p-2":!0,"text-center":!0};return p.type==="total"&&(y["bg-orange-100"]=!0,y["font-bold"]=!0),y},G=()=>{x.value="",d.value="",b(),c()},k=()=>{c()},c=async()=>{var p;u.value=!0;try{const w={};x.value&&d.value&&(w.dateRange=[x.value,d.value]);const y=await ft.getVocationalClassCount(w);if(y.data.code===0&&y.data.data){const V=y.data.data,W=Array.isArray(V.xAxis)?V.xAxis.map((R,U)=>({label:R,key:`course_${U+1}`})):[],O=[{label:"項次",key:"item_no",rowspan:2},{label:"區域別",key:"region_type",rowspan:2},{label:"大專(院)校名稱",key:"university_name",rowspan:2},{label:"課程名稱/開課數量",key:"course_participants_main",colspan:W.length,children:W},{label:"合計",key:"total",rowspan:2},{label:"各區總計",key:"region_total_col",rowspan:2}];C.value=O;const _=[];let E=1,L=0;Array.isArray(V.yList)&&Array.isArray(V.xData)&&V.yList.forEach((R,U)=>{Array.isArray(R.yAxis)&&R.yAxis.forEach((te,ue)=>{const ye={item_no:E++,region_type:ue===0?R.name:"",university_name:te},ke=Array.isArray(V.xData[L])?V.xData[L]:[];(V.xAxis||[]).forEach((De,$e)=>{ye[`course_${$e+1}`]=ke[$e]??0}),ye.total=Array.isArray(V.yAxisSums)?V.yAxisSums[L]??0:0,ye.region_total_col=g(V,U,ue),_.push(ye),L++})});const j={type:"total"};j.item_no="",j.region_type="",j.university_name="",(V.xAxis||[]).forEach((R,U)=>{j[`course_${U+1}`]=Array.isArray(V.xAxisSums)?V.xAxisSums[U]??0:0}),j.total=V.total??0,j.region_total_col="",_.push(j),o.value=_}else C.value=[],o.value=[],v.showError("查詢失敗",((p=y.data)==null?void 0:p.message)||"API 回傳異常")}catch(w){C.value=[],o.value=[],v.showError("查詢失敗",(w==null?void 0:w.message)||"API 請求失敗")}finally{u.value=!1}},b=()=>{const p={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(p).forEach(w=>{p[w]===void 0&&delete p[w]}),N.replace({query:p})};je(()=>{const p=new URLSearchParams(window.location.search),w=p.get("startDate"),y=p.get("endDate");w&&(x.value=w),y&&(d.value=y),c(),Ee(()=>window.location.search,()=>{const V=new URLSearchParams(window.location.search),W=V.get("startDate"),O=V.get("endDate");W!==x.value&&(x.value=W||""),O!==d.value&&(d.value=O||""),c()}),z()});const r=()=>{f()},f=async()=>{try{const p={dateRange:x.value&&d.value?[x.value,d.value]:void 0},w=await ft.exportVocationalClassCount(p),y=w.headers["content-type"];if(!y||!y.includes("spreadsheetml.sheet"))try{const E=new Blob([w.data],{type:"application/json"}),L=await new Response(E).text(),j=JSON.parse(L);console.error("匯出職能班課程開班數量統計失敗：伺服器返回錯誤：",j),v.showError("匯出失敗",j.message||"匯出過程中發生錯誤，請稍後再試");return}catch(E){console.error("匯出職能班課程開班數量統計失敗：無法解析回應內容",E),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const V=new Blob([w.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),W=window.URL.createObjectURL(V),O=document.createElement("a");O.href=W;const _=`職能班課程開班數量_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;O.setAttribute("download",_),document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(W),v.showSuccess("匯出成功","職能班課程開班數量統計已成功匯出為 Excel 檔案")}catch(p){if(console.error("匯出職能班課程開班數量統計失敗:",p),p.response&&p.response.data){const w=p.response.data;v.showError("匯出失敗",w.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(p,w)=>(t(),s("div",null,[w[7]||(w[7]=e("h3",{class:"text-xl font-bold mb-4"},"職能班課程開班數量統計表",-1)),e("div",QF,[e("div",ZF,[w[4]||(w[4]=e("span",null,"查詢日期:",-1)),e("div",XF,[w[2]||(w[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":w[0]||(w[0]=y=>x.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,x.value]])]),e("div",eq,[w[3]||(w[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":w[1]||(w[1]=y=>d.value=y),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(k,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:!bg-gray-300",onClick:G,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:k,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢參訓人數記錄"}," 搜尋 ",8,tq),w[5]||(w[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:r}," 匯出 Excel ")):J("",!0)])]),e("div",sq,[u.value?(t(),s("div",aq,w[6]||(w[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",oq,[e("thead",null,[e("tr",lq,[(t(!0),s(Z,null,re(C.value,y=>(t(),s("th",{key:y.key,colspan:y.colspan||1,rowspan:y.rowspan||1,class:X(["border p-2 text-center",{"bg-gray-200":y.type==="subtotal"||y.type==="total"}])},l(y.label),11,nq))),128))]),$.value?(t(),s("tr",rq,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s("th",{key:V.key,colspan:V.colspan||1,rowspan:V.rowspan||1,class:"border p-2 text-center"},l(V.label),9,iq))),128)):J("",!0)],64))),128))])):J("",!0),P.value?(t(),s("tr",dq,[(t(!0),s(Z,null,re(C.value,y=>(t(),s(Z,{key:y.key},[y.children?(t(!0),s(Z,{key:0},re(y.children,V=>(t(),s(Z,{key:V.key},[(t(!0),s(Z,null,re(V.children,W=>(t(),s("th",{key:W.key,class:"border p-2 text-center"},l(W.label),1))),128))],64))),128)):J("",!0)],64))),128))])):J("",!0)]),e("tbody",null,[(t(!0),s(Z,null,re(a.value,(y,V)=>(t(),s(Z,{key:V},[y.type==="total"?(t(),s("tr",{key:0,class:X(A(y))},[e("td",{colspan:"3",class:X(A(y))},"總計",2),(t(!0),s(Z,null,re(K.value,W=>(t(),s("td",{key:W.key,class:X(A(y))},l(y[W.key]),3))),128)),e("td",{class:X(A(y))},l(y.total),3),e("td",{class:X(A(y))},l(y.region_total_col),3)],2)):(t(),s("tr",{key:1,class:X(A(y))},[y._display_item_no?(t(),s("td",{key:0,class:X(A(y))},l(y.item_no),3)):J("",!0),y._display_region?(t(),s("td",{key:1,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_type),11,uq)):J("",!0),e("td",{class:X(A(y))},l(y.university_name),3),(t(!0),s(Z,null,re(K.value,W=>(t(),s(Z,{key:W.key},[W.key.startsWith("course_")?(t(),s("td",{key:0,class:X(A(y))},l(y[W.key]),3)):J("",!0)],64))),128)),e("td",{class:X(A(y))},l(y.total),3),y._display_region?(t(),s("td",{key:2,rowspan:y._region_rowspan,class:X(A(y))},l(y.region_total_col),11,cq)):J("",!0)],2))],64))),128)),o.value.length===0?(t(),s("tr",pq,[e("td",{colspan:K.value.length+5,class:"border p-4 text-center"},"無符合條件的資料",8,vq)])):J("",!0)])]))])]))}},bq=Le(mq,[["__scopeId","data-v-de529341"]]),fq={class:"w-full max-w-[1500px] mt-4"},yq={class:"flex items-center space-x-4"},gq={class:"flex items-center space-x-2"},xq={class:"flex items-center space-x-2"},hq=["disabled"],wq={class:"w-full max-w-[1500px] mt-6"},_q={key:0,class:"flex justify-center items-center py-10"},kq={key:1,class:"w-full border-collapse table-fixed"},$q={class:"bg-[#EEEFE7]"},Cq={class:"border p-2 text-center"},Eq={class:"border p-2 text-center"},Sq={class:"border p-2 text-center"},Dq={class:"border p-2 text-center"},Mq={class:"border p-2 text-center"},Aq={class:"border p-2 text-center font-bold bg-orange-100"},Iq={class:"border p-2 text-center font-bold bg-orange-100"},Rq={class:"border p-2 text-center font-bold bg-orange-100"},Pq={key:0},Uq=["colspan"],Nq={__name:"StudentCourseParticipation",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([{label:"序號",key:"item_no"},{label:"課程數量",key:"course_label"},{label:"學分班",key:"credit"},{label:"職能班",key:"vocational"},{label:"合計",key:"total"}]),o=m([]);lt();const N=We(),K=Se(()=>{const k=o.value.reduce((b,r)=>b+(Number(r.credit)||0),0),c=o.value.reduce((b,r)=>b+(Number(r.vocational)||0),0);return{credit:k,vocational:c,total:k+c}}),$=()=>{x.value="",d.value="",a(),g()},P=()=>{g()},T=m({reportAllExport:!1}),z=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?(T.value=k.data.data,console.log("學員修課課程數量統計表頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},g=async()=>{var k,c,b,r;u.value=!0;try{const f={};x.value&&d.value&&(f.dateRange=[x.value,d.value]);const p=await ft.getStudentCourseCompletedStatus(f);if(((k=p==null?void 0:p.data)==null?void 0:k.code)===0&&Array.isArray((b=(c=p==null?void 0:p.data)==null?void 0:c.data)==null?void 0:b.list)){const w=p.data.data.list,y=w.slice(0,Math.max(w.length-1,0));o.value=y.map((V,W)=>({item_no:W+1,course_label:(V==null?void 0:V.name)??"",credit:(V==null?void 0:V.creditCount)??0,vocational:(V==null?void 0:V.cyberCount)??0,total:(V==null?void 0:V.total)??((V==null?void 0:V.creditCount)??0)+((V==null?void 0:V.cyberCount)??0)}))}else o.value=[],v.showError("查詢失敗",((r=p==null?void 0:p.data)==null?void 0:r.message)||"API 回傳異常")}catch(f){o.value=[],v.showError("查詢失敗",(f==null?void 0:f.message)||"資料載入失敗")}finally{u.value=!1}},a=()=>{const k={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(k).forEach(c=>{k[c]===void 0&&delete k[c]}),N.replace({query:k})};je(()=>{const k=new URLSearchParams(window.location.search),c=k.get("startDate"),b=k.get("endDate");c&&(x.value=c),b&&(d.value=b),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),f=r.get("startDate"),p=r.get("endDate");f!==x.value&&(x.value=f||""),p!==d.value&&(d.value=p||""),g()}),z()});const A=()=>{G()},G=async()=>{try{const k={};x.value&&d.value&&(k.dateRange=[x.value,d.value]);const c=await ft.exportStudentCourseCompletedStatus(k),b=c.headers["content-type"];if(!b||!b.includes("spreadsheetml.sheet"))try{const y=new Blob([c.data],{type:"application/json"}),V=await new Response(y).text(),W=JSON.parse(V);console.error("匯出學員修課課程數量統計失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(y){console.error("匯出學員修課課程數量統計失敗：無法解析回應內容",y),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(r),p=document.createElement("a");p.href=f;const w=`學員修課課程數量統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",w),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(f),v.showSuccess("匯出成功","學員修課課程數量統計已成功匯出為 Excel 檔案")}catch(k){if(console.error("匯出學員修課課程數量統計失敗:",k),k.response&&k.response.data){const c=k.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(k,c)=>(t(),s("div",null,[c[8]||(c[8]=e("h3",{class:"text-xl font-bold mb-4"},"學員參加課程統計表",-1)),e("div",fq,[e("div",yq,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",gq,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=b=>x.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(P,["enter"])},null,34),[[ee,x.value]])]),e("div",xq,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=b=>d.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(P,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:$,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:P,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢修課統計"}," 搜尋 ",8,hq),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:A}," 匯出 Excel ")):J("",!0)])]),e("div",wq,[u.value?(t(),s("div",_q,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",kq,[e("thead",null,[e("tr",$q,[(t(!0),s(Z,null,re(C.value,b=>(t(),s("th",{key:b.key,class:"border p-2 text-center"},l(b.label),1))),128))])]),e("tbody",null,[(t(!0),s(Z,null,re(o.value,(b,r)=>(t(),s("tr",{key:r},[e("td",Cq,l(b.item_no),1),e("td",Eq,l(b.course_label),1),e("td",Sq,l(b.credit),1),e("td",Dq,l(b.vocational),1),e("td",Mq,l(b.total),1)]))),128)),e("tr",null,[c[7]||(c[7]=e("td",{class:"border p-2 text-center font-bold bg-orange-100",colspan:"2"},"總計",-1)),e("td",Aq,l(K.value.credit),1),e("td",Iq,l(K.value.vocational),1),e("td",Rq,l(K.value.total),1)]),o.value.length===0?(t(),s("tr",Pq,[e("td",{colspan:C.value.length,class:"border p-4 text-center"},"無符合條件的資料",8,Uq)])):J("",!0)])]))])]))}},Tq=Le(Nq,[["__scopeId","data-v-51ab62dd"]]),Vq={class:"w-full max-w-[1500px] mt-4"},jq={class:"flex items-center space-x-4"},Lq={class:"flex items-center space-x-2"},Fq={class:"flex items-center space-x-2"},qq=["disabled"],Oq={class:"w-full max-w-[1500px] mt-6"},Bq={key:0,class:"flex justify-center items-center py-10"},Hq={key:1,class:"w-full border-collapse table-fixed"},Wq={class:"border p-2 text-center"},zq={class:"border p-2 text-center"},Kq={class:"border p-2 text-center"},Jq={class:"border p-2 text-center font-bold bg-orange-100",colspan:"2"},Yq={class:"border p-2 text-center font-bold bg-orange-100"},Gq={key:0},Qq={__name:"StudentSecurityCertificateCount",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]);lt();const o=We(),N=Se(()=>C.value.reduce((k,c)=>k+(Number(c.count)||0),0)),K=m(""),$=()=>{x.value="",d.value="",a(),g()},P=()=>{g()},T=m({reportAllExport:!1}),z=async()=>{try{const k=await tt.getSidebarPermissions();k.data.code===0&&k.data.message==="success"?(T.value=k.data.data,console.log("學員資安證書完成人數統計表頁面權限:",T.value.reportAllExport)):console.error("獲取權限失敗:",k.data.message)}catch(k){console.error("獲取權限錯誤:",k)}},g=async()=>{var k,c,b,r;u.value=!0;try{const f={};x.value&&d.value&&(f.dateRange=[x.value,d.value]);const p=await ft.getStudentCertificateCount(f);if(((k=p==null?void 0:p.data)==null?void 0:k.code)===0&&Array.isArray((b=(c=p==null?void 0:p.data)==null?void 0:c.data)==null?void 0:b.list)){const w=p.data.data.list,y=w[w.length-1];K.value=(y==null?void 0:y.name)??"總計";const V=w.slice(0,Math.max(w.length-1,0));C.value=V.map((W,O)=>({item_no:O+1,certificate_name:(W==null?void 0:W.name)??"",count:(W==null?void 0:W.count)??0}))}else C.value=[],v.showError("查詢失敗",((r=p==null?void 0:p.data)==null?void 0:r.message)||"API 回傳異常")}catch(f){C.value=[],v.showError("查詢失敗",(f==null?void 0:f.message)||"資料載入失敗")}finally{u.value=!1}},a=()=>{const k={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(k).forEach(c=>{k[c]===void 0&&delete k[c]}),o.replace({query:k})};je(()=>{const k=new URLSearchParams(window.location.search),c=k.get("startDate"),b=k.get("endDate");c&&(x.value=c),b&&(d.value=b),g(),Ee(()=>window.location.search,()=>{const r=new URLSearchParams(window.location.search),f=r.get("startDate"),p=r.get("endDate");f!==x.value&&(x.value=f||""),p!==d.value&&(d.value=p||""),g()}),z()});const A=()=>{G()},G=async()=>{try{const k={dateRange:x.value&&d.value?[x.value,d.value]:void 0},c=await ft.exportStudentCertificateCount(k),b=c.headers["content-type"];if(!b||!b.includes("spreadsheetml.sheet"))try{const y=new Blob([c.data],{type:"application/json"}),V=await new Response(y).text(),W=JSON.parse(V);console.error("匯出學員資安證書完成人數統計表失敗：伺服器返回錯誤：",W),v.showError("匯出失敗",W.message||"匯出過程中發生錯誤，請稍後再試");return}catch(y){console.error("匯出學員資安證書完成人數統計表失敗：無法解析回應內容",y),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const r=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(r),p=document.createElement("a");p.href=f;const w=`學員資安證書完成人數統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;p.setAttribute("download",w),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(f),v.showSuccess("匯出成功","學員資安證書完成人數統計表已成功匯出為 Excel 檔案")}catch(k){if(console.error("匯出學員資安證書完成人數統計表失敗:",k),k.response&&k.response.data){const c=k.response.data;v.showError("匯出失敗",c.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(k,c)=>(t(),s("div",null,[c[9]||(c[9]=e("h3",{class:"text-xl font-bold mb-4"},"學員資安職能證書完成人數統計表",-1)),e("div",Vq,[e("div",jq,[c[4]||(c[4]=e("span",null,"查詢日期:",-1)),e("div",Lq,[c[2]||(c[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":c[0]||(c[0]=b=>x.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(P,["enter"])},null,34),[[ee,x.value]])]),e("div",Fq,[c[3]||(c[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":c[1]||(c[1]=b=>d.value=b),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(P,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:$,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:P,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢資安證書統計"}," 搜尋 ",8,qq),c[5]||(c[5]=e("div",{class:"flex-grow"},null,-1)),T.value&&T.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:A}," 匯出 Excel ")):J("",!0)])]),e("div",Oq,[u.value?(t(),s("div",Bq,c[6]||(c[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",Hq,[c[8]||(c[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center"},"序號"),e("th",{class:"border p-2 text-center"},"證書名稱"),e("th",{class:"border p-2 text-center"},"完成人數")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(C.value,(b,r)=>(t(),s("tr",{key:r},[e("td",Wq,l(b.item_no),1),e("td",zq,l(b.certificate_name),1),e("td",Kq,l(b.count),1)]))),128)),e("tr",null,[e("td",Jq,l(K.value),1),e("td",Yq,l(N.value),1)]),C.value.length===0?(t(),s("tr",Gq,c[7]||(c[7]=[e("td",{colspan:3,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])]))])]))}},Zq=Le(Qq,[["__scopeId","data-v-e7a34be0"]]),Xq={class:"w-full max-w-[1500px] mt-4"},eO={class:"flex items-center space-x-4"},tO={class:"flex items-center space-x-2"},sO={class:"flex items-center space-x-2"},aO=["disabled"],oO={class:"w-full max-w-[1500px] mt-6"},lO={key:0,class:"flex justify-center items-center py-10"},nO={key:1,class:"w-full border-collapse table-fixed"},rO={class:"border p-2 text-center"},iO={class:"border p-2 text-center"},dO={key:0},uO={__name:"StudentProgressStats",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]);lt();const o=We(),N=()=>{x.value="",d.value="",z(),T()},K=()=>{T()},$=m({reportAllExport:!1}),P=async()=>{try{const A=await tt.getSidebarPermissions();A.data.code===0&&A.data.message==="success"?($.value=A.data.data,console.log("學員進度情形統計表頁面權限:",$.value.reportAllExport)):console.error("獲取權限失敗:",A.data.message)}catch(A){console.error("獲取權限錯誤:",A)}},T=async()=>{var A,G,k,c;u.value=!0;try{const b={};x.value&&d.value&&(b.dateRange=[x.value,d.value]);const r=await ft.getStudentProgressTracking(b);((A=r==null?void 0:r.data)==null?void 0:A.code)===0&&Array.isArray((k=(G=r==null?void 0:r.data)==null?void 0:G.data)==null?void 0:k.list)?C.value=r.data.data.list.map(f=>({progress_label:(f==null?void 0:f.name)??"",count:(f==null?void 0:f.count)??0})):(C.value=[],v.showError("查詢失敗",((c=r==null?void 0:r.data)==null?void 0:c.message)||"API 回傳異常"))}catch(b){C.value=[],v.showError("查詢失敗",(b==null?void 0:b.message)||"資料載入失敗")}finally{u.value=!1}},z=()=>{const A={startDate:x.value||void 0,endDate:d.value||void 0};Object.keys(A).forEach(G=>{A[G]===void 0&&delete A[G]}),o.replace({query:A})};je(()=>{const A=new URLSearchParams(window.location.search),G=A.get("startDate"),k=A.get("endDate");G&&(x.value=G),k&&(d.value=k),T(),Ee(()=>window.location.search,()=>{const c=new URLSearchParams(window.location.search),b=c.get("startDate"),r=c.get("endDate");b!==x.value&&(x.value=b||""),r!==d.value&&(d.value=r||""),T()}),P()});const g=()=>{a()},a=async()=>{try{const A={dateRange:x.value&&d.value?[x.value,d.value]:void 0},G=await ft.exportStudentProgressTracking(A),k=G.headers["content-type"];if(!k||!k.includes("spreadsheetml.sheet"))try{const p=new Blob([G.data],{type:"application/json"}),w=await new Response(p).text(),y=JSON.parse(w);console.error("匯出學員進度情形統計表失敗：伺服器返回錯誤：",y),v.showError("匯出失敗",y.message||"匯出過程中發生錯誤，請稍後再試");return}catch(p){console.error("匯出學員進度情形統計表失敗：無法解析回應內容",p),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const c=new Blob([G.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(c),r=document.createElement("a");r.href=b;const f=`學員進度情形統計表_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;r.setAttribute("download",f),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(b),v.showSuccess("匯出成功","學員進度情形統計表已成功匯出為 Excel 檔案")}catch(A){if(console.error("匯出學員進度情形統計表失敗:",A),A.response&&A.response.data){const G=A.response.data;v.showError("匯出失敗",G.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(A,G)=>(t(),s("div",null,[G[9]||(G[9]=e("h3",{class:"text-xl font-bold mb-4"},"學員進度追蹤統計表",-1)),e("div",Xq,[e("div",eO,[G[4]||(G[4]=e("span",null,"查詢日期:",-1)),e("div",tO,[G[2]||(G[2]=e("label",{class:"text-sm font-medium",for:"startDate"},"從",-1)),I(e("input",{id:"startDate",type:"date","onUpdate:modelValue":G[0]||(G[0]=k=>x.value=k),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":d.value&&!x.value}]),onKeyup:Ne(K,["enter"])},null,34),[[ee,x.value]])]),e("div",sO,[G[3]||(G[3]=e("label",{class:"text-sm font-medium",for:"endDate"},"到",-1)),I(e("input",{id:"endDate",type:"date","onUpdate:modelValue":G[1]||(G[1]=k=>d.value=k),class:X(["p-2 border border-gray-300 rounded outline-none w-40",{"border-red-500":x.value&&!d.value}]),onKeyup:Ne(K,["enter"])},null,34),[[ee,d.value]])]),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:N,"aria-label":"重置查詢條件"}," 重置 "),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:K,disabled:u.value||x.value&&!d.value||!x.value&&d.value||x.value&&d.value&&new Date(x.value)>new Date(d.value),"aria-label":"查詢進度統計"}," 搜尋 ",8,aO),G[5]||(G[5]=e("div",{class:"flex-grow"},null,-1)),$.value&&$.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:g}," 匯出 Excel ")):J("",!0)])]),e("div",oO,[u.value?(t(),s("div",lO,G[6]||(G[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",nO,[G[8]||(G[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center"},"進度情形"),e("th",{class:"border p-2 text-center"},"人數")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(C.value,(k,c)=>(t(),s("tr",{key:c},[e("td",rO,l(k.progress_label),1),e("td",iO,l(k.count),1)]))),128)),C.value.length===0?(t(),s("tr",dO,G[7]||(G[7]=[e("td",{colspan:2,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])]))])]))}},cO=Le(uO,[["__scopeId","data-v-1a703230"]]),pO={class:"w-full max-w-[1500px] mt-4"},vO={class:"flex items-center space-x-4"},mO={class:"flex items-center space-x-2"},bO=["value"],fO={class:"flex items-center space-x-2"},yO=["value"],gO=["disabled"],xO={class:"w-full max-w-[1500px] mt-6"},hO={key:0,class:"flex justify-center items-center py-10"},wO={key:1,class:"w-full border-collapse table-fixed"},_O={class:"border p-2 text-center"},kO={class:"border p-2 text-center"},$O={class:"border p-2 text-center"},CO={class:"border p-2 text-center"},EO={class:"border p-2 text-center"},SO={class:"border p-2 text-center"},DO={class:"border p-2 text-center"},MO={class:"border p-2 text-center"},AO={class:"border p-2 text-center"},IO={class:"border p-2 text-center"},RO={class:"border p-2 text-center"},PO={class:"border p-2 text-center"},UO={class:"border p-2 text-center"},NO={class:"border p-2 text-center"},TO={class:"border p-2 text-center"},VO={class:"border p-2 text-center"},jO={key:0,class:"bg-orange-100 font-bold"},LO={class:"border p-2 text-center"},FO={class:"border p-2 text-center"},qO={class:"border p-2 text-center"},OO={class:"border p-2 text-center"},BO={class:"border p-2 text-center"},HO={class:"border p-2 text-center"},WO={class:"border p-2 text-center"},zO={class:"border p-2 text-center"},KO={class:"border p-2 text-center"},JO={class:"border p-2 text-center"},YO={class:"border p-2 text-center"},GO={class:"border p-2 text-center"},QO={class:"border p-2 text-center"},ZO={class:"border p-2 text-center"},XO={class:"border p-2 text-center"},eB={key:1},tB=1+4*3+3,sB={__name:"FundingAllocationStats",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m([]);lt();const N=We(),K=Se(()=>{const b=Array.isArray(o.value)?o.value:[],r=f=>typeof b[f]=="number"?b[f]:(b==null?void 0:b[f])??0;return{grant80_pending:r(0),grant80_count:r(1),grant80_amount:r(2),grant15_pending:r(3),grant15_count:r(4),grant15_amount:r(5),grant5_pending:r(6),grant5_count:r(7),grant5_amount:r(8),grant100_pending:r(9),grant100_count:r(10),grant100_amount:r(11),sum_pending:r(12),sum_granted_count:r(13),sum_granted_amount:r(14)}}),$=Se(()=>{const b=new Date().getFullYear(),r=[];for(let f=b;f>=2024;f--)r.push(f);return r}),P=Se(()=>{const b=[];for(let r=1;r<=12;r++)b.push(r);return b.map(r=>String(r).padStart(2,"0"))}),T=()=>{x.value="",d.value="",G(),A()},z=()=>{A()},g=m({reportAllExport:!1}),a=async()=>{try{const b=await tt.getSidebarPermissions();b.data.code===0&&b.data.message==="success"?(g.value=b.data.data,console.log("經費核撥統計表頁面權限:",g.value.reportAllExport)):console.error("獲取權限失敗:",b.data.message)}catch(b){console.error("獲取權限錯誤:",b)}},A=async()=>{var b,r,f,p,w,y;u.value=!0;try{const V={};x.value&&(V.year=parseInt(x.value)),d.value&&(V.month=parseInt(d.value));const W=await ft.getFinanceAppropriationDetail(V);if(((b=W==null?void 0:W.data)==null?void 0:b.code)===0&&Array.isArray((f=(r=W==null?void 0:W.data)==null?void 0:r.data)==null?void 0:f.yAxis)&&Array.isArray((w=(p=W==null?void 0:W.data)==null?void 0:p.data)==null?void 0:w.xData)){const O=W.data.data.yAxis,_=W.data.data.xData;o.value=Array.isArray(W.data.data.xAxisSums)?W.data.data.xAxisSums:[],C.value=O.map((E,L)=>{const j=Array.isArray(_[L])?_[L]:[];return{month_label:E,grant80_pending:(j==null?void 0:j[0])??0,grant80_count:(j==null?void 0:j[1])??0,grant80_amount:(j==null?void 0:j[2])??0,grant15_pending:(j==null?void 0:j[3])??0,grant15_count:(j==null?void 0:j[4])??0,grant15_amount:(j==null?void 0:j[5])??0,grant5_pending:(j==null?void 0:j[6])??0,grant5_count:(j==null?void 0:j[7])??0,grant5_amount:(j==null?void 0:j[8])??0,grant100_pending:(j==null?void 0:j[9])??0,grant100_count:(j==null?void 0:j[10])??0,grant100_amount:(j==null?void 0:j[11])??0,sum_pending:(j==null?void 0:j[12])??0,sum_granted_count:(j==null?void 0:j[13])??0,sum_granted_amount:(j==null?void 0:j[14])??0}})}else C.value=[],v.showError("查詢失敗",((y=W==null?void 0:W.data)==null?void 0:y.message)||"API 回傳異常")}catch(V){C.value=[],v.showError("查詢失敗",(V==null?void 0:V.message)||"資料載入失敗")}finally{u.value=!1}},G=()=>{const b={year:x.value||void 0,month:d.value||void 0};Object.keys(b).forEach(r=>{b[r]===void 0&&delete b[r]}),N.replace({query:b})};je(()=>{const b=new URLSearchParams(window.location.search),r=b.get("year"),f=b.get("month");r&&(x.value=r),f&&(d.value=f),A(),Ee(()=>window.location.search,()=>{const p=new URLSearchParams(window.location.search),w=p.get("year"),y=p.get("month");w!==x.value&&(x.value=w||""),y!==d.value&&(d.value=y||""),A()}),a()});const k=()=>{c()},c=async()=>{try{const b={};x.value&&(b.year=parseInt(x.value)),d.value&&(b.month=parseInt(d.value));const r=await ft.exportFinanceAppropriationDetail(b),f=r.headers["content-type"];if(!f||!f.includes("spreadsheetml.sheet"))try{const W=new Blob([r.data],{type:"application/json"}),O=await new Response(W).text(),_=JSON.parse(O);console.error("匯出經費核撥統計表失敗：伺服器返回錯誤：",_),v.showError("匯出失敗",_.message||"匯出過程中發生錯誤，請稍後再試");return}catch(W){console.error("匯出經費核撥統計表失敗：無法解析回應內容",W),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const p=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=window.URL.createObjectURL(p),y=document.createElement("a");y.href=w;const V=`經費核撥統計表_${x.value||new Date().getFullYear()}${String(d.value||new Date().getMonth()+1).padStart(2,"0")}.xlsx`;y.setAttribute("download",V),document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(w),v.showSuccess("匯出成功","經費核撥統計表已成功匯出為 Excel 檔案")}catch(b){if(console.error("匯出經費核撥統計表失敗:",b),b.response&&b.response.data){const r=b.response.data;v.showError("匯出失敗",r.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(b,r)=>(t(),s("div",null,[r[9]||(r[9]=e("h3",{class:"text-xl font-bold mb-4"},"經費核撥統計表",-1)),e("div",pO,[e("div",vO,[r[4]||(r[4]=e("span",null,"查詢日期:",-1)),e("div",mO,[I(e("select",{id:"year","onUpdate:modelValue":r[0]||(r[0]=f=>x.value=f),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(z,["enter"])},[r[2]||(r[2]=e("option",{value:""},"請選擇年",-1)),(t(!0),s(Z,null,re($.value,f=>(t(),s("option",{key:f,value:f},l(f)+"年 ",9,bO))),128))],544),[[Pe,x.value]])]),e("div",fO,[I(e("select",{id:"month","onUpdate:modelValue":r[1]||(r[1]=f=>d.value=f),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(z,["enter"])},[r[3]||(r[3]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(Z,null,re(P.value,f=>(t(),s("option",{key:f,value:f},l(f)+"月 ",9,yO))),128))],544),[[Pe,d.value]])]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] rounded hover:bg-[#dedfd7]",onClick:z,disabled:u.value,"aria-label":"查詢核撥統計"}," 搜尋 ",8,gO),e("button",{class:"px-4 py-2 bg-gray-200 mr-2 hover:bg-gray-300",onClick:T,"aria-label":"重置查詢條件"}," 重置 "),r[5]||(r[5]=e("div",{class:"flex-grow"},null,-1)),g.value&&g.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:k}," 匯出 Excel ")):J("",!0)])]),e("div",xO,[u.value?(t(),s("div",hO,r[6]||(r[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",wO,[r[8]||(r[8]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥年度/月份"),e("th",{class:"border p-2 text-center",colspan:12,scope:"col"},"核撥比例 / 核撥人數 / 核撥金額"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"待申請人數合計"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥人數合計"),e("th",{class:"border p-2 text-center",rowspan:"3",scope:"col"},"核撥金額合計")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥80%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥15%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥5%"),e("th",{class:"border p-2 text-center",colspan:3,scope:"col"},"核撥100%")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額"),e("th",{class:"border p-2 text-center",scope:"col"},"待申請人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥人數"),e("th",{class:"border p-2 text-center",scope:"col"},"核撥金額")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(C.value,(f,p)=>(t(),s("tr",{key:p},[e("td",_O,l(f.month_label),1),e("td",kO,l(f.grant80_pending),1),e("td",$O,l(f.grant80_count),1),e("td",CO,l(f.grant80_amount),1),e("td",EO,l(f.grant15_pending),1),e("td",SO,l(f.grant15_count),1),e("td",DO,l(f.grant15_amount),1),e("td",MO,l(f.grant5_pending),1),e("td",AO,l(f.grant5_count),1),e("td",IO,l(f.grant5_amount),1),e("td",RO,l(f.grant100_pending),1),e("td",PO,l(f.grant100_count),1),e("td",UO,l(f.grant100_amount),1),e("td",NO,l(f.sum_pending),1),e("td",TO,l(f.sum_granted_count),1),e("td",VO,l(f.sum_granted_amount),1)]))),128)),C.value.length>0?(t(),s("tr",jO,[r[7]||(r[7]=e("td",{class:"border p-2 text-center"},"合計",-1)),e("td",LO,l(K.value.grant80_pending),1),e("td",FO,l(K.value.grant80_count),1),e("td",qO,l(K.value.grant80_amount),1),e("td",OO,l(K.value.grant15_pending),1),e("td",BO,l(K.value.grant15_count),1),e("td",HO,l(K.value.grant15_amount),1),e("td",WO,l(K.value.grant5_pending),1),e("td",zO,l(K.value.grant5_count),1),e("td",KO,l(K.value.grant5_amount),1),e("td",JO,l(K.value.grant100_pending),1),e("td",YO,l(K.value.grant100_count),1),e("td",GO,l(K.value.grant100_amount),1),e("td",QO,l(K.value.sum_pending),1),e("td",ZO,l(K.value.sum_granted_count),1),e("td",XO,l(K.value.sum_granted_amount),1)])):J("",!0),C.value.length===0?(t(),s("tr",eB,[e("td",{colspan:tB,class:"border p-4 text-center"},"無符合條件的資料")])):J("",!0)])]))])]))}},aB=Le(sB,[["__scopeId","data-v-963a9460"]]),oB={class:"w-full max-w-[1500px] mt-4"},lB={class:"flex items-center space-x-4"},nB={class:"flex items-center space-x-2"},rB=["value"],iB={class:"flex items-center space-x-2"},dB=["value"],uB=["disabled"],cB={class:"w-full max-w-[1500px] mt-6"},pB={key:0,class:"flex justify-center items-center py-10"},vB={key:1,class:"w-full border-collapse table-fixed"},mB={class:"border p-2 text-center"},bB={class:"border p-2 text-center"},fB={class:"border p-2 text-center"},yB={class:"border p-2 text-center"},gB={class:"border p-2 text-center"},xB={class:"border p-2 text-center"},hB={class:"border p-2 text-center"},wB={class:"border p-2 text-center"},_B={class:"bg-yellow-200 font-bold"},kB={class:"border p-2 text-center"},$B={class:"border p-2 text-center"},CB={class:"border p-2 text-center"},EB={class:"border p-2 text-center"},SB={class:"border p-2 text-center"},DB={class:"border p-2 text-center"},MB={key:0},AB={__name:"MonthlyConsultationMethodStats",setup(D){const x=m(""),d=m(""),u=m(!1),C=m([]),o=m({reportAllExport:!1}),N=async()=>{try{const c=await tt.getSidebarPermissions();c.data.code===0&&c.data.message==="success"?(o.value=c.data.data,console.log("每月諮詢管道統計表頁面權限:",o.value.reportAllExport)):console.error("獲取權限失敗:",c.data.message)}catch(c){console.error("獲取權限錯誤:",c)}};lt();const K=We(),$=Se(()=>{const c=b=>C.value.reduce((r,f)=>r+(Number(f[b])||0),0);return{email_month:c("email_month"),email_total:c("email_total"),phone_month:c("phone_month"),phone_total:c("phone_total"),line_month:c("line_month"),line_total:c("line_total")}}),P=Se(()=>{const c=new Date().getFullYear(),b=[];for(let r=c;r>=2024;r--)b.push(r);return b}),T=Se(()=>{const c=[];for(let b=1;b<=12;b++)c.push(b);return c.map(b=>String(b).padStart(2,"0"))}),z=()=>{x.value="",d.value="",A(),a()},g=()=>{a()},a=async()=>{var c,b,r,f,p,w;u.value=!0;try{const y={};x.value&&(y.year=x.value),d.value&&(y.month=d.value);const V=await ft.getConsultType(y);if(((c=V==null?void 0:V.data)==null?void 0:c.code)===0&&Array.isArray((r=(b=V==null?void 0:V.data)==null?void 0:b.data)==null?void 0:r.yAxis)&&Array.isArray((p=(f=V==null?void 0:V.data)==null?void 0:f.data)==null?void 0:p.xData)){const W=V.data.data.yAxis,O=V.data.data.xData;C.value=W.map((_,E)=>{const L=Array.isArray(O[E])?O[E]:[];return{item_no:E+1,category:_,email_month:(L==null?void 0:L[0])??0,email_total:(L==null?void 0:L[1])??0,phone_month:(L==null?void 0:L[2])??0,phone_total:(L==null?void 0:L[3])??0,line_month:(L==null?void 0:L[4])??0,line_total:(L==null?void 0:L[5])??0}})}else C.value=[],v.showError("查詢失敗",((w=V==null?void 0:V.data)==null?void 0:w.message)||"API 回傳異常")}catch(y){C.value=[],v.showError("查詢失敗",(y==null?void 0:y.message)||"資料載入失敗")}finally{u.value=!1}},A=()=>{const c={year:x.value||void 0,month:d.value||void 0};Object.keys(c).forEach(b=>{c[b]===void 0&&delete c[b]}),K.replace({query:c})};je(()=>{const c=new URLSearchParams(window.location.search),b=c.get("year"),r=c.get("month");x.value=b||"",d.value=r||"",a(),Ee(()=>window.location.search,()=>{const f=new URLSearchParams(window.location.search),p=f.get("year"),w=f.get("month");p!==x.value&&(x.value=p||""),w!==d.value&&(d.value=w||""),a()}),N()});const G=()=>{k()},k=async()=>{try{const c={};x.value&&(c.year=parseInt(x.value)),d.value&&(c.month=parseInt(d.value));const b=await ft.exportMonthlyConsultationMethodStats(c),r=b.headers["content-type"];if(!r||!r.includes("spreadsheetml.sheet"))try{const V=new Blob([b.data],{type:"application/json"}),W=await new Response(V).text(),O=JSON.parse(W);console.error("匯出每月諮詢管道統計失敗：伺服器返回錯誤：",O),v.showError("匯出失敗",O.message||"匯出過程中發生錯誤，請稍後再試");return}catch(V){console.error("匯出每月諮詢管道統計失敗：無法解析回應內容",V),v.showError("匯出失敗","回應格式不正確，請稍後再試");return}const f=new Blob([b.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(f),w=document.createElement("a");w.href=p;const y=`每月諮詢管道統計_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}.xlsx`;w.setAttribute("download",y),document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(p),v.showSuccess("匯出成功","每月諮詢管道統計已成功匯出為 Excel 檔案")}catch(c){if(console.error("匯出每月諮詢管道統計失敗:",c),c.response&&c.response.data){const b=c.response.data;v.showError("匯出失敗",b.message||"匯出過程中發生錯誤，請稍後再試")}else v.showError("匯出失敗","匯出過程中發生錯誤，請稍後再試")}};return(c,b)=>(t(),s("div",null,[b[10]||(b[10]=e("h3",{class:"text-xl font-bold mb-4"},"每月諮詢方式統計表",-1)),e("div",oB,[e("div",lB,[b[4]||(b[4]=e("span",null,"查詢日期:",-1)),e("div",nB,[I(e("select",{id:"year","onUpdate:modelValue":b[0]||(b[0]=r=>x.value=r),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(g,["enter"])},[b[2]||(b[2]=e("option",{value:""},"請選擇年",-1)),(t(!0),s(Z,null,re(P.value,r=>(t(),s("option",{key:r,value:r},l(r)+"年 ",9,rB))),128))],544),[[Pe,x.value]])]),e("div",iB,[I(e("select",{id:"month","onUpdate:modelValue":b[1]||(b[1]=r=>d.value=r),class:"p-2 border border-gray-300 outline-none w-28",onKeyup:Ne(g,["enter"])},[b[3]||(b[3]=e("option",{value:""},"請選擇月",-1)),(t(!0),s(Z,null,re(T.value,r=>(t(),s("option",{key:r,value:r},l(r)+"月 ",9,dB))),128))],544),[[Pe,d.value]])]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:g,disabled:u.value||!x.value&&d.value,"aria-label":"查詢每月諮詢管道統計"}," 搜尋 ",8,uB),e("button",{class:"px-4 py-2 bg-gray-200 hover:bg-gray-300",onClick:z,"aria-label":"重置查詢條件"}," 重置 "),b[5]||(b[5]=e("div",{class:"flex-grow"},null,-1)),o.value&&o.value.reportAllExport?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#4e9875] text-white hover:bg-[#438264] w-28",onClick:G}," 匯出 Excel ")):J("",!0)])]),e("div",cB,[u.value?(t(),s("div",pB,b[6]||(b[6]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("table",vB,[b[9]||(b[9]=e("thead",null,[e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",rowspan:"2",scope:"col"},"序號"),e("th",{class:"border p-2 text-center",rowspan:"2",scope:"col"},"問題類別"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"Email"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"電話"),e("th",{class:"border p-2 text-center",colspan:2,scope:"col"},"官方Line")]),e("tr",{class:"bg-[#EEEFE7]"},[e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"當月諮詢人數"),e("th",{class:"border p-2 text-center",scope:"col"},"累計諮詢人數")])],-1)),e("tbody",null,[(t(!0),s(Z,null,re(C.value,(r,f)=>(t(),s("tr",{key:f},[e("td",mB,l(r.item_no),1),e("td",bB,l(r.category),1),e("td",fB,l(r.email_month),1),e("td",yB,l(r.email_total),1),e("td",gB,l(r.phone_month),1),e("td",xB,l(r.phone_total),1),e("td",hB,l(r.line_month),1),e("td",wB,l(r.line_total),1)]))),128)),e("tr",_B,[b[7]||(b[7]=e("td",{class:"border p-2 text-center",colspan:"2"},"總計",-1)),e("td",kB,l($.value.email_month),1),e("td",$B,l($.value.email_total),1),e("td",CB,l($.value.phone_month),1),e("td",EB,l($.value.phone_total),1),e("td",SB,l($.value.line_month),1),e("td",DB,l($.value.line_total),1)]),C.value.length===0?(t(),s("tr",MB,b[8]||(b[8]=[e("td",{colspan:8,class:"border p-4 text-center"},"無符合條件的資料",-1)]))):J("",!0)])]))])]))}},IB=Le(AB,[["__scopeId","data-v-54bcbe2f"]]),RB={class:"flex flex-col items-center p-6"},PB={class:"w-full max-w-[1500px]"},UB={class:"w-full max-w-[1500px]"},NB={class:"flex border-b border-gray-300"},TB={class:"w-full max-w-[1500px] mt-6"},VB={key:0},jB={class:"mb-4"},LB=["value"],FB={key:1},qB={class:"mb-4"},OB=["value"],BB={key:2},HB={class:"mb-4"},WB=["value"],zB={key:3},KB={class:"mb-4"},JB=["value"],YB={__name:"StatisticalReports",setup(D){const x=lt(),d=We(),u=m({reportAllRead:!1}),C=m("courseManagement"),o=m("CreditCourseCount"),N=m("AgencyParticipants"),K=m("FundingAllocationStats"),$=m("ConsultationTypeStats"),P=[{label:"開課數量統計表(學分班)",value:"CreditCourseCount",component:Mj},{label:"開課數量統計表(職能班)",value:"VocationalCourseCount",component:Wj},{label:"學分班課程參訓人數統計表",value:"CreditCourseParticipants",component:uL},{label:"職能班課程參訓人數統計表",value:"VocationalCourseParticipants",component:ML},{label:"學分班課程開班數量(平日班)統計表",value:"CreditWeekdayClassCount",component:IF},{label:"學分班課程開班數量(假日班)統計表",value:"CreditWeekendClassCount",component:GF},{label:"職能班課程開班數量統計表",value:"VocationalClassCount",component:bq}],T=[{label:"機關參訓人數統計表",value:"AgencyParticipants",component:ZL},{label:"學員參加課程統計表",value:"StudentCourseParticipation",component:Tq},{label:"學員資安職能證書完成人數統計表",value:"StudentSecurityCertificateCount",component:Zq},{label:"學員進度追蹤統計表",value:"StudentProgressStats",component:cO}],z=[{label:"經費核撥統計表",value:"FundingAllocationStats",component:aB}],g=[{label:"諮詢問題類型及服務人數統計表",value:"ConsultationTypeStats",component:pF},{label:"每月諮詢方式統計表",value:"MonthlyConsultationMethodStats",component:IB}];Ee(()=>C.value,r=>{const f={tab:r};r==="courseManagement"?f.courseReport=o.value:r==="studentManagement"?f.studentReport=N.value:r==="allocationOperations"?f.allocationOperationsReport=K.value:r==="consultationServices"&&(f.consultationReport=$.value),d.replace({query:f})});const a=async()=>{var r;try{const f=await tt.getSidebarPermissions();f.data.code===0&&f.data.message==="success"?(u.value=f.data.data,u.value.reportAllRead||(console.log("無權限訪問統計報表頁面，導航到首頁。"),d.replace("/"))):(console.error("獲取權限失敗:",((r=f.data)==null?void 0:r.message)||"未知錯誤"),d.replace("/"))}catch(f){console.error("獲取權限錯誤:",f),d.replace("/")}};je(()=>{a();let r={};const f=["courseManagement","studentManagement","allocationOperations","consultationServices"];x.query.tab&&f.includes(x.query.tab)?C.value=x.query.tab:(C.value="courseManagement",r.tab="courseManagement"),C.value==="courseManagement"?b("courseReport",o,P,r,"CreditCourseCount"):C.value==="studentManagement"?b("studentReport",N,T,r,"AgencyParticipants"):C.value==="consultationServices"&&b("consultationReport",$,g,r,"ConsultationTypeStats"),(Object.keys(r).length>0||!x.query.tab)&&d.replace({query:r})}),Ee(()=>o.value,r=>{d.replace({query:{...x.query,courseReport:r}})}),Ee(()=>N.value,r=>{d.replace({query:{...x.query,studentReport:r}})}),Ee(()=>K.value,r=>{d.replace({query:{...x.query,allocationOperationsReport:r}})}),Ee(()=>$.value,r=>{d.replace({query:{...x.query,consultationReport:r}})});const A=Se(()=>{const r=P.find(f=>f.value===o.value);return r?r.component:null}),G=Se(()=>{const r=T.find(f=>f.value===N.value);return r?r.component:null}),k=Se(()=>{const r=z.find(f=>f.value===K.value);return r?r.component:null}),c=Se(()=>{const r=g.find(f=>f.value===$.value);return r?r.component:null}),b=(r,f,p,w,y)=>{if(x.query[r]){const V=x.query[r];p.some(W=>W.value===V)?f.value=V:(f.value=y,w[r]=y)}else w[r]=f.value};return(r,f)=>(t(),s("div",RB,[e("div",PB,[Qe(pt,{breadcrumbs:[{name:"統計報表",path:"/statistical-reports"}]})]),e("div",UB,[e("div",NB,[e("button",{class:X(["py-2 px-4 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="courseManagement","text-gray-600 hover:text-gray-800":C.value!=="courseManagement"}]),onClick:f[0]||(f[0]=p=>C.value="courseManagement")}," 課程管理 ",2),e("button",{class:X(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="studentManagement","text-gray-600 hover:text-gray-800":C.value!=="studentManagement"}]),onClick:f[1]||(f[1]=p=>C.value="studentManagement")}," 學員管理 ",2),e("button",{class:X(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="allocationOperations","text-gray-600 hover:text-gray-800":C.value!=="allocationOperations"}]),onClick:f[2]||(f[2]=p=>C.value="allocationOperations")}," 核撥作業 ",2),e("button",{class:X(["py-2 px-4 ml-8 font-medium",{"text-[#4e9875] border-b-2 border-[#4e9875] -mb-px":C.value==="consultationServices","text-gray-600 hover:text-gray-800":C.value!=="consultationServices"}]),onClick:f[3]||(f[3]=p=>C.value="consultationServices")}," 諮詢服務 ",2)])]),e("div",TB,[C.value==="courseManagement"?(t(),s("div",VB,[e("div",jB,[f[8]||(f[8]=e("label",{for:"courseReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),I(e("select",{id:"courseReportSelect","onUpdate:modelValue":f[4]||(f[4]=p=>o.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(Z,null,re(P,p=>e("option",{key:p.value,value:p.value},l(p.label),9,LB)),64))],512),[[Pe,o.value]])]),A.value?(t(),ls(Ts(A.value),{key:0})):J("",!0)])):J("",!0),C.value==="studentManagement"?(t(),s("div",FB,[e("div",qB,[f[9]||(f[9]=e("label",{for:"studentReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),I(e("select",{id:"studentReportSelect","onUpdate:modelValue":f[5]||(f[5]=p=>N.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(Z,null,re(T,p=>e("option",{key:p.value,value:p.value},l(p.label),9,OB)),64))],512),[[Pe,N.value]])]),G.value?(t(),ls(Ts(G.value),{key:0})):J("",!0)])):J("",!0),C.value==="allocationOperations"?(t(),s("div",BB,[e("div",HB,[f[10]||(f[10]=e("label",{for:"allocationOperationsReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),I(e("select",{id:"allocationOperationsReportSelect","onUpdate:modelValue":f[6]||(f[6]=p=>K.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(Z,null,re(z,p=>e("option",{key:p.value,value:p.value},l(p.label),9,WB)),64))],512),[[Pe,K.value]])]),k.value?(t(),ls(Ts(k.value),{key:0})):J("",!0)])):J("",!0),C.value==="consultationServices"?(t(),s("div",zB,[e("div",KB,[f[11]||(f[11]=e("label",{for:"consultationReportSelect",class:"block text-gray-700 text-sm font-bold mb-2"},"選擇報表:",-1)),I(e("select",{id:"consultationReportSelect","onUpdate:modelValue":f[7]||(f[7]=p=>$.value=p),class:"block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},[(t(),s(Z,null,re(g,p=>e("option",{key:p.value,value:p.value},l(p.label),9,JB)),64))],512),[[Pe,$.value]])]),c.value?(t(),ls(Ts(c.value),{key:0})):J("",!0)])):J("",!0)])]))}},GB=Le(YB,[["__scopeId","data-v-bb01fd60"]]),QB={class:"flex flex-col items-center p-6"},ZB={class:"w-full max-w-[1500px] flex justify-between items-center"},XB={class:"w-full max-w-[1500px] flex justify-end mb-6"},eH={class:"space-x-4"},tH=["aria-label"],sH={key:0,class:"w-full max-w-[1500px] flex justify-center items-center py-10"},aH={key:1,class:"w-full max-w-[1500px] grid grid-cols-2 gap-6"},oH={class:"space-y-6"},lH={class:"flex items-center"},nH={class:"flex items-center"},rH=["disabled"],iH={class:"flex items-center"},dH=["disabled"],uH={class:"flex items-center"},cH=["label"],pH=["value"],vH=["value"],mH={class:"flex items-center"},bH=["readonly"],fH={class:"flex items-center"},yH=["readonly"],gH={class:"flex items-center"},xH={class:"w-32",for:"completionDate"},hH=["readonly","placeholder"],wH={class:"flex items-center"},_H=["readonly"],kH={class:"flex items-center"},$H=["readonly"],CH={class:"flex items-center"},EH=["readonly"],SH={class:"flex items-center"},DH=["readonly"],MH={class:"flex items-center"},AH=["readonly"],IH={__name:"CreditsEdit",setup(D){const x=We(),d=lt(),u=m(!1),C=m(!1),o=m(1),N=m({id:0,certificateNumber:"",courseSubjectId:null,subjectName:"",traingUnit:"",trainingPeriod:"",CompletionDate:"",referenceDate:"",credit:0,grade:null}),K=m([]),$=m([]),P=Se({get:()=>{for(const O of K.value){const _=O.items.find(E=>E.id===N.value.courseSubjectId);if(_)return _}return null},set:O=>{N.value.courseSubjectId=O?O.id:null}}),T=Se(()=>{if(!K.value||K.value.length===0||!N.value.courseSubjectId)return"缺";for(const O of K.value){const _=O.items.find(E=>E.id===N.value.courseSubjectId);if(_)return _.name}return"缺"}),z=m({}),g=Se(()=>o.value===1?"有效時間":"完訓時間"),a=Se(()=>o.value===1?"例：113/04/10":"例：113/04/30"),A=Se(()=>{const O=N.value.CompletionDate;if(!O)return!1;const _=O.split("/");if(_.length!==3)return!1;const E=parseInt(_[0])+1911,L=parseInt(_[1])-1,j=parseInt(_[2]),R=new Date(E,L,j),U=new Date;return R.setHours(0,0,0,0),U.setHours(0,0,0,0),R.getTime()<U.getTime()}),G=Se(()=>{const O=d.query.studentId;let _=[];if(O)switch(d.query.originalFrom){case"information":_=[{name:"學員資料",path:"/student/information"},{name:"學員詳情",path:`/student/single/${O}`},{name:"認列編輯",path:""}];break;case"history":_=[{name:"學習歷程",path:"/history"},{name:"學員詳情",path:`/student/single/${O}`},{name:"認列編輯",path:""}];break;case"courseEdit":_=[{name:"課程內容",path:"/course"},{name:"課程編輯",path:`/course-edit/${d.query.courseId}`},{name:"學員詳情",path:`/student/single/${O}`},{name:"認列編輯",path:""}];break;default:_=[{name:"學員管理",path:"/student/information"},{name:"學員詳情",path:`/student/single/${O}`},{name:"認列編輯",path:""}]}else _=[{name:"學員管理",path:"/student/information"},{name:"認列編輯",path:""}];return _}),k=()=>{if(d.query.studentId){const O=d.query.originalFrom;console.log("CreditsEdit 返回 Single 頁面，原始來源:",O),d.query.courseId,d.query.page,["year","school","course","agency","area","searchKeyword","month","sortBy","sortOrder"].forEach(_=>{d.query[_]&&d.query[_]}),x.back()}else x.back()},c=async()=>{u.value?await v.confirmAsync("確認儲存","是否要儲存當前的修改？")&&r():(z.value=JSON.parse(JSON.stringify(N.value)),u.value=!0)},b=async()=>{await v.confirmAsync("確認取消","是否要取消當前的修改？所有未儲存的變更將會遺失。")&&f()},r=()=>{p(N.value)},f=()=>{N.value=JSON.parse(JSON.stringify(z.value)),u.value=!1},p=async O=>{try{C.value=!0,console.log("準備保存學分資料:",O);const _={id:O.id,certificateNumber:O.certificateNumber,courseSubjectId:O.courseSubjectId,subjectName:O.subjectName,traingUnit:O.traingUnit,trainingPeriod:O.trainingPeriod,CompletionDate:O.CompletionDate,referenceDate:O.referenceDate,credit:parseFloat(O.credit),category:o.value,grade:O.grade},E=await Dt.updateCreditCertification(O.id,_);E.data.code===0?(v.showSuccess("儲存成功","學分資料已成功儲存"),w()):(v.showError("儲存失敗",E.data.message||"儲存學分資料失敗"),console.error("儲存學分資料失敗:",E.data.message))}catch(_){console.error("儲存學分資料錯誤:",_),v.showError("儲存失敗","儲存學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},w=async()=>{try{C.value=!0;const O=d.params.id;if(!O){console.error("未提供學習歷史ID");return}const _=await Dt.getCreditCertificationById(O);if(console.log("API 回應:",_.data),!_.data.data){console.error("API 回應格式錯誤:",_.data),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試");return}const E=_.data.data;N.value={id:O,certificateNumber:E.certificateNumber||"",courseSubjectId:E.courseSubjectId||null,subjectName:E.subjectName||"",traingUnit:E.traingUnit||"",trainingPeriod:E.trainingPeriod||"",CompletionDate:E.CompletionDate||"",referenceDate:E.referenceDate||"",credit:E.credit||0,category:E.category||1,grade:E.grade||null},o.value=N.value.category,W(),z.value=JSON.parse(JSON.stringify(N.value)),u.value=!1,console.log("獲取到的學分資料:",N.value)}catch(O){console.error("獲取學分資料錯誤:",O),v.showError("載入失敗","獲取學分資料時發生錯誤，請稍後再試")}finally{C.value=!1}},y=async()=>{try{const O=await ot.getCourseSubjects();O.data.code===0&&O.data.data?(K.value=O.data.data,console.log("獲取到的科目選項:",K.value),V(o.value)):v.showError("載入失敗",O.data.message||"獲取科目選項失敗")}catch(O){console.error("獲取科目選項錯誤:",O),v.showError("載入錯誤","獲取科目選項時發生錯誤")}},V=O=>{$.value=K.value.map(E=>{const L=E.items.filter(j=>O===1&&j.isCyberSecClass||O===2&&!j.isCyberSecClass);return{...E,items:L}}).filter(E=>E.items.length>0);const _=$.value.flatMap(E=>E.items);P.value&&!_.some(E=>E.id===P.value.id)&&(P.value=null)},W=()=>{const O=N.value.trainingPeriod,_=o.value;if(!O){N.value.CompletionDate="";return}const E=O.split("-");let L="";E.length===2?L=E[1].trim():L=O.trim();const j=L.split("/");if(j.length!==3){N.value.CompletionDate="";return}const R=parseInt(j[0])+1911,U=parseInt(j[1])-1,te=parseInt(j[2]);let ue=new Date(R,U,te);_===1?ue.setFullYear(ue.getFullYear()+5):_===2&&ue.setFullYear(ue.getFullYear()+10);const ye=ue.getFullYear()-1911,ke=(ue.getMonth()+1).toString().padStart(2,"0"),De=ue.getDate().toString().padStart(2,"0");N.value.CompletionDate=`${ye}/${ke}/${De}`};return Ee([o,()=>N.value.trainingPeriod],([O])=>{V(O),W()}),je(async()=>{await y(),w()}),(O,_)=>(t(),s("div",QB,[e("div",ZB,[Qe(pt,{breadcrumbs:G.value},null,8,["breadcrumbs"]),e("button",{class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7] flex items-center",onClick:k,"aria-label":"返回上一頁"},_[11]||(_[11]=[e("span",{class:"mr-2"},"←",-1),xe(" 回上一頁 ")]))]),_[27]||(_[27]=e("div",{class:"w-full max-w-[1500px]"},[e("div",{class:"w-full h-[1px] bg-gray-500 my-6"})],-1)),e("div",XB,[e("div",eH,[u.value?(t(),s("button",{key:0,class:"px-4 py-2 bg-[#EEEFE7] hover:bg-[#dedfd7]",onClick:b,"aria-label":"取消編輯"}," 取消 ")):J("",!0),e("button",{class:X(["px-4 py-2",u.value?"bg-[#4e9875] text-white hover:bg-[#438264]":"bg-[#EEEFE7] hover:bg-[#dedfd7]"]),onClick:c,"aria-label":u.value?"儲存編輯內容":"開始編輯內容"},l(u.value?"儲存":"內容編輯"),11,tH)])]),C.value?(t(),s("div",sH,_[12]||(_[12]=[e("div",{class:"text-lg"},"資料載入中...",-1)]))):(t(),s("div",aH,[e("div",oH,[e("div",lH,[_[15]||(_[15]=e("label",{class:"w-28",for:"course-type"},"課程類別:",-1)),e("div",{class:X(["flex items-center space-x-4",u.value?"":"input-display-readonly"])},[e("label",nH,[I(e("input",{id:"course-type-1",type:"radio","onUpdate:modelValue":_[0]||(_[0]=E=>o.value=E),value:1,class:"w-4 h-4 mr-1",disabled:!u.value},null,8,rH),[[ct,o.value]]),_[13]||(_[13]=e("span",null,"資安職能認列學分數",-1))]),e("label",iH,[I(e("input",{id:"course-type-2",type:"radio","onUpdate:modelValue":_[1]||(_[1]=E=>o.value=E),value:2,class:"w-4 h-4 mr-1",disabled:!u.value},null,8,dH),[[ct,o.value]]),_[14]||(_[14]=e("span",null,"資訊課程認列學分數",-1))])],2)]),e("div",uH,[_[17]||(_[17]=e("label",{class:"w-32",for:"courseSubject"},"科目名稱:",-1)),u.value?I((t(),s("select",{key:0,id:"courseSubject",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[2]||(_[2]=E=>P.value=E)},[_[16]||(_[16]=e("option",{value:null},"請選擇科目",-1)),(t(!0),s(Z,null,re($.value,E=>(t(),s("optgroup",{key:E.name,label:E.name},[(t(!0),s(Z,null,re(E.items,L=>(t(),s("option",{key:L.id,value:L},l(L.name),9,pH))),128))],8,cH))),128))],2)),[[Pe,P.value]]):(t(),s("input",{key:1,id:"courseSubject-display",type:"text",class:"p-2 outline-none w-60 border border-gray-300",value:T.value,readonly:"","aria-labelledby":"courseSubject"},null,8,vH))]),e("div",mH,[_[18]||(_[18]=e("label",{class:"w-32",for:"subjectName"},"課程名稱:",-1)),I(e("input",{id:"subjectName",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[3]||(_[3]=E=>N.value.subjectName=E),readonly:!u.value,placeholder:"請輸入課程名稱"},null,10,bH),[[ee,N.value.subjectName]]),_[19]||(_[19]=e("div",{class:"text-gray-500 text-sm ml-2"},"(學分班近10年或職能班近5年進修科目相同之訓練課程)",-1))]),e("div",fH,[_[20]||(_[20]=e("label",{class:"w-32",for:"traingUnit"},"完訓學校:",-1)),I(e("input",{id:"traingUnit",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[4]||(_[4]=E=>N.value.traingUnit=E),readonly:!u.value,placeholder:"請輸入完訓學校"},null,10,yH),[[ee,N.value.traingUnit]])]),e("div",gH,[e("label",xH,l(g.value)+":",1),I(e("input",{id:"completionDate",type:"text",class:X(["p-2 outline-none w-60 border",[u.value?"border-[#4e9875]":"border-gray-300",{"text-red-500":A.value&&!u.value}]]),"onUpdate:modelValue":_[5]||(_[5]=E=>N.value.CompletionDate=E),readonly:!u.value,placeholder:a.value},null,10,hH),[[ee,N.value.CompletionDate]])]),e("div",wH,[_[21]||(_[21]=e("label",{class:"w-32",for:"trainingPeriod"},"訓練起訖時間:",-1)),I(e("input",{id:"trainingPeriod",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[6]||(_[6]=E=>N.value.trainingPeriod=E),readonly:!u.value,placeholder:"例：112/03/01-112/03/31"},null,10,_H),[[ee,N.value.trainingPeriod]])]),e("div",kH,[_[22]||(_[22]=e("label",{class:"w-32",for:"referenceDate"},"參照日期起訖:",-1)),I(e("input",{id:"referenceDate",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[7]||(_[7]=E=>N.value.referenceDate=E),readonly:!u.value,placeholder:"例：113/04/01-113/04/30"},null,10,$H),[[ee,N.value.referenceDate]]),_[23]||(_[23]=e("div",{class:"text-gray-500 text-sm ml-2"},"(評量效期)",-1))]),e("div",CH,[_[24]||(_[24]=e("label",{class:"w-32",for:"credit"},"學分數:",-1)),I(e("input",{id:"credit",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[8]||(_[8]=E=>N.value.credit=E),readonly:!u.value,placeholder:"請輸入學分數"},null,10,EH),[[ee,N.value.credit]])]),e("div",SH,[_[25]||(_[25]=e("label",{class:"w-32",for:"grade"},"成績:",-1)),I(e("input",{id:"grade",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[9]||(_[9]=E=>N.value.grade=E),readonly:!u.value,placeholder:"請輸入成績"},null,10,DH),[[ee,N.value.grade]])]),e("div",MH,[_[26]||(_[26]=e("label",{class:"w-32",for:"certificateNumber"},"證書編號:",-1)),I(e("input",{id:"certificateNumber",type:"text",class:X(["p-2 outline-none w-60 border",u.value?"border-[#4e9875]":"border-gray-300"]),"onUpdate:modelValue":_[10]||(_[10]=E=>N.value.certificateNumber=E),readonly:!u.value},null,10,AH),[[ee,N.value.certificateNumber]])])])]))]))}},RH=Le(IH,[["__scopeId","data-v-5df3547e"]]),PH=[{path:"/",redirect:"/course"},{path:"/login",name:"Login",component:_a,meta:{requiresAuth:!1}},{path:"/initial/:id",name:"InitialReview",component:pl},{path:"/search",name:"SearchList",component:Un},{path:"/course",name:"Course",component:Ti},{path:"/attendance",name:"Attendance",component:ud},{path:"/supervision",name:"Supervision",component:Du},{path:"/student/single/:id",name:"Single",component:hp},{path:"/student/information",name:"Information",component:Qv},{path:"/history",name:"History",component:eb},{path:"/credits",name:"Credits",component:Eb},{path:"/expense",name:"Expense",component:rf},{path:"/management",name:"Management",component:E1},{path:"/question-management",name:"QuestionManagement",component:Zg},{path:"/roles",name:"Roles",component:G0},{path:"/unauthorized",name:"Unauthorized",component:Z0,meta:{requiresAuth:!0}},{path:"/course-edit/:id",name:"CourseEdit",component:S2},{path:"/student/add",name:"Add",component:G2},{path:"/student/single-edit/:id",name:"SingleEdit",component:mh},{path:"/student/credits-edit/:id",name:"CreditsEdit",component:RH},{path:"/board",name:"Dashboard",component:gh},{path:"/checklist",name:"Checklist",component:l_},{path:"/checklist-edit",name:"ChecklistEdit",component:n4},{path:"/credit-list",name:"CreditList",component:kC},{path:"/expense-list",name:"ExpenseList",component:o6},{path:"/grant-application",name:"GrantApplication",component:T7},{path:"/grant-application-edit",name:"GrantApplicationEdit",component:q9},{path:"/remittance",name:"Remittance",component:dD},{path:"/remittance-edit",name:"RemittanceEdit",component:KD},{path:"/role-permissions",name:"RolePermissions",component:CM},{path:"/permission-settings",name:"PermissionSettings",component:wR},{path:"/log-list",name:"LogList",component:HP},{path:"/add-course-student",name:"AddCourseStudent",component:UU},{path:"/file-management",name:"FileManagement",component:MT},{path:"/password",name:"Password",component:OT},{path:"/database",name:"Database",component:AV},{path:"/agency",name:"Agency",component:vj},{path:"/statistical-reports",name:"StatisticalReports",component:GB}],Us=sa({history:aa(),routes:PH}),Ns={"/search":{main:"reviewManagement",read:"reviewManagementRead"},"/course":{main:"courseManagement",read:"courseDataRead"},"/course-edit":{main:"courseManagement",read:"courseDataRead"},"/supervision":{main:"courseManagement",read:"visitRead"},"/survey":{main:"courseManagement",read:"satisfactionRead"},"/supervision-edit":{main:"courseManagement",read:"visitRead"},"/checklist":{main:"courseManagement",read:"visitRead"},"/checklist-edit":{main:"courseManagement",read:"visitRead"},"/student/information":{main:"studentManagement",read:"studentRead"},"/student/single":{main:"studentManagement",read:"studentRead"},"/student/single-edit":{main:"studentManagement",read:"studentRead"},"/student/credits-edit":{main:"studentManagement",read:"creditCertificationRead"},"/history":{main:"studentManagement",read:"learningHistory"},"/credits":{main:"studentManagement",read:"creditCertificationRead"},"/student/add":{main:"studentManagement",read:"studentRead"},"/credit-list":{main:"studentManagement",read:"creditCertificationRead"},"/agency":{main:"studentManagement",read:"studentRead"},"/expense":{main:"verificationManagement",read:"verificationRead"},"/expense-list":{main:"verificationManagement",read:"verificationRead"},"/grant-application":{main:"verificationManagement",read:"verificationRead"},"/grant-application-edit":{main:"verificationManagement",read:"verificationRead"},"/remittance":{main:"verificationManagement",read:"verificationRead"},"/remittance-edit":{main:"verificationManagement",read:"verificationRead"},"/management":{main:"performanceTracking",read:"performanceTrackingRead"},"/question-management":{main:"consultationService",read:"consultationRead"},"/board":{main:"dashboard",read:null},"/file-management":{main:"tool",read:"fileManager"},"/roles":{main:"systemManagement",read:"userRead"},"/role-permissions":{main:"systemManagement",read:"roleRead"},"/permission-settings":{main:"systemManagement",read:"roleRead"},"/log-list":{main:"systemManagement",read:"systemLogRead"},"/database":{main:"systemManagement",read:"dataBaseRead"},"/password":{main:"systemManagement",read:"userRead"},"/statistical-reports":{main:"reportAllRead",read:null}};let ys=null,Is=null;const UH=async()=>ys||Is||(Is=new Promise(D=>{tt.getSidebarPermissions().then(x=>{x.data.code===0&&x.data.message==="success"?(ys=x.data.data,document.dispatchEvent(new CustomEvent("permissions_updated",{detail:ys})),D(ys)):D(null)}).catch(x=>{console.error("獲取權限失敗:",x),D(null)}).finally(()=>{setTimeout(()=>{Is=null},200)})}),Is),NH=()=>{ys=null},TH=D=>["/login","/unauthorized"].includes(D),VH=(D,x,d)=>D.isNeedChangePwd===!0&&x!=="/password"?(d("/password"),!0):!1,jH=(D,x,d)=>x.specialCase&&x.main==="isNeedChangePwd"?D.isNeedChangePwd===!0||D.systemManagement&&D.userRead?(d(),!0):(d("/unauthorized"),!0):!1,LH=(D,x,d)=>x?D[x.main]===!0?x.read&&D[x.read]!==!0?(console.log(`用戶有主權限 ${x.main} 但缺少讀取權限 ${x.read}`),d("/unauthorized"),!0):!1:(d("/unauthorized"),!0):!1;Us.beforeEach(async(D,x,d)=>{if(TH(D.path)){d();return}if(!localStorage.getItem("token")){d("/login");return}const C=await UH();if(!C){d("/unauthorized");return}if(VH(C,D.path,d))return;if(D.path==="/password"&&C.isNeedChangePwd===!0){d();return}const o=FH(D.path);jH(C,o||{},d)||LH(C,o,d)||d()});function FH(D){for(const x in Ns)if(D.startsWith(x))return Ns[x];return null}function qH(D){if(!D)return null;const x=[{key:"courseManagement",path:"/course"},{key:"studentManagement",path:"/student/information"},{key:"verificationManagement",path:"/expense-list"},{key:"reviewManagement",path:"/search"},{key:"performanceTracking",path:"/management"},{key:"consultationService",path:"/question-management"},{key:"dashboard",path:"/board"},{key:"systemManagement",path:"/roles"},{key:"tool",path:"/file-management"}];for(const d of x)if(D[d.key]){const u=Ns[d.path];if(!u)continue;if(!u.read||D[u.read])return d.path}for(const[d,u]of Object.entries(Ns)){const C=D[u.main],o=!u.read||D[u.read];if(C&&o)return d}return null}Us.options.getFirstAvailablePath=qH;const OH={class:"w-full fixed top-0 left-0 z-50"},BH={class:"border-b bg-[#EEEFE7] flex justify-between items-center"},HH={class:"flex-1 flex justify-center"},WH={class:"flex"},zH=["onMouseenter"],KH={key:0,class:"absolute left-0 w-48 bg-[#F7F7F7] shadow-lg z-50"},JH={key:0,class:"ml-2 text-gray-400"},YH={key:0,class:"absolute left-full top-0 w-48 bg-[#F7F7F7] shadow-lg hidden group-hover/sub:block"},GH={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},QH={class:"bg-white rounded-lg p-6 w-[500px] max-h-[90vh] overflow-y-auto"},ZH={class:"flex flex-col"},XH={class:"flex flex-col"},eW={class:"flex flex-col"},tW={class:"flex flex-col"},sW={class:"flex flex-col"},aW={class:"flex justify-end space-x-2 mt-6"},oW=["disabled"],lW={__name:"Header",setup(D){const x=lt();We();const d=m(null),u=m({reviewManagement:!1,reviewManagementRead:!1,reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementImport:!1,courseManagement:!1,courseDataCreate:!1,courseDataUpdate:!1,courseDataDelete:!1,courseDataImport:!1,courseDataExport:!1,courseDataRead:!1,visitCreate:!1,visitUpdate:!1,visitExport:!1,visitRead:!1,satisfactionSurveyImport:!1,satisfactionRead:!1,studentManagement:!1,studentCreate:!1,studentUpdate:!1,studentDelete:!1,studentImport:!1,studentExport:!1,studentRead:!1,learningHistory:!1,creditCertificationImport:!1,creditCertificationCreate:!1,creditCertificationRead:!1,verificationManagement:!1,verificationCreate:!1,verificationUpdate:!1,verificationExport:!1,verificationRead:!1,performanceTracking:!1,performanceTrackingRead:!1,performanceTrackingEdit:!1,consultationService:!1,consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationRead:!1,consultationReadDetail:!1,consultationImport:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryUpdate:!1,consultationCategoryDelete:!1,systemManagement:!1,userCreate:!1,userUpdate:!1,userDelete:!1,userRead:!1,roleCreate:!1,roleUpdate:!1,roleDelete:!1,roleRead:!1,systemLogRead:!1,systemLogExport:!1,dataBaseRead:!1,dataBaseExport:!1,dashboard:!1,tool:!1,fileManager:!1,fileManagerCreate:!1,fileManagerUpload:!1,fileManageDelete:!1}),C=m(!1),o=m(!1),N=m({id:null,name:"",unit:"",title:"",account:"",password:""}),K=async()=>{try{const k=await Ls.logout();k.data.code===0&&k.data.message==="success"?($(),v.showSuccess("登出成功","您已成功登出系統"),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1e3)):(console.error("登出失敗:",k.data.message),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"))}catch(k){console.error("登出錯誤:",k),v.showError("登出失敗","登出過程中發生錯誤，請稍後再試"),$(),setTimeout(()=>{window.location.href="/login?t="+new Date().getTime()},1500)}},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(k=>{k.startsWith("app_")&&localStorage.removeItem(k)}),sessionStorage.clear(),u.value={reviewManagement:!1,reviewManagementRead:!1,reviewManagementEdit:!1,reviewManagementApprove:!1,reviewManagementImport:!1,courseManagement:!1,courseDataCreate:!1,courseDataUpdate:!1,courseDataDelete:!1,courseDataImport:!1,courseDataExport:!1,courseDataRead:!1,visitCreate:!1,visitUpdate:!1,visitExport:!1,visitRead:!1,satisfactionSurveyImport:!1,satisfactionRead:!1,studentManagement:!1,studentCreate:!1,studentUpdate:!1,studentDelete:!1,studentImport:!1,studentExport:!1,studentRead:!1,learningHistory:!1,creditCertificationImport:!1,creditCertificationCreate:!1,creditCertificationRead:!1,verificationManagement:!1,verificationCreate:!1,verificationUpdate:!1,verificationExport:!1,verificationRead:!1,performanceTracking:!1,performanceTrackingRead:!1,performanceTrackingEdit:!1,consultationService:!1,consultationCreate:!1,consultationUpdate:!1,consultationDelete:!1,consultationRead:!1,consultationReadDetail:!1,consultationImport:!1,consultationCategoryRead:!1,consultationCategoryCreate:!1,consultationCategoryUpdate:!1,consultationCategoryDelete:!1,systemManagement:!1,userCreate:!1,userUpdate:!1,userDelete:!1,userRead:!1,roleCreate:!1,roleUpdate:!1,roleDelete:!1,roleRead:!1,systemLogRead:!1,systemLogExport:!1,dataBaseRead:!1,dataBaseExport:!1,dashboard:!1,tool:!1,fileManager:!1,fileManagerCreate:!1,fileManagerUpload:!1,fileManageDelete:!1,agencyRead:!1,agencyCreate:!1,agencyUpdate:!1,agencyDelete:!1,reportAllRead:!1}},P=k=>{k.detail&&(u.value=k.detail,console.log("權限數據已從路由守衛更新"))},T=[{name:"開課計畫審查",permissionKey:"reviewManagement",path:"/search"},{name:"課程管理",permissionKey:"courseManagement",children:[{name:"課程內容",path:"/course",permissionKey:"courseDataRead"},{name:"訪視督課",path:"/supervision",permissionKey:"visitRead"}]},{name:"學員管理",permissionKey:"studentManagement",children:[{name:"學員資料",path:"/student/information",permissionKey:"studentRead"},{name:"學習歷程",path:"/history",permissionKey:"learningHistory"},{name:"學分認列",path:"/credit-list",permissionKey:"creditCertificationRead"}]},{name:"核撥作業",permissionKey:"verificationManagement",path:"/expense-list"},{name:"追蹤成效",permissionKey:"performanceTracking",path:"/management"},{name:"諮詢服務",permissionKey:"consultationService",path:"/question-management"},{name:"統計報表",permissionKey:"reportAllRead",path:"/statistical-reports"},{name:"儀表板",permissionKey:"dashboard",path:"/board"},{name:"工具",permissionKey:"tool",path:"/file-management"},{name:"系統管理",permissionKey:"systemManagement",children:[{name:"使用者管理",path:"/roles",permissionKey:"userRead"},{name:"角色管理",path:"/role-permissions",permissionKey:"roleRead"},{name:"系統日誌",path:"/log-list",permissionKey:"systemLogRead"},{name:"資料庫管理",path:"/database",permissionKey:"dataBaseRead"}]}],z=Se(()=>JSON.parse(JSON.stringify(T)).filter(c=>{if(c.permissionKey&&!u.value[c.permissionKey])return!1;if(c.children&&c.children.length>0){if(c.children=c.children.filter(b=>b.permissionKey&&u.value[b.permissionKey]===!0),c.permissionKey&&u.value[c.permissionKey]&&c.children.length===0)return!1}else if(c.path){const b=Ns[c.path];if(!b)return!1;const r=u.value[b.main]===!0,f=!b.read||u.value[b.read]===!0;return r&&f}return!0})),g=k=>d.value===k||x.path.startsWith("/"+k.toLowerCase());je(()=>{document.addEventListener("permissions_updated",P),document.addEventListener("user_login_success",a),setTimeout(()=>{Object.keys(u.value).length===0&&(console.log("路由守衛未提供權限數據，Header組件主動獲取"),fetchSidebarPermissions())},100)});const a=()=>{console.log("檢測到用戶登入成功，重新獲取權限"),fetchSidebarPermissions()};oa(()=>{document.removeEventListener("permissions_updated",P),document.removeEventListener("user_login_success",a)});const A=async()=>{try{const k=await es.getProfile();if(k.data.code===0&&k.data.message==="success"){const c=k.data.data;N.value={id:c.id,name:c.name,unit:c.unit,title:c.title,account:c.account,password:""}}}catch(k){console.error("獲取個人資料錯誤:",k)}C.value=!0},G=async()=>{if(!N.value.id){v.showError("錯誤","無法獲取使用者ID，無法更新資料。");return}o.value=!0;try{const k={id:N.value.id,account:N.value.account};N.value.password&&(k.password=N.value.password);const c=await es.updateProfile(N.value.id,k);c.data.code===0&&c.data.message==="success"?(v.showSuccess("更新成功","您的個人資料已更新。"),C.value=!1):v.showError("更新失敗",c.data.message||"更新個人資料時發生錯誤。")}catch(k){console.error("更新個人資料錯誤:",k),v.showError("更新失敗","更新個人資料時發生錯誤，請稍後再試。")}finally{o.value=!1}};return(k,c)=>{const b=Os("router-link");return t(),s("div",null,[e("header",OH,[c[7]||(c[7]=Zs('<div class="bg-[#3e4346] text-white p-2 flex justify-between items-center" data-v-b68a750a><div class="flex items-center mx-12" data-v-b68a750a><h1 class="text-2xl" data-v-b68a750a>推動政府資安人力職能轉換訓練服務</h1></div><div class="flex items-center mx-12" data-v-b68a750a><div class="flex items-center" data-v-b68a750a><img src="'+ia+'" alt="Logo" class="h-16" data-v-b68a750a><div class="ml-2" data-v-b68a750a><div class="text-lg font-bold" data-v-b68a750a>數位發展部資通安全署</div><div class="text-sm" data-v-b68a750a>Administration for Cyber Security, moda</div></div></div></div></div>',1)),e("nav",BH,[e("div",HH,[e("ul",WH,[(t(!0),s(Z,null,re(z.value,(r,f)=>(t(),s("li",{key:f,class:"relative group",onMouseenter:p=>d.value=r.name,onMouseleave:c[0]||(c[0]=p=>d.value=null)},[r.children?(t(),s(Z,{key:0},[e("div",{class:X(["px-6 py-3 inline-block hover:bg-gray-100 text-center cursor-default",{"bg-[#F7F7F7]":g(r.name)}])},l(r.name),3),d.value===r.name?(t(),s("ul",KH,[(t(!0),s(Z,null,re(r.children,(p,w)=>(t(),s("li",{key:w,class:"relative group/sub"},[Qe(b,{to:p.path,class:"px-4 py-2 w-full inline-flex justify-between items-center hover:bg-gray-50"},{default:Rs(()=>[xe(l(p.name)+" ",1),p.children?(t(),s("span",JH,"▶")):J("",!0)]),_:2},1032,["to"]),p.children?(t(),s("ul",YH,[(t(!0),s(Z,null,re(p.children,(y,V)=>(t(),s("li",{key:V},[Qe(b,{to:y.path,class:"px-4 py-2 w-full inline-block hover:bg-gray-50"},{default:Rs(()=>[xe(l(y.name),1)]),_:2},1032,["to"])]))),128))])):J("",!0)]))),128))])):J("",!0)],64)):(t(),ls(b,{key:1,to:r.path,class:X(["px-6 py-3 inline-block hover:bg-gray-100 text-center",{"bg-[#F7F7F7]":g(r.name)}])},{default:Rs(()=>[xe(l(r.name),1)]),_:2},1032,["to","class"]))],40,zH))),128))])]),e("div",{class:"mr-6 flex items-center space-x-2"},[e("button",{onClick:A,class:"px-4 py-1 my-2 bg-gray-500 text-white hover:bg-gray-600 rounded","aria-label":"開啟設定"}," 設定 "),e("button",{onClick:K,class:"px-4 py-1 my-2 bg-[#4e9875] text-white hover:bg-[#438264] rounded"}," 登出 ")])])]),c[14]||(c[14]=e("div",{class:"h-[132px]"},null,-1)),C.value?(t(),s("div",GH,[e("div",QH,[c[13]||(c[13]=e("h3",{class:"text-xl font-bold mb-4"},"個人設定",-1)),e("form",{onSubmit:Ot(G,["prevent"]),class:"space-y-4"},[e("div",ZH,[c[8]||(c[8]=e("label",{for:"settings-name",class:"mb-1"},"姓名",-1)),I(e("input",{id:"settings-name","onUpdate:modelValue":c[1]||(c[1]=r=>N.value.name=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[ee,N.value.name]])]),e("div",XH,[c[9]||(c[9]=e("label",{for:"settings-unit",class:"mb-1"},"單位",-1)),I(e("input",{id:"settings-unit","onUpdate:modelValue":c[2]||(c[2]=r=>N.value.unit=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[ee,N.value.unit]])]),e("div",eW,[c[10]||(c[10]=e("label",{for:"settings-title",class:"mb-1"},"職稱",-1)),I(e("input",{id:"settings-title","onUpdate:modelValue":c[3]||(c[3]=r=>N.value.title=r),type:"text",class:"border p-2 rounded outline-none cursor-not-allowed bg-gray-100",readonly:""},null,512),[[ee,N.value.title]])]),e("div",tW,[c[11]||(c[11]=e("label",{for:"settings-account",class:"mb-1"},"帳號",-1)),I(e("input",{id:"settings-account","onUpdate:modelValue":c[4]||(c[4]=r=>N.value.account=r),type:"text",class:"border p-2 rounded cursor-not-allowed bg-gray-100 outline-none",readonly:""},null,512),[[ee,N.value.account]])]),e("div",sW,[c[12]||(c[12]=e("label",{for:"settings-password",class:"mb-1"},"新密碼",-1)),I(e("input",{id:"settings-password","onUpdate:modelValue":c[5]||(c[5]=r=>N.value.password=r),type:"password",class:"border p-2 rounded outline-none",placeholder:"不修改請留空"},null,512),[[ee,N.value.password]])]),e("div",aW,[e("button",{type:"button",onClick:c[6]||(c[6]=r=>C.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{type:"submit",class:"px-4 py-2 bg-[#4e9875] hover:bg-[#438264] text-white rounded",disabled:o.value},l(o.value?"更新中...":"確認更新"),9,oW)])],32)])])):J("",!0)])}}},nW=Le(lW,[["__scopeId","data-v-b68a750a"]]),rW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},iW={class:"bg-white rounded-lg shadow-lg w-96 z-10 max-h-[90vh] overflow-y-auto"},dW={class:"bg-red-600 text-white p-4"},uW={class:"text-lg font-medium"},cW={class:"p-6"},pW={class:"flex items-start"},vW={class:"text-gray-700"},mW={__name:"ErrorModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"操作失敗"},message:{type:String,default:"操作過程中發生錯誤"}},emits:["close"],setup(D,{emit:x}){const d=x,u=()=>{d("close")};return(C,o)=>D.visible?(t(),s("div",rW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:u}),e("div",iW,[e("div",dW,[e("h3",uW,l(D.title),1)]),e("div",cW,[e("div",pW,[o[0]||(o[0]=e("svg",{class:"w-6 h-6 text-red-600 mr-3 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",vW,l(D.message),1)])]),e("div",{class:"bg-gray-50 px-4 py-3 flex justify-end"},[e("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:u}," 確定 ")])])])):J("",!0)}},bW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},fW={class:"bg-white rounded-lg shadow-lg w-96 z-10 max-h-[90vh] overflow-y-auto"},yW={class:"bg-[#4e9875] text-white p-4"},gW={class:"text-lg font-medium"},xW={class:"p-6"},hW={class:"flex items-center"},wW={class:"text-gray-700"},_W={__name:"SuccessModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"操作成功"},message:{type:String,default:"資料已成功儲存"},autoClose:{type:Boolean,default:!0},duration:{type:Number,default:3e3}},emits:["close"],setup(D,{emit:x}){const d=D,u=x,C=()=>{u("close")};let o=null;return Ee(()=>d.visible,N=>{N&&d.autoClose&&(clearTimeout(o),o=setTimeout(()=>{C()},d.duration))}),je(()=>()=>{clearTimeout(o)}),(N,K)=>D.visible?(t(),s("div",bW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:C}),e("div",fW,[e("div",yW,[e("h3",gW,l(D.title),1)]),e("div",xW,[e("div",hW,[K[0]||(K[0]=e("svg",{class:"w-6 h-6 text-[#4e9875] mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),e("p",wW,l(D.message),1)])]),e("div",{class:"bg-gray-50 px-4 py-3 flex justify-end"},[e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:C}," 確定 ")])])])):J("",!0)}},kW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},$W={class:"bg-white rounded-lg shadow-lg w-96 z-10 overflow-hidden"},CW={class:"bg-gray-700 text-white p-4"},EW={class:"text-lg font-medium"},SW={class:"p-6"},DW={class:"flex items-start"},MW={class:"text-gray-700"},AW={class:"bg-gray-50 px-4 py-3 flex justify-end space-x-3"},IW={__name:"ConfirmModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"確認操作"},message:{type:String,default:"確定要執行此操作嗎？"},confirmText:{type:String,default:"確定"},cancelText:{type:String,default:"取消"}},emits:["confirm","cancel"],setup(D,{emit:x}){const d=x,u=()=>{d("confirm")},C=()=>{d("cancel")};return(o,N)=>D.visible?(t(),s("div",kW,[N[1]||(N[1]=e("div",{class:"absolute inset-0 bg-black opacity-50"},null,-1)),e("div",$W,[e("div",CW,[e("h3",EW,l(D.title),1)]),e("div",SW,[e("div",DW,[N[0]||(N[0]=e("svg",{class:"w-6 h-6 text-yellow-500 mr-3 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",MW,l(D.message),1)])]),e("div",AW,[e("button",{class:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",onClick:C},l(D.cancelText),1),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:u},l(D.confirmText),1)])])])):J("",!0)}},RW={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},PW={class:"bg-white rounded-lg shadow-lg w-96 relative z-10 max-h-[90vh] overflow-y-auto"},UW={class:"p-4 border-b border-gray-200 flex justify-between items-center"},NW={class:"text-lg font-medium text-gray-800"},TW={class:"p-4"},VW={class:"flex"},jW={class:"ml-3"},LW=["innerHTML"],FW={class:"px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse bg-gray-50 rounded-b-lg"},qW={__name:"InfoModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"信息"},message:{type:String,default:""}},emits:["close"],setup(D){return(x,d)=>D.visible?(t(),s("div",RW,[d[4]||(d[4]=e("div",{class:"fixed inset-0 bg-black opacity-50"},null,-1)),e("div",PW,[e("div",UW,[e("h3",NW,l(D.title),1),e("button",{onClick:d[0]||(d[0]=u=>x.$emit("close")),class:"text-gray-500 hover:text-gray-700"},d[2]||(d[2]=[e("span",{class:"text-xl"},"×",-1)]))]),e("div",TW,[e("div",VW,[d[3]||(d[3]=e("div",{class:"flex-shrink-0 mx-2"},[e("svg",{class:"h-6 w-6 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",jW,[e("p",{class:"text-sm text-gray-600",innerHTML:D.message},null,8,LW)])])]),e("div",FW,[e("button",{onClick:d[1]||(d[1]=u=>x.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"}," 確定 ")])])])):J("",!0)}},OW={key:0,class:"fixed inset-0 flex items-center justify-center z-[1000]"},BW={class:"bg-white rounded-lg shadow-xl p-6 w-96 relative z-10"},HW={class:"text-xl font-bold mb-4"},WW={class:"mb-6"},zW={class:"text-gray-600 mb-4"},KW=["type"],JW={__name:"PromptModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"請輸入"},message:{type:String,default:""},type:{type:String,default:"text"},value:{type:String,default:""}},emits:["confirm","cancel"],setup(D,{emit:x}){const d=D,u=x,C=m(d.value);Ee(()=>d.value,K=>{C.value=K}),Ee(()=>d.visible,K=>{K&&(C.value="")});const o=()=>{u("confirm",C.value)},N=()=>{u("cancel")};return(K,$)=>D.visible?(t(),s("div",OW,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:N}),e("div",BW,[e("div",HW,l(D.title),1),e("div",WW,[e("p",zW,l(D.message),1),I(e("input",{"onUpdate:modelValue":$[0]||($[0]=P=>C.value=P),type:D.type,class:"w-full border border-gray-300 rounded p-2 focus:outline-none focus:border-[#4e9875]",onKeyup:Ne(o,["enter"])},null,40,KW),[[la,C.value]])]),e("div",{class:"flex justify-end space-x-2"},[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:N}," 取消 "),e("button",{class:"px-4 py-2 bg-[#4e9875] text-white rounded hover:bg-[#3d7a5d]",onClick:o}," 確定 ")])])])):J("",!0)}},YW=Le(JW,[["__scopeId","data-v-0082ed9e"]]),GW={__name:"GlobalModals",setup(D){const x=()=>{v.closeConfirm(),document.dispatchEvent(new CustomEvent("confirm_ok"))},d=()=>{v.closeConfirm(),document.dispatchEvent(new CustomEvent("confirm_cancel"))},u=o=>{document.dispatchEvent(new CustomEvent("prompt_confirm",{detail:o})),v.closePrompt()},C=()=>{document.dispatchEvent(new CustomEvent("prompt_cancel")),v.closePrompt()};return(o,N)=>(t(),s(Z,null,[Qe(mW,{visible:xt(v).errorModal.visible.value,title:xt(v).errorModal.title.value,message:xt(v).errorModal.message.value,onClose:N[0]||(N[0]=K=>xt(v).closeError())},null,8,["visible","title","message"]),Qe(_W,{visible:xt(v).successModal.visible.value,title:xt(v).successModal.title.value,message:xt(v).successModal.message.value,onClose:N[1]||(N[1]=K=>xt(v).closeSuccess())},null,8,["visible","title","message"]),Qe(IW,{visible:xt(v).confirmModal.visible.value,title:xt(v).confirmModal.title.value,message:xt(v).confirmModal.message.value,onConfirm:x,onCancel:d},null,8,["visible","title","message"]),Qe(qW,{visible:xt(v).infoModal.visible.value,title:xt(v).infoModal.title.value,message:xt(v).infoModal.message.value,onClose:N[2]||(N[2]=K=>xt(v).closeInfo())},null,8,["visible","title","message"]),Qe(YW,{visible:xt(v).promptModal.visible.value,title:xt(v).promptModal.title.value,message:xt(v).promptModal.message.value,type:xt(v).promptModal.type.value,value:xt(v).promptModal.value.value,onConfirm:u,onCancel:C},null,8,["visible","title","message","type","value"])],64))}};class QW{constructor(){this.timeoutId=null,this.inactivityTime=1e3*60*1e3,this.isInitialized=!1}init(){this.isInitialized||(this.setupEventListeners(),this.resetTimer(),this.isInitialized=!0,console.log("自動登出服務已初始化，閒置時間設定為",this.inactivityTime/6e4,"分鐘"))}setupEventListeners(){const x=["mousedown","mousemove","keypress","scroll","touchstart"];this.resetTimerBound=this.resetTimer.bind(this),x.forEach(d=>{document.addEventListener(d,this.resetTimerBound)}),window.addEventListener("beforeunload",()=>{this.clearTimer()})}resetTimer(){this.clearTimer(),this.timeoutId=setTimeout(()=>this.logout(),this.inactivityTime)}clearTimer(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}async logout(){try{console.log("用戶閒置超過",this.inactivityTime/6e4,"分鐘，執行自動登出"),v.showInfo("自動登出","由於長時間未操作，系統已自動登出");const x=()=>{document.removeEventListener("info_close",x),this.performLogout()};document.addEventListener("info_close",x)}catch(x){console.error("自動登出錯誤:",x),this.performLogout()}}async performLogout(){try{await Ls.logout()}catch(x){console.error("登出 API 調用失敗:",x)}finally{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("permissions"),localStorage.removeItem("userInfo"),Object.keys(localStorage).forEach(x=>{x.startsWith("app_")&&localStorage.removeItem(x)}),sessionStorage.clear(),window.location.href="/login?reload=true&t="+new Date().getTime()}}stop(){this.clearTimer(),this.resetTimerBound&&["mousedown","mousemove","keypress","scroll","touchstart"].forEach(d=>{document.removeEventListener(d,this.resetTimerBound)}),this.isInitialized=!1,console.log("自動登出服務已停止")}}const Vs=new QW,ZW={class:"min-h-screen flex flex-col"},XW={class:"flex-1"},ez={__name:"App",setup(D){const x=lt(),d=We(),u=Se(()=>x.path==="/login"),C=Se(()=>localStorage.getItem("token")!==null),o=Se(()=>!u.value&&C.value),N=()=>{console.log("偵測到用戶登出事件，進行頁面重置"),x.path!=="/login"&&d.push("/login")};return Ee(C,K=>{K?Vs.init():Vs.stop()}),je(()=>{C.value&&Vs.init(),document.addEventListener("user_logout",N)}),na(()=>{Vs.stop(),document.removeEventListener("user_logout",N)}),(K,$)=>{const P=Os("router-view");return t(),s("div",ZW,[o.value?(t(),ls(nW,{key:0})):J("",!0),e("main",XW,[Qe(P)]),Qe(GW)])}}},ta=ra(ez);ta.use(Us);ta.mount("#app");
